if(!Array.from){Array.from=(function(){var symbolIterator;try{symbolIterator=Symbol.iterator?Symbol.iterator:'Symbol(Symbol.iterator)';}catch(e){symbolIterator='Symbol(Symbol.iterator)';}
var toStr=Object.prototype.toString;var isCallable=function(fn){return(typeof fn==='function'||toStr.call(fn)==='[object Function]');};var toInteger=function(value){var number=Number(value);if(isNaN(number))return 0;if(number===0||!isFinite(number))return number;return(number>0?1:-1)*Math.floor(Math.abs(number));};var maxSafeInteger=Math.pow(2,53)-1;var toLength=function(value){var len=toInteger(value);return Math.min(Math.max(len,0),maxSafeInteger);};var setGetItemHandler=function setGetItemHandler(isIterator,items){var iterator=isIterator&&items[symbolIterator]();return function getItem(k){return isIterator?iterator.next():items[k];};};var getArray=function getArray(T,A,len,getItem,isIterator,mapFn){var k=0;while(k<len||isIterator){var item=getItem(k);var kValue=isIterator?item.value:item;if(isIterator&&item.done){return A;}else{if(mapFn){A[k]=typeof T==='undefined'?mapFn(kValue,k):mapFn.call(T,kValue,k);}else{A[k]=kValue;}}
k+=1;}
if(isIterator){throw new TypeError('Array.from: provided arrayLike or iterator has length more then 2 ** 52 - 1');}else{A.length=len;}
return A;};return function from(arrayLikeOrIterator){var C=this;var items=Object(arrayLikeOrIterator);var isIterator=isCallable(items[symbolIterator]);if(arrayLikeOrIterator==null&&!isIterator){throw new TypeError('Array.from requires an array-like object or iterator - not null or undefined');}
var mapFn=arguments.length>1?arguments[1]:void undefined;var T;if(typeof mapFn!=='undefined'){if(!isCallable(mapFn)){throw new TypeError('Array.from: when provided, the second argument must be a function');}
if(arguments.length>2){T=arguments[2];}}
var len=toLength(items.length);var A=isCallable(C)?Object(new C(len)):new Array(len);return getArray(T,A,len,setGetItemHandler(isIterator,items),isIterator,mapFn);};})();}
if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;}
if(!Element.prototype.closest){Element.prototype.closest=function(s){var el=this;do{if(el.matches(s))return el;el=el.parentElement||el.parentNode;}while(el!==null&&el.nodeType===1);return null;};}
if(!Math.clz32)Math.clz32=(function(log,LN2){return function(x){var asUint=x>>>0;if(asUint===0){return 32;}
return 31-(log(asUint)/LN2|0)|0;};})(Math.log,Math.LN2);Math.fround=Math.fround||(function(array){return function(x){return array[0]=x,array[0];};})(new Float32Array(1));if(!Math.imul)Math.imul=function(opA,opB){opB|=0;var result=(opA&0x003fffff)*opB;if(opA&0xffc00000/*!== 0*/)result+=(opA&0xffc00000)*opB|0;return result|0;};window.MutationObserver=window.MutationObserver||window.WebKitMutationObserver;if(!Object.entries){Object.entries=function(obj){var ownProps=Object.keys(obj),i=ownProps.length,resArray=new Array(i);while(i--)
resArray[i]=[ownProps[i],obj[ownProps[i]]];return resArray;};}
if(!Object.fromEntries){Object.fromEntries=function(iterable){var result={};var array=Array.from(iterable);array.forEach(function(value){result[value[0]]=value[1];});return result;}}
(function(){window.requestAnimationFrame=window.requestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame;window.cancelAnimationFrame=window.cancelAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame;if(!window.requestAnimationFrame){var lastTime=0;window.requestAnimationFrame=function(callback,element){var currTime=new Date().getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;};}
if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(id){clearTimeout(id);};}}());(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?factory(exports):typeof define==='function'&&define.amd?define(['exports'],factory):(factory((global.WHATWGFetch={})));}(this,(function(exports){'use strict';var global=(typeof globalThis!=='undefined'&&globalThis)||(typeof self!=='undefined'&&self)||(typeof global!=='undefined'&&global);var support={searchParams:'URLSearchParams'in global,iterable:'Symbol'in global&&'iterator'in Symbol,blob:'FileReader'in global&&'Blob'in global&&(function(){try{new Blob();return true}catch(e){return false}})(),formData:'FormData'in global,arrayBuffer:'ArrayBuffer'in global};function isDataView(obj){return obj&&DataView.prototype.isPrototypeOf(obj)}
if(support.arrayBuffer){var viewClasses=['[object Int8Array]','[object Uint8Array]','[object Uint8ClampedArray]','[object Int16Array]','[object Uint16Array]','[object Int32Array]','[object Uint32Array]','[object Float32Array]','[object Float64Array]'];var isArrayBufferView=ArrayBuffer.isView||function(obj){return obj&&viewClasses.indexOf(Object.prototype.toString.call(obj))>-1};}
function normalizeName(name){if(typeof name!=='string'){name=String(name);}
if(/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(name)||name===''){throw new TypeError('Invalid character in header field name: "'+name+'"')}
return name.toLowerCase()}
function normalizeValue(value){if(typeof value!=='string'){value=String(value);}
return value}
function iteratorFor(items){var iterator={next:function(){var value=items.shift();return{done:value===undefined,value:value}}};if(support.iterable){iterator[Symbol.iterator]=function(){return iterator};}
return iterator}
function Headers(headers){this.map={};if(headers instanceof Headers){headers.forEach(function(value,name){this.append(name,value);},this);}else if(Array.isArray(headers)){headers.forEach(function(header){this.append(header[0],header[1]);},this);}else if(headers){Object.getOwnPropertyNames(headers).forEach(function(name){this.append(name,headers[name]);},this);}}
Headers.prototype.append=function(name,value){name=normalizeName(name);value=normalizeValue(value);var oldValue=this.map[name];this.map[name]=oldValue?oldValue+', '+value:value;};Headers.prototype['delete']=function(name){delete this.map[normalizeName(name)];};Headers.prototype.get=function(name){name=normalizeName(name);return this.has(name)?this.map[name]:null};Headers.prototype.has=function(name){return this.map.hasOwnProperty(normalizeName(name))};Headers.prototype.set=function(name,value){this.map[normalizeName(name)]=normalizeValue(value);};Headers.prototype.forEach=function(callback,thisArg){for(var name in this.map){if(this.map.hasOwnProperty(name)){callback.call(thisArg,this.map[name],name,this);}}};Headers.prototype.keys=function(){var items=[];this.forEach(function(value,name){items.push(name);});return iteratorFor(items)};Headers.prototype.values=function(){var items=[];this.forEach(function(value){items.push(value);});return iteratorFor(items)};Headers.prototype.entries=function(){var items=[];this.forEach(function(value,name){items.push([name,value]);});return iteratorFor(items)};if(support.iterable){Headers.prototype[Symbol.iterator]=Headers.prototype.entries;}
function consumed(body){if(body.bodyUsed){return Promise.reject(new TypeError('Already read'))}
body.bodyUsed=true;}
function fileReaderReady(reader){return new Promise(function(resolve,reject){reader.onload=function(){resolve(reader.result);};reader.onerror=function(){reject(reader.error);};})}
function readBlobAsArrayBuffer(blob){var reader=new FileReader();var promise=fileReaderReady(reader);reader.readAsArrayBuffer(blob);return promise}
function readBlobAsText(blob){var reader=new FileReader();var promise=fileReaderReady(reader);reader.readAsText(blob);return promise}
function readArrayBufferAsText(buf){var view=new Uint8Array(buf);var chars=new Array(view.length);for(var i=0;i<view.length;i++){chars[i]=String.fromCharCode(view[i]);}
return chars.join('')}
function bufferClone(buf){if(buf.slice){return buf.slice(0)}else{var view=new Uint8Array(buf.byteLength);view.set(new Uint8Array(buf));return view.buffer}}
function Body(){this.bodyUsed=false;this._initBody=function(body){this.bodyUsed=this.bodyUsed;this._bodyInit=body;if(!body){this._bodyText='';}else if(typeof body==='string'){this._bodyText=body;}else if(support.blob&&Blob.prototype.isPrototypeOf(body)){this._bodyBlob=body;}else if(support.formData&&FormData.prototype.isPrototypeOf(body)){this._bodyFormData=body;}else if(support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)){this._bodyText=body.toString();}else if(support.arrayBuffer&&support.blob&&isDataView(body)){this._bodyArrayBuffer=bufferClone(body.buffer);this._bodyInit=new Blob([this._bodyArrayBuffer]);}else if(support.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(body)||isArrayBufferView(body))){this._bodyArrayBuffer=bufferClone(body);}else{this._bodyText=body=Object.prototype.toString.call(body);}
if(!this.headers.get('content-type')){if(typeof body==='string'){this.headers.set('content-type','text/plain;charset=UTF-8');}else if(this._bodyBlob&&this._bodyBlob.type){this.headers.set('content-type',this._bodyBlob.type);}else if(support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)){this.headers.set('content-type','application/x-www-form-urlencoded;charset=UTF-8');}}};if(support.blob){this.blob=function(){var rejected=consumed(this);if(rejected){return rejected}
if(this._bodyBlob){return Promise.resolve(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(new Blob([this._bodyArrayBuffer]))}else if(this._bodyFormData){throw new Error('could not read FormData body as blob')}else{return Promise.resolve(new Blob([this._bodyText]))}};this.arrayBuffer=function(){if(this._bodyArrayBuffer){var isConsumed=consumed(this);if(isConsumed){return isConsumed}
if(ArrayBuffer.isView(this._bodyArrayBuffer)){return Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength))}else{return Promise.resolve(this._bodyArrayBuffer)}}else{return this.blob().then(readBlobAsArrayBuffer)}};}
this.text=function(){var rejected=consumed(this);if(rejected){return rejected}
if(this._bodyBlob){return readBlobAsText(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))}else if(this._bodyFormData){throw new Error('could not read FormData body as text')}else{return Promise.resolve(this._bodyText)}};if(support.formData){this.formData=function(){return this.text().then(decode)};}
this.json=function(){return this.text().then(JSON.parse)};return this}
var methods=['DELETE','GET','HEAD','OPTIONS','POST','PUT'];function normalizeMethod(method){var upcased=method.toUpperCase();return methods.indexOf(upcased)>-1?upcased:method}
function Request(input,options){if(!(this instanceof Request)){throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.')}
options=options||{};var body=options.body;if(input instanceof Request){if(input.bodyUsed){throw new TypeError('Already read')}
this.url=input.url;this.credentials=input.credentials;if(!options.headers){this.headers=new Headers(input.headers);}
this.method=input.method;this.mode=input.mode;this.signal=input.signal;if(!body&&input._bodyInit!=null){body=input._bodyInit;input.bodyUsed=true;}}else{this.url=String(input);}
this.credentials=options.credentials||this.credentials||'same-origin';if(options.headers||!this.headers){this.headers=new Headers(options.headers);}
this.method=normalizeMethod(options.method||this.method||'GET');this.mode=options.mode||this.mode||null;this.signal=options.signal||this.signal;this.referrer=null;if((this.method==='GET'||this.method==='HEAD')&&body){throw new TypeError('Body not allowed for GET or HEAD requests')}
this._initBody(body);if(this.method==='GET'||this.method==='HEAD'){if(options.cache==='no-store'||options.cache==='no-cache'){var reParamSearch=/([?&])_=[^&]*/;if(reParamSearch.test(this.url)){this.url=this.url.replace(reParamSearch,'$1_='+new Date().getTime());}else{var reQueryString=/\?/;this.url+=(reQueryString.test(this.url)?'&':'?')+'_='+new Date().getTime();}}}}
Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})};function decode(body){var form=new FormData();body.trim().split('&').forEach(function(bytes){if(bytes){var split=bytes.split('=');var name=split.shift().replace(/\+/g,' ');var value=split.join('=').replace(/\+/g,' ');form.append(decodeURIComponent(name),decodeURIComponent(value));}});return form}
function parseHeaders(rawHeaders){var headers=new Headers();var preProcessedHeaders=rawHeaders.replace(/\r?\n[\t ]+/g,' ');preProcessedHeaders.split('\r').map(function(header){return header.indexOf('\n')===0?header.substr(1,header.length):header}).forEach(function(line){var parts=line.split(':');var key=parts.shift().trim();if(key){var value=parts.join(':').trim();headers.append(key,value);}});return headers}
Body.call(Request.prototype);function Response(bodyInit,options){if(!(this instanceof Response)){throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.')}
if(!options){options={};}
this.type='default';this.status=options.status===undefined?200:options.status;this.ok=this.status>=200&&this.status<300;this.statusText=options.statusText===undefined?'':''+options.statusText;this.headers=new Headers(options.headers);this.url=options.url||'';this._initBody(bodyInit);}
Body.call(Response.prototype);Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})};Response.error=function(){var response=new Response(null,{status:0,statusText:''});response.type='error';return response};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(url,status){if(redirectStatuses.indexOf(status)===-1){throw new RangeError('Invalid status code')}
return new Response(null,{status:status,headers:{location:url}})};exports.DOMException=global.DOMException;try{new exports.DOMException();}catch(err){exports.DOMException=function(message,name){this.message=message;this.name=name;var error=Error(message);this.stack=error.stack;};exports.DOMException.prototype=Object.create(Error.prototype);exports.DOMException.prototype.constructor=exports.DOMException;}
function fetch(input,init){return new Promise(function(resolve,reject){var request=new Request(input,init);if(request.signal&&request.signal.aborted){return reject(new exports.DOMException('Aborted','AbortError'))}
var xhr=new XMLHttpRequest();function abortXhr(){xhr.abort();}
xhr.onload=function(){var options={status:xhr.status,statusText:xhr.statusText,headers:parseHeaders(xhr.getAllResponseHeaders()||'')};options.url='responseURL'in xhr?xhr.responseURL:options.headers.get('X-Request-URL');var body='response'in xhr?xhr.response:xhr.responseText;setTimeout(function(){resolve(new Response(body,options));},0);};xhr.onerror=function(){setTimeout(function(){reject(new TypeError('Network request failed'));},0);};xhr.ontimeout=function(){setTimeout(function(){reject(new TypeError('Network request failed'));},0);};xhr.onabort=function(){setTimeout(function(){reject(new exports.DOMException('Aborted','AbortError'));},0);};function fixUrl(url){try{return url===''&&global.location.href?global.location.href:url}catch(e){return url}}
xhr.open(request.method,fixUrl(request.url),true);if(request.credentials==='include'){xhr.withCredentials=true;}else if(request.credentials==='omit'){xhr.withCredentials=false;}
if('responseType'in xhr){if(support.blob){xhr.responseType='blob';}else if(support.arrayBuffer&&request.headers.get('Content-Type')&&request.headers.get('Content-Type').indexOf('application/octet-stream')!==-1){xhr.responseType='arraybuffer';}}
if(init&&typeof init.headers==='object'&&!(init.headers instanceof Headers)){Object.getOwnPropertyNames(init.headers).forEach(function(name){xhr.setRequestHeader(name,normalizeValue(init.headers[name]));});}else{request.headers.forEach(function(value,name){xhr.setRequestHeader(name,value);});}
if(request.signal){request.signal.addEventListener('abort',abortXhr);xhr.onreadystatechange=function(){if(xhr.readyState===4){request.signal.removeEventListener('abort',abortXhr);}};}
xhr.send(typeof request._bodyInit==='undefined'?null:request._bodyInit);})}
fetch.polyfill=true;if(!global.fetch){global.fetch=fetch;global.Headers=Headers;global.Request=Request;global.Response=Response;}
exports.Headers=Headers;exports.Request=Request;exports.Response=Response;exports.fetch=fetch;Object.defineProperty(exports,'__esModule',{value:true});})));/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */!function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(j(a,c),b)}function f(a,b,c){return Array.isArray(a)?(g(a,c[b],c),!0):!1}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(b,c,d){var e="DEPRECATED METHOD: "+c+"\n"+d+" AT \n";return function(){var c=new Error("get-stack-trace"),d=c&&c.stack?c.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",f=a.console&&(a.console.warn||a.console.log);return f&&f.call(a.console,e,d),b.apply(this,arguments)}}function i(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&la(d,c)}function j(a,b){return function(){return a.apply(b,arguments)}}function k(a,b){return typeof a==oa?a.apply(b?b[0]||d:d,b):a}function l(a,b){return a===d?b:a}function m(a,b,c){g(q(b),function(b){a.addEventListener(b,c,!1)})}function n(a,b,c){g(q(b),function(b){a.removeEventListener(b,c,!1)})}function o(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function p(a,b){return a.indexOf(b)>-1}function q(a){return a.trim().split(/\s+/g)}function r(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function s(a){return Array.prototype.slice.call(a,0)}function t(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];r(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function u(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ma.length;){if(c=ma[g],e=c?c+f:b,e in a)return e;g++}return d}function v(){return ua++}function w(b){var c=b.ownerDocument||b;return c.defaultView||c.parentWindow||a}function x(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){k(a.options.enable,[a])&&c.handler(b)},this.init()}function y(a){var b,c=a.options.inputClass;return new(b=c?c:xa?M:ya?P:wa?R:L)(a,z)}function z(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&Ea&&d-e===0,g=b&(Ga|Ha)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,A(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function A(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=D(b)),e>1&&!c.firstMultiple?c.firstMultiple=D(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=E(d);b.timeStamp=ra(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=I(h,i),b.distance=H(h,i),B(c,b),b.offsetDirection=G(b.deltaX,b.deltaY);var j=F(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=j.x,b.overallVelocityY=j.y,b.overallVelocity=qa(j.x)>qa(j.y)?j.x:j.y,b.scale=g?K(g.pointers,d):1,b.rotation=g?J(g.pointers,d):0,b.maxPointers=c.prevInput?b.pointers.length>c.prevInput.maxPointers?b.pointers.length:c.prevInput.maxPointers:b.pointers.length,C(c,b);var k=a.element;o(b.srcEvent.target,k)&&(k=b.srcEvent.target),b.target=k}function B(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};b.eventType!==Ea&&f.eventType!==Ga||(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function C(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Ha&&(i>Da||h.velocity===d)){var j=b.deltaX-h.deltaX,k=b.deltaY-h.deltaY,l=F(i,j,k);e=l.x,f=l.y,c=qa(l.x)>qa(l.y)?l.x:l.y,g=G(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function D(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:pa(a.pointers[c].clientX),clientY:pa(a.pointers[c].clientY)},c++;return{timeStamp:ra(),pointers:b,center:E(b),deltaX:a.deltaX,deltaY:a.deltaY}}function E(a){var b=a.length;if(1===b)return{x:pa(a[0].clientX),y:pa(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:pa(c/b),y:pa(d/b)}}function F(a,b,c){return{x:b/a||0,y:c/a||0}}function G(a,b){return a===b?Ia:qa(a)>=qa(b)?0>a?Ja:Ka:0>b?La:Ma}function H(a,b,c){c||(c=Qa);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function I(a,b,c){c||(c=Qa);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function J(a,b){return I(b[1],b[0],Ra)+I(a[1],a[0],Ra)}function K(a,b){return H(b[0],b[1],Ra)/H(a[0],a[1],Ra)}function L(){this.evEl=Ta,this.evWin=Ua,this.pressed=!1,x.apply(this,arguments)}function M(){this.evEl=Xa,this.evWin=Ya,x.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function N(){this.evTarget=$a,this.evWin=_a,this.started=!1,x.apply(this,arguments)}function O(a,b){var c=s(a.touches),d=s(a.changedTouches);return b&(Ga|Ha)&&(c=t(c.concat(d),"identifier",!0)),[c,d]}function P(){this.evTarget=bb,this.targetIds={},x.apply(this,arguments)}function Q(a,b){var c=s(a.touches),d=this.targetIds;if(b&(Ea|Fa)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=s(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return o(a.target,i)}),b===Ea)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Ga|Ha)&&delete d[g[e].identifier],e++;return h.length?[t(f.concat(h),"identifier",!0),h]:void 0}function R(){x.apply(this,arguments);var a=j(this.handler,this);this.touch=new P(this.manager,a),this.mouse=new L(this.manager,a),this.primaryTouch=null,this.lastTouches=[]}function S(a,b){a&Ea?(this.primaryTouch=b.changedPointers[0].identifier,T.call(this,b)):a&(Ga|Ha)&&T.call(this,b)}function T(a){var b=a.changedPointers[0];if(b.identifier===this.primaryTouch){var c={x:b.clientX,y:b.clientY};this.lastTouches.push(c);var d=this.lastTouches,e=function(){var a=d.indexOf(c);a>-1&&d.splice(a,1)};setTimeout(e,cb)}}function U(a){for(var b=a.srcEvent.clientX,c=a.srcEvent.clientY,d=0;d<this.lastTouches.length;d++){var e=this.lastTouches[d],f=Math.abs(b-e.x),g=Math.abs(c-e.y);if(db>=f&&db>=g)return!0}return!1}function V(a,b){this.manager=a,this.set(b)}function W(a){if(p(a,jb))return jb;var b=p(a,kb),c=p(a,lb);return b&&c?jb:b||c?b?kb:lb:p(a,ib)?ib:hb}function X(){if(!fb)return!1;var b={},c=a.CSS&&a.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(d){b[d]=c?a.CSS.supports("touch-action",d):!0}),b}function Y(a){this.options=la({},this.defaults,a||{}),this.id=v(),this.manager=null,this.options.enable=l(this.options.enable,!0),this.state=nb,this.simultaneous={},this.requireFail=[]}function Z(a){return a&sb?"cancel":a&qb?"end":a&pb?"move":a&ob?"start":""}function $(a){return a==Ma?"down":a==La?"up":a==Ja?"left":a==Ka?"right":""}function _(a,b){var c=b.manager;return c?c.get(a):a}function aa(){Y.apply(this,arguments)}function ba(){aa.apply(this,arguments),this.pX=null,this.pY=null}function ca(){aa.apply(this,arguments)}function da(){Y.apply(this,arguments),this._timer=null,this._input=null}function ea(){aa.apply(this,arguments)}function fa(){aa.apply(this,arguments)}function ga(){Y.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ha(a,b){return b=b||{},b.recognizers=l(b.recognizers,ha.defaults.preset),new ia(a,b)}function ia(a,b){this.options=la({},ha.defaults,b||{}),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=a,this.input=y(this),this.touchAction=new V(this,this.options.touchAction),ja(this,!0),g(this.options.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function ja(a,b){var c=a.element;if(c.style){var d;g(a.options.cssProps,function(e,f){d=u(c.style,f),b?(a.oldCssProps[d]=c.style[d],c.style[d]=e):c.style[d]=a.oldCssProps[d]||""}),b||(a.oldCssProps={})}}function ka(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var la,ma=["","webkit","Moz","MS","ms","o"],na=b.createElement("div"),oa="function",pa=Math.round,qa=Math.abs,ra=Date.now;la="function"!=typeof Object.assign?function(a){if(a===d||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var e=arguments[c];if(e!==d&&null!==e)for(var f in e)e.hasOwnProperty(f)&&(b[f]=e[f])}return b}:Object.assign;var sa=h(function(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a},"extend","Use `assign`."),ta=h(function(a,b){return sa(a,b,!0)},"merge","Use `assign`."),ua=1,va=/mobile|tablet|ip(ad|hone|od)|android/i,wa="ontouchstart"in a,xa=u(a,"PointerEvent")!==d,ya=wa&&va.test(navigator.userAgent),za="touch",Aa="pen",Ba="mouse",Ca="kinect",Da=25,Ea=1,Fa=2,Ga=4,Ha=8,Ia=1,Ja=2,Ka=4,La=8,Ma=16,Na=Ja|Ka,Oa=La|Ma,Pa=Na|Oa,Qa=["x","y"],Ra=["clientX","clientY"];x.prototype={handler:function(){},init:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(w(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(w(this.element),this.evWin,this.domHandler)}};var Sa={mousedown:Ea,mousemove:Fa,mouseup:Ga},Ta="mousedown",Ua="mousemove mouseup";i(L,x,{handler:function(a){var b=Sa[a.type];b&Ea&&0===a.button&&(this.pressed=!0),b&Fa&&1!==a.which&&(b=Ga),this.pressed&&(b&Ga&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:Ba,srcEvent:a}))}});var Va={pointerdown:Ea,pointermove:Fa,pointerup:Ga,pointercancel:Ha,pointerout:Ha},Wa={2:za,3:Aa,4:Ba,5:Ca},Xa="pointerdown",Ya="pointermove pointerup pointercancel";a.MSPointerEvent&&!a.PointerEvent&&(Xa="MSPointerDown",Ya="MSPointerMove MSPointerUp MSPointerCancel"),i(M,x,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Va[d],f=Wa[a.pointerType]||a.pointerType,g=f==za,h=r(b,a.pointerId,"pointerId");e&Ea&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(Ga|Ha)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Za={touchstart:Ea,touchmove:Fa,touchend:Ga,touchcancel:Ha},$a="touchstart",_a="touchstart touchmove touchend touchcancel";i(N,x,{handler:function(a){var b=Za[a.type];if(b===Ea&&(this.started=!0),this.started){var c=O.call(this,a,b);b&(Ga|Ha)&&c[0].length-c[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:za,srcEvent:a})}}});var ab={touchstart:Ea,touchmove:Fa,touchend:Ga,touchcancel:Ha},bb="touchstart touchmove touchend touchcancel";i(P,x,{handler:function(a){var b=ab[a.type],c=Q.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:za,srcEvent:a})}});var cb=2500,db=25;i(R,x,{handler:function(a,b,c){var d=c.pointerType==za,e=c.pointerType==Ba;if(!(e&&c.sourceCapabilities&&c.sourceCapabilities.firesTouchEvents)){if(d)S.call(this,b,c);else if(e&&U.call(this,c))return;this.callback(a,b,c)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var eb=u(na.style,"touchAction"),fb=eb!==d,gb="compute",hb="auto",ib="manipulation",jb="none",kb="pan-x",lb="pan-y",mb=X();V.prototype={set:function(a){a==gb&&(a=this.compute()),fb&&this.manager.element.style&&mb[a]&&(this.manager.element.style[eb]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){k(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),W(a.join(" "))},preventDefaults:function(a){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=p(d,jb)&&!mb[jb],f=p(d,lb)&&!mb[lb],g=p(d,kb)&&!mb[kb];if(e){var h=1===a.pointers.length,i=a.distance<2,j=a.deltaTime<250;if(h&&i&&j)return}return g&&f?void 0:e||f&&c&Na||g&&c&Oa?this.preventSrc(b):void 0},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var nb=1,ob=2,pb=4,qb=8,rb=qb,sb=16,tb=32;Y.prototype={defaults:{},set:function(a){return la(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=_(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=_(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=_(a,this),-1===r(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=_(a,this);var b=r(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(b,a)}var c=this,d=this.state;qb>d&&b(c.options.event+Z(d)),b(c.options.event),a.additionalEvent&&b(a.additionalEvent),d>=qb&&b(c.options.event+Z(d))},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=tb)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(tb|nb)))return!1;a++}return!0},recognize:function(a){var b=la({},a);return k(this.options.enable,[this,b])?(this.state&(rb|sb|tb)&&(this.state=nb),this.state=this.process(b),void(this.state&(ob|pb|qb|sb)&&this.tryEmit(b))):(this.reset(),void(this.state=tb))},process:function(a){},getTouchAction:function(){},reset:function(){}},i(aa,Y,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(ob|pb),e=this.attrTest(a);return d&&(c&Ha||!e)?b|sb:d||e?c&Ga?b|qb:b&ob?b|pb:ob:tb}}),i(ba,aa,{defaults:{event:"pan",threshold:10,pointers:1,direction:Pa},getTouchAction:function(){var a=this.options.direction,b=[];return a&Na&&b.push(lb),a&Oa&&b.push(kb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Na?(e=0===f?Ia:0>f?Ja:Ka,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ia:0>g?La:Ma,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return aa.prototype.attrTest.call(this,a)&&(this.state&ob||!(this.state&ob)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=$(a.direction);b&&(a.additionalEvent=this.options.event+b),this._super.emit.call(this,a)}}),i(ca,aa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[jb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&ob)},emit:function(a){if(1!==a.scale){var b=a.scale<1?"in":"out";a.additionalEvent=this.options.event+b}this._super.emit.call(this,a)}}),i(da,Y,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[hb]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Ga|Ha)&&!f)this.reset();else if(a.eventType&Ea)this.reset(),this._timer=e(function(){this.state=rb,this.tryEmit()},b.time,this);else if(a.eventType&Ga)return rb;return tb},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===rb&&(a&&a.eventType&Ga?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=ra(),this.manager.emit(this.options.event,this._input)))}}),i(ea,aa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[jb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&ob)}}),i(fa,aa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Na|Oa,pointers:1},getTouchAction:function(){return ba.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Na|Oa)?b=a.overallVelocity:c&Na?b=a.overallVelocityX:c&Oa&&(b=a.overallVelocityY),this._super.attrTest.call(this,a)&&c&a.offsetDirection&&a.distance>this.options.threshold&&a.maxPointers==this.options.pointers&&qa(b)>this.options.velocity&&a.eventType&Ga},emit:function(a){var b=$(a.offsetDirection);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),i(ga,Y,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ib]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&Ea&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Ga)return this.failTimeout();var g=this.pTime?a.timeStamp-this.pTime<b.interval:!0,h=!this.pCenter||H(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=rb,this.tryEmit()},b.interval,this),ob):rb}return tb},failTimeout:function(){return this._timer=e(function(){this.state=tb},this.options.interval,this),tb},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==rb&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ha.VERSION="2.0.7",ha.defaults={domEvents:!1,touchAction:gb,enable:!0,inputTarget:null,inputClass:null,preset:[[ea,{enable:!1}],[ca,{enable:!1},["rotate"]],[fa,{direction:Na}],[ba,{direction:Na},["swipe"]],[ga],[ga,{event:"doubletap",taps:2},["tap"]],[da]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var ub=1,vb=2;ia.prototype={set:function(a){return la(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?vb:ub},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&rb)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===vb||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(ob|pb|qb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof Y)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;if(a=this.get(a)){var b=this.recognizers,c=r(b,a);-1!==c&&(b.splice(c,1),this.touchAction.update())}return this},on:function(a,b){if(a!==d&&b!==d){var c=this.handlers;return g(q(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this}},off:function(a,b){if(a!==d){var c=this.handlers;return g(q(a),function(a){b?c[a]&&c[a].splice(r(c[a],b),1):delete c[a]}),this}},emit:function(a,b){this.options.domEvents&&ka(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&ja(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},la(ha,{INPUT_START:Ea,INPUT_MOVE:Fa,INPUT_END:Ga,INPUT_CANCEL:Ha,STATE_POSSIBLE:nb,STATE_BEGAN:ob,STATE_CHANGED:pb,STATE_ENDED:qb,STATE_RECOGNIZED:rb,STATE_CANCELLED:sb,STATE_FAILED:tb,DIRECTION_NONE:Ia,DIRECTION_LEFT:Ja,DIRECTION_RIGHT:Ka,DIRECTION_UP:La,DIRECTION_DOWN:Ma,DIRECTION_HORIZONTAL:Na,DIRECTION_VERTICAL:Oa,DIRECTION_ALL:Pa,Manager:ia,Input:x,TouchAction:V,TouchInput:P,MouseInput:L,PointerEventInput:M,TouchMouseInput:R,SingleTouchInput:N,Recognizer:Y,AttrRecognizer:aa,Tap:ga,Pan:ba,Swipe:fa,Pinch:ca,Rotate:ea,Press:da,on:m,off:n,each:g,merge:ta,extend:sa,assign:la,inherit:i,bindFn:j,prefixed:u});var wb="undefined"!=typeof a?a:"undefined"!=typeof self?self:{};wb.Hammer=ha,"function"==typeof define&&define.amd?define(function(){return ha}):"undefined"!=typeof module&&module.exports?module.exports=ha:a[c]=ha}(window,document,"Hammer");!function(){"use strict";function n(n,i){for(var e=0;e<i.length;e++){var t=i[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(n,t.key,t)}}function i(n,i,e){return i in n?Object.defineProperty(n,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[i]=e,n}var e=function(){function e(){!function(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"mPlugins",void 0),i(this,"mEvents",void 0),this.mPlugins={},this.mEvents={}}var t,u;return t=e,(u=[{key:"registerPlugin",value:function(n,i){return void 0===this.mPlugins[n]&&(this.mPlugins[n]=i,this[n]=function(){var i;return(i=this.mPlugins)[n].apply(i,arguments)},!0)}},{key:"unregisterPlugin",value:function(n){return void 0!==this.mPlugins[n]&&(delete this.mPlugins[n],delete this[n],!0)}},{key:"subscribe",value:function(n,i){return void 0===this.mEvents[n]&&(this.mEvents[n]=[]),this.mEvents[n].push(i)}},{key:"unsubscribe",value:function(n,i){void 0!==this.mEvents[n]&&(this.mEvents[n][i]=void 0)}},{key:"emit",value:function(n,i){void 0!==this.mEvents[n]&&this.mEvents[n].forEach((function(n){void 0!==n&&setTimeout((function(){n(i)}),0)}))}}])&&n(t.prototype,u),e}();window.expivi=window.expivi||{interact:null};var t=null;window.expivi.interact=function(){return null===t&&(t=new e),t}}();!function(){"use strict";function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=function(){function i(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n(this,"mOptions",void 0),n(this,"mOriginalItem",void 0),n(this,"mDimensions",void 0),n(this,"mDomObserver",void 0),this.mOptions=function(t){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?e(Object(r),!0).forEach((function(e){n(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},t),this.mOriginalItem=this.mOptions.element,this.mDimensions={width:0,height:0};var r=window.MutationObserver||window.WebKitMutationObserver;this.mDomObserver=new r(this.onDomChanged.bind(this)),this.mDomObserver.observe(this.mOriginalItem,{attributes:!1,childList:!0,subtree:!0}),this.update()}var r,o;return r=i,(o=[{key:"destroy",value:function(){this.mDomObserver&&this.mDomObserver.disconnect()}},{key:"update",value:function(){var e=this.mOriginalItem.getBoundingClientRect();this.mDimensions.width=e.width,this.mDimensions.height=e.height}},{key:"onDropped",value:function(e,t){return!!this.isInRect(e,t)}},{key:"onDomChanged",value:function(){this.update()}},{key:"isInRect",value:function(e,t){var n=this.mOriginalItem.getBoundingClientRect(),i=document.body.getBoundingClientRect(),r=n.left-i.left,o=n.top-i.top,s=r+n.width,u=o+n.height;return e>r&&t>o&&e<s&&t<u}},{key:"width",get:function(){return this.mDimensions.width}},{key:"height",get:function(){return this.mDimensions.height}},{key:"element",get:function(){return this.mOptions.element}}])&&t(r.prototype,o),i}();function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,"mOptions",void 0),s(this,"mItems",[]),s(this,"mSubscriptions",[]),s(this,"mListeners",[]),this.mOptions=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({ondropped:function(){}},t);var n=this.parseElements(this.mOptions.droppable);this.mItems=n.map((function(e){return new i({element:e})})),this.registerListeners()}var t,n;return t=e,(n=[{key:"destroy",value:function(){this.unregisterListeners(),this.mItems.splice(0).forEach((function(e){return e.destroy()}))}},{key:"registerListeners",value:function(){var e=this;this.addEventListener({name:"resize",el:document,fn:this.onWindowResize.bind(this),options:!1}),this.mSubscriptions.push(window.expivi.interact().subscribe("draggable:dragend",(function(t){var n=t.position.x,i=t.position.y;e.mItems.forEach((function(r){r.onDropped(n,i)&&e.mOptions.ondropped({type:"droppped",originalSource:t.originalSource,event:t.event,position:{x:n,y:i},clientX:n-window.pageXOffset,clientY:i-window.pageYOffset,width:r.width,height:r.height})}))})))}},{key:"unregisterListeners",value:function(){this.mListeners.splice(0).forEach((function(e){e.el.removeEventListener(e.name,e.fn,e.options)})),this.mSubscriptions.splice(0).forEach((function(e){return window.expivi.interact().unsubscribe("draggable:dragend",e)}))}},{key:"onWindowResize",value:function(e){this.mItems.forEach((function(e){e.update()}))}},{key:"parseElements",value:function(e){if(null==e||null==e)return[];if(e&&e.nodeName)return[e];if("string"==typeof e){for(var t=[],n=document.querySelectorAll(e),i=0;i<n.length;i++)t.push(n[i]);return t}return Array.isArray(e)?e:[]}},{key:"addEventListener",value:function(e){e.el.addEventListener(e.name,e.fn,e.options),this.mListeners.push(e)}}])&&o(t.prototype,n),e}();if(void 0===window.expivi.interact)throw"Implement expivi-interact before dropzone.";window.expivi.interact().registerPlugin("dropzone",(function(e){return new u(e)}))}();(function(){'use strict';var f,g=[];function l(a){g.push(a);1==g.length&&f()}function m(){for(;g.length;)g[0](),g.shift()}f=function(){setTimeout(m)};function n(a){this.a=p;this.b=void 0;this.f=[];var b=this;try{a(function(a){q(b,a)},function(a){r(b,a)})}catch(c){r(b,c)}}var p=2;function t(a){return new n(function(b,c){c(a)})}function u(a){return new n(function(b){b(a)})}function q(a,b){if(a.a==p){if(b==a)throw new TypeError;var c=!1;try{var d=b&&b.then;if(null!=b&&"object"==typeof b&&"function"==typeof d){d.call(b,function(b){c||q(a,b);c=!0},function(b){c||r(a,b);c=!0});return}}catch(e){c||r(a,e);return}a.a=0;a.b=b;v(a)}}
function r(a,b){if(a.a==p){if(b==a)throw new TypeError;a.a=1;a.b=b;v(a)}}function v(a){l(function(){if(a.a!=p)for(;a.f.length;){var b=a.f.shift(),c=b[0],d=b[1],e=b[2],b=b[3];try{0==a.a?"function"==typeof c?e(c.call(void 0,a.b)):e(a.b):1==a.a&&("function"==typeof d?e(d.call(void 0,a.b)):b(a.b))}catch(h){b(h)}}})}n.prototype.g=function(a){return this.c(void 0,a)};n.prototype.c=function(a,b){var c=this;return new n(function(d,e){c.f.push([a,b,d,e]);v(c)})};function w(a){return new n(function(b,c){function d(c){return function(d){h[c]=d;e+=1;e==a.length&&b(h)}}var e=0,h=[];0==a.length&&b(h);for(var k=0;k<a.length;k+=1)u(a[k]).c(d(k),c)})}function x(a){return new n(function(b,c){for(var d=0;d<a.length;d+=1)u(a[d]).c(b,c)})};window.Promise||(window.Promise=n,window.Promise.resolve=u,window.Promise.reject=t,window.Promise.race=x,window.Promise.all=w,window.Promise.prototype.then=n.prototype.c,window.Promise.prototype["catch"]=n.prototype.g);}());(function(){function p(a,c){document.addEventListener?a.addEventListener("scroll",c,!1):a.attachEvent("scroll",c)}function u(a){document.body?a():document.addEventListener?document.addEventListener("DOMContentLoaded",function b(){document.removeEventListener("DOMContentLoaded",b);a()}):document.attachEvent("onreadystatechange",function g(){if("interactive"==document.readyState||"complete"==document.readyState)document.detachEvent("onreadystatechange",g),a()})};function w(a){this.g=document.createElement("div");this.g.setAttribute("aria-hidden","true");this.g.appendChild(document.createTextNode(a));this.h=document.createElement("span");this.i=document.createElement("span");this.m=document.createElement("span");this.j=document.createElement("span");this.l=-1;this.h.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;";this.i.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;";this.j.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;";this.m.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;";this.h.appendChild(this.m);this.i.appendChild(this.j);this.g.appendChild(this.h);this.g.appendChild(this.i)}
function x(a,c){a.g.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+c+";"}function B(a){var c=a.g.offsetWidth,b=c+100;a.j.style.width=b+"px";a.i.scrollLeft=b;a.h.scrollLeft=a.h.scrollWidth+100;return a.l!==c?(a.l=c,!0):!1}function C(a,c){function b(){var e=g;B(e)&&null!==e.g.parentNode&&c(e.l)}var g=a;p(a.h,b);p(a.i,b);B(a)};function D(a,c,b){c=c||{};b=b||window;this.family=a;this.style=c.style||"normal";this.weight=c.weight||"normal";this.stretch=c.stretch||"normal";this.context=b}var E=null,F=null,G=null,H=null;function I(a){null===F&&(M(a)&&/Apple/.test(window.navigator.vendor)?(a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent),F=!!a&&603>parseInt(a[1],10)):F=!1);return F}function M(a){null===H&&(H=!!a.document.fonts);return H}
function N(a,c){var b=a.style,g=a.weight;if(null===G){var e=document.createElement("div");try{e.style.font="condensed 100px sans-serif"}catch(q){}G=""!==e.style.font}return[b,g,G?a.stretch:"","100px",c].join(" ")}
D.prototype.load=function(a,c){var b=this,g=a||"BESbswy",e=0,q=c||3E3,J=(new Date).getTime();return new Promise(function(K,L){if(M(b.context)&&!I(b.context)){var O=new Promise(function(r,t){function h(){(new Date).getTime()-J>=q?t(Error(""+q+"ms timeout exceeded")):b.context.document.fonts.load(N(b,'"'+b.family+'"'),g).then(function(n){1<=n.length?r():setTimeout(h,25)},t)}h()}),P=new Promise(function(r,t){e=setTimeout(function(){t(Error(""+q+"ms timeout exceeded"))},q)});Promise.race([P,O]).then(function(){clearTimeout(e);K(b)},L)}else u(function(){function r(){var d;if(d=-1!=k&&-1!=l||-1!=k&&-1!=m||-1!=l&&-1!=m)(d=k!=l&&k!=m&&l!=m)||(null===E&&(d=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),E=!!d&&(536>parseInt(d[1],10)||536===parseInt(d[1],10)&&11>=parseInt(d[2],10))),d=E&&(k==y&&l==y&&m==y||k==z&&l==z&&m==z||k==A&&l==A&&m==A)),d=!d;d&&(null!==f.parentNode&&f.parentNode.removeChild(f),clearTimeout(e),K(b))}function t(){if((new Date).getTime()-J>=q)null!==f.parentNode&&f.parentNode.removeChild(f),L(Error(""+q+"ms timeout exceeded"));else{var d=b.context.document.hidden;if(!0===d||void 0===d)k=h.g.offsetWidth,l=n.g.offsetWidth,m=v.g.offsetWidth,r();e=setTimeout(t,50)}}var h=new w(g),n=new w(g),v=new w(g),k=-1,l=-1,m=-1,y=-1,z=-1,A=-1,f=document.createElement("div");f.dir="ltr";x(h,N(b,"sans-serif"));x(n,N(b,"serif"));x(v,N(b,"monospace"));f.appendChild(h.g);f.appendChild(n.g);f.appendChild(v.g);b.context.document.body.appendChild(f);y=h.g.offsetWidth;z=n.g.offsetWidth;A=v.g.offsetWidth;t();C(h,function(d){k=d;r()});x(h,N(b,'"'+b.family+'",sans-serif'));C(n,function(d){l=d;r()});x(n,N(b,'"'+b.family+'",serif'));C(v,function(d){m=d;r()});x(v,N(b,'"'+b.family+'",monospace'))})})};"object"===typeof module?module.exports=D:(window.FontFaceObserver=D,window.FontFaceObserver.prototype.load=D.prototype.load);}());/*!For license information please see index.js.LICENSE.txt*/(function(){var __webpack_modules__={3722:function(e,t,n){"use strict";n.d(t,{H:function(){return p}});n(1539),n(1299),n(2419);var r=n(5671),i=n(3144),a=n(7326),o=n(136),s=n(2963),u=n(1120),c=n(3),l=n(5845),h=n(5604);function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var p=function(e){(0,o.Z)(n,e);var t=f(n);function n(e){var i;return(0,r.Z)(this,n),i=t.call(this),(0,c.Z)((0,a.Z)(i),"mComponentName",void 0),(0,c.Z)((0,a.Z)(i),"mParentObject",null),(0,c.Z)((0,a.Z)(i),"mDisposed",!1),i.mComponentName=e,i.OnCreate(),i}return(0,i.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getComponentName",value:function(){return this.mComponentName}},{key:"getParentObject",value:function(){return this.mParentObject}},{key:"_setObject",value:function(e){this.mParentObject=e}},{key:"OnCreate",value:function(){}},{key:"OnAttached",value:function(){}},{key:"OnDetached",value:function(){}},{key:"OnDestroy",value:function(){}},{key:"dispose",value:function(){this.mDisposed||(this.OnDestroy(),this.mDisposed=!0)}},{key:"isDisposed",value:function(){return this.mDisposed}}]),n}(h.l);(0,c.Z)(p,"TypeRTTI",new l.r("Component",h.l.TypeRTTI))},666:function(e,t,n){"use strict";n.d(t,{L:function(){return d}});n(1299),n(2419);var r=n(5671),i=n(3144),a=n(7326),o=n(136),s=n(2963),u=n(1120),c=n(3),l=(n(2222),n(1539),n(5581),n(2490),n(4514),n(4747),n(7658),n(4553),n(561),n(9826),n(1672),n(9461),n(7327),n(8449),n(9849),n(5845)),h=n(5604),f=n(3722),p=n(5454);function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var d=function(e){(0,o.Z)(n,e);var t=m(n);function n(){var e;(0,r.Z)(this,n);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return e=t.call.apply(t,[this].concat(o)),(0,c.Z)((0,a.Z)(e),"mComponents",[]),e}return(0,i.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"catchUnhandledMessage",value:function(e){this.dispatchMessageToComponents(e)}},{key:"dispatchMessageToComponents",value:function(e){this.mComponents.forEach((function(t){t.dispatchMessage(e)}))}},{key:"addComponent",value:function(e){return e.getParentObject()?(p.qL.error("Component is already assigned"),!1):e.isDisposed()?(p.qL.error("Cannot attach disposed component."),!1):e.isAttachable(this)?this.getComponent(e.getComponentName())?(p.qL.error("Object already contains component:",e.getComponentName()),!1):(e._setObject(this),this.mComponents.push(e),e.OnAttached(),!0):(p.qL.error("can not attach component ",e.getType().getTypeName()," to object ",this.getType().getTypeName()),!1)}},{key:"removeComponent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.mComponents.findIndex((function(t){return t.getComponentName()===e}));if(n>=0){var r=this.mComponents[n];return r.OnDetached(),r._setObject(null),this.mComponents.splice(n,1),t&&r.dispose(),!0}return!1}},{key:"removeComponents",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.getComponents(e).forEach((function(e){t.removeComponent(e.getComponentName(),n)}))}},{key:"removeAllComponents",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.removeComponents(f.H.TypeRTTI,e)}},{key:"getComponent",value:function(e){return this.mComponents.find((function(t){return t.getComponentName()===e}))}},{key:"getComponents",value:function(e){return this.mComponents.filter((function(t){return!e||t.isDerivedTypeOf(e)}))}}]),n}(h.l);(0,c.Z)(d,"TypeRTTI",new l.r("BaseObject",h.l.TypeRTTI))},5604:function(e,t,n){"use strict";n.d(t,{l:function(){return m}});n(1539),n(1299),n(2419);var r=n(5671),i=n(3144),a=n(7326),o=n(136),s=n(2963),u=n(1120),c=n(3),l=(n(2222),n(5845)),h=n(9291),f=n(5454);function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var m=function(e){(0,o.Z)(n,e);var t=p(n);function n(){var e;(0,r.Z)(this,n);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return e=t.call.apply(t,[this].concat(o)),(0,c.Z)((0,a.Z)(e),"mMessageHandlers",{}),e}return(0,i.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"registerMessageHandler",value:function(e,t){this.handlesMessageType(e)?f.qL.error("Failed to re-register message handler:",e.getTypeName()):this.mMessageHandlers[e.getTypeName()]=t}},{key:"unregisterFromAllMessages",value:function(){this.mMessageHandlers={}}},{key:"unregisterMessageHandler",value:function(e){this.handlesMessageType(e)&&delete this.mMessageHandlers[e.getTypeName()]}},{key:"dispatchMessage",value:function(e){e.isDismissed()||(this.handlesMessageType(e.getType())?(0,this.mMessageHandlers[e.getType().getTypeName()])(e):this.catchUnhandledMessage(e))}},{key:"catchUnhandledMessage",value:function(e){}},{key:"handlesMessageType",value:function(e){return e.getTypeName()in this.mMessageHandlers}}]),n}(h.e);(0,c.Z)(m,"TypeRTTI",new l.r("BaseMessageHandler",h.e.TypeRTTI))},9291:function(e,t,n){"use strict";n.d(t,{e:function(){return l}});var r=n(5671),i=n(3144),a=n(3),o=(n(2222),n(5845)),s=n(1765),u=n(9539),c=n(5454),l=function(){function e(){(0,r.Z)(this,e),(0,a.Z)(this,"mObjectId",void 0),(0,a.Z)(this,"mObjectUUID",void 0),this.mObjectId=++e.ObjectIdCount,this.mObjectUUID=s.F.guid()}return(0,i.Z)(e,[{key:"getType",value:function(){return e.TypeRTTI}},{key:"id",get:function(){return this.getObjectId()}},{key:"uuid",get:function(){return this.mObjectUUID}},{key:"getObjectId",value:function(){return this.mObjectId}},{key:"getObjectUUID",value:function(){return this.mObjectUUID}},{key:"_setObjectUUID",value:function(e){!(0,u.isNullOrUndefined)(e)&&"null"!==e&&e.length>16?this.mObjectUUID=e:c.qL.warn("tying to set object '".concat(this.mObjectId,"' uuid to invalid value: ").concat(e))}},{key:"isTypeName",value:function(e){return this.getType().isTypeName(e)}},{key:"isDerivedOfTypeName",value:function(e){return this.getType().isDerivedOfTypeName(e)}},{key:"isTypeOf",value:function(e){return this.getType().isTypeOf(e)}},{key:"isDerivedTypeOf",value:function(e){return this.getType().isDerivedTypeOf(e)}}]),e}();(0,a.Z)(l,"TypeRTTI",new o.r("RttiObject")),(0,a.Z)(l,"ObjectIdCount",0)},5845:function(e,t,n){"use strict";n.d(t,{r:function(){return o}});var r=n(5671),i=n(3144),a=n(3),o=function(){function e(t,n){(0,r.Z)(this,e),(0,a.Z)(this,"mTypeName",void 0),(0,a.Z)(this,"mParentClass",void 0),this.mTypeName=t,this.mParentClass=n}return(0,i.Z)(e,[{key:"getTypeName",value:function(){return this.mTypeName}},{key:"isTypeName",value:function(e){return e===this.mTypeName}},{key:"isDerivedOfTypeName",value:function(e){return!!this.isTypeName(e)||void 0!==this.getParent()&&this.getParent().isDerivedOfTypeName(e)}},{key:"isTypeOf",value:function(e){return this.mTypeName===e.getTypeName()}},{key:"isDerivedTypeOf",value:function(e){return!!this.isTypeOf(e)||void 0!==this.getParent()&&this.getParent().isDerivedTypeOf(e)}},{key:"getParent",value:function(){return this.mParentClass}}]),e}()},430:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{$:function(){return ActionArithmeticOperationProcess}});var core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1539),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es_reflect_to_string_tag_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1299),core_js_modules_es_reflect_to_string_tag_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_reflect_to_string_tag_js__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_reflect_construct_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2419),core_js_modules_es_reflect_construct_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_reflect_construct_js__WEBPACK_IMPORTED_MODULE_2__),_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(5671),_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(3144),_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(136),_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(2963),_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(1120),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4916),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5306),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_regexp_test_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(7601),core_js_modules_es_regexp_test_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_regexp_test_js__WEBPACK_IMPORTED_MODULE_5__),_core_process_object__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(251),_core_process_event__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(3280),util__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(9539),util__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(util__WEBPACK_IMPORTED_MODULE_9__),_utils_variables_class__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(3909),_services_syslog_service__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(5454);function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=(0,_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_6__.Z)(e);if(t){var i=(0,_babel_runtime_helpers_getPrototypeOf__WEBPACK_IMPORTED_MODULE_6__.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,_babel_runtime_helpers_possibleConstructorReturn__WEBPACK_IMPORTED_MODULE_7__.Z)(this,n)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ActionArithmeticOperationProcess=function(_ProcessObject){(0,_babel_runtime_helpers_inherits__WEBPACK_IMPORTED_MODULE_12__.Z)(ActionArithmeticOperationProcess,_ProcessObject);var _super=_createSuper(ActionArithmeticOperationProcess);function ActionArithmeticOperationProcess(){return(0,_babel_runtime_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_13__.Z)(this,ActionArithmeticOperationProcess),_super.apply(this,arguments)}return(0,_babel_runtime_helpers_createClass__WEBPACK_IMPORTED_MODULE_14__.Z)(ActionArithmeticOperationProcess,[{key:"resolveEventType",value:function(e){return e.data.attribute_type||e.type}},{key:"onHandleInPort",value:function onHandleInPort(aEvent){_services_syslog_service__WEBPACK_IMPORTED_MODULE_11__.qL.print("Rule: Handle arithmetic operation");var arithmeticOperation=null;(0,util__WEBPACK_IMPORTED_MODULE_9__.isNullOrUndefined)(this.getMetadata().arithmetic_operation)||(arithmeticOperation=this.getMetadata().arithmetic_operation);var outPortName="fail",inputValue=null;switch(this.resolveEventType(aEvent)){case"operable_numbers_input":case"text_to_image":case"text_input":inputValue=aEvent.data.attribute_value_name;break;default:inputValue=aEvent.data.value}if(null!==arithmeticOperation&&_utils_variables_class__WEBPACK_IMPORTED_MODULE_10__.Ft.isNumeric(inputValue))for(;arithmeticOperation.indexOf("{value}")>=0;)arithmeticOperation=arithmeticOperation.replace("{value}",inputValue);if(null!==arithmeticOperation&&/^([\d\(\)\+\-\.\*><=/%!\:+\s\?])+$/.test(arithmeticOperation))try{inputValue=eval(arithmeticOperation),outPortName="result"}catch(e){_services_syslog_service__WEBPACK_IMPORTED_MODULE_11__.qL.error("Unable to process arithmetic rule.",e),outPortName="fail"}return[new _core_process_event__WEBPACK_IMPORTED_MODULE_15__.q("input",{value:inputValue},this,outPortName)]}}]),ActionArithmeticOperationProcess}(_core_process_object__WEBPACK_IMPORTED_MODULE_8__.s)},32:function(e,t,n){"use strict";n.d(t,{C:function(){return o}});var r=n(3144),i=n(5671),a=n(3),o=(0,r.Z)((function e(t,n,r,o){(0,i.Z)(this,e),(0,a.Z)(this,"client",void 0),(0,a.Z)(this,"outPort",void 0),(0,a.Z)(this,"target",void 0),(0,a.Z)(this,"inPort",void 0),this.client=t,this.outPort=n,this.target=r,this.inPort=o}))},3280:function(e,t,n){"use strict";n.d(t,{q:function(){return o}});var r=n(3144),i=n(5671),a=n(3),o=(0,r.Z)((function e(t,n,r,o,s,u){(0,i.Z)(this,e),(0,a.Z)(this,"type",void 0),(0,a.Z)(this,"data",void 0),(0,a.Z)(this,"client",void 0),(0,a.Z)(this,"outPort",void 0),(0,a.Z)(this,"target",void 0),(0,a.Z)(this,"inPort",void 0),this.type=t,this.data=n,this.client=r,this.outPort=o,this.target=s,this.inPort=u}))},251:function(e,t,n){"use strict";n.d(t,{s:function(){return d}});n(1299),n(2419);var r=n(5671),i=n(3144),a=n(7326),o=n(136),s=n(2963),u=n(1120),c=n(3),l=(n(7658),n(4553),n(561),n(7941),n(1249),n(7640),n(9924),n(1539),n(8674),n(5581),n(2490),n(4514),n(4747),n(32)),h=n(3280),f=n(666),p=n(5845);function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.Z)(e);if(t){var i=(0,u.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var d=function(e){(0,o.Z)(n,e);var t=m(n);function n(e,i,o){var s;return(0,r.Z)(this,n),s=t.call(this),(0,c.Z)((0,a.Z)(s),"mProcessManager",void 0),(0,c.Z)((0,a.Z)(s),"mPid",void 0),(0,c.Z)((0,a.Z)(s),"mMeta",void 0),(0,c.Z)((0,a.Z)(s),"mInPorts",{}),(0,c.Z)((0,a.Z)(s),"mOutPorts",{}),s.mPid=e,s.mMeta=o,s.mProcessManager=i,s}return(0,i.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getPid",value:function(){return this.mPid}},{key:"getMetadata",value:function(){return this.mMeta}},{key:"getProcessManager",value:function(){return this.mProcessManager}},{key:"attachInPort",value:function(e,t,n){return this.mInPorts[e]||(this.mInPorts[e]=new Array),this.mInPorts[e].push(new l.C(t,n,this,e)),this.mInPorts[e].length-1}},{key:"detachInPort",value:function(e,t,n){if(!this.mInPorts[e])return null;var r=this.mInPorts[e].findIndex((function(e){return e.client.getObjectId()===t.getObjectId()&&n===e.outPort}));return r>=0?this.detachInPortAtIndex(e,r):null}},{key:"detachInPortAtIndex",value:function(e,t){if(!this.mInPorts[e])return null;var n=this.mInPorts[e].splice(t,1);return n.length>0?n[0].client:null}},{key:"attachOutPort",value:function(e,t,n){return this.mOutPorts[e]||(this.mOutPorts[e]=new Array),this.mOutPorts[e].push(new l.C(this,e,t,n)),this.mOutPorts[e].length-1}},{key:"detachOutPort",value:function(e,t,n){if(!this.mOutPorts[e])return null;var r=this.mOutPorts[e].findIndex((function(e){return e.target.getObjectId()===t.getObjectId()&&n===e.inPort}));return r>=0?this.detachOutPortAtIndex(e,r):null}},{key:"detachOutPortAtIndex",value:function(e,t){if(!this.mOutPorts[e])return null;var n=this.mOutPorts[e].splice(t,1);return n.length>0?n[0].target:null}},{key:"getInPorts",value:function(){return Object.keys(this.mInPorts)}},{key:"getInPortProcesses",value:function(e){return this.getInConnections(e).map((function(e){return e.client}))}},{key:"getInConnections",value:function(e){return this.mInPorts[e]?this.mInPorts[e]:[]}},{key:"getOutPorts",value:function(){return Object.keys(this.mOutPorts)}},{key:"getOutPortProcesses",value:function(e){return this.getOutPortConnections(e).map((function(e){return e.target}))}},{key:"getOutPortConnections",value:function(e){return this.mOutPorts[e]?this.mOutPorts[e]:[]}},{key:"feedInPort",value:function(e){var t=this;Promise.resolve(this.onHandleInPort(e)).then((function(e){e.forEach((function(e){t.getOutPortConnections(e.outPort).forEach((function(t){t.target.feedInPort(new h.q(e.type,e.data,e.client,e.outPort,t.target,t.inPort))}))}))}),(function(){}))}},{key:"onInit",value:function(){}},{key:"onDestroy",value:function(){}}]),n}(f.L);(0,c.Z)(d,"TypeRTTI",new p.r("ProcessObject",f.L.TypeRTTI))},7867:function(e,t,n){"use strict";n.d(t,{E:function(){return m}});var r,i,a,o,s,u,c,l=n(5671),h=n(3144),f=(n(4916),n(5306),n(2222),n(9539)),p=(n(9653),{client_id:Number(null!==null?null:0),client_secret:(null,null),production:!0,environment:null!==(r="production")?r:"production",maxBunchSize:500,searchBunchSize:10,stripeKey:(null,null),kioskUrl:"kiosk_yu9se",protocol:null!==(i="https://")?i:"https://",api:null!==(a="https://expivi.net")?a:"https://expivi.net",admin:null!==(o="https://admin.expivi.net")?o:"https://admin.expivi.net",cache:null!==(s="https://cache.expivi.net")?s:"https://cache.expivi.net",storage:null!==(u="https://data.expivi.net")?u:"https://data.expivi.net"});!function(e){e.Production="production",e.Staging="staging",e.Local="local"}(c||(c={}));var m=function(){function e(){(0,l.Z)(this,e)}return(0,h.Z)(e,null,[{key:"productionBuild",get:function(){return p.production}},{key:"environment",get:function(){return p.environment}},{key:"protocol",get:function(){return p.protocol}},{key:"backendURL",get:function(){return p.api}},{key:"serverAddress",get:function(){return p.admin}},{key:"cacheAddress",get:function(){return p.cache}},{key:"spacesAddress",get:function(){return p.storage}},{key:"apiUrl",get:function(){return"".concat(e.backendURL,"/api/")}},{key:"authUrl",get:function(){return"".concat(e.backendURL,"/oauth/token")}},{key:"kioskAuthUrl",get:function(){return"".concat(e.backendURL,"/kiosk/login")}},{key:"storageUrl",get:function(){return"".concat(e.serverAddress,"/storage/")}},{key:"assetsUrl",get:function(){return"local"===p.environment?"/assets/":"".concat(e.serverAddress,"/assets/")}},{key:"spacesUrl",get:function(){return"".concat(e.spacesAddress,"/")}},{key:"cacheUrl",get:function(){return"".concat(e.cacheAddress,"/")}},{key:"makeApiRoute",value:function(t){return e.apiUrl+((0,f.isUndefined)(t)?"":t)}},{key:"makeTeamRoute",value:function(t,n){var r=e.backendURL.replace(/https?:\/\/((www|master)\.)*/gi,".");return"".concat(e.protocol).concat(t).concat(r).concat(n)}}]),e}()},5454:function(e,t,n){"use strict";n.d(t,{qL:function(){return u}});var r=n(7867),i=Function.prototype.bind?Function.prototype.bind.call(console.log,console):function(){Function.prototype.apply.call(console.debug,console,arguments)},a=r.E.productionBuild?function(){}:Function.prototype.bind?Function.prototype.bind.call(console.log,console):function(){Function.prototype.apply.call(console.log,console,arguments)},o=r.E.productionBuild?function(){}:Function.prototype.bind?Function.prototype.bind.call(console.warn,console):function(){Function.prototype.apply.call(console.warn,console,arguments)},s=Function.prototype.bind?Function.prototype.bind.call(console.warn,console):function(){Function.prototype.apply.call(console.warn,console,arguments)},u={info:i,print:a,warn:o,error:s}},1765:function(e,t,n){"use strict";n.d(t,{F:function(){return u}});var r=n(5671),i=n(3144),a=(n(1539),n(9714),n(4916),n(5306),n(9653),n(6992),n(2472),n(8675),n(2990),n(8927),n(3105),n(5035),n(4345),n(7174),n(3408),n(2958),n(2846),n(4731),n(7209),n(6319),n(8867),n(7789),n(3739),n(9368),n(4483),n(2056),n(3462),n(678),n(7462),n(3824),n(5021),n(2974),n(5016),n(8922),n(5835),n(3767),n(8585),n(8970),n(4444),n(8696),n(7601),n(9539)),o=n(4069),s=window.crypto||window.msCrypto,u=function(){function e(){(0,r.Z)(this,e)}return(0,i.Z)(e,null,[{key:"guid",value:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},{key:"uuidV4",value:function(){return s?"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(function(e){return(Number(e)^s.getRandomValues(new Uint8Array(1))[0]&15>>Number(e)/4).toString(16)})):"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}},{key:"isUUID",value:function(e){return!(0,a.isNullOrUndefined)(e)&&/(.*)-(.*)-(.*)/.test(e)}},{key:"Md5",value:function(e){return o.V.hashStr(e).toString()}},{key:"checksum",value:function(e){var t,n=0;if(0===e.length)return n;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n}},{key:"encrypt",value:function(e,t){for(var n="",r=0;r<e.length;r++){var i=(e.charCodeAt(r)^t.charCodeAt(r%t.length)).toString(16);i.length<2&&(i="0"+i),n+=i}return n}},{key:"decrypt",value:function(e,t){for(var n="",r=0;r<e.length;r+=2){var i=e.substring(r,r+2),a=parseInt(i,16),o=t.charCodeAt(r/2%t.length);n+=String.fromCharCode(a^o)}return n}}]),e}()},3909:function(e,t,n){"use strict";n.d(t,{$p:function(){return k},B_:function(){return s},Dc:function(){return _},Ee:function(){return v},Ft:function(){return x},HD:function(){return c},HH:function(){return l},HW:function(){return g},NT:function(){return b},a6:function(){return p},fk:function(){return f},ii:function(){return M},kE:function(){return o},le:function(){return m},oA:function(){return u},sK:function(){return y}});var r=n(3),i=n(1002),a=(n(6992),n(1539),n(8783),n(3948),n(285),n(1637),n(1703),n(9653),n(1249),n(7640),n(9924),n(5581),n(2490),n(4514),n(4747),n(7941),n(4916),n(5306),n(3210),n(6699),n(2023),n(4723),n(4048),n(9601),n(9714),n(3112),n(2222),n(9600),n(561),n(7601),n(7042),n(1765));function o(e){return null!==e&&!isNaN(parseFloat(e))&&isFinite(e)}function s(e){for(var t="",n=!1,r=0;r<e.length;r++)"_"!==e.charAt(r)?(t+=n?e.charAt(r).toUpperCase():e.charAt(r),n=!1):n=!0;return t}function u(e){return!0===e||"1"==e||"true"===e}function c(e){return e&&"string"==typeof e}function l(e){return"string"==typeof e&&e.length>0}function h(e){if(!e)return!1;try{if("data:"===new window.URL(e).protocol)throw new Error("Base64 url")}catch(e){return!1}return!0}function f(e){if(null!=e){var t=parseInt("".concat(e),10);return isNaN(t)?void 0:t}}function p(e){if(null!=e){var t=parseFloat("".concat(e));return isNaN(t)?void 0:t}}function m(e){return null==e}function d(e){return e&&"object"===(0,i.Z)(e)&&!Array.isArray(e)}function v(e,t){var n=Object.assign({},e);return d(e)&&d(t)&&Object.keys(t).forEach((function(i){d(t[i])&&i in e?n[i]=v(e[i],t[i]):Object.assign(n,(0,r.Z)({},i,t[i]))})),n}function y(e,t){return function e(t,n){var r=t[n.shift()];return n.length?e(r||{},n):r}(e,t.split("."))}function g(e){var t=e.split(".");return 1===t.length?t.join(""):t.splice(0,t.length-1).join(".")}function b(e){return e.includes(".")}function M(e){var t=e.split(".");return t[t.length-1]}function k(e,t,n){!function e(t,n,r){var i=n.shift();if(n.length)return t[i]=t[i]||{},void e(t[i],n,r);t[i]=r}(e,t.split("."),n)}function _(e){if(x.isValidURL(e))try{var t=new window.URL(e);return/\.(svg)$/gm.test(t.pathname)}catch(e){return!1}return e.slice(0,19).includes("image/svg")}var x={isNumeric:o,lowerCaseString:function(e){return null===e?null:void 0===e?e:e.toLowerCase()},convertSnakeToCamel:s,isTrue:u,isString:c,isNonEmptyString:l,isValidURL:h,isBase64:function(e){if(!e)return!1;try{if("data:"===new window.URL(e).protocol)return!0}catch(e){return!1}return!1},makeUrlUnique:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"uhash";if(!l(e)||!h(e))return e;var n=new window.URL(e);return n.searchParams.set(t,"".concat(Date.now())),n.href},isArray:function(e){return e&&"[object Array]"===Object.prototype.toString.call(e)},deepCloneJSON:function e(t){if("object"!==(0,i.Z)(t)||null===t)return t;if(t instanceof Number)return Number(t);if(t instanceof Boolean)return Boolean(t);if(t instanceof String)return String(t);if(Array.isArray(t))return t.map((function(t){return e(t)}));var n={};return Object.keys(t).forEach((function(r){n[r]=e(t[r])})),n},stringToDate:function(e){if(!isNaN(Date.parse(e)))return new Date(e);var t=e.trim().replace(/[/\\]/g,"-");return t.length>10&&(t.includes("T")||(t=t.replace(/\s/g,"T")),t.includes("+")||t.match(/T.*Z$/g)||(t+="Z")),new Date(t)},resolveInt:f,resolveFloat:p,resolveUuid:function(e){if(null!=e)return a.F.isUUID("".concat(e))?String(e):void 0},resolveUuidOrId:function(e){if(null!=e){if("string"==typeof e&&a.F.isUUID(e))return e;var t=parseInt("".concat(e),10);return Number.isNaN(t)?void 0:t}},isNullOrUndefined:m,isObject:d,mergeDeep:v,dateToString:function(e){if(e){var t=e.getFullYear().toString(),n=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0"),i=e.getHours().toString().padStart(2,"0"),a=e.getMinutes().toString().padStart(2,"0");return"".concat(t,"-").concat(n,"-").concat(r," ").concat(i,":").concat(a,":00")}},getFlatKeyValue:y,setFlatKeyValue:k,isSvg:_}},1924:function(e,t,n){"use strict";var r=n(210),i=n(5559),a=i(r("String.prototype.indexOf"));e.exports=function(e,t){var n=r(e,!!t);return"function"==typeof n&&a(e,".prototype.")>-1?i(n):n}},5559:function(e,t,n){"use strict";var r=n(8612),i=n(210),a=i("%Function.prototype.apply%"),o=i("%Function.prototype.call%"),s=i("%Reflect.apply%",!0)||r.call(o,a),u=i("%Object.getOwnPropertyDescriptor%",!0),c=i("%Object.defineProperty%",!0),l=i("%Math.max%");if(c)try{c({},"a",{value:1})}catch(e){c=null}e.exports=function(e){var t=s(r,o,arguments);u&&c&&(u(t,"length").configurable&&c(t,"length",{value:1+l(0,e.length-(arguments.length-1))}));return t};var h=function(){return s(r,a,arguments)};c?c(e.exports,"apply",{value:h}):e.exports.apply=h},9662:function(e,t,n){var r=n(614),i=n(6330),a=TypeError;e.exports=function(e){if(r(e))return e;throw a(i(e)+" is not a function")}},9483:function(e,t,n){var r=n(4411),i=n(6330),a=TypeError;e.exports=function(e){if(r(e))return e;throw a(i(e)+" is not a constructor")}},27:function(e,t,n){var r=n(5706).has;e.exports=function(e){return r(e),e}},6077:function(e,t,n){var r=n(614),i=String,a=TypeError;e.exports=function(e){if("object"==typeof e||r(e))return e;throw a("Can't set "+i(e)+" as a prototype")}},9257:function(e,t,n){var r=n(953).has;e.exports=function(e){return r(e),e}},1223:function(e,t,n){var r=n(5112),i=n(30),a=n(3070).f,o=r("unscopables"),s=Array.prototype;null==s[o]&&a(s,o,{configurable:!0,value:i(null)}),e.exports=function(e){s[o][e]=!0}},1530:function(e,t,n){"use strict";var r=n(8710).charAt;e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},5787:function(e,t,n){var r=n(7976),i=TypeError;e.exports=function(e,t){if(r(t,e))return e;throw i("Incorrect invocation")}},9670:function(e,t,n){var r=n(111),i=String,a=TypeError;e.exports=function(e){if(r(e))return e;throw a(i(e)+" is not an object")}},3013:function(e){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7556:function(e,t,n){var r=n(7293);e.exports=r((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}))},260:function(e,t,n){"use strict";var r,i,a,o=n(3013),s=n(9781),u=n(7854),c=n(614),l=n(111),h=n(2597),f=n(648),p=n(6330),m=n(8880),d=n(8052),v=n(7045),y=n(7976),g=n(9518),b=n(7674),M=n(5112),k=n(9711),_=n(9909),x=_.enforce,T=_.get,w=u.Int8Array,R=w&&w.prototype,Z=u.Uint8ClampedArray,S=Z&&Z.prototype,C=w&&g(w),I=R&&g(R),E=Object.prototype,A=u.TypeError,O=M("toStringTag"),D=k("TYPED_ARRAY_TAG"),P="TypedArrayConstructor",B=o&&!!b&&"Opera"!==f(u.opera),F=!1,L={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},N={BigInt64Array:8,BigUint64Array:8},j=function(e){var t=g(e);if(l(t)){var n=T(t);return n&&h(n,P)?n[P]:j(t)}},z=function(e){if(!l(e))return!1;var t=f(e);return h(L,t)||h(N,t)};for(r in L)(a=(i=u[r])&&i.prototype)?x(a)[P]=i:B=!1;for(r in N)(a=(i=u[r])&&i.prototype)&&(x(a)[P]=i);if((!B||!c(C)||C===Function.prototype)&&(C=function(){throw A("Incorrect invocation")},B))for(r in L)u[r]&&b(u[r],C);if((!B||!I||I===E)&&(I=C.prototype,B))for(r in L)u[r]&&b(u[r].prototype,I);if(B&&g(S)!==I&&b(S,I),s&&!h(I,O))for(r in F=!0,v(I,O,{configurable:!0,get:function(){return l(this)?this[D]:void 0}}),L)u[r]&&m(u[r],D,r);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:B,TYPED_ARRAY_TAG:F&&D,aTypedArray:function(e){if(z(e))return e;throw A("Target is not a typed array")},aTypedArrayConstructor:function(e){if(c(e)&&(!b||y(C,e)))return e;throw A(p(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,n,r){if(s){if(n)for(var i in L){var a=u[i];if(a&&h(a.prototype,e))try{delete a.prototype[e]}catch(n){try{a.prototype[e]=t}catch(e){}}}I[e]&&!n||d(I,e,n?t:B&&R[e]||t,r)}},exportTypedArrayStaticMethod:function(e,t,n){var r,i;if(s){if(b){if(n)for(r in L)if((i=u[r])&&h(i,e))try{delete i[e]}catch(e){}if(C[e]&&!n)return;try{return d(C,e,n?t:B&&C[e]||t)}catch(e){}}for(r in L)!(i=u[r])||i[e]&&!n||d(i,e,t)}},getTypedArrayConstructor:j,isView:function(e){if(!l(e))return!1;var t=f(e);return"DataView"===t||h(L,t)||h(N,t)},isTypedArray:z,TypedArray:C,TypedArrayPrototype:I}},3331:function(e,t,n){"use strict";var r=n(7854),i=n(1702),a=n(9781),o=n(3013),s=n(6530),u=n(8880),c=n(7045),l=n(9190),h=n(7293),f=n(5787),p=n(9303),m=n(7466),d=n(7067),v=n(1179),y=n(9518),g=n(7674),b=n(8006).f,M=n(1285),k=n(1589),_=n(8003),x=n(9909),T=s.PROPER,w=s.CONFIGURABLE,R="ArrayBuffer",Z="DataView",S="prototype",C="Wrong index",I=x.getterFor(R),E=x.getterFor(Z),A=x.set,O=r[R],D=O,P=D&&D[S],B=r[Z],F=B&&B[S],L=Object.prototype,N=r.Array,j=r.RangeError,z=i(M),U=i([].reverse),V=v.pack,H=v.unpack,G=function(e){return[255&e]},q=function(e){return[255&e,e>>8&255]},W=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Y=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},K=function(e){return V(e,23,4)},X=function(e){return V(e,52,8)},$=function(e,t,n){c(e[S],t,{configurable:!0,get:function(){return n(this)[t]}})},Q=function(e,t,n,r){var i=d(n),a=E(e);if(i+t>a.byteLength)throw j(C);var o=a.bytes,s=i+a.byteOffset,u=k(o,s,s+t);return r?u:U(u)},J=function(e,t,n,r,i,a){var o=d(n),s=E(e);if(o+t>s.byteLength)throw j(C);for(var u=s.bytes,c=o+s.byteOffset,l=r(+i),h=0;h<t;h++)u[c+h]=l[a?h:t-h-1]};if(o){var ee=T&&O.name!==R;if(h((function(){O(1)}))&&h((function(){new O(-1)}))&&!h((function(){return new O,new O(1.5),new O(NaN),1!=O.length||ee&&!w})))ee&&w&&u(O,"name",R);else{(D=function(e){return f(this,P),new O(d(e))})[S]=P;for(var te,ne=b(O),re=0;ne.length>re;)(te=ne[re++])in D||u(D,te,O[te]);P.constructor=D}g&&y(F)!==L&&g(F,L);var ie=new B(new D(2)),ae=i(F.setInt8);ie.setInt8(0,2147483648),ie.setInt8(1,2147483649),!ie.getInt8(0)&&ie.getInt8(1)||l(F,{setInt8:function(e,t){ae(this,e,t<<24>>24)},setUint8:function(e,t){ae(this,e,t<<24>>24)}},{unsafe:!0})}else P=(D=function(e){f(this,P);var t=d(e);A(this,{type:R,bytes:z(N(t),0),byteLength:t}),a||(this.byteLength=t,this.detached=!1)})[S],F=(B=function(e,t,n){f(this,F),f(e,P);var r=I(e),i=r.byteLength,o=p(t);if(o<0||o>i)throw j("Wrong offset");if(o+(n=void 0===n?i-o:m(n))>i)throw j("Wrong length");A(this,{type:Z,buffer:e,byteLength:n,byteOffset:o,bytes:r.bytes}),a||(this.buffer=e,this.byteLength=n,this.byteOffset=o)})[S],a&&($(D,"byteLength",I),$(B,"buffer",E),$(B,"byteLength",E),$(B,"byteOffset",E)),l(F,{getInt8:function(e){return Q(this,1,e)[0]<<24>>24},getUint8:function(e){return Q(this,1,e)[0]},getInt16:function(e){var t=Q(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=Q(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Y(Q(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return Y(Q(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return H(Q(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return H(Q(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){J(this,1,e,G,t)},setUint8:function(e,t){J(this,1,e,G,t)},setInt16:function(e,t){J(this,2,e,q,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){J(this,2,e,q,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){J(this,4,e,W,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){J(this,4,e,W,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){J(this,4,e,K,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){J(this,8,e,X,t,arguments.length>2?arguments[2]:void 0)}});_(D,R),_(B,Z),e.exports={ArrayBuffer:D,DataView:B}},1048:function(e,t,n){"use strict";var r=n(7908),i=n(1400),a=n(6244),o=n(5117),s=Math.min;e.exports=[].copyWithin||function(e,t){var n=r(this),u=a(n),c=i(e,u),l=i(t,u),h=arguments.length>2?arguments[2]:void 0,f=s((void 0===h?u:i(h,u))-l,u-c),p=1;for(l<c&&c<l+f&&(p=-1,l+=f-1,c+=f-1);f-->0;)l in n?n[c]=n[l]:o(n,c),c+=p,l+=p;return n}},1285:function(e,t,n){"use strict";var r=n(7908),i=n(1400),a=n(6244);e.exports=function(e){for(var t=r(this),n=a(t),o=arguments.length,s=i(o>1?arguments[1]:void 0,n),u=o>2?arguments[2]:void 0,c=void 0===u?n:i(u,n);c>s;)t[s++]=e;return t}},8533:function(e,t,n){"use strict";var r=n(2092).forEach,i=n(9341)("forEach");e.exports=i?[].forEach:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}},7745:function(e,t,n){var r=n(6244);e.exports=function(e,t){for(var n=0,i=r(t),a=new e(i);i>n;)a[n]=t[n++];return a}},8457:function(e,t,n){"use strict";var r=n(9974),i=n(6916),a=n(7908),o=n(3411),s=n(7659),u=n(4411),c=n(6244),l=n(6135),h=n(4121),f=n(1246),p=Array;e.exports=function(e){var t=a(e),n=u(this),m=arguments.length,d=m>1?arguments[1]:void 0,v=void 0!==d;v&&(d=r(d,m>2?arguments[2]:void 0));var y,g,b,M,k,_,x=f(t),T=0;if(!x||this===p&&s(x))for(y=c(t),g=n?new this(y):p(y);y>T;T++)_=v?d(t[T],T):t[T],l(g,T,_);else for(k=(M=h(t,x)).next,g=n?new this:[];!(b=i(k,M)).done;T++)_=v?o(M,d,[b.value,T],!0):b.value,l(g,T,_);return g.length=T,g}},1191:function(e,t,n){var r=n(9974),i=n(1702),a=n(8361),o=n(7908),s=n(4948),u=n(6244),c=n(30),l=n(7745),h=Array,f=i([].push);e.exports=function(e,t,n,i){for(var p,m,d,v=o(e),y=a(v),g=r(t,n),b=c(null),M=u(y),k=0;M>k;k++)d=y[k],(m=s(g(d,k,v)))in b?f(b[m],d):b[m]=[d];if(i&&(p=i(v))!==h)for(m in b)b[m]=l(p,b[m]);return b}},1318:function(e,t,n){var r=n(5656),i=n(1400),a=n(6244),o=function(e){return function(t,n,o){var s,u=r(t),c=a(u),l=i(o,c);if(e&&n!=n){for(;c>l;)if((s=u[l++])!=s)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},9671:function(e,t,n){var r=n(9974),i=n(8361),a=n(7908),o=n(6244),s=function(e){var t=1==e;return function(n,s,u){for(var c,l=a(n),h=i(l),f=r(s,u),p=o(h);p-->0;)if(f(c=h[p],p,l))switch(e){case 0:return c;case 1:return p}return t?-1:void 0}};e.exports={findLast:s(0),findLastIndex:s(1)}},2092:function(e,t,n){var r=n(9974),i=n(1702),a=n(8361),o=n(7908),s=n(6244),u=n(5417),c=i([].push),l=function(e){var t=1==e,n=2==e,i=3==e,l=4==e,h=6==e,f=7==e,p=5==e||h;return function(m,d,v,y){for(var g,b,M=o(m),k=a(M),_=r(d,v),x=s(k),T=0,w=y||u,R=t?w(m,x):n||f?w(m,0):void 0;x>T;T++)if((p||T in k)&&(b=_(g=k[T],T,M),e))if(t)R[T]=b;else if(b)switch(e){case 3:return!0;case 5:return g;case 6:return T;case 2:c(R,g)}else switch(e){case 4:return!1;case 7:c(R,g)}return h?-1:i||l?l:R}};e.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6),filterReject:l(7)}},6583:function(e,t,n){"use strict";var r=n(2104),i=n(5656),a=n(9303),o=n(6244),s=n(9341),u=Math.min,c=[].lastIndexOf,l=!!c&&1/[1].lastIndexOf(1,-0)<0,h=s("lastIndexOf"),f=l||!h;e.exports=f?function(e){if(l)return r(c,this,arguments)||0;var t=i(this),n=o(t),s=n-1;for(arguments.length>1&&(s=u(s,a(arguments[1]))),s<0&&(s=n+s);s>=0;s--)if(s in t&&t[s]===e)return s||0;return-1}:c},1194:function(e,t,n){var r=n(7293),i=n(5112),a=n(7392),o=i("species");e.exports=function(e){return a>=51||!r((function(){var t=[];return(t.constructor={})[o]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},9341:function(e,t,n){"use strict";var r=n(7293);e.exports=function(e,t){var n=[][e];return!!n&&r((function(){n.call(null,t||function(){return 1},1)}))}},3671:function(e,t,n){var r=n(9662),i=n(7908),a=n(8361),o=n(6244),s=TypeError,u=function(e){return function(t,n,u,c){r(n);var l=i(t),h=a(l),f=o(l),p=e?f-1:0,m=e?-1:1;if(u<2)for(;;){if(p in h){c=h[p],p+=m;break}if(p+=m,e?p<0:f<=p)throw s("Reduce of empty array with no initial value")}for(;e?p>=0:f>p;p+=m)p in h&&(c=n(c,h[p],p,l));return c}};e.exports={left:u(!1),right:u(!0)}},3658:function(e,t,n){"use strict";var r=n(9781),i=n(3157),a=TypeError,o=Object.getOwnPropertyDescriptor,s=r&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=s?function(e,t){if(i(e)&&!o(e,"length").writable)throw a("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},1589:function(e,t,n){var r=n(1400),i=n(6244),a=n(6135),o=Array,s=Math.max;e.exports=function(e,t,n){for(var u=i(e),c=r(t,u),l=r(void 0===n?u:n,u),h=o(s(l-c,0)),f=0;c<l;c++,f++)a(h,f,e[c]);return h.length=f,h}},206:function(e,t,n){var r=n(1702);e.exports=r([].slice)},4362:function(e,t,n){var r=n(1589),i=Math.floor,a=function(e,t){var n=e.length,u=i(n/2);return n<8?o(e,t):s(e,a(r(e,0,u),t),a(r(e,u),t),t)},o=function(e,t){for(var n,r,i=e.length,a=1;a<i;){for(r=a,n=e[a];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==a++&&(e[r]=n)}return e},s=function(e,t,n,r){for(var i=t.length,a=n.length,o=0,s=0;o<i||s<a;)e[o+s]=o<i&&s<a?r(t[o],n[s])<=0?t[o++]:n[s++]:o<i?t[o++]:n[s++];return e};e.exports=a},7475:function(e,t,n){var r=n(3157),i=n(4411),a=n(111),o=n(5112)("species"),s=Array;e.exports=function(e){var t;return r(e)&&(t=e.constructor,(i(t)&&(t===s||r(t.prototype))||a(t)&&null===(t=t[o]))&&(t=void 0)),void 0===t?s:t}},5417:function(e,t,n){var r=n(7475);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},1843:function(e,t,n){var r=n(6244);e.exports=function(e,t){for(var n=r(e),i=new t(n),a=0;a<n;a++)i[a]=e[n-a-1];return i}},956:function(e,t,n){"use strict";var r=n(1702),i=n(9662),a=n(8554),o=n(6244),s=n(7908),u=n(5706),c=n(4995),l=u.Map,h=u.has,f=u.set,p=r([].push);e.exports=function(e){var t,n,r,u=s(this),m=o(u),d=[],v=new l,y=a(e)?function(e){return e}:i(e);for(t=0;t<m;t++)r=y(n=u[t]),h(v,r)||f(v,r,n);return c(v,(function(e){p(d,e)})),d}},1572:function(e,t,n){var r=n(6244),i=n(9303),a=RangeError;e.exports=function(e,t,n,o){var s=r(e),u=i(n),c=u<0?s+u:u;if(c>=s||c<0)throw a("Incorrect index");for(var l=new t(s),h=0;h<s;h++)l[h]=h===c?o:e[h];return l}},1753:function(e,t,n){var r=n(6916),i=n(5005),a=n(8173);e.exports=function(e,t,n,o){try{var s=a(e,"return");if(s)return i("Promise").resolve(r(s,e)).then((function(){t(n)}),(function(e){o(e)}))}catch(e){return o(e)}t(n)}},5348:function(e,t,n){"use strict";var r=n(6916),i=n(2534),a=n(9670),o=n(30),s=n(8880),u=n(9190),c=n(5112),l=n(9909),h=n(5005),f=n(8173),p=n(6462),m=n(6178),d=n(9212),v=h("Promise"),y=c("toStringTag"),g="AsyncIteratorHelper",b="WrapForValidAsyncIterator",M=l.set,k=function(e){var t=!e,n=l.getterFor(e?b:g),s=function(e){var r=i((function(){return n(e)})),a=r.error,o=r.value;return a||t&&o.done?{exit:!0,value:a?v.reject(o):v.resolve(m(void 0,!0))}:{exit:!1,value:o}};return u(o(p),{next:function(){var e=s(this),t=e.value;if(e.exit)return t;var n=i((function(){return a(t.nextHandler(v))})),r=n.error,o=n.value;return r&&(t.done=!0),r?v.reject(o):v.resolve(o)},return:function(){var t=s(this),n=t.value;if(t.exit)return n;n.done=!0;var o,u,c=n.iterator,l=i((function(){if(n.inner)try{d(n.inner.iterator,"normal")}catch(e){return d(c,"throw",e)}return f(c,"return")}));return o=u=l.value,l.error?v.reject(u):void 0===o?v.resolve(m(void 0,!0)):(u=(l=i((function(){return r(o,c)}))).value,l.error?v.reject(u):e?v.resolve(u):v.resolve(u).then((function(e){return a(e),m(void 0,!0)})))}})},_=k(!0),x=k(!1);s(x,y,"Async Iterator Helper"),e.exports=function(e,t){var n=function(n,r){r?(r.iterator=n.iterator,r.next=n.next):r=n,r.type=t?b:g,r.nextHandler=e,r.counter=0,r.done=!1,M(this,r)};return n.prototype=t?_:x,n}},2269:function(e,t,n){"use strict";var r=n(6916),i=n(9662),a=n(9670),o=n(111),s=n(7207),u=n(5005),c=n(4942),l=n(1753),h=function(e){var t=0==e,n=1==e,h=2==e,f=3==e;return function(e,p,m){a(e);var d=void 0!==p;!d&&t||i(p);var v=c(e),y=u("Promise"),g=v.iterator,b=v.next,M=0;return new y((function(e,i){var u=function(e){l(g,i,e,i)},c=function(){try{if(d)try{s(M)}catch(e){u(e)}y.resolve(a(r(b,g))).then((function(r){try{if(a(r).done)t?(m.length=M,e(m)):e(!f&&(h||void 0));else{var s=r.value;try{if(d){var v=p(s,M),b=function(r){if(n)c();else if(h)r?c():l(g,e,!1,i);else if(t)try{m[M++]=r,c()}catch(e){u(e)}else r?l(g,e,f||s,i):c()};o(v)?y.resolve(v).then(b,u):b(v)}else m[M++]=s,c()}catch(e){u(e)}}}catch(e){i(e)}}),i)}catch(e){i(e)}};c()}))}};e.exports={toArray:h(0),forEach:h(1),every:h(2),some:h(3),find:h(4)}},3232:function(e,t,n){"use strict";var r=n(6916),i=n(9662),a=n(9670),o=n(111),s=n(4942),u=n(5348),c=n(6178),l=n(1753),h=u((function(e){var t=this,n=t.iterator,i=t.mapper;return new e((function(s,u){var h=function(e){t.done=!0,u(e)},f=function(e){l(n,h,e,h)};e.resolve(a(r(t.next,n))).then((function(n){try{if(a(n).done)t.done=!0,s(c(void 0,!0));else{var r=n.value;try{var u=i(r,t.counter++),l=function(e){s(c(e,!1))};o(u)?e.resolve(u).then(l,f):l(u)}catch(e){f(e)}}}catch(e){h(e)}}),h)}))}));e.exports=function(e){return a(this),i(e),new h(s(this),{mapper:e})}},6462:function(e,t,n){var r,i,a=n(7854),o=n(5465),s=n(614),u=n(30),c=n(9518),l=n(8052),h=n(5112),f=n(1913),p="USE_FUNCTION_CONSTRUCTOR",m=h("asyncIterator"),d=a.AsyncIterator,v=o.AsyncIteratorPrototype;if(v)r=v;else if(s(d))r=d.prototype;else if(o[p]||a[p])try{i=c(c(c(Function("return async function*(){}()")()))),c(i)===Object.prototype&&(r=i)}catch(e){}r?f&&(r=u(r)):r={},s(r[m])||l(r,m,(function(){return this})),e.exports=r},4170:function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n={},r=0;r<66;r++)n[t.charAt(r)]=r;e.exports={itoc:t,ctoi:n}},3411:function(e,t,n){var r=n(9670),i=n(9212);e.exports=function(e,t,n,a){try{return a?t(r(n)[0],n[1]):t(n)}catch(t){i(e,"throw",t)}}},7072:function(e,t,n){var r=n(5112)("iterator"),i=!1;try{var a=0,o={next:function(){return{done:!!a++}},return:function(){i=!0}};o[r]=function(){return this},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var a={};a[r]=function(){return{next:function(){return{done:n=!0}}}},e(a)}catch(e){}return n}},4326:function(e,t,n){var r=n(1702),i=r({}.toString),a=r("".slice);e.exports=function(e){return a(i(e),8,-1)}},648:function(e,t,n){var r=n(1694),i=n(614),a=n(4326),o=n(5112)("toStringTag"),s=Object,u="Arguments"==a(function(){return arguments}());e.exports=r?a:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=s(e),o))?n:u?a(t):"Object"==(r=a(t))&&i(t.callee)?"Arguments":r}},5631:function(e,t,n){"use strict";var r=n(30),i=n(7045),a=n(9190),o=n(9974),s=n(5787),u=n(8554),c=n(408),l=n(1656),h=n(6178),f=n(6340),p=n(9781),m=n(2423).fastKey,d=n(9909),v=d.set,y=d.getterFor;e.exports={getConstructor:function(e,t,n,l){var h=e((function(e,i){s(e,f),v(e,{type:t,index:r(null),first:void 0,last:void 0,size:0}),p||(e.size=0),u(i)||c(i,e[l],{that:e,AS_ENTRIES:n})})),f=h.prototype,d=y(t),g=function(e,t,n){var r,i,a=d(e),o=b(e,t);return o?o.value=n:(a.last=o={index:i=m(t,!0),key:t,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=o),r&&(r.next=o),p?a.size++:e.size++,"F"!==i&&(a.index[i]=o)),e},b=function(e,t){var n,r=d(e),i=m(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return a(f,{clear:function(){for(var e=d(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,p?e.size=0:this.size=0},delete:function(e){var t=this,n=d(t),r=b(t,e);if(r){var i=r.next,a=r.previous;delete n.index[r.index],r.removed=!0,a&&(a.next=i),i&&(i.previous=a),n.first==r&&(n.first=i),n.last==r&&(n.last=a),p?n.size--:t.size--}return!!r},forEach:function(e){for(var t,n=d(this),r=o(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!b(this,e)}}),a(f,n?{get:function(e){var t=b(this,e);return t&&t.value},set:function(e,t){return g(this,0===e?0:e,t)}}:{add:function(e){return g(this,e=0===e?0:e,e)}}),p&&i(f,"size",{configurable:!0,get:function(){return d(this).size}}),h},setStrong:function(e,t,n){var r=t+" Iterator",i=y(t),a=y(r);l(e,t,(function(e,t){v(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=a(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?h("keys"==t?n.key:"values"==t?n.value:[n.key,n.value],!1):(e.target=void 0,h(void 0,!0))}),n?"entries":"values",!n,!0),f(t)}}},9320:function(e,t,n){"use strict";var r=n(1702),i=n(9190),a=n(2423).getWeakData,o=n(5787),s=n(9670),u=n(8554),c=n(111),l=n(408),h=n(2092),f=n(2597),p=n(9909),m=p.set,d=p.getterFor,v=h.find,y=h.findIndex,g=r([].splice),b=0,M=function(e){return e.frozen||(e.frozen=new k)},k=function(){this.entries=[]},_=function(e,t){return v(e.entries,(function(e){return e[0]===t}))};k.prototype={get:function(e){var t=_(this,e);if(t)return t[1]},has:function(e){return!!_(this,e)},set:function(e,t){var n=_(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=y(this.entries,(function(t){return t[0]===e}));return~t&&g(this.entries,t,1),!!~t}},e.exports={getConstructor:function(e,t,n,r){var h=e((function(e,i){o(e,p),m(e,{type:t,id:b++,frozen:void 0}),u(i)||l(i,e[r],{that:e,AS_ENTRIES:n})})),p=h.prototype,v=d(t),y=function(e,t,n){var r=v(e),i=a(s(t),!0);return!0===i?M(r).set(t,n):i[r.id]=n,e};return i(p,{delete:function(e){var t=v(this);if(!c(e))return!1;var n=a(e);return!0===n?M(t).delete(e):n&&f(n,t.id)&&delete n[t.id]},has:function(e){var t=v(this);if(!c(e))return!1;var n=a(e);return!0===n?M(t).has(e):n&&f(n,t.id)}}),i(p,n?{get:function(e){var t=v(this);if(c(e)){var n=a(e);return!0===n?M(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return y(this,e,t)}}:{add:function(e){return y(this,e,!0)}}),h}}},7710:function(e,t,n){"use strict";var r=n(2109),i=n(7854),a=n(1702),o=n(4705),s=n(8052),u=n(2423),c=n(408),l=n(5787),h=n(614),f=n(8554),p=n(111),m=n(7293),d=n(7072),v=n(8003),y=n(9587);e.exports=function(e,t,n){var g=-1!==e.indexOf("Map"),b=-1!==e.indexOf("Weak"),M=g?"set":"add",k=i[e],_=k&&k.prototype,x=k,T={},w=function(e){var t=a(_[e]);s(_,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(b&&!p(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return b&&!p(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(b&&!p(e))&&t(this,0===e?0:e)}:function(e,n){return t(this,0===e?0:e,n),this})};if(o(e,!h(k)||!(b||_.forEach&&!m((function(){(new k).entries().next()})))))x=n.getConstructor(t,e,g,M),u.enable();else if(o(e,!0)){var R=new x,Z=R[M](b?{}:-0,1)!=R,S=m((function(){R.has(1)})),C=d((function(e){new k(e)})),I=!b&&m((function(){for(var e=new k,t=5;t--;)e[M](t,t);return!e.has(-0)}));C||((x=t((function(e,t){l(e,_);var n=y(new k,e,x);return f(t)||c(t,n[M],{that:n,AS_ENTRIES:g}),n}))).prototype=_,_.constructor=x),(S||I)&&(w("delete"),w("has"),g&&w("get")),(I||Z)&&w(M),b&&_.clear&&delete _.clear}return T[e]=x,r({global:!0,constructor:!0,forced:x!=k},T),v(x,e),b||n.setStrong(x,e,g),x}},9920:function(e,t,n){var r=n(2597),i=n(3887),a=n(1236),o=n(3070);e.exports=function(e,t,n){for(var s=i(t),u=o.f,c=a.f,l=0;l<s.length;l++){var h=s[l];r(e,h)||n&&r(n,h)||u(e,h,c(t,h))}}},4964:function(e,t,n){var r=n(5112)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,"/./"[e](t)}catch(e){}}return!1}},8544:function(e,t,n){var r=n(7293);e.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},4230:function(e,t,n){var r=n(1702),i=n(4488),a=n(1340),o=/"/g,s=r("".replace);e.exports=function(e,t,n,r){var u=a(i(e)),c="<"+t;return""!==n&&(c+=" "+n+'="'+s(a(r),o,"&quot;")+'"'),c+">"+u+"</"+t+">"}},6178:function(e){e.exports=function(e,t){return{value:e,done:t}}},8880:function(e,t,n){var r=n(9781),i=n(3070),a=n(9114);e.exports=r?function(e,t,n){return i.f(e,t,a(1,n))}:function(e,t,n){return e[t]=n,e}},9114:function(e){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},6135:function(e,t,n){"use strict";var r=n(4948),i=n(3070),a=n(9114);e.exports=function(e,t,n){var o=r(t);o in e?i.f(e,o,a(0,n)):e[o]=n}},7045:function(e,t,n){var r=n(6339),i=n(3070);e.exports=function(e,t,n){return n.get&&r(n.get,t,{getter:!0}),n.set&&r(n.set,t,{setter:!0}),i.f(e,t,n)}},8052:function(e,t,n){var r=n(614),i=n(3070),a=n(6339),o=n(3072);e.exports=function(e,t,n,s){s||(s={});var u=s.enumerable,c=void 0!==s.name?s.name:t;if(r(n)&&a(n,c,s),s.global)u?e[t]=n:o(t,n);else{try{s.unsafe?e[t]&&(u=!0):delete e[t]}catch(e){}u?e[t]=n:i.f(e,t,{value:n,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return e}},9190:function(e,t,n){var r=n(8052);e.exports=function(e,t,n){for(var i in t)r(e,i,t[i],n);return e}},3072:function(e,t,n){var r=n(7854),i=Object.defineProperty;e.exports=function(e,t){try{i(r,e,{value:t,configurable:!0,writable:!0})}catch(n){r[e]=t}return t}},5117:function(e,t,n){"use strict";var r=n(6330),i=TypeError;e.exports=function(e,t){if(!delete e[t])throw i("Cannot delete property "+r(t)+" of "+r(e))}},9781:function(e,t,n){var r=n(7293);e.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},4154:function(e){var t="object"==typeof document&&document.all,n=void 0===t&&void 0!==t;e.exports={all:t,IS_HTMLDDA:n}},317:function(e,t,n){var r=n(7854),i=n(111),a=r.document,o=i(a)&&i(a.createElement);e.exports=function(e){return o?a.createElement(e):{}}},7207:function(e){var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},3678:function(e){e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},8324:function(e){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},8509:function(e,t,n){var r=n(317)("span").classList,i=r&&r.constructor&&r.constructor.prototype;e.exports=i===Object.prototype?void 0:i},8886:function(e,t,n){var r=n(8113).match(/firefox\/(\d+)/i);e.exports=!!r&&+r[1]},7871:function(e,t,n){var r=n(3823),i=n(5268);e.exports=!r&&!i&&"object"==typeof window&&"object"==typeof document},3823:function(e){e.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},256:function(e,t,n){var r=n(8113);e.exports=/MSIE|Trident/.test(r)},1528:function(e,t,n){var r=n(8113);e.exports=/ipad|iphone|ipod/i.test(r)&&"undefined"!=typeof Pebble},6833:function(e,t,n){var r=n(8113);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},5268:function(e,t,n){var r=n(4155),i=n(4326);e.exports=void 0!==r&&"process"==i(r)},1036:function(e,t,n){var r=n(8113);e.exports=/web0s(?!.*chrome)/i.test(r)},8113:function(e){e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},7392:function(e,t,n){var r,i,a=n(7854),o=n(8113),s=a.process,u=a.Deno,c=s&&s.versions||u&&u.version,l=c&&c.v8;l&&(i=(r=l.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&o&&(!(r=o.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=o.match(/Chrome\/(\d+)/))&&(i=+r[1]),e.exports=i},8008:function(e,t,n){var r=n(8113).match(/AppleWebKit\/(\d+)\./);e.exports=!!r&&+r[1]},748:function(e){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},1060:function(e,t,n){var r=n(1702),i=Error,a=r("".replace),o=String(i("zxcasd").stack),s=/\n\s*at [^:]*:[^\n]*/,u=s.test(o);e.exports=function(e,t){if(u&&"string"==typeof e&&!i.prepareStackTrace)for(;t--;)e=a(e,s,"");return e}},5392:function(e,t,n){var r=n(8880),i=n(1060),a=n(2914),o=Error.captureStackTrace;e.exports=function(e,t,n,s){a&&(o?o(e,t):r(e,"stack",i(n,s)))}},2914:function(e,t,n){var r=n(7293),i=n(9114);e.exports=!r((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",i(1,7)),7!==e.stack)}))},7762:function(e,t,n){"use strict";var r=n(9781),i=n(7293),a=n(9670),o=n(30),s=n(6277),u=Error.prototype.toString,c=i((function(){if(r){var e=o(Object.defineProperty({},"name",{get:function(){return this===e}}));if("true"!==u.call(e))return!0}return"2: 1"!==u.call({message:1,name:2})||"Error"!==u.call({})}));e.exports=c?function(){var e=a(this),t=s(e.name,"Error"),n=s(e.message);return t?n?t+": "+n:t:n}:u},2109:function(e,t,n){var r=n(7854),i=n(1236).f,a=n(8880),o=n(8052),s=n(3072),u=n(9920),c=n(4705);e.exports=function(e,t){var n,l,h,f,p,m=e.target,d=e.global,v=e.stat;if(n=d?r:v?r[m]||s(m,{}):(r[m]||{}).prototype)for(l in t){if(f=t[l],h=e.dontCallGetSet?(p=i(n,l))&&p.value:n[l],!c(d?l:m+(v?".":"#")+l,e.forced)&&void 0!==h){if(typeof f==typeof h)continue;u(f,h)}(e.sham||h&&h.sham)&&a(f,"sham",!0),o(n,l,f,e)}}},7293:function(e){e.exports=function(e){try{return!!e()}catch(e){return!0}}},7007:function(e,t,n){"use strict";n(4916);var r=n(1470),i=n(8052),a=n(2261),o=n(7293),s=n(5112),u=n(8880),c=s("species"),l=RegExp.prototype;e.exports=function(e,t,n,h){var f=s(e),p=!o((function(){var t={};return t[f]=function(){return 7},7!=""[e](t)})),m=p&&!o((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[c]=function(){return n},n.flags="",n[f]=/./[f]),n.exec=function(){return t=!0,null},n[f](""),!t}));if(!p||!m||n){var d=r(/./[f]),v=t(f,""[e],(function(e,t,n,i,o){var s=r(e),u=t.exec;return u===a||u===l.exec?p&&!o?{done:!0,value:d(t,n,i)}:{done:!0,value:s(n,t,i)}:{done:!1}}));i(String.prototype,e,v[0]),i(l,f,v[1])}h&&u(l[f],"sham",!0)}},6677:function(e,t,n){var r=n(7293);e.exports=!r((function(){return Object.isExtensible(Object.preventExtensions({}))}))},2104:function(e,t,n){var r=n(4374),i=Function.prototype,a=i.apply,o=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?o.bind(a):function(){return o.apply(a,arguments)})},9974:function(e,t,n){var r=n(1470),i=n(9662),a=n(4374),o=r(r.bind);e.exports=function(e,t){return i(e),void 0===t?e:a?o(e,t):function(){return e.apply(t,arguments)}}},4374:function(e,t,n){var r=n(7293);e.exports=!r((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},7065:function(e,t,n){"use strict";var r=n(1702),i=n(9662),a=n(111),o=n(2597),s=n(206),u=n(4374),c=Function,l=r([].concat),h=r([].join),f={};e.exports=u?c.bind:function(e){var t=i(this),n=t.prototype,r=s(arguments,1),u=function(){var n=l(r,s(arguments));return this instanceof u?function(e,t,n){if(!o(f,t)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";f[t]=c("C,a","return new C("+h(r,",")+")")}return f[t](e,n)}(t,n.length,n):t.apply(e,n)};return a(n)&&(u.prototype=n),u}},6916:function(e,t,n){var r=n(4374),i=Function.prototype.call;e.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},6530:function(e,t,n){var r=n(9781),i=n(2597),a=Function.prototype,o=r&&Object.getOwnPropertyDescriptor,s=i(a,"name"),u=s&&"something"===function(){}.name,c=s&&(!r||r&&o(a,"name").configurable);e.exports={EXISTS:s,PROPER:u,CONFIGURABLE:c}},5668:function(e,t,n){var r=n(1702),i=n(9662);e.exports=function(e,t,n){try{return r(i(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}}},1470:function(e,t,n){var r=n(4326),i=n(1702);e.exports=function(e){if("Function"===r(e))return i(e)}},1702:function(e,t,n){var r=n(4374),i=Function.prototype,a=i.call,o=r&&i.bind.bind(a,a);e.exports=r?o:function(e){return function(){return a.apply(e,arguments)}}},5005:function(e,t,n){var r=n(7854),i=n(614);e.exports=function(e,t){return arguments.length<2?(n=r[e],i(n)?n:void 0):r[e]&&r[e][t];var n}},4942:function(e,t,n){var r=n(9662);e.exports=function(e){return{iterator:e,next:r(e.next)}}},1246:function(e,t,n){var r=n(648),i=n(8173),a=n(8554),o=n(7497),s=n(5112)("iterator");e.exports=function(e){if(!a(e))return i(e,s)||i(e,"@@iterator")||o[r(e)]}},4121:function(e,t,n){var r=n(6916),i=n(9662),a=n(9670),o=n(6330),s=n(1246),u=TypeError;e.exports=function(e,t){var n=arguments.length<2?s(e):t;if(i(n))return a(r(n,e));throw u(o(e)+" is not iterable")}},8044:function(e,t,n){var r=n(1702),i=n(3157),a=n(614),o=n(4326),s=n(1340),u=r([].push);e.exports=function(e){if(a(e))return e;if(i(e)){for(var t=e.length,n=[],r=0;r<t;r++){var c=e[r];"string"==typeof c?u(n,c):"number"!=typeof c&&"Number"!=o(c)&&"String"!=o(c)||u(n,s(c))}var l=n.length,h=!0;return function(e,t){if(h)return h=!1,t;if(i(this))return t;for(var r=0;r<l;r++)if(n[r]===e)return t}}}},8173:function(e,t,n){var r=n(9662),i=n(8554);e.exports=function(e,t){var n=e[t];return i(n)?void 0:r(n)}},647:function(e,t,n){var r=n(1702),i=n(7908),a=Math.floor,o=r("".charAt),s=r("".replace),u=r("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,l=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,n,r,h,f){var p=n+e.length,m=r.length,d=l;return void 0!==h&&(h=i(h),d=c),s(f,d,(function(i,s){var c;switch(o(s,0)){case"$":return"$";case"&":return e;case"`":return u(t,0,n);case"'":return u(t,p);case"<":c=h[u(s,1,-1)];break;default:var l=+s;if(0===l)return i;if(l>m){var f=a(l/10);return 0===f?i:f<=m?void 0===r[f-1]?o(s,1):r[f-1]+o(s,1):i}c=r[l-1]}return void 0===c?"":c}))}},7854:function(e,t,n){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n.g&&n.g)||function(){return this}()||Function("return this")()},2597:function(e,t,n){var r=n(1702),i=n(7908),a=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return a(i(e),t)}},3501:function(e){e.exports={}},842:function(e){e.exports=function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch(e){}}},490:function(e,t,n){var r=n(5005);e.exports=r("document","documentElement")},4664:function(e,t,n){var r=n(9781),i=n(7293),a=n(317);e.exports=!r&&!i((function(){return 7!=Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))},1179:function(e){var t=Array,n=Math.abs,r=Math.pow,i=Math.floor,a=Math.log,o=Math.LN2;e.exports={pack:function(e,s,u){var c,l,h,f=t(u),p=8*u-s-1,m=(1<<p)-1,d=m>>1,v=23===s?r(2,-24)-r(2,-77):0,y=e<0||0===e&&1/e<0?1:0,g=0;for((e=n(e))!=e||e===1/0?(l=e!=e?1:0,c=m):(c=i(a(e)/o),e*(h=r(2,-c))<1&&(c--,h*=2),(e+=c+d>=1?v/h:v*r(2,1-d))*h>=2&&(c++,h/=2),c+d>=m?(l=0,c=m):c+d>=1?(l=(e*h-1)*r(2,s),c+=d):(l=e*r(2,d-1)*r(2,s),c=0));s>=8;)f[g++]=255&l,l/=256,s-=8;for(c=c<<s|l,p+=s;p>0;)f[g++]=255&c,c/=256,p-=8;return f[--g]|=128*y,f},unpack:function(e,t){var n,i=e.length,a=8*i-t-1,o=(1<<a)-1,s=o>>1,u=a-7,c=i-1,l=e[c--],h=127&l;for(l>>=7;u>0;)h=256*h+e[c--],u-=8;for(n=h&(1<<-u)-1,h>>=-u,u+=t;u>0;)n=256*n+e[c--],u-=8;if(0===h)h=1-s;else{if(h===o)return n?NaN:l?-1/0:1/0;n+=r(2,t),h-=s}return(l?-1:1)*n*r(2,h-t)}}},8361:function(e,t,n){var r=n(1702),i=n(7293),a=n(4326),o=Object,s=r("".split);e.exports=i((function(){return!o("z").propertyIsEnumerable(0)}))?function(e){return"String"==a(e)?s(e,""):o(e)}:o},9587:function(e,t,n){var r=n(614),i=n(111),a=n(7674);e.exports=function(e,t,n){var o,s;return a&&r(o=t.constructor)&&o!==n&&i(s=o.prototype)&&s!==n.prototype&&a(e,s),e}},2788:function(e,t,n){var r=n(1702),i=n(614),a=n(5465),o=r(Function.toString);i(a.inspectSource)||(a.inspectSource=function(e){return o(e)}),e.exports=a.inspectSource},8340:function(e,t,n){var r=n(111),i=n(8880);e.exports=function(e,t){r(t)&&"cause"in t&&i(e,"cause",t.cause)}},2423:function(e,t,n){var r=n(2109),i=n(1702),a=n(3501),o=n(111),s=n(2597),u=n(3070).f,c=n(8006),l=n(1156),h=n(2050),f=n(9711),p=n(6677),m=!1,d=f("meta"),v=0,y=function(e){u(e,d,{value:{objectID:"O"+v++,weakData:{}}})},g=e.exports={enable:function(){g.enable=function(){},m=!0;var e=c.f,t=i([].splice),n={};n[d]=1,e(n).length&&(c.f=function(n){for(var r=e(n),i=0,a=r.length;i<a;i++)if(r[i]===d){t(r,i,1);break}return r},r({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:l.f}))},fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!s(e,d)){if(!h(e))return"F";if(!t)return"E";y(e)}return e[d].objectID},getWeakData:function(e,t){if(!s(e,d)){if(!h(e))return!0;if(!t)return!1;y(e)}return e[d].weakData},onFreeze:function(e){return p&&m&&h(e)&&!s(e,d)&&y(e),e}};a[d]=!0},9909:function(e,t,n){var r,i,a,o=n(4811),s=n(7854),u=n(111),c=n(8880),l=n(2597),h=n(5465),f=n(6200),p=n(3501),m="Object already initialized",d=s.TypeError,v=s.WeakMap;if(o||h.state){var y=h.state||(h.state=new v);y.get=y.get,y.has=y.has,y.set=y.set,r=function(e,t){if(y.has(e))throw d(m);return t.facade=e,y.set(e,t),t},i=function(e){return y.get(e)||{}},a=function(e){return y.has(e)}}else{var g=f("state");p[g]=!0,r=function(e,t){if(l(e,g))throw d(m);return t.facade=e,c(e,g,t),t},i=function(e){return l(e,g)?e[g]:{}},a=function(e){return l(e,g)}}e.exports={set:r,get:i,has:a,enforce:function(e){return a(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!u(t)||(n=i(t)).type!==e)throw d("Incompatible receiver, "+e+" required");return n}}}},7659:function(e,t,n){var r=n(5112),i=n(7497),a=r("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||o[a]===e)}},3157:function(e,t,n){var r=n(4326);e.exports=Array.isArray||function(e){return"Array"==r(e)}},4067:function(e,t,n){var r=n(648);e.exports=function(e){var t=r(e);return"BigInt64Array"==t||"BigUint64Array"==t}},614:function(e,t,n){var r=n(4154),i=r.all;e.exports=r.IS_HTMLDDA?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}},4411:function(e,t,n){var r=n(1702),i=n(7293),a=n(614),o=n(648),s=n(5005),u=n(2788),c=function(){},l=[],h=s("Reflect","construct"),f=/^\s*(?:class|function)\b/,p=r(f.exec),m=!f.exec(c),d=function(e){if(!a(e))return!1;try{return h(c,l,e),!0}catch(e){return!1}},v=function(e){if(!a(e))return!1;switch(o(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return m||!!p(f,u(e))}catch(e){return!0}};v.sham=!0,e.exports=!h||i((function(){var e;return d(d.call)||!d(Object)||!d((function(){e=!0}))||e}))?v:d},4705:function(e,t,n){var r=n(7293),i=n(614),a=/#|\.prototype\./,o=function(e,t){var n=u[s(e)];return n==l||n!=c&&(i(t)?r(t):!!t)},s=o.normalize=function(e){return String(e).replace(a,".").toLowerCase()},u=o.data={},c=o.NATIVE="N",l=o.POLYFILL="P";e.exports=o},5988:function(e,t,n){var r=n(111),i=Math.floor;e.exports=Number.isInteger||function(e){return!r(e)&&isFinite(e)&&i(e)===e}},8554:function(e){e.exports=function(e){return null==e}},111:function(e,t,n){var r=n(614),i=n(4154),a=i.all;e.exports=i.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:r(e)||e===a}:function(e){return"object"==typeof e?null!==e:r(e)}},1913:function(e){e.exports=!1},7850:function(e,t,n){var r=n(111),i=n(4326),a=n(5112)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[a])?!!t:"RegExp"==i(e))}},2190:function(e,t,n){var r=n(5005),i=n(614),a=n(7976),o=n(3307),s=Object;e.exports=o?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return i(t)&&a(t.prototype,s(e))}},6333:function(e,t,n){var r=n(6916);e.exports=function(e,t,n){for(var i,a,o=n||e.next;!(i=r(o,e)).done;)if(void 0!==(a=t(i.value)))return a}},408:function(e,t,n){var r=n(9974),i=n(6916),a=n(9670),o=n(6330),s=n(7659),u=n(6244),c=n(7976),l=n(4121),h=n(1246),f=n(9212),p=TypeError,m=function(e,t){this.stopped=e,this.result=t},d=m.prototype;e.exports=function(e,t,n){var v,y,g,b,M,k,_,x=n&&n.that,T=!(!n||!n.AS_ENTRIES),w=!(!n||!n.IS_RECORD),R=!(!n||!n.IS_ITERATOR),Z=!(!n||!n.INTERRUPTED),S=r(t,x),C=function(e){return v&&f(v,"normal",e),new m(!0,e)},I=function(e){return T?(a(e),Z?S(e[0],e[1],C):S(e[0],e[1])):Z?S(e,C):S(e)};if(w)v=e.iterator;else if(R)v=e;else{if(!(y=h(e)))throw p(o(e)+" is not iterable");if(s(y)){for(g=0,b=u(e);b>g;g++)if((M=I(e[g]))&&c(d,M))return M;return new m(!1)}v=l(e,y)}for(k=w?e.next:v.next;!(_=i(k,v)).done;){try{M=I(_.value)}catch(e){f(v,"throw",e)}if("object"==typeof M&&M&&c(d,M))return M}return new m(!1)}},9212:function(e,t,n){var r=n(6916),i=n(9670),a=n(8173);e.exports=function(e,t,n){var o,s;i(e);try{if(!(o=a(e,"return"))){if("throw"===t)throw n;return n}o=r(o,e)}catch(e){s=!0,o=e}if("throw"===t)throw n;if(s)throw o;return i(o),n}},3061:function(e,t,n){"use strict";var r=n(3383).IteratorPrototype,i=n(30),a=n(9114),o=n(8003),s=n(7497),u=function(){return this};e.exports=function(e,t,n,c){var l=t+" Iterator";return e.prototype=i(r,{next:a(+!c,n)}),o(e,l,!1,!0),s[l]=u,e}},4956:function(e,t,n){"use strict";var r=n(6916),i=n(30),a=n(8880),o=n(9190),s=n(5112),u=n(9909),c=n(8173),l=n(3383).IteratorPrototype,h=n(6178),f=n(9212),p=s("toStringTag"),m="IteratorHelper",d="WrapForValidIterator",v=u.set,y=function(e){var t=u.getterFor(e?d:m);return o(i(l),{next:function(){var n=t(this);if(e)return n.nextHandler();try{var r=n.done?void 0:n.nextHandler();return h(r,n.done)}catch(e){throw n.done=!0,e}},return:function(){var n=t(this),i=n.iterator;if(n.done=!0,e){var a=c(i,"return");return a?r(a,i):h(void 0,!0)}if(n.inner)try{f(n.inner.iterator,"normal")}catch(e){return f(i,"throw",e)}return f(i,"normal"),h(void 0,!0)}})},g=y(!0),b=y(!1);a(b,p,"Iterator Helper"),e.exports=function(e,t){var n=function(n,r){r?(r.iterator=n.iterator,r.next=n.next):r=n,r.type=t?d:m,r.nextHandler=e,r.counter=0,r.done=!1,v(this,r)};return n.prototype=t?g:b,n}},1656:function(e,t,n){"use strict";var r=n(2109),i=n(6916),a=n(1913),o=n(6530),s=n(614),u=n(3061),c=n(9518),l=n(7674),h=n(8003),f=n(8880),p=n(8052),m=n(5112),d=n(7497),v=n(3383),y=o.PROPER,g=o.CONFIGURABLE,b=v.IteratorPrototype,M=v.BUGGY_SAFARI_ITERATORS,k=m("iterator"),_="keys",x="values",T="entries",w=function(){return this};e.exports=function(e,t,n,o,m,v,R){u(n,t,o);var Z,S,C,I=function(e){if(e===m&&P)return P;if(!M&&e in O)return O[e];switch(e){case _:case x:case T:return function(){return new n(this,e)}}return function(){return new n(this)}},E=t+" Iterator",A=!1,O=e.prototype,D=O[k]||O["@@iterator"]||m&&O[m],P=!M&&D||I(m),B="Array"==t&&O.entries||D;if(B&&(Z=c(B.call(new e)))!==Object.prototype&&Z.next&&(a||c(Z)===b||(l?l(Z,b):s(Z[k])||p(Z,k,w)),h(Z,E,!0,!0),a&&(d[E]=w)),y&&m==x&&D&&D.name!==x&&(!a&&g?f(O,"name",x):(A=!0,P=function(){return i(D,this)})),m)if(S={values:I(x),keys:v?P:I(_),entries:I(T)},R)for(C in S)(M||A||!(C in O))&&p(O,C,S[C]);else r({target:t,proto:!0,forced:M||A},S);return a&&!R||O[k]===P||p(O,k,P,{name:m}),d[t]=P,S}},487:function(e,t,n){"use strict";var r=n(6916),i=n(9662),a=n(9670),o=n(4942),s=n(4956),u=n(3411),c=s((function(){var e=this.iterator,t=a(r(this.next,e));if(!(this.done=!!t.done))return u(e,this.mapper,[t.value,this.counter++],!0)}));e.exports=function(e){return a(this),i(e),new c(o(this),{mapper:e})}},3383:function(e,t,n){"use strict";var r,i,a,o=n(7293),s=n(614),u=n(111),c=n(30),l=n(9518),h=n(8052),f=n(5112),p=n(1913),m=f("iterator"),d=!1;[].keys&&("next"in(a=[].keys())?(i=l(l(a)))!==Object.prototype&&(r=i):d=!0),!u(r)||o((function(){var e={};return r[m].call(e)!==e}))?r={}:p&&(r=c(r)),s(r[m])||h(r,m,(function(){return this})),e.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:d}},7497:function(e){e.exports={}},6244:function(e,t,n){var r=n(7466);e.exports=function(e){return r(e.length)}},6339:function(e,t,n){var r=n(1702),i=n(7293),a=n(614),o=n(2597),s=n(9781),u=n(6530).CONFIGURABLE,c=n(2788),l=n(9909),h=l.enforce,f=l.get,p=String,m=Object.defineProperty,d=r("".slice),v=r("".replace),y=r([].join),g=s&&!i((function(){return 8!==m((function(){}),"length",{value:8}).length})),b=String(String).split("String"),M=e.exports=function(e,t,n){"Symbol("===d(p(t),0,7)&&(t="["+v(p(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!o(e,"name")||u&&e.name!==t)&&(s?m(e,"name",{value:t,configurable:!0}):e.name=t),g&&n&&o(n,"arity")&&e.length!==n.arity&&m(e,"length",{value:n.arity});try{n&&o(n,"constructor")&&n.constructor?s&&m(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=h(e);return o(r,"source")||(r.source=y(b,"string"==typeof t?t:"")),e};Function.prototype.toString=M((function(){return a(this)&&f(this).source||c(this)}),"toString")},5706:function(e,t,n){var r=n(1702),i=Map.prototype;e.exports={Map:Map,set:r(i.set),get:r(i.get),has:r(i.has),remove:r(i.delete),proto:i}},4995:function(e,t,n){var r=n(1702),i=n(6333),a=n(5706),o=a.Map,s=a.proto,u=r(s.forEach),c=r(s.entries),l=c(new o).next;e.exports=function(e,t,n){return n?i(c(e),(function(e){return t(e[1],e[0])}),l):u(e,t)}},4758:function(e){var t=Math.ceil,n=Math.floor;e.exports=Math.trunc||function(e){var r=+e;return(r>0?n:t)(r)}},5948:function(e,t,n){var r,i,a,o,s,u=n(7854),c=n(9974),l=n(1236).f,h=n(261).set,f=n(8572),p=n(6833),m=n(1528),d=n(1036),v=n(5268),y=u.MutationObserver||u.WebKitMutationObserver,g=u.document,b=u.process,M=u.Promise,k=l(u,"queueMicrotask"),_=k&&k.value;if(!_){var x=new f,T=function(){var e,t;for(v&&(e=b.domain)&&e.exit();t=x.get();)try{t()}catch(e){throw x.head&&r(),e}e&&e.enter()};p||v||d||!y||!g?!m&&M&&M.resolve?((o=M.resolve(void 0)).constructor=M,s=c(o.then,o),r=function(){s(T)}):v?r=function(){b.nextTick(T)}:(h=c(h,u),r=function(){h(T)}):(i=!0,a=g.createTextNode(""),new y(T).observe(a,{characterData:!0}),r=function(){a.data=i=!i}),_=function(e){x.head||r(),x.add(e)}}e.exports=_},8523:function(e,t,n){"use strict";var r=n(9662),i=TypeError,a=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw i("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)};e.exports.f=function(e){return new a(e)}},6277:function(e,t,n){var r=n(1340);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:r(e)}},3929:function(e,t,n){var r=n(7850),i=TypeError;e.exports=function(e){if(r(e))throw i("The method doesn't accept regular expressions");return e}},7023:function(e,t,n){var r=n(7854).isFinite;e.exports=Number.isFinite||function(e){return"number"==typeof e&&r(e)}},2814:function(e,t,n){var r=n(7854),i=n(7293),a=n(1702),o=n(1340),s=n(3111).trim,u=n(1361),c=a("".charAt),l=r.parseFloat,h=r.Symbol,f=h&&h.iterator,p=1/l(u+"-0")!=-1/0||f&&!i((function(){l(Object(f))}));e.exports=p?function(e){var t=s(o(e)),n=l(t);return 0===n&&"-"==c(t,0)?-0:n}:l},1574:function(e,t,n){"use strict";var r=n(9781),i=n(1702),a=n(6916),o=n(7293),s=n(1956),u=n(5181),c=n(5296),l=n(7908),h=n(8361),f=Object.assign,p=Object.defineProperty,m=i([].concat);e.exports=!f||o((function(){if(r&&1!==f({b:1},f(p({},"a",{enumerable:!0,get:function(){p(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach((function(e){t[e]=e})),7!=f({},e)[n]||s(f({},t)).join("")!=i}))?function(e,t){for(var n=l(e),i=arguments.length,o=1,f=u.f,p=c.f;i>o;)for(var d,v=h(arguments[o++]),y=f?m(s(v),f(v)):s(v),g=y.length,b=0;g>b;)d=y[b++],r&&!a(p,v,d)||(n[d]=v[d]);return n}:f},30:function(e,t,n){var r,i=n(9670),a=n(6048),o=n(748),s=n(3501),u=n(490),c=n(317),l=n(6200),h="prototype",f="script",p=l("IE_PROTO"),m=function(){},d=function(e){return"<"+f+">"+e+"</"+f+">"},v=function(e){e.write(d("")),e.close();var t=e.parentWindow.Object;return e=null,t},y=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}var e,t,n;y="undefined"!=typeof document?document.domain&&r?v(r):(t=c("iframe"),n="java"+f+":",t.style.display="none",u.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(d("document.F=Object")),e.close(),e.F):v(r);for(var i=o.length;i--;)delete y[h][o[i]];return y()};s[p]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(m[h]=i(e),n=new m,m[h]=null,n[p]=e):n=y(),void 0===t?n:a.f(n,t)}},6048:function(e,t,n){var r=n(9781),i=n(3353),a=n(3070),o=n(9670),s=n(5656),u=n(1956);t.f=r&&!i?Object.defineProperties:function(e,t){o(e);for(var n,r=s(t),i=u(t),c=i.length,l=0;c>l;)a.f(e,n=i[l++],r[n]);return e}},3070:function(e,t,n){var r=n(9781),i=n(4664),a=n(3353),o=n(9670),s=n(4948),u=TypeError,c=Object.defineProperty,l=Object.getOwnPropertyDescriptor,h="enumerable",f="configurable",p="writable";t.f=r?a?function(e,t,n){if(o(e),t=s(t),o(n),"function"==typeof e&&"prototype"===t&&"value"in n&&p in n&&!n[p]){var r=l(e,t);r&&r[p]&&(e[t]=n.value,n={configurable:f in n?n[f]:r[f],enumerable:h in n?n[h]:r[h],writable:!1})}return c(e,t,n)}:c:function(e,t,n){if(o(e),t=s(t),o(n),i)try{return c(e,t,n)}catch(e){}if("get"in n||"set"in n)throw u("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},1236:function(e,t,n){var r=n(9781),i=n(6916),a=n(5296),o=n(9114),s=n(5656),u=n(4948),c=n(2597),l=n(4664),h=Object.getOwnPropertyDescriptor;t.f=r?h:function(e,t){if(e=s(e),t=u(t),l)try{return h(e,t)}catch(e){}if(c(e,t))return o(!i(a.f,e,t),e[t])}},1156:function(e,t,n){var r=n(4326),i=n(5656),a=n(8006).f,o=n(1589),s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"Window"==r(e)?function(e){try{return a(e)}catch(e){return o(s)}}(e):a(i(e))}},8006:function(e,t,n){var r=n(6324),i=n(748).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},5181:function(e,t){t.f=Object.getOwnPropertySymbols},9518:function(e,t,n){var r=n(2597),i=n(614),a=n(7908),o=n(6200),s=n(8544),u=o("IE_PROTO"),c=Object,l=c.prototype;e.exports=s?c.getPrototypeOf:function(e){var t=a(e);if(r(t,u))return t[u];var n=t.constructor;return i(n)&&t instanceof n?n.prototype:t instanceof c?l:null}},2050:function(e,t,n){var r=n(7293),i=n(111),a=n(4326),o=n(7556),s=Object.isExtensible,u=r((function(){s(1)}));e.exports=u||o?function(e){return!!i(e)&&((!o||"ArrayBuffer"!=a(e))&&(!s||s(e)))}:s},7976:function(e,t,n){var r=n(1702);e.exports=r({}.isPrototypeOf)},6324:function(e,t,n){var r=n(1702),i=n(2597),a=n(5656),o=n(1318).indexOf,s=n(3501),u=r([].push);e.exports=function(e,t){var n,r=a(e),c=0,l=[];for(n in r)!i(s,n)&&i(r,n)&&u(l,n);for(;t.length>c;)i(r,n=t[c++])&&(~o(l,n)||u(l,n));return l}},1956:function(e,t,n){var r=n(6324),i=n(748);e.exports=Object.keys||function(e){return r(e,i)}},5296:function(e,t){"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!n.call({1:2},1);t.f=i?function(e){var t=r(this,e);return!!t&&t.enumerable}:n},7674:function(e,t,n){var r=n(5668),i=n(9670),a=n(6077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=r(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return i(n),a(r),t?e(n,r):n.__proto__=r,n}}():void 0)},4699:function(e,t,n){var r=n(9781),i=n(1702),a=n(1956),o=n(5656),s=i(n(5296).f),u=i([].push),c=function(e){return function(t){for(var n,i=o(t),c=a(i),l=c.length,h=0,f=[];l>h;)n=c[h++],r&&!s(i,n)||u(f,e?[n,i[n]]:i[n]);return f}};e.exports={entries:c(!0),values:c(!1)}},288:function(e,t,n){"use strict";var r=n(1694),i=n(648);e.exports=r?{}.toString:function(){return"[object "+i(this)+"]"}},2140:function(e,t,n){var r=n(6916),i=n(614),a=n(111),o=TypeError;e.exports=function(e,t){var n,s;if("string"===t&&i(n=e.toString)&&!a(s=r(n,e)))return s;if(i(n=e.valueOf)&&!a(s=r(n,e)))return s;if("string"!==t&&i(n=e.toString)&&!a(s=r(n,e)))return s;throw o("Can't convert object to primitive value")}},3887:function(e,t,n){var r=n(5005),i=n(1702),a=n(8006),o=n(5181),s=n(9670),u=i([].concat);e.exports=r("Reflect","ownKeys")||function(e){var t=a.f(s(e)),n=o.f;return n?u(t,n(e)):t}},857:function(e,t,n){var r=n(7854);e.exports=r},2534:function(e){e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},3702:function(e,t,n){var r=n(7854),i=n(2492),a=n(614),o=n(4705),s=n(2788),u=n(5112),c=n(7871),l=n(3823),h=n(1913),f=n(7392),p=i&&i.prototype,m=u("species"),d=!1,v=a(r.PromiseRejectionEvent),y=o("Promise",(function(){var e=s(i),t=e!==String(i);if(!t&&66===f)return!0;if(h&&(!p.catch||!p.finally))return!0;if(!f||f<51||!/native code/.test(e)){var n=new i((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((n.constructor={})[m]=r,!(d=n.then((function(){}))instanceof r))return!0}return!t&&(c||l)&&!v}));e.exports={CONSTRUCTOR:y,REJECTION_EVENT:v,SUBCLASSING:d}},2492:function(e,t,n){var r=n(7854);e.exports=r.Promise},9478:function(e,t,n){var r=n(9670),i=n(111),a=n(8523);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=a.f(e);return(0,n.resolve)(t),n.promise}},612:function(e,t,n){var r=n(2492),i=n(7072),a=n(3702).CONSTRUCTOR;e.exports=a||!i((function(e){r.all(e).then(void 0,(function(){}))}))},2626:function(e,t,n){var r=n(3070).f;e.exports=function(e,t,n){n in e||r(e,n,{configurable:!0,get:function(){return t[n]},set:function(e){t[n]=e}})}},8572:function(e){var t=function(){this.head=null,this.tail=null};t.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},e.exports=t},7651:function(e,t,n){var r=n(6916),i=n(9670),a=n(614),o=n(4326),s=n(2261),u=TypeError;e.exports=function(e,t){var n=e.exec;if(a(n)){var c=r(n,e,t);return null!==c&&i(c),c}if("RegExp"===o(e))return r(s,e,t);throw u("RegExp#exec called on incompatible receiver")}},2261:function(e,t,n){"use strict";var r,i,a=n(6916),o=n(1702),s=n(1340),u=n(7066),c=n(2999),l=n(2309),h=n(30),f=n(9909).get,p=n(9441),m=n(7168),d=l("native-string-replace",String.prototype.replace),v=RegExp.prototype.exec,y=v,g=o("".charAt),b=o("".indexOf),M=o("".replace),k=o("".slice),_=(i=/b*/g,a(v,r=/a/,"a"),a(v,i,"a"),0!==r.lastIndex||0!==i.lastIndex),x=c.BROKEN_CARET,T=void 0!==/()??/.exec("")[1];(_||T||x||p||m)&&(y=function(e){var t,n,r,i,o,c,l,p=this,m=f(p),w=s(e),R=m.raw;if(R)return R.lastIndex=p.lastIndex,t=a(y,R,w),p.lastIndex=R.lastIndex,t;var Z=m.groups,S=x&&p.sticky,C=a(u,p),I=p.source,E=0,A=w;if(S&&(C=M(C,"y",""),-1===b(C,"g")&&(C+="g"),A=k(w,p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==g(w,p.lastIndex-1))&&(I="(?: "+I+")",A=" "+A,E++),n=new RegExp("^(?:"+I+")",C)),T&&(n=new RegExp("^"+I+"$(?!\\s)",C)),_&&(r=p.lastIndex),i=a(v,S?n:p,A),S?i?(i.input=k(i.input,E),i[0]=k(i[0],E),i.index=p.lastIndex,p.lastIndex+=i[0].length):p.lastIndex=0:_&&i&&(p.lastIndex=p.global?i.index+i[0].length:r),T&&i&&i.length>1&&a(d,i[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i&&Z)for(i.groups=c=h(null),o=0;o<Z.length;o++)c[(l=Z[o])[0]]=i[l[1]];return i}),e.exports=y},7066:function(e,t,n){"use strict";var r=n(9670);e.exports=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},4706:function(e,t,n){var r=n(6916),i=n(2597),a=n(7976),o=n(7066),s=RegExp.prototype;e.exports=function(e){var t=e.flags;return void 0!==t||"flags"in s||i(e,"flags")||!a(s,e)?t:r(o,e)}},2999:function(e,t,n){var r=n(7293),i=n(7854).RegExp,a=r((function(){var e=i("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),o=a||r((function(){return!i("a","y").sticky})),s=a||r((function(){var e=i("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));e.exports={BROKEN_CARET:s,MISSED_STICKY:o,UNSUPPORTED_Y:a}},9441:function(e,t,n){var r=n(7293),i=n(7854).RegExp;e.exports=r((function(){var e=i(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)}))},7168:function(e,t,n){var r=n(7293),i=n(7854).RegExp;e.exports=r((function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},4488:function(e,t,n){var r=n(8554),i=TypeError;e.exports=function(e){if(r(e))throw i("Can't call method on "+e);return e}},6465:function(e){e.exports=function(e,t){return e===t||e!=e&&t!=t}},1150:function(e){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},9405:function(e,t,n){var r=n(1702),i=Set.prototype;e.exports={Set:Set,add:r(i.add),has:r(i.has),remove:r(i.delete),proto:i}},6340:function(e,t,n){"use strict";var r=n(5005),i=n(7045),a=n(5112),o=n(9781),s=a("species");e.exports=function(e){var t=r(e);o&&t&&!t[s]&&i(t,s,{configurable:!0,get:function(){return this}})}},8003:function(e,t,n){var r=n(3070).f,i=n(2597),a=n(5112)("toStringTag");e.exports=function(e,t,n){e&&!n&&(e=e.prototype),e&&!i(e,a)&&r(e,a,{configurable:!0,value:t})}},6200:function(e,t,n){var r=n(2309),i=n(9711),a=r("keys");e.exports=function(e){return a[e]||(a[e]=i(e))}},5465:function(e,t,n){var r=n(7854),i=n(3072),a="__core-js_shared__",o=r[a]||i(a,{});e.exports=o},2309:function(e,t,n){var r=n(1913),i=n(5465);(e.exports=function(e,t){return i[e]||(i[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.30.1",mode:r?"pure":"global",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.1/LICENSE",source:"https://github.com/zloirock/core-js"})},6707:function(e,t,n){var r=n(9670),i=n(9483),a=n(8554),o=n(5112)("species");e.exports=function(e,t){var n,s=r(e).constructor;return void 0===s||a(n=r(s)[o])?t:i(n)}},3429:function(e,t,n){var r=n(7293);e.exports=function(e){return r((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}},8710:function(e,t,n){var r=n(1702),i=n(9303),a=n(1340),o=n(4488),s=r("".charAt),u=r("".charCodeAt),c=r("".slice),l=function(e){return function(t,n){var r,l,h=a(o(t)),f=i(n),p=h.length;return f<0||f>=p?e?"":void 0:(r=u(h,f))<55296||r>56319||f+1===p||(l=u(h,f+1))<56320||l>57343?e?s(h,f):r:e?c(h,f,f+2):l-56320+(r-55296<<10)+65536}};e.exports={codeAt:l(!1),charAt:l(!0)}},4986:function(e,t,n){var r=n(8113);e.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(r)},6650:function(e,t,n){var r=n(1702),i=n(7466),a=n(1340),o=n(8415),s=n(4488),u=r(o),c=r("".slice),l=Math.ceil,h=function(e){return function(t,n,r){var o,h,f=a(s(t)),p=i(n),m=f.length,d=void 0===r?" ":a(r);return p<=m||""==d?f:((h=u(d,l((o=p-m)/d.length))).length>o&&(h=c(h,0,o)),e?f+h:h+f)}};e.exports={start:h(!1),end:h(!0)}},3197:function(e,t,n){var r=n(1702),i=2147483647,a=/[^\0-\u007E]/,o=/[.\u3002\uFF0E\uFF61]/g,s="Overflow: input needs wider integers to process",u=RangeError,c=r(o.exec),l=Math.floor,h=String.fromCharCode,f=r("".charCodeAt),p=r([].join),m=r([].push),d=r("".replace),v=r("".split),y=r("".toLowerCase),g=function(e){return e+22+75*(e<26)},b=function(e,t,n){var r=0;for(e=n?l(e/700):e>>1,e+=l(e/t);e>455;)e=l(e/35),r+=36;return l(r+36*e/(e+38))},M=function(e){var t=[];e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=f(e,n++);if(i>=55296&&i<=56319&&n<r){var a=f(e,n++);56320==(64512&a)?m(t,((1023&i)<<10)+(1023&a)+65536):(m(t,i),n--)}else m(t,i)}return t}(e);var n,r,a=e.length,o=128,c=0,d=72;for(n=0;n<e.length;n++)(r=e[n])<128&&m(t,h(r));var v=t.length,y=v;for(v&&m(t,"-");y<a;){var M=i;for(n=0;n<e.length;n++)(r=e[n])>=o&&r<M&&(M=r);var k=y+1;if(M-o>l((i-c)/k))throw u(s);for(c+=(M-o)*k,o=M,n=0;n<e.length;n++){if((r=e[n])<o&&++c>i)throw u(s);if(r==o){for(var _=c,x=36;;){var T=x<=d?1:x>=d+26?26:x-d;if(_<T)break;var w=_-T,R=36-T;m(t,h(g(T+w%R))),_=l(w/R),x+=36}m(t,h(g(_))),d=b(c,k,y==v),c=0,y++}}c++,o++}return p(t,"")};e.exports=function(e){var t,n,r=[],i=v(d(y(e),o,"."),".");for(t=0;t<i.length;t++)n=i[t],m(r,c(a,n)?"xn--"+M(n):n);return p(r,".")}},8415:function(e,t,n){"use strict";var r=n(9303),i=n(1340),a=n(4488),o=RangeError;e.exports=function(e){var t=i(a(this)),n="",s=r(e);if(s<0||s==1/0)throw o("Wrong number of repetitions");for(;s>0;(s>>>=1)&&(t+=t))1&s&&(n+=t);return n}},6091:function(e,t,n){var r=n(6530).PROPER,i=n(7293),a=n(1361);e.exports=function(e){return i((function(){return!!a[e]()||""!==""[e]()||r&&a[e].name!==e}))}},3111:function(e,t,n){var r=n(1702),i=n(4488),a=n(1340),o=n(1361),s=r("".replace),u=RegExp("^["+o+"]+"),c=RegExp("(^|[^"+o+"])["+o+"]+$"),l=function(e){return function(t){var n=a(i(t));return 1&e&&(n=s(n,u,"")),2&e&&(n=s(n,c,"$1")),n}};e.exports={start:l(1),end:l(2),trim:l(3)}},4124:function(e,t,n){var r=n(7854),i=n(7293),a=n(7392),o=n(7871),s=n(3823),u=n(5268),c=r.structuredClone;e.exports=!!c&&!i((function(){if(s&&a>92||u&&a>94||o&&a>97)return!1;var e=new ArrayBuffer(8),t=c(e,{transfer:[e]});return 0!=e.byteLength||8!=t.byteLength}))},6293:function(e,t,n){var r=n(7392),i=n(7293);e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},6532:function(e,t,n){var r=n(6916),i=n(5005),a=n(5112),o=n(8052);e.exports=function(){var e=i("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,s=a("toPrimitive");t&&!t[s]&&o(t,s,(function(e){return r(n,this)}),{arity:1})}},2015:function(e,t,n){var r=n(6293);e.exports=r&&!!Symbol.for&&!!Symbol.keyFor},261:function(e,t,n){var r,i,a,o,s=n(7854),u=n(2104),c=n(9974),l=n(614),h=n(2597),f=n(7293),p=n(490),m=n(206),d=n(317),v=n(8053),y=n(6833),g=n(5268),b=s.setImmediate,M=s.clearImmediate,k=s.process,_=s.Dispatch,x=s.Function,T=s.MessageChannel,w=s.String,R=0,Z={},S="onreadystatechange";f((function(){r=s.location}));var C=function(e){if(h(Z,e)){var t=Z[e];delete Z[e],t()}},I=function(e){return function(){C(e)}},E=function(e){C(e.data)},A=function(e){s.postMessage(w(e),r.protocol+"//"+r.host)};b&&M||(b=function(e){v(arguments.length,1);var t=l(e)?e:x(e),n=m(arguments,1);return Z[++R]=function(){u(t,void 0,n)},i(R),R},M=function(e){delete Z[e]},g?i=function(e){k.nextTick(I(e))}:_&&_.now?i=function(e){_.now(I(e))}:T&&!y?(o=(a=new T).port2,a.port1.onmessage=E,i=c(o.postMessage,o)):s.addEventListener&&l(s.postMessage)&&!s.importScripts&&r&&"file:"!==r.protocol&&!f(A)?(i=A,s.addEventListener("message",E,!1)):i=S in d("script")?function(e){p.appendChild(d("script"))[S]=function(){p.removeChild(this),C(e)}}:function(e){setTimeout(I(e),0)}),e.exports={set:b,clear:M}},863:function(e,t,n){var r=n(1702);e.exports=r(1..valueOf)},1400:function(e,t,n){var r=n(9303),i=Math.max,a=Math.min;e.exports=function(e,t){var n=r(e);return n<0?i(n+t,0):a(n,t)}},4599:function(e,t,n){var r=n(7593),i=TypeError;e.exports=function(e){var t=r(e,"number");if("number"==typeof t)throw i("Can't convert number to bigint");return BigInt(t)}},7067:function(e,t,n){var r=n(9303),i=n(7466),a=RangeError;e.exports=function(e){if(void 0===e)return 0;var t=r(e),n=i(t);if(t!==n)throw a("Wrong length or index");return n}},5656:function(e,t,n){var r=n(8361),i=n(4488);e.exports=function(e){return r(i(e))}},9303:function(e,t,n){var r=n(4758);e.exports=function(e){var t=+e;return t!=t||0===t?0:r(t)}},7466:function(e,t,n){var r=n(9303),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},7908:function(e,t,n){var r=n(4488),i=Object;e.exports=function(e){return i(r(e))}},4590:function(e,t,n){var r=n(3002),i=RangeError;e.exports=function(e,t){var n=r(e);if(n%t)throw i("Wrong offset");return n}},3002:function(e,t,n){var r=n(9303),i=RangeError;e.exports=function(e){var t=r(e);if(t<0)throw i("The argument can't be less than 0");return t}},7593:function(e,t,n){var r=n(6916),i=n(111),a=n(2190),o=n(8173),s=n(2140),u=n(5112),c=TypeError,l=u("toPrimitive");e.exports=function(e,t){if(!i(e)||a(e))return e;var n,u=o(e,l);if(u){if(void 0===t&&(t="default"),n=r(u,e,t),!i(n)||a(n))return n;throw c("Can't convert object to primitive value")}return void 0===t&&(t="number"),s(e,t)}},4948:function(e,t,n){var r=n(7593),i=n(2190);e.exports=function(e){var t=r(e,"string");return i(t)?t:t+""}},1694:function(e,t,n){var r={};r[n(5112)("toStringTag")]="z",e.exports="[object z]"===String(r)},1340:function(e,t,n){var r=n(648),i=String;e.exports=function(e){if("Symbol"===r(e))throw TypeError("Cannot convert a Symbol value to a string");return i(e)}},4038:function(e,t,n){var r=n(5268);e.exports=function(e){try{if(r)return Function('return require("'+e+'")')()}catch(e){}}},6330:function(e){var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},9843:function(e,t,n){"use strict";var r=n(2109),i=n(7854),a=n(6916),o=n(9781),s=n(3832),u=n(260),c=n(3331),l=n(5787),h=n(9114),f=n(8880),p=n(5988),m=n(7466),d=n(7067),v=n(4590),y=n(4948),g=n(2597),b=n(648),M=n(111),k=n(2190),_=n(30),x=n(7976),T=n(7674),w=n(8006).f,R=n(7321),Z=n(2092).forEach,S=n(6340),C=n(7045),I=n(3070),E=n(1236),A=n(9909),O=n(9587),D=A.get,P=A.set,B=A.enforce,F=I.f,L=E.f,N=Math.round,j=i.RangeError,z=c.ArrayBuffer,U=z.prototype,V=c.DataView,H=u.NATIVE_ARRAY_BUFFER_VIEWS,G=u.TYPED_ARRAY_TAG,q=u.TypedArray,W=u.TypedArrayPrototype,Y=u.aTypedArrayConstructor,K=u.isTypedArray,X="BYTES_PER_ELEMENT",$="Wrong length",Q=function(e,t){Y(e);for(var n=0,r=t.length,i=new e(r);r>n;)i[n]=t[n++];return i},J=function(e,t){C(e,t,{configurable:!0,get:function(){return D(this)[t]}})},ee=function(e){var t;return x(U,e)||"ArrayBuffer"==(t=b(e))||"SharedArrayBuffer"==t},te=function(e,t){return K(e)&&!k(t)&&t in e&&p(+t)&&t>=0},ne=function(e,t){return t=y(t),te(e,t)?h(2,e[t]):L(e,t)},re=function(e,t,n){return t=y(t),!(te(e,t)&&M(n)&&g(n,"value"))||g(n,"get")||g(n,"set")||n.configurable||g(n,"writable")&&!n.writable||g(n,"enumerable")&&!n.enumerable?F(e,t,n):(e[t]=n.value,e)};o?(H||(E.f=ne,I.f=re,J(W,"buffer"),J(W,"byteOffset"),J(W,"byteLength"),J(W,"length")),r({target:"Object",stat:!0,forced:!H},{getOwnPropertyDescriptor:ne,defineProperty:re}),e.exports=function(e,t,n){var o=e.match(/\d+/)[0]/8,u=e+(n?"Clamped":"")+"Array",c="get"+e,h="set"+e,p=i[u],y=p,g=y&&y.prototype,b={},k=function(e,t){F(e,t,{get:function(){return function(e,t){var n=D(e);return n.view[c](t*o+n.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,r){var i=D(e);n&&(r=(r=N(r))<0?0:r>255?255:255&r),i.view[h](t*o+i.byteOffset,r,!0)}(this,t,e)},enumerable:!0})};H?s&&(y=t((function(e,t,n,r){return l(e,g),O(M(t)?ee(t)?void 0!==r?new p(t,v(n,o),r):void 0!==n?new p(t,v(n,o)):new p(t):K(t)?Q(y,t):a(R,y,t):new p(d(t)),e,y)})),T&&T(y,q),Z(w(p),(function(e){e in y||f(y,e,p[e])})),y.prototype=g):(y=t((function(e,t,n,r){l(e,g);var i,s,u,c=0,h=0;if(M(t)){if(!ee(t))return K(t)?Q(y,t):a(R,y,t);i=t,h=v(n,o);var f=t.byteLength;if(void 0===r){if(f%o)throw j($);if((s=f-h)<0)throw j($)}else if((s=m(r)*o)+h>f)throw j($);u=s/o}else u=d(t),i=new z(s=u*o);for(P(e,{buffer:i,byteOffset:h,byteLength:s,length:u,view:new V(i)});c<u;)k(e,c++)})),T&&T(y,q),g=y.prototype=_(W)),g.constructor!==y&&f(g,"constructor",y),B(g).TypedArrayConstructor=y,G&&f(g,G,u);var x=y!=p;b[u]=y,r({global:!0,constructor:!0,forced:x,sham:!H},b),X in y||f(y,X,o),X in g||f(g,X,o),S(u)}):e.exports=function(){}},3832:function(e,t,n){var r=n(7854),i=n(7293),a=n(7072),o=n(260).NATIVE_ARRAY_BUFFER_VIEWS,s=r.ArrayBuffer,u=r.Int8Array;e.exports=!o||!i((function(){u(1)}))||!i((function(){new u(-1)}))||!a((function(e){new u,new u(null),new u(1.5),new u(e)}),!0)||i((function(){return 1!==new u(new s(2),1,void 0).length}))},3074:function(e,t,n){var r=n(7745),i=n(6304);e.exports=function(e,t){return r(i(e),t)}},7321:function(e,t,n){var r=n(9974),i=n(6916),a=n(9483),o=n(7908),s=n(6244),u=n(4121),c=n(1246),l=n(7659),h=n(4067),f=n(260).aTypedArrayConstructor,p=n(4599);e.exports=function(e){var t,n,m,d,v,y,g,b,M=a(this),k=o(e),_=arguments.length,x=_>1?arguments[1]:void 0,T=void 0!==x,w=c(k);if(w&&!l(w))for(b=(g=u(k,w)).next,k=[];!(y=i(b,g)).done;)k.push(y.value);for(T&&_>2&&(x=r(x,arguments[2])),n=s(k),m=new(f(M))(n),d=h(m),t=0;n>t;t++)v=T?x(k[t],t):k[t],m[t]=d?p(v):+v;return m}},6304:function(e,t,n){var r=n(260),i=n(6707),a=r.aTypedArrayConstructor,o=r.getTypedArrayConstructor;e.exports=function(e){return a(i(e,o(e)))}},9711:function(e,t,n){var r=n(1702),i=0,a=Math.random(),o=r(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+o(++i+a,36)}},5143:function(e,t,n){var r=n(7293),i=n(5112),a=n(9781),o=n(1913),s=i("iterator");e.exports=!r((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),o&&!e.toJSON||!t.size&&(o||!a)||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[s]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://").host||"#%D0%B1"!==new URL("http://a#").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host}))},3307:function(e,t,n){var r=n(6293);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3353:function(e,t,n){var r=n(9781),i=n(7293);e.exports=r&&i((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},8053:function(e){var t=TypeError;e.exports=function(e,n){if(e<n)throw t("Not enough arguments");return e}},4811:function(e,t,n){var r=n(7854),i=n(614),a=r.WeakMap;e.exports=i(a)&&/native code/.test(String(a))},953:function(e,t,n){var r=n(1702),i=WeakMap.prototype;e.exports={WeakMap:WeakMap,set:r(i.set),get:r(i.get),has:r(i.has),remove:r(i.delete)}},6800:function(e,t,n){var r=n(857),i=n(2597),a=n(6061),o=n(3070).f;e.exports=function(e){var t=r.Symbol||(r.Symbol={});i(t,e)||o(t,e,{value:a.f(e)})}},6061:function(e,t,n){var r=n(5112);t.f=r},5112:function(e,t,n){var r=n(7854),i=n(2309),a=n(2597),o=n(9711),s=n(6293),u=n(3307),c=r.Symbol,l=i("wks"),h=u?c.for||c:c&&c.withoutSetter||o;e.exports=function(e){return a(l,e)||(l[e]=s&&a(c,e)?c[e]:h("Symbol."+e)),l[e]}},1361:function(e){e.exports="\t\n\v\f\r \u2028\u2029\ufeff"},9191:function(e,t,n){"use strict";var r=n(5005),i=n(2597),a=n(8880),o=n(7976),s=n(7674),u=n(9920),c=n(2626),l=n(9587),h=n(6277),f=n(8340),p=n(5392),m=n(9781),d=n(1913);e.exports=function(e,t,n,v){var y="stackTraceLimit",g=v?2:1,b=e.split("."),M=b[b.length-1],k=r.apply(null,b);if(k){var _=k.prototype;if(!d&&i(_,"cause")&&delete _.cause,!n)return k;var x=r("Error"),T=t((function(e,t){var n=h(v?t:e,void 0),r=v?new k(e):new k;return void 0!==n&&a(r,"message",n),p(r,T,r.stack,2),this&&o(_,this)&&l(r,this,T),arguments.length>g&&f(r,arguments[g]),r}));if(T.prototype=_,"Error"!==M?s?s(T,x):u(T,x,{name:!0}):m&&y in k&&(c(T,k,y),c(T,k,"prepareStackTrace")),u(T,k),!d)try{_.name!==M&&a(_,"name",M),_.constructor=T}catch(e){}return T}}},2222:function(e,t,n){"use strict";var r=n(2109),i=n(7293),a=n(3157),o=n(111),s=n(7908),u=n(6244),c=n(7207),l=n(6135),h=n(5417),f=n(1194),p=n(5112),m=n(7392),d=p("isConcatSpreadable"),v=m>=51||!i((function(){var e=[];return e[d]=!1,e.concat()[0]!==e})),y=function(e){if(!o(e))return!1;var t=e[d];return void 0!==t?!!t:a(e)};r({target:"Array",proto:!0,arity:1,forced:!v||!f("concat")},{concat:function(e){var t,n,r,i,a,o=s(this),f=h(o,0),p=0;for(t=-1,r=arguments.length;t<r;t++)if(y(a=-1===t?o:arguments[t]))for(i=u(a),c(p+i),n=0;n<i;n++,p++)n in a&&l(f,p,a[n]);else c(p+1),l(f,p++,a);return f.length=p,f}})},3290:function(e,t,n){var r=n(2109),i=n(1285),a=n(1223);r({target:"Array",proto:!0},{fill:i}),a("fill")},7327:function(e,t,n){"use strict";var r=n(2109),i=n(2092).filter;r({target:"Array",proto:!0,forced:!n(1194)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},4553:function(e,t,n){"use strict";var r=n(2109),i=n(2092).findIndex,a=n(1223),o="findIndex",s=!0;o in[]&&Array(1)[o]((function(){s=!1})),r({target:"Array",proto:!0,forced:s},{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),a(o)},9826:function(e,t,n){"use strict";var r=n(2109),i=n(2092).find,a=n(1223),o="find",s=!0;o in[]&&Array(1)[o]((function(){s=!1})),r({target:"Array",proto:!0,forced:s},{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),a(o)},1038:function(e,t,n){var r=n(2109),i=n(8457);r({target:"Array",stat:!0,forced:!n(7072)((function(e){Array.from(e)}))},{from:i})},6699:function(e,t,n){"use strict";var r=n(2109),i=n(1318).includes,a=n(7293),o=n(1223);r({target:"Array",proto:!0,forced:a((function(){return!Array(1).includes()}))},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},6992:function(e,t,n){"use strict";var r=n(5656),i=n(1223),a=n(7497),o=n(9909),s=n(3070).f,u=n(1656),c=n(6178),l=n(1913),h=n(9781),f="Array Iterator",p=o.set,m=o.getterFor(f);e.exports=u(Array,"Array",(function(e,t){p(this,{type:f,target:r(e),index:0,kind:t})}),(function(){var e=m(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,c(void 0,!0)):c("keys"==n?r:"values"==n?t[r]:[r,t[r]],!1)}),"values");var d=a.Arguments=a.Array;if(i("keys"),i("values"),i("entries"),!l&&h&&"values"!==d.name)try{s(d,"name",{value:"values"})}catch(e){}},9600:function(e,t,n){"use strict";var r=n(2109),i=n(1702),a=n(8361),o=n(5656),s=n(9341),u=i([].join);r({target:"Array",proto:!0,forced:a!=Object||!s("join",",")},{join:function(e){return u(o(this),void 0===e?",":e)}})},1249:function(e,t,n){"use strict";var r=n(2109),i=n(2092).map;r({target:"Array",proto:!0,forced:!n(1194)("map")},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},7658:function(e,t,n){"use strict";var r=n(2109),i=n(7908),a=n(6244),o=n(3658),s=n(7207);r({target:"Array",proto:!0,arity:1,forced:n(7293)((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}}()},{push:function(e){var t=i(this),n=a(t),r=arguments.length;s(n+r);for(var u=0;u<r;u++)t[n]=arguments[u],n++;return o(t,n),n}})},7042:function(e,t,n){"use strict";var r=n(2109),i=n(3157),a=n(4411),o=n(111),s=n(1400),u=n(6244),c=n(5656),l=n(6135),h=n(5112),f=n(1194),p=n(206),m=f("slice"),d=h("species"),v=Array,y=Math.max;r({target:"Array",proto:!0,forced:!m},{slice:function(e,t){var n,r,h,f=c(this),m=u(f),g=s(e,m),b=s(void 0===t?m:t,m);if(i(f)&&(n=f.constructor,(a(n)&&(n===v||i(n.prototype))||o(n)&&null===(n=n[d]))&&(n=void 0),n===v||void 0===n))return p(f,g,b);for(r=new(void 0===n?v:n)(y(b-g,0)),h=0;g<b;g++,h++)g in f&&l(r,h,f[g]);return r.length=h,r}})},2707:function(e,t,n){"use strict";var r=n(2109),i=n(1702),a=n(9662),o=n(7908),s=n(6244),u=n(5117),c=n(1340),l=n(7293),h=n(4362),f=n(9341),p=n(8886),m=n(256),d=n(7392),v=n(8008),y=[],g=i(y.sort),b=i(y.push),M=l((function(){y.sort(void 0)})),k=l((function(){y.sort(null)})),_=f("sort"),x=!l((function(){if(d)return d<70;if(!(p&&p>3)){if(m)return!0;if(v)return v<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)y.push({k:t+r,v:n})}for(y.sort((function(e,t){return t.v-e.v})),r=0;r<y.length;r++)t=y[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));r({target:"Array",proto:!0,forced:M||!k||!_||!x},{sort:function(e){void 0!==e&&a(e);var t=o(this);if(x)return void 0===e?g(t):g(t,e);var n,r,i=[],l=s(t);for(r=0;r<l;r++)r in t&&b(i,t[r]);for(h(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:c(t)>c(n)?1:-1}}(e)),n=s(i),r=0;r<n;)t[r]=i[r++];for(;r<l;)u(t,r++);return t}})},561:function(e,t,n){"use strict";var r=n(2109),i=n(7908),a=n(1400),o=n(9303),s=n(6244),u=n(3658),c=n(7207),l=n(5417),h=n(6135),f=n(5117),p=n(1194)("splice"),m=Math.max,d=Math.min;r({target:"Array",proto:!0,forced:!p},{splice:function(e,t){var n,r,p,v,y,g,b=i(this),M=s(b),k=a(e,M),_=arguments.length;for(0===_?n=r=0:1===_?(n=0,r=M-k):(n=_-2,r=d(m(o(t),0),M-k)),c(M+n-r),p=l(b,r),v=0;v<r;v++)(y=k+v)in b&&h(p,v,b[y]);if(p.length=r,n<r){for(v=k;v<M-r;v++)g=v+n,(y=v+r)in b?b[g]=b[y]:f(b,g);for(v=M;v>M-r+n;v--)f(b,v-1)}else if(n>r)for(v=M-r;v>k;v--)g=v+n-1,(y=v+r-1)in b?b[g]=b[y]:f(b,g);for(v=0;v<n;v++)b[v+k]=arguments[v+2];return u(b,M-r+n),p}})},541:function(e,t,n){"use strict";var r=n(2109),i=n(7908),a=n(6244),o=n(3658),s=n(5117),u=n(7207);r({target:"Array",proto:!0,arity:1,forced:1!==[].unshift(0)||!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}}()},{unshift:function(e){var t=i(this),n=a(t),r=arguments.length;if(r){u(n+r);for(var c=n;c--;){var l=c+r;c in t?t[l]=t[c]:s(t,l)}for(var h=0;h<r;h++)t[h]=arguments[h]}return o(t,n+r)}})},1703:function(e,t,n){var r=n(2109),i=n(7854),a=n(2104),o=n(9191),s="WebAssembly",u=i[s],c=7!==Error("e",{cause:7}).cause,l=function(e,t){var n={};n[e]=o(e,t,c),r({global:!0,constructor:!0,arity:1,forced:c},n)},h=function(e,t){if(u&&u[e]){var n={};n[e]=o(s+"."+e,t,c),r({target:s,stat:!0,constructor:!0,arity:1,forced:c},n)}};l("Error",(function(e){return function(t){return a(e,this,arguments)}})),l("EvalError",(function(e){return function(t){return a(e,this,arguments)}})),l("RangeError",(function(e){return function(t){return a(e,this,arguments)}})),l("ReferenceError",(function(e){return function(t){return a(e,this,arguments)}})),l("SyntaxError",(function(e){return function(t){return a(e,this,arguments)}})),l("TypeError",(function(e){return function(t){return a(e,this,arguments)}})),l("URIError",(function(e){return function(t){return a(e,this,arguments)}})),h("CompileError",(function(e){return function(t){return a(e,this,arguments)}})),h("LinkError",(function(e){return function(t){return a(e,this,arguments)}})),h("RuntimeError",(function(e){return function(t){return a(e,this,arguments)}}))},8309:function(e,t,n){var r=n(9781),i=n(6530).EXISTS,a=n(1702),o=n(7045),s=Function.prototype,u=a(s.toString),c=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,l=a(c.exec);r&&!i&&o(s,"name",{configurable:!0,get:function(){try{return l(c,u(this))[1]}catch(e){return""}}})},8862:function(e,t,n){var r=n(2109),i=n(5005),a=n(2104),o=n(6916),s=n(1702),u=n(7293),c=n(614),l=n(2190),h=n(206),f=n(8044),p=n(6293),m=String,d=i("JSON","stringify"),v=s(/./.exec),y=s("".charAt),g=s("".charCodeAt),b=s("".replace),M=s(1..toString),k=/[\uD800-\uDFFF]/g,_=/^[\uD800-\uDBFF]$/,x=/^[\uDC00-\uDFFF]$/,T=!p||u((function(){var e=i("Symbol")();return"[null]"!=d([e])||"{}"!=d({a:e})||"{}"!=d(Object(e))})),w=u((function(){return'"\\udf06\\ud834"'!==d("\udf06\ud834")||'"\\udead"'!==d("\udead")})),R=function(e,t){var n=h(arguments),r=f(t);if(c(r)||void 0!==e&&!l(e))return n[1]=function(e,t){if(c(r)&&(t=o(r,this,m(e),t)),!l(t))return t},a(d,null,n)},Z=function(e,t,n){var r=y(n,t-1),i=y(n,t+1);return v(_,e)&&!v(x,i)||v(x,e)&&!v(_,r)?"\\u"+M(g(e,0),16):e};d&&r({target:"JSON",stat:!0,arity:3,forced:T||w},{stringify:function(e,t,n){var r=h(arguments),i=a(T?R:d,null,r);return w&&"string"==typeof i?b(i,k,Z):i}})},9098:function(e,t,n){"use strict";n(7710)("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),n(5631))},1532:function(e,t,n){n(9098)},9653:function(e,t,n){"use strict";var r=n(2109),i=n(1913),a=n(9781),o=n(7854),s=n(857),u=n(1702),c=n(4705),l=n(2597),h=n(9587),f=n(7976),p=n(2190),m=n(7593),d=n(7293),v=n(8006).f,y=n(1236).f,g=n(3070).f,b=n(863),M=n(3111).trim,k="Number",_=o[k],x=s[k],T=_.prototype,w=o.TypeError,R=u("".slice),Z=u("".charCodeAt),S=function(e){var t,n,r,i,a,o,s,u,c=m(e,"number");if(p(c))throw w("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=M(c),43===(t=Z(c,0))||45===t){if(88===(n=Z(c,2))||120===n)return NaN}else if(48===t){switch(Z(c,1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+c}for(o=(a=R(c,2)).length,s=0;s<o;s++)if((u=Z(a,s))<48||u>i)return NaN;return parseInt(a,r)}return+c},C=c(k,!_(" 0o1")||!_("0b1")||_("+0x1")),I=function(e){var t,n=arguments.length<1?0:_(function(e){var t=m(e,"number");return"bigint"==typeof t?t:S(t)}(e));return f(T,t=this)&&d((function(){b(t)}))?h(Object(n),this,I):n};I.prototype=T,C&&!i&&(T.constructor=I),r({global:!0,constructor:!0,wrap:!0,forced:C},{Number:I});var E=function(e,t){for(var n,r=a?v(t):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),i=0;r.length>i;i++)l(t,n=r[i])&&!l(e,n)&&g(e,n,y(t,n))};i&&x&&E(s[k],x),(C||i)&&E(s[k],_)},3299:function(e,t,n){n(2109)({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{EPSILON:Math.pow(2,-52)})},5192:function(e,t,n){n(2109)({target:"Number",stat:!0},{isFinite:n(7023)})},3161:function(e,t,n){n(2109)({target:"Number",stat:!0},{isInteger:n(5988)})},4048:function(e,t,n){n(2109)({target:"Number",stat:!0},{isNaN:function(e){return e!=e}})},8285:function(e,t,n){var r=n(2109),i=n(5988),a=Math.abs;r({target:"Number",stat:!0},{isSafeInteger:function(e){return i(e)&&a(e)<=9007199254740991}})},4363:function(e,t,n){n(2109)({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991})},5994:function(e,t,n){n(2109)({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MIN_SAFE_INTEGER:-9007199254740991})},391:function(e,t,n){var r=n(2109),i=n(2814);r({target:"Number",stat:!0,forced:Number.parseFloat!=i},{parseFloat:i})},6977:function(e,t,n){"use strict";var r=n(2109),i=n(1702),a=n(9303),o=n(863),s=n(8415),u=n(7293),c=RangeError,l=String,h=Math.floor,f=i(s),p=i("".slice),m=i(1..toFixed),d=function(e,t,n){return 0===t?n:t%2==1?d(e,t-1,n*e):d(e*e,t/2,n)},v=function(e,t,n){for(var r=-1,i=n;++r<6;)i+=t*e[r],e[r]=i%1e7,i=h(i/1e7)},y=function(e,t){for(var n=6,r=0;--n>=0;)r+=e[n],e[n]=h(r/t),r=r%t*1e7},g=function(e){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==e[t]){var r=l(e[t]);n=""===n?r:n+f("0",7-r.length)+r}return n};r({target:"Number",proto:!0,forced:u((function(){return"0.000"!==m(8e-5,3)||"1"!==m(.9,0)||"1.25"!==m(1.255,2)||"1000000000000000128"!==m(0xde0b6b3a7640080,0)}))||!u((function(){m({})}))},{toFixed:function(e){var t,n,r,i,s=o(this),u=a(e),h=[0,0,0,0,0,0],m="",b="0";if(u<0||u>20)throw c("Incorrect fraction digits");if(s!=s)return"NaN";if(s<=-1e21||s>=1e21)return l(s);if(s<0&&(m="-",s=-s),s>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(s*d(2,69,1))-69)<0?s*d(2,-t,1):s/d(2,t,1),n*=4503599627370496,(t=52-t)>0){for(v(h,0,n),r=u;r>=7;)v(h,1e7,0),r-=7;for(v(h,d(10,r,1),0),r=t-1;r>=23;)y(h,1<<23),r-=23;y(h,1<<r),v(h,1,1),y(h,2),b=g(h)}else v(h,0,n),v(h,1<<-t,0),b=g(h)+f("0",u);return b=u>0?m+((i=b.length)<=u?"0."+f("0",u-i)+b:p(b,0,i-u)+"."+p(b,i-u)):m+b}})},9601:function(e,t,n){var r=n(2109),i=n(1574);r({target:"Object",stat:!0,arity:2,forced:Object.assign!==i},{assign:i})},9720:function(e,t,n){var r=n(2109),i=n(4699).entries;r({target:"Object",stat:!0},{entries:function(e){return i(e)}})},5003:function(e,t,n){var r=n(2109),i=n(7293),a=n(5656),o=n(1236).f,s=n(9781);r({target:"Object",stat:!0,forced:!s||i((function(){o(1)})),sham:!s},{getOwnPropertyDescriptor:function(e,t){return o(a(e),t)}})},9337:function(e,t,n){var r=n(2109),i=n(9781),a=n(3887),o=n(5656),s=n(1236),u=n(6135);r({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){for(var t,n,r=o(e),i=s.f,c=a(r),l={},h=0;c.length>h;)void 0!==(n=i(r,t=c[h++]))&&u(l,t,n);return l}})},9660:function(e,t,n){var r=n(2109),i=n(6293),a=n(7293),o=n(5181),s=n(7908);r({target:"Object",stat:!0,forced:!i||a((function(){o.f(1)}))},{getOwnPropertySymbols:function(e){var t=o.f;return t?t(s(e)):[]}})},7941:function(e,t,n){var r=n(2109),i=n(7908),a=n(1956);r({target:"Object",stat:!0,forced:n(7293)((function(){a(1)}))},{keys:function(e){return a(i(e))}})},1539:function(e,t,n){var r=n(1694),i=n(8052),a=n(288);r||i(Object.prototype,"toString",a,{unsafe:!0})},7922:function(e,t,n){"use strict";var r=n(2109),i=n(6916),a=n(9662),o=n(8523),s=n(2534),u=n(408);r({target:"Promise",stat:!0,forced:n(612)},{allSettled:function(e){var t=this,n=o.f(t),r=n.resolve,c=n.reject,l=s((function(){var n=a(t.resolve),o=[],s=0,c=1;u(e,(function(e){var a=s++,u=!1;c++,i(n,t,e).then((function(e){u||(u=!0,o[a]={status:"fulfilled",value:e},--c||r(o))}),(function(e){u||(u=!0,o[a]={status:"rejected",reason:e},--c||r(o))}))})),--c||r(o)}));return l.error&&c(l.value),n.promise}})},821:function(e,t,n){"use strict";var r=n(2109),i=n(6916),a=n(9662),o=n(8523),s=n(2534),u=n(408);r({target:"Promise",stat:!0,forced:n(612)},{all:function(e){var t=this,n=o.f(t),r=n.resolve,c=n.reject,l=s((function(){var n=a(t.resolve),o=[],s=0,l=1;u(e,(function(e){var a=s++,u=!1;l++,i(n,t,e).then((function(e){u||(u=!0,o[a]=e,--l||r(o))}),c)})),--l||r(o)}));return l.error&&c(l.value),n.promise}})},4164:function(e,t,n){"use strict";var r=n(2109),i=n(1913),a=n(3702).CONSTRUCTOR,o=n(2492),s=n(5005),u=n(614),c=n(8052),l=o&&o.prototype;if(r({target:"Promise",proto:!0,forced:a,real:!0},{catch:function(e){return this.then(void 0,e)}}),!i&&u(o)){var h=s("Promise").prototype.catch;l.catch!==h&&c(l,"catch",h,{unsafe:!0})}},3401:function(e,t,n){"use strict";var r,i,a,o=n(2109),s=n(1913),u=n(5268),c=n(7854),l=n(6916),h=n(8052),f=n(7674),p=n(8003),m=n(6340),d=n(9662),v=n(614),y=n(111),g=n(5787),b=n(6707),M=n(261).set,k=n(5948),_=n(842),x=n(2534),T=n(8572),w=n(9909),R=n(2492),Z=n(3702),S=n(8523),C="Promise",I=Z.CONSTRUCTOR,E=Z.REJECTION_EVENT,A=Z.SUBCLASSING,O=w.getterFor(C),D=w.set,P=R&&R.prototype,B=R,F=P,L=c.TypeError,N=c.document,j=c.process,z=S.f,U=z,V=!!(N&&N.createEvent&&c.dispatchEvent),H="unhandledrejection",G=function(e){var t;return!(!y(e)||!v(t=e.then))&&t},q=function(e,t){var n,r,i,a=t.value,o=1==t.state,s=o?e.ok:e.fail,u=e.resolve,c=e.reject,h=e.domain;try{s?(o||(2===t.rejection&&$(t),t.rejection=1),!0===s?n=a:(h&&h.enter(),n=s(a),h&&(h.exit(),i=!0)),n===e.promise?c(L("Promise-chain cycle")):(r=G(n))?l(r,n,u,c):u(n)):c(a)}catch(e){h&&!i&&h.exit(),c(e)}},W=function(e,t){e.notified||(e.notified=!0,k((function(){for(var n,r=e.reactions;n=r.get();)q(n,e);e.notified=!1,t&&!e.rejection&&K(e)})))},Y=function(e,t,n){var r,i;V?((r=N.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),c.dispatchEvent(r)):r={promise:t,reason:n},!E&&(i=c["on"+e])?i(r):e===H&&_("Unhandled promise rejection",n)},K=function(e){l(M,c,(function(){var t,n=e.facade,r=e.value;if(X(e)&&(t=x((function(){u?j.emit("unhandledRejection",r,n):Y(H,n,r)})),e.rejection=u||X(e)?2:1,t.error))throw t.value}))},X=function(e){return 1!==e.rejection&&!e.parent},$=function(e){l(M,c,(function(){var t=e.facade;u?j.emit("rejectionHandled",t):Y("rejectionhandled",t,e.value)}))},Q=function(e,t,n){return function(r){e(t,r,n)}},J=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,W(e,!0))},ee=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw L("Promise can't be resolved itself");var r=G(t);r?k((function(){var n={done:!1};try{l(r,t,Q(ee,n,e),Q(J,n,e))}catch(t){J(n,t,e)}})):(e.value=t,e.state=1,W(e,!1))}catch(t){J({done:!1},t,e)}}};if(I&&(F=(B=function(e){g(this,F),d(e),l(r,this);var t=O(this);try{e(Q(ee,t),Q(J,t))}catch(e){J(t,e)}}).prototype,(r=function(e){D(this,{type:C,done:!1,notified:!1,parent:!1,reactions:new T,rejection:!1,state:0,value:void 0})}).prototype=h(F,"then",(function(e,t){var n=O(this),r=z(b(this,B));return n.parent=!0,r.ok=!v(e)||e,r.fail=v(t)&&t,r.domain=u?j.domain:void 0,0==n.state?n.reactions.add(r):k((function(){q(r,n)})),r.promise})),i=function(){var e=new r,t=O(e);this.promise=e,this.resolve=Q(ee,t),this.reject=Q(J,t)},S.f=z=function(e){return e===B||undefined===e?new i(e):U(e)},!s&&v(R)&&P!==Object.prototype)){a=P.then,A||h(P,"then",(function(e,t){var n=this;return new B((function(e,t){l(a,n,e,t)})).then(e,t)}),{unsafe:!0});try{delete P.constructor}catch(e){}f&&f(P,F)}o({global:!0,constructor:!0,wrap:!0,forced:I},{Promise:B}),p(B,C,!1,!0),m(C)},8674:function(e,t,n){n(3401),n(821),n(4164),n(6027),n(683),n(6294)},6027:function(e,t,n){"use strict";var r=n(2109),i=n(6916),a=n(9662),o=n(8523),s=n(2534),u=n(408);r({target:"Promise",stat:!0,forced:n(612)},{race:function(e){var t=this,n=o.f(t),r=n.reject,c=s((function(){var o=a(t.resolve);u(e,(function(e){i(o,t,e).then(n.resolve,r)}))}));return c.error&&r(c.value),n.promise}})},683:function(e,t,n){"use strict";var r=n(2109),i=n(6916),a=n(8523);r({target:"Promise",stat:!0,forced:n(3702).CONSTRUCTOR},{reject:function(e){var t=a.f(this);return i(t.reject,void 0,e),t.promise}})},6294:function(e,t,n){"use strict";var r=n(2109),i=n(5005),a=n(1913),o=n(2492),s=n(3702).CONSTRUCTOR,u=n(9478),c=i("Promise"),l=a&&!s;r({target:"Promise",stat:!0,forced:a||s},{resolve:function(e){return u(l&&this===c?o:this,e)}})},2419:function(e,t,n){var r=n(2109),i=n(5005),a=n(2104),o=n(7065),s=n(9483),u=n(9670),c=n(111),l=n(30),h=n(7293),f=i("Reflect","construct"),p=Object.prototype,m=[].push,d=h((function(){function e(){}return!(f((function(){}),[],e)instanceof e)})),v=!h((function(){f((function(){}))})),y=d||v;r({target:"Reflect",stat:!0,forced:y,sham:y},{construct:function(e,t){s(e),u(t);var n=arguments.length<3?e:s(arguments[2]);if(v&&!d)return f(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return a(m,r,t),new(a(o,e,r))}var i=n.prototype,h=l(c(i)?i:p),y=a(e,h,t);return c(y)?y:h}})},1299:function(e,t,n){var r=n(2109),i=n(7854),a=n(8003);r({global:!0},{Reflect:{}}),a(i.Reflect,"Reflect",!0)},4603:function(e,t,n){var r=n(9781),i=n(7854),a=n(1702),o=n(4705),s=n(9587),u=n(8880),c=n(8006).f,l=n(7976),h=n(7850),f=n(1340),p=n(4706),m=n(2999),d=n(2626),v=n(8052),y=n(7293),g=n(2597),b=n(9909).enforce,M=n(6340),k=n(5112),_=n(9441),x=n(7168),T=k("match"),w=i.RegExp,R=w.prototype,Z=i.SyntaxError,S=a(R.exec),C=a("".charAt),I=a("".replace),E=a("".indexOf),A=a("".slice),O=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,D=/a/g,P=/a/g,B=new w(D)!==D,F=m.MISSED_STICKY,L=m.UNSUPPORTED_Y,N=r&&(!B||F||_||x||y((function(){return P[T]=!1,w(D)!=D||w(P)==P||"/a/i"!=w(D,"i")})));if(o("RegExp",N)){for(var j=function(e,t){var n,r,i,a,o,c,m=l(R,this),d=h(e),v=void 0===t,y=[],M=e;if(!m&&d&&v&&e.constructor===j)return e;if((d||l(R,e))&&(e=e.source,v&&(t=p(M))),e=void 0===e?"":f(e),t=void 0===t?"":f(t),M=e,_&&"dotAll"in D&&(r=!!t&&E(t,"s")>-1)&&(t=I(t,/s/g,"")),n=t,F&&"sticky"in D&&(i=!!t&&E(t,"y")>-1)&&L&&(t=I(t,/y/g,"")),x&&(a=function(e){for(var t,n=e.length,r=0,i="",a=[],o={},s=!1,u=!1,c=0,l="";r<=n;r++){if("\\"===(t=C(e,r)))t+=C(e,++r);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:S(O,A(e,r+1))&&(r+=2,u=!0),i+=t,c++;continue;case">"===t&&u:if(""===l||g(o,l))throw new Z("Invalid capture group name");o[l]=!0,a[a.length]=[l,c],u=!1,l="";continue}u?l+=t:i+=t}return[i,a]}(e),e=a[0],y=a[1]),o=s(w(e,t),m?this:R,j),(r||i||y.length)&&(c=b(o),r&&(c.dotAll=!0,c.raw=j(function(e){for(var t,n=e.length,r=0,i="",a=!1;r<=n;r++)"\\"!==(t=C(e,r))?a||"."!==t?("["===t?a=!0:"]"===t&&(a=!1),i+=t):i+="[\\s\\S]":i+=t+C(e,++r);return i}(e),n)),i&&(c.sticky=!0),y.length&&(c.groups=y)),e!==M)try{u(o,"source",""===M?"(?:)":M)}catch(e){}return o},z=c(w),U=0;z.length>U;)d(j,w,z[U++]);R.constructor=j,j.prototype=R,v(i,"RegExp",j,{constructor:!0})}M("RegExp")},8450:function(e,t,n){var r=n(9781),i=n(9441),a=n(4326),o=n(7045),s=n(9909).get,u=RegExp.prototype,c=TypeError;r&&i&&o(u,"dotAll",{configurable:!0,get:function(){if(this!==u){if("RegExp"===a(this))return!!s(this).dotAll;throw c("Incompatible receiver, RegExp required")}}})},4916:function(e,t,n){"use strict";var r=n(2109),i=n(2261);r({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},2087:function(e,t,n){var r=n(7854),i=n(9781),a=n(7045),o=n(7066),s=n(7293),u=r.RegExp,c=u.prototype;i&&s((function(){var e=!0;try{u(".","d")}catch(t){e=!1}var t={},n="",r=e?"dgimsy":"gimsy",i=function(e,r){Object.defineProperty(t,e,{get:function(){return n+=r,!0}})},a={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in e&&(a.hasIndices="d"),a)i(o,a[o]);return Object.getOwnPropertyDescriptor(c,"flags").get.call(t)!==r||n!==r}))&&a(c,"flags",{configurable:!0,get:o})},8386:function(e,t,n){var r=n(9781),i=n(2999).MISSED_STICKY,a=n(4326),o=n(7045),s=n(9909).get,u=RegExp.prototype,c=TypeError;r&&i&&o(u,"sticky",{configurable:!0,get:function(){if(this!==u){if("RegExp"===a(this))return!!s(this).sticky;throw c("Incompatible receiver, RegExp required")}}})},7601:function(e,t,n){"use strict";n(4916);var r,i,a=n(2109),o=n(6916),s=n(614),u=n(9670),c=n(1340),l=(r=!1,(i=/[ac]/).exec=function(){return r=!0,/./.exec.apply(this,arguments)},!0===i.test("abc")&&r),h=/./.test;a({target:"RegExp",proto:!0,forced:!l},{test:function(e){var t=u(this),n=c(e),r=t.exec;if(!s(r))return o(h,t,n);var i=o(r,t,n);return null!==i&&(u(i),!0)}})},9714:function(e,t,n){"use strict";var r=n(6530).PROPER,i=n(8052),a=n(9670),o=n(1340),s=n(7293),u=n(4706),c="toString",l=RegExp.prototype[c],h=s((function(){return"/a/b"!=l.call({source:"a",flags:"b"})})),f=r&&l.name!=c;(h||f)&&i(RegExp.prototype,c,(function(){var e=a(this);return"/"+o(e.source)+"/"+o(u(e))}),{unsafe:!0})},7227:function(e,t,n){"use strict";n(7710)("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),n(5631))},189:function(e,t,n){n(7227)},7852:function(e,t,n){"use strict";var r,i=n(2109),a=n(1470),o=n(1236).f,s=n(7466),u=n(1340),c=n(3929),l=n(4488),h=n(4964),f=n(1913),p=a("".endsWith),m=a("".slice),d=Math.min,v=h("endsWith");i({target:"String",proto:!0,forced:!!(f||v||(r=o(String.prototype,"endsWith"),!r||r.writable))&&!v},{endsWith:function(e){var t=u(l(this));c(e);var n=arguments.length>1?arguments[1]:void 0,r=t.length,i=void 0===n?r:d(s(n),r),a=u(e);return p?p(t,a,i):m(t,i-a.length,i)===a}})},2023:function(e,t,n){"use strict";var r=n(2109),i=n(1702),a=n(3929),o=n(4488),s=n(1340),u=n(4964),c=i("".indexOf);r({target:"String",proto:!0,forced:!u("includes")},{includes:function(e){return!!~c(s(o(this)),s(a(e)),arguments.length>1?arguments[1]:void 0)}})},8783:function(e,t,n){"use strict";var r=n(8710).charAt,i=n(1340),a=n(9909),o=n(1656),s=n(6178),u="String Iterator",c=a.set,l=a.getterFor(u);o(String,"String",(function(e){c(this,{type:u,string:i(e),index:0})}),(function(){var e,t=l(this),n=t.string,i=t.index;return i>=n.length?s(void 0,!0):(e=r(n,i),t.index+=e.length,s(e,!1))}))},6373:function(e,t,n){"use strict";var r=n(2109),i=n(6916),a=n(1470),o=n(3061),s=n(6178),u=n(4488),c=n(7466),l=n(1340),h=n(9670),f=n(8554),p=n(4326),m=n(7850),d=n(4706),v=n(8173),y=n(8052),g=n(7293),b=n(5112),M=n(6707),k=n(1530),_=n(7651),x=n(9909),T=n(1913),w=b("matchAll"),R="RegExp String",Z=R+" Iterator",S=x.set,C=x.getterFor(Z),I=RegExp.prototype,E=TypeError,A=a("".indexOf),O=a("".matchAll),D=!!O&&!g((function(){O("a",/./)})),P=o((function(e,t,n,r){S(this,{type:Z,regexp:e,string:t,global:n,unicode:r,done:!1})}),R,(function(){var e=C(this);if(e.done)return s(void 0,!0);var t=e.regexp,n=e.string,r=_(t,n);return null===r?(e.done=!0,s(void 0,!0)):e.global?(""===l(r[0])&&(t.lastIndex=k(n,c(t.lastIndex),e.unicode)),s(r,!1)):(e.done=!0,s(r,!1))})),B=function(e){var t,n,r,i=h(this),a=l(e),o=M(i,RegExp),s=l(d(i));return t=new o(o===RegExp?i.source:i,s),n=!!~A(s,"g"),r=!!~A(s,"u"),t.lastIndex=c(i.lastIndex),new P(t,a,n,r)};r({target:"String",proto:!0,forced:D},{matchAll:function(e){var t,n,r,a,o=u(this);if(f(e)){if(D)return O(o,e)}else{if(m(e)&&(t=l(u(d(e))),!~A(t,"g")))throw E("`.matchAll` does not allow non-global regexes");if(D)return O(o,e);if(void 0===(r=v(e,w))&&T&&"RegExp"==p(e)&&(r=B),r)return i(r,e,o)}return n=l(o),a=new RegExp(e,"g"),T?i(B,a,n):a[w](n)}}),T||w in I||y(I,w,B)},4723:function(e,t,n){"use strict";var r=n(6916),i=n(7007),a=n(9670),o=n(8554),s=n(7466),u=n(1340),c=n(4488),l=n(8173),h=n(1530),f=n(7651);i("match",(function(e,t,n){return[function(t){var n=c(this),i=o(t)?void 0:l(t,e);return i?r(i,t,n):new RegExp(t)[e](u(n))},function(e){var r=a(this),i=u(e),o=n(t,r,i);if(o.done)return o.value;if(!r.global)return f(r,i);var c=r.unicode;r.lastIndex=0;for(var l,p=[],m=0;null!==(l=f(r,i));){var d=u(l[0]);p[m]=d,""===d&&(r.lastIndex=h(i,s(r.lastIndex),c)),m++}return 0===m?null:p}]}))},3112:function(e,t,n){"use strict";var r=n(2109),i=n(6650).start;r({target:"String",proto:!0,forced:n(4986)},{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},2481:function(e,t,n){n(2109)({target:"String",proto:!0},{repeat:n(8415)})},5306:function(e,t,n){"use strict";var r=n(2104),i=n(6916),a=n(1702),o=n(7007),s=n(7293),u=n(9670),c=n(614),l=n(8554),h=n(9303),f=n(7466),p=n(1340),m=n(4488),d=n(1530),v=n(8173),y=n(647),g=n(7651),b=n(5112)("replace"),M=Math.max,k=Math.min,_=a([].concat),x=a([].push),T=a("".indexOf),w=a("".slice),R="$0"==="a".replace(/./,"$0"),Z=!!/./[b]&&""===/./[b]("a","$0");o("replace",(function(e,t,n){var a=Z?"$":"$0";return[function(e,n){var r=m(this),a=l(e)?void 0:v(e,b);return a?i(a,e,r,n):i(t,p(r),e,n)},function(e,i){var o=u(this),s=p(e);if("string"==typeof i&&-1===T(i,a)&&-1===T(i,"$<")){var l=n(t,o,s,i);if(l.done)return l.value}var m=c(i);m||(i=p(i));var v=o.global;if(v){var b=o.unicode;o.lastIndex=0}for(var R=[];;){var Z=g(o,s);if(null===Z)break;if(x(R,Z),!v)break;""===p(Z[0])&&(o.lastIndex=d(s,f(o.lastIndex),b))}for(var S,C="",I=0,E=0;E<R.length;E++){for(var A=p((Z=R[E])[0]),O=M(k(h(Z.index),s.length),0),D=[],P=1;P<Z.length;P++)x(D,void 0===(S=Z[P])?S:String(S));var B=Z.groups;if(m){var F=_([A],D,O,s);void 0!==B&&x(F,B);var L=p(r(i,void 0,F))}else L=y(A,s,O,D,B,i);O>=I&&(C+=w(s,I,O)+L,I=O+A.length)}return C+w(s,I)}]}),!!s((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!R||Z)},4765:function(e,t,n){"use strict";var r=n(6916),i=n(7007),a=n(9670),o=n(8554),s=n(4488),u=n(1150),c=n(1340),l=n(8173),h=n(7651);i("search",(function(e,t,n){return[function(t){var n=s(this),i=o(t)?void 0:l(t,e);return i?r(i,t,n):new RegExp(t)[e](c(n))},function(e){var r=a(this),i=c(e),o=n(t,r,i);if(o.done)return o.value;var s=r.lastIndex;u(s,0)||(r.lastIndex=0);var l=h(r,i);return u(r.lastIndex,s)||(r.lastIndex=s),null===l?-1:l.index}]}))},3123:function(e,t,n){"use strict";var r=n(2104),i=n(6916),a=n(1702),o=n(7007),s=n(9670),u=n(8554),c=n(7850),l=n(4488),h=n(6707),f=n(1530),p=n(7466),m=n(1340),d=n(8173),v=n(1589),y=n(7651),g=n(2261),b=n(2999),M=n(7293),k=b.UNSUPPORTED_Y,_=4294967295,x=Math.min,T=[].push,w=a(/./.exec),R=a(T),Z=a("".slice),S=!M((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));o("split",(function(e,t,n){var a;return a="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var a=m(l(this)),o=void 0===n?_:n>>>0;if(0===o)return[];if(void 0===e)return[a];if(!c(e))return i(t,a,e,o);for(var s,u,h,f=[],p=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),d=0,y=new RegExp(e.source,p+"g");(s=i(g,y,a))&&!((u=y.lastIndex)>d&&(R(f,Z(a,d,s.index)),s.length>1&&s.index<a.length&&r(T,f,v(s,1)),h=s[0].length,d=u,f.length>=o));)y.lastIndex===s.index&&y.lastIndex++;return d===a.length?!h&&w(y,"")||R(f,""):R(f,Z(a,d)),f.length>o?v(f,0,o):f}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:i(t,this,e,n)}:t,[function(t,n){var r=l(this),o=u(t)?void 0:d(t,e);return o?i(o,t,r,n):i(a,m(r),t,n)},function(e,r){var i=s(this),o=m(e),u=n(a,i,o,r,a!==t);if(u.done)return u.value;var c=h(i,RegExp),l=i.unicode,d=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(k?"g":"y"),v=new c(k?"^(?:"+i.source+")":i,d),g=void 0===r?_:r>>>0;if(0===g)return[];if(0===o.length)return null===y(v,o)?[o]:[];for(var b=0,M=0,T=[];M<o.length;){v.lastIndex=k?0:M;var w,S=y(v,k?Z(o,M):o);if(null===S||(w=x(p(v.lastIndex+(k?M:0)),o.length))===b)M=f(o,M,l);else{if(R(T,Z(o,b,M)),T.length===g)return T;for(var C=1;C<=S.length-1;C++)if(R(T,S[C]),T.length===g)return T;M=b=w}}return R(T,Z(o,b)),T}]}),!S,k)},6755:function(e,t,n){"use strict";var r,i=n(2109),a=n(1470),o=n(1236).f,s=n(7466),u=n(1340),c=n(3929),l=n(4488),h=n(4964),f=n(1913),p=a("".startsWith),m=a("".slice),d=Math.min,v=h("startsWith");i({target:"String",proto:!0,forced:!!(f||v||(r=o(String.prototype,"startsWith"),!r||r.writable))&&!v},{startsWith:function(e){var t=u(l(this));c(e);var n=s(d(arguments.length>1?arguments[1]:void 0,t.length)),r=u(e);return p?p(t,r,n):m(t,n,n+r.length)===r}})},86:function(e,t,n){"use strict";var r=n(2109),i=n(4230);r({target:"String",proto:!0,forced:n(3429)("sub")},{sub:function(){return i(this,"sub","","")}})},3210:function(e,t,n){"use strict";var r=n(2109),i=n(3111).trim;r({target:"String",proto:!0,forced:n(6091)("trim")},{trim:function(){return i(this)}})},4032:function(e,t,n){"use strict";var r=n(2109),i=n(7854),a=n(6916),o=n(1702),s=n(1913),u=n(9781),c=n(6293),l=n(7293),h=n(2597),f=n(7976),p=n(9670),m=n(5656),d=n(4948),v=n(1340),y=n(9114),g=n(30),b=n(1956),M=n(8006),k=n(1156),_=n(5181),x=n(1236),T=n(3070),w=n(6048),R=n(5296),Z=n(8052),S=n(7045),C=n(2309),I=n(6200),E=n(3501),A=n(9711),O=n(5112),D=n(6061),P=n(6800),B=n(6532),F=n(8003),L=n(9909),N=n(2092).forEach,j=I("hidden"),z="Symbol",U="prototype",V=L.set,H=L.getterFor(z),G=Object[U],q=i.Symbol,W=q&&q[U],Y=i.TypeError,K=i.QObject,X=x.f,$=T.f,Q=k.f,J=R.f,ee=o([].push),te=C("symbols"),ne=C("op-symbols"),re=C("wks"),ie=!K||!K[U]||!K[U].findChild,ae=u&&l((function(){return 7!=g($({},"a",{get:function(){return $(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=X(G,t);r&&delete G[t],$(e,t,n),r&&e!==G&&$(G,t,r)}:$,oe=function(e,t){var n=te[e]=g(W);return V(n,{type:z,tag:e,description:t}),u||(n.description=t),n},se=function(e,t,n){e===G&&se(ne,t,n),p(e);var r=d(t);return p(n),h(te,r)?(n.enumerable?(h(e,j)&&e[j][r]&&(e[j][r]=!1),n=g(n,{enumerable:y(0,!1)})):(h(e,j)||$(e,j,y(1,{})),e[j][r]=!0),ae(e,r,n)):$(e,r,n)},ue=function(e,t){p(e);var n=m(t),r=b(n).concat(fe(n));return N(r,(function(t){u&&!a(ce,n,t)||se(e,t,n[t])})),e},ce=function(e){var t=d(e),n=a(J,this,t);return!(this===G&&h(te,t)&&!h(ne,t))&&(!(n||!h(this,t)||!h(te,t)||h(this,j)&&this[j][t])||n)},le=function(e,t){var n=m(e),r=d(t);if(n!==G||!h(te,r)||h(ne,r)){var i=X(n,r);return!i||!h(te,r)||h(n,j)&&n[j][r]||(i.enumerable=!0),i}},he=function(e){var t=Q(m(e)),n=[];return N(t,(function(e){h(te,e)||h(E,e)||ee(n,e)})),n},fe=function(e){var t=e===G,n=Q(t?ne:m(e)),r=[];return N(n,(function(e){!h(te,e)||t&&!h(G,e)||ee(r,te[e])})),r};c||(q=function(){if(f(W,this))throw Y("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?v(arguments[0]):void 0,t=A(e),n=function(e){this===G&&a(n,ne,e),h(this,j)&&h(this[j],t)&&(this[j][t]=!1),ae(this,t,y(1,e))};return u&&ie&&ae(G,t,{configurable:!0,set:n}),oe(t,e)},Z(W=q[U],"toString",(function(){return H(this).tag})),Z(q,"withoutSetter",(function(e){return oe(A(e),e)})),R.f=ce,T.f=se,w.f=ue,x.f=le,M.f=k.f=he,_.f=fe,D.f=function(e){return oe(O(e),e)},u&&(S(W,"description",{configurable:!0,get:function(){return H(this).description}}),s||Z(G,"propertyIsEnumerable",ce,{unsafe:!0}))),r({global:!0,constructor:!0,wrap:!0,forced:!c,sham:!c},{Symbol:q}),N(b(re),(function(e){P(e)})),r({target:z,stat:!0,forced:!c},{useSetter:function(){ie=!0},useSimple:function(){ie=!1}}),r({target:"Object",stat:!0,forced:!c,sham:!u},{create:function(e,t){return void 0===t?g(e):ue(g(e),t)},defineProperty:se,defineProperties:ue,getOwnPropertyDescriptor:le}),r({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:he}),B(),F(q,z),E[j]=!0},1817:function(e,t,n){"use strict";var r=n(2109),i=n(9781),a=n(7854),o=n(1702),s=n(2597),u=n(614),c=n(7976),l=n(1340),h=n(7045),f=n(9920),p=a.Symbol,m=p&&p.prototype;if(i&&u(p)&&(!("description"in m)||void 0!==p().description)){var d={},v=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:l(arguments[0]),t=c(m,this)?new p(e):void 0===e?p():p(e);return""===e&&(d[t]=!0),t};f(v,p),v.prototype=m,m.constructor=v;var y="Symbol(test)"==String(p("test")),g=o(m.valueOf),b=o(m.toString),M=/^Symbol\((.*)\)[^)]+$/,k=o("".replace),_=o("".slice);h(m,"description",{configurable:!0,get:function(){var e=g(this);if(s(d,e))return"";var t=b(e),n=y?_(t,7,-1):k(t,M,"$1");return""===n?void 0:n}}),r({global:!0,constructor:!0,forced:!0},{Symbol:v})}},763:function(e,t,n){var r=n(2109),i=n(5005),a=n(2597),o=n(1340),s=n(2309),u=n(2015),c=s("string-to-symbol-registry"),l=s("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!u},{for:function(e){var t=o(e);if(a(c,t))return c[t];var n=i("Symbol")(t);return c[t]=n,l[n]=t,n}})},2165:function(e,t,n){n(6800)("iterator")},2526:function(e,t,n){n(4032),n(763),n(6620),n(8862),n(9660)},6620:function(e,t,n){var r=n(2109),i=n(2597),a=n(2190),o=n(6330),s=n(2309),u=n(2015),c=s("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!u},{keyFor:function(e){if(!a(e))throw TypeError(o(e)+" is not a symbol");if(i(c,e))return c[e]}})},8675:function(e,t,n){"use strict";var r=n(260),i=n(6244),a=n(9303),o=r.aTypedArray;(0,r.exportTypedArrayMethod)("at",(function(e){var t=o(this),n=i(t),r=a(e),s=r>=0?r:n+r;return s<0||s>=n?void 0:t[s]}))},2990:function(e,t,n){"use strict";var r=n(1702),i=n(260),a=r(n(1048)),o=i.aTypedArray;(0,i.exportTypedArrayMethod)("copyWithin",(function(e,t){return a(o(this),e,t,arguments.length>2?arguments[2]:void 0)}))},8927:function(e,t,n){"use strict";var r=n(260),i=n(2092).every,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("every",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},3105:function(e,t,n){"use strict";var r=n(260),i=n(1285),a=n(4599),o=n(648),s=n(6916),u=n(1702),c=n(7293),l=r.aTypedArray,h=r.exportTypedArrayMethod,f=u("".slice);h("fill",(function(e){var t=arguments.length;l(this);var n="Big"===f(o(this),0,3)?a(e):+e;return s(i,this,n,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),c((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})))},5035:function(e,t,n){"use strict";var r=n(260),i=n(2092).filter,a=n(3074),o=r.aTypedArray;(0,r.exportTypedArrayMethod)("filter",(function(e){var t=i(o(this),e,arguments.length>1?arguments[1]:void 0);return a(this,t)}))},7174:function(e,t,n){"use strict";var r=n(260),i=n(2092).findIndex,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("findIndex",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},2958:function(e,t,n){"use strict";var r=n(260),i=n(9671).findLastIndex,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("findLastIndex",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},3408:function(e,t,n){"use strict";var r=n(260),i=n(9671).findLast,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("findLast",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},4345:function(e,t,n){"use strict";var r=n(260),i=n(2092).find,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("find",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},4197:function(e,t,n){n(9843)("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},2846:function(e,t,n){"use strict";var r=n(260),i=n(2092).forEach,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("forEach",(function(e){i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},4731:function(e,t,n){"use strict";var r=n(260),i=n(1318).includes,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("includes",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},7209:function(e,t,n){"use strict";var r=n(260),i=n(1318).indexOf,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("indexOf",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},5109:function(e,t,n){n(9843)("Int16",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},5125:function(e,t,n){n(9843)("Int32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},7145:function(e,t,n){n(9843)("Int8",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},6319:function(e,t,n){"use strict";var r=n(7854),i=n(7293),a=n(1702),o=n(260),s=n(6992),u=n(5112)("iterator"),c=r.Uint8Array,l=a(s.values),h=a(s.keys),f=a(s.entries),p=o.aTypedArray,m=o.exportTypedArrayMethod,d=c&&c.prototype,v=!i((function(){d[u].call([1])})),y=!!d&&d.values&&d[u]===d.values&&"values"===d.values.name,g=function(){return l(p(this))};m("entries",(function(){return f(p(this))}),v),m("keys",(function(){return h(p(this))}),v),m("values",g,v||!y,{name:"values"}),m(u,g,v||!y,{name:"values"})},8867:function(e,t,n){"use strict";var r=n(260),i=n(1702),a=r.aTypedArray,o=r.exportTypedArrayMethod,s=i([].join);o("join",(function(e){return s(a(this),e)}))},7789:function(e,t,n){"use strict";var r=n(260),i=n(2104),a=n(6583),o=r.aTypedArray;(0,r.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return i(a,o(this),t>1?[e,arguments[1]]:[e])}))},3739:function(e,t,n){"use strict";var r=n(260),i=n(2092).map,a=n(6304),o=r.aTypedArray;(0,r.exportTypedArrayMethod)("map",(function(e){return i(o(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(a(e))(t)}))}))},4483:function(e,t,n){"use strict";var r=n(260),i=n(3671).right,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return i(a(this),e,t,t>1?arguments[1]:void 0)}))},9368:function(e,t,n){"use strict";var r=n(260),i=n(3671).left,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return i(a(this),e,t,t>1?arguments[1]:void 0)}))},2056:function(e,t,n){"use strict";var r=n(260),i=r.aTypedArray,a=r.exportTypedArrayMethod,o=Math.floor;a("reverse",(function(){for(var e,t=this,n=i(t).length,r=o(n/2),a=0;a<r;)e=t[a],t[a++]=t[--n],t[n]=e;return t}))},3462:function(e,t,n){"use strict";var r=n(7854),i=n(6916),a=n(260),o=n(6244),s=n(4590),u=n(7908),c=n(7293),l=r.RangeError,h=r.Int8Array,f=h&&h.prototype,p=f&&f.set,m=a.aTypedArray,d=a.exportTypedArrayMethod,v=!c((function(){var e=new Uint8ClampedArray(2);return i(p,e,{length:1,0:3},1),3!==e[1]})),y=v&&a.NATIVE_ARRAY_BUFFER_VIEWS&&c((function(){var e=new h(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));d("set",(function(e){m(this);var t=s(arguments.length>1?arguments[1]:void 0,1),n=u(e);if(v)return i(p,this,n,t);var r=this.length,a=o(n),c=0;if(a+t>r)throw l("Wrong length");for(;c<a;)this[t+c]=n[c++]}),!v||y)},678:function(e,t,n){"use strict";var r=n(260),i=n(6304),a=n(7293),o=n(206),s=r.aTypedArray;(0,r.exportTypedArrayMethod)("slice",(function(e,t){for(var n=o(s(this),e,t),r=i(this),a=0,u=n.length,c=new r(u);u>a;)c[a]=n[a++];return c}),a((function(){new Int8Array(1).slice()})))},7462:function(e,t,n){"use strict";var r=n(260),i=n(2092).some,a=r.aTypedArray;(0,r.exportTypedArrayMethod)("some",(function(e){return i(a(this),e,arguments.length>1?arguments[1]:void 0)}))},3824:function(e,t,n){"use strict";var r=n(7854),i=n(1470),a=n(7293),o=n(9662),s=n(4362),u=n(260),c=n(8886),l=n(256),h=n(7392),f=n(8008),p=u.aTypedArray,m=u.exportTypedArrayMethod,d=r.Uint16Array,v=d&&i(d.prototype.sort),y=!(!v||a((function(){v(new d(2),null)}))&&a((function(){v(new d(2),{})}))),g=!!v&&!a((function(){if(h)return h<74;if(c)return c<67;if(l)return!0;if(f)return f<602;var e,t,n=new d(516),r=Array(516);for(e=0;e<516;e++)t=e%4,n[e]=515-e,r[e]=e-2*t+3;for(v(n,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(n[e]!==r[e])return!0}));m("sort",(function(e){return void 0!==e&&o(e),g?v(this,e):s(p(this),function(e){return function(t,n){return void 0!==e?+e(t,n)||0:n!=n?-1:t!=t?1:0===t&&0===n?1/t>0&&1/n<0?1:-1:t>n}}(e))}),!g||y)},5021:function(e,t,n){"use strict";var r=n(260),i=n(7466),a=n(1400),o=n(6304),s=r.aTypedArray;(0,r.exportTypedArrayMethod)("subarray",(function(e,t){var n=s(this),r=n.length,u=a(e,r);return new(o(n))(n.buffer,n.byteOffset+u*n.BYTES_PER_ELEMENT,i((void 0===t?r:a(t,r))-u))}))},2974:function(e,t,n){"use strict";var r=n(7854),i=n(2104),a=n(260),o=n(7293),s=n(206),u=r.Int8Array,c=a.aTypedArray,l=a.exportTypedArrayMethod,h=[].toLocaleString,f=!!u&&o((function(){h.call(new u(1))}));l("toLocaleString",(function(){return i(h,f?s(c(this)):c(this),s(arguments))}),o((function(){return[1,2].toLocaleString()!=new u([1,2]).toLocaleString()}))||!o((function(){u.prototype.toLocaleString.call([1,2])})))},1439:function(e,t,n){"use strict";var r=n(1843),i=n(260),a=i.aTypedArray,o=i.exportTypedArrayMethod,s=i.getTypedArrayConstructor;o("toReversed",(function(){return r(a(this),s(this))}))},7585:function(e,t,n){"use strict";var r=n(260),i=n(1702),a=n(9662),o=n(7745),s=r.aTypedArray,u=r.getTypedArrayConstructor,c=r.exportTypedArrayMethod,l=i(r.TypedArrayPrototype.sort);c("toSorted",(function(e){void 0!==e&&a(e);var t=s(this),n=o(u(t),t);return l(n,e)}))},5016:function(e,t,n){"use strict";var r=n(260).exportTypedArrayMethod,i=n(7293),a=n(7854),o=n(1702),s=a.Uint8Array,u=s&&s.prototype||{},c=[].toString,l=o([].join);i((function(){c.call({})}))&&(c=function(){return l(this)});var h=u.toString!=c;r("toString",c,h)},8255:function(e,t,n){n(9843)("Uint16",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},9135:function(e,t,n){n(9843)("Uint32",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},2472:function(e,t,n){n(9843)("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}))},5315:function(e,t,n){"use strict";var r=n(1572),i=n(260),a=n(4067),o=n(9303),s=n(4599),u=i.aTypedArray,c=i.getTypedArrayConstructor,l=i.exportTypedArrayMethod,h=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}();l("with",{with:function(e,t){var n=u(this),i=o(e),l=a(n)?s(t):+t;return r(n,c(n),i,l)}}.with,!h)},1202:function(e,t,n){"use strict";var r,i=n(6677),a=n(7854),o=n(1702),s=n(9190),u=n(2423),c=n(7710),l=n(9320),h=n(111),f=n(9909).enforce,p=n(7293),m=n(4811),d=Object,v=Array.isArray,y=d.isExtensible,g=d.isFrozen,b=d.isSealed,M=d.freeze,k=d.seal,_={},x={},T=!a.ActiveXObject&&"ActiveXObject"in a,w=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},R=c("WeakMap",w,l),Z=R.prototype,S=o(Z.set);if(m)if(T){r=l.getConstructor(w,"WeakMap",!0),u.enable();var C=o(Z.delete),I=o(Z.has),E=o(Z.get);s(Z,{delete:function(e){if(h(e)&&!y(e)){var t=f(this);return t.frozen||(t.frozen=new r),C(this,e)||t.frozen.delete(e)}return C(this,e)},has:function(e){if(h(e)&&!y(e)){var t=f(this);return t.frozen||(t.frozen=new r),I(this,e)||t.frozen.has(e)}return I(this,e)},get:function(e){if(h(e)&&!y(e)){var t=f(this);return t.frozen||(t.frozen=new r),I(this,e)?E(this,e):t.frozen.get(e)}return E(this,e)},set:function(e,t){if(h(e)&&!y(e)){var n=f(this);n.frozen||(n.frozen=new r),I(this,e)?S(this,e,t):n.frozen.set(e,t)}else S(this,e,t);return this}})}else i&&p((function(){var e=M([]);return S(new R,e,1),!g(e)}))&&s(Z,{set:function(e,t){var n;return v(e)&&(g(e)?n=_:b(e)&&(n=x)),S(this,e,t),n==_&&M(e),n==x&&k(e),this}})},4129:function(e,t,n){n(1202)},2550:function(e,t,n){"use strict";var r=n(2109),i=n(1191),a=n(1223);r({target:"Array",proto:!0},{group:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),a("group")},6342:function(e,t,n){"use strict";var r=n(2109),i=n(5787),a=n(8880),o=n(2597),s=n(5112),u=n(6462),c=n(1913),l=s("toStringTag"),h=function(){i(this,u)};h.prototype=u,o(u,l)||a(u,l,"AsyncIterator"),!c&&o(u,"constructor")&&u.constructor!==Object||a(u,"constructor",h),r({global:!0,constructor:!0,forced:c},{AsyncIterator:h})},8216:function(e,t,n){"use strict";var r=n(2109),i=n(2269).every;r({target:"AsyncIterator",proto:!0,real:!0},{every:function(e){return i(this,e)}})},8449:function(e,t,n){"use strict";var r=n(2109),i=n(6916),a=n(9662),o=n(9670),s=n(111),u=n(4942),c=n(5348),l=n(6178),h=n(1753),f=c((function(e){var t=this,n=t.iterator,r=t.predicate;return new e((function(a,u){var c=function(e){t.done=!0,u(e)},f=function(e){h(n,c,e,c)},p=function(){try{e.resolve(o(i(t.next,n))).then((function(n){try{if(o(n).done)t.done=!0,a(l(void 0,!0));else{var i=n.value;try{var u=r(i,t.counter++),h=function(e){e?a(l(i,!1)):p()};s(u)?e.resolve(u).then(h,f):h(u)}catch(e){f(e)}}}catch(e){c(e)}}),c)}catch(e){c(e)}};p()}))}));r({target:"AsyncIterator",proto:!0,real:!0},{filter:function(e){return o(this),a(e),new f(u(this),{predicate:e})}})},1672:function(e,t,n){"use strict";var r=n(2109),i=n(2269).find;r({target:"AsyncIterator",proto:!0,real:!0},{find:function(e){return i(this,e)}})},5581:function(e,t,n){"use strict";var r=n(2109),i=n(2269).forEach;r({target:"AsyncIterator",proto:!0,real:!0},{forEach:function(e){return i(this,e)}})},7640:function(e,t,n){n(2109)({target:"AsyncIterator",proto:!0,real:!0},{map:n(3232)})},5387:function(e,t,n){"use strict";var r=n(2109),i=n(6916),a=n(9662),o=n(9670),s=n(111),u=n(5005),c=n(4942),l=n(1753),h=u("Promise"),f=TypeError;r({target:"AsyncIterator",proto:!0,real:!0},{reduce:function(e){o(this),a(e);var t=c(this),n=t.iterator,r=t.next,u=arguments.length<2,p=u?void 0:arguments[1],m=0;return new h((function(t,a){var c=function(e){l(n,a,e,a)},d=function(){try{h.resolve(o(i(r,n))).then((function(n){try{if(o(n).done)u?a(f("Reduce of empty iterator with no initial value")):t(p);else{var r=n.value;if(u)u=!1,p=r,d();else try{var i=e(p,r,m),l=function(e){p=e,d()};s(i)?h.resolve(i).then(l,c):l(i)}catch(e){c(e)}}m++}catch(e){a(e)}}),a)}catch(e){a(e)}};d()}))}})},4211:function(e,t,n){"use strict";var r=n(2109),i=n(2269).some;r({target:"AsyncIterator",proto:!0,real:!0},{some:function(e){return i(this,e)}})},2962:function(e,t,n){"use strict";var r=n(2109),i=n(2269).toArray;r({target:"AsyncIterator",proto:!0,real:!0},{toArray:function(){return i(this,void 0,[])}})},2490:function(e,t,n){"use strict";var r=n(2109),i=n(7854),a=n(5787),o=n(614),s=n(8880),u=n(7293),c=n(2597),l=n(5112),h=n(3383).IteratorPrototype,f=n(1913),p=l("toStringTag"),m=i.Iterator,d=f||!o(m)||m.prototype!==h||!u((function(){m({})})),v=function(){a(this,h)};c(h,p)||s(h,p,"Iterator"),!d&&c(h,"constructor")&&h.constructor!==Object||s(h,"constructor",v),v.prototype=h,r({global:!0,constructor:!0,forced:d},{Iterator:v})},9433:function(e,t,n){"use strict";var r=n(2109),i=n(408),a=n(9662),o=n(9670),s=n(4942);r({target:"Iterator",proto:!0,real:!0},{every:function(e){o(this),a(e);var t=s(this),n=0;return!i(t,(function(t,r){if(!e(t,n++))return r()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},9849:function(e,t,n){"use strict";var r=n(2109),i=n(6916),a=n(9662),o=n(9670),s=n(4942),u=n(4956),c=n(3411),l=u((function(){for(var e,t,n=this.iterator,r=this.predicate,a=this.next;;){if(e=o(i(a,n)),this.done=!!e.done)return;if(t=e.value,c(n,r,[t,this.counter++],!0))return t}}));r({target:"Iterator",proto:!0,real:!0},{filter:function(e){return o(this),a(e),new l(s(this),{predicate:e})}})},9461:function(e,t,n){"use strict";var r=n(2109),i=n(408),a=n(9662),o=n(9670),s=n(4942);r({target:"Iterator",proto:!0,real:!0},{find:function(e){o(this),a(e);var t=s(this),n=0;return i(t,(function(t,r){if(e(t,n++))return r(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},4514:function(e,t,n){"use strict";var r=n(2109),i=n(408),a=n(9662),o=n(9670),s=n(4942);r({target:"Iterator",proto:!0,real:!0},{forEach:function(e){o(this),a(e);var t=s(this),n=0;i(t,(function(t){e(t,n++)}),{IS_RECORD:!0})}})},9924:function(e,t,n){n(2109)({target:"Iterator",proto:!0,real:!0},{map:n(487)})},2608:function(e,t,n){"use strict";var r=n(2109),i=n(408),a=n(9662),o=n(9670),s=n(4942),u=TypeError;r({target:"Iterator",proto:!0,real:!0},{reduce:function(e){o(this),a(e);var t=s(this),n=arguments.length<2,r=n?void 0:arguments[1],c=0;if(i(t,(function(t){n?(n=!1,r=t):r=e(r,t,c),c++}),{IS_RECORD:!0}),n)throw u("Reduce of empty iterator with no initial value");return r}})},1874:function(e,t,n){"use strict";var r=n(2109),i=n(408),a=n(9662),o=n(9670),s=n(4942);r({target:"Iterator",proto:!0,real:!0},{some:function(e){o(this),a(e);var t=s(this),n=0;return i(t,(function(t,r){if(e(t,n++))return r()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},3748:function(e,t,n){"use strict";var r=n(2109),i=n(9670),a=n(408),o=n(4942),s=[].push;r({target:"Iterator",proto:!0,real:!0},{toArray:function(){var e=[];return a(o(i(this)),s,{that:e,IS_RECORD:!0}),e}})},72:function(e,t,n){"use strict";var r=n(2109),i=n(27),a=n(5706).remove;r({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=i(this),n=!0,r=0,o=arguments.length;r<o;r++)e=a(t,arguments[r]),n=n&&e;return!!n}})},3042:function(e,t,n){"use strict";var r=n(2109),i=n(27),a=n(5706),o=a.get,s=a.has,u=a.set;r({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function(e,t){var n,r,a=i(this);return s(a,e)?(n=o(a,e),"update"in t&&(n=t.update(n,e,a),u(a,e,n)),n):(r=t.insert(e,a),u(a,e,r),r)}})},9137:function(e,t,n){"use strict";var r=n(2109),i=n(9974),a=n(27),o=n(4995);r({target:"Map",proto:!0,real:!0,forced:!0},{every:function(e){var t=a(this),n=i(e,arguments.length>1?arguments[1]:void 0);return!1!==o(t,(function(e,r){if(!n(e,r,t))return!1}),!0)}})},1957:function(e,t,n){"use strict";var r=n(2109),i=n(9974),a=n(27),o=n(5706),s=n(4995),u=o.Map,c=o.set;r({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(e){var t=a(this),n=i(e,arguments.length>1?arguments[1]:void 0),r=new u;return s(t,(function(e,i){n(e,i,t)&&c(r,i,e)})),r}})},103:function(e,t,n){"use strict";var r=n(2109),i=n(9974),a=n(27),o=n(4995);r({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(e){var t=a(this),n=i(e,arguments.length>1?arguments[1]:void 0),r=o(t,(function(e,r){if(n(e,r,t))return{key:r}}),!0);return r&&r.key}})},6306:function(e,t,n){"use strict";var r=n(2109),i=n(9974),a=n(27),o=n(4995);r({target:"Map",proto:!0,real:!0,forced:!0},{find:function(e){var t=a(this),n=i(e,arguments.length>1?arguments[1]:void 0),r=o(t,(function(e,r){if(n(e,r,t))return{value:e}}),!0);return r&&r.value}})},4592:function(e,t,n){"use strict";var r=n(2109),i=n(6465),a=n(27),o=n(4995);r({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(e){return!0===o(a(this),(function(t){if(i(t,e))return!0}),!0)}})},8276:function(e,t,n){"use strict";var r=n(2109),i=n(27),a=n(4995);r({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(e){var t=a(i(this),(function(t,n){if(t===e)return{key:n}}),!0);return t&&t.key}})},5082:function(e,t,n){"use strict";var r=n(2109),i=n(9974),a=n(27),o=n(5706),s=n(4995),u=o.Map,c=o.set;r({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(e){var t=a(this),n=i(e,arguments.length>1?arguments[1]:void 0),r=new u;return s(t,(function(e,i){c(r,n(e,i,t),e)})),r}})},2813:function(e,t,n){"use strict";var r=n(2109),i=n(9974),a=n(27),o=n(5706),s=n(4995),u=o.Map,c=o.set;r({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(e){var t=a(this),n=i(e,arguments.length>1?arguments[1]:void 0),r=new u;return s(t,(function(e,i){c(r,i,n(e,i,t))})),r}})},8222:function(e,t,n){"use strict";var r=n(2109),i=n(27),a=n(408),o=n(5706).set;r({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(e){for(var t=i(this),n=arguments.length,r=0;r<n;)a(arguments[r++],(function(e,n){o(t,e,n)}),{AS_ENTRIES:!0});return t}})},8563:function(e,t,n){"use strict";var r=n(2109),i=n(9662),a=n(27),o=n(4995),s=TypeError;r({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=a(this),n=arguments.length<2,r=n?void 0:arguments[1];if(i(e),o(t,(function(i,a){n?(n=!1,r=i):r=e(r,i,a,t)})),n)throw s("Reduce of empty map with no initial value");return r}})},336:function(e,t,n){"use strict";var r=n(2109),i=n(9974),a=n(27),o=n(4995);r({target:"Map",proto:!0,real:!0,forced:!0},{some:function(e){var t=a(this),n=i(e,arguments.length>1?arguments[1]:void 0);return!0===o(t,(function(e,r){if(n(e,r,t))return!0}),!0)}})},7512:function(e,t,n){"use strict";var r=n(2109),i=n(9662),a=n(27),o=n(5706),s=TypeError,u=o.get,c=o.has,l=o.set;r({target:"Map",proto:!0,real:!0,forced:!0},{update:function(e,t){var n=a(this),r=arguments.length;i(t);var o=c(n,e);if(!o&&r<3)throw s("Updating absent value");var h=o?u(n,e):i(r>2?arguments[2]:void 0)(e,n);return l(n,e,t(h,e,n)),n}})},8922:function(e,t,n){"use strict";var r=n(260),i=n(2092).filterReject,a=n(3074),o=r.aTypedArray;(0,r.exportTypedArrayMethod)("filterReject",(function(e){var t=i(o(this),e,arguments.length>1?arguments[1]:void 0);return a(this,t)}),!0)},5835:function(e,t,n){"use strict";var r=n(260),i=n(1191),a=n(6304),o=r.aTypedArray;(0,r.exportTypedArrayMethod)("groupBy",(function(e){var t=arguments.length>1?arguments[1]:void 0;return i(o(this),e,t,a)}),!0)},3767:function(e,t,n){n(1439)},8585:function(e,t,n){n(7585)},8970:function(e,t,n){"use strict";var r=n(260),i=n(6244),a=n(4067),o=n(1400),s=n(4599),u=n(9303),c=n(7293),l=r.aTypedArray,h=r.getTypedArrayConstructor,f=r.exportTypedArrayMethod,p=Math.max,m=Math.min;f("toSpliced",(function(e,t){var n,r,c,f,d,v,y,g=l(this),b=h(g),M=i(g),k=o(e,M),_=arguments.length,x=0;if(0===_)n=r=0;else if(1===_)n=0,r=M-k;else if(r=m(p(u(t),0),M-k),n=_-2){f=new b(n),c=a(f);for(var T=2;T<_;T++)d=arguments[T],f[T-2]=c?s(d):+d}for(y=new b(v=M+n-r);x<k;x++)y[x]=g[x];for(;x<k+n;x++)y[x]=f[x-k];for(;x<v;x++)y[x]=g[x+r-n];return y}),!!c((function(){var e=new Int8Array([1]),t=e.toSpliced(1,0,{valueOf:function(){return e[0]=2,3}});return 2!==t[0]||3!==t[1]})))},4444:function(e,t,n){"use strict";var r=n(1702),i=n(260),a=n(7745),o=n(956),s=i.aTypedArray,u=i.getTypedArrayConstructor,c=i.exportTypedArrayMethod,l=r(o);c("uniqueBy",(function(e){return s(this),a(u(this),l(this,e))}),!0)},8696:function(e,t,n){n(5315)},8206:function(e,t,n){"use strict";var r=n(2109),i=n(9257),a=n(953).remove;r({target:"WeakMap",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=i(this),n=!0,r=0,o=arguments.length;r<o;r++)e=a(t,arguments[r]),n=n&&e;return!!n}})},2714:function(e,t,n){"use strict";var r=n(2109),i=n(9257),a=n(953),o=a.get,s=a.has,u=a.set;r({target:"WeakMap",proto:!0,real:!0,forced:!0},{emplace:function(e,t){var n,r,a=i(this);return s(a,e)?(n=o(a,e),"update"in t&&(n=t.update(n,e,a),u(a,e,n)),n):(r=t.insert(e,a),u(a,e,r),r)}})},5505:function(e,t,n){var r=n(2109),i=n(7854),a=n(5005),o=n(1702),s=n(6916),u=n(7293),c=n(1340),l=n(2597),h=n(8053),f=n(4170).ctoi,p=/[^\d+/a-z]/i,m=/[\t\n\f\r ]+/g,d=/[=]{1,2}$/,v=a("atob"),y=String.fromCharCode,g=o("".charAt),b=o("".replace),M=o(p.exec),k=u((function(){return""!==v(" ")})),_=!u((function(){v("a")})),x=!k&&!_&&!u((function(){v()})),T=!k&&!_&&1!==v.length;r({global:!0,bind:!0,enumerable:!0,forced:k||_||x||T},{atob:function(e){if(h(arguments.length,1),x||T)return s(v,i,e);var t,n,r=b(c(e),m,""),o="",u=0,k=0;if(r.length%4==0&&(r=b(r,d,"")),r.length%4==1||M(p,r))throw new(a("DOMException"))("The string is not correctly encoded","InvalidCharacterError");for(;t=g(r,u++);)l(f,t)&&(n=k%4?64*n+f[t]:f[t],k++%4&&(o+=y(255&n>>(-2*k&6))));return o}})},7479:function(e,t,n){var r=n(2109),i=n(7854),a=n(5005),o=n(1702),s=n(6916),u=n(7293),c=n(1340),l=n(8053),h=n(4170).itoc,f=a("btoa"),p=o("".charAt),m=o("".charCodeAt),d=!!f&&!u((function(){f()})),v=!!f&&u((function(){return"bnVsbA=="!==f(null)})),y=!!f&&1!==f.length;r({global:!0,bind:!0,enumerable:!0,forced:d||v||y},{btoa:function(e){if(l(arguments.length,1),d||v||y)return s(f,i,c(e));for(var t,n,r=c(e),o="",u=0,g=h;p(r,u)||(g="=",u%1);){if((n=m(r,u+=3/4))>255)throw new(a("DOMException"))("The string contains characters outside of the Latin1 range","InvalidCharacterError");o+=p(g,63&(t=t<<8|n)>>8-u%1*8)}return o}})},4747:function(e,t,n){var r=n(7854),i=n(8324),a=n(8509),o=n(8533),s=n(8880),u=function(e){if(e&&e.forEach!==o)try{s(e,"forEach",o)}catch(t){e.forEach=o}};for(var c in i)i[c]&&u(r[c]&&r[c].prototype);u(a)},3948:function(e,t,n){var r=n(7854),i=n(8324),a=n(8509),o=n(6992),s=n(8880),u=n(5112),c=u("iterator"),l=u("toStringTag"),h=o.values,f=function(e,t){if(e){if(e[c]!==h)try{s(e,c,h)}catch(t){e[c]=h}if(e[l]||s(e,l,t),i[t])for(var n in o)if(e[n]!==o[n])try{s(e,n,o[n])}catch(t){e[n]=o[n]}}};for(var p in i)f(r[p]&&r[p].prototype,p);f(a,"DOMTokenList")},7714:function(e,t,n){"use strict";var r=n(2109),i=n(4038),a=n(5005),o=n(7293),s=n(30),u=n(9114),c=n(3070).f,l=n(8052),h=n(7045),f=n(2597),p=n(5787),m=n(9670),d=n(7762),v=n(6277),y=n(3678),g=n(1060),b=n(9909),M=n(9781),k=n(1913),_="DOMException",x="DATA_CLONE_ERR",T=a("Error"),w=a(_)||function(){try{(new(a("MessageChannel")||i("worker_threads").MessageChannel)).port1.postMessage(new WeakMap)}catch(e){if(e.name==x&&25==e.code)return e.constructor}}(),R=w&&w.prototype,Z=T.prototype,S=b.set,C=b.getterFor(_),I="stack"in T(_),E=function(e){return f(y,e)&&y[e].m?y[e].c:0},A=function(){p(this,O);var e=arguments.length,t=v(e<1?void 0:arguments[0]),n=v(e<2?void 0:arguments[1],"Error"),r=E(n);if(S(this,{type:_,name:n,message:t,code:r}),M||(this.name=n,this.message=t,this.code=r),I){var i=T(t);i.name=_,c(this,"stack",u(1,g(i.stack,1)))}},O=A.prototype=s(Z),D=function(e){return{enumerable:!0,configurable:!0,get:e}},P=function(e){return D((function(){return C(this)[e]}))};M&&(h(O,"code",P("code")),h(O,"message",P("message")),h(O,"name",P("name"))),c(O,"constructor",u(1,A));var B=o((function(){return!(new w instanceof T)})),F=B||o((function(){return Z.toString!==d||"2: 1"!==String(new w(1,2))})),L=B||o((function(){return 25!==new w(1,"DataCloneError").code})),N=B||25!==w[x]||25!==R[x],j=k?F||L||N:B;r({global:!0,constructor:!0,forced:j},{DOMException:j?A:w});var z=a(_),U=z.prototype;for(var V in F&&(k||w===z)&&l(U,"toString",d),L&&M&&w===z&&h(U,"code",D((function(){return E(m(this).name)}))),y)if(f(y,V)){var H=y[V],G=H.s,q=u(6,H.c);f(z,G)||c(z,G,q),f(U,G)||c(U,G,q)}},2801:function(e,t,n){"use strict";var r=n(2109),i=n(7854),a=n(5005),o=n(9114),s=n(3070).f,u=n(2597),c=n(5787),l=n(9587),h=n(6277),f=n(3678),p=n(1060),m=n(9781),d=n(1913),v="DOMException",y=a("Error"),g=a(v),b=function(){c(this,M);var e=arguments.length,t=h(e<1?void 0:arguments[0]),n=h(e<2?void 0:arguments[1],"Error"),r=new g(t,n),i=y(t);return i.name=v,s(r,"stack",o(1,p(i.stack,1))),l(r,this,b),r},M=b.prototype=g.prototype,k="stack"in y(v),_="stack"in new g(1,2),x=g&&m&&Object.getOwnPropertyDescriptor(i,v),T=!(!x||x.writable&&x.configurable),w=k&&!T&&!_;r({global:!0,constructor:!0,forced:d||w},{DOMException:w?b:g});var R=a(v),Z=R.prototype;if(Z.constructor!==R)for(var S in d||s(Z,"constructor",o(1,R)),f)if(u(f,S)){var C=f[S],I=C.s;u(R,I)||s(R,I,o(6,C.c))}},1174:function(e,t,n){var r=n(5005),i="DOMException";n(8003)(r(i),i)},1295:function(e,t,n){var r,i=n(1913),a=n(2109),o=n(7854),s=n(5005),u=n(1702),c=n(7293),l=n(9711),h=n(614),f=n(4411),p=n(8554),m=n(111),d=n(2190),v=n(408),y=n(9670),g=n(648),b=n(2597),M=n(6135),k=n(8880),_=n(6244),x=n(8053),T=n(4706),w=n(5706),R=n(9405),Z=n(2914),S=n(4124),C=o.Object,I=o.Array,E=o.Date,A=o.Error,O=o.EvalError,D=o.RangeError,P=o.ReferenceError,B=o.SyntaxError,F=o.TypeError,L=o.URIError,N=o.PerformanceMark,j=o.WebAssembly,z=j&&j.CompileError||A,U=j&&j.LinkError||A,V=j&&j.RuntimeError||A,H=s("DOMException"),G=w.Map,q=w.has,W=w.get,Y=w.set,K=R.Set,X=R.add,$=s("Object","keys"),Q=u([].push),J=u((!0).valueOf),ee=u(1..valueOf),te=u("".valueOf),ne=u(E.prototype.getTime),re=l("structuredClone"),ie="DataCloneError",ae="Transferring",oe=function(e){return!c((function(){var t=new o.Set([7]),n=e(t),r=e(C(7));return n==t||!n.has(7)||"object"!=typeof r||7!=r}))&&e},se=function(e,t){return!c((function(){var n=new t,r=e({a:n,b:n});return!(r&&r.a===r.b&&r.a instanceof t&&r.a.stack===n.stack)}))},ue=o.structuredClone,ce=i||!se(ue,A)||!se(ue,H)||(r=ue,!!c((function(){var e=r(new o.AggregateError([1],re,{cause:3}));return"AggregateError"!=e.name||1!=e.errors[0]||e.message!=re||3!=e.cause}))),le=!ue&&oe((function(e){return new N(re,{detail:e}).detail})),he=oe(ue)||le,fe=function(e){throw new H("Uncloneable type: "+e,ie)},pe=function(e,t){throw new H((t||"Cloning")+" of "+e+" cannot be properly polyfilled in this engine",ie)},me=function(e,t){if(d(e)&&fe("Symbol"),!m(e))return e;if(t){if(q(t,e))return W(t,e)}else t=new G;var n,r,i,a,u,c,l,f,p,v,y,x=g(e),w=!1;switch(x){case"Array":i=I(_(e)),w=!0;break;case"Object":i={},w=!0;break;case"Map":i=new G,w=!0;break;case"Set":i=new K,w=!0;break;case"RegExp":i=new RegExp(e.source,T(e));break;case"Error":switch(r=e.name){case"AggregateError":i=s("AggregateError")([]);break;case"EvalError":i=O();break;case"RangeError":i=D();break;case"ReferenceError":i=P();break;case"SyntaxError":i=B();break;case"TypeError":i=F();break;case"URIError":i=L();break;case"CompileError":i=z();break;case"LinkError":i=U();break;case"RuntimeError":i=V();break;default:i=A()}w=!0;break;case"DOMException":i=new H(e.message,e.name),w=!0;break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":n=o[x],m(n)||pe(x),i=new n(me(e.buffer,t),e.byteOffset,"DataView"===x?e.byteLength:e.length);break;case"DOMQuad":try{i=new DOMQuad(me(e.p1,t),me(e.p2,t),me(e.p3,t),me(e.p4,t))}catch(t){he?i=he(e):pe(x)}break;case"FileList":if(a=function(){var e;try{e=new o.DataTransfer}catch(t){try{e=new o.ClipboardEvent("").clipboardData}catch(e){}}return e&&e.items&&e.files?e:null}()){for(u=0,c=_(e);u<c;u++)a.items.add(me(e[u],t));i=a.files}else he?i=he(e):pe(x);break;case"ImageData":try{i=new ImageData(me(e.data,t),e.width,e.height,{colorSpace:e.colorSpace})}catch(t){he?i=he(e):pe(x)}break;default:if(he)i=he(e);else switch(x){case"BigInt":i=C(e.valueOf());break;case"Boolean":i=C(J(e));break;case"Number":i=C(ee(e));break;case"String":i=C(te(e));break;case"Date":i=new E(ne(e));break;case"ArrayBuffer":(n=o.DataView)||"function"==typeof e.slice||pe(x);try{if("function"!=typeof e.slice||e.resizable){c=e.byteLength,y="maxByteLength"in e?{maxByteLength:e.maxByteLength}:void 0,i=new ArrayBuffer(c,y),p=new n(e),v=new n(i);for(u=0;u<c;u++)v.setUint8(u,p.getUint8(u))}else i=e.slice(0)}catch(e){throw new H("ArrayBuffer is detached",ie)}break;case"SharedArrayBuffer":i=e;break;case"Blob":try{i=e.slice(0,e.size,e.type)}catch(e){pe(x)}break;case"DOMPoint":case"DOMPointReadOnly":n=o[x];try{i=n.fromPoint?n.fromPoint(e):new n(e.x,e.y,e.z,e.w)}catch(e){pe(x)}break;case"DOMRect":case"DOMRectReadOnly":n=o[x];try{i=n.fromRect?n.fromRect(e):new n(e.x,e.y,e.width,e.height)}catch(e){pe(x)}break;case"DOMMatrix":case"DOMMatrixReadOnly":n=o[x];try{i=n.fromMatrix?n.fromMatrix(e):new n(e)}catch(e){pe(x)}break;case"AudioData":case"VideoFrame":h(e.clone)||pe(x);try{i=e.clone()}catch(e){fe(x)}break;case"File":try{i=new File([e],e.name,e)}catch(e){pe(x)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":pe(x);default:fe(x)}}if(Y(t,e,i),w)switch(x){case"Array":case"Object":for(l=$(e),u=0,c=_(l);u<c;u++)f=l[u],M(i,f,me(e[f],t));break;case"Map":e.forEach((function(e,n){Y(i,me(n,t),me(e,t))}));break;case"Set":e.forEach((function(e){X(i,me(e,t))}));break;case"Error":k(i,"message",me(e.message,t)),b(e,"cause")&&k(i,"cause",me(e.cause,t)),"AggregateError"==r&&(i.errors=me(e.errors,t));case"DOMException":Z&&k(i,"stack",me(e.stack,t))}return i};a({global:!0,enumerable:!0,sham:!S,forced:ce},{structuredClone:function(e){var t,n=x(arguments.length,1)>1&&!p(arguments[1])?y(arguments[1]):void 0,r=n?n.transfer:void 0;return void 0!==r&&function(e,t){if(!m(e))throw F("Transfer option cannot be converted to a sequence");var n=[];v(e,(function(e){Q(n,y(e))}));var r,i,a,s,u,c,l=0,p=_(n);if(S)for(s=ue(n,{transfer:n});l<p;)Y(t,n[l],s[l++]);else for(;l<p;){if(r=n[l++],q(t,r))throw new H("Duplicate transferable",ie);switch(i=g(r)){case"ImageBitmap":a=o.OffscreenCanvas,f(a)||pe(i,ae);try{(c=new a(r.width,r.height)).getContext("bitmaprenderer").transferFromImageBitmap(r),u=c.transferToImageBitmap()}catch(e){}break;case"AudioData":case"VideoFrame":h(r.clone)&&h(r.close)||pe(i,ae);try{u=r.clone(),r.close()}catch(e){}break;case"ArrayBuffer":h(r.transfer)||pe(i,ae),u=r.transfer();break;case"MediaSourceHandle":case"MessagePort":case"OffscreenCanvas":case"ReadableStream":case"TransformStream":case"WritableStream":pe(i,ae)}if(void 0===u)throw new H("This object cannot be transferred: "+i,ie);Y(t,r,u)}}(r,t=new G),me(e,t)}})},5556:function(e,t,n){"use strict";n(6992);var r=n(2109),i=n(7854),a=n(6916),o=n(1702),s=n(9781),u=n(5143),c=n(8052),l=n(7045),h=n(9190),f=n(8003),p=n(3061),m=n(9909),d=n(5787),v=n(614),y=n(2597),g=n(9974),b=n(648),M=n(9670),k=n(111),_=n(1340),x=n(30),T=n(9114),w=n(4121),R=n(1246),Z=n(8053),S=n(5112),C=n(4362),I=S("iterator"),E="URLSearchParams",A=E+"Iterator",O=m.set,D=m.getterFor(E),P=m.getterFor(A),B=Object.getOwnPropertyDescriptor,F=function(e){if(!s)return i[e];var t=B(i,e);return t&&t.value},L=F("fetch"),N=F("Request"),j=F("Headers"),z=N&&N.prototype,U=j&&j.prototype,V=i.RegExp,H=i.TypeError,G=i.decodeURIComponent,q=i.encodeURIComponent,W=o("".charAt),Y=o([].join),K=o([].push),X=o("".replace),$=o([].shift),Q=o([].splice),J=o("".split),ee=o("".slice),te=/\+/g,ne=Array(4),re=function(e){return ne[e-1]||(ne[e-1]=V("((?:%[\\da-f]{2}){"+e+"})","gi"))},ie=function(e){try{return G(e)}catch(t){return e}},ae=function(e){var t=X(e,te," "),n=4;try{return G(t)}catch(e){for(;n;)t=X(t,re(n--),ie);return t}},oe=/[!'()~]|%20/g,se={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},ue=function(e){return se[e]},ce=function(e){return X(q(e),oe,ue)},le=p((function(e,t){O(this,{type:A,iterator:w(D(e).entries),kind:t})}),"Iterator",(function(){var e=P(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n}),!0),he=function(e){this.entries=[],this.url=null,void 0!==e&&(k(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===W(e,0)?ee(e,1):e:_(e)))};he.prototype={type:E,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,o,s,u,c=R(e);if(c)for(n=(t=w(e,c)).next;!(r=a(n,t)).done;){if(o=(i=w(M(r.value))).next,(s=a(o,i)).done||(u=a(o,i)).done||!a(o,i).done)throw H("Expected sequence with length 2");K(this.entries,{key:_(s.value),value:_(u.value)})}else for(var l in e)y(e,l)&&K(this.entries,{key:l,value:_(e[l])})},parseQuery:function(e){if(e)for(var t,n,r=J(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(n=J(t,"="),K(this.entries,{key:ae($(n)),value:ae(Y(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],K(n,ce(e.key)+"="+ce(e.value));return Y(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var fe=function(){d(this,pe);var e=O(this,new he(arguments.length>0?arguments[0]:void 0));s||(this.length=e.entries.length)},pe=fe.prototype;if(h(pe,{append:function(e,t){Z(arguments.length,2);var n=D(this);K(n.entries,{key:_(e),value:_(t)}),s||this.length++,n.updateURL()},delete:function(e){Z(arguments.length,1);for(var t=D(this),n=t.entries,r=_(e),i=0;i<n.length;)n[i].key===r?Q(n,i,1):i++;s||(this.length=n.length),t.updateURL()},get:function(e){Z(arguments.length,1);for(var t=D(this).entries,n=_(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){Z(arguments.length,1);for(var t=D(this).entries,n=_(e),r=[],i=0;i<t.length;i++)t[i].key===n&&K(r,t[i].value);return r},has:function(e){Z(arguments.length,1);for(var t=D(this).entries,n=_(e),r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){Z(arguments.length,1);for(var n,r=D(this),i=r.entries,a=!1,o=_(e),u=_(t),c=0;c<i.length;c++)(n=i[c]).key===o&&(a?Q(i,c--,1):(a=!0,n.value=u));a||K(i,{key:o,value:u}),s||(this.length=i.length),r.updateURL()},sort:function(){var e=D(this);C(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=D(this).entries,r=g(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new le(this,"keys")},values:function(){return new le(this,"values")},entries:function(){return new le(this,"entries")}},{enumerable:!0}),c(pe,I,pe.entries,{name:"entries"}),c(pe,"toString",(function(){return D(this).serialize()}),{enumerable:!0}),s&&l(pe,"size",{get:function(){return D(this).entries.length},configurable:!0,enumerable:!0}),f(fe,E),r({global:!0,constructor:!0,forced:!u},{URLSearchParams:fe}),!u&&v(j)){var me=o(U.has),de=o(U.set),ve=function(e){if(k(e)){var t,n=e.body;if(b(n)===E)return t=e.headers?new j(e.headers):new j,me(t,"content-type")||de(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),x(e,{body:T(0,_(n)),headers:T(0,t)})}return e};if(v(L)&&r({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return L(e,arguments.length>1?ve(arguments[1]):{})}}),v(N)){var ye=function(e){return d(this,z),new N(e,arguments.length>1?ve(arguments[1]):{})};z.constructor=ye,ye.prototype=z,r({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:ye})}}e.exports={URLSearchParams:fe,getState:D}},1637:function(e,t,n){n(5556)},8789:function(e,t,n){"use strict";n(8783);var r,i=n(2109),a=n(9781),o=n(5143),s=n(7854),u=n(9974),c=n(1702),l=n(8052),h=n(7045),f=n(5787),p=n(2597),m=n(1574),d=n(8457),v=n(1589),y=n(8710).codeAt,g=n(3197),b=n(1340),M=n(8003),k=n(8053),_=n(5556),x=n(9909),T=x.set,w=x.getterFor("URL"),R=_.URLSearchParams,Z=_.getState,S=s.URL,C=s.TypeError,I=s.parseInt,E=Math.floor,A=Math.pow,O=c("".charAt),D=c(/./.exec),P=c([].join),B=c(1..toString),F=c([].pop),L=c([].push),N=c("".replace),j=c([].shift),z=c("".split),U=c("".slice),V=c("".toLowerCase),H=c([].unshift),G="Invalid scheme",q="Invalid host",W="Invalid port",Y=/[a-z]/i,K=/[\d+-.a-z]/i,X=/\d/,$=/^0x/i,Q=/^[0-7]+$/,J=/^\d+$/,ee=/^[\da-f]+$/i,te=/[\0\t\n\r #%/:<>?@[\\\]^|]/,ne=/[\0\t\n\r #/:<>?@[\\\]^|]/,re=/^[\u0000-\u0020]+/,ie=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,ae=/[\t\n\r]/g,oe=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)H(t,e%256),e=E(e/256);return P(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,a=0;a<8;a++)0!==e[a]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=a),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=B(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},se={},ue=m({},se,{" ":1,'"':1,"<":1,">":1,"`":1}),ce=m({},ue,{"#":1,"?":1,"{":1,"}":1}),le=m({},ce,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),he=function(e,t){var n=y(e,0);return n>32&&n<127&&!p(t,e)?e:encodeURIComponent(e)},fe={ftp:21,file:null,http:80,https:443,ws:80,wss:443},pe=function(e,t){var n;return 2==e.length&&D(Y,O(e,0))&&(":"==(n=O(e,1))||!t&&"|"==n)},me=function(e){var t;return e.length>1&&pe(U(e,0,2))&&(2==e.length||"/"===(t=O(e,2))||"\\"===t||"?"===t||"#"===t)},de=function(e){return"."===e||"%2e"===V(e)},ve={},ye={},ge={},be={},Me={},ke={},_e={},xe={},Te={},we={},Re={},Ze={},Se={},Ce={},Ie={},Ee={},Ae={},Oe={},De={},Pe={},Be={},Fe=function(e,t,n){var r,i,a,o=b(e);if(t){if(i=this.parse(o))throw C(i);this.searchParams=null}else{if(void 0!==n&&(r=new Fe(n,!0)),i=this.parse(o,null,r))throw C(i);(a=Z(new R)).bindURL(this),this.searchParams=a}};Fe.prototype={type:"URL",parse:function(e,t,n){var i,a,o,s,u,c=this,l=t||ve,h=0,f="",m=!1,y=!1,g=!1;for(e=b(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=N(e,re,""),e=N(e,ie,"$1")),e=N(e,ae,""),i=d(e);h<=i.length;){switch(a=i[h],l){case ve:if(!a||!D(Y,a)){if(t)return G;l=ge;continue}f+=V(a),l=ye;break;case ye:if(a&&(D(K,a)||"+"==a||"-"==a||"."==a))f+=V(a);else{if(":"!=a){if(t)return G;f="",l=ge,h=0;continue}if(t&&(c.isSpecial()!=p(fe,f)||"file"==f&&(c.includesCredentials()||null!==c.port)||"file"==c.scheme&&!c.host))return;if(c.scheme=f,t)return void(c.isSpecial()&&fe[c.scheme]==c.port&&(c.port=null));f="","file"==c.scheme?l=Ce:c.isSpecial()&&n&&n.scheme==c.scheme?l=be:c.isSpecial()?l=xe:"/"==i[h+1]?(l=Me,h++):(c.cannotBeABaseURL=!0,L(c.path,""),l=De)}break;case ge:if(!n||n.cannotBeABaseURL&&"#"!=a)return G;if(n.cannotBeABaseURL&&"#"==a){c.scheme=n.scheme,c.path=v(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,l=Be;break}l="file"==n.scheme?Ce:ke;continue;case be:if("/"!=a||"/"!=i[h+1]){l=ke;continue}l=Te,h++;break;case Me:if("/"==a){l=we;break}l=Oe;continue;case ke:if(c.scheme=n.scheme,a==r)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=v(n.path),c.query=n.query;else if("/"==a||"\\"==a&&c.isSpecial())l=_e;else if("?"==a)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=v(n.path),c.query="",l=Pe;else{if("#"!=a){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=v(n.path),c.path.length--,l=Oe;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=v(n.path),c.query=n.query,c.fragment="",l=Be}break;case _e:if(!c.isSpecial()||"/"!=a&&"\\"!=a){if("/"!=a){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,l=Oe;continue}l=we}else l=Te;break;case xe:if(l=Te,"/"!=a||"/"!=O(f,h+1))continue;h++;break;case Te:if("/"!=a&&"\\"!=a){l=we;continue}break;case we:if("@"==a){m&&(f="%40"+f),m=!0,o=d(f);for(var M=0;M<o.length;M++){var k=o[M];if(":"!=k||g){var _=he(k,le);g?c.password+=_:c.username+=_}else g=!0}f=""}else if(a==r||"/"==a||"?"==a||"#"==a||"\\"==a&&c.isSpecial()){if(m&&""==f)return"Invalid authority";h-=d(f).length+1,f="",l=Re}else f+=a;break;case Re:case Ze:if(t&&"file"==c.scheme){l=Ee;continue}if(":"!=a||y){if(a==r||"/"==a||"?"==a||"#"==a||"\\"==a&&c.isSpecial()){if(c.isSpecial()&&""==f)return q;if(t&&""==f&&(c.includesCredentials()||null!==c.port))return;if(s=c.parseHost(f))return s;if(f="",l=Ae,t)return;continue}"["==a?y=!0:"]"==a&&(y=!1),f+=a}else{if(""==f)return q;if(s=c.parseHost(f))return s;if(f="",l=Se,t==Ze)return}break;case Se:if(!D(X,a)){if(a==r||"/"==a||"?"==a||"#"==a||"\\"==a&&c.isSpecial()||t){if(""!=f){var x=I(f,10);if(x>65535)return W;c.port=c.isSpecial()&&x===fe[c.scheme]?null:x,f=""}if(t)return;l=Ae;continue}return W}f+=a;break;case Ce:if(c.scheme="file","/"==a||"\\"==a)l=Ie;else{if(!n||"file"!=n.scheme){l=Oe;continue}if(a==r)c.host=n.host,c.path=v(n.path),c.query=n.query;else if("?"==a)c.host=n.host,c.path=v(n.path),c.query="",l=Pe;else{if("#"!=a){me(P(v(i,h),""))||(c.host=n.host,c.path=v(n.path),c.shortenPath()),l=Oe;continue}c.host=n.host,c.path=v(n.path),c.query=n.query,c.fragment="",l=Be}}break;case Ie:if("/"==a||"\\"==a){l=Ee;break}n&&"file"==n.scheme&&!me(P(v(i,h),""))&&(pe(n.path[0],!0)?L(c.path,n.path[0]):c.host=n.host),l=Oe;continue;case Ee:if(a==r||"/"==a||"\\"==a||"?"==a||"#"==a){if(!t&&pe(f))l=Oe;else if(""==f){if(c.host="",t)return;l=Ae}else{if(s=c.parseHost(f))return s;if("localhost"==c.host&&(c.host=""),t)return;f="",l=Ae}continue}f+=a;break;case Ae:if(c.isSpecial()){if(l=Oe,"/"!=a&&"\\"!=a)continue}else if(t||"?"!=a)if(t||"#"!=a){if(a!=r&&(l=Oe,"/"!=a))continue}else c.fragment="",l=Be;else c.query="",l=Pe;break;case Oe:if(a==r||"/"==a||"\\"==a&&c.isSpecial()||!t&&("?"==a||"#"==a)){if(".."===(u=V(u=f))||"%2e."===u||".%2e"===u||"%2e%2e"===u?(c.shortenPath(),"/"==a||"\\"==a&&c.isSpecial()||L(c.path,"")):de(f)?"/"==a||"\\"==a&&c.isSpecial()||L(c.path,""):("file"==c.scheme&&!c.path.length&&pe(f)&&(c.host&&(c.host=""),f=O(f,0)+":"),L(c.path,f)),f="","file"==c.scheme&&(a==r||"?"==a||"#"==a))for(;c.path.length>1&&""===c.path[0];)j(c.path);"?"==a?(c.query="",l=Pe):"#"==a&&(c.fragment="",l=Be)}else f+=he(a,ce);break;case De:"?"==a?(c.query="",l=Pe):"#"==a?(c.fragment="",l=Be):a!=r&&(c.path[0]+=he(a,se));break;case Pe:t||"#"!=a?a!=r&&("'"==a&&c.isSpecial()?c.query+="%27":c.query+="#"==a?"%23":he(a,se)):(c.fragment="",l=Be);break;case Be:a!=r&&(c.fragment+=he(a,ue))}h++}},parseHost:function(e){var t,n,r;if("["==O(e,0)){if("]"!=O(e,e.length-1))return q;if(t=function(e){var t,n,r,i,a,o,s,u=[0,0,0,0,0,0,0,0],c=0,l=null,h=0,f=function(){return O(e,h)};if(":"==f()){if(":"!=O(e,1))return;h+=2,l=++c}for(;f();){if(8==c)return;if(":"!=f()){for(t=n=0;n<4&&D(ee,f());)t=16*t+I(f(),16),h++,n++;if("."==f()){if(0==n)return;if(h-=n,c>6)return;for(r=0;f();){if(i=null,r>0){if(!("."==f()&&r<4))return;h++}if(!D(X,f()))return;for(;D(X,f());){if(a=I(f(),10),null===i)i=a;else{if(0==i)return;i=10*i+a}if(i>255)return;h++}u[c]=256*u[c]+i,2!=++r&&4!=r||c++}if(4!=r)return;break}if(":"==f()){if(h++,!f())return}else if(f())return;u[c++]=t}else{if(null!==l)return;h++,l=++c}}if(null!==l)for(o=c-l,c=7;0!=c&&o>0;)s=u[c],u[c--]=u[l+o-1],u[l+--o]=s;else if(8!=c)return;return u}(U(e,1,-1)),!t)return q;this.host=t}else if(this.isSpecial()){if(e=g(e),D(te,e))return q;if(t=function(e){var t,n,r,i,a,o,s,u=z(e,".");if(u.length&&""==u[u.length-1]&&u.length--,(t=u.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=u[r]))return e;if(a=10,i.length>1&&"0"==O(i,0)&&(a=D($,i)?16:8,i=U(i,8==a?1:2)),""===i)o=0;else{if(!D(10==a?J:8==a?Q:ee,i))return e;o=I(i,a)}L(n,o)}for(r=0;r<t;r++)if(o=n[r],r==t-1){if(o>=A(256,5-t))return null}else if(o>255)return null;for(s=F(n),r=0;r<n.length;r++)s+=n[r]*A(256,3-r);return s}(e),null===t)return q;this.host=t}else{if(D(ne,e))return q;for(t="",n=d(e),r=0;r<n.length;r++)t+=he(n[r],se);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return p(fe,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&pe(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,a=e.port,o=e.path,s=e.query,u=e.fragment,c=t+":";return null!==i?(c+="//",e.includesCredentials()&&(c+=n+(r?":"+r:"")+"@"),c+=oe(i),null!==a&&(c+=":"+a)):"file"==t&&(c+="//"),c+=e.cannotBeABaseURL?o[0]:o.length?"/"+P(o,"/"):"",null!==s&&(c+="?"+s),null!==u&&(c+="#"+u),c},setHref:function(e){var t=this.parse(e);if(t)throw C(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new Le(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+oe(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(b(e)+":",ve)},getUsername:function(){return this.username},setUsername:function(e){var t=d(b(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=he(t[n],le)}},getPassword:function(){return this.password},setPassword:function(e){var t=d(b(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=he(t[n],le)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?oe(e):oe(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Re)},getHostname:function(){var e=this.host;return null===e?"":oe(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Ze)},getPort:function(){var e=this.port;return null===e?"":b(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=b(e))?this.port=null:this.parse(e,Se))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+P(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Ae))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=b(e))?this.query=null:("?"==O(e,0)&&(e=U(e,1)),this.query="",this.parse(e,Pe)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=b(e))?("#"==O(e,0)&&(e=U(e,1)),this.fragment="",this.parse(e,Be)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Le=function(e){var t=f(this,Ne),n=k(arguments.length,1)>1?arguments[1]:void 0,r=T(t,new Fe(e,!1,n));a||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},Ne=Le.prototype,je=function(e,t){return{get:function(){return w(this)[e]()},set:t&&function(e){return w(this)[t](e)},configurable:!0,enumerable:!0}};if(a&&(h(Ne,"href",je("serialize","setHref")),h(Ne,"origin",je("getOrigin")),h(Ne,"protocol",je("getProtocol","setProtocol")),h(Ne,"username",je("getUsername","setUsername")),h(Ne,"password",je("getPassword","setPassword")),h(Ne,"host",je("getHost","setHost")),h(Ne,"hostname",je("getHostname","setHostname")),h(Ne,"port",je("getPort","setPort")),h(Ne,"pathname",je("getPathname","setPathname")),h(Ne,"search",je("getSearch","setSearch")),h(Ne,"searchParams",je("getSearchParams")),h(Ne,"hash",je("getHash","setHash"))),l(Ne,"toJSON",(function(){return w(this).serialize()}),{enumerable:!0}),l(Ne,"toString",(function(){return w(this).serialize()}),{enumerable:!0}),S){var ze=S.createObjectURL,Ue=S.revokeObjectURL;ze&&l(Le,"createObjectURL",u(ze,S)),Ue&&l(Le,"revokeObjectURL",u(Ue,S))}M(Le,"URL"),i({global:!0,constructor:!0,forced:!o,sham:!a},{URL:Le})},285:function(e,t,n){n(8789)},2515:function(e,t,n){e.exports=n(9382)},9382:function(e){function t(e){var t=this;if(this._HSLtoRGB=function(e,t,n){var r,i,a,o,s,u;if((e<=0||isNaN(e))&&(e=0),(t<=0||isNaN(t))&&(t=0),(n<=0||isNaN(n))&&(n=0),e>360&&(e=360),t>100&&(t=100),n>100&&(n=100),n/=100,0==(t/=100))o=s=u=255*n;else{function c(e,t,n){return n<0?n+=1:n>1&&(n-=1),255*(6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e)}o=c(r=2*n-(i=n<=.5?n*(t+1):n+t-n*t),i,(a=e/360)+1/3),s=c(r,i,a),u=c(r,i,a-1/3)}return o=Math.round(o),s=Math.round(s),u=Math.round(u),{r:parseInt(o),g:parseInt(s),b:parseInt(u)}},this._RGBtoHSL=function(e,t,n){(e<=0||isNaN(e))&&(e=0),(t<=0||isNaN(t))&&(t=0),(n<=0||isNaN(n))&&(n=0),e>255&&(e=255),t>255&&(t=255),n>255&&(n=255),e/=255,t/=255,n/=255;var r,i,a=Math.max(e,t,n),o=Math.min(e,t,n),s=(a+o)/2;if(a==o)r=i=0;else{var u=a-o;switch(i=s>.5?u/(2-a-o):u/(a+o),a){case e:r=(t-n)/u+(t<n?6:0);break;case t:r=(n-e)/u+2;break;case n:r=(e-t)/u+4}r/=6}return r*=360,i*=100,s*=100,r=Math.round(r),i=Math.round(i),s=Math.round(s),r=isNaN(r)?0:r,i=isNaN(i)?0:i,s=isNaN(s)?0:s,{h:parseFloat(r),s:parseFloat(i),l:parseFloat(s)}},this._CMYKtoRGB=function(e,t,n,r){(e<=0||isNaN(e))&&(e=0),(t<=0||isNaN(t))&&(t=0),(n<=0||isNaN(n))&&(n=0),(r<=0||isNaN(r))&&(r=0),e>100&&(e=100),t>100&&(t=100),n>100&&(n=100),r>100&&(r=100),e/=100,t/=100,n/=100,r/=100;var i=1-Math.min(1,e*(1-r)+r),a=1-Math.min(1,t*(1-r)+r),o=1-Math.min(1,n*(1-r)+r);return i=Math.round(255*i),a=Math.round(255*a),o=Math.round(255*o),{r:parseInt(i),g:parseInt(a),b:parseInt(o)}},this._RGBtoCMYK=function(e,t,n){(e<=0||isNaN(e))&&(e=0),(t<=0||isNaN(t))&&(t=0),(n<=0||isNaN(n))&&(n=0),e>255&&(e=255),t>255&&(t=255),n>255&&(n=255),e/=255,t/=255,n/=255;var r=Math.min(1-e,1-t,1-n),i=(1-e-r)/(1-r),a=(1-t-r)/(1-r),o=(1-n-r)/(1-r);return i=Math.round(100*i),a=Math.round(100*a),o=Math.round(100*o),r=Math.round(100*r),i=isNaN(i)?0:i,a=isNaN(a)?0:a,o=isNaN(o)?0:o,r=isNaN(r)?0:r,{c:parseInt(i),m:parseInt(a),y:parseInt(o),k:parseInt(r)}},this.success=!1,this.rgb={r:0,g:0,b:0},this.hsl={h:0,s:0,l:0},this.cmyk={c:0,m:0,y:0,k:0},this.alpha=1,null!=e){e=(e=(e=e.replace("#","")).replace(/ /g,"")).toLowerCase(),this.CSSColorTable={transparent:"rgba(0,0,0,0)",aliceblue:"rgba(240,248,255,1)",antiquewhite:"rgba(250,235,215,1)",aqua:"rgba(0,255,255,1)",aquamarine:"rgba(127,255,212,1)",azure:"rgba(240,255,255,1)",beige:"rgba(245,245,220,1)",bisque:"rgba(255,228,196,1)",black:"rgba(0,0,0,1)",blanchedalmond:"rgba(255,235,205,1)",blue:"rgba(0,0,255,1)",blueviolet:"rgba(138,43,226,1)",brown:"rgba(165,42,42,1)",burlywood:"rgba(222,184,135,1)",cadetblue:"rgba(95,158,160,1)",chartreuse:"rgba(127,255,0,1)",chocolate:"rgba(210,105,30,1)",coral:"rgba(255,127,80,1)",cornflowerblue:"rgba(100,149,237,1)",cornsilk:"rgba(255,248,220,1)",crimson:"rgba(220,20,60,1)",cyan:"rgba(0,255,255,1)",darkblue:"rgba(0,0,139,1)",darkcyan:"rgba(0,139,139,1)",darkgoldenrod:"rgba(184,134,11,1)",darkgray:"rgba(169,169,169,1)",darkgrey:"rgba(169,169,169,1)",darkgreen:"rgba(0,100,0,1)",darkkhaki:"rgba(189,183,107,1)",darkmagenta:"rgba(139,0,139,1)",darkolivegreen:"rgba(85,107,47,1)",darkorange:"rgba(255,140,0,1)",darkorchid:"rgba(153,50,204,1)",darkred:"rgba(139,0,0,1)",darksalmon:"rgba(233,150,122,1)",darkseagreen:"rgba(143,188,143,1)",darkslateblue:"rgba(72,61,139,1)",darkslategray:"rgba(47,79,79,1)",darkslategrey:"rgba(47,79,79,1)",darkturquoise:"rgba(0,206,209,1)",darkviolet:"rgba(148,0,211,1)",deeppink:"rgba(255,20,147,1)",deepskyblue:"rgba(0,191,255,1)",dimgray:"rgba(105,105,105,1)",dimgrey:"rgba(105,105,105,1)",dodgerblue:"rgba(30,144,255,1)",firebrick:"rgba(178,34,34,1)",floralwhite:"rgba(255,250,240,1)",forestgreen:"rgba(34,139,34,1)",fuchsia:"rgba(255,0,255,1)",gainsboro:"rgba(220,220,220,1)",ghostwhite:"rgba(248,248,255,1)",gold:"rgba(255,215,0,1)",goldenrod:"rgba(218,165,32,1)",gray:"rgba(128,128,128,1)",grey:"rgba(128,128,128,1)",green:"rgba(0,128,0,1)",greenyellow:"rgba(173,255,47,1)",honeydew:"rgba(240,255,240,1)",hotpink:"rgba(255,105,180,1)",indianred:"rgba(205,92,92,1)",indigo:"rgba(75,0,130,1)",ivory:"rgba(255,255,240,1)",khaki:"rgba(240,230,140,1)",lavender:"rgba(230,230,250,1)",lavenderblush:"rgba(255,240,245,1)",lawngreen:"rgba(124,252,0,1)",lemonchiffon:"rgba(255,250,205,1)",lightblue:"rgba(173,216,230,1)",lightcoral:"rgba(240,128,128,1)",lightcyan:"rgba(224,255,255,1)",lightgoldenrodyellow:"rgba(250,250,210,1)",lightgray:"rgba(211,211,211,1)",lightgrey:"rgba(211,211,211,1)",lightgreen:"rgba(144,238,144,1)",lightpink:"rgba(255,182,193,1)",lightsalmon:"rgba(255,160,122,1)",lightseagreen:"rgba(32,178,170,1)",lightskyblue:"rgba(135,206,250,1)",lightslategray:"rgba(119,136,153,1)",lightslategrey:"rgba(119,136,153,1)",lightsteelblue:"rgba(176,196,222,1)",lightyellow:"rgba(255,255,224,1)",lime:"rgba(0,255,0,1)",limegreen:"rgba(50,205,50,1)",linen:"rgba(250,240,230,1)",magenta:"rgba(255,0,255,1)",maroon:"rgba(128,0,0,1)",mediumaquamarine:"rgba(102,205,170,1)",mediumblue:"rgba(0,0,205,1)",mediumorchid:"rgba(186,85,211,1)",mediumpurple:"rgba(147,112,219,1)",mediumseagreen:"rgba(60,179,113,1)",mediumslateblue:"rgba(123,104,238,1)",mediumspringgreen:"rgba(0,250,154,1)",mediumturquoise:"rgba(72,209,204,1)",mediumvioletred:"rgba(199,21,133,1)",midnightblue:"rgba(25,25,112,1)",mintcream:"rgba(245,255,250,1)",mistyrose:"rgba(255,228,225,1)",moccasin:"rgba(255,228,181,1)",navajowhite:"rgba(255,222,173,1)",navy:"rgba(0,0,128,1)",oldlace:"rgba(253,245,230,1)",olive:"rgba(128,128,0,1)",olivedrab:"rgba(107,142,35,1)",orange:"rgba(255,165,0,1)",orangered:"rgba(255,69,0,1)",orchid:"rgba(218,112,214,1)",palegoldenrod:"rgba(238,232,170,1)",palegreen:"rgba(152,251,152,1)",paleturquoise:"rgba(175,238,238,1)",palevioletred:"rgba(219,112,147,1)",papayawhip:"rgba(255,239,213,1)",peachpuff:"rgba(255,218,185,1)",peru:"rgba(205,133,63,1)",pink:"rgba(255,192,203,1)",plum:"rgba(221,160,221,1)",powderblue:"rgba(176,224,230,1)",purple:"rgba(128,0,128,1)",rebeccapurple:"rgba(102,51,153,1)",red:"rgba(255,0,0,1)",rosybrown:"rgba(188,143,143,1)",royalblue:"rgba(65,105,225,1)",saddlebrown:"rgba(139,69,19,1)",salmon:"rgba(250,128,114,1)",sandybrown:"rgba(244,164,96,1)",seagreen:"rgba(46,139,87,1)",seashell:"rgba(255,245,238,1)",sienna:"rgba(160,82,45,1)",silver:"rgba(192,192,192,1)",skyblue:"rgba(135,206,235,1)",slateblue:"rgba(106,90,205,1)",slategray:"rgba(112,128,144,1)",slategrey:"rgba(112,128,144,1)",snow:"rgba(255,250,250,1)",springgreen:"rgba(0,255,127,1)",steelblue:"rgba(70,130,180,1)",tan:"rgba(210,180,140,1)",teal:"rgba(0,128,128,1)",thistle:"rgba(216,191,216,1)",tomato:"rgba(255,99,71,1)",turquoise:"rgba(64,224,208,1)",violet:"rgba(238,130,238,1)",wheat:"rgba(245,222,179,1)",white:"rgba(255,255,255,1)",whitesmoke:"rgba(245,245,245,1)",yellow:"rgba(255,255,0,1)",yellowgreen:"rgba(154,205,50,1)"},e in this.CSSColorTable&&(e=this.CSSColorTable[e]);for(var n=[{name:"RGB",regex:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(0, 170, 222)","rgb(76, 175, 80)"],process:function(e){var n={r:parseInt(e[1]),g:parseInt(e[2]),b:parseInt(e[3])};return[n,t._RGBtoHSL(n.r,n.g,n.b),t._RGBtoCMYK(n.r,n.g,n.b),parseFloat(1)]}},{name:"RGBA",regex:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((\d)?(\.\d+)?)\)$/,example:["rgba(0, 170, 222, 1)","rgba(76, 175, 80, .75)"],process:function(e){var n={r:parseInt(e[1]),g:parseInt(e[2]),b:parseInt(e[3])};return[n,t._RGBtoHSL(n.r,n.g,n.b),t._RGBtoCMYK(n.r,n.g,n.b),parseFloat(e[4])]}},{name:"HSL",regex:/^(?:hsl)?\(?(\d{1,3}),\s*(\d{1,3}%),\s*(\d{1,3}%)\)?$/,example:["hsl(58, 100%, 50%)","195, 100%, 45%"],process:function(e){var n={h:parseFloat(e[1]),s:parseFloat(e[2]),l:parseFloat(e[3])},r=t._HSLtoRGB(n.h,n.s,n.l);return[r,n,t._RGBtoCMYK(r.r,r.g,r.b),parseFloat(1)]}},{name:"HSLA",regex:/^(?:hsla)?\(?(\d{1,3}),\s*(\d{1,3}%),\s*(\d{1,3}%),\s*((\d)?(\.\d+)?)\)?$/,example:["hsla(58, 100%, 50%, 1)","195, 100%, 45%, .5"],process:function(e){var n={h:parseFloat(e[1]),s:parseFloat(e[2]),l:parseFloat(e[3])},r=t._HSLtoRGB(n.h,n.s,n.l);return[r,n,t._RGBtoCMYK(r.r,r.g,r.b),parseFloat(e[4])]}},{name:"CMYK",regex:/^(?:cmyk)?\(?(\d{1,3})%,\s*(\d{1,3})%,\s*(\d{1,3})%,\s*(\d{1,3})%\)?$/,example:["cmyk(100%, 0%, 0%, 0%)","0%, 100%, 100%, 0%"],process:function(e){var n={c:parseInt(e[1]),m:parseInt(e[2]),y:parseInt(e[3]),k:parseInt(e[4])},r=t._CMYKtoRGB(n.c,n.m,n.y,n.k);return[r,t._RGBtoHSL(r.r,r.g,r.b),n,parseFloat(1)]}},{name:"HEX",regex:/^(\w{2})(\w{2})(\w{2})$/,example:["#FFEB3B","FF9800"],process:function(e){var n={r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)};return[n,t._RGBtoHSL(n.r,n.g,n.b),t._RGBtoCMYK(n.r,n.g,n.b),parseFloat(1)]}},{name:"HEX",regex:/^(\w)(\w)(\w)$/,example:["#92B","098"],process:function(e){var n={r:parseInt(e[1]+e[1],16),g:parseInt(e[2]+e[2],16),b:parseInt(e[3]+e[3],16)};return[n,t._RGBtoHSL(n.r,n.g,n.b),t._RGBtoCMYK(n.r,n.g,n.b),parseFloat(1)]}}],r=0;r<n.length;r++){var i=n[r].regex,a=n[r].process,o=i.exec(e);if(o){var s=a(o),u=s[1],c=s[2],l=s[3];this.rgb=s[0],this.hsl=u,this.cmyk=c,this.alpha=l,this.success=!0}}this.rgb.r=this.rgb.r<0||isNaN(this.rgb.r)?0:this.rgb.r>255?255:this.rgb.r,this.rgb.g=this.rgb.g<0||isNaN(this.rgb.g)?0:this.rgb.g>255?255:this.rgb.g,this.rgb.b=this.rgb.b<0||isNaN(this.rgb.b)?0:this.rgb.b>255?255:this.rgb.b,this.alpha=this.alpha>1||isNaN(this.alpha)?1:this.alpha<0?0:this.alpha,this.to=function(e){switch(e.toLowerCase()){case"hex":return this.toHex();case"rgb":return this.toRGB();case"rgba":default:return this.toRGBA();case"hsl":return this.toHSL();case"hsla":return this.toHSLA();case"cmyk":return this.toCMYK()}},this.toRGB=function(){return"rgb("+this.rgb.r+", "+this.rgb.g+", "+this.rgb.b+")"},this.toRGBA=function(){return"rgba("+this.rgb.r+", "+this.rgb.g+", "+this.rgb.b+", "+this.alpha+")"},this.toHex=function(){var e=this.rgb.r.toString(16),t=this.rgb.g.toString(16),n=this.rgb.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),"#"+e+t+n},this.toHSL=function(){return"hsl("+this.hsl.h+", "+this.hsl.s+"%, "+this.hsl.l+"%)"},this.toHSLA=function(){return"hsla("+this.hsl.h+", "+this.hsl.s+"%, "+this.hsl.l+"%, "+this.alpha+")"},this.toCMYK=function(){return"cmyk("+this.cmyk.c+"%, "+this.cmyk.m+"%, "+this.cmyk.y+"%, "+this.cmyk.k+"%)"},this.toArray=function(){return[this.rgb,this.hsl,this.cmyk,this.alpha]},this.colorType=function(){for(var t,r=0;r<n.length;r++){var i=n[r].name;n[r].regex.exec(e)&&(t=i)}return t}}}t.fromRGB=function(e,n,r){var i={r:0,g:0,b:0};if(e&&e.constructor===Object)for(var a in i)e.hasOwnProperty(a)&&(i[a]=e[a]);else if(Array.isArray(e))for(var o=0;o<e.length;o++)i[Object.keys(i)[o]]=e[o];else i.r=e||0,i.g=n||0,i.b=r||0;var s=new t("rgb("+i.r+", "+i.g+", "+i.b+")");return this.success=s.success,s},t.fromRGBA=function(e,n,r,i){var a={r:0,g:0,b:0,a:1};if(e&&e.constructor===Object)for(var o in a)e.hasOwnProperty(o)&&(a[o]=e[o]);else if(Array.isArray(e))for(var s=0;s<e.length;s++)a[Object.keys(a)[s]]=e[s];else a.r=e||0,a.g=n||0,a.b=r||0,a.a=i||1;var u=new t("rgba("+a.r+", "+a.g+", "+a.b+", "+a.a+")");return this.success=u.success,u},t.fromHSL=function(e,n,r){var i={h:0,s:0,l:0};if(e&&e.constructor===Object)for(var a in i)e.hasOwnProperty(a)&&(i[a]=e[a]);else if(Array.isArray(e))for(var o=0;o<e.length;o++)i[Object.keys(i)[o]]=e[o];else i.h=e||0,i.s=n||0,i.l=r||0;var s=new t("hsl("+i.h+", "+i.s+"%, "+i.l+"%)");return this.success=s.success,s},t.fromHSLA=function(e,n,r,i){var a={h:0,s:0,l:0,a:0};if(e&&e.constructor===Object)for(var o in a)e.hasOwnProperty(o)&&(a[o]=e[o]);else if(Array.isArray(e))for(var s=0;s<e.length;s++)a[Object.keys(a)[s]]=e[s];else a.h=e||0,a.s=n||0,a.l=r||0,a.a=i||1;var u=new t("hsla("+a.h+", "+a.s+"%, "+a.l+"%, "+a.a+")");return this.success=u.success,u},t.fromCMYK=function(e,n,r,i){var a={c:0,m:0,y:0,k:0};if(e&&e.constructor===Object)for(var o in a)e.hasOwnProperty(o)&&(a[o]=e[o]);else if(Array.isArray(e))for(var s=0;s<e.length;s++)a[Object.keys(a)[s]]=e[s];else a.c=e||0,a.m=n||0,a.y=r||0,a.k=i||0;var u=new t("cmyk("+a.c+"%, "+a.m+"%, "+a.y+"%, "+a.k+"%)");return this.success=u.success,u},e.exports=t},4029:function(e,t,n){"use strict";var r=n(5320),i=Object.prototype.toString,a=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){if(!r(t))throw new TypeError("iterator must be a function");var o;arguments.length>=3&&(o=n),"[object Array]"===i.call(e)?function(e,t,n){for(var r=0,i=e.length;r<i;r++)a.call(e,r)&&(null==n?t(e[r],r,e):t.call(n,e[r],r,e))}(e,t,o):"string"==typeof e?function(e,t,n){for(var r=0,i=e.length;r<i;r++)null==n?t(e.charAt(r),r,e):t.call(n,e.charAt(r),r,e)}(e,t,o):function(e,t,n){for(var r in e)a.call(e,r)&&(null==n?t(e[r],r,e):t.call(n,e[r],r,e))}(e,t,o)}},7648:function(e){"use strict";var t=Array.prototype.slice,n=Object.prototype.toString;e.exports=function(e){var r=this;if("function"!=typeof r||"[object Function]"!==n.call(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var i,a=t.call(arguments,1),o=Math.max(0,r.length-a.length),s=[],u=0;u<o;u++)s.push("$"+u);if(i=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof i){var n=r.apply(this,a.concat(t.call(arguments)));return Object(n)===n?n:this}return r.apply(e,a.concat(t.call(arguments)))})),r.prototype){var c=function(){};c.prototype=r.prototype,i.prototype=new c,c.prototype=null}return i}},8612:function(e,t,n){"use strict";var r=n(7648);e.exports=Function.prototype.bind||r},210:function(e,t,n){"use strict";var r,i=SyntaxError,a=Function,o=TypeError,s=function(e){try{return a('"use strict"; return ('+e+").constructor;")()}catch(e){}},u=Object.getOwnPropertyDescriptor;if(u)try{u({},"")}catch(e){u=null}var c=function(){throw new o},l=u?function(){try{return c}catch(e){try{return u(arguments,"callee").get}catch(e){return c}}}():c,h=n(1405)(),f=Object.getPrototypeOf||function(e){return e.__proto__},p={},m="undefined"==typeof Uint8Array?r:f(Uint8Array),d={"%AggregateError%":"undefined"==typeof AggregateError?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?r:ArrayBuffer,"%ArrayIteratorPrototype%":h?f([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?r:Atomics,"%BigInt%":"undefined"==typeof BigInt?r:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?r:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?r:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?r:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?r:FinalizationRegistry,"%Function%":a,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?r:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?r:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":h?f(f([][Symbol.iterator]())):r,"%JSON%":"object"==typeof JSON?JSON:r,"%Map%":"undefined"==typeof Map?r:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&h?f((new Map)[Symbol.iterator]()):r,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?r:Promise,"%Proxy%":"undefined"==typeof Proxy?r:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?r:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?r:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&h?f((new Set)[Symbol.iterator]()):r,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":h?f(""[Symbol.iterator]()):r,"%Symbol%":h?Symbol:r,"%SyntaxError%":i,"%ThrowTypeError%":l,"%TypedArray%":m,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?r:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?r:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?r:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?r:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?r:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?r:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?r:WeakSet};try{null.error}catch(e){var v=f(f(e));d["%Error.prototype%"]=v}var y=function e(t){var n;if("%AsyncFunction%"===t)n=s("async function () {}");else if("%GeneratorFunction%"===t)n=s("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=s("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&(n=f(i.prototype))}return d[t]=n,n},g={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=n(8612),M=n(7642),k=b.call(Function.call,Array.prototype.concat),_=b.call(Function.apply,Array.prototype.splice),x=b.call(Function.call,String.prototype.replace),T=b.call(Function.call,String.prototype.slice),w=b.call(Function.call,RegExp.prototype.exec),R=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Z=/\\(\\)?/g,S=function(e,t){var n,r=e;if(M(g,r)&&(r="%"+(n=g[r])[0]+"%"),M(d,r)){var a=d[r];if(a===p&&(a=y(r)),void 0===a&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:a}}throw new i("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');if(null===w(/^%?[^%]*%?$/,e))throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=T(e,0,1),n=T(e,-1);if("%"===t&&"%"!==n)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new i("invalid intrinsic syntax, expected opening `%`");var r=[];return x(e,R,(function(e,t,n,i){r[r.length]=n?x(i,Z,"$1"):t||e})),r}(e),r=n.length>0?n[0]:"",a=S("%"+r+"%",t),s=a.name,c=a.value,l=!1,h=a.alias;h&&(r=h[0],_(n,k([0,1],h)));for(var f=1,p=!0;f<n.length;f+=1){var m=n[f],v=T(m,0,1),y=T(m,-1);if(('"'===v||"'"===v||"`"===v||'"'===y||"'"===y||"`"===y)&&v!==y)throw new i("property names with quotes must have matching quotes");if("constructor"!==m&&p||(l=!0),M(d,s="%"+(r+="."+m)+"%"))c=d[s];else if(null!=c){if(!(m in c)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(u&&f+1>=n.length){var g=u(c,m);c=(p=!!g)&&"get"in g&&!("originalValue"in g.get)?g.get:c[m]}else p=M(c,m),c=c[m];p&&!l&&(d[s]=c)}}return c}},7296:function(e,t,n){"use strict";var r=n(210)("%Object.getOwnPropertyDescriptor%",!0);if(r)try{r([],"length")}catch(e){r=null}e.exports=r},1405:function(e,t,n){"use strict";var r="undefined"!=typeof Symbol&&Symbol,i=n(5419);e.exports=function(){return"function"==typeof r&&("function"==typeof Symbol&&("symbol"==typeof r("foo")&&("symbol"==typeof Symbol("bar")&&i())))}},5419:function(e){"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},6410:function(e,t,n){"use strict";var r=n(5419);e.exports=function(){return r()&&!!Symbol.toStringTag}},7642:function(e,t,n){"use strict";var r=n(8612);e.exports=r.call(Function.call,Object.prototype.hasOwnProperty)},1766:function(e,t,n){var r;!function(){"use strict";var i=function(){this.init()};i.prototype={init:function(){var e=this||a;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var t=this||a;if(e=parseFloat(e),t.ctx||p(),void 0!==e&&e>=0&&e<=1){if(t._volume=e,t._muted)return t;t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e,a.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var r=t._howls[n]._getSoundIds(),i=0;i<r.length;i++){var o=t._howls[n]._soundById(r[i]);o&&o._node&&(o._node.volume=o._volume*e)}return t}return t._volume},mute:function(e){var t=this||a;t.ctx||p(),t._muted=e,t.usingWebAudio&&t.masterGain.gain.setValueAtTime(e?0:t._volume,a.ctx.currentTime);for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var r=t._howls[n]._getSoundIds(),i=0;i<r.length;i++){var o=t._howls[n]._soundById(r[i]);o&&o._node&&(o._node.muted=!!e||o._muted)}return t},stop:function(){for(var e=this||a,t=0;t<e._howls.length;t++)e._howls[t].stop();return e},unload:function(){for(var e=this||a,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,p()),e},codecs:function(e){return(this||a)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||a;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(t){e.noAudio=!0}else e.noAudio=!0;try{(new Audio).muted&&(e.noAudio=!0)}catch(e){}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||a,t=null;try{t="undefined"!=typeof Audio?new Audio:null}catch(t){return e}if(!t||"function"!=typeof t.canPlayType)return e;var n=t.canPlayType("audio/mpeg;").replace(/^no$/,""),r=e._navigator?e._navigator.userAgent:"",i=r.match(/OPR\/([0-6].)/g),o=i&&parseInt(i[0].split("/")[1],10)<33,s=-1!==r.indexOf("Safari")&&-1===r.indexOf("Chrome"),u=r.match(/Version\/(.*?) /),c=s&&u&&parseInt(u[1],10)<15;return e._codecs={mp3:!(o||!n&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(t.canPlayType('audio/wav; codecs="1"')||t.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!t.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!t.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(t.canPlayType("audio/x-m4b;")||t.canPlayType("audio/m4b;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(t.canPlayType("audio/x-mp4;")||t.canPlayType("audio/mp4;")||t.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(c||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(c||!t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!t.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(t.canPlayType("audio/x-flac;")||t.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||a;if(!e._audioUnlocked&&e.ctx){e._audioUnlocked=!1,e.autoUnlock=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var t=function(n){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var r=new Audio;r._unlocked=!0,e._releaseHtml5Audio(r)}catch(n){e.noAudio=!0;break}for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var a=e._howls[i]._getSoundIds(),o=0;o<a.length;o++){var s=e._howls[i]._soundById(a[o]);s&&s._node&&!s._node._unlocked&&(s._node._unlocked=!0,s._node.load())}e._autoResume();var u=e.ctx.createBufferSource();u.buffer=e._scratchBuffer,u.connect(e.ctx.destination),void 0===u.start?u.noteOn(0):u.start(0),"function"==typeof e.ctx.resume&&e.ctx.resume(),u.onended=function(){u.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",t,!0),document.removeEventListener("touchend",t,!0),document.removeEventListener("click",t,!0),document.removeEventListener("keydown",t,!0);for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("unlock")}};return document.addEventListener("touchstart",t,!0),document.addEventListener("touchend",t,!0),document.addEventListener("click",t,!0),document.addEventListener("keydown",t,!0),e}},_obtainHtml5Audio:function(){var e=this||a;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var t=(new Audio).play();return t&&"undefined"!=typeof Promise&&(t instanceof Promise||"function"==typeof t.then)&&t.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(e){var t=this||a;return e._unlocked&&t._html5AudioPool.push(e),t},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&a.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)for(var n=0;n<e._howls[t]._sounds.length;n++)if(!e._howls[t]._sounds[n]._paused)return e;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var t=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(t,t)}}),3e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&a.usingWebAudio)return"running"===e.state&&"interrupted"!==e.ctx.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state||"running"===e.state&&"interrupted"===e.ctx.state?(e.ctx.resume().then((function(){e.state="running";for(var t=0;t<e._howls.length;t++)e._howls[t]._emit("resume")})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var a=new i,o=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};o.prototype={init:function(e){var t=this;return a.ctx||p(),t._autoplay=e.autoplay||!1,t._format="string"!=typeof e.format?e.format:[e.format],t._html5=e.html5||!1,t._muted=e.mute||!1,t._loop=e.loop||!1,t._pool=e.pool||5,t._preload="boolean"!=typeof e.preload&&"metadata"!==e.preload||e.preload,t._rate=e.rate||1,t._sprite=e.sprite||{},t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:!(!e.xhr||!e.xhr.withCredentials)&&e.xhr.withCredentials},t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._playLock=!1,t._onend=e.onend?[{fn:e.onend}]:[],t._onfade=e.onfade?[{fn:e.onfade}]:[],t._onload=e.onload?[{fn:e.onload}]:[],t._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],t._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],t._onpause=e.onpause?[{fn:e.onpause}]:[],t._onplay=e.onplay?[{fn:e.onplay}]:[],t._onstop=e.onstop?[{fn:e.onstop}]:[],t._onmute=e.onmute?[{fn:e.onmute}]:[],t._onvolume=e.onvolume?[{fn:e.onvolume}]:[],t._onrate=e.onrate?[{fn:e.onrate}]:[],t._onseek=e.onseek?[{fn:e.onseek}]:[],t._onunlock=e.onunlock?[{fn:e.onunlock}]:[],t._onresume=[],t._webAudio=a.usingWebAudio&&!t._html5,void 0!==a.ctx&&a.ctx&&a.autoUnlock&&a._unlockAudio(),a._howls.push(t),t._autoplay&&t._queue.push({event:"play",action:function(){t.play()}}),t._preload&&"none"!==t._preload&&t.load(),t},load:function(){var e=this,t=null;if(a.noAudio)e._emit("loaderror",null,"No audio support.");else{"string"==typeof e._src&&(e._src=[e._src]);for(var n=0;n<e._src.length;n++){var r,i;if(e._format&&e._format[n])r=e._format[n];else{if("string"!=typeof(i=e._src[n])){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(r=/^data:audio\/([^;,]+);/i.exec(i))||(r=/\.([^.]+)$/.exec(i.split("?",1)[0])),r&&(r=r[1].toLowerCase())}if(r||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),r&&a.codecs(r)){t=e._src[n];break}}if(t)return e._src=t,e._state="loading","https:"===window.location.protocol&&"http:"===t.slice(0,5)&&(e._html5=!0,e._webAudio=!1),new s(e),e._webAudio&&c(e),e;e._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(e,t){var n=this,r=null;if("number"==typeof e)r=e,e=null;else{if("string"==typeof e&&"loaded"===n._state&&!n._sprite[e])return null;if(void 0===e&&(e="__default",!n._playLock)){for(var i=0,o=0;o<n._sounds.length;o++)n._sounds[o]._paused&&!n._sounds[o]._ended&&(i++,r=n._sounds[o]._id);1===i?e=null:r=null}}var s=r?n._soundById(r):n._inactiveSound();if(!s)return null;if(r&&!e&&(e=s._sprite||"__default"),"loaded"!==n._state){s._sprite=e,s._ended=!1;var u=s._id;return n._queue.push({event:"play",action:function(){n.play(u)}}),u}if(r&&!s._paused)return t||n._loadQueue("play"),s._id;n._webAudio&&a._autoResume();var c=Math.max(0,s._seek>0?s._seek:n._sprite[e][0]/1e3),l=Math.max(0,(n._sprite[e][0]+n._sprite[e][1])/1e3-c),h=1e3*l/Math.abs(s._rate),f=n._sprite[e][0]/1e3,p=(n._sprite[e][0]+n._sprite[e][1])/1e3;s._sprite=e,s._ended=!1;var m=function(){s._paused=!1,s._seek=c,s._start=f,s._stop=p,s._loop=!(!s._loop&&!n._sprite[e][2])};if(!(c>=p)){var d=s._node;if(n._webAudio){var v=function(){n._playLock=!1,m(),n._refreshBuffer(s);var e=s._muted||n._muted?0:s._volume;d.gain.setValueAtTime(e,a.ctx.currentTime),s._playStart=a.ctx.currentTime,void 0===d.bufferSource.start?s._loop?d.bufferSource.noteGrainOn(0,c,86400):d.bufferSource.noteGrainOn(0,c,l):s._loop?d.bufferSource.start(0,c,86400):d.bufferSource.start(0,c,l),h!==1/0&&(n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),h)),t||setTimeout((function(){n._emit("play",s._id),n._loadQueue()}),0)};"running"===a.state&&"interrupted"!==a.ctx.state?v():(n._playLock=!0,n.once("resume",v),n._clearTimer(s._id))}else{var y=function(){d.currentTime=c,d.muted=s._muted||n._muted||a._muted||d.muted,d.volume=s._volume*a.volume(),d.playbackRate=s._rate;try{var r=d.play();if(r&&"undefined"!=typeof Promise&&(r instanceof Promise||"function"==typeof r.then)?(n._playLock=!0,m(),r.then((function(){n._playLock=!1,d._unlocked=!0,t?n._loadQueue():n._emit("play",s._id)})).catch((function(){n._playLock=!1,n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0}))):t||(n._playLock=!1,m(),n._emit("play",s._id)),d.playbackRate=s._rate,d.paused)return void n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==e||s._loop?n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),h):(n._endTimers[s._id]=function(){n._ended(s),d.removeEventListener("ended",n._endTimers[s._id],!1)},d.addEventListener("ended",n._endTimers[s._id],!1))}catch(e){n._emit("playerror",s._id,e)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===d.src&&(d.src=n._src,d.load());var g=window&&window.ejecta||!d.readyState&&a._navigator.isCocoonJS;if(d.readyState>=3||g)y();else{n._playLock=!0,n._state="loading";var b=function(){n._state="loaded",y(),d.removeEventListener(a._canPlayEvent,b,!1)};d.addEventListener(a._canPlayEvent,b,!1),n._clearTimer(s._id)}}return s._id}n._ended(s)},pause:function(e){var t=this;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"pause",action:function(){t.pause(e)}}),t;for(var n=t._getSoundIds(e),r=0;r<n.length;r++){t._clearTimer(n[r]);var i=t._soundById(n[r]);if(i&&!i._paused&&(i._seek=t.seek(n[r]),i._rateSeek=0,i._paused=!0,t._stopFade(n[r]),i._node))if(t._webAudio){if(!i._node.bufferSource)continue;void 0===i._node.bufferSource.stop?i._node.bufferSource.noteOff(0):i._node.bufferSource.stop(0),t._cleanBuffer(i._node)}else isNaN(i._node.duration)&&i._node.duration!==1/0||i._node.pause();arguments[1]||t._emit("pause",i?i._id:null)}return t},stop:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(e)}}),n;for(var r=n._getSoundIds(e),i=0;i<r.length;i++){n._clearTimer(r[i]);var a=n._soundById(r[i]);a&&(a._seek=a._start||0,a._rateSeek=0,a._paused=!0,a._ended=!0,n._stopFade(r[i]),a._node&&(n._webAudio?a._node.bufferSource&&(void 0===a._node.bufferSource.stop?a._node.bufferSource.noteOff(0):a._node.bufferSource.stop(0),n._cleanBuffer(a._node)):isNaN(a._node.duration)&&a._node.duration!==1/0||(a._node.currentTime=a._start||0,a._node.pause(),a._node.duration===1/0&&n._clearSound(a._node))),t||n._emit("stop",a._id))}return n},mute:function(e,t){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(e,t)}}),n;if(void 0===t){if("boolean"!=typeof e)return n._muted;n._muted=e}for(var r=n._getSoundIds(t),i=0;i<r.length;i++){var o=n._soundById(r[i]);o&&(o._muted=e,o._interval&&n._stopFade(o._id),n._webAudio&&o._node?o._node.gain.setValueAtTime(e?0:o._volume,a.ctx.currentTime):o._node&&(o._node.muted=!!a._muted||e),n._emit("mute",o._id))}return n},volume:function(){var e,t,n,r=this,i=arguments;if(0===i.length)return r._volume;if(1===i.length||2===i.length&&void 0===i[1]?r._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):e=parseFloat(i[0]):i.length>=2&&(e=parseFloat(i[0]),t=parseInt(i[1],10)),!(void 0!==e&&e>=0&&e<=1))return(n=t?r._soundById(t):r._sounds[0])?n._volume:0;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,i)}}),r;void 0===t&&(r._volume=e),t=r._getSoundIds(t);for(var o=0;o<t.length;o++)(n=r._soundById(t[o]))&&(n._volume=e,i[2]||r._stopFade(t[o]),r._webAudio&&n._node&&!n._muted?n._node.gain.setValueAtTime(e,a.ctx.currentTime):n._node&&!n._muted&&(n._node.volume=e*a.volume()),r._emit("volume",n._id));return r},fade:function(e,t,n,r){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"fade",action:function(){i.fade(e,t,n,r)}}),i;e=Math.min(Math.max(0,parseFloat(e)),1),t=Math.min(Math.max(0,parseFloat(t)),1),n=parseFloat(n),i.volume(e,r);for(var o=i._getSoundIds(r),s=0;s<o.length;s++){var u=i._soundById(o[s]);if(u){if(r||i._stopFade(o[s]),i._webAudio&&!u._muted){var c=a.ctx.currentTime,l=c+n/1e3;u._volume=e,u._node.gain.setValueAtTime(e,c),u._node.gain.linearRampToValueAtTime(t,l)}i._startFadeInterval(u,e,t,n,o[s],void 0===r)}}return i},_startFadeInterval:function(e,t,n,r,i,a){var o=this,s=t,u=n-t,c=Math.abs(u/.01),l=Math.max(4,c>0?r/c:r),h=Date.now();e._fadeTo=n,e._interval=setInterval((function(){var i=(Date.now()-h)/r;h=Date.now(),s+=u*i,s=Math.round(100*s)/100,s=u<0?Math.max(n,s):Math.min(n,s),o._webAudio?e._volume=s:o.volume(s,e._id,!0),a&&(o._volume=s),(n<t&&s<=n||n>t&&s>=n)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,o.volume(n,e._id),o._emit("fade",e._id))}),l)},_stopFade:function(e){var t=this,n=t._soundById(e);return n&&n._interval&&(t._webAudio&&n._node.gain.cancelScheduledValues(a.ctx.currentTime),clearInterval(n._interval),n._interval=null,t.volume(n._fadeTo,e),n._fadeTo=null,t._emit("fade",e)),t},loop:function(){var e,t,n,r=this,i=arguments;if(0===i.length)return r._loop;if(1===i.length){if("boolean"!=typeof i[0])return!!(n=r._soundById(parseInt(i[0],10)))&&n._loop;e=i[0],r._loop=e}else 2===i.length&&(e=i[0],t=parseInt(i[1],10));for(var a=r._getSoundIds(t),o=0;o<a.length;o++)(n=r._soundById(a[o]))&&(n._loop=e,r._webAudio&&n._node&&n._node.bufferSource&&(n._node.bufferSource.loop=e,e&&(n._node.bufferSource.loopStart=n._start||0,n._node.bufferSource.loopEnd=n._stop,r.playing(a[o])&&(r.pause(a[o],!0),r.play(a[o],!0)))));return r},rate:function(){var e,t,n,r=this,i=arguments;if(0===i.length)t=r._sounds[0]._id;else if(1===i.length){r._getSoundIds().indexOf(i[0])>=0?t=parseInt(i[0],10):e=parseFloat(i[0])}else 2===i.length&&(e=parseFloat(i[0]),t=parseInt(i[1],10));if("number"!=typeof e)return(n=r._soundById(t))?n._rate:r._rate;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,i)}}),r;void 0===t&&(r._rate=e),t=r._getSoundIds(t);for(var o=0;o<t.length;o++)if(n=r._soundById(t[o])){r.playing(t[o])&&(n._rateSeek=r.seek(t[o]),n._playStart=r._webAudio?a.ctx.currentTime:n._playStart),n._rate=e,r._webAudio&&n._node&&n._node.bufferSource?n._node.bufferSource.playbackRate.setValueAtTime(e,a.ctx.currentTime):n._node&&(n._node.playbackRate=e);var s=r.seek(t[o]),u=1e3*((r._sprite[n._sprite][0]+r._sprite[n._sprite][1])/1e3-s)/Math.abs(n._rate);!r._endTimers[t[o]]&&n._paused||(r._clearTimer(t[o]),r._endTimers[t[o]]=setTimeout(r._ended.bind(r,n),u)),r._emit("rate",n._id)}return r},seek:function(){var e,t,n=this,r=arguments;if(0===r.length)n._sounds.length&&(t=n._sounds[0]._id);else if(1===r.length){n._getSoundIds().indexOf(r[0])>=0?t=parseInt(r[0],10):n._sounds.length&&(t=n._sounds[0]._id,e=parseFloat(r[0]))}else 2===r.length&&(e=parseFloat(r[0]),t=parseInt(r[1],10));if(void 0===t)return 0;if("number"==typeof e&&("loaded"!==n._state||n._playLock))return n._queue.push({event:"seek",action:function(){n.seek.apply(n,r)}}),n;var i=n._soundById(t);if(i){if(!("number"==typeof e&&e>=0)){if(n._webAudio){var o=n.playing(t)?a.ctx.currentTime-i._playStart:0,s=i._rateSeek?i._rateSeek-i._seek:0;return i._seek+(s+o*Math.abs(i._rate))}return i._node.currentTime}var u=n.playing(t);u&&n.pause(t,!0),i._seek=e,i._ended=!1,n._clearTimer(t),n._webAudio||!i._node||isNaN(i._node.duration)||(i._node.currentTime=e);var c=function(){u&&n.play(t,!0),n._emit("seek",t)};if(u&&!n._webAudio){var l=function(){n._playLock?setTimeout(l,0):c()};setTimeout(l,0)}else c()}return n},playing:function(e){var t=this;if("number"==typeof e){var n=t._soundById(e);return!!n&&!n._paused}for(var r=0;r<t._sounds.length;r++)if(!t._sounds[r]._paused)return!0;return!1},duration:function(e){var t=this,n=t._duration,r=t._soundById(e);return r&&(n=t._sprite[r._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var e=this,t=e._sounds,n=0;n<t.length;n++)t[n]._paused||e.stop(t[n]._id),e._webAudio||(e._clearSound(t[n]._node),t[n]._node.removeEventListener("error",t[n]._errorFn,!1),t[n]._node.removeEventListener(a._canPlayEvent,t[n]._loadFn,!1),t[n]._node.removeEventListener("ended",t[n]._endFn,!1),a._releaseHtml5Audio(t[n]._node)),delete t[n]._node,e._clearTimer(t[n]._id);var r=a._howls.indexOf(e);r>=0&&a._howls.splice(r,1);var i=!0;for(n=0;n<a._howls.length;n++)if(a._howls[n]._src===e._src||e._src.indexOf(a._howls[n]._src)>=0){i=!1;break}return u&&i&&delete u[e._src],a.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,t,n,r){var i=this["_on"+e];return"function"==typeof t&&i.push(r?{id:n,fn:t,once:r}:{id:n,fn:t}),this},off:function(e,t,n){var r=this,i=r["_on"+e],a=0;if("number"==typeof t&&(n=t,t=null),t||n)for(a=0;a<i.length;a++){var o=n===i[a].id;if(t===i[a].fn&&o||!t&&o){i.splice(a,1);break}}else if(e)r["_on"+e]=[];else{var s=Object.keys(r);for(a=0;a<s.length;a++)0===s[a].indexOf("_on")&&Array.isArray(r[s[a]])&&(r[s[a]]=[])}return r},once:function(e,t,n){return this.on(e,t,n,1),this},_emit:function(e,t,n){for(var r=this,i=r["_on"+e],a=i.length-1;a>=0;a--)i[a].id&&i[a].id!==t&&"load"!==e||(setTimeout(function(e){e.call(this,t,n)}.bind(r,i[a].fn),0),i[a].once&&r.off(e,i[a].fn,i[a].id));return r._loadQueue(e),r},_loadQueue:function(e){var t=this;if(t._queue.length>0){var n=t._queue[0];n.event===e&&(t._queue.shift(),t._loadQueue()),e||n.action()}return t},_ended:function(e){var t=this,n=e._sprite;if(!t._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(t._ended.bind(t,e),100),t;var r=!(!e._loop&&!t._sprite[n][2]);if(t._emit("end",e._id),!t._webAudio&&r&&t.stop(e._id,!0).play(e._id),t._webAudio&&r){t._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=a.ctx.currentTime;var i=1e3*(e._stop-e._start)/Math.abs(e._rate);t._endTimers[e._id]=setTimeout(t._ended.bind(t,e),i)}return t._webAudio&&!r&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,t._clearTimer(e._id),t._cleanBuffer(e._node),a._autoSuspend()),t._webAudio||r||t.stop(e._id,!0),t},_clearTimer:function(e){var t=this;if(t._endTimers[e]){if("function"!=typeof t._endTimers[e])clearTimeout(t._endTimers[e]);else{var n=t._soundById(e);n&&n._node&&n._node.removeEventListener("ended",t._endTimers[e],!1)}delete t._endTimers[e]}return t},_soundById:function(e){for(var t=this,n=0;n<t._sounds.length;n++)if(e===t._sounds[n]._id)return t._sounds[n];return null},_inactiveSound:function(){var e=this;e._drain();for(var t=0;t<e._sounds.length;t++)if(e._sounds[t]._ended)return e._sounds[t].reset();return new s(e)},_drain:function(){var e=this,t=e._pool,n=0,r=0;if(!(e._sounds.length<t)){for(r=0;r<e._sounds.length;r++)e._sounds[r]._ended&&n++;for(r=e._sounds.length-1;r>=0;r--){if(n<=t)return;e._sounds[r]._ended&&(e._webAudio&&e._sounds[r]._node&&e._sounds[r]._node.disconnect(0),e._sounds.splice(r,1),n--)}}},_getSoundIds:function(e){if(void 0===e){for(var t=[],n=0;n<this._sounds.length;n++)t.push(this._sounds[n]._id);return t}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=a.ctx.createBufferSource(),e._node.bufferSource.buffer=u[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,a.ctx.currentTime),this},_cleanBuffer:function(e){var t=a._navigator&&a._navigator.vendor.indexOf("Apple")>=0;if(a._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),t))try{e.bufferSource.buffer=a._scratchBuffer}catch(e){}return e.bufferSource=null,this},_clearSound:function(e){/MSIE |Trident\//.test(a._navigator&&a._navigator.userAgent)||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var s=function(e){this._parent=e,this.init()};s.prototype={init:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++a._counter,t._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,n=a._muted||e._muted||e._parent._muted?0:e._volume;return t._webAudio?(e._node=void 0===a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),e._node.gain.setValueAtTime(n,a.ctx.currentTime),e._node.paused=!0,e._node.connect(a.masterGain)):a.noAudio||(e._node=a._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(a._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=t._src,e._node.preload=!0===t._preload?"auto":t._preload,e._node.volume=n*a.volume(),e._node.load()),e},reset:function(){var e=this,t=e._parent;return e._muted=t._muted,e._loop=t._loop,e._volume=t._volume,e._rate=t._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++a._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(a._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,t=e._parent;t._duration===1/0&&(t._duration=Math.ceil(10*e._node.duration)/10,t._sprite.__default[1]===1/0&&(t._sprite.__default[1]=1e3*t._duration),t._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var u={},c=function(e){var t=e._src;if(u[t])return e._duration=u[t].duration,void f(e);if(/^data:[^;]+;base64,/.test(t)){for(var n=atob(t.split(",")[1]),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);h(r.buffer,e)}else{var a=new XMLHttpRequest;a.open(e._xhr.method,t,!0),a.withCredentials=e._xhr.withCredentials,a.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach((function(t){a.setRequestHeader(t,e._xhr.headers[t])})),a.onload=function(){var t=(a.status+"")[0];"0"===t||"2"===t||"3"===t?h(a.response,e):e._emit("loaderror",null,"Failed loading audio file with status: "+a.status+".")},a.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete u[t],e.load())},l(a)}},l=function(e){try{e.send()}catch(t){e.onerror()}},h=function(e,t){var n=function(){t._emit("loaderror",null,"Decoding audio data failed.")},r=function(e){e&&t._sounds.length>0?(u[t._src]=e,f(t,e)):n()};"undefined"!=typeof Promise&&1===a.ctx.decodeAudioData.length?a.ctx.decodeAudioData(e).then(r).catch(n):a.ctx.decodeAudioData(e,r,n)},f=function(e,t){t&&!e._duration&&(e._duration=t.duration),0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},p=function(){if(a.usingWebAudio){try{"undefined"!=typeof AudioContext?a.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?a.ctx=new webkitAudioContext:a.usingWebAudio=!1}catch(e){a.usingWebAudio=!1}a.ctx||(a.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(a._navigator&&a._navigator.platform),t=a._navigator&&a._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=t?parseInt(t[1],10):null;if(e&&n&&n<9){var r=/safari/.test(a._navigator&&a._navigator.userAgent.toLowerCase());a._navigator&&!r&&(a.usingWebAudio=!1)}a.usingWebAudio&&(a.masterGain=void 0===a.ctx.createGain?a.ctx.createGainNode():a.ctx.createGain(),a.masterGain.gain.setValueAtTime(a._muted?0:a._volume,a.ctx.currentTime),a.masterGain.connect(a.ctx.destination)),a._setup()}};void 0===(r=function(){return{Howler:a,Howl:o}}.apply(t,[]))||(e.exports=r),t.Howler=a,t.Howl=o,void 0!==n.g?(n.g.HowlerGlobal=i,n.g.Howler=a,n.g.Howl=o,n.g.Sound=s):"undefined"!=typeof window&&(window.HowlerGlobal=i,window.Howler=a,window.Howl=o,window.Sound=s)}(),function(){"use strict";var e;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var t=this;if(!t.ctx||!t.ctx.listener)return t;for(var n=t._howls.length-1;n>=0;n--)t._howls[n].stereo(e);return t},HowlerGlobal.prototype.pos=function(e,t,n){var r=this;return r.ctx&&r.ctx.listener?(t="number"!=typeof t?r._pos[1]:t,n="number"!=typeof n?r._pos[2]:n,"number"!=typeof e?r._pos:(r._pos=[e,t,n],void 0!==r.ctx.listener.positionX?(r.ctx.listener.positionX.setTargetAtTime(r._pos[0],Howler.ctx.currentTime,.1),r.ctx.listener.positionY.setTargetAtTime(r._pos[1],Howler.ctx.currentTime,.1),r.ctx.listener.positionZ.setTargetAtTime(r._pos[2],Howler.ctx.currentTime,.1)):r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]),r)):r},HowlerGlobal.prototype.orientation=function(e,t,n,r,i,a){var o=this;if(!o.ctx||!o.ctx.listener)return o;var s=o._orientation;return t="number"!=typeof t?s[1]:t,n="number"!=typeof n?s[2]:n,r="number"!=typeof r?s[3]:r,i="number"!=typeof i?s[4]:i,a="number"!=typeof a?s[5]:a,"number"!=typeof e?s:(o._orientation=[e,t,n,r,i,a],void 0!==o.ctx.listener.forwardX?(o.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),o.ctx.listener.forwardY.setTargetAtTime(t,Howler.ctx.currentTime,.1),o.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),o.ctx.listener.upX.setTargetAtTime(r,Howler.ctx.currentTime,.1),o.ctx.listener.upY.setTargetAtTime(i,Howler.ctx.currentTime,.1),o.ctx.listener.upZ.setTargetAtTime(a,Howler.ctx.currentTime,.1)):o.ctx.listener.setOrientation(e,t,n,r,i,a),o)},Howl.prototype.init=(e=Howl.prototype.init,function(t){var n=this;return n._orientation=t.orientation||[1,0,0],n._stereo=t.stereo||null,n._pos=t.pos||null,n._pannerAttr={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:360,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:360,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:0,distanceModel:void 0!==t.distanceModel?t.distanceModel:"inverse",maxDistance:void 0!==t.maxDistance?t.maxDistance:1e4,panningModel:void 0!==t.panningModel?t.panningModel:"HRTF",refDistance:void 0!==t.refDistance?t.refDistance:1,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:1},n._onstereo=t.onstereo?[{fn:t.onstereo}]:[],n._onpos=t.onpos?[{fn:t.onpos}]:[],n._onorientation=t.onorientation?[{fn:t.onorientation}]:[],e.call(this,t)}),Howl.prototype.stereo=function(e,n){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"stereo",action:function(){r.stereo(e,n)}}),r;var i=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===n){if("number"!=typeof e)return r._stereo;r._stereo=e,r._pos=[e,0,0]}for(var a=r._getSoundIds(n),o=0;o<a.length;o++){var s=r._soundById(a[o]);if(s){if("number"!=typeof e)return s._stereo;s._stereo=e,s._pos=[e,0,0],s._node&&(s._pannerAttr.panningModel="equalpower",s._panner&&s._panner.pan||t(s,i),"spatial"===i?void 0!==s._panner.positionX?(s._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),s._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),s._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):s._panner.setPosition(e,0,0):s._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),r._emit("stereo",s._id)}}return r},Howl.prototype.pos=function(e,n,r,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"pos",action:function(){a.pos(e,n,r,i)}}),a;if(n="number"!=typeof n?0:n,r="number"!=typeof r?-.5:r,void 0===i){if("number"!=typeof e)return a._pos;a._pos=[e,n,r]}for(var o=a._getSoundIds(i),s=0;s<o.length;s++){var u=a._soundById(o[s]);if(u){if("number"!=typeof e)return u._pos;u._pos=[e,n,r],u._node&&(u._panner&&!u._panner.pan||t(u,"spatial"),void 0!==u._panner.positionX?(u._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):u._panner.setPosition(e,n,r)),a._emit("pos",u._id)}}return a},Howl.prototype.orientation=function(e,n,r,i){var a=this;if(!a._webAudio)return a;if("loaded"!==a._state)return a._queue.push({event:"orientation",action:function(){a.orientation(e,n,r,i)}}),a;if(n="number"!=typeof n?a._orientation[1]:n,r="number"!=typeof r?a._orientation[2]:r,void 0===i){if("number"!=typeof e)return a._orientation;a._orientation=[e,n,r]}for(var o=a._getSoundIds(i),s=0;s<o.length;s++){var u=a._soundById(o[s]);if(u){if("number"!=typeof e)return u._orientation;u._orientation=[e,n,r],u._node&&(u._panner||(u._pos||(u._pos=a._pos||[0,0,-.5]),t(u,"spatial")),void 0!==u._panner.orientationX?(u._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),u._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),u._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):u._panner.setOrientation(e,n,r)),a._emit("orientation",u._id)}}return a},Howl.prototype.pannerAttr=function(){var e,n,r,i=this,a=arguments;if(!i._webAudio)return i;if(0===a.length)return i._pannerAttr;if(1===a.length){if("object"!=typeof a[0])return(r=i._soundById(parseInt(a[0],10)))?r._pannerAttr:i._pannerAttr;e=a[0],void 0===n&&(e.pannerAttr||(e.pannerAttr={coneInnerAngle:e.coneInnerAngle,coneOuterAngle:e.coneOuterAngle,coneOuterGain:e.coneOuterGain,distanceModel:e.distanceModel,maxDistance:e.maxDistance,refDistance:e.refDistance,rolloffFactor:e.rolloffFactor,panningModel:e.panningModel}),i._pannerAttr={coneInnerAngle:void 0!==e.pannerAttr.coneInnerAngle?e.pannerAttr.coneInnerAngle:i._coneInnerAngle,coneOuterAngle:void 0!==e.pannerAttr.coneOuterAngle?e.pannerAttr.coneOuterAngle:i._coneOuterAngle,coneOuterGain:void 0!==e.pannerAttr.coneOuterGain?e.pannerAttr.coneOuterGain:i._coneOuterGain,distanceModel:void 0!==e.pannerAttr.distanceModel?e.pannerAttr.distanceModel:i._distanceModel,maxDistance:void 0!==e.pannerAttr.maxDistance?e.pannerAttr.maxDistance:i._maxDistance,refDistance:void 0!==e.pannerAttr.refDistance?e.pannerAttr.refDistance:i._refDistance,rolloffFactor:void 0!==e.pannerAttr.rolloffFactor?e.pannerAttr.rolloffFactor:i._rolloffFactor,panningModel:void 0!==e.pannerAttr.panningModel?e.pannerAttr.panningModel:i._panningModel})}else 2===a.length&&(e=a[0],n=parseInt(a[1],10));for(var o=i._getSoundIds(n),s=0;s<o.length;s++)if(r=i._soundById(o[s])){var u=r._pannerAttr;u={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:u.coneInnerAngle,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:u.coneOuterAngle,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:u.coneOuterGain,distanceModel:void 0!==e.distanceModel?e.distanceModel:u.distanceModel,maxDistance:void 0!==e.maxDistance?e.maxDistance:u.maxDistance,refDistance:void 0!==e.refDistance?e.refDistance:u.refDistance,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:u.rolloffFactor,panningModel:void 0!==e.panningModel?e.panningModel:u.panningModel};var c=r._panner;c?(c.coneInnerAngle=u.coneInnerAngle,c.coneOuterAngle=u.coneOuterAngle,c.coneOuterGain=u.coneOuterGain,c.distanceModel=u.distanceModel,c.maxDistance=u.maxDistance,c.refDistance=u.refDistance,c.rolloffFactor=u.rolloffFactor,c.panningModel=u.panningModel):(r._pos||(r._pos=i._pos||[0,0,-.5]),t(r,"spatial"))}return i},Sound.prototype.init=function(e){return function(){var t=this,n=t._parent;t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,e.call(this),t._stereo?n.stereo(t._stereo):t._pos&&n.pos(t._pos[0],t._pos[1],t._pos[2],t._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var t=this,n=t._parent;return t._orientation=n._orientation,t._stereo=n._stereo,t._pos=n._pos,t._pannerAttr=n._pannerAttr,t._stereo?n.stereo(t._stereo):t._pos?n.pos(t._pos[0],t._pos[1],t._pos[2],t._id):t._panner&&(t._panner.disconnect(0),t._panner=void 0,n._refreshBuffer(t)),e.call(this)}}(Sound.prototype.reset);var t=function(e,t){"spatial"===(t=t||"spatial")?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,void 0!==e._panner.positionX?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),void 0!==e._panner.orientationX?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}}()},5717:function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},2584:function(e,t,n){"use strict";var r=n(6410)(),i=n(1924)("Object.prototype.toString"),a=function(e){return!(r&&e&&"object"==typeof e&&Symbol.toStringTag in e)&&"[object Arguments]"===i(e)},o=function(e){return!!a(e)||null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Array]"!==i(e)&&"[object Function]"===i(e.callee)},s=function(){return a(arguments)}();a.isLegacyArguments=o,e.exports=s?a:o},5320:function(e){"use strict";var t,n,r=Function.prototype.toString,i="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof i&&"function"==typeof Object.defineProperty)try{t=Object.defineProperty({},"length",{get:function(){throw n}}),n={},i((function(){throw 42}),null,t)}catch(e){e!==n&&(i=null)}else i=null;var a=/^\s*class\b/,o=function(e){try{var t=r.call(e);return a.test(t)}catch(e){return!1}},s=function(e){try{return!o(e)&&(r.call(e),!0)}catch(e){return!1}},u=Object.prototype.toString,c="function"==typeof Symbol&&!!Symbol.toStringTag,l=!(0 in[,]),h=function(){return!1};if("object"==typeof document){var f=document.all;u.call(f)===u.call(document.all)&&(h=function(e){if((l||!e)&&(void 0===e||"object"==typeof e))try{var t=u.call(e);return("[object HTMLAllCollection]"===t||"[object HTML document.all class]"===t||"[object HTMLCollection]"===t||"[object Object]"===t)&&null==e("")}catch(e){}return!1})}e.exports=i?function(e){if(h(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;try{i(e,null,t)}catch(e){if(e!==n)return!1}return!o(e)&&s(e)}:function(e){if(h(e))return!0;if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if(c)return s(e);if(o(e))return!1;var t=u.call(e);return!("[object Function]"!==t&&"[object GeneratorFunction]"!==t&&!/^\[object HTML/.test(t))&&s(e)}},8662:function(e,t,n){"use strict";var r,i=Object.prototype.toString,a=Function.prototype.toString,o=/^\s*(?:function)?\*/,s=n(6410)(),u=Object.getPrototypeOf;e.exports=function(e){if("function"!=typeof e)return!1;if(o.test(a.call(e)))return!0;if(!s)return"[object GeneratorFunction]"===i.call(e);if(!u)return!1;if(void 0===r){var t=function(){if(!s)return!1;try{return Function("return function*() {}")()}catch(e){}}();r=!!t&&u(t)}return u(e)===r}},5692:function(e,t,n){"use strict";var r=n(4029),i=n(3083),a=n(1924),o=a("Object.prototype.toString"),s=n(6410)(),u=n(7296),c="undefined"==typeof globalThis?n.g:globalThis,l=i(),h=a("Array.prototype.indexOf",!0)||function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t)return n;return-1},f=a("String.prototype.slice"),p={},m=Object.getPrototypeOf;s&&u&&m&&r(l,(function(e){var t=new c[e];if(Symbol.toStringTag in t){var n=m(t),r=u(n,Symbol.toStringTag);if(!r){var i=m(n);r=u(i,Symbol.toStringTag)}p[e]=r.get}}));e.exports=function(e){if(!e||"object"!=typeof e)return!1;if(!s||!(Symbol.toStringTag in e)){var t=f(o(e),8,-1);return h(l,t)>-1}return!!u&&function(e){var t=!1;return r(p,(function(n,r){if(!t)try{t=n.call(e)===r}catch(e){}})),t}(e)}},4155:function(e){var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var s,u=[],c=!1,l=-1;function h(){c&&s&&(c=!1,s.length?u=s.concat(u):l=-1,u.length&&f())}function f(){if(!c){var e=o(h);c=!0;for(var t=u.length;t;){for(s=u,u=[];++l<t;)s&&s[l].run();l=-1,t=u.length}s=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||c||o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},4069:function(e,t){"use strict";t.V=void 0;var n=function(){function e(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}return e.hashStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendStr(e).end(t)},e.hashAsciiStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendAsciiStr(e).end(t)},e._hex=function(t){var n,r,i,a,o=e.hexChars,s=e.hexOut;for(a=0;a<4;a+=1)for(r=8*a,n=t[a],i=0;i<8;i+=2)s[r+1+i]=o.charAt(15&n),n>>>=4,s[r+0+i]=o.charAt(15&n),n>>>=4;return s.join("")},e._md5cycle=function(e,t){var n=e[0],r=e[1],i=e[2],a=e[3];r=((r+=((i=((i+=((a=((a+=((n=((n+=(r&i|~r&a)+t[0]-680876936|0)<<7|n>>>25)+r|0)&r|~n&i)+t[1]-389564586|0)<<12|a>>>20)+n|0)&n|~a&r)+t[2]+606105819|0)<<17|i>>>15)+a|0)&a|~i&n)+t[3]-1044525330|0)<<22|r>>>10)+i|0,r=((r+=((i=((i+=((a=((a+=((n=((n+=(r&i|~r&a)+t[4]-176418897|0)<<7|n>>>25)+r|0)&r|~n&i)+t[5]+1200080426|0)<<12|a>>>20)+n|0)&n|~a&r)+t[6]-1473231341|0)<<17|i>>>15)+a|0)&a|~i&n)+t[7]-45705983|0)<<22|r>>>10)+i|0,r=((r+=((i=((i+=((a=((a+=((n=((n+=(r&i|~r&a)+t[8]+1770035416|0)<<7|n>>>25)+r|0)&r|~n&i)+t[9]-1958414417|0)<<12|a>>>20)+n|0)&n|~a&r)+t[10]-42063|0)<<17|i>>>15)+a|0)&a|~i&n)+t[11]-1990404162|0)<<22|r>>>10)+i|0,r=((r+=((i=((i+=((a=((a+=((n=((n+=(r&i|~r&a)+t[12]+1804603682|0)<<7|n>>>25)+r|0)&r|~n&i)+t[13]-40341101|0)<<12|a>>>20)+n|0)&n|~a&r)+t[14]-1502002290|0)<<17|i>>>15)+a|0)&a|~i&n)+t[15]+1236535329|0)<<22|r>>>10)+i|0,r=((r+=((i=((i+=((a=((a+=((n=((n+=(r&a|i&~a)+t[1]-165796510|0)<<5|n>>>27)+r|0)&i|r&~i)+t[6]-1069501632|0)<<9|a>>>23)+n|0)&r|n&~r)+t[11]+643717713|0)<<14|i>>>18)+a|0)&n|a&~n)+t[0]-373897302|0)<<20|r>>>12)+i|0,r=((r+=((i=((i+=((a=((a+=((n=((n+=(r&a|i&~a)+t[5]-701558691|0)<<5|n>>>27)+r|0)&i|r&~i)+t[10]+38016083|0)<<9|a>>>23)+n|0)&r|n&~r)+t[15]-660478335|0)<<14|i>>>18)+a|0)&n|a&~n)+t[4]-405537848|0)<<20|r>>>12)+i|0,r=((r+=((i=((i+=((a=((a+=((n=((n+=(r&a|i&~a)+t[9]+568446438|0)<<5|n>>>27)+r|0)&i|r&~i)+t[14]-1019803690|0)<<9|a>>>23)+n|0)&r|n&~r)+t[3]-187363961|0)<<14|i>>>18)+a|0)&n|a&~n)+t[8]+1163531501|0)<<20|r>>>12)+i|0,r=((r+=((i=((i+=((a=((a+=((n=((n+=(r&a|i&~a)+t[13]-1444681467|0)<<5|n>>>27)+r|0)&i|r&~i)+t[2]-51403784|0)<<9|a>>>23)+n|0)&r|n&~r)+t[7]+1735328473|0)<<14|i>>>18)+a|0)&n|a&~n)+t[12]-1926607734|0)<<20|r>>>12)+i|0,r=((r+=((i=((i+=((a=((a+=((n=((n+=(r^i^a)+t[5]-378558|0)<<4|n>>>28)+r|0)^r^i)+t[8]-2022574463|0)<<11|a>>>21)+n|0)^n^r)+t[11]+1839030562|0)<<16|i>>>16)+a|0)^a^n)+t[14]-35309556|0)<<23|r>>>9)+i|0,r=((r+=((i=((i+=((a=((a+=((n=((n+=(r^i^a)+t[1]-1530992060|0)<<4|n>>>28)+r|0)^r^i)+t[4]+1272893353|0)<<11|a>>>21)+n|0)^n^r)+t[7]-155497632|0)<<16|i>>>16)+a|0)^a^n)+t[10]-1094730640|0)<<23|r>>>9)+i|0,r=((r+=((i=((i+=((a=((a+=((n=((n+=(r^i^a)+t[13]+681279174|0)<<4|n>>>28)+r|0)^r^i)+t[0]-358537222|0)<<11|a>>>21)+n|0)^n^r)+t[3]-722521979|0)<<16|i>>>16)+a|0)^a^n)+t[6]+76029189|0)<<23|r>>>9)+i|0,r=((r+=((i=((i+=((a=((a+=((n=((n+=(r^i^a)+t[9]-640364487|0)<<4|n>>>28)+r|0)^r^i)+t[12]-421815835|0)<<11|a>>>21)+n|0)^n^r)+t[15]+530742520|0)<<16|i>>>16)+a|0)^a^n)+t[2]-995338651|0)<<23|r>>>9)+i|0,r=((r+=((a=((a+=(r^((n=((n+=(i^(r|~a))+t[0]-198630844|0)<<6|n>>>26)+r|0)|~i))+t[7]+1126891415|0)<<10|a>>>22)+n|0)^((i=((i+=(n^(a|~r))+t[14]-1416354905|0)<<15|i>>>17)+a|0)|~n))+t[5]-57434055|0)<<21|r>>>11)+i|0,r=((r+=((a=((a+=(r^((n=((n+=(i^(r|~a))+t[12]+1700485571|0)<<6|n>>>26)+r|0)|~i))+t[3]-1894986606|0)<<10|a>>>22)+n|0)^((i=((i+=(n^(a|~r))+t[10]-1051523|0)<<15|i>>>17)+a|0)|~n))+t[1]-2054922799|0)<<21|r>>>11)+i|0,r=((r+=((a=((a+=(r^((n=((n+=(i^(r|~a))+t[8]+1873313359|0)<<6|n>>>26)+r|0)|~i))+t[15]-30611744|0)<<10|a>>>22)+n|0)^((i=((i+=(n^(a|~r))+t[6]-1560198380|0)<<15|i>>>17)+a|0)|~n))+t[13]+1309151649|0)<<21|r>>>11)+i|0,r=((r+=((a=((a+=(r^((n=((n+=(i^(r|~a))+t[4]-145523070|0)<<6|n>>>26)+r|0)|~i))+t[11]-1120210379|0)<<10|a>>>22)+n|0)^((i=((i+=(n^(a|~r))+t[2]+718787259|0)<<15|i>>>17)+a|0)|~n))+t[9]-343485551|0)<<21|r>>>11)+i|0,e[0]=n+e[0]|0,e[1]=r+e[1]|0,e[2]=i+e[2]|0,e[3]=a+e[3]|0},e.prototype.start=function(){return this._dataLength=0,this._bufferLength=0,this._state.set(e.stateIdentity),this},e.prototype.appendStr=function(t){var n,r,i=this._buffer8,a=this._buffer32,o=this._bufferLength;for(r=0;r<t.length;r+=1){if((n=t.charCodeAt(r))<128)i[o++]=n;else if(n<2048)i[o++]=192+(n>>>6),i[o++]=63&n|128;else if(n<55296||n>56319)i[o++]=224+(n>>>12),i[o++]=n>>>6&63|128,i[o++]=63&n|128;else{if((n=1024*(n-55296)+(t.charCodeAt(++r)-56320)+65536)>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");i[o++]=240+(n>>>18),i[o++]=n>>>12&63|128,i[o++]=n>>>6&63|128,i[o++]=63&n|128}o>=64&&(this._dataLength+=64,e._md5cycle(this._state,a),o-=64,a[0]=a[16])}return this._bufferLength=o,this},e.prototype.appendAsciiStr=function(t){for(var n,r=this._buffer8,i=this._buffer32,a=this._bufferLength,o=0;;){for(n=Math.min(t.length-o,64-a);n--;)r[a++]=t.charCodeAt(o++);if(a<64)break;this._dataLength+=64,e._md5cycle(this._state,i),a=0}return this._bufferLength=a,this},e.prototype.appendByteArray=function(t){for(var n,r=this._buffer8,i=this._buffer32,a=this._bufferLength,o=0;;){for(n=Math.min(t.length-o,64-a);n--;)r[a++]=t[o++];if(a<64)break;this._dataLength+=64,e._md5cycle(this._state,i),a=0}return this._bufferLength=a,this},e.prototype.getState=function(){var e=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[e[0],e[1],e[2],e[3]]}},e.prototype.setState=function(e){var t,n=e.buffer,r=e.state,i=this._state;for(this._dataLength=e.length,this._bufferLength=e.buflen,i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],t=0;t<n.length;t+=1)this._buffer8[t]=n.charCodeAt(t)},e.prototype.end=function(t){void 0===t&&(t=!1);var n=this._bufferLength,r=this._buffer8,i=this._buffer32,a=1+(n>>2);this._dataLength+=n;var o=8*this._dataLength;if(r[n]=128,r[n+1]=r[n+2]=r[n+3]=0,i.set(e.buffer32Identity.subarray(a),a),n>55&&(e._md5cycle(this._state,i),i.set(e.buffer32Identity)),o<=4294967295)i[14]=o;else{var s=o.toString(16).match(/(.*?)(.{0,8})$/);if(null===s)return;var u=parseInt(s[2],16),c=parseInt(s[1],16)||0;i[14]=u,i[15]=c}return e._md5cycle(this._state,i),t?this._state:e._hex(this._state)},e.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),e.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),e.hexChars="0123456789abcdef",e.hexOut=[],e.onePassHasher=new e,e}();if(t.V=n,"5d41402abc4b2a76b9719d911017c592"!==n.hashStr("hello"))throw new Error("Md5 self test failed.")},384:function(e){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},5955:function(e,t,n){"use strict";var r=n(2584),i=n(8662),a=n(6430),o=n(5692);function s(e){return e.call.bind(e)}var u="undefined"!=typeof BigInt,c="undefined"!=typeof Symbol,l=s(Object.prototype.toString),h=s(Number.prototype.valueOf),f=s(String.prototype.valueOf),p=s(Boolean.prototype.valueOf);if(u)var m=s(BigInt.prototype.valueOf);if(c)var d=s(Symbol.prototype.valueOf);function v(e,t){if("object"!=typeof e)return!1;try{return t(e),!0}catch(e){return!1}}function y(e){return"[object Map]"===l(e)}function g(e){return"[object Set]"===l(e)}function b(e){return"[object WeakMap]"===l(e)}function M(e){return"[object WeakSet]"===l(e)}function k(e){return"[object ArrayBuffer]"===l(e)}function _(e){return"undefined"!=typeof ArrayBuffer&&(k.working?k(e):e instanceof ArrayBuffer)}function x(e){return"[object DataView]"===l(e)}function T(e){return"undefined"!=typeof DataView&&(x.working?x(e):e instanceof DataView)}t.isArgumentsObject=r,t.isGeneratorFunction=i,t.isTypedArray=o,t.isPromise=function(e){return"undefined"!=typeof Promise&&e instanceof Promise||null!==e&&"object"==typeof e&&"function"==typeof e.then&&"function"==typeof e.catch},t.isArrayBufferView=function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):o(e)||T(e)},t.isUint8Array=function(e){return"Uint8Array"===a(e)},t.isUint8ClampedArray=function(e){return"Uint8ClampedArray"===a(e)},t.isUint16Array=function(e){return"Uint16Array"===a(e)},t.isUint32Array=function(e){return"Uint32Array"===a(e)},t.isInt8Array=function(e){return"Int8Array"===a(e)},t.isInt16Array=function(e){return"Int16Array"===a(e)},t.isInt32Array=function(e){return"Int32Array"===a(e)},t.isFloat32Array=function(e){return"Float32Array"===a(e)},t.isFloat64Array=function(e){return"Float64Array"===a(e)},t.isBigInt64Array=function(e){return"BigInt64Array"===a(e)},t.isBigUint64Array=function(e){return"BigUint64Array"===a(e)},y.working="undefined"!=typeof Map&&y(new Map),t.isMap=function(e){return"undefined"!=typeof Map&&(y.working?y(e):e instanceof Map)},g.working="undefined"!=typeof Set&&g(new Set),t.isSet=function(e){return"undefined"!=typeof Set&&(g.working?g(e):e instanceof Set)},b.working="undefined"!=typeof WeakMap&&b(new WeakMap),t.isWeakMap=function(e){return"undefined"!=typeof WeakMap&&(b.working?b(e):e instanceof WeakMap)},M.working="undefined"!=typeof WeakSet&&M(new WeakSet),t.isWeakSet=function(e){return M(e)},k.working="undefined"!=typeof ArrayBuffer&&k(new ArrayBuffer),t.isArrayBuffer=_,x.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&x(new DataView(new ArrayBuffer(1),0,1)),t.isDataView=T;var w="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function R(e){return"[object SharedArrayBuffer]"===l(e)}function Z(e){return void 0!==w&&(void 0===R.working&&(R.working=R(new w)),R.working?R(e):e instanceof w)}function S(e){return v(e,h)}function C(e){return v(e,f)}function I(e){return v(e,p)}function E(e){return u&&v(e,m)}function A(e){return c&&v(e,d)}t.isSharedArrayBuffer=Z,t.isAsyncFunction=function(e){return"[object AsyncFunction]"===l(e)},t.isMapIterator=function(e){return"[object Map Iterator]"===l(e)},t.isSetIterator=function(e){return"[object Set Iterator]"===l(e)},t.isGeneratorObject=function(e){return"[object Generator]"===l(e)},t.isWebAssemblyCompiledModule=function(e){return"[object WebAssembly.Module]"===l(e)},t.isNumberObject=S,t.isStringObject=C,t.isBooleanObject=I,t.isBigIntObject=E,t.isSymbolObject=A,t.isBoxedPrimitive=function(e){return S(e)||C(e)||I(e)||E(e)||A(e)},t.isAnyArrayBuffer=function(e){return"undefined"!=typeof Uint8Array&&(_(e)||Z(e))},["isProxy","isExternal","isModuleNamespaceObject"].forEach((function(e){Object.defineProperty(t,e,{enumerable:!1,value:function(){throw new Error(e+" is not supported in userland")}})}))},9539:function(e,t,n){var r=n(4155),i=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},a=/%[sdj%]/g;t.format=function(e){if(!b(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(c(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,o=String(e).replace(a,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),s=r[n];n<i;s=r[++n])y(s)||!_(s)?o+=" "+s:o+=" "+c(s);return o},t.deprecate=function(e,n){if(void 0!==r&&!0===r.noDeprecation)return e;if(void 0===r)return function(){return t.deprecate(e,n).apply(this,arguments)};var i=!1;return function(){if(!i){if(r.throwDeprecation)throw new Error(n);r.traceDeprecation?console.trace(n):console.error(n),i=!0}return e.apply(this,arguments)}};var o={},s=/^$/;if(r.env.NODE_DEBUG){var u=r.env.NODE_DEBUG;u=u.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),s=new RegExp("^"+u+"$","i")}function c(e,n){var r={seen:[],stylize:h};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),v(n)?r.showHidden=n:n&&t._extend(r,n),M(r.showHidden)&&(r.showHidden=!1),M(r.depth)&&(r.depth=2),M(r.colors)&&(r.colors=!1),M(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=l),f(r,e,r.depth)}function l(e,t){var n=c.styles[t];return n?"["+c.colors[n][0]+"m"+e+"["+c.colors[n][1]+"m":e}function h(e,t){return e}function f(e,n,r){if(e.customInspect&&n&&w(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(r,e);return b(i)||(i=f(e,i,r)),i}var a=function(e,t){if(M(t))return e.stylize("undefined","undefined");if(b(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}if(g(t))return e.stylize(""+t,"number");if(v(t))return e.stylize(""+t,"boolean");if(y(t))return e.stylize("null","null")}(e,n);if(a)return a;var o=Object.keys(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(n)),T(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return p(n);if(0===o.length){if(w(n)){var u=n.name?": "+n.name:"";return e.stylize("[Function"+u+"]","special")}if(k(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(x(n))return e.stylize(Date.prototype.toString.call(n),"date");if(T(n))return p(n)}var c,l="",h=!1,_=["{","}"];(d(n)&&(h=!0,_=["[","]"]),w(n))&&(l=" [Function"+(n.name?": "+n.name:"")+"]");return k(n)&&(l=" "+RegExp.prototype.toString.call(n)),x(n)&&(l=" "+Date.prototype.toUTCString.call(n)),T(n)&&(l=" "+p(n)),0!==o.length||h&&0!=n.length?r<0?k(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),c=h?function(e,t,n,r,i){for(var a=[],o=0,s=t.length;o<s;++o)C(t,String(o))?a.push(m(e,t,n,r,String(o),!0)):a.push("");return i.forEach((function(i){i.match(/^\d+$/)||a.push(m(e,t,n,r,i,!0))})),a}(e,n,r,s,o):o.map((function(t){return m(e,n,r,s,t,h)})),e.seen.pop(),function(e,t,n){var r=e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);if(r>60)return n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1];return n[0]+t+" "+e.join(", ")+" "+n[1]}(c,l,_)):_[0]+l+_[1]}function p(e){return"["+Error.prototype.toString.call(e)+"]"}function m(e,t,n,r,i,a){var o,s,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),C(r,i)||(o="["+i+"]"),s||(e.seen.indexOf(u.value)<0?(s=y(n)?f(e,u.value,null):f(e,u.value,n-1)).indexOf("\n")>-1&&(s=a?s.split("\n").map((function(e){return"  "+e})).join("\n").slice(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),M(o)){if(a&&i.match(/^\d+$/))return s;(o=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.slice(1,-1),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+s}function d(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function y(e){return null===e}function g(e){return"number"==typeof e}function b(e){return"string"==typeof e}function M(e){return void 0===e}function k(e){return _(e)&&"[object RegExp]"===R(e)}function _(e){return"object"==typeof e&&null!==e}function x(e){return _(e)&&"[object Date]"===R(e)}function T(e){return _(e)&&("[object Error]"===R(e)||e instanceof Error)}function w(e){return"function"==typeof e}function R(e){return Object.prototype.toString.call(e)}function Z(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(e=e.toUpperCase(),!o[e])if(s.test(e)){var n=r.pid;o[e]=function(){var r=t.format.apply(t,arguments);console.error("%s %d: %s",e,n,r)}}else o[e]=function(){};return o[e]},t.inspect=c,c.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.types=n(5955),t.isArray=d,t.isBoolean=v,t.isNull=y,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=b,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=M,t.isRegExp=k,t.types.isRegExp=k,t.isObject=_,t.isDate=x,t.types.isDate=x,t.isError=T,t.types.isNativeError=T,t.isFunction=w,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(384);var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){var e,n;console.log("%s - %s",(e=new Date,n=[Z(e.getHours()),Z(e.getMinutes()),Z(e.getSeconds())].join(":"),[e.getDate(),S[e.getMonth()],n].join(" ")),t.format.apply(t,arguments))},t.inherits=n(5717),t._extend=function(e,t){if(!t||!_(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var I="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function E(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(I&&e[I]){var t;if("function"!=typeof(t=e[I]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,I,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),i=[],a=0;a<arguments.length;a++)i.push(arguments[a]);i.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,i)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),I&&Object.defineProperty(t,I,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,i(e))},t.promisify.custom=I,t.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);var i=t.pop();if("function"!=typeof i)throw new TypeError("The last argument must be of type Function");var a=this,o=function(){return i.apply(a,arguments)};e.apply(this,t).then((function(e){r.nextTick(o.bind(null,null,e))}),(function(e){r.nextTick(E.bind(null,e,o))}))}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,i(e)),t}},6430:function(e,t,n){"use strict";var r=n(4029),i=n(3083),a=n(1924),o=n(7296),s=a("Object.prototype.toString"),u=n(6410)(),c="undefined"==typeof globalThis?n.g:globalThis,l=i(),h=a("String.prototype.slice"),f={},p=Object.getPrototypeOf;u&&o&&p&&r(l,(function(e){if("function"==typeof c[e]){var t=new c[e];if(Symbol.toStringTag in t){var n=p(t),r=o(n,Symbol.toStringTag);if(!r){var i=p(n);r=o(i,Symbol.toStringTag)}f[e]=r.get}}}));var m=n(5692);e.exports=function(e){return!!m(e)&&(u&&Symbol.toStringTag in e?function(e){var t=!1;return r(f,(function(n,r){if(!t)try{var i=n.call(e);i===r&&(t=i)}catch(e){}})),t}(e):h(s(e),8,-1))}},7061:function(e,t,n){var r=n(8698).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,a=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function h(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(e){h=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var i=t&&t.prototype instanceof d?t:d,a=Object.create(i.prototype),s=new S(r||[]);return o(a,"_invoke",{value:T(e,n,s)}),a}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var m={};function d(){}function v(){}function y(){}var g={};h(g,u,(function(){return this}));var b=Object.getPrototypeOf,M=b&&b(b(C([])));M&&M!==n&&a.call(M,u)&&(g=M);var k=y.prototype=d.prototype=Object.create(g);function _(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(i,o,s,u){var c=p(e[i],e,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==r(h)&&a.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(h).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var i;o(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}})}function T(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return I()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=w(o,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=p(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function w(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(r,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,m;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,m):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function Z(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function C(e){if(e){var t=e[u];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=y,o(k,"constructor",{value:y,configurable:!0}),o(y,"constructor",{value:v,configurable:!0}),v.displayName=h(y,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,h(e,l,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},_(x.prototype),h(x.prototype,c,(function(){return this})),t.AsyncIterator=x,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new x(f(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},_(k),h(k,l,"Generator"),h(k,u,(function(){return this})),h(k,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=C,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(Z),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),Z(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;Z(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),m}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},8698:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},4687:function(e,t,n){var r=n(7061)();e.exports=r;try{regeneratorRuntime=r}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},3083:function(e,t,n){"use strict";var r=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],i="undefined"==typeof globalThis?n.g:globalThis;e.exports=function(){for(var e=[],t=0;t<r.length;t++)"function"==typeof i[r[t]]&&(e[e.length]=r[t]);return e}},7326:function(e,t,n){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,{Z:function(){return r}})},5671:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,{Z:function(){return r}})},3144:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(9142);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(0,r.Z)(i.key),i)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}},3:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(9142);function i(e,t,n){return(t=(0,r.Z)(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},1120:function(e,t,n){"use strict";function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}n.d(t,{Z:function(){return r}})},136:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(9611);function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&(0,r.Z)(e,t)}},2963:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(1002),i=n(7326);function a(e,t){if(t&&("object"===(0,r.Z)(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return(0,i.Z)(e)}},9611:function(e,t,n){"use strict";function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}n.d(t,{Z:function(){return r}})},9142:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(1002);function i(e){var t=function(e,t){if("object"!==(0,r.Z)(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==(0,r.Z)(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===(0,r.Z)(t)?t:String(t)}},1002:function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}n.d(t,{Z:function(){return r}})}},__webpack_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var n=Object.create(null);__webpack_require__.r(n);var r={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var i=2&t&&e;"object"==typeof i&&!~leafPrototypes.indexOf(i);i=getProto(i))Object.getOwnPropertyNames(i).forEach((function(t){r[t]=function(){return e[t]}}));return r.default=function(){return e},__webpack_require__.d(n,r),n},__webpack_require__.d=function(e,t){for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.f={},__webpack_require__.e=function(e){return Promise.all(Object.keys(__webpack_require__.f).reduce((function(t,n){return __webpack_require__.f[n](e,t),t}),[]))},__webpack_require__.u=function(e){return{323:"vendor.babylonjs-gui",647:"vendor.swiperjs",796:"vendor.babylonjs",803:"vendor.babylonjs-materials",866:"vendor.cannon-es"}[e]+".js"},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},inProgress={},dataWebpackPrefix="@expivi/interface:",__webpack_require__.l=function(e,t,n,r){if(inProgress[e])inProgress[e].push(t);else{var i,a;if(void 0!==n)for(var o=document.getElementsByTagName("script"),s=0;s<o.length;s++){var u=o[s];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==dataWebpackPrefix+n){i=u;break}}i||(a=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,__webpack_require__.nc&&i.setAttribute("nonce",__webpack_require__.nc),i.setAttribute("data-webpack",dataWebpackPrefix+n),i.src=e),inProgress[e]=[t];var c=function(t,n){i.onerror=i.onload=null,clearTimeout(l);var r=inProgress[e];if(delete inProgress[e],i.parentNode&&i.parentNode.removeChild(i),r&&r.forEach((function(e){return e(n)})),t)return t(n)},l=setTimeout(c.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=c.bind(null,i.onerror),i.onload=c.bind(null,i.onload),a&&document.head.appendChild(i)}},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e;__webpack_require__.g.importScripts&&(e=__webpack_require__.g.location+"");var t=__webpack_require__.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=e}(),function(){var e={826:0};__webpack_require__.f.j=function(t,n){var r=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var i=new Promise((function(n,i){r=e[t]=[n,i]}));n.push(r[2]=i);var a=__webpack_require__.p+__webpack_require__.u(t),o=new Error;__webpack_require__.l(a,(function(n){if(__webpack_require__.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var i=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+a+")",o.name="ChunkLoadError",o.type=i,o.request=a,r[1](o)}}),"chunk-"+t,t)}};var t=function(t,n){var r,i,a=n[0],o=n[1],s=n[2],u=0;if(a.some((function(t){return 0!==e[t]}))){for(r in o)__webpack_require__.o(o,r)&&(__webpack_require__.m[r]=o[r]);if(s)s(__webpack_require__)}for(t&&t(n);u<a.length;u++)i=a[u],__webpack_require__.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.webpackChunk_expivi_interface=self.webpackChunk_expivi_interface||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var __webpack_exports__={};!function(){"use strict";function e(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function t(t){return function(){var n=this,r=arguments;return new Promise((function(i,a){var o=t.apply(n,r);function s(t){e(o,i,a,s,u,"next",t)}function u(t){e(o,i,a,s,u,"throw",t)}s(void 0)}))}}var n=__webpack_require__(4687),r=__webpack_require__.n(n);__webpack_require__(9601),__webpack_require__(1539),__webpack_require__(8674),__webpack_require__(4916),__webpack_require__(7601);function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a,o,s=[],u=!0,c=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){c=!0,i=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var u=__webpack_require__(5671),c=__webpack_require__(3144),l=__webpack_require__(3),h=(__webpack_require__(6992),__webpack_require__(1532),__webpack_require__(8783),__webpack_require__(72),__webpack_require__(3042),__webpack_require__(9137),__webpack_require__(1957),__webpack_require__(6306),__webpack_require__(103),__webpack_require__(4592),__webpack_require__(8276),__webpack_require__(5082),__webpack_require__(2813),__webpack_require__(8222),__webpack_require__(8563),__webpack_require__(336),__webpack_require__(7512),__webpack_require__(3948),__webpack_require__(7658),__webpack_require__(1703),__webpack_require__(5581),__webpack_require__(2490),__webpack_require__(4514),__webpack_require__(4747),__webpack_require__(561),__webpack_require__(9653),__webpack_require__(9826),__webpack_require__(1672),__webpack_require__(9461),__webpack_require__(7327),__webpack_require__(8449),__webpack_require__(9849),__webpack_require__(4553),__webpack_require__(8862),__webpack_require__(5387),__webpack_require__(2608),__webpack_require__(8216),__webpack_require__(9433),__webpack_require__(7042),__webpack_require__(1249),__webpack_require__(7640),__webpack_require__(9924),__webpack_require__(6342),__webpack_require__(2962),__webpack_require__(3748),__webpack_require__(7922),function(){function e(){(0,u.Z)(this,e)}var n;return(0,c.Z)(e,null,[{key:"resolveArray",value:function(e,t){var n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0!==e.length){var i=e.shift();Promise.resolve("function"==typeof i?i():i).then((function(){n.resolveArray(e,t,r)})).catch((function(){n.resolveArray(e,t,!1)}))}else t(r)}},{key:"resolveAll",value:function(e,n){if(0!==e.length){var i=e.map(function(){var e=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="function"==typeof t?t():t,e.abrupt("return",n instanceof Promise?n:Promise.resolve(n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());Promise.allSettled(i).then((function(){n(!0)})).catch((function(){n(!1)}))}else n(!0)}},{key:"executeInOrder",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Array,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Array;if(0===e.length||r&&a.length>0)t(i,a);else{var o=e.shift();Promise.resolve(o()).then((function(o){i.push(o),n.executeInOrder(e,t,r,i,a)})).catch((function(o){a.push(o),n.executeInOrder(e,t,r,i,a)}))}}},{key:"completePromise",value:(n=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){Promise.resolve(t).then((function(t){e(t)})).catch((function(){e(void 0)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}]),e}()),f=__webpack_require__(3909),p=(__webpack_require__(7941),__webpack_require__(9600),__webpack_require__(3123),__webpack_require__(9539));function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if((0,p.isNullOrUndefined)(e))return null;var a=e.attributes,o=e.relationships||{};return Object.keys(o).forEach((function(e){var s=e;n&&(s=s.split(/(?=[A-Z])/).map((function(e){return e.toLowerCase()})).join("_"));var u=Array.isArray(o[e].data),c=u?o[e].data:[o[e].data],l=void 0!==i[e]?i[e]:s;a[l]=c.map((function(e){var a=t.find((function(t){return t.id===e.id&&t.type===e.type}));return(0,p.isUndefined)(a)?null:r<=0?a.attributes:m(a,t,n,r-1,i)})).filter((function(e){return!(0,p.isNullOrUndefined)(e)})),u||(a[l]=a[l][0])})),a}function d(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if((0,p.isNullOrUndefined)(e)||(0,p.isNullOrUndefined)(e.data))return null;var i=(0,p.isNullOrUndefined)(e.included)?[]:e.included;return Array.isArray(e.data)?e.data.map((function(e){return m(e,i,t,n,r)})):m(e.data,i,t,n,r)}var v={getItems:function(e){return(0,p.isUndefined)(e.data)?[]:e.data.map((function(e){return e.attributes}))},getItem:function(e){if(!(0,p.isUndefined)(e.data))return e.data.attributes},getIncludedItems:function(e,t){return(0,p.isUndefined)(e.included)?[]:e.included.filter((function(e){return e.type===t})).map((function(e){return e.attributes}))},getItemsWithRelations:function(e){return d(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{})},hydrateResponse:d,getIncludedItemsWithRelations:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if((0,p.isUndefined)(e.included))return[];var i=e.included||[];return i.map((function(e){if(e.type===t){var a=e.attributes||[],o=e.relationships||{};return Object.keys(o).forEach((function(t){var o=t;n&&(o=t.split(/(?=[A-Z])/).map((function(e){return e.toLowerCase()})).join("_"));var s=void 0!==r[t]?r[t]:o;a[s]=e.relationships[t].data.map((function(e){var t=i.find((function(t){return t.id===e.id&&t.type===e.type}));return(0,p.isUndefined)(t)?null:t.attributes})).filter((function(e){return!(0,p.isNullOrUndefined)(e)}))})),a}})).filter((function(e){return!(0,p.isNullOrUndefined)(e)}))},getMetaCursor:function(e){return(0,p.isUndefined)(e.meta.cursor)?0:Number(e.meta.cursor.current)},getMetaTotalCount:function(e){if(!(0,p.isUndefined)(e.meta.total_count))return e.meta.total_count}},y=__webpack_require__(1765),g=(__webpack_require__(1299),__webpack_require__(2419),__webpack_require__(136)),b=__webpack_require__(2963),M=__webpack_require__(1120),k=__webpack_require__(5845),_=__webpack_require__(7326),x=(__webpack_require__(2222),__webpack_require__(9291));function T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var w=function(e){(0,g.Z)(n,e);var t=T(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mDismissed",!1),e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"dismiss",value:function(){this.mDismissed=!0}},{key:"isDismissed",value:function(){return this.mDismissed}}]),n}(x.e);function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(w,"TypeRTTI",new k.r("Message",x.e.TypeRTTI));var Z=function(e){(0,g.Z)(n,e);var t=R(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Z,"TypeRTTI",new k.r("MessageAfterViewInit",w.TypeRTTI));var C=function(e){(0,g.Z)(n,e);var t=S(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(C,"TypeRTTI",new k.r("MessageCameraAnimated",w.TypeRTTI));var E=function(e){(0,g.Z)(n,e);var t=I(n);function n(){var e,r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return(0,u.Z)(this,n),e=t.call(this),(0,l.Z)((0,_.Z)(e),"mZoomed",void 0),e.mZoomed=r,e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"hasZoomed",get:function(){return this.mZoomed}}]),n}(w);function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(E,"TypeRTTI",new k.r("MessageCameraZoom",w.TypeRTTI));var O=function(e){(0,g.Z)(n,e);var t=A(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);(0,l.Z)(O,"TypeRTTI",new k.r("MessageControlsMoved",w.TypeRTTI));var D=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,u.Z)(this,e),(0,l.Z)(this,"x",0),(0,l.Z)(this,"y",0),this.x=t,this.y=n}return(0,c.Z)(e,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: ".concat(e))}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: ".concat(e))}}},{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t){return void 0!==(arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0)&&console.warn("Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}}],[{key:"Zero",value:function(){return new e(0,0)}},{key:"Half",value:function(){return new e(.5,.5)}},{key:"One",value:function(){return new e(1,1)}}]),e}(),P=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mAccessor",void 0),(0,l.Z)(this,"mIsInitialized",!1)}return(0,c.Z)(e,null,[{key:"getInstance",value:function(){return e.sInstance||(e.sInstance=new e),e.sInstance}},{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getInstance();n.mAccessor=e,n.mAccessor.init(t),n.mIsInitialized=!0}},{key:"isInitialized",value:function(){return this.getInstance().mIsInitialized}},{key:"renderer",value:function(){var t=e.getInstance();if(!t.mAccessor)throw new Error("Module used before initialisation.");return t.mAccessor.renderer()}},{key:"sceneManager",value:function(){var t=e.getInstance();if(!t.mAccessor)throw new Error("Module used before initialisation.");return t.mAccessor.sceneManager()}},{key:"eventBus",value:function(){var t=e.getInstance();if(!t.mAccessor)throw new Error("Module used before initialisation.");return t.mAccessor.eventBus()}},{key:"messenger",value:function(){var t=e.getInstance();if(!t.mAccessor)throw new Error("Module used before initialisation.");return t.mAccessor.messenger()}},{key:"commandManager",value:function(){var t=e.getInstance();if(!t.mAccessor)throw new Error("Module used before initialisation.");return t.mAccessor.commandManager()}},{key:"stateRegistery",value:function(){var t=e.getInstance();if(!t.mAccessor)throw new Error("Module used before initialisation.");return t.mAccessor.stateRegistery()}},{key:"settingsManager",value:function(){var t=e.getInstance();if(!t.mAccessor)throw new Error("Module used before initialisation.");return t.mAccessor.settingsManager()}},{key:"interceptorManager",value:function(){var t=e.getInstance();if(!t.mAccessor)throw new Error("Module used before initialisation.");return t.mAccessor.interceptorManager()}},{key:"physicsSystem",value:function(){var t=e.getInstance();if(!t.mAccessor)throw new Error("Module used before initialisation.");return t.mAccessor.physicsSystem()}},{key:"dispose",value:function(){e.sInstance&&e.sInstance.mAccessor&&e.sInstance.mAccessor.dispose(),delete e.sInstance}},{key:"reset",value:function(t,n){var r=e.getInstance();if(!r.mAccessor)throw new Error("Module used before initialisation.");return r.mAccessor.reset(t,n)}}]),e}();function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(P,"sInstance",void 0);var F=function(e){(0,g.Z)(n,e);var t=B(n);function n(e,r,i){var a;return(0,u.Z)(this,n),a=t.call(this),(0,l.Z)((0,_.Z)(a),"mName",void 0),(0,l.Z)((0,_.Z)(a),"mData",void 0),(0,l.Z)((0,_.Z)(a),"mScreenPosition",new D),a.mName=e,a.mScreenPosition.copy(r),a.mData=i,a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"name",get:function(){return this.mName}},{key:"data",get:function(){return this.mData}},{key:"position",get:function(){return this.mScreenPosition}},{key:"canvasPosition",get:function(){var e=P.renderer().getRenderEngine().getCanvas().getBoundingClientRect();return new D(this.mScreenPosition.x-e.left,this.mScreenPosition.y-e.top)}}]),n}(w);function L(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(F,"TypeRTTI",new k.r("MessageDrag",w.TypeRTTI));var N=function(e){(0,g.Z)(n,e);var t=L(n);function n(e,r,i){var a;return(0,u.Z)(this,n),a=t.call(this),(0,l.Z)((0,_.Z)(a),"mName",void 0),(0,l.Z)((0,_.Z)(a),"mIsDroppedInDropZone",void 0),(0,l.Z)((0,_.Z)(a),"mData",void 0),a.mName=e,a.mIsDroppedInDropZone=r,a.mData=i,a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"name",get:function(){return this.mName}},{key:"data",get:function(){return this.mData}},{key:"isDroppedInDropZone",get:function(){return this.mIsDroppedInDropZone}}]),n}(w);function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(N,"TypeRTTI",new k.r("MessageDropZone",w.TypeRTTI));var z=function(e){(0,g.Z)(n,e);var t=j(n);function n(e,r){var i,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"fitPosition",void 0),(0,l.Z)((0,_.Z)(i),"targetObject",void 0),(0,l.Z)((0,_.Z)(i),"animate",void 0),i.fitPosition=e,i.targetObject=r,i.animate=a,i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function U(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(z,"TypeRTTI",new k.r("MessageFitCamera",w.TypeRTTI));var V=function(e){(0,g.Z)(n,e);var t=U(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function H(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(V,"TypeRTTI",new k.r("MessageInitRenderObject",w.TypeRTTI));var G=function(e){(0,g.Z)(n,e);var t=H(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mMaterialModelId",void 0),(0,l.Z)((0,_.Z)(i),"mSharedKey",void 0),i.mMaterialModelId=e,i.mSharedKey=r,i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"materialModelId",get:function(){return this.mMaterialModelId}},{key:"sharedKey",get:function(){return this.mSharedKey}}]),n}(w);function q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(G,"TypeRTTI",new k.r("MessageMaterialOverwrite",w.TypeRTTI));var W,Y=function(e){(0,g.Z)(n,e);var t=q(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mName",void 0),(0,l.Z)((0,_.Z)(i),"mEvent",void 0),i.mName=e,i.mEvent=r,i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"name",get:function(){return this.mName}},{key:"event",get:function(){return this.mEvent}}]),n}(w);function K(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Y,"TypeRTTI",new k.r("MessageMouse",w.TypeRTTI)),function(e){e[e.NONE=0]="NONE",e[e.PUSH_CONTROLLER=1]="PUSH_CONTROLLER",e[e.POP_CONTROLLER=2]="POP_CONTROLLER"}(W||(W={}));var X=function(e){(0,g.Z)(n,e);var t=K(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:W.NONE,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"origin",void 0),(0,l.Z)((0,_.Z)(i),"dir",void 0),(0,l.Z)((0,_.Z)(i),"action",void 0),(0,l.Z)((0,_.Z)(i),"delta",void 0),(0,l.Z)((0,_.Z)(i),"forceUpdate",void 0),i.origin=e,i.dir=r,i.action=a,i.delta=o,i.forceUpdate=s,i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(X,"TypeRTTI",new k.r("MessageMoveCamera",w.TypeRTTI));var J=function(e){(0,g.Z)(n,e);var t=Q(n);function n(e,r,i,a,o){var s;return(0,u.Z)(this,n),s=t.call(this),(0,l.Z)((0,_.Z)(s),"product_scene_uuid",void 0),(0,l.Z)((0,_.Z)(s),"product_scene_id",void 0),(0,l.Z)((0,_.Z)(s),"attribute_id",void 0),(0,l.Z)((0,_.Z)(s),"option_id",void 0),(0,l.Z)((0,_.Z)(s),"visible",void 0),s.product_scene_id=e,s.product_scene_uuid=r,s.attribute_id=i,s.option_id=o,s.visible=a,s}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(J,"TypeRTTI",new k.r("MessageOptionVisibility",w.TypeRTTI));var te=function(e){(0,g.Z)(n,e);var t=ee(n);function n(e,r,i){var a;return(0,u.Z)(this,n),a=t.call(this),(0,l.Z)((0,_.Z)(a),"renderer",void 0),(0,l.Z)((0,_.Z)(a),"camera",void 0),(0,l.Z)((0,_.Z)(a),"scene",void 0),a.renderer=e,a.camera=r,a.scene=i,a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(te,"TypeRTTI",new k.r("MessagePostrender",w.TypeRTTI));var re=function(e){(0,g.Z)(n,e);var t=ne(n);function n(e,r,i){var a;return(0,u.Z)(this,n),a=t.call(this),(0,l.Z)((0,_.Z)(a),"renderer",void 0),(0,l.Z)((0,_.Z)(a),"camera",void 0),(0,l.Z)((0,_.Z)(a),"scene",void 0),a.renderer=e,a.camera=r,a.scene=i,a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(re,"TypeRTTI",new k.r("MessagePrerender",w.TypeRTTI));var ae=function(e){(0,g.Z)(n,e);var t=ie(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"item_id",void 0),(0,l.Z)((0,_.Z)(i),"visible",void 0),i.item_id=e,i.visible=r,i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(ae,"TypeRTTI",new k.r("MessagePriceVisibility",w.TypeRTTI));var se=function(e){(0,g.Z)(n,e);var t=oe(n);function n(e,r,i){var a;return(0,u.Z)(this,n),a=t.call(this),(0,l.Z)((0,_.Z)(a),"mRenderer",void 0),(0,l.Z)((0,_.Z)(a),"mCamera",void 0),(0,l.Z)((0,_.Z)(a),"mScene",void 0),a.mRenderer=e,a.mCamera=r,a.mScene=i,a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"renderer",get:function(){return this.mRenderer}},{key:"camera",get:function(){return this.mCamera}},{key:"scene",get:function(){return this.mScene}}]),n}(w);function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(se,"TypeRTTI",new k.r("MessageRender",w.TypeRTTI));var ce=function(e){(0,g.Z)(n,e);var t=ue(n);function n(e,r,i){var a;return(0,u.Z)(this,n),a=t.call(this),(0,l.Z)((0,_.Z)(a),"renderer",void 0),(0,l.Z)((0,_.Z)(a),"camera",void 0),(0,l.Z)((0,_.Z)(a),"scene",void 0),a.renderer=e,a.camera=r,a.scene=i,a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(ce,"TypeRTTI",new k.r("MessageRenderPosteffects",w.TypeRTTI));var he=function(e){(0,g.Z)(n,e);var t=le(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mRenderPool",void 0),(0,l.Z)((0,_.Z)(i),"mDeltaTime",void 0),i.mRenderPool=e,i.mDeltaTime=r,i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"renderPool",get:function(){return this.mRenderPool}},{key:"deltaTime",get:function(){return this.mDeltaTime}}]),n}(w);function fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(he,"TypeRTTI",new k.r("MessageSceneAfterDraw",w.TypeRTTI));var pe=function(e){(0,g.Z)(n,e);var t=fe(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(pe,"TypeRTTI",new k.r("MessageSceneDestroy",w.TypeRTTI));var de=function(e){(0,g.Z)(n,e);var t=me(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mRenderPool",void 0),(0,l.Z)((0,_.Z)(i),"mDeltaTime",void 0),i.mRenderPool=e,i.mDeltaTime=r,i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"renderPool",get:function(){return this.mRenderPool}},{key:"deltaTime",get:function(){return this.mDeltaTime}}]),n}(w);function ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(de,"TypeRTTI",new k.r("MessageSceneDraw",w.TypeRTTI));var ye=function(e){(0,g.Z)(n,e);var t=ve(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"delta",void 0),r.delta=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function ge(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(ye,"TypeRTTI",new k.r("MessageSceneFixedUpdate",w.TypeRTTI));var be=function(e){(0,g.Z)(n,e);var t=ge(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"parent",void 0),r.parent=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function Me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(be,"TypeRTTI",new k.r("MessageSceneObjectAttached",w.TypeRTTI));var ke,_e=function(e){(0,g.Z)(n,e);var t=Me(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"parent",void 0),r.parent=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(_e,"TypeRTTI",new k.r("MessageSceneObjectDetached",w.TypeRTTI)),function(e){e[e.Idle=0]="Idle",e[e.InProgress=1]="InProgress",e[e.Finished=2]="Finished"}(ke||(ke={}));var Te=function(e){(0,g.Z)(n,e);var t=xe(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"delta",void 0),(0,l.Z)((0,_.Z)(r),"processStatus",{}),r.delta=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"setProcessStatus",value:function(e,t){this.processStatus[e]=t}},{key:"getProcessStatus",value:function(e){return this.processStatus[e]}},{key:"clearProcessStatuses",value:function(){var e=this;Object.keys(this.processStatus).forEach((function(t){return delete e.processStatus[t]}))}},{key:"getProcessStatuses",value:function(){return this.processStatus}},{key:"isAnyProcessInProgress",value:function(){var e=this;return!!Object.keys(this.processStatus).find((function(t){return e.processStatus[t]===ke.InProgress}))}}]),n}(w);function we(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Te,"TypeRTTI",new k.r("MessageSceneUpdate",w.TypeRTTI));var Re=function(e){(0,g.Z)(n,e);var t=we(n);function n(e){var r,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"camId",void 0),(0,l.Z)((0,_.Z)(r),"animate",void 0),(0,l.Z)((0,_.Z)(r),"openView",void 0),r.camId=e,r.animate=i,r.openView=a,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function Ze(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Re,"TypeRTTI",new k.r("MessageSelectCameraId",w.TypeRTTI));var Se=function(e){(0,g.Z)(n,e);var t=Ze(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"viewId",void 0),r.viewId=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function Ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Se,"TypeRTTI",new k.r("MessageSelectViewId",w.TypeRTTI));var Ie=function(e){(0,g.Z)(n,e);var t=Ce(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"key",void 0),(0,l.Z)((0,_.Z)(i),"value",void 0),i.key=e,i.value=r,i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function Ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Ie,"TypeRTTI",new k.r("MessageSetValue",w.TypeRTTI));var Ae=function(e){(0,g.Z)(n,e);var t=Ee(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mWidth",void 0),(0,l.Z)((0,_.Z)(i),"mHeight",void 0),i.mWidth=e,i.mHeight=r,i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"width",get:function(){return this.mWidth}},{key:"height",get:function(){return this.mHeight}}]),n}(w);function Oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Ae,"TypeRTTI",new k.r("MessageSizechange",w.TypeRTTI));var De=function(e){(0,g.Z)(n,e);var t=Oe(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"reset",void 0),(0,l.Z)((0,_.Z)(i),"save",void 0),i.save=e,i.reset=r,i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function Pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(De,"TypeRTTI",new k.r("MessageStateControls",w.TypeRTTI));var Be=function(e){(0,g.Z)(n,e);var t=Pe(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"event",void 0),(0,l.Z)((0,_.Z)(i),"data",void 0),i.event=e,i.data=r,i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function Fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Be,"TypeRTTI",new k.r("MessageToolbarItemEvent",w.TypeRTTI));var Le=function(e){(0,g.Z)(n,e);var t=Fe(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mLocked",void 0),(0,l.Z)((0,_.Z)(i),"mChanged",void 0),i.mLocked=e,i.mChanged=r,i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"isTransformLocked",get:function(){return this.mLocked}},{key:"isTransformChanged",get:function(){return this.mChanged}}]),n}(w);function Ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Le,"TypeRTTI",new k.r("MessageTransformControls",w.TypeRTTI));var je=function(e){(0,g.Z)(n,e);var t=Ne(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mDelta",void 0),r.mDelta=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"delta",get:function(){return this.mDelta}}]),n}(w);(0,l.Z)(je,"TypeRTTI",new k.r("MessageViewupdate",w.TypeRTTI));var ze=__webpack_require__(666);function Ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ve=function(e){(0,g.Z)(n,e);var t=Ue(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ze.L.TypeRTTI;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"visible",void 0),(0,l.Z)((0,_.Z)(r),"object_type",void 0),r.visible=e,r.object_type=i,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);(0,l.Z)(Ve,"TypeRTTI",new k.r("MessageVisibility",w.TypeRTTI));__webpack_require__(5306);var He=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,null,[{key:"selectDom",value:function(e){return"string"==typeof e?(e=e.replace(/^\s*/,"").replace(/\s*$/,""),document.querySelector(e)):e&&e.nodeName?e:e&&e.length>0?e[0]:e}},{key:"createElement",value:function(e){return document.createElement(e)}},{key:"setStyle",value:function(e,t,n){if(e)return"string"==typeof t&&void 0!==n?e.style[t]=n:Object.keys(t).forEach((function(n){e.style[n]=t[n]})),e}},{key:"getStyle",value:function(e,t){return e.style[t]}},{key:"setAttribute",value:function(e,t,n){return e.setAttribute(t,n),e}},{key:"setHtml",value:function(e,t){return e.innerHTML=t||"",e}},{key:"emptyHtml",value:function(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}},{key:"append",value:function(e,t){return e.appendChild(t),t}},{key:"on",value:function(e,t,n){var r=function(e){return n.apply(this,[e].concat(e.detail||[]))};e.addEventListener(t,r),e._e=e._e||{},e._e[t]=e._e[t]||[],e._e[t].push(r)}},{key:"off",value:function(e,t){e._e=e._e||{},(e._e[t]?e._e[t]:[]).forEach((function(n){e.removeEventListener(t,n)})),e._e[t]=[]}}]),e}(),Ge=function(){function e(){(0,u.Z)(this,e)}var n,i;return(0,c.Z)(e,[{key:"save",value:(i=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){t("Version 1.0 is obsolete.")})));case 3:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"load",value:(n=t(r().mark((function e(t,n,i){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){if(!n)return t("undefined configurations");t("Version 1.0 is obsolete")})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})}]),e}(),qe=(__webpack_require__(4048),__webpack_require__(5454));function We(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}var Ye=We((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}})),Ke=function(e,t){return Ke=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Ke(e,t)};function Xe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Ke(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function $e(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function Qe(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}Object.create;function Je(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function et(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-->0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function tt(e,t,n){if(n||2===arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function nt(e){return this instanceof nt?(this.v=e,this):new nt(e)}function rt(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),a=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){a.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=i[e](t)).value instanceof nt?Promise.resolve(n.value.v).then(u,c):l(a[0][2],n)}catch(e){l(a[0][3],e)}var n}function u(e){s("next",e)}function c(e){s("throw",e)}function l(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}}function it(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Je(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}}Object.create;function at(e){return"function"==typeof e}var ot=We((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function st(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var ut=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=Je(a),s=o.next();!s.done;s=o.next()){s.value.remove(this)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else a.remove(this);var u=this.initialTeardown;if(at(u))try{u()}catch(e){i=e instanceof ot?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var l=Je(c),h=l.next();!h.done;h=l.next()){var f=h.value;try{ht(f)}catch(e){i=null!=i?i:[],e instanceof ot?i=tt(tt([],et(i)),et(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}if(i)throw new ot(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)ht(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&st(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&st(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),ct=ut.EMPTY;function lt(e){return e instanceof ut||e&&"closed"in e&&at(e.remove)&&at(e.add)&&at(e.unsubscribe)}function ht(e){at(e)?e():e.unsubscribe()}var ft={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},pt={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=pt.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,tt([e,t],et(n))):setTimeout.apply(void 0,tt([e,t],et(n)))},clearTimeout:function(e){var t=pt.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function mt(e){pt.setTimeout((function(){var t=ft.onUnhandledError;if(!t)throw e;t(e)}))}function dt(){}var vt=yt("C",void 0,void 0);function yt(e,t,n){return{kind:e,value:t,error:n}}var gt=null;function bt(e){if(ft.useDeprecatedSynchronousErrorHandling){var t=!gt;if(t&&(gt={errorThrown:!1,error:null}),e(),t){var n=gt,r=n.errorThrown,i=n.error;if(gt=null,r)throw i}}else e()}var Mt=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,lt(t)&&t.add(n)):n.destination=Zt,n}return Xe(t,e),t.create=function(e,t,n){return new Tt(e,t,n)},t.prototype.next=function(e){this.isStopped?Rt(function(e){return yt("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Rt(yt("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Rt(vt,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(ut),kt=Function.prototype.bind;function _t(e,t){return kt.call(e,t)}var xt=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){wt(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){wt(e)}else wt(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){wt(e)}},e}(),Tt=function(e){function t(t,n,r){var i,a,o=e.call(this)||this;at(t)||!t?i={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:o&&ft.useDeprecatedNextContext?((a=Object.create(t)).unsubscribe=function(){return o.unsubscribe()},i={next:t.next&&_t(t.next,a),error:t.error&&_t(t.error,a),complete:t.complete&&_t(t.complete,a)}):i=t;return o.destination=new xt(i),o}return Xe(t,e),t}(Mt);function wt(e){var t;ft.useDeprecatedSynchronousErrorHandling?(t=e,ft.useDeprecatedSynchronousErrorHandling&&gt&&(gt.errorThrown=!0,gt.error=t)):mt(e)}function Rt(e,t){var n=ft.onStoppedNotification;n&&pt.setTimeout((function(){return n(e,t)}))}var Zt={closed:!0,next:dt,error:function(e){throw e},complete:dt};function St(e,t){var n="object"==typeof t;return new Promise((function(r,i){var a=new Tt({next:function(e){r(e),a.unsubscribe()},error:i,complete:function(){n?r(t.defaultValue):i(new Ye)}});e.subscribe(a)}))}var Ct=function(){function e(){(0,u.Z)(this,e)}var n,i;return(0,c.Z)(e,[{key:"save",value:(i=t(r().mark((function e(t,n){var i,a,o,s,u,c,l,h,f=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=f.length>2&&void 0!==f[2]?f[2]:null,a=f.length>3?f[3]:void 0,o=t.getComponent("materialGroupManager"),e.next=5,St(o.resolveMaterialGroups());case 5:return s=e.sent,u={},s.getGroups().forEach((function(e){var t=s.getActiveRefId(e.id);Number.isNaN(t)||(u[e.id]=t)})),c=t.getComponent("attributeManager"),e.next=11,St(c.resolveAttributeManager());case 11:return l=e.sent,h=!!a&&a.include_keys,e.abrupt("return",{version:"2.0",catalogue_id:t.productId,configuration:{attributes:l.serialize({discard_hidden:!1,include_keys:h,calculate_approximations:!0}),materials:u},attributes:l.serialize({discard_hidden:!0,include_keys:h,calculate_approximations:!1}),thumbnail:i,articles:n});case 14:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"load",value:(n=t(r().mark((function e(t,n,i){var a,o,s,u,c=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}throw new Error("undefined configurations");case 2:return qe.qL.print("Previous configuration:",n),a=t.getComponent("attributeManager"),e.next=6,St(a.resolveAttributeManager());case 6:return o=e.sent,s=n.configuration.attributes,u=(u=s.length)<=0?1:u,e.abrupt("return",new Promise((function(e){c._setActiveOptions(o,s,(function(){e(!0)}),(function(e){if("function"==typeof i){var t=s.length/u;i(e*t)}}))})));case 11:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"_setActiveOptions",value:function(e,t,n,r){var i=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;arguments.length>5&&void 0!==arguments[5]||Date.now();if(a>=t.length)return n();try{var o=t[a],s=e.getAttributeController(o.attribute_id);s&&s.parse(o.attribute_value,{emitEvent:!0,rebuild:a===t.length-1})}catch(e){qe.qL.warn(e)}"function"==typeof r&&r((a+1)/t.length);var u=Date.now();window.setTimeout((function(){i._setActiveOptions(e,t,n,r,a+1,u)}),0)}}]),e}();__webpack_require__(2526),__webpack_require__(5003),__webpack_require__(9337);function It(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Et=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mOptions",void 0),this.mOptions=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?It(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):It(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({include_keys:!1},t)}var n,i;return(0,c.Z)(e,[{key:"save",value:(i=t(r().mark((function e(t,n,i,a){var o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=a,e.next="1.0"===e.t0?3:"2.0"===e.t0?5:7;break;case 3:return o=new Ge,e.abrupt("break",9);case 5:return o=new Ct,e.abrupt("break",9);case 7:qe.qL.print("Saving configuration with version '".concat(a,"'. Provided version: ").concat(a)),o=new Ct;case 9:return e.abrupt("return",o.save(t,n,i,this.mOptions));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"load",value:(n=t(r().mark((function e(t,n,i){var a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",new Promise((function(e,t){return t("undefined configurations")})));case 2:e.t0=n.version,e.next="1.0"===e.t0?5:"2.0"===e.t0?7:9;break;case 5:return a=new Ge,e.abrupt("break",11);case 7:return a=new Ct,e.abrupt("break",11);case 9:qe.qL.warn("Loading configuration with version '"+String(n.version)+"'. Unknown version: "+String(n.version)),a=new Ct;case 11:return e.abrupt("return",a.load(t,n,i));case 12:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})}]),e}(),At=Math.PI/180,Ot=180/Math.PI;function Dt(e,t,n){return Math.max(t,Math.min(n,e))}function Pt(e){return e*At}function Bt(e,t,n){return(1-n)*e+n*t}function Ft(e,t){return Math.abs(e-t)<1e-6}var Lt="function"==typeof Symbol&&Symbol.observable||"@@observable";function Nt(e){return e}function jt(e){return 0===e.length?Nt:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var zt=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,i=this,a=(r=e)&&r instanceof Mt||function(e){return e&&at(e.next)&&at(e.error)&&at(e.complete)}(r)&&lt(r)?e:new Tt(e,t,n);return bt((function(){var e=i,t=e.operator,n=e.source;a.add(t?t.call(a,n):n?i._subscribe(a):i._trySubscribe(a))})),a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Ut(t))((function(t,r){var i=new Tt({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Lt]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return jt(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Ut(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function Ut(e){var t;return null!==(t=null!=e?e:ft.Promise)&&void 0!==t?t:Promise}var Vt=We((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Ht=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Xe(t,e),t.prototype.lift=function(e){var t=new Gt(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Vt},t.prototype.next=function(e){var t=this;bt((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=Je(t.currentObservers),a=i.next();!a.done;a=i.next()){a.value.next(e)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;bt((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;bt((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,a=n.observers;return r||i?ct:(this.currentObservers=null,a.push(e),new ut((function(){t.currentObservers=null,st(a,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new zt;return e.source=this,e},t.create=function(e,t){return new Gt(e,t)},t}(zt),Gt=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return Xe(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:ct},t}(Ht);function qt(e){return function(t){if(function(e){return at(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Wt(e,t,n,r,i){return new Yt(e,t,n,r,i)}var Yt=function(e){function t(t,n,r,i,a,o){var s=e.call(this,t)||this;return s.onFinalize=a,s.shouldUnsubscribe=o,s._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return Xe(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Mt);function Kt(e,t,n){var r=at(e)||t||n?{next:e,error:t,complete:n}:e;return r?qt((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var i=!0;e.subscribe(Wt(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;i=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;i=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;i&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):Nt}function Xt(e,t){return qt((function(n,r){var i=0;n.subscribe(Wt(r,(function(n){return e.call(t,n,i++)&&r.next(n)})))}))}var $t=function(e){function t(t,n){return e.call(this)||this}return Xe(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(ut),Qt={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=Qt.delegate;return(null==i?void 0:i.setInterval)?i.setInterval.apply(i,tt([e,t],et(n))):setInterval.apply(void 0,tt([e,t],et(n)))},clearInterval:function(e){var t=Qt.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},Jt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return Xe(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),Qt.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&Qt.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,st(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}($t),en={now:function(){return(en.delegate||Date).now()},delegate:void 0},tn=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=en.now,e}(),nn=new(function(e){function t(t,n){void 0===n&&(n=tn.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return Xe(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(tn))(Jt),rn=nn;function an(e,t){return void 0===t&&(t=nn),qt((function(n,r){var i=null,a=null,o=null,s=function(){if(i){i.unsubscribe(),i=null;var e=a;a=null,r.next(e)}};function u(){var n=o+e,a=t.now();if(a<n)return i=this.schedule(void 0,n-a),void r.add(i);s()}n.subscribe(Wt(r,(function(n){a=n,o=t.now(),i||(i=t.schedule(u,e),r.add(i))}),(function(){s(),r.complete()}),void 0,(function(){a=i=null})))}))}var on=new zt((function(e){return e.complete()}));function sn(e){return e<=0?function(){return on}:qt((function(t,n){var r=0;t.subscribe(Wt(n,(function(t){++r<=e&&(n.next(t),e<=r&&n.complete())})))}))}__webpack_require__(9720);var un=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mStates",[])}return(0,c.Z)(e,[{key:"push",value:function(e){this.mStates.push(e)}},{key:"pop",value:function(){return this.mStates.pop()}},{key:"top",value:function(){if(0!==this.mStates.length)return this.mStates[this.mStates.length-1]}}]),e}(),cn=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mCollection",{})}return(0,c.Z)(e,[{key:"push",value:function(e){var t=e.getType();t in this.mCollection||(this.mCollection[t]=new un),this.mCollection[t].push(e)}},{key:"pop",value:function(e){if(e in this.mCollection)return this.mCollection[e].pop();qe.qL.error("can not push unregistered state of type: '".concat(e,"'"))}},{key:"_getCollection",value:function(){return this.mCollection}},{key:"currentStates",value:function(){return Object.entries(this.mCollection).map((function(e){var t=o(e,2);t[0];return t[1].top()})).filter((function(e){return void 0!==e}))}}]),e}(),ln=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mGlobalStateCollection",new cn),(0,l.Z)(this,"mSceneStateCollection",new cn),(0,l.Z)(this,"mDrawables",[]),(0,l.Z)(this,"mCameras",[]),(0,l.Z)(this,"mLights",[])}return(0,c.Z)(e,[{key:"checksum",get:function(){var e=this.mDrawables.map((function(e){return e.getObjectUUID()})).join(),t=this.mCameras.map((function(e){return e.getObjectUUID()})).join(),n=this.mLights.map((function(e){return e.getObjectUUID()})).join();return y.F.checksum(e+t+n)}},{key:"pushGlobalState",value:function(e){this.mGlobalStateCollection.push(e)}},{key:"popGlobalState",value:function(e){return this.mGlobalStateCollection.pop(e)}},{key:"getCurrentGlobalStates",value:function(){return this.mGlobalStateCollection.currentStates()}},{key:"_getGlobalStateCollection",value:function(){return this.mGlobalStateCollection}},{key:"pushSceneState",value:function(e){this.mSceneStateCollection.push(e)}},{key:"popSceneState",value:function(e){return this.mSceneStateCollection.pop(e)}},{key:"getCurrentSceneStates",value:function(){return this.mSceneStateCollection.currentStates()}},{key:"_getSceneStateCollection",value:function(){return this.mSceneStateCollection}},{key:"addLight",value:function(e){this.mLights.push(e)}},{key:"removeLight",value:function(e){this.removeObjectFromCollection(e,this.mLights)}},{key:"addCamera",value:function(e){this.mCameras.push(e)}},{key:"removeCamera",value:function(e){this.removeObjectFromCollection(e,this.mCameras)}},{key:"getCameras",value:function(){return this.mCameras}},{key:"getLights",value:function(){return this.mLights}},{key:"addDrawable",value:function(e){this.mDrawables.push(e)}},{key:"removeDrawable",value:function(e){this.removeObjectFromCollection(e,this.mDrawables)}},{key:"getDrawables",value:function(){return this.mDrawables}},{key:"drawablesNeedRenderUpdate",value:function(){return this.entitiesNeedRenderUpdate(this.getDrawables())}},{key:"lightsNeedRenderUpdate",value:function(){return this.entitiesNeedRenderUpdate(this.getLights())}},{key:"entitiesNeedRenderUpdate",value:function(e){return!e.every((function(e){return!e.needsRenderUpdate()}))}},{key:"removeObjectFromCollection",value:function(e,t){var n=t.findIndex((function(t){return t.getObjectUUID()===e.getObjectUUID()}));n<0||t.splice(n,1)}}]),e}(),hn=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mRenderEngine",void 0),this.mRenderEngine=t}return(0,c.Z)(e,[{key:"registerRenderTechnique",value:function(e,t){this.mRenderEngine.registerRenderTechnique(e,t)}},{key:"render",value:function(e){var t=new ln;P.sceneManager()._draw(t,e),this.mRenderEngine.render(t,e),P.sceneManager()._afterDraw(t,e)}},{key:"getRenderEngine",value:function(){return this.mRenderEngine}},{key:"dispose",value:function(){this.mRenderEngine.dispose()}}]),e}(),fn=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mUndos",void 0),(0,l.Z)(this,"mRedos",void 0),(0,l.Z)(this,"mLastCommandTime",void 0),(0,l.Z)(this,"mStackDisabled",!1),(0,l.Z)(this,"mCommandIdCount",0),(0,l.Z)(this,"onHistoryChanged",new Ht),this.mUndos=new Array,this.mRedos=new Array,this.mLastCommandTime=new Date}return(0,c.Z)(e,[{key:"disableStack",value:function(){this.mStackDisabled=!0}},{key:"enableStack",value:function(){this.mStackDisabled=!1}},{key:"isEnabled",value:function(){return!1===this.mStackDisabled}},{key:"undoSize",value:function(){return this.mUndos.length}},{key:"redoSize",value:function(){return this.mRedos.length}},{key:"execute",value:function(e,t){var n=e,r=this.mUndos.length>0?this.mUndos[this.mUndos.length-1]:null,i=(new Date).getTime()-this.mLastCommandTime.getTime();r&&r.isUpdatable()&&r.overridesCommand(n)&&i<500?(r.update(n),n=r):(this.mUndos.push(n),n._setCommandId(++this.mCommandIdCount)),n.setCommandName((0,p.isNullOrUndefined)(t)?n.getCommandName():t),n.execute(),this.mLastCommandTime=new Date,this.mRedos.splice(0,this.mRedos.length),this.onHistoryChanged.next(n)}},{key:"undo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.mStackDisabled){var t=this.mUndos.pop();return(0,p.isUndefined)(t)||(t.undo(),this.mRedos.push(t),e&&this.onHistoryChanged.next(t)),t}qe.qL.print("exec stack disabled")}},{key:"redo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.mStackDisabled){var t=this.mRedos.pop();return(0,p.isUndefined)(t)||(t.execute(),this.mUndos.push(t),e&&this.onHistoryChanged.next(t)),t}qe.qL.print("exec stack disabled")}},{key:"clear",value:function(){this.mUndos.splice(0,this.mUndos.length),this.mRedos.splice(0,this.mRedos.length),this.mCommandIdCount=0,this.onHistoryChanged.unsubscribe()}},{key:"goToState",value:function(e){if(this.mStackDisabled)qe.qL.print("exec stack disabled");else{var t=this.mUndos.length>0?this.mUndos[this.mUndos.length-1]:null;if(!t||e>t.getCommandId())for(t=this.redo(!1);t&&e>t.getCommandId();)t=this.redo(!1);else for(;t=this.mUndos[this.mUndos.length-1],!(0,p.isUndefined)(t)&&e!==t.getCommandId();)t=this.undo(!1);this.onHistoryChanged.next(t)}}}]),e}(),pn=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mExecStack",void 0),this.mExecStack=new fn}return(0,c.Z)(e,[{key:"execute",value:function(e,t){this.mExecStack.execute(e,t)}},{key:"undo",value:function(){return this.mExecStack.undo()}},{key:"redo",value:function(){return this.mExecStack.redo()}},{key:"dispose",value:function(){this.mExecStack.clear()}},{key:"getExecStack",value:function(){return this.mExecStack}}]),e}();function mn(e,t){return function(){return e.apply(t,arguments)}}const{toString:dn}=Object.prototype,{getPrototypeOf:vn}=Object,yn=(gn=Object.create(null),e=>{const t=dn.call(e);return gn[t]||(gn[t]=t.slice(8,-1).toLowerCase())});var gn;const bn=e=>(e=e.toLowerCase(),t=>yn(t)===e),Mn=e=>t=>typeof t===e,{isArray:kn}=Array,_n=Mn("undefined");const xn=bn("ArrayBuffer");const Tn=Mn("string"),wn=Mn("function"),Rn=Mn("number"),Zn=e=>null!==e&&"object"==typeof e,Sn=e=>{if("object"!==yn(e))return!1;const t=vn(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},Cn=bn("Date"),In=bn("File"),En=bn("Blob"),An=bn("FileList"),On=bn("URLSearchParams");function Dn(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let r,i;if("object"!=typeof e&&(e=[e]),kn(e))for(r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else{const i=n?Object.getOwnPropertyNames(e):Object.keys(e),a=i.length;let o;for(r=0;r<a;r++)o=i[r],t.call(null,e[o],o,e)}}function Pn(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-->0;)if(r=n[i],t===r.toLowerCase())return r;return null}const Bn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Fn=e=>!_n(e)&&e!==Bn;const Ln=(Nn="undefined"!=typeof Uint8Array&&vn(Uint8Array),e=>Nn&&e instanceof Nn);var Nn;const jn=bn("HTMLFormElement"),zn=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),Un=bn("RegExp"),Vn=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};Dn(n,((n,i)=>{!1!==t(n,i,e)&&(r[i]=n)})),Object.defineProperties(e,r)},Hn="abcdefghijklmnopqrstuvwxyz",Gn="0123456789",qn={DIGIT:Gn,ALPHA:Hn,ALPHA_DIGIT:Hn+Hn.toUpperCase()+Gn};var Wn={isArray:kn,isArrayBuffer:xn,isBuffer:function(e){return null!==e&&!_n(e)&&null!==e.constructor&&!_n(e.constructor)&&wn(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{const t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||dn.call(e)===t||wn(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&xn(e.buffer),t},isString:Tn,isNumber:Rn,isBoolean:e=>!0===e||!1===e,isObject:Zn,isPlainObject:Sn,isUndefined:_n,isDate:Cn,isFile:In,isBlob:En,isRegExp:Un,isFunction:wn,isStream:e=>Zn(e)&&wn(e.pipe),isURLSearchParams:On,isTypedArray:Ln,isFileList:An,forEach:Dn,merge:function e(){const{caseless:t}=Fn(this)&&this||{},n={},r=(r,i)=>{const a=t&&Pn(n,i)||i;Sn(n[a])&&Sn(r)?n[a]=e(n[a],r):Sn(r)?n[a]=e({},r):kn(r)?n[a]=r.slice():n[a]=r};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&Dn(arguments[e],r);return n},extend:(e,t,n,{allOwnKeys:r}={})=>(Dn(t,((t,r)=>{n&&wn(t)?e[r]=mn(t,n):e[r]=t}),{allOwnKeys:r}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,a,o;const s={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),a=i.length;a-->0;)o=i[a],r&&!r(o,e,t)||s[o]||(t[o]=e[o],s[o]=!0);e=!1!==n&&vn(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:yn,kindOfTest:bn,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(kn(e))return e;let t=e.length;if(!Rn(t))return null;const n=new Array(t);for(;t-->0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:jn,hasOwnProperty:zn,hasOwnProp:zn,reduceDescriptors:Vn,freezeMethods:e=>{Vn(e,((t,n)=>{if(wn(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];wn(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return kn(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:Pn,global:Bn,isContextDefined:Fn,ALPHABET:qn,generateString:(e=16,t=qn.ALPHA_DIGIT)=>{let n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&wn(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(Zn(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const i=kn(e)?[]:{};return Dn(e,((e,t)=>{const a=n(e,r+1);!_n(a)&&(i[t]=a)})),t[r]=void 0,i}}return e};return n(e,0)}};function Yn(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}Wn.inherits(Yn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Wn.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Kn=Yn.prototype,Xn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{Xn[e]={value:e}})),Object.defineProperties(Yn,Xn),Object.defineProperty(Kn,"isAxiosError",{value:!0}),Yn.from=(e,t,n,r,i,a)=>{const o=Object.create(Kn);return Wn.toFlatObject(e,o,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),Yn.call(o,e.message,t,n,r,i),o.cause=e,o.name=e.name,a&&Object.assign(o,a),o};var $n=Yn,Qn=null;function Jn(e){return Wn.isPlainObject(e)||Wn.isArray(e)}function er(e){return Wn.endsWith(e,"[]")?e.slice(0,-2):e}function tr(e,t,n){return e?e.concat(t).map((function(e,t){return e=er(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}const nr=Wn.toFlatObject(Wn,{},null,(function(e){return/^is[A-Z]/.test(e)}));var rr=function(e,t,n){if(!Wn.isObject(e))throw new TypeError("target must be an object");t=t||new(Qn||FormData);const r=(n=Wn.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!Wn.isUndefined(t[e])}))).metaTokens,i=n.visitor||c,a=n.dots,o=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&Wn.isSpecCompliantForm(t);if(!Wn.isFunction(i))throw new TypeError("visitor must be a function");function u(e){if(null===e)return"";if(Wn.isDate(e))return e.toISOString();if(!s&&Wn.isBlob(e))throw new $n("Blob is not supported. Use a Buffer instead.");return Wn.isArrayBuffer(e)||Wn.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,n,i){let s=e;if(e&&!i&&"object"==typeof e)if(Wn.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(Wn.isArray(e)&&function(e){return Wn.isArray(e)&&!e.some(Jn)}(e)||(Wn.isFileList(e)||Wn.endsWith(n,"[]"))&&(s=Wn.toArray(e)))return n=er(n),s.forEach((function(e,r){!Wn.isUndefined(e)&&null!==e&&t.append(!0===o?tr([n],r,a):null===o?n:n+"[]",u(e))})),!1;return!!Jn(e)||(t.append(tr(i,n,a),u(e)),!1)}const l=[],h=Object.assign(nr,{defaultVisitor:c,convertValue:u,isVisitable:Jn});if(!Wn.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!Wn.isUndefined(n)){if(-1!==l.indexOf(n))throw Error("Circular reference detected in "+r.join("."));l.push(n),Wn.forEach(n,(function(n,a){!0===(!(Wn.isUndefined(n)||null===n)&&i.call(t,n,Wn.isString(a)?a.trim():a,r,h))&&e(n,r?r.concat(a):[a])})),l.pop()}}(e),t};function ir(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function ar(e,t){this._pairs=[],e&&rr(e,this,t)}const or=ar.prototype;or.append=function(e,t){this._pairs.push([e,t])},or.toString=function(e){const t=e?function(t){return e.call(this,t,ir)}:ir;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var sr=ar;function ur(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function cr(e,t,n){if(!t)return e;const r=n&&n.encode||ur,i=n&&n.serialize;let a;if(a=i?i(t,n):Wn.isURLSearchParams(t)?t.toString():new sr(t,n).toString(r),a){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}var lr=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Wn.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},hr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};var fr={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:sr,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},isStandardBrowserEnv:(()=>{let e;return("undefined"==typeof navigator||"ReactNative"!==(e=navigator.product)&&"NativeScript"!==e&&"NS"!==e)&&("undefined"!=typeof window&&"undefined"!=typeof document)})(),isStandardBrowserWebWorkerEnv:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,protocols:["http","https","file","blob","url","data"]};var pr=function(e){function t(e,n,r,i){let a=e[i++];const o=Number.isFinite(+a),s=i>=e.length;if(a=!a&&Wn.isArray(r)?r.length:a,s)return Wn.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!o;r[a]&&Wn.isObject(r[a])||(r[a]=[]);return t(e,n,r[a],i)&&Wn.isArray(r[a])&&(r[a]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let a;for(r=0;r<i;r++)a=n[r],t[a]=e[a];return t}(r[a])),!o}if(Wn.isFormData(e)&&Wn.isFunction(e.entries)){const n={};return Wn.forEachEntry(e,((e,r)=>{t(function(e){return Wn.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null};const mr={"Content-Type":void 0};const dr={transitional:hr,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=Wn.isObject(e);i&&Wn.isHTMLForm(e)&&(e=new FormData(e));if(Wn.isFormData(e))return r&&r?JSON.stringify(pr(e)):e;if(Wn.isArrayBuffer(e)||Wn.isBuffer(e)||Wn.isStream(e)||Wn.isFile(e)||Wn.isBlob(e))return e;if(Wn.isArrayBufferView(e))return e.buffer;if(Wn.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return rr(e,new fr.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return fr.isNode&&Wn.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((a=Wn.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return rr(a?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e,t,n){if(Wn.isString(e))try{return(t||JSON.parse)(e),Wn.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||dr.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&Wn.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw $n.from(e,$n.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:fr.classes.FormData,Blob:fr.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Wn.forEach(["delete","get","head"],(function(e){dr.headers[e]={}})),Wn.forEach(["post","put","patch"],(function(e){dr.headers[e]=Wn.merge(mr)}));var vr=dr;const yr=Wn.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]);const gr=Symbol("internals");function br(e){return e&&String(e).trim().toLowerCase()}function Mr(e){return!1===e||null==e?e:Wn.isArray(e)?e.map(Mr):String(e)}function kr(e,t,n,r,i){return Wn.isFunction(r)?r.call(this,t,n):(i&&(t=n),Wn.isString(t)?Wn.isString(r)?-1!==t.indexOf(r):Wn.isRegExp(r)?r.test(t):void 0:void 0)}class _r{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=br(t);if(!i)throw new Error("header name must be a non-empty string");const a=Wn.findKey(r,i);(!a||void 0===r[a]||!0===n||void 0===n&&!1!==r[a])&&(r[a||t]=Mr(e))}const a=(e,t)=>Wn.forEach(e,((e,n)=>i(e,n,t)));return Wn.isPlainObject(e)||e instanceof this.constructor?a(e,t):Wn.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim())?a((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach((function(e){i=e.indexOf(":"),n=e.substring(0,i).trim().toLowerCase(),r=e.substring(i+1).trim(),!n||t[n]&&yr[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t):null!=e&&i(t,e,n),this}get(e,t){if(e=br(e)){const n=Wn.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(Wn.isFunction(t))return t.call(this,e,n);if(Wn.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=br(e)){const n=Wn.findKey(this,e);return!(!n||void 0===this[n]||t&&!kr(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=br(e)){const i=Wn.findKey(n,e);!i||t&&!kr(0,n[i],i,t)||(delete n[i],r=!0)}}return Wn.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!kr(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return Wn.forEach(this,((r,i)=>{const a=Wn.findKey(n,i);if(a)return t[a]=Mr(r),void delete t[i];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(i):String(i).trim();o!==i&&delete t[i],t[o]=Mr(r),n[o]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Wn.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&Wn.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach((e=>n.set(e))),n}static accessor(e){const t=(this[gr]=this[gr]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=br(e);t[r]||(!function(e,t){const n=Wn.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})}))}(n,e),t[r]=!0)}return Wn.isArray(e)?e.forEach(r):r(e),this}}_r.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Wn.freezeMethods(_r.prototype),Wn.freezeMethods(_r);var xr=_r;function Tr(e,t){const n=this||vr,r=t||n,i=xr.from(r.headers);let a=r.data;return Wn.forEach(e,(function(e){a=e.call(n,a,i.normalize(),t?t.status:void 0)})),i.normalize(),a}function wr(e){return!(!e||!e.__CANCEL__)}function Rr(e,t,n){$n.call(this,null==e?"canceled":e,$n.ERR_CANCELED,t,n),this.name="CanceledError"}Wn.inherits(Rr,$n,{__CANCEL__:!0});var Zr=Rr;var Sr=fr.isStandardBrowserEnv?{write:function(e,t,n,r,i,a){const o=[];o.push(e+"="+encodeURIComponent(t)),Wn.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),Wn.isString(r)&&o.push("path="+r),Wn.isString(i)&&o.push("domain="+i),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function Cr(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}var Ir=fr.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function r(n){let r=n;return e&&(t.setAttribute("href",r),r=t.href),t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(e){const t=Wn.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};var Er=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,a=0,o=0;return t=void 0!==t?t:1e3,function(s){const u=Date.now(),c=r[o];i||(i=u),n[a]=s,r[a]=u;let l=o,h=0;for(;l!==a;)h+=n[l++],l%=e;if(a=(a+1)%e,a===o&&(o=(o+1)%e),u-i<t)return;const f=c&&u-c;return f?Math.round(1e3*h/f):void 0}};function Ar(e,t){let n=0;const r=Er(50,250);return i=>{const a=i.loaded,o=i.lengthComputable?i.total:void 0,s=a-n,u=r(s);n=a;const c={loaded:a,total:o,progress:o?a/o:void 0,bytes:s,rate:u||void 0,estimated:u&&o&&a<=o?(o-a)/u:void 0,event:i};c[t?"download":"upload"]=!0,e(c)}}var Or="undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){let r=e.data;const i=xr.from(e.headers).normalize(),a=e.responseType;let o;function s(){e.cancelToken&&e.cancelToken.unsubscribe(o),e.signal&&e.signal.removeEventListener("abort",o)}Wn.isFormData(r)&&(fr.isStandardBrowserEnv||fr.isStandardBrowserWebWorkerEnv)&&i.setContentType(!1);let u=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";i.set("Authorization","Basic "+btoa(t+":"+n))}const c=Cr(e.baseURL,e.url);function l(){if(!u)return;const r=xr.from("getAllResponseHeaders"in u&&u.getAllResponseHeaders());!function(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new $n("Request failed with status code "+n.status,[$n.ERR_BAD_REQUEST,$n.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}((function(e){t(e),s()}),(function(e){n(e),s()}),{data:a&&"text"!==a&&"json"!==a?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:r,config:e,request:u}),u=null}if(u.open(e.method.toUpperCase(),cr(c,e.params,e.paramsSerializer),!0),u.timeout=e.timeout,"onloadend"in u?u.onloadend=l:u.onreadystatechange=function(){u&&4===u.readyState&&(0!==u.status||u.responseURL&&0===u.responseURL.indexOf("file:"))&&setTimeout(l)},u.onabort=function(){u&&(n(new $n("Request aborted",$n.ECONNABORTED,e,u)),u=null)},u.onerror=function(){n(new $n("Network Error",$n.ERR_NETWORK,e,u)),u=null},u.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const r=e.transitional||hr;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new $n(t,r.clarifyTimeoutError?$n.ETIMEDOUT:$n.ECONNABORTED,e,u)),u=null},fr.isStandardBrowserEnv){const t=(e.withCredentials||Ir(c))&&e.xsrfCookieName&&Sr.read(e.xsrfCookieName);t&&i.set(e.xsrfHeaderName,t)}void 0===r&&i.setContentType(null),"setRequestHeader"in u&&Wn.forEach(i.toJSON(),(function(e,t){u.setRequestHeader(t,e)})),Wn.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),a&&"json"!==a&&(u.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&u.addEventListener("progress",Ar(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&u.upload&&u.upload.addEventListener("progress",Ar(e.onUploadProgress)),(e.cancelToken||e.signal)&&(o=t=>{u&&(n(!t||t.type?new Zr(null,e,u):t),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(o),e.signal&&(e.signal.aborted?o():e.signal.addEventListener("abort",o)));const h=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(c);h&&-1===fr.protocols.indexOf(h)?n(new $n("Unsupported protocol "+h+":",$n.ERR_BAD_REQUEST,e)):u.send(r||null)}))};const Dr={http:Qn,xhr:Or};Wn.forEach(Dr,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));var Pr=e=>{e=Wn.isArray(e)?e:[e];const{length:t}=e;let n,r;for(let i=0;i<t&&(n=e[i],!(r=Wn.isString(n)?Dr[n.toLowerCase()]:n));i++);if(!r){if(!1===r)throw new $n(`Adapter ${n} is not supported by the environment`,"ERR_NOT_SUPPORT");throw new Error(Wn.hasOwnProp(Dr,n)?`Adapter '${n}' is not available in the build`:`Unknown adapter '${n}'`)}if(!Wn.isFunction(r))throw new TypeError("adapter is not a function");return r};function Br(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Zr(null,e)}function Fr(e){Br(e),e.headers=xr.from(e.headers),e.data=Tr.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return Pr(e.adapter||vr.adapter)(e).then((function(t){return Br(e),t.data=Tr.call(e,e.transformResponse,t),t.headers=xr.from(t.headers),t}),(function(t){return wr(t)||(Br(e),t&&t.response&&(t.response.data=Tr.call(e,e.transformResponse,t.response),t.response.headers=xr.from(t.response.headers))),Promise.reject(t)}))}const Lr=e=>e instanceof xr?e.toJSON():e;function Nr(e,t){t=t||{};const n={};function r(e,t,n){return Wn.isPlainObject(e)&&Wn.isPlainObject(t)?Wn.merge.call({caseless:n},e,t):Wn.isPlainObject(t)?Wn.merge({},t):Wn.isArray(t)?t.slice():t}function i(e,t,n){return Wn.isUndefined(t)?Wn.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function a(e,t){if(!Wn.isUndefined(t))return r(void 0,t)}function o(e,t){return Wn.isUndefined(t)?Wn.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,i,a){return a in t?r(n,i):a in e?r(void 0,n):void 0}const u={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(e,t)=>i(Lr(e),Lr(t),!0)};return Wn.forEach(Object.keys(e).concat(Object.keys(t)),(function(r){const a=u[r]||i,o=a(e[r],t[r],r);Wn.isUndefined(o)&&a!==s||(n[r]=o)})),n}const jr="1.3.5",zr={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{zr[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const Ur={};zr.transitional=function(e,t,n){function r(e,t){return"[Axios v1.3.5] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,a)=>{if(!1===e)throw new $n(r(i," has been removed"+(t?" in "+t:"")),$n.ERR_DEPRECATED);return t&&!Ur[i]&&(Ur[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,a)}};var Vr={assertOptions:function(e,t,n){if("object"!=typeof e)throw new $n("options must be an object",$n.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-->0;){const a=r[i],o=t[a];if(o){const t=e[a],n=void 0===t||o(t,a,e);if(!0!==n)throw new $n("option "+a+" must be "+n,$n.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new $n("Unknown option "+a,$n.ERR_BAD_OPTION)}},validators:zr};const Hr=Vr.validators;class Gr{constructor(e){this.defaults=e,this.interceptors={request:new lr,response:new lr}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Nr(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;let a;void 0!==n&&Vr.assertOptions(n,{silentJSONParsing:Hr.transitional(Hr.boolean),forcedJSONParsing:Hr.transitional(Hr.boolean),clarifyTimeoutError:Hr.transitional(Hr.boolean)},!1),null!=r&&(Wn.isFunction(r)?t.paramsSerializer={serialize:r}:Vr.assertOptions(r,{encode:Hr.function,serialize:Hr.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase(),a=i&&Wn.merge(i.common,i[t.method]),a&&Wn.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete i[e]})),t.headers=xr.concat(a,i);const o=[];let s=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,o.unshift(e.fulfilled,e.rejected))}));const u=[];let c;this.interceptors.response.forEach((function(e){u.push(e.fulfilled,e.rejected)}));let l,h=0;if(!s){const e=[Fr.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,u),l=e.length,c=Promise.resolve(t);h<l;)c=c.then(e[h++],e[h++]);return c}l=o.length;let f=t;for(h=0;h<l;){const e=o[h++],t=o[h++];try{f=e(f)}catch(e){t.call(this,e);break}}try{c=Fr.call(this,f)}catch(e){return Promise.reject(e)}for(h=0,l=u.length;h<l;)c=c.then(u[h++],u[h++]);return c}getUri(e){return cr(Cr((e=Nr(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}Wn.forEach(["delete","get","head","options"],(function(e){Gr.prototype[e]=function(t,n){return this.request(Nr(n||{},{method:e,url:t,data:(n||{}).data}))}})),Wn.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(Nr(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Gr.prototype[e]=t(),Gr.prototype[e+"Form"]=t(!0)}));var qr=Gr;class Wr{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-->0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,i){n.reason||(n.reason=new Zr(e,r,i),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new Wr((function(t){e=t})),cancel:e}}}var Yr=Wr;const Kr={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Kr).forEach((([e,t])=>{Kr[t]=e}));var Xr=Kr;const $r=function e(t){const n=new qr(t),r=mn(qr.prototype.request,n);return Wn.extend(r,qr.prototype,n,{allOwnKeys:!0}),Wn.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(Nr(t,n))},r}(vr);$r.Axios=qr,$r.CanceledError=Zr,$r.CancelToken=Yr,$r.isCancel=wr,$r.VERSION=jr,$r.toFormData=rr,$r.AxiosError=$n,$r.Cancel=$r.CanceledError,$r.all=function(e){return Promise.all(e)},$r.spread=function(e){return function(t){return e.apply(null,t)}},$r.isAxiosError=function(e){return Wn.isObject(e)&&!0===e.isAxiosError},$r.mergeConfig=Nr,$r.AxiosHeaders=xr,$r.formToJSON=e=>pr(Wn.isHTMLForm(e)?new FormData(e):e),$r.HttpStatusCode=Xr,$r.default=$r;var Qr=$r,Jr=__webpack_require__(7867),ei=function(){function e(){var n=this,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(0,u.Z)(this,e),(0,l.Z)(this,"tokenChanged",new Ht),(0,l.Z)(this,"refreshTokenChanged",new Ht),(0,l.Z)(this,"mAxiosInstance",void 0),(0,l.Z)(this,"isRefreshing",!1),(0,l.Z)(this,"mRefreshSubscribers",[]),(0,l.Z)(this,"mToken",null),(0,l.Z)(this,"mRefreshToken",null),(0,l.Z)(this,"mAcceptLanguage",void 0),(0,l.Z)(this,"mCountry",void 0),this.mAxiosInstance=Qr.create({baseURL:Jr.E.apiUrl}),i||this.mAxiosInstance.interceptors.response.use((function(e){return e}),function(){var e=t(r().mark((function e(t){var i,a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i="-1",t&&t.response&&t.response.status&&(i=t.response.status),a=t.config,qe.qL.warn("httpservice rejected"),null===n.mRefreshToken||"401"!=i&&"403"!=i){e.next=10;break}return n.isRefreshing||n._refreshAccessToken().then((function(e){qe.qL.print("token refreshed: ",e)}),(function(e){qe.qL.print("Failed to refresh token: ",e)})),o=new Promise((function(e,t){n._subscribeTokenRefresh((function(t){a.headers.Authorization="Bearer "+t,e(Qr(a))}),(function(e){t(e)}))})),e.abrupt("return",o);case 10:return e.abrupt("return",Promise.reject(t));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}var n,i,a,o,s,h;return(0,c.Z)(e,[{key:"getHttpInstance",value:function(){return this.mAxiosInstance}},{key:"_refreshAccessToken",value:(h=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.isRefreshing=!0,e.abrupt("return",new Promise((function(e,n){if(!t.mRefreshToken)return t.isRefreshing=!1,t._onFailedRefresh("Missing refresh token"),n("Not logged in");var r=t.mRefreshToken;Qr({method:"post",url:Jr.E.authUrl,data:{grant_type:"refresh_token",refresh_token:r,scope:"read-write"}}).then((function(n){t.isRefreshing=!1;var r=n.data;t.setToken(r.access_token),t.mRefreshToken=r.refresh_token,t.tokenChanged.next(t.mToken),t.refreshTokenChanged.next(t.mRefreshToken),t._onRrefreshed(r.access_token),e(r.access_token)}),(function(e){t.isRefreshing=!1,t._onFailedRefresh(e),n(e)}))})));case 2:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"_subscribeTokenRefresh",value:function(e,t){this.mRefreshSubscribers.push({resolve:e,reject:t})}},{key:"_onRrefreshed",value:function(e){this.mRefreshSubscribers.splice(0,this.mRefreshSubscribers.length).map((function(t){t.resolve(e)}))}},{key:"_onFailedRefresh",value:function(e){this.mRefreshSubscribers.splice(0,this.mRefreshSubscribers.length).map((function(t){!(0,p.isNullOrUndefined)(t.reject)&&(0,p.isFunction)(t.reject)&&t.reject(e)}))}},{key:"setToken",value:function(e){this.mToken=e,this.mAxiosInstance.defaults.headers.common.Authorization="Bearer "+e}},{key:"setRefreshToken",value:function(e){this.mRefreshToken=e}},{key:"getAcceptLanguage",value:function(){return this.mAcceptLanguage}},{key:"getCountry",value:function(){return this.mCountry}},{key:"setAcceptLanguage",value:function(e){!(0,p.isNullOrUndefined)(e)&&/^[a-zA-Z]{2}(-[A-Z]{2})?$/.test(e)&&(this.mAcceptLanguage=e,this.mAxiosInstance.defaults.headers.common["Accept-Language"]=this.mAcceptLanguage,qe.qL.print("language changed to "+this.mAcceptLanguage))}},{key:"setCountry",value:function(e){(0,p.isNullOrUndefined)(e)||2!==e.length?(0,p.isNullOrUndefined)(e)||2===e.length||qe.qL.warn("Can not set country code. Invalid code provided:",e):(this.mCountry=e,this.mAxiosInstance.defaults.headers.common["Locale-Country"]=this.mCountry,qe.qL.print("country changed to "+this.mCountry))}},{key:"get",value:function(){var e=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mAxiosInstance.get(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"delete",value:(s=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mAxiosInstance.delete(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"post",value:(o=t(r().mark((function e(t,n,i){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mAxiosInstance.post(t,n,i));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"put",value:(a=t(r().mark((function e(t,n,i){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mAxiosInstance.put(t,n,i));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"patch",value:(i=t(r().mark((function e(t,n,i){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mAxiosInstance.patch(t,n,i));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"head",value:(n=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mAxiosInstance.head(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}],[{key:"getInstance",value:function(){return null===this._instance&&(this._instance=new this(!1)),this._instance}},{key:"uniqueInstance",value:function(){return new this(!0)}}]),e}();(0,l.Z)(ei,"_instance",null);var ti,ni=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=en);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=n,i._timestampProvider=r,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=n===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,n),i}return Xe(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,i=n._buffer,a=n._infiniteTimeWindow,o=n._timestampProvider,s=n._windowTime;r||(i.push(t),!a&&i.push(o.now()+s)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),i=0;i<r.length&&!e.closed;i+=n?1:2)e.next(r[i]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,i=e._infiniteTimeWindow,a=(i?1:2)*t;if(t<1/0&&a<r.length&&r.splice(0,r.length-a),!i){for(var o=n.now(),s=0,u=1;u<r.length&&r[u]<=o;u+=2)s=u;s&&r.splice(0,s+1)}},t}(Ht);__webpack_require__(8309),__webpack_require__(1038),__webpack_require__(1817),__webpack_require__(2165);!function(e){e[e.Desktop=0]="Desktop",e[e.Mobile=1]="Mobile"}(ti||(ti={}));var ri=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mSettings",void 0),this.mSettings=t}return(0,c.Z)(e,[{key:"shadow",get:function(){return this.mSettings.shadow_mob}},{key:"lod",get:function(){return this.mSettings.lod_mob}},{key:"compression",get:function(){return this.mSettings.compression_mob}},{key:"anti_aliasing",get:function(){return"1"==this.mSettings.aliasing_mob}},{key:"alpha",get:function(){return"1"==this.mSettings.alpha}},{key:"clear_color",get:function(){return this.mSettings.clear_color}},{key:"esd_scene_scale",get:function(){return this.mSettings.esd_scene_scale}}]),e}(),ii=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mSettings",void 0),this.mSettings=t}return(0,c.Z)(e,[{key:"shadow",get:function(){return this.mSettings.shadow_desk}},{key:"lod",get:function(){return this.mSettings.lod_desk}},{key:"compression",get:function(){return this.mSettings.compression_desk}},{key:"anti_aliasing",get:function(){return"1"==this.mSettings.aliasing_desk}},{key:"alpha",get:function(){return"1"==this.mSettings.alpha}},{key:"clear_color",get:function(){return this.mSettings.clear_color}},{key:"esd_scene_scale",get:function(){return this.mSettings.esd_scene_scale}}]),e}();function ai(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return oi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return oi(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function oi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var si=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mCatalogueMeta",void 0),this.mCatalogueMeta=(0,p.isNullOrUndefined)(t)?null:t}return(0,c.Z)(e,[{key:"withCatalogueSettings",value:function(e){return this.mCatalogueMeta=e.getCatalogueMeta(),this}},{key:"withSceneSettings",value:function(e){return this.mCatalogueMeta=this.mCatalogueMeta||{},this.mCatalogueMeta.scene_settings=this.validateSettings(e),this}},{key:"withCatalogueMeta",value:function(e){return this.mCatalogueMeta=this.mCatalogueMeta||{},this.mCatalogueMeta=Object.assign(this.mCatalogueMeta,e),this}},{key:"validateSettings",value:function(e){var t=!(0,p.isNullOrUndefined)(e)&&Object.keys(e).length>0&&!(0,p.isArray)(e)&&!("string"==typeof e||e instanceof String);return Object.assign(Object.assign({shadow_desk:"3",shadow_mob:"2",lod_desk:"0",lod_mob:"1",compression_desk:"1",compression_mob:"1",aliasing_desk:"1",aliasing_mob:"1",alpha:"0",clear_color:2147483647,esd_scene_scale:1,physics:{enabled:!1},renderer_type:"threejs"},t?e:{}))}},{key:"getCatalogueMeta",value:function(){return this.mCatalogueMeta||{}}},{key:"isModuleEnabled",value:function(e){var t;return!(0,p.isNullOrUndefined)(this.mCatalogueMeta)&&!(0,p.isNullOrUndefined)(this.mCatalogueMeta.modules)&&!0===(null===(t=this.mCatalogueMeta.modules)||void 0===t?void 0:t[e])}},{key:"getModuleSettings",value:function(e){return this.mCatalogueMeta&&this.mCatalogueMeta.module_settings&&this.mCatalogueMeta.module_settings[e]?this.mCatalogueMeta.module_settings[e]:{}}},{key:"getSubModuleSettings",value:function(e,t){if(!(this.mCatalogueMeta&&this.mCatalogueMeta.module_settings&&this.mCatalogueMeta.module_settings[e]))return{};var n=this.mCatalogueMeta.module_settings[e];if(!Array.isArray(n))return{};var r,i=ai(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.scope==t)return a}}catch(e){i.e(e)}finally{i.f()}return{}}},{key:"getProductPresentationSettings",value:function(){return this.getCatalogueMeta().product_presentation}},{key:"getSceneDeviceSettings",value:function(e){return e===ti.Mobile?new ri(this.getSceneSettings()):new ii(this.getSceneSettings())}},{key:"getSceneSettings",value:function(){var e=(0,p.isNullOrUndefined)(this.mCatalogueMeta)?null:this.mCatalogueMeta.scene_settings;return this.validateSettings(e)}},{key:"getSceneRevId",value:function(){if((0,p.isNullOrUndefined)(this.mCatalogueMeta))return null;var e=parseFloat(this.mCatalogueMeta.scene_rev_id);return!isNaN(e)&&isFinite(e)?parseInt(String(e),10):0}},{key:"getGraphRevId",value:function(){if((0,p.isNullOrUndefined)(this.mCatalogueMeta))return null;var e=parseFloat(this.mCatalogueMeta.graph_active);return!isNaN(e)&&isFinite(e)?parseInt(String(e),10):0}},{key:"dispose",value:function(){delete this.mCatalogueMeta}}]),e}(),ui=__webpack_require__(1002);function ci(e,t){var n=at(e)?e:function(){return e},r=function(e){return e.error(n())};return new zt(t?function(e){return t.schedule(r,0,e)}:r)}function li(){try{if(window.location.href===window.parent.location.href)return!1}catch(e){}return!0}function hi(){try{return window.sessionStorage.getItem("foo"),!0}catch(e){return!1}}var fi=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mLoader",{})}return(0,c.Z)(e,[{key:"resetCache",value:function(){return this.disposeCacheLoader(),this}},{key:"disposeCacheLoader",value:function(){var e=this;Object.keys(this.mLoader).forEach((function(t){e.mLoader[t]&&e.mLoader[t].error("disposed")})),this.mLoader={}}},{key:"getSessionId",value:function(e){if(!hi())return null;var t="$$__xpv__product_session_".concat(e);return window.sessionStorage.getItem(t)}},{key:"setSessionId",value:function(e,t){if(hi()){var n="$$__xpv__product_session_".concat(e);sessionStorage.setItem(n,t)}}},{key:"setMeta",value:function(e,t){var n="object"==(0,ui.Z)(t)&&!Array.isArray(t)?t:{};qe.qL.print("loaded settings meta:",n),this.mLoader[e].next(n)}},{key:"requestMeta",value:function(e){var t=this,n=this.getSessionId(e),r={};null!=n&&(r["Product-Session-ID"]=n),ei.getInstance().get(Jr.E.makeApiRoute("catalogue/".concat(e,"/meta")),{headers:r}).then((function(n){if(!n.data)throw new Error("no data has been returned");var r=n.headers["Product-Session-ID"];void 0!==r&&t.setSessionId(e,r),t.setMeta(e,n.data)}),(function(n){t.mLoader[e].error(n),delete t.mLoader[e]}))}},{key:"resolveMeta",value:function(e){return f.Ft.isNumeric(e)?(this.mLoader[e]||(this.mLoader[e]=new ni(1),this.requestMeta(e)),this.mLoader[e]):ci("Catalogue id is not an ID")}}],[{key:"getInstance",value:function(){return null===this._instance&&(this._instance=new this),this._instance}}]),e}();(0,l.Z)(fi,"_instance",null);var pi=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mMetaSubject",void 0),(0,l.Z)(this,"mCatalogueId",void 0),(0,l.Z)(this,"mUpdateData",!0),this.mCatalogueId=t}var n,i;return(0,c.Z)(e,[{key:"setCatalogueId",value:function(e){this.mCatalogueId=parseInt(e,10),this.mUpdateData=!0}},{key:"loadAndObserve",value:function(){return this.preload(),this.mMetaSubject.pipe(sn(1))}},{key:"saveCatalogueSettings",value:(i=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=(new si).validateSettings(n);ei.getInstance().put(Jr.E.makeApiRoute("catalogue/".concat(t,"/meta")),{scene_settings:i}).then((function(){e(i)}),(function(e){r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"dispose",value:function(){this.mMetaSubject&&(this.mMetaSubject.error("disposed"),this.mMetaSubject.unsubscribe()),fi.getInstance().resetCache()}},{key:"preload",value:function(){var e=this;this.mMetaSubject&&!this.mUpdateData||(this.mUpdateData=!1,this.mMetaSubject&&this.mMetaSubject.error("forced to reload"),this.mMetaSubject=new ni(1),this.loadFromId(this.mCatalogueId).then((function(t){e.mMetaSubject&&e.mMetaSubject.next(t)}),(function(t){e.mMetaSubject&&(e.mMetaSubject.next(null),e.mMetaSubject.error(t))})))}},{key:"loadFromId",value:(n=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(isNaN(t))return e({});fi.getInstance().resolveMeta(t).pipe(sn(1)).subscribe((function(t){e(t)}),(function(e){n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}]),e}();function mi(){return new Ye}function di(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Xt((function(t,n){return e(t,n,r)})):Nt,sn(1),n?function(e){return qt((function(t,n){var r=!1;t.subscribe(Wt(n,(function(e){r=!0,n.next(e)}),(function(){r||n.next(e),n.complete()})))}))}(t):(void 0===(i=function(){return new Ye})&&(i=mi),qt((function(e,t){var n=!1;e.subscribe(Wt(t,(function(e){n=!0,t.next(e)}),(function(){return n?t.complete():t.error(i())})))}))));var i}}var vi=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mMetaSerializer",{}),(0,l.Z)(this,"mSettings",{})}return(0,c.Z)(e,[{key:"resolveCatalogueSettings",value:function(e){var t=this;return this.mSettings[e]||(this.mSettings[e]=new ni(1),this.mMetaSerializer[e]=new pi(Number(e)),this.mMetaSerializer[e].loadAndObserve().subscribe((function(n){t.mSettings[e].next(new si(n))}),(function(n){t.mSettings[e].next(new si),t.mSettings[e].error(n)}))),this.mSettings[e].pipe(di())}},{key:"disposeCatalogue",value:function(e){(0,p.isNullOrUndefined)(e)||(0,p.isNullOrUndefined)(this.mMetaSerializer[e])||(this.mMetaSerializer[e].dispose(),delete this.mMetaSerializer[e],delete this.mSettings[e])}},{key:"dispose",value:function(){var e=this;Object.keys(this.mMetaSerializer).forEach((function(t){e.disposeCatalogue(t)})),this.mMetaSerializer={},this.mSettings={}}}],[{key:"getInstance",value:function(){return this.sInstance||(this.sInstance=new e),this.sInstance}}]),e}();(0,l.Z)(vi,"sInstance",void 0);var yi,gi;__webpack_require__(4723);function bi(){return navigator.platform&&/MacIntel/.test(navigator.platform)&&navigator.maxTouchPoints>1}function Mi(){return!(!navigator.platform||!/iPhone|iPod|iPad|iPhone Simulator|iPod Simulator/.test(navigator.platform))||(!!bi()||/iPad|iPhone|iPod|Pike v7\.6 release 92|Pike v7\.8 release 517/.test(navigator.userAgent)&&!("MSStream"in window))}function ki(){return/windows phone/i.test(navigator.userAgent)}function _i(){return!(!navigator.platform||!/Android/.test(navigator.platform))||/android/i.test(navigator.userAgent)&&!ki()}function xi(){return Mi()?yi.iOS:_i()?yi.Android:ki()?yi.WindowsPhone:navigator.platform&&/OS\/2|Pocket PC|Windows|Win16|Win32|Win64|WinCE/.test(navigator.platform)?yi.Windows:navigator.platform&&/Macintosh|MacIntel|MacPPC|Mac68K/.test(navigator.platform)?yi.MacOS:yi.Unknown}function Ti(){return Mi()||_i()||ki()}function wi(){return!Ti()}!function(e){e.Android="android",e.iOS="ios",e.WindowsPhone="windowsphone",e.MacOS="macos",e.Windows="windows",e.Linux="linux",e.Unknown="unknown"}(yi||(yi={})),function(e){e.Threejs="threejs",e.Babylonjs="babylonjs"}(gi||(gi={}));var Ri=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mSettings",new si)}var n;return(0,c.Z)(e,[{key:"init",value:(n=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if("number"!=typeof t&&Number.isNaN(t))return n.mSettings.withSceneSettings(t),e(!0);vi.getInstance().resolveCatalogueSettings(Number(t)).subscribe((function(t){n.mSettings.withCatalogueSettings(t),e(!0)}),(function(){r("Could not download settings from catalogue id: ".concat(t))}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"dispose",value:function(){this.mSettings.dispose()}},{key:"getSettings",value:function(){return this.mSettings}},{key:"getDeviceSceneSettings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ti();return this.mSettings.getSceneDeviceSettings(e?ti.Mobile:ti.Desktop)}},{key:"getSceneSettingsRendererType",value:function(){return this.mSettings.getSceneSettings().renderer_type||gi.Threejs}}]),e}(),Zi=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mName",void 0),this.mName=t}return(0,c.Z)(e,[{key:"getName",value:function(){return this.mName}}]),e}();function Si(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ci,Ii,Ei,Ai,Oi,Di=function(e){(0,g.Z)(n,e);var t=Si(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,n.getTopicName(e)),(0,l.Z)((0,_.Z)(i),"mType",void 0),(0,l.Z)((0,_.Z)(i),"mData",void 0),i.mType=e,i.mData=r,i}return(0,c.Z)(n,[{key:"getType",value:function(){return this.mType}},{key:"getData",value:function(){return this.mData}}],[{key:"getTopicName",value:function(e){return"EditorSubscriptionType.".concat(e)}}]),n}(Zi);!function(e){e.UNBLOCK_DEFAULT_TOUCH="UNBLOCK_DEFAULT_TOUCH",e.SCENE_EDITOR="SCENE_EDITOR"}(Ci||(Ci={})),function(e){e.ACTIVE_CAMERA="ACTIVE_CAMERA",e.FIRST_POSITION="FIRST_POSITION",e.FIT_OBJECT_FRONT="FIT_OBJECT_FRONT",e.FIT_OBJECT_BACK="FIT_OBJECT_BACK",e.FIT_OBJECT_LEFT="FIT_OBJECT_LEFT",e.FIT_OBJECT_RIGHT="FIT_OBJECT_RIGHT",e.FIT_OBJECT_TOP="FIT_OBJECT_TOP",e.FIT_OBJECT_BOTTOM="FIT_OBJECT_BOTTOM",e.CUSTOM_CAMERA_POSITION="CUSTOM_CAMERA_POSITION"}(Ii||(Ii={})),function(e){e[e.Initialized=0]="Initialized",e[e.BuildStarted=1]="BuildStarted",e[e.BuildFinished=2]="BuildFinished",e[e.BuildUpdated=3]="BuildUpdated",e[e.BuildFullyLoaded=4]="BuildFullyLoaded",e[e.BuildFailed=5]="BuildFailed",e[e.ViewUpdated=6]="ViewUpdated",e[e.WindowResized=7]="WindowResized",e[e.TransformModeChanged=8]="TransformModeChanged",e[e.TransformTargetMode=9]="TransformTargetMode",e[e.HistoryChanged=10]="HistoryChanged",e[e.SceneGraphAdded=11]="SceneGraphAdded",e[e.SceneGraphRemoved=12]="SceneGraphRemoved",e[e.SceneGraphChanged=13]="SceneGraphChanged",e[e.NodeAdded=14]="NodeAdded",e[e.NodeRemoved=15]="NodeRemoved",e[e.NodeChanged=16]="NodeChanged",e[e.HelperAdded=17]="HelperAdded",e[e.HelperRemoved=18]="HelperRemoved",e[e.ObjectFocused=19]="ObjectFocused",e[e.ObjectSelected=20]="ObjectSelected",e[e.ObjectChanged=21]="ObjectChanged",e[e.ObjectTransformed=22]="ObjectTransformed",e[e.ObjectTargetChanged=23]="ObjectTargetChanged",e[e.ModelAttributeChanged=24]="ModelAttributeChanged",e[e.TransformControlChanged=25]="TransformControlChanged",e[e.TransformControlLock=26]="TransformControlLock",e[e.TransformControlUnLock=27]="TransformControlUnLock",e[e.ZoomChanged=28]="ZoomChanged",e[e.BatchProgress=29]="BatchProgress",e[e.RequestFrame=30]="RequestFrame",e[e.OffsetChanged=31]="OffsetChanged",e[e.MeshChanged=32]="MeshChanged",e[e.ProductOptionChanged=33]="ProductOptionChanged",e[e.ProductQuestionChanged=34]="ProductQuestionChanged",e[e.ProductMaterialChanged=35]="ProductMaterialChanged",e[e.SceneObjectAttached=36]="SceneObjectAttached",e[e.SceneObjectDetached=37]="SceneObjectDetached",e[e.PlaySound=38]="PlaySound",e[e.ProductAttributeUpdated=39]="ProductAttributeUpdated",e[e.ProductArticlesChanged=40]="ProductArticlesChanged",e[e.ProductStartLoading=41]="ProductStartLoading",e[e.ProductFinishedLoading=42]="ProductFinishedLoading",e[e.ProductErrorLoading=43]="ProductErrorLoading",e[e.ActiveViewChanged=44]="ActiveViewChanged",e[e.QrWebAr=45]="QrWebAr",e[e.Warning=46]="Warning",e[e.EnterVR=47]="EnterVR",e[e.ExitVR=48]="ExitVR",e[e.ToolbarVisible=49]="ToolbarVisible",e[e.ToolbarHidden=50]="ToolbarHidden",e[e.Shared=51]="Shared",e[e.ProductAttributeModerated=52]="ProductAttributeModerated",e[e.DrawingTechniqueFailed=53]="DrawingTechniqueFailed",e[e.MaterialUpdated=54]="MaterialUpdated",e[e.RendererBuildStarted=55]="RendererBuildStarted",e[e.RendererBuildProgress=56]="RendererBuildProgress",e[e.RendererBuildFinished=57]="RendererBuildFinished",e[e.RendererBuildIdle=58]="RendererBuildIdle",e[e.ScreenshotTransitionStart=59]="ScreenshotTransitionStart",e[e.ScreenshotTransitionEnd=60]="ScreenshotTransitionEnd",e[e.LoadConfigurationStarted=61]="LoadConfigurationStarted",e[e.LoadConfigurationFinished=62]="LoadConfigurationFinished",e[e.MaxTypeValue=63]="MaxTypeValue"}(Ei||(Ei={})),function(e){e.REPLICA="REPLICA",e.ORIGINAL="ORIGINAL"}(Ai||(Ai={})),function(e){e.REFERENCE_PRODUCT="reference",e.ROOT_PRODUCT="root",e.SUB_PRODUCT="sub"}(Oi||(Oi={}));__webpack_require__(86),__webpack_require__(3299);var Pi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;(0,u.Z)(this,e),(0,l.Z)(this,"_x",void 0),(0,l.Z)(this,"_y",void 0),(0,l.Z)(this,"_z",void 0),(0,l.Z)(this,"_w",void 0),(0,l.Z)(this,"onChange",new Ht),this._x=t,this._y=n,this._z=r,this._w=i}return(0,c.Z)(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new e(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,!1!==t&&this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.x,r=e.y,i=e.z,a=e.order,o=Math.cos,s=Math.sin,u=o(n/2),c=o(r/2),l=o(i/2),h=s(n/2),f=s(r/2),p=s(i/2);switch(a){case"XYZ":this._x=h*c*l+u*f*p,this._y=u*f*l-h*c*p,this._z=u*c*p+h*f*l,this._w=u*c*l-h*f*p;break;case"YXZ":this._x=h*c*l+u*f*p,this._y=u*f*l-h*c*p,this._z=u*c*p-h*f*l,this._w=u*c*l+h*f*p;break;case"ZXY":this._x=h*c*l-u*f*p,this._y=u*f*l+h*c*p,this._z=u*c*p+h*f*l,this._w=u*c*l-h*f*p;break;case"ZYX":this._x=h*c*l-u*f*p,this._y=u*f*l+h*c*p,this._z=u*c*p-h*f*l,this._w=u*c*l+h*f*p;break;case"YZX":this._x=h*c*l+u*f*p,this._y=u*f*l+h*c*p,this._z=u*c*p-h*f*l,this._w=u*c*l-h*f*p;break;case"XZY":this._x=h*c*l-u*f*p,this._y=u*f*l-h*c*p,this._z=u*c*p+h*f*l,this._w=u*c*l+h*f*p;break;default:console.warn("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],o=t[5],s=t[9],u=t[2],c=t[6],l=t[10],h=n+o+l;if(h>0){var f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(c-s)*f,this._y=(i-u)*f,this._z=(a-r)*f}else if(n>o&&n>l){var p=2*Math.sqrt(1+n-o-l);this._w=(c-s)/p,this._x=.25*p,this._y=(r+a)/p,this._z=(i+u)/p}else if(o>l){var m=2*Math.sqrt(1+o-n-l);this._w=(i-u)/m,this._x=(r+a)/m,this._y=.25*m,this._z=(s+c)/m}else{var d=2*Math.sqrt(1+l-n-o);this._w=(a-r)/d,this._x=(i+u)/d,this._y=(s+c)/d,this._z=.25*d}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(Dt(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,u=t._z,c=t._w;return this._x=n*c+a*o+r*u-i*s,this._y=r*c+a*s+i*o-n*u,this._z=i*c+a*u+n*s-r*o,this._w=a*c-n*o-r*s-i*u,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,a=this._w,o=a*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var u=1-t;return this._w=u*a+t*this._w,this._x=u*n+t*this._x,this._y=u*r+t*this._y,this._z=u*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(s),l=Math.atan2(c,o),h=Math.sin((1-t)*l)/c,f=Math.sin(t*l)/c;return this._w=a*h+this._w*f,this._x=n*h+this._x*f,this._y=r*h+this._y*f,this._z=i*h+this._z*f,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){return this.copy(e).slerp(t,n)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],!1!==n&&this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChangeCallback",value:function(){this.onChange.next()}},{key:"fromSphericalCoords",value:function(e,t){var n=Math.cos(e/2),r=Math.cos(t/2),i=Math.sin(e/2),a=Math.sin(t/2);return this._x=r*n,this._y=-a*i,this._z=i*r,this._w=a*n,this}}],[{key:"slerpFlat",value:function(e,t,n,r,i,a,o){var s=n[r+0],u=n[r+1],c=n[r+2],l=n[r+3],h=i[a+0],f=i[a+1],p=i[a+2],m=i[a+3];if(0===o)return e[t+0]=s,e[t+1]=u,e[t+2]=c,void(e[t+3]=l);if(1===o)return e[t+0]=h,e[t+1]=f,e[t+2]=p,void(e[t+3]=m);if(l!==m||s!==h||u!==f||c!==p){var d=1-o,v=s*h+u*f+c*p+l*m,y=v>=0?1:-1,g=1-v*v;if(g>Number.EPSILON){var b=Math.sqrt(g),M=Math.atan2(b,v*y);d=Math.sin(d*M)/b,o=Math.sin(o*M)/b}var k=o*y;if(s=s*d+h*k,u=u*d+f*k,c=c*d+p*k,l=l*d+m*k,d===1-o){var _=1/Math.sqrt(s*s+u*u+c*c+l*l);s*=_,u*=_,c*=_,l*=_}}e[t]=s,e[t+1]=u,e[t+2]=c,e[t+3]=l}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,r,i,a){var o=n[r],s=n[r+1],u=n[r+2],c=n[r+3],l=i[a],h=i[a+1],f=i[a+2],p=i[a+3];return e[t]=o*p+c*l+s*f-u*h,e[t+1]=s*p+c*h+u*l-o*f,e[t+2]=u*p+c*f+o*h-s*l,e[t+3]=c*p-o*l-s*h-u*f,e}},{key:"identity",value:function(){return(new e).identity()}}]),e}(),Bi=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,u.Z)(this,e),(0,l.Z)(this,"_x",void 0),(0,l.Z)(this,"_y",void 0),(0,l.Z)(this,"_z",void 0),(0,l.Z)(this,"onChange",new Ht),this._x=t,this._y=n,this._z=r}return(0,c.Z)(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){return void 0===n&&(n=this._z),this._x=e,this._y=t,this._z=n,this._onChangeCallback(),this}},{key:"setScalar",value:function(e){return this._x=e,this._y=e,this._z=e,this._onChangeCallback(),this}},{key:"setX",value:function(e){return this._x=e,this._onChangeCallback(),this}},{key:"setY",value:function(e){return this._y=e,this._onChangeCallback(),this}},{key:"setZ",value:function(e){return this._z=e,this._onChangeCallback(),this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this._x=t;break;case 1:this._y=t;break;case 2:this._z=t;break;default:throw new Error("index is out of range: ".concat(e))}return this._onChangeCallback(),this}},{key:"getComponent",value:function(e){switch(e){case 0:return this._x;case 1:return this._y;case 2:return this._z;default:throw new Error("index is out of range: ".concat(e))}}},{key:"clone",value:function(){return new e(this._x,this._y,this._z)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._x=e.x,this._y=e.y,this._z=e.z,!1!==t&&this._onChangeCallback(),this}},{key:"add",value:function(e){return this._x+=e.x,this._y+=e.y,this._z+=e.z,this._onChangeCallback(),this}},{key:"addScalar",value:function(e){return this._x+=e,this._y+=e,this._z+=e,this._onChangeCallback(),this}},{key:"addVectors",value:function(e,t){return this._x=e.x+t.x,this._y=e.y+t.y,this._z=e.z+t.z,this._onChangeCallback(),this}},{key:"addScaledVector",value:function(e,t){return this._x+=e.x*t,this._y+=e.y*t,this._z+=e.z*t,this._onChangeCallback(),this}},{key:"sub",value:function(e){return this._x-=e.x,this._y-=e.y,this._z-=e.z,this._onChangeCallback(),this}},{key:"subScalar",value:function(e){return this._x-=e,this._y-=e,this._z-=e,this._onChangeCallback(),this}},{key:"subVectors",value:function(e,t){return this._x=e.x-t.x,this._y=e.y-t.y,this._z=e.z-t.z,this._onChangeCallback(),this}},{key:"multiply",value:function(e){return this._x*=e.x,this._y*=e.y,this._z*=e.z,this._onChangeCallback(),this}},{key:"multiplyScalar",value:function(e){return this._x*=e,this._y*=e,this._z*=e,this._onChangeCallback(),this}},{key:"multiplyVectors",value:function(e,t){return this._x=e.x*t.x,this._y=e.y*t.y,this._z=e.z*t.z,this._onChangeCallback(),this}},{key:"applyEuler",value:function(t){return this.applyQuaternion(e._quaternion.setFromEuler(t))}},{key:"applyAxisAngle",value:function(t,n){return this.applyQuaternion(e._quaternion.setFromAxisAngle(t,n))}},{key:"applyMatrix3",value:function(e){var t=this._x,n=this._y,r=this._z,i=e.elements;return this._x=i[0]*t+i[3]*n+i[6]*r,this._y=i[1]*t+i[4]*n+i[7]*r,this._z=i[2]*t+i[5]*n+i[8]*r,this._onChangeCallback(),this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this._x,n=this._y,r=this._z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this._x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this._y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this._z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this._onChangeCallback(),this}},{key:"applyQuaternion",value:function(e){var t=this._x,n=this._y,r=this._z,i=e.x,a=e.y,o=e.z,s=e.w,u=s*t+a*r-o*n,c=s*n+o*t-i*r,l=s*r+i*n-a*t,h=-i*t-a*n-o*r;return this._x=u*s+h*-i+c*-o-l*-a,this._y=c*s+h*-a+l*-i-u*-o,this._z=l*s+h*-o+u*-a-c*-i,this._onChangeCallback(),this}},{key:"project",value:function(e,t){return this.applyMatrix4(e).applyMatrix4(t)}},{key:"unproject",value:function(e,t){return this.applyMatrix4(t).applyMatrix4(e)}},{key:"transformDirection",value:function(e){var t=this._x,n=this._y,r=this._z,i=e.elements;return this._x=i[0]*t+i[4]*n+i[8]*r,this._y=i[1]*t+i[5]*n+i[9]*r,this._z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}},{key:"divide",value:function(e){return this._x/=e.x,this._y/=e.y,this._z/=e.z,this._onChangeCallback(),this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this._x=Math.min(this._x,e.x),this._y=Math.min(this._y,e.y),this._z=Math.min(this._z,e.z),this._onChangeCallback(),this}},{key:"max",value:function(e){return this._x=Math.max(this._x,e.x),this._y=Math.max(this._y,e.y),this._z=Math.max(this._z,e.z),this._onChangeCallback(),this}},{key:"clamp",value:function(e,t){return this._x=Math.max(e.x,Math.min(t.x,this.x)),this._y=Math.max(e.y,Math.min(t.y,this.y)),this._z=Math.max(e.z,Math.min(t.z,this.z)),this._onChangeCallback(),this}},{key:"clampScalar",value:function(e,t){return this._x=Math.max(e,Math.min(t,this._x)),this._y=Math.max(e,Math.min(t,this._y)),this._z=Math.max(e,Math.min(t,this._z)),this._onChangeCallback(),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this._x=Math.floor(this._x),this._y=Math.floor(this._y),this._z=Math.floor(this._z),this._onChangeCallback(),this}},{key:"ceil",value:function(){return this._x=Math.ceil(this._x),this._y=Math.ceil(this._y),this._z=Math.ceil(this._z),this._onChangeCallback(),this}},{key:"round",value:function(){return this._x=Math.round(this._x),this._y=Math.round(this._y),this._z=Math.round(this._z),this._onChangeCallback(),this}},{key:"roundToZero",value:function(){return this._x=this._x<0?Math.ceil(this._x):Math.floor(this._x),this._y=this._y<0?Math.ceil(this._y):Math.floor(this._y),this._z=this._z<0?Math.ceil(this._z):Math.floor(this._z),this._onChangeCallback(),this}},{key:"negate",value:function(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e.x+this._y*e.y+this._z*e.z}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)}},{key:"manhattanLength",value:function(){return Math.abs(this._x)+Math.abs(this._y)+Math.abs(this._z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this._x+=(e.x-this._x)*t,this._y+=(e.y-this._y)*t,this._z+=(e.z-this._z)*t,this._onChangeCallback(),this}},{key:"lerpVectors",value:function(e,t,n){return this._x=e.x+(t.x-e.x)*n,this._y=e.y+(t.y-e.y)*n,this._z=e.z+(t.z-e.z)*n,this._onChangeCallback(),this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this._x=r*s-i*o,this._y=i*a-n*s,this._z=n*o-r*a,this._onChangeCallback(),this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(t){return e._vector.copy(this).projectOnVector(t),this.sub(e._vector)}},{key:"reflect",value:function(t){return this.sub(e._vector.copy(t).multiplyScalar(2*this.dot(t)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(Dt(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this._x-e.x,n=this._y-e.y,r=this._z-e.z;return t*t+n*n+r*r}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this._x-e.x)+Math.abs(this._y-e.y)+Math.abs(this._z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var r=Math.sin(t)*e;return this._x=r*Math.sin(n),this._y=Math.cos(t)*e,this._z=r*Math.cos(n),this._onChangeCallback(),this}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this._x=e*Math.sin(t),this._y=n,this._z=e*Math.cos(t),this._onChangeCallback(),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this._x=t[12],this._y=t[13],this._z=t[14],this._onChangeCallback(),this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this._x=t,this._y=n,this._z=r,this._onChangeCallback(),this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"equals",value:function(e){return e.x===this._x&&e.y===this._y&&e.z===this._z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._onChangeCallback(),this}},{key:"toggleCoordSystem",value:function(){return this.z*=-1,this}},{key:"random",value:function(){return this._x=Math.random(),this._y=Math.random(),this._z=Math.random(),this._onChangeCallback(),this}},{key:"_onChangeCallback",value:function(){this.onChange.next()}}],[{key:"Zero",value:function(){return new e(0,0,0)}},{key:"One",value:function(){return new e(1,1,1)}},{key:"Forward",value:function(){return new e(0,0,-1)}},{key:"Back",value:function(){return new e(0,0,1)}},{key:"Up",value:function(){return new e(0,1,0)}},{key:"Down",value:function(){return new e(0,-1,0)}},{key:"Left",value:function(){return new e(-1,0,0)}},{key:"Right",value:function(){return new e(1,0,0)}},{key:"AxisX",value:function(){return new e(1,0,0)}},{key:"AxisY",value:function(){return new e(0,1,0)}},{key:"AxisZ",value:function(){return new e(0,0,1)}}]),e}();(0,l.Z)(Bi,"_quaternion",new Pi),(0,l.Z)(Bi,"_vector",new Bi);var Fi=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"elements",void 0),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return(0,c.Z)(e,[{key:"set",value:function(e,t,n,r,i,a,o,s,u,c,l,h,f,p,m,d){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=r,v[1]=i,v[5]=a,v[9]=o,v[13]=s,v[2]=u,v[6]=c,v[10]=l,v[14]=h,v[3]=f,v[7]=p,v[11]=m,v[15]=d,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(t){var n=this.elements,r=t.elements,i=1/e._v1.setFromMatrixColumn(t,0).length(),a=1/e._v1.setFromMatrixColumn(t,1).length(),o=1/e._v1.setFromMatrixColumn(t,2).length();return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=0,n[4]=r[4]*a,n[5]=r[5]*a,n[6]=r[6]*a,n[7]=0,n[8]=r[8]*o,n[9]=r[9]*o,n[10]=r[10]*o,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),u=Math.sin(r),c=Math.cos(i),l=Math.sin(i);if("XYZ"===e.order){var h=a*c,f=a*l,p=o*c,m=o*l;t[0]=s*c,t[4]=-s*l,t[8]=u,t[1]=f+p*u,t[5]=h-m*u,t[9]=-o*s,t[2]=m-h*u,t[6]=p+f*u,t[10]=a*s}else if("YXZ"===e.order){var d=s*c,v=s*l,y=u*c,g=u*l;t[0]=d+g*o,t[4]=y*o-v,t[8]=a*u,t[1]=a*l,t[5]=a*c,t[9]=-o,t[2]=v*o-y,t[6]=g+d*o,t[10]=a*s}else if("ZXY"===e.order){var b=s*c,M=s*l,k=u*c,_=u*l;t[0]=b-_*o,t[4]=-a*l,t[8]=k+M*o,t[1]=M+k*o,t[5]=a*c,t[9]=_-b*o,t[2]=-a*u,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var x=a*c,T=a*l,w=o*c,R=o*l;t[0]=s*c,t[4]=w*u-T,t[8]=x*u+R,t[1]=s*l,t[5]=R*u+x,t[9]=T*u-w,t[2]=-u,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var Z=a*s,S=a*u,C=o*s,I=o*u;t[0]=s*c,t[4]=I-Z*l,t[8]=C*l+S,t[1]=l,t[5]=a*c,t[9]=-o*c,t[2]=-u*c,t[6]=S*l+C,t[10]=Z-I*l}else if("XZY"===e.order){var E=a*s,A=a*u,O=o*s,D=o*u;t[0]=s*c,t[4]=-l,t[8]=u*c,t[1]=E*l+D,t[5]=a*c,t[9]=A*l-O,t[2]=O*l-A,t[6]=o*c,t[10]=D*l+E}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(t){return this.compose(e._zero,t,e._one)}},{key:"lookAt",value:function(t,n,r){var i=this.elements;return e._z.subVectors(t,n),0===e._z.lengthSq()&&(e._z.z=1),e._z.normalize(),e._x.crossVectors(r,e._z),0===e._x.lengthSq()&&(1===Math.abs(r.z)?e._z.x+=1e-4:e._z.z+=1e-4,e._z.normalize(),e._x.crossVectors(r,e._z)),e._x.normalize(),e._y.crossVectors(e._z,e._x),i[0]=e._x.x,i[4]=e._y.x,i[8]=e._z.x,i[1]=e._x.y,i[5]=e._y.y,i[9]=e._z.y,i[2]=e._x.z,i[6]=e._y.z,i[10]=e._z.z,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],u=n[12],c=n[1],l=n[5],h=n[9],f=n[13],p=n[2],m=n[6],d=n[10],v=n[14],y=n[3],g=n[7],b=n[11],M=n[15],k=r[0],_=r[4],x=r[8],T=r[12],w=r[1],R=r[5],Z=r[9],S=r[13],C=r[2],I=r[6],E=r[10],A=r[14],O=r[3],D=r[7],P=r[11],B=r[15];return i[0]=a*k+o*w+s*C+u*O,i[4]=a*_+o*R+s*I+u*D,i[8]=a*x+o*Z+s*E+u*P,i[12]=a*T+o*S+s*A+u*B,i[1]=c*k+l*w+h*C+f*O,i[5]=c*_+l*R+h*I+f*D,i[9]=c*x+l*Z+h*E+f*P,i[13]=c*T+l*S+h*A+f*B,i[2]=p*k+m*w+d*C+v*O,i[6]=p*_+m*R+d*I+v*D,i[10]=p*x+m*Z+d*E+v*P,i[14]=p*T+m*S+d*A+v*B,i[3]=y*k+g*w+b*C+M*O,i[7]=y*_+g*R+b*I+M*D,i[11]=y*x+g*Z+b*E+M*P,i[15]=y*T+g*S+b*A+M*B,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],u=e[13],c=e[2],l=e[6],h=e[10],f=e[14];return e[3]*(+i*s*l-r*u*l-i*o*h+n*u*h+r*o*f-n*s*f)+e[7]*(+t*s*f-t*u*h+i*a*h-r*a*f+r*u*c-i*s*c)+e[11]*(+t*u*l-t*o*f-i*a*l+n*a*f+i*o*c-n*u*c)+e[15]*(-r*o*c-t*s*l+t*o*h+r*a*l-n*a*h+n*s*c)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var r=this.elements;return e instanceof Bi?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],f=e[11],p=e[12],m=e[13],d=e[14],v=e[15],y=l*d*u-m*h*u+m*s*f-o*d*f-l*s*v+o*h*v,g=p*h*u-c*d*u-p*s*f+a*d*f+c*s*v-a*h*v,b=c*m*u-p*l*u+p*o*f-a*m*f-c*o*v+a*l*v,M=p*l*s-c*m*s-p*o*h+a*m*h+c*o*d-a*l*d,k=t*y+n*g+r*b+i*M;if(0===k)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var _=1/k;return e[0]=y*_,e[1]=(m*h*i-l*d*i-m*r*f+n*d*f+l*r*v-n*h*v)*_,e[2]=(o*d*i-m*s*i+m*r*u-n*d*u-o*r*v+n*s*v)*_,e[3]=(l*s*i-o*h*i-l*r*u+n*h*u+o*r*f-n*s*f)*_,e[4]=g*_,e[5]=(c*d*i-p*h*i+p*r*f-t*d*f-c*r*v+t*h*v)*_,e[6]=(p*s*i-a*d*i-p*r*u+t*d*u+a*r*v-t*s*v)*_,e[7]=(a*h*i-c*s*i+c*r*u-t*h*u-a*r*f+t*s*f)*_,e[8]=b*_,e[9]=(p*l*i-c*m*i-p*n*f+t*m*f+c*n*v-t*l*v)*_,e[10]=(a*m*i-p*o*i+p*n*u-t*m*u-a*n*v+t*o*v)*_,e[11]=(c*o*i-a*l*i-c*n*u+t*l*u+a*n*f-t*o*f)*_,e[12]=M*_,e[13]=(c*m*r-p*l*r+p*n*h-t*m*h-c*n*d+t*l*d)*_,e[14]=(p*o*r-a*m*r-p*n*s+t*m*s+a*n*d-t*o*d)*_,e[15]=(a*l*r-c*o*r+c*n*s-t*l*s-a*n*h+t*o*h)*_,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,u=i*a,c=i*o;return this.set(u*a+n,u*o-r*s,u*s+r*o,0,u*o+r*s,c*o+n,c*s-r*a,0,u*s-r*o,c*s+r*a,i*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var r=this.elements,i=t.x,a=t.y,o=t.z,s=t.w,u=i+i,c=a+a,l=o+o,h=i*u,f=i*c,p=i*l,m=a*c,d=a*l,v=o*l,y=s*u,g=s*c,b=s*l,M=n.x,k=n.y,_=n.z;return r[0]=(1-(m+v))*M,r[1]=(f+b)*M,r[2]=(p-g)*M,r[3]=0,r[4]=(f-b)*k,r[5]=(1-(h+v))*k,r[6]=(d+y)*k,r[7]=0,r[8]=(p+g)*_,r[9]=(d-y)*_,r[10]=(1-(h+m))*_,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}},{key:"decompose",value:function(t,n,r){var i=this.elements,a=e._v1.set(i[0],i[1],i[2]).length(),o=e._v1.set(i[4],i[5],i[6]).length(),s=e._v1.set(i[8],i[9],i[10]).length();this.determinant()<0&&(a=-a),t.x=i[12],t.y=i[13],t.z=i[14],e._m1.copy(this);var u=1/a,c=1/o,l=1/s;return e._m1.elements[0]*=u,e._m1.elements[1]*=u,e._m1.elements[2]*=u,e._m1.elements[4]*=c,e._m1.elements[5]*=c,e._m1.elements[6]*=c,e._m1.elements[8]*=l,e._m1.elements[9]*=l,e._m1.elements[10]*=l,n.setFromRotationMatrix(e._m1),r.x=a,r.y=o,r.z=s,this}},{key:"makePerspective",value:function(e,t,n,r,i,a){var o=this.elements,s=2*i/(t-e),u=2*i/(n-r),c=(t+e)/(t-e),l=(n+r)/(n-r),h=-(a+i)/(a-i),f=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=u,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,r,i,a){var o=this.elements,s=1/(t-e),u=1/(n-r),c=1/(a-i),l=(t+e)*s,h=(n+r)*u,f=(a+i)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}},{key:"toggleCoordSystem",value:function(){return this.elements[2]*=-1,this.elements[6]*=-1,this.elements[8]*=-1,this.elements[9]*=-1,this.elements[14]*=-1,this}},{key:"toggleCoordSystemAsProjection",value:function(){return this.elements[8]*=-1,this.elements[9]*=-1,this.elements[10]*=-1,this.elements[11]*=-1,this}}]),e}();(0,l.Z)(Fi,"_v1",new Bi),(0,l.Z)(Fi,"_m1",new Fi),(0,l.Z)(Fi,"_zero",new Bi(0,0,0)),(0,l.Z)(Fi,"_one",new Bi(1,1,1)),(0,l.Z)(Fi,"_x",new Bi),(0,l.Z)(Fi,"_y",new Bi),(0,l.Z)(Fi,"_z",new Bi);var Li=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;(0,u.Z)(this,e),(0,l.Z)(this,"onChange",new Ht),(0,l.Z)(this,"_x",void 0),(0,l.Z)(this,"_y",void 0),(0,l.Z)(this,"_z",void 0),(0,l.Z)(this,"_order",e.DefaultOrder),this._x=t,this._y=n,this._z=r,this._order=i}return(0,c.Z)(e,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new e(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,!1!==t&&this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.elements,i=r[0],a=r[4],o=r[8],s=r[1],u=r[5],c=r[9],l=r[2],h=r[6],f=r[10];switch(t){case"XYZ":this._y=Math.asin(Dt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Dt(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-l,i),this._z=0);break;case"ZXY":this._x=Math.asin(Dt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-l,f),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-Dt(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(Dt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-l,i)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-Dt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-c,f),this._y=0);break;default:console.warn("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DefaultOrder,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._matrix.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e._matrix,n,r)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(t){return e._quaternion.setFromEuler(this),this.setFromQuaternion(e._quaternion,t)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.DefaultOrder,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._x=t[0],this._y=t[1],this._z=t[2],this._order=n,!1!==r&&this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e}},{key:"toLonLat",value:function(){var e=Math.asin(this._x);return{longitude:Math.atan2(this._y,this._z),latitude:e}}},{key:"_onChangeCallback",value:function(){this.onChange.next()}}]),e}();function Ni(){return Ni="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=(0,M.Z)(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},Ni.apply(this,arguments)}(0,l.Z)(Li,"DefaultOrder","XYZ"),(0,l.Z)(Li,"RotationOrders",["XYZ","YZX","ZXY","XZY","YXZ","ZYX"]),(0,l.Z)(Li,"_matrix",new Fi),(0,l.Z)(Li,"_quaternion",new Pi);var ji=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Bi(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Bi(-1/0,-1/0,-1/0);(0,u.Z)(this,e),(0,l.Z)(this,"min",void 0),(0,l.Z)(this,"max",void 0),this.min=t,this.max=n}return(0,c.Z)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,u=e.length;s<u;s+=3){var c=e[s],l=e[s+1],h=e[s+2];c<t&&(t=c),l<n&&(n=l),h<r&&(r=h),c>i&&(i=c),l>a&&(a=l),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,u=e.count;s<u;s++){var c=e.getX(s),l=e.getY(s),h=e.getZ(s);c<t&&(t=c),l<n&&(n=l),h<r&&(r=h),c>i&&(i=c),l>a&&(a=l),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(t,n){var r=e._vector.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(t){return e._vector.copy(t).clamp(this.min,this.max).sub(t).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(t){return this.isEmpty()||(e._points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e._points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e._points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e._points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e._points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e._points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e._points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e._points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e._points)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();(0,l.Z)(ji,"_vector",new Bi),(0,l.Z)(ji,"_points",[new Bi,new Bi,new Bi,new Bi,new Bi,new Bi,new Bi,new Bi]);var zi=function(){function e(){var t=this;(0,u.Z)(this,e),(0,l.Z)(this,"mPosition",void 0),(0,l.Z)(this,"mQuaternion",void 0),(0,l.Z)(this,"mRotation",void 0),(0,l.Z)(this,"mScale",void 0),(0,l.Z)(this,"mMatrixLocal",void 0),(0,l.Z)(this,"mMatrixCache",void 0),(0,l.Z)(this,"mMatrixWorld",void 0),(0,l.Z)(this,"matrixNeedsUpdate",!0),(0,l.Z)(this,"matrixWorldNeedsUpdate",!0),(0,l.Z)(this,"onChange",new Ht),this.mPosition=Bi.Zero(),this.mQuaternion=Pi.identity(),this.mRotation=new Li,this.mScale=Bi.One(),this.mMatrixLocal=new Fi,this.mMatrixCache=new Fi,this.mMatrixWorld=new Fi,this.mPosition.onChange.subscribe((function(){t.matrixNeedsUpdate=!0,t.onChangeCallback()})),this.mRotation.onChange.subscribe((function(){t.mQuaternion.setFromEuler(t.mRotation,!1),t.matrixNeedsUpdate=!0,t.onChangeCallback()})),this.mQuaternion.onChange.subscribe((function(){t.mRotation.setFromQuaternion(t.mQuaternion,void 0,!1),t.matrixNeedsUpdate=!0,t.onChangeCallback()})),this.mScale.onChange.subscribe((function(){t.matrixNeedsUpdate=!0,t.onChangeCallback()}))}return(0,c.Z)(e,[{key:"markDirty",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.matrixNeedsUpdate=!!e||this.matrixNeedsUpdate,this.matrixWorldNeedsUpdate=!!t||this.matrixWorldNeedsUpdate}},{key:"dispose",value:function(){this.mPosition.onChange.unsubscribe(),this.mRotation.onChange.unsubscribe(),this.mQuaternion.onChange.unsubscribe(),this.mScale.onChange.unsubscribe(),this.onChange.unsubscribe()}},{key:"position",get:function(){return this.mPosition},set:function(e){this.mPosition.copy(e)}},{key:"rotation",get:function(){return this.mRotation},set:function(e){this.mRotation.copy(e)}},{key:"quaternion",get:function(){return this.mQuaternion},set:function(e){this.mQuaternion.copy(e)}},{key:"scale",get:function(){return this.mScale},set:function(e){this.mScale.copy(e)}},{key:"matrix",get:function(){return this.mMatrixLocal},set:function(e){this.mMatrixLocal.copy(e)}},{key:"matrixCache",get:function(){return this.mMatrixCache},set:function(e){this.mMatrixCache.copy(e),this.matrixWorldNeedsUpdate=!0}},{key:"matrixWorld",get:function(){return this.mMatrixWorld},set:function(e){this.mMatrixWorld.copy(e)}},{key:"updateMatrix",value:function(){(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.matrixNeedsUpdate)&&(this.mMatrixLocal.compose(this.mPosition,this.mQuaternion,this.mScale),this.matrixWorldNeedsUpdate=!0),this.mMatrixCache.copy(this.mMatrixLocal)}},{key:"updateMatrixWorld",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!(!this.matrixWorldNeedsUpdate&&!t)&&(e?this.mMatrixWorld.multiplyMatrices(e,this.mMatrixCache):this.mMatrixWorld.copy(this.mMatrixCache),this.matrixWorldNeedsUpdate=!1,!0)}},{key:"copy",value:function(e){return this.position.copy(e.position),this.rotation.copy(e.rotation),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixNeedsUpdate=e.matrixNeedsUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"getWorldPosition",value:function(e){e.setFromMatrixPosition(this.mMatrixWorld)}},{key:"getWorldQuaternion",value:function(t){this.matrixWorld.decompose(e._position,t,e._scale)}},{key:"getWorldScale",value:function(t){this.matrixWorld.decompose(e._position,e._quaternion,t)}},{key:"getWorldDirection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.matrixWorld.elements;e.set(n[8],n[9],n[10]).normalize(),t&&e.multiplyScalar(-1)}},{key:"onChangeCallback",value:function(){this.onChange.next()}}],[{key:"create",value:function(t,n,r){var i=new e;return i.position.copy(t),i.quaternion.copy(n),i.scale.copy(r),i}}]),e}();(0,l.Z)(zi,"_position",new Bi),(0,l.Z)(zi,"_quaternion",new Pi),(0,l.Z)(zi,"_scale",new Bi);var Ui=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mMask",void 0),this.mMask=0}return(0,c.Z)(e,[{key:"enable",value:function(e){this.mMask|=1<<e|0}},{key:"disable",value:function(e){this.mMask&=~(1<<e|0)}},{key:"set",value:function(e){this.mMask=(1<<e|0)>>>0}},{key:"test",value:function(e){return 0!=(this.mMask&e.mMask)}},{key:"isEnabled",value:function(e){return 0!=(this.mMask&(1<<e|0))}},{key:"toggle",value:function(e){this.mMask^=1<<e|0}},{key:"enableAll",value:function(){this.mMask=-1}},{key:"disableAll",value:function(){this.mMask=0}},{key:"enableByLayer",value:function(e){this.mMask|=e.mMask}}]),e}();function Vi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Hi=function(e){(0,g.Z)(n,e);var t=Vi(n);function n(){return(0,u.Z)(this,n),t.call(this,n.mType)}return(0,c.Z)(n,null,[{key:"getTopicName",value:function(){return n.mType}}]),n}(Zi);function Gi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Hi,"mType","BoundingBoxUpdateEvent");var qi,Wi=function(e){(0,g.Z)(n,e);var t=Gi(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mSceneObjectId",void 0),(0,l.Z)((0,_.Z)(r),"mSyncHash",void 0),(0,l.Z)((0,_.Z)(r),"mServerSyncTime",void 0),(0,l.Z)((0,_.Z)(r),"mParentObject",void 0),(0,l.Z)((0,_.Z)(r),"mName","SceneObject"),(0,l.Z)((0,_.Z)(r),"mReceiveShadow",!1),(0,l.Z)((0,_.Z)(r),"mCastShadow",!1),(0,l.Z)((0,_.Z)(r),"mHasModel",!1),(0,l.Z)((0,_.Z)(r),"mObjectLock",!1),(0,l.Z)((0,_.Z)(r),"mEnabled",!0),(0,l.Z)((0,_.Z)(r),"mVisible",!0),(0,l.Z)((0,_.Z)(r),"mIsPreset",!1),(0,l.Z)((0,_.Z)(r),"mLayers",void 0),(0,l.Z)((0,_.Z)(r),"mMetaData",{}),(0,l.Z)((0,_.Z)(r),"mUp",Bi.Up()),(0,l.Z)((0,_.Z)(r),"mTransform",new zi),(0,l.Z)((0,_.Z)(r),"mInitialTransform",new zi),(0,l.Z)((0,_.Z)(r),"mBoundingBox",new ji),(0,l.Z)((0,_.Z)(r),"mRawBoundingBox",new ji),(0,l.Z)((0,_.Z)(r),"mBoundingBoxNeedsUpdate",!0),(0,l.Z)((0,_.Z)(r),"mLocalGlobalStates",{}),(0,l.Z)((0,_.Z)(r),"mNeedsRenderUpdate",!1),r.mSceneObjectId=null==e?-r.getObjectId():e,r.mLayers=new Ui,r.mLayers.enable(0),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"parse",value:function(e,t,n){var r=this;this.onBeforeParse(e,t)&&Object.keys(e).forEach((function(t){r.setValue(t,e[t],!0)}))}},{key:"onBeforeParse",value:function(e,t){return this.setSyncHash(t),!e.object_updated_at||this.getServerSyncTime()!==e.object_updated_at}},{key:"serialize",value:function(e,t){var n;this.getParent()&&this.getParent().getParent()&&!this.getParent().isDerivedOfTypeName("ProductNode")&&(n=this.getParent().getSceneObjectId());var r=e?++x.e.ObjectIdCount:this.getObjectId();return{name:this.mName,parent_id:void 0!==n?n:null,object_cid:r,object_uuid:e?y.F.guid():this.getObjectUUID(),scene_object_id:e?-r:this.mSceneObjectId,receive_shadow:this.mReceiveShadow,cast_shadow:this.mCastShadow,properties:{object_lock:this.mObjectLock,is_preset:this.mIsPreset},has_model:this.mHasModel,position_x:this.mTransform.position.x,position_y:this.mTransform.position.y,position_z:this.mTransform.position.z,rotation_x:this.mTransform.rotation.x,rotation_y:this.mTransform.rotation.y,rotation_z:this.mTransform.rotation.z,quaternion_x:this.mTransform.quaternion.x,quaternion_y:this.mTransform.quaternion.y,quaternion_z:this.mTransform.quaternion.z,quaternion_w:this.mTransform.quaternion.w,scale_x:this.mTransform.scale.x,scale_y:this.mTransform.scale.y,scale_z:this.mTransform.scale.z,up_x:this.up.x,up_y:this.up.y,up_z:this.up.z,visible:this.mVisible}}},{key:"setValue",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.proxySetValue(e,t,n);return r&&this.markNeedsRenderUpdate(),r}},{key:"getValue",value:function(e){return this.proxyGetValue(e)}},{key:"proxySetValue",value:function(e,t,n){var r=this;switch(e){case"Name":case"name":return this.mName=String(t),!0;case"object_uuid":return this._setObjectUUID(t),!0;case"object_updated_at":return this.mServerSyncTime=t,!0;case"receive_shadow":case"receiveShadow":return this.mReceiveShadow=(0,f.oA)(t),!0;case"cast_shadow":case"castShadow":return this.mCastShadow=(0,f.oA)(t),!0;case"visible":return this.mVisible=Boolean(t),!0;case"has_model":case"hasModel":return this.mHasModel=(0,f.oA)(t),!0;case"object_lock":return this.mObjectLock=(0,f.oA)(t),!0;case"position_x":return this.mTransform.position.x=parseFloat(t),this.mInitialTransform.position.copy(this.mTransform.position),!0;case"position_y":return this.mTransform.position.y=parseFloat(t),this.mInitialTransform.position.copy(this.mTransform.position),!0;case"position_z":return this.mTransform.position.z=parseFloat(t),this.mInitialTransform.position.copy(this.mTransform.position),!0;case"rotation_x":return this.mTransform.rotation.x=parseFloat(t),this.mInitialTransform.rotation.copy(this.mTransform.rotation),!0;case"rotation_y":return this.mTransform.rotation.y=parseFloat(t),this.mInitialTransform.rotation.copy(this.mTransform.rotation),!0;case"rotation_z":return this.mTransform.rotation.z=parseFloat(t),this.mInitialTransform.rotation.copy(this.mTransform.rotation),!0;case"quaternion_x":return this.mTransform.quaternion.x=parseFloat(t),this.mInitialTransform.quaternion.copy(this.mTransform.quaternion),!0;case"quaternion_y":return this.mTransform.quaternion.y=parseFloat(t),this.mInitialTransform.quaternion.copy(this.mTransform.quaternion),!0;case"quaternion_z":return this.mTransform.quaternion.z=parseFloat(t),this.mInitialTransform.quaternion.copy(this.mTransform.quaternion),!0;case"quaternion_w":return this.mTransform.quaternion.w=parseFloat(t),this.mInitialTransform.quaternion.copy(this.mTransform.quaternion),!0;case"scale_x":return this.mTransform.scale.x=parseFloat(t),this.mInitialTransform.scale.copy(this.mTransform.scale),!0;case"scale_y":return this.mTransform.scale.y=parseFloat(t),this.mInitialTransform.scale.copy(this.mTransform.scale),!0;case"scale_z":return this.mTransform.scale.z=parseFloat(t),this.mInitialTransform.scale.copy(this.mTransform.scale),!0;case"up_x":return this.mUp.x=parseFloat(t),!0;case"up_y":return this.mUp.y=parseFloat(t),!0;case"up_z":return this.mUp.z=parseFloat(t),!0;case"position":return t&&t instanceof Bi?(this.mTransform.position.copy(t),this.mInitialTransform.position.copy(this.mTransform.position)):Array.isArray(t)&&t.length>2?(this.mTransform.position.fromArray(t),this.mInitialTransform.position.copy(this.mTransform.position)):t&&!0===t.isVector3?(this.mTransform.position.copy(t),this.mInitialTransform.position.copy(this.mTransform.position)):t&&!0===t.isVector2&&(this.mTransform.position.x=t.x,this.mTransform.position.y=t.y,this.mInitialTransform.position.copy(this.mTransform.position)),!0;case"rotation":return t&&t instanceof Li?(this.mTransform.rotation.copy(t),this.mInitialTransform.rotation.copy(this.mTransform.rotation)):Array.isArray(t)&&t.length>2?(this.mTransform.rotation.fromArray(t,Li.DefaultOrder),this.mInitialTransform.rotation.copy(this.mTransform.rotation)):t&&!0===t.isEuler&&(this.mTransform.rotation.copy(t),this.mInitialTransform.rotation.copy(this.mTransform.rotation)),!0;case"quaternion":return t&&t instanceof Pi?(this.mTransform.quaternion.copy(t),this.mInitialTransform.quaternion.copy(this.mTransform.quaternion)):Array.isArray(t)&&t.length>3?(this.mTransform.quaternion.fromArray(t),this.mInitialTransform.quaternion.copy(this.mTransform.quaternion)):t&&!0===t.isQuaternion&&(this.mTransform.quaternion.copy(t),this.mInitialTransform.quaternion.copy(this.mTransform.quaternion)),!0;case"scale":return t&&t instanceof Bi?(this.mTransform.scale.copy(t),this.mInitialTransform.scale.copy(this.mTransform.scale)):Array.isArray(t)&&t.length>2?(this.mTransform.scale.fromArray(t),this.mInitialTransform.scale.copy(this.mTransform.scale)):t&&!0===t.isVector3&&(this.mTransform.scale.copy(t),this.mInitialTransform.scale.copy(this.mTransform.scale)),!0;case"up":return t&&t instanceof Bi?this.mUp.copy(t):Array.isArray(t)&&t.length>2?this.mUp.fromArray(t):t&&!0===t.isVector3&&this.mUp.copy(t),!0;case"is_preset":return this.mIsPreset=Boolean(t),!0;case"properties":if(null!=t)try{var i={};i="string"==typeof t?JSON.parse(t):t,Object.keys(i).forEach((function(e){"properties"!==e?r.setValue(e,i[e],n):qe.qL.warn("Properties field can not contain key name properties")}))}catch(e){qe.qL.warn("Could not parse properties:",e)}return!0}return!1}},{key:"proxyGetValue",value:function(e){switch(e){case"Name":case"name":return this.mName;case"object_cid":return this.getObjectId();case"object_uuid":return this.getObjectUUID();case"server_sync_time":case"object_updated_at":return this.getServerSyncTime();case"receive_shadow":case"receiveShadow":return this.mReceiveShadow;case"cast_shadow":case"castShadow":return this.mCastShadow;case"visible":return this.mVisible;case"has_model":case"hasModel":return this.mHasModel;case"object_lock":return this.mObjectLock;case"position":return this.mTransform.position;case"position_x":return this.mTransform.position.x;case"position_y":return this.mTransform.position.y;case"position_z":return this.mTransform.position.z;case"rotation":return this.mTransform.rotation;case"rotation_x":return this.mTransform.rotation.x;case"rotation_y":return this.mTransform.rotation.y;case"rotation_z":return this.mTransform.rotation.z;case"quaternion":return this.mTransform.quaternion;case"quaternion_x":return this.mTransform.quaternion.x;case"quaternion_y":return this.mTransform.quaternion.y;case"quaternion_z":return this.mTransform.quaternion.z;case"quaternion_w":return this.mTransform.quaternion.w;case"scale":return this.mTransform.scale;case"scale_x":return this.mTransform.scale.x;case"scale_y":return this.mTransform.scale.y;case"scale_z":return this.mTransform.scale.z;case"up":return this.mUp;case"up_x":return this.mUp.x;case"up_y":return this.mUp.y;case"up_z":return this.mUp.z;case"is_preset":return this.mIsPreset}return null}},{key:"needsRenderUpdate",value:function(){return this.mNeedsRenderUpdate}},{key:"setNeedsRenderUpdate",value:function(e){this.mNeedsRenderUpdate=e,P.eventBus().dispatch(new Di(Ei.RequestFrame))}},{key:"markNeedsRenderUpdate",value:function(){this.setNeedsRenderUpdate(!0)}},{key:"needsBoundingBoxUpdate",value:function(){return this.mBoundingBoxNeedsUpdate}},{key:"markNeedsBoundingBoxUpdate",value:function(){this.mBoundingBoxNeedsUpdate=!0}},{key:"getSceneObjectId",value:function(){return this.mSceneObjectId}},{key:"setSceneObjectId",value:function(e){this.mSceneObjectId=e}},{key:"setSyncHash",value:function(e){this.mSyncHash=e}},{key:"getSyncHash",value:function(){return this.mSyncHash}},{key:"enabled",get:function(){var e=!this.getParent()||this.getParent().enabled;return this.mEnabled&&e},set:function(e){this.mEnabled!==e&&(this.mEnabled=e,this.markNeedsRenderUpdate())}},{key:"visible",get:function(){return this.mVisible},set:function(e){this.mVisible!==e&&(this.mVisible=e,this.markNeedsRenderUpdate(),P.eventBus().dispatch(new Hi,"".concat(this.getSceneObjectId())))}},{key:"getVisibility",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!!this.mVisible&&(!(this.mParentObject&&!e)||this.mParentObject.getVisibility())}},{key:"isInSyncWithHash",value:function(e){return this.mSyncHash===e}},{key:"getServerSyncTime",value:function(){return this.mServerSyncTime}},{key:"setParent",value:function(e){this.mParentObject=e}},{key:"getParent",value:function(){return this.mParentObject}},{key:"getRootParent",value:function(){return this.mParentObject?this.mParentObject.getRootParent():this}},{key:"findParentOfType",value:function(e){return this.findParentOfTypeName(e.getTypeName())}},{key:"findParentOfTypeName",value:function(e){for(var t,n=this.getParent();n;){if(n.isDerivedOfTypeName(e)){t=n;break}n=n.getParent()}return t}},{key:"findRootOfType",value:function(e){return this.findRootOfTypeName(e.getTypeName())}},{key:"findRootOfTypeName",value:function(e){for(var t,n=this.getParent();n;)n.isDerivedOfTypeName(e)&&(t=n),n=n.getParent();return t}},{key:"setGlobalState",value:function(e){this.mLocalGlobalStates[e.getType()]=e}},{key:"getGlobalState",value:function(e){return this.mLocalGlobalStates[e]}},{key:"removeGlobalState",value:function(e){delete this.mLocalGlobalStates[e]}},{key:"removeAllGlobalStates",value:function(){var e=this;Object.keys(this.mLocalGlobalStates).forEach((function(t){delete e.mLocalGlobalStates[t]}))}},{key:"fixedUpdate",value:function(e){this.onSceneFixedUpdate(e)}},{key:"onSceneFixedUpdate",value:function(e){this.dispatchMessageToComponents(e)}},{key:"beforeUpdate",value:function(e){this.enabled&&this.onBeforeSceneUpdate(e)}},{key:"afterUpdate",value:function(e){this.enabled&&this.onAfterSceneUpdate(e)}},{key:"update",value:function(e){this.enabled&&this.onSceneUpdate(e)}},{key:"onBeforeSceneUpdate",value:function(e){this.dispatchMessageToComponents(e)}},{key:"onSceneUpdate",value:function(e){this.updateMatrixLocal(),this.dispatchMessageToComponents(e),this.updateMatrixWorld()}},{key:"onAfterSceneUpdate",value:function(e){this.dispatchMessageToComponents(e)}},{key:"draw",value:function(e,t){this.enabled&&(this.onBeforeDraw(e,t),this.dispatchMessageToComponents(new de(e,t)),this.onDraw(e,t))}},{key:"afterDraw",value:function(e,t){this.enabled&&(this.dispatchMessageToComponents(new he(e,t)),this.onAfterDraw(e,t))}},{key:"onBeforeDraw",value:function(e,t){for(var n=0,r=Object.entries(this.mLocalGlobalStates);n<r.length;n++){var i=o(r[n],2)[1];e.pushGlobalState(i)}}},{key:"onDraw",value:function(e,t){}},{key:"onAfterDraw",value:function(e,t){for(var n=0,r=Object.entries(this.mLocalGlobalStates);n<r.length;n++){var i=o(r[n],2)[1];e.popGlobalState(i.getType())}}},{key:"getGarbageHash",value:function(){return this.getType().getTypeName()}},{key:"getGarbageTime",value:function(){return-1}},{key:"getTransform",value:function(){return this.mTransform}},{key:"transform",get:function(){return this.mTransform}},{key:"getUp",value:function(){return this.mUp}},{key:"up",get:function(){return this.mUp}},{key:"getInitialTransform",value:function(){return this.mInitialTransform}},{key:"initialTransform",get:function(){return this.mInitialTransform}},{key:"updateMatrixLocal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.mTransform.updateMatrix(e)}},{key:"updateMatrixWorld",value:function(){this.mParentObject&&this.mParentObject.updateMatrixWorld(),this.mParentObject?this.transform.updateMatrixWorld(this.mParentObject.transform.matrixWorld):this.transform.updateMatrixWorld()}},{key:"boundingBox",get:function(){return this.mBoundingBox}},{key:"getBoundingBox",value:function(){return!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?this.mBoundingBox:this.mRawBoundingBox}},{key:"_updateBoundingBox",value:function(e){this.mRawBoundingBox.copy(e),this.mBoundingBox.copy(e.clone().applyMatrix4(this.transform.matrix)),this.mBoundingBoxNeedsUpdate=!1,P.eventBus().dispatch(new Hi,"".concat(this.getSceneObjectId()))}},{key:"castShadow",get:function(){return this.mCastShadow},set:function(e){this.mCastShadow!==e&&(this.mCastShadow=e,this.markNeedsRenderUpdate())}},{key:"receiveShadow",get:function(){return this.mReceiveShadow},set:function(e){this.mReceiveShadow!==e&&(this.mReceiveShadow=e,this.markNeedsRenderUpdate())}},{key:"name",get:function(){return this.mName},set:function(e){this.mName!==e&&(this.mName=e,this.markNeedsRenderUpdate())}},{key:"layers",get:function(){return this.mLayers}},{key:"metaData",get:function(){return this.mMetaData}},{key:"isPreset",get:function(){return this.mIsPreset},set:function(e){this.mIsPreset=e}},{key:"onAttached",value:function(e){this.dispatchMessageToComponents(new be(e))}},{key:"onDetached",value:function(e){this.dispatchMessageToComponents(new _e(e))}},{key:"destroy",value:function(e,t){qe.qL.print("Destroying scene object:",this.mName,this.mSceneObjectId),this.enabled=!1,this.dispatchMessageToComponents(t||new pe),this.removeAllComponents(!0),this.mTransform.dispose(),this.mUp.onChange.unsubscribe(),this.mInitialTransform.onChange.unsubscribe()}}]),n}(ze.L);function Yi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Wi,"TypeRTTI",new k.r("SceneObject",ze.L.TypeRTTI)),function(e){e[e.Idle=0]="Idle",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.Failed=3]="Failed"}(qi||(qi={}));var Ki=function(e){(0,g.Z)(n,e);var t=Yi(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"mRenderObjectLoadState",qi.Idle),r.mName="SceneEntity",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"renderObjectLoadState",value:function(){return this.mRenderObjectLoadState}},{key:"setRenderObjectLoadState",value:function(e){this.mRenderObjectLoadState=e}}]),n}(Wi);(0,l.Z)(Ki,"TypeRTTI",new k.r("SceneEntity",Wi.TypeRTTI));var Xi=__webpack_require__(3722);function $i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Qi,Ji=function(e){(0,g.Z)(n,e);var t=$i(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"mNeedsRenderUpdate",!1),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"isAttachable",value:function(e){return e.isDerivedOfTypeName("CameraEntity")}},{key:"setValue",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.proxySetValue(e,t,n);return r&&this.markNeedsRenderUpdate(),r}},{key:"getValue",value:function(e){return this.proxyGetValue(e)}},{key:"proxySetValue",value:function(e,t){return"object_uuid"===e&&(this._setObjectUUID(t),!0)}},{key:"proxyGetValue",value:function(e){switch(e){case"camera-controls-name":return this.getComponentName();case"object_cid":return this.getObjectId();case"object_uuid":return this.getObjectUUID();default:return null}}},{key:"needsRenderUpdate",value:function(){return this.mNeedsRenderUpdate}},{key:"setNeedsRenderUpdate",value:function(e){this.mNeedsRenderUpdate=e,e||this.resetRenderFlags();var t=this.getParentObject();t&&e&&t.markNeedsRenderUpdate()}},{key:"markNeedsRenderUpdate",value:function(){this.setNeedsRenderUpdate(!0)}}]),n}(Xi.H);function ea(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Ji,"TypeRTTI",new k.r("CameraControlsComponent",Xi.H.TypeRTTI)),function(e){e.NONE="none",e.FRONT="front",e.LEFT="left",e.RIGHT="right",e.TOP="top",e.BOTTOM="bottom",e.BACK="back"}(Qi||(Qi={}));var ta=function(e){(0,g.Z)(n,e);var t=ea(n);function n(){return(0,u.Z)(this,n),t.call(this,n.mType)}return(0,c.Z)(n,null,[{key:"getTopicName",value:function(){return n.mType}}]),n}(Zi);function na(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(ta,"mType","CameraControlsChangedEvent");var ra,ia,aa=function(e){(0,g.Z)(n,e);var t=na(n);function n(){return(0,u.Z)(this,n),t.call(this,n.mType)}return(0,c.Z)(n,null,[{key:"getTopicName",value:function(){return n.mType}}]),n}(Zi);function oa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(aa,"mType","CameraControlsZoomEvent"),function(e){e[e.OrbitControls=0]="OrbitControls",e[e.FPSControls=1]="FPSControls",e[e.TurnTableControls=2]="TurnTableControls"}(ra||(ra={})),function(e){e.OrbitControls="orbit_controls",e.FPSControls="fps_controls",e.TurntableControls="turntable_controls"}(ia||(ia={}));var sa=function(e){(0,g.Z)(n,e);var t=oa(n);function n(){var e;return(0,u.Z)(this,n),e=t.call(this,"orbit-camera-controls"),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mBrokerSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mCamAnimate",void 0),(0,l.Z)((0,_.Z)(e),"mTransformControlChanged",void 0),(0,l.Z)((0,_.Z)(e),"mControlChange",void 0),(0,l.Z)((0,_.Z)(e),"mEnabled",!0),(0,l.Z)((0,_.Z)(e),"mTarget",void 0),(0,l.Z)((0,_.Z)(e),"mInitialTarget",void 0),(0,l.Z)((0,_.Z)(e),"mPanEnabled",!0),(0,l.Z)((0,_.Z)(e),"mPanSpeed",1),(0,l.Z)((0,_.Z)(e),"mRotateEnabled",!0),(0,l.Z)((0,_.Z)(e),"mRotationSpeed",1),(0,l.Z)((0,_.Z)(e),"mZoomEnabled",!0),(0,l.Z)((0,_.Z)(e),"mMaxZoom",1/0),(0,l.Z)((0,_.Z)(e),"mMinZoom",0),(0,l.Z)((0,_.Z)(e),"mZoomSpeed",1),(0,l.Z)((0,_.Z)(e),"mLockUpHemisphere",!1),(0,l.Z)((0,_.Z)(e),"mDampingEnabled",!0),(0,l.Z)((0,_.Z)(e),"mDampFactor",.1),(0,l.Z)((0,_.Z)(e),"mAutoRotateEnabled",!1),(0,l.Z)((0,_.Z)(e),"mAutoRotateSpeed",2),(0,l.Z)((0,_.Z)(e),"mMinAzimuthAngle",-1/0),(0,l.Z)((0,_.Z)(e),"mMaxAzimuthAngle",1/0),(0,l.Z)((0,_.Z)(e),"mMinPolarAngle",0),(0,l.Z)((0,_.Z)(e),"mMaxPolarAngle",Math.PI),(0,l.Z)((0,_.Z)(e),"mKeysEnabled",!0),(0,l.Z)((0,_.Z)(e),"needsSaveState",!1),(0,l.Z)((0,_.Z)(e),"needsResetState",!1),(0,l.Z)((0,_.Z)(e),"needsMouseResetState",!1),e.mCamAnimate=new Ht,e.mTransformControlChanged=new Ht,e.mControlChange=new Ht,e.mTarget=new Bi,e.mInitialTarget=new Bi,e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getControlsType",value:function(){return ia.OrbitControls}},{key:"OnAttached",value:function(){var e=this;this.registerMessageHandler(De.TypeRTTI,(function(t){t.reset&&e.resetState(),t.save&&e.saveState()})),this.registerMessageHandler(Le.TypeRTTI,(function(t){t.isTransformLocked||t.isTransformChanged?(e.mEnabled=!1,e.resetMouseState()):e.mEnabled=!0,t.isTransformLocked&&e.mControlChange.next(),e.mEnabled||e.mTransformControlChanged.next(),e.markNeedsRenderUpdate()})),this.mBrokerSubscriptions.push(P.eventBus().subscribe(ta.getTopicName(),(function(){e.dispatchMessage(new O)})),P.eventBus().subscribe(aa.getTopicName(),(function(){e.dispatchMessage(new E)})),P.eventBus().subscribe(Di.getTopicName(Ei.TransformControlChanged),(function(){e.mTransformControlChanged.next()})),P.messenger().listen(C.TypeRTTI,(function(){e.mCamAnimate.next()}))),this.mSubscriptions.push(this.mCamAnimate.pipe(Kt((function(){e.mEnabled=!1,e.markNeedsRenderUpdate()})),an(100)).subscribe((function(){e.mEnabled=!0,e.resetState()})),this.mTransformControlChanged.pipe(Kt((function(){e.mEnabled=!1,e.resetMouseState(),e.mControlChange.next()})),an(100)).subscribe((function(){e.mEnabled=!0,e.markNeedsRenderUpdate()})),this.mControlChange.pipe(Kt((function(){P.renderer().getRenderEngine().getUiRenderer().disableEvents()})),an(300)).subscribe((function(){P.renderer().getRenderEngine().getUiRenderer().enableEvents()})))}},{key:"OnDetached",value:function(){this.unregisterFromAllMessages(),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mBrokerSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"isControllerSupported",value:function(e){return e===ra.OrbitControls}},{key:"proxyGetValue",value:function(e){if((0,f.NT)(e)&&(0,f.HW)(e)===this.getControlsType()){switch((0,f.ii)(e)){case"enabled":return this.mEnabled;case"target":return this.mTarget;case"initial_target":return this.mInitialTarget;case"pan_enabled":return this.mPanEnabled;case"pan_speed":return this.mPanSpeed;case"rotate_enabled":return this.mRotateEnabled;case"rotation_speed":return this.mRotationSpeed;case"zoom_enabled":return this.mZoomEnabled;case"min_zoom":return this.mMinZoom;case"max_zoom":return this.mMaxZoom;case"zoom_speed":return this.mZoomSpeed;case"lock_up_hemisphere":return this.mLockUpHemisphere;case"min_azimuth_angle":return this.mMinAzimuthAngle;case"max_azimuth_angle":return this.mMaxAzimuthAngle;case"min_polar_angle":return this.mMinPolarAngle;case"max_polar_angle":return this.mMaxPolarAngle;case"damping_enabled":return this.mDampingEnabled;case"damp_factor":return this.mDampFactor;case"auto_rotate":case"auto_rotate_enabled":return this.mAutoRotateEnabled;case"auto_rotate_speed":return this.mAutoRotateSpeed;case"keys_enabled":return this.mKeysEnabled;case"save_state":return this.needsSaveState;case"reset_state":return this.needsResetState;case"reset_state_mouse":return this.needsMouseResetState}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}switch(e){case"enabled":return this.mEnabled;case"target":return this.mTarget;case"initial_target":return this.mInitialTarget;case"pan_disabled":return!this.mPanEnabled;case"min_zoom":return this.mMinZoom;case"max_zoom":return this.mMaxZoom;case"zoom_speed":return this.mZoomSpeed;case"lockup_hemisphere":return this.mLockUpHemisphere;case"min_azimuth_angle":return this.mMinAzimuthAngle;case"max_azimuth_angle":return this.mMaxAzimuthAngle;case"min_polar_angle":return this.mMinPolarAngle;case"max_polar_angle":return this.mMaxPolarAngle;case"save_state":return this.needsSaveState;case"reset_state":return this.needsResetState;case"reset_state_mouse":return this.needsMouseResetState}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}},{key:"proxySetValue",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,f.NT)(e)&&(0,f.HW)(e)===this.getControlsType()){switch((0,f.ii)(e)){case"enabled":return this.mEnabled=!!t,!0;case"target":return Array.isArray(t)&&t.length>2?this.mTarget.fromArray(t):(t&&t instanceof Bi||t&&t.isVector3)&&this.mTarget.copy(t),r&&this.mInitialTarget.copy(this.mTarget),!0;case"target_x":return(0,f.kE)(t)&&(this.mTarget.x=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"target_y":return(0,f.kE)(t)&&(this.mTarget.y=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"target_z":return(0,f.kE)(t)&&(this.mTarget.z=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"pan_enabled":return this.mPanEnabled=!!t,!0;case"pan_speed":return(0,f.kE)(t)&&(this.mPanSpeed=parseFloat(t)),!0;case"rotate_enabled":case"rotation_enabled":return this.mRotateEnabled=!!t,!0;case"rotate_speed":case"rotation_speed":return(0,f.kE)(t)&&(this.mRotationSpeed=parseFloat(t)),!0;case"zoom_enabled":return this.mZoomEnabled=!!t,!0;case"min_zoom":return(0,f.kE)(t)&&(this.mMinZoom=Math.max(parseFloat(t),0)),!0;case"max_zoom":return null===t?this.mMaxZoom=1/0:(0,f.kE)(t)&&(this.mMaxZoom=parseFloat(t)),!0;case"zoom_speed":return(0,f.kE)(t)&&(this.mZoomSpeed=parseFloat(t)),!0;case"lock_up_hemisphere":return this.mLockUpHemisphere=!!t,!0;case"min_azimuth_angle":return null===t?this.mMinAzimuthAngle=-1/0:(0,f.kE)(t)&&(this.mMinAzimuthAngle=parseFloat(t)),!0;case"max_azimuth_angle":return null===t?this.mMaxAzimuthAngle=1/0:(0,f.kE)(t)&&(this.mMaxAzimuthAngle=parseFloat(t)),!0;case"min_polar_angle":return(0,f.kE)(t)&&(this.mMinPolarAngle=Dt(parseFloat(t),0,Math.PI)),!0;case"max_polar_angle":return(0,f.kE)(t)&&(this.mMaxPolarAngle=Dt(parseFloat(t),0,Math.PI)),!0;case"damping_enabled":return this.mDampingEnabled=!!t,!0;case"damp_factor":return(0,f.kE)(t)&&(this.mDampFactor=parseFloat(t)),!0;case"auto_rotate":case"auto_rotate_enabled":return this.mAutoRotateEnabled=!!t,!0;case"auto_rotate_speed":return(0,f.kE)(t)&&(this.mAutoRotateSpeed=parseFloat(t)),!0;case"keys_enabled":return this.mKeysEnabled=!!t,!0}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}switch(e){case"enabled":return this.mEnabled=!!t,!0;case"target":return Array.isArray(t)&&t.length>2?this.mTarget.fromArray(t):(t&&t instanceof Bi||t&&t.isVector3)&&this.mTarget.copy(t),r&&this.mInitialTarget.copy(this.mTarget),!0;case"cam_target_x":case"target_x":return(0,f.kE)(t)&&(this.mTarget.x=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"cam_target_y":case"target_y":return(0,f.kE)(t)&&(this.mTarget.y=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"cam_target_z":case"target_z":return(0,f.kE)(t)&&(this.mTarget.z=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"pan_disabled":return this.mPanEnabled=!t,!0;case"min_zoom":return(0,f.kE)(t)&&(this.mMinZoom=Math.max(parseFloat(t),0)),!0;case"max_zoom":return null===t?this.mMaxZoom=1/0:(0,f.kE)(t)&&(this.mMaxZoom=parseFloat(t)),!0;case"zoom_speed":return(0,f.kE)(t)&&(this.mZoomSpeed=parseFloat(t)),!0;case"lockup_hemisphere":return this.mLockUpHemisphere=!!t,!0;case"min_azimuth_angle":return null===t?this.mMinAzimuthAngle=-1/0:(0,f.kE)(t)&&(this.mMinAzimuthAngle=parseFloat(t)),!0;case"max_azimuth_angle":return null===t?this.mMaxAzimuthAngle=1/0:(0,f.kE)(t)&&(this.mMaxAzimuthAngle=parseFloat(t)),!0;case"min_polar_angle":return(0,f.kE)(t)&&(this.mMinPolarAngle=Dt(parseFloat(t),0,Math.PI)),!0;case"max_polar_angle":return(0,f.kE)(t)&&(this.mMaxPolarAngle=Dt(parseFloat(t),0,Math.PI)),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"parse",value:function(e,t,n){var r=this;e&&this.getControlsType()in e&&Object.keys(e[this.getControlsType()]).forEach((function(t){r.setValue("".concat(r.getControlsType(),".").concat(t),e[r.getControlsType()][t],!0)}))}},{key:"serialize",value:function(e,t){return{enabled:this.mEnabled,pan_enabled:this.mPanEnabled,pan_speed:this.mPanSpeed,rotate_enabled:this.mRotateEnabled,rotation_speed:this.mRotationSpeed,zoom_enabled:this.mZoomEnabled,zoom_speed:this.mZoomSpeed,min_zoom:this.mMinZoom,max_zoom:isFinite(this.mMaxZoom)&&null!==this.mMaxZoom?this.mMaxZoom:null,lock_up_hemisphere:this.mLockUpHemisphere,damping_enabled:this.mDampingEnabled,damp_factor:this.mDampFactor,auto_rotate_enabled:this.mAutoRotateEnabled,auto_rotate_speed:this.mAutoRotateSpeed,min_azimuth_angle:isFinite(this.mMinAzimuthAngle)&&null!==this.mMinAzimuthAngle?this.mMinAzimuthAngle:null,max_azimuth_angle:isFinite(this.mMaxAzimuthAngle)&&null!==this.mMaxAzimuthAngle?this.mMaxAzimuthAngle:null,min_polar_angle:this.mMinPolarAngle,max_polar_angle:this.mMaxPolarAngle,keys_enabled:this.mKeysEnabled,target:this.mTarget.toArray()}}},{key:"saveState",value:function(){this.needsSaveState=!0,this.markNeedsRenderUpdate()}},{key:"resetState",value:function(){this.needsResetState=!0,this.markNeedsRenderUpdate()}},{key:"resetMouseState",value:function(){this.needsMouseResetState=!0,this.markNeedsRenderUpdate()}},{key:"resetRenderFlags",value:function(){this.needsSaveState=!1,this.needsResetState=!1,this.needsMouseResetState=!1}},{key:"enabled",get:function(){return this.mEnabled},set:function(e){this.mEnabled=e,this.markNeedsRenderUpdate()}},{key:"panEnabled",get:function(){return this.mPanEnabled},set:function(e){this.mPanEnabled=e,this.markNeedsRenderUpdate()}},{key:"panSpeed",get:function(){return this.mPanSpeed},set:function(e){this.mPanSpeed=e,this.markNeedsRenderUpdate()}},{key:"rotateEnabled",get:function(){return this.mRotateEnabled},set:function(e){this.mRotateEnabled=e,this.markNeedsRenderUpdate()}},{key:"rotateSpeed",get:function(){return this.mRotationSpeed},set:function(e){this.mRotationSpeed=e,this.markNeedsRenderUpdate()}},{key:"zoomEnabled",get:function(){return this.mZoomEnabled},set:function(e){this.mZoomEnabled=e,this.markNeedsRenderUpdate()}},{key:"zoomSpeed",get:function(){return this.mZoomSpeed},set:function(e){this.mZoomSpeed=e,this.markNeedsRenderUpdate()}},{key:"zoomMin",get:function(){return this.mMinZoom},set:function(e){this.mMinZoom=e,this.markNeedsRenderUpdate()}},{key:"zoomMax",get:function(){return this.mMaxZoom},set:function(e){this.mMaxZoom=e,this.markNeedsRenderUpdate()}},{key:"isUpHemisphereLocked",get:function(){return this.mLockUpHemisphere}},{key:"lockUpHemisphere",set:function(e){this.mLockUpHemisphere=e,this.markNeedsRenderUpdate()}},{key:"azimuthAngleMin",get:function(){return this.mMinAzimuthAngle},set:function(e){this.mMinAzimuthAngle=e,this.markNeedsRenderUpdate()}},{key:"azimuthAngleMax",get:function(){return this.mMaxAzimuthAngle},set:function(e){this.mMaxAzimuthAngle=e,this.markNeedsRenderUpdate()}},{key:"polarAngleMin",get:function(){return this.mMinPolarAngle},set:function(e){this.mMinPolarAngle=e,this.markNeedsRenderUpdate()}},{key:"polarAngleMax",get:function(){return this.mMaxPolarAngle},set:function(e){this.mMaxPolarAngle=e,this.markNeedsRenderUpdate()}},{key:"dampingEnabled",get:function(){return this.mDampingEnabled},set:function(e){this.mDampingEnabled=e,this.markNeedsRenderUpdate()}},{key:"dampingFactor",get:function(){return this.mDampFactor},set:function(e){this.mDampFactor=e,this.markNeedsRenderUpdate()}},{key:"autoRotateEnabled",get:function(){return this.mAutoRotateEnabled},set:function(e){this.mAutoRotateEnabled=e,this.markNeedsRenderUpdate()}},{key:"autoRotateSpeed",get:function(){return this.mAutoRotateSpeed},set:function(e){this.mAutoRotateSpeed=e,this.markNeedsRenderUpdate()}},{key:"keyboardEnabled",get:function(){return this.mKeysEnabled},set:function(e){this.mKeysEnabled=e,this.markNeedsRenderUpdate()}}]),n}(Ji);function ua(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(sa,"TypeRTTI",new k.r("OrbitControlsComponent",Ji.TypeRTTI));var ca,la=function(e){(0,g.Z)(n,e);var t=ua(n);function n(){var e;return(0,u.Z)(this,n),e=t.call(this,"fps-camera-controls"),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mCamAnimate",void 0),(0,l.Z)((0,_.Z)(e),"mTransformControlChanged",void 0),(0,l.Z)((0,_.Z)(e),"mEnabled",!0),(0,l.Z)((0,_.Z)(e),"mTarget",void 0),(0,l.Z)((0,_.Z)(e),"mInitialTarget",void 0),(0,l.Z)((0,_.Z)(e),"mMovementSpeed",5),(0,l.Z)((0,_.Z)(e),"mConstrainVertical",!1),(0,l.Z)((0,_.Z)(e),"mKeysEnabled",!0),(0,l.Z)((0,_.Z)(e),"mLookSpeed",.75),(0,l.Z)((0,_.Z)(e),"needsResizeUpdate",!1),(0,l.Z)((0,_.Z)(e),"needsResetState",!1),e.mCamAnimate=new Ht,e.mTransformControlChanged=new Ht,e.mTarget=new Bi,e.mInitialTarget=new Bi,e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getControlsType",value:function(){return ia.FPSControls}},{key:"OnAttached",value:function(){var e=this;this.registerMessageHandler(C.TypeRTTI,(function(){e.mCamAnimate.next()})),this.registerMessageHandler(Ae.TypeRTTI,(function(){e.needsResizeUpdate=!0,e.markNeedsRenderUpdate()})),this.registerMessageHandler(Z.TypeRTTI,(function(){e.needsResizeUpdate=!0,e.markNeedsRenderUpdate()})),this.registerMessageHandler(De.TypeRTTI,(function(t){t.reset&&e.resetState()})),this.registerMessageHandler(Le.TypeRTTI,(function(t){e.mEnabled=!(t.isTransformLocked||t.isTransformChanged),e.mEnabled||e.mTransformControlChanged.next(),e.markNeedsRenderUpdate()})),P.eventBus().subscribe(ta.getTopicName(),(function(){e.dispatchMessage(new O)})),P.eventBus().subscribe(aa.getTopicName(),(function(){e.dispatchMessage(new E)})),this.mSubscriptions.push(this.mCamAnimate.pipe(Kt((function(){e.mEnabled=!1,e.markNeedsRenderUpdate()})),an(100)).subscribe((function(){e.mEnabled=!0,e.resetState()})),this.mTransformControlChanged.pipe(Kt((function(){e.mEnabled=!1})),an(100)).subscribe((function(){e.mEnabled=!0,e.markNeedsRenderUpdate()})))}},{key:"OnDetached",value:function(){this.unregisterFromAllMessages(),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"isControllerSupported",value:function(e){return e===ra.FPSControls}},{key:"proxyGetValue",value:function(e){if((0,f.NT)(e)&&(0,f.HW)(e)===this.getControlsType()){switch((0,f.ii)(e)){case"enabled":return this.mEnabled;case"target":return this.mTarget;case"initial_target":return this.mInitialTarget;case"movement_speed":return this.mMovementSpeed;case"look_speed":return this.mLookSpeed;case"constrain_vertical":return this.mConstrainVertical;case"keys_enabled":return this.mKeysEnabled;case"resize_update":return this.needsResizeUpdate;case"reset_state":return this.needsResetState}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}switch(e){case"enabled":return this.mEnabled;case"target":return this.mTarget;case"initial_target":return this.mInitialTarget;case"resize_update":return this.needsResizeUpdate;case"reset_state":return this.needsResetState}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}},{key:"proxySetValue",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,f.NT)(e)&&(0,f.HW)(e)===this.getControlsType()){switch((0,f.ii)(e)){case"enabled":return this.mEnabled=!!t,!0;case"target":return Array.isArray(t)&&t.length>2?this.mTarget.fromArray(t):(t&&t instanceof Bi||t&&t.isVector3)&&this.mTarget.copy(t),r&&this.mInitialTarget.copy(this.mTarget),!0;case"target_x":return(0,f.kE)(t)&&(this.mTarget.x=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"target_y":return(0,f.kE)(t)&&(this.mTarget.y=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"target_z":return(0,f.kE)(t)&&(this.mTarget.z=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"movement_speed":return this.mMovementSpeed=parseFloat(t),!0;case"look_speed":return this.mLookSpeed=parseFloat(t),!0;case"constrain_vertical":return this.mConstrainVertical=!!t,!0;case"keys_enabled":return this.mKeysEnabled=t,!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}switch(e){case"enabled":return this.mEnabled=!!t,!0;case"target":return Array.isArray(t)&&t.length>2?this.mTarget.fromArray(t):(t&&t instanceof Bi||t&&t.isVector3)&&this.mTarget.copy(t),r&&this.mInitialTarget.copy(this.mTarget),!0;case"cam_target_x":case"target_x":return(0,f.kE)(t)&&(this.mTarget.x=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"cam_target_y":case"target_y":return(0,f.kE)(t)&&(this.mTarget.y=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"cam_target_z":case"target_z":return(0,f.kE)(t)&&(this.mTarget.z=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"parse",value:function(e,t,n){var r=this;e&&this.getControlsType()in e&&Object.keys(e[this.getControlsType()]).forEach((function(t){r.setValue("".concat(r.getControlsType(),".").concat(t),e[r.getControlsType()][t],!0)}))}},{key:"serialize",value:function(e,t){return{enabled:this.mEnabled,movement_speed:this.mMovementSpeed,constrain_vertical:this.mConstrainVertical,keys_enabled:this.mKeysEnabled,look_speed:this.mLookSpeed,target:this.mTarget.toArray()}}},{key:"resetState",value:function(){this.needsResetState=!0,this.markNeedsRenderUpdate()}},{key:"resetRenderFlags",value:function(){this.needsResetState=!1,this.needsResizeUpdate=!1}},{key:"enabled",get:function(){return this.mEnabled},set:function(e){this.mEnabled=e,this.markNeedsRenderUpdate()}},{key:"movementSpeed",get:function(){return this.mMovementSpeed},set:function(e){this.mMovementSpeed=e,this.markNeedsRenderUpdate()}},{key:"constrainVertical",get:function(){return this.mConstrainVertical},set:function(e){this.mConstrainVertical=e,this.markNeedsRenderUpdate()}},{key:"lookSpeed",get:function(){return this.mLookSpeed},set:function(e){this.mLookSpeed=e,this.markNeedsRenderUpdate()}},{key:"keyboardEnabled",get:function(){return this.mKeysEnabled},set:function(e){this.mKeysEnabled=e,this.markNeedsRenderUpdate()}}]),n}(Ji);function ha(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(la,"TypeRTTI",new k.r("FPSControlsComponent",Ji.TypeRTTI)),function(e){e[e.Phi=0]="Phi",e[e.Theta=1]="Theta"}(ca||(ca={}));var fa=function(e){(0,g.Z)(n,e);var t=ha(n);function n(){var e;return(0,u.Z)(this,n),e=t.call(this,"turntable-camera-controls"),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mCamAnimate",void 0),(0,l.Z)((0,_.Z)(e),"mTransformControlChanged",void 0),(0,l.Z)((0,_.Z)(e),"mEnabled",!1),(0,l.Z)((0,_.Z)(e),"mTarget",void 0),(0,l.Z)((0,_.Z)(e),"mInitialTarget",void 0),(0,l.Z)((0,_.Z)(e),"mZoomEnabled",!1),(0,l.Z)((0,_.Z)(e),"mMaxZoom",1/0),(0,l.Z)((0,_.Z)(e),"mMinZoom",0),(0,l.Z)((0,_.Z)(e),"mDirection",ca.Theta),(0,l.Z)((0,_.Z)(e),"mMinPolarAngle",-1/0),(0,l.Z)((0,_.Z)(e),"mMaxPolarAngle",1/0),(0,l.Z)((0,_.Z)(e),"mMinAzimuthAngle",-1/0),(0,l.Z)((0,_.Z)(e),"mMaxAzimuthAngle",1/0),(0,l.Z)((0,_.Z)(e),"mDampingEnabled",!1),(0,l.Z)((0,_.Z)(e),"mDampFactor",.05),(0,l.Z)((0,_.Z)(e),"mRotationSpeed",.1),(0,l.Z)((0,_.Z)(e),"mActiveObject",void 0),(0,l.Z)((0,_.Z)(e),"needsSaveState",!1),(0,l.Z)((0,_.Z)(e),"needsResetState",!1),(0,l.Z)((0,_.Z)(e),"needsActiveObjectUpdate",!1),e.mTarget=new Bi(0,0,0),e.mInitialTarget=new Bi,e.mCamAnimate=new Ht,e.mTransformControlChanged=new Ht,e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getControlsType",value:function(){return ia.TurntableControls}},{key:"OnAttached",value:function(){var e=this;if(this.registerMessageHandler(C.TypeRTTI,(function(){e.mCamAnimate.next()})),this.registerMessageHandler(De.TypeRTTI,(function(t){t.reset&&e.resetState(),t.save&&e.saveState()})),this.registerMessageHandler(Le.TypeRTTI,(function(t){e.mEnabled=!(t.isTransformLocked||t.isTransformChanged),e.mEnabled||e.mTransformControlChanged.next(),e.markNeedsRenderUpdate()})),P.eventBus().subscribe(ta.getTopicName(),(function(){e.dispatchMessage(new O)})),P.eventBus().subscribe(aa.getTopicName(),(function(){e.dispatchMessage(new E)})),this.mSubscriptions.push(this.mCamAnimate.pipe(Kt((function(){e.mEnabled=!1,e.markNeedsRenderUpdate()})),an(100)).subscribe((function(){e.mEnabled=!0,e.resetState()}))),!this.mActiveObject){var t=P.sceneManager().getRootProductNode();t&&(this.mActiveObject=t,this.attachControls())}}},{key:"OnDetached",value:function(){this.unregisterFromAllMessages(),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"isControllerSupported",value:function(e){return e===ra.TurnTableControls}},{key:"proxyGetValue",value:function(e){if((0,f.NT)(e)&&(0,f.HW)(e)===this.getControlsType()){switch((0,f.ii)(e)){case"enabled":return this.mEnabled;case"target":return this.mTarget;case"initial_target":return this.mInitialTarget;case"zoom_enabled":return this.mZoomEnabled;case"min_zoom":return this.mMinZoom;case"max_zoom":return this.mMaxZoom;case"direction":return this.mDirection;case"min_polar_angle":return this.mMinPolarAngle;case"max_polar_angle":return this.mMaxPolarAngle;case"min_azimuth_angle":return this.mMinAzimuthAngle;case"max_azimuth_angle":return this.mMaxAzimuthAngle;case"damping_enabled":return this.mDampingEnabled;case"damp_factor":return this.mDampFactor;case"rotation_speed":return this.mRotationSpeed;case"active_object":return this.mActiveObject;case"save_state":return this.needsSaveState;case"reset_state":return this.needsResetState;case"active_object_update":return this.needsActiveObjectUpdate}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}switch(e){case"enabled":return this.mEnabled;case"target":return this.mTarget;case"initial_target":return this.mInitialTarget;case"min_zoom":return this.mMinZoom;case"max_zoom":return this.mMaxZoom;case"direction":return this.mDirection;case"min_polar_angle":return this.mMinPolarAngle;case"max_polar_angle":return this.mMaxPolarAngle;case"min_azimuth_angle":return this.mMinAzimuthAngle;case"max_azimuth_angle":return this.mMaxAzimuthAngle;case"damp_enabled":return this.mDampingEnabled;case"damp_factor":return this.mDampFactor;case"rotation_speed":return this.mRotationSpeed;case"active_object":return this.mActiveObject;case"save_state":return this.needsSaveState;case"reset_state":return this.needsResetState;case"active_object_update":return this.needsActiveObjectUpdate}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}},{key:"proxySetValue",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,f.NT)(e)&&(0,f.HW)(e)===this.getControlsType()){switch((0,f.ii)(e)){case"enabled":return this.mEnabled=!!t,!0;case"target":return Array.isArray(t)&&t.length>2?this.mTarget.fromArray(t):(t&&t instanceof Bi||t&&t.isVector3)&&this.mTarget.copy(t),r&&this.mInitialTarget.copy(this.mTarget),!0;case"target_x":return(0,f.kE)(t)&&(this.mTarget.x=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"target_y":return(0,f.kE)(t)&&(this.mTarget.y=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"target_z":return(0,f.kE)(t)&&(this.mTarget.z=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"zoom_enabled":return this.mZoomEnabled=!!t,!0;case"min_zoom":return(0,f.kE)(t)&&(this.mMinZoom=parseFloat(t)),!0;case"max_zoom":return null===t?this.mMaxZoom=1/0:(0,f.kE)(t)&&(this.mMaxZoom=parseFloat(t)),!0;case"direction":return(0,f.kE)(t)?this.mDirection=parseInt(t,10):"string"==typeof t&&("phi"===t?this.mDirection=ca.Phi:"theta"===t&&(this.mDirection=ca.Theta)),!0;case"min_polar_angle":return null===t?this.mMinPolarAngle=-1/0:(0,f.kE)(t)&&(this.mMinPolarAngle=parseFloat(t)),!0;case"max_polar_angle":return null===t?this.mMaxPolarAngle=1/0:(0,f.kE)(t)&&(this.mMaxPolarAngle=parseFloat(t)),!0;case"min_azimuth_angle":return null===t?this.mMinAzimuthAngle=-1/0:(0,f.kE)(t)&&(this.mMinAzimuthAngle=parseFloat(t)),!0;case"max_azimuth_angle":return null===t?this.mMaxAzimuthAngle=1/0:(0,f.kE)(t)&&(this.mMaxAzimuthAngle=parseFloat(t)),!0;case"damping_enabled":return this.mDampingEnabled=!!t,!0;case"damp_factor":return(0,f.kE)(t)&&(this.mDampFactor=parseFloat(t)),!0;case"rotation_speed":return(0,f.kE)(t)&&(this.mRotationSpeed=parseFloat(t)),!0;case"active_object":return this.mActiveObject=t,!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}switch(e){case"enabled":return this.mEnabled=!!t,!0;case"target":return Array.isArray(t)&&t.length>2?this.mTarget.fromArray(t):(t&&t instanceof Bi||t&&t.isVector3)&&this.mTarget.copy(t),r&&this.mInitialTarget.copy(this.mTarget),!0;case"cam_target_x":case"target_x":return(0,f.kE)(t)&&(this.mTarget.x=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"cam_target_y":case"target_y":return(0,f.kE)(t)&&(this.mTarget.y=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"cam_target_z":case"target_z":return(0,f.kE)(t)&&(this.mTarget.z=parseFloat(t),r&&this.mInitialTarget.copy(this.mTarget)),!0;case"min_zoom":return(0,f.kE)(t)&&(this.mMinZoom=parseFloat(t)),!0;case"max_zoom":return null===t?this.mMaxZoom=1/0:(0,f.kE)(t)&&(this.mMaxZoom=parseFloat(t)),!0;case"direction":return(0,f.kE)(t)?this.mDirection=parseInt(t,10):"string"==typeof t&&("phi"===t?this.mDirection=ca.Phi:"theta"===t&&(this.mDirection=ca.Theta)),!0;case"min_polar_angle":return null===t?this.mMinPolarAngle=-1/0:(0,f.kE)(t)&&(this.mMinPolarAngle=parseFloat(t)),!0;case"max_polar_angle":return null===t?this.mMaxPolarAngle=1/0:(0,f.kE)(t)&&(this.mMaxPolarAngle=parseFloat(t)),!0;case"min_azimuth_angle":return null===t?this.mMinAzimuthAngle=-1/0:(0,f.kE)(t)&&(this.mMinAzimuthAngle=parseFloat(t)),!0;case"max_azimuth_angle":return null===t?this.mMaxAzimuthAngle=1/0:(0,f.kE)(t)&&(this.mMaxAzimuthAngle=parseFloat(t)),!0;case"damp_enabled":return this.mDampingEnabled=!!t,!0;case"damp_factor":return(0,f.kE)(t)&&(this.mDampFactor=parseFloat(t)),!0;case"rotation_speed":return(0,f.kE)(t)&&(this.mRotationSpeed=parseFloat(t)),!0;case"active_object":return this.mActiveObject=t,!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"parse",value:function(e,t,n){var r=this;e&&this.getControlsType()in e&&Object.keys(e[this.getControlsType()]).forEach((function(t){r.setValue("".concat(r.getControlsType(),".").concat(t),e[r.getControlsType()][t],!0)}))}},{key:"serialize",value:function(e,t){return{enabled:this.mEnabled,zoom_enabled:this.mZoomEnabled,min_zoom:this.mMinZoom,max_zoom:isFinite(this.mMaxZoom)&&null!==this.mMaxZoom?this.mMaxZoom:null,direction:this.mDirection===ca.Phi?"phi":"theta",min_azimuth_angle:isFinite(this.mMinAzimuthAngle)&&null!==this.mMinAzimuthAngle?this.mMinAzimuthAngle:null,max_azimuth_angle:isFinite(this.mMaxAzimuthAngle)&&null!==this.mMaxAzimuthAngle?this.mMaxAzimuthAngle:null,min_polar_angle:isFinite(this.mMinPolarAngle)&&null!==this.mMinPolarAngle?this.mMinPolarAngle:null,max_polar_angle:isFinite(this.mMaxPolarAngle)&&null!==this.mMaxPolarAngle?this.mMaxPolarAngle:null,damping_enabled:this.mDampingEnabled,damp_factor:this.mDampFactor,rotation_speed:this.mRotationSpeed,target:this.mTarget.toArray()}}},{key:"attachControls",value:function(){this.needsActiveObjectUpdate=!0,this.mEnabled=!0,this.markNeedsRenderUpdate()}},{key:"detachControls",value:function(){this.mActiveObject=null,this.needsActiveObjectUpdate=!0,this.mEnabled=!1,this.markNeedsRenderUpdate()}},{key:"saveState",value:function(){this.needsSaveState=!0,this.markNeedsRenderUpdate()}},{key:"resetState",value:function(){this.needsResetState=!0,this.markNeedsRenderUpdate()}},{key:"resetRenderFlags",value:function(){this.needsSaveState=!1,this.needsResetState=!1}},{key:"enabled",get:function(){return this.mEnabled},set:function(e){this.mEnabled=e,this.markNeedsRenderUpdate()}},{key:"zoomEnabled",get:function(){return this.mZoomEnabled},set:function(e){this.mZoomEnabled=e,this.markNeedsRenderUpdate()}},{key:"zoomMin",get:function(){return this.mMinZoom},set:function(e){this.mMinZoom=e,this.markNeedsRenderUpdate()}},{key:"zoomMax",get:function(){return this.mMaxZoom},set:function(e){this.mMaxZoom=e,this.markNeedsRenderUpdate()}},{key:"direction",get:function(){return this.mDirection},set:function(e){this.mDirection=e,this.markNeedsRenderUpdate()}},{key:"azimuthAngleMin",get:function(){return this.mMinAzimuthAngle},set:function(e){this.mMinAzimuthAngle=e,this.markNeedsRenderUpdate()}},{key:"azimuthAngleMax",get:function(){return this.mMaxAzimuthAngle},set:function(e){this.mMaxAzimuthAngle=e,this.markNeedsRenderUpdate()}},{key:"polarAngleMin",get:function(){return this.mMinPolarAngle},set:function(e){this.mMinPolarAngle=e,this.markNeedsRenderUpdate()}},{key:"polarAngleMax",get:function(){return this.mMaxPolarAngle},set:function(e){this.mMaxPolarAngle=e,this.markNeedsRenderUpdate()}},{key:"dampingEnabled",get:function(){return this.mDampingEnabled},set:function(e){this.mDampingEnabled=e,this.markNeedsRenderUpdate()}},{key:"dampingFactor",get:function(){return this.mDampFactor},set:function(e){this.mDampFactor=e,this.markNeedsRenderUpdate()}},{key:"rotationSpeed",get:function(){return this.mRotationSpeed},set:function(e){this.mRotationSpeed=e,this.markNeedsRenderUpdate()}}]),n}(Ji);function pa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ma(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pa(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function da(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return va(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return va(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function va(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ya(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(fa,"TypeRTTI",new k.r("TurntableControlsComponent",Ji.TypeRTTI));var ga=function(e){(0,g.Z)(n,e);var t=ya(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"mNear",.1),(0,l.Z)((0,_.Z)(r),"mFar",1e3),(0,l.Z)((0,_.Z)(r),"mAspectRatio",1),(0,l.Z)((0,_.Z)(r),"mZoom",1),(0,l.Z)((0,_.Z)(r),"mController",ra.OrbitControls),(0,l.Z)((0,_.Z)(r),"mActive",!1),(0,l.Z)((0,_.Z)(r),"mIsPartOfScene",!0),(0,l.Z)((0,_.Z)(r),"mNeedsUpdateProjectionMatrix",!1),(0,l.Z)((0,_.Z)(r),"mTarget",new Bi),(0,l.Z)((0,_.Z)(r),"mInitialTarget",new Bi),(0,l.Z)((0,_.Z)(r),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(r),"mAutoFocus",Qi.NONE),(0,l.Z)((0,_.Z)(r),"mAutoFocusNeedsUpdate",!0),r.mName="CameraEntity",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getCameraTechnique",value:function(){return this.mTechnique}},{key:"onDraw",value:function(e,t){Ni((0,M.Z)(n.prototype),"onDraw",this).call(this,e,t),this.mActive&&e.addCamera(this)}},{key:"destroy",value:function(e,t){Ni((0,M.Z)(n.prototype),"destroy",this).call(this,e,t),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"proxyGetValue",value:function(e){var t,r=da(this.getComponents(Ji.TypeRTTI));try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.isControllerSupported(this.mController)){var a=i.getValue(e);if(null!==a)return a}}}catch(e){r.e(e)}finally{r.f()}switch(e){case"cam_controller":return this.mController;case"camera_active":case"active":return this.mActive;case"near":return this.mNear;case"far":return this.mFar;case"aspect_ratio":return this.mAspectRatio;case"zoom":return this.mZoom;case"target":return this.mTarget;case"initial_target":return this.mInitialTarget;case"auto_focus":return this.mAutoFocus}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}},{key:"proxySetValue",value:function(e,t,r){var i=this,a=this.getComponents(Ji.TypeRTTI),o=!1;if(a.forEach((function(n){n.isControllerSupported(i.mController)&&n.setValue(e,t,r)&&(o=!0)})),o)return o;switch(e){case"cam_controller":return(0,f.kE)(t)&&(this.mController=parseInt(t,10),this.changeCameraControls()),!0;case"camera_active":case"active":return this.mActive=!!t,!0;case"near":return(0,f.kE)(t)&&(this.mNear=parseFloat(t),this.mNeedsUpdateProjectionMatrix=!0),!0;case"far":return(0,f.kE)(t)&&(this.mFar=parseFloat(t),this.mNeedsUpdateProjectionMatrix=!0),!0;case"aspect_ratio":return(0,f.kE)(t)&&(this.mAspectRatio=parseFloat(t),this.mNeedsUpdateProjectionMatrix=!0),!0;case"zoom":return(0,f.kE)(t)&&(this.mZoom=parseFloat(t),this.mNeedsUpdateProjectionMatrix=!0),!0;case"auto_focus":return this.autoFocus=t,!0;case"target":return Array.isArray(t)&&t.length>2?this.mTarget.fromArray(t):(t&&t instanceof Bi||t&&t.isVector3)&&this.mTarget.copy(t),r||this.mInitialTarget.copy(this.mTarget),!0;case"rotation_x":var s=(new Li).copy(this.transform.rotation);return s.x=parseFloat(t),this.transform.rotation.copy(s,!1),this.initialTransform.rotation.copy(this.transform.rotation,!1),!0;case"rotation_y":var u=(new Li).copy(this.transform.rotation);return u.y=parseFloat(t),this.transform.rotation.copy(u,!1),this.initialTransform.rotation.copy(this.transform.rotation,!1),!0;case"rotation_z":var c=(new Li).copy(this.transform.rotation);return c.z=parseFloat(t),this.transform.rotation.copy(c,!1),this.initialTransform.rotation.copy(this.transform.rotation,!1),!0;case"quaternion_x":var l=(new Pi).copy(this.transform.quaternion);return l.x=parseFloat(t),this.transform.quaternion.copy(l,!1),this.initialTransform.quaternion.copy(this.transform.quaternion,!1),!0;case"quaternion_y":var h=(new Pi).copy(this.transform.quaternion);return h.y=parseFloat(t),this.transform.quaternion.copy(h,!1),this.initialTransform.quaternion.copy(this.transform.quaternion,!1),!0;case"quaternion_z":var p=(new Pi).copy(this.transform.quaternion);return p.z=parseFloat(t),this.transform.quaternion.copy(p,!1),this.initialTransform.quaternion.copy(this.transform.quaternion,!1),!0;case"quaternion_w":var m=(new Pi).copy(this.transform.quaternion);return m.w=parseFloat(t),this.transform.quaternion.copy(m,!1),this.initialTransform.quaternion.copy(this.transform.quaternion,!1),!0;case"rotation":return t&&t instanceof Li?(this.transform.rotation.copy(t,!1),this.initialTransform.rotation.copy(this.transform.rotation)):Array.isArray(t)&&t.length>2?(this.transform.rotation.fromArray(t,Li.DefaultOrder,!1),this.initialTransform.rotation.copy(this.transform.rotation)):t&&!0===t.isEuler&&(this.transform.rotation.copy(t,!1),this.initialTransform.rotation.copy(this.transform.rotation)),!0;case"quaternion":return t&&t instanceof Pi?(this.transform.quaternion.copy(t,!1),this.initialTransform.quaternion.copy(this.transform.quaternion)):Array.isArray(t)&&t.length>3?(this.transform.quaternion.fromArray(t,0,!1),this.initialTransform.quaternion.copy(this.transform.quaternion)):t&&!0===t.isQuaternion&&(this.transform.quaternion.copy(t,!1),this.initialTransform.quaternion.copy(this.transform.quaternion)),!0;case"properties":return!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"updateProjectionMatrix",value:function(){this.mNeedsUpdateProjectionMatrix=!0}},{key:"serialize",value:function(e,t){var r=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"camera"}),i={};return this.getComponents(Ji.TypeRTTI).forEach((function(n){i=ma(ma({},i),{},(0,l.Z)({},n.getControlsType(),n.serialize(e,t)))})),r.properties=Object.assign(r.properties,ma({cam_controller:this.mController,near:this.mNear,far:this.mFar,auto_focus:this.mAutoFocus},i)),r}},{key:"parse",value:function(e,t,r){var i=this;if(!e.properties)return Ni((0,M.Z)(n.prototype),"parse",this).call(this,e,t,r);if(this.onBeforeParse(e,t)){try{var a={};a="string"==typeof e.properties?JSON.parse(e.properties):e.properties,this.mController=parseInt(a.cam_controller||0,10),this.changeCameraControls();var o=this.getComponents(Ji.TypeRTTI);o.forEach((function(e){e.getControlsType()in a&&e.parse(a,t,r)})),Object.keys(a).forEach((function(e){"properties"!==e?"cam_controller"!==e&&(o.forEach((function(t){t.setValue(e,a[e],!0)})),i.setValue(e,a[e],!0)):qe.qL.warn("Properties field can not contain key name properties")}))}catch(e){qe.qL.warn("Could not parse properties:",e)}delete e.properties,Ni((0,M.Z)(n.prototype),"parse",this).call(this,e,t,r)}}},{key:"changeCameraControls",value:function(){switch(this.removeComponents(Ji.TypeRTTI),this.mController){case ra.FPSControls:this.addComponent(new la);break;case ra.TurnTableControls:this.addComponent(new fa);break;case ra.OrbitControls:default:this.addComponent(new sa)}this.markNeedsRenderUpdate()}},{key:"controller",get:function(){return this.mController},set:function(e){this.mController=e,this.changeCameraControls()}},{key:"isCameraActive",value:function(){return this.mActive}},{key:"setCameraActive",value:function(e){this.mActive=e}},{key:"setCameraPartOfScene",value:function(e){this.mIsPartOfScene=e}},{key:"isCameraPartOfScene",value:function(){return this.mIsPartOfScene}},{key:"near",get:function(){return this.mNear},set:function(e){this.mNear=e}},{key:"far",get:function(){return this.mFar},set:function(e){this.mFar=e}},{key:"aspectRatio",get:function(){return this.mAspectRatio},set:function(e){this.mAspectRatio=e}},{key:"zoom",get:function(){return this.mZoom},set:function(e){this.mZoom=e}},{key:"autoFocus",get:function(){return this.mAutoFocus},set:function(e){e!==this.mAutoFocus&&(this.mAutoFocus=e,this.mAutoFocusNeedsUpdate=!0,this.updatePositionByAutoFocus(this.mAutoFocus))}},{key:"autoFocusNeedsUpdate",get:function(){return this.mAutoFocusNeedsUpdate}},{key:"updateAutoFocus",value:function(){return!this.mAutoFocusNeedsUpdate||this.updatePositionByAutoFocus(this.autoFocus)}},{key:"target",get:function(){return this.getValue("target")},set:function(e){this.setValue("target",e)}},{key:"initialTarget",get:function(){return this.getValue("initial_target")}},{key:"needsProjectionMatrixUpdate",value:function(){return this.mNeedsUpdateProjectionMatrix}},{key:"setProjectionMatrixUpdate",value:function(e){this.mNeedsUpdateProjectionMatrix=e}},{key:"markProjectionMatrixUpdate",value:function(){this.setProjectionMatrixUpdate(!0)}}]),n}(Ki);(0,l.Z)(ga,"TypeRTTI",new k.r("CameraEntity",Ki.TypeRTTI));var ba=__webpack_require__(9611);function Ma(e,t,n){return Ma=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&(0,ba.Z)(i,n.prototype),i},Ma.apply(null,arguments)}function ka(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var _a=function(e){(0,g.Z)(n,e);var t=ka(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"mSettings",void 0),r}return(0,c.Z)(n,[{key:"OnAttached",value:function(){this.mSettings=P.settingsManager().getSettings()}},{key:"getType",value:function(){return n.TypeRTTI}}]),n}(Xi.H);(0,l.Z)(_a,"TypeRTTI",new k.r("ToolbarComponent",Xi.H.TypeRTTI));__webpack_require__(7479),__webpack_require__(7714),__webpack_require__(2801),__webpack_require__(1174),__webpack_require__(285),__webpack_require__(1637),__webpack_require__(9714),__webpack_require__(4765);var xa,Ta=function(){function e(){(0,u.Z)(this,e)}var n;return(0,c.Z)(e,null,[{key:"loadScript",value:(n=t(r().mark((function t(n){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n in e.scriptPromises)){t.next=2;break}return t.abrupt("return",e.scriptPromises[n]);case 2:return e.scriptPromises[n]=new Promise((function(e){var t=document.createElement("script");t.crossOrigin="anonymous";var r=function(){e()};if(t.readyState){var i=t;i.onreadystatechange=function(){"loaded"!==i.readyState&&"complete"!==i.readyState||(i.onreadystatechange=null,r())}}else t.onload=r;t.src=n,document.head.appendChild(t)})),t.abrupt("return",e.scriptPromises[n]);case 4:case"end":return t.stop()}}),t)}))),function(e){return n.apply(this,arguments)})},{key:"getHost",value:function(){var e,t=document.location.origin,n="";if(null!==(e=window.expivi)&&void 0!==e&&e.currentScript){var r=window.expivi.currentScript.src;t=r.substring(0,r.lastIndexOf("/")),n=new URL(r).search}return{origin:t,params:n}}}]),e}();function wa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Ta,"scriptPromises",{}),function(e){e.BOTTOM_RIGHT="BOTTOM_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT"}(xa||(xa={}));var Ra=function(e){(0,g.Z)(n,e);var t=wa(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,u.Z)(this,n),e=t.call(this),(0,l.Z)((0,_.Z)(e),"onError",new Ht),(0,l.Z)((0,_.Z)(e),"onStateChange",new Ht),(0,l.Z)((0,_.Z)(e),"mValue",void 0),(0,l.Z)((0,_.Z)(e),"mSettings",void 0),(0,l.Z)((0,_.Z)(e),"parent",null),(0,l.Z)((0,_.Z)(e),"children",[]),(0,l.Z)((0,_.Z)(e),"mModuleSettings",null),e.mSettings=P.settingsManager().getSettings(),e.mValue=Object.assign({name:null,enabled:!0,position:xa.BOTTOM_RIGHT,color:"transparent",hover:"rgba(0, 0, 0, 0.1)",image_source:"",padding:0,busy:!1,sharing:!1,arqr:!1,protect_mutation:!1,inverted:!1},r),e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"setValue",value:function(e,t){var n=this;switch(e){case"enabled":return this.mValue.enabled=t,this.onStateChange.next({item:this,name:"enabled",value:t}),!0;case"image_source":return this.mValue.image_source=t,!0;case"icon":return this.mValue.icon=t,!0;case"icon_inverted":return this.mValue.icon_inverted=t,!0;case"busy":return this.mValue.busy=t,this.onStateChange.next({item:this,name:"busy",value:t,message:"Loading AR...",icon:'\n                        <svg viewBox="0 0 48 48" width="48" height="48">\n                            <style>\n                                @keyframes XPVWebArLoading { to { stroke-dashoffset: 90; } }\n                            </style>\n                            <path d="M24.5 21.5L11.5 14.5L24.5 8.5L37.5 15.5L24.5 21.5L37.5 15.5V30.5L24.5 37.5V21.5V37.5L11.5 30.5V14.5L24.5 21.5Z" style="stroke:currentcolor;fill:none;stroke-width:2;stroke-dasharray:60 30;animation:XPVWebArLoading 2s linear infinite;stroke-linejoin:round;stroke-linecap:round;"/>\n                        </svg>\n                    '}),!0;case"arqr":return this.mValue.arqr=!(0,p.isNullOrUndefined)(t),Ta.loadScript("https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js").then((function(){var e=function(e){return encodeURI(btoa(e))},r=new window.URL(Jr.E.backendURL+"/product-ar");r.searchParams.append("android",e(t[0])),r.searchParams.append("ios",e(t[1]));var i=document.createElement("canvas");new QRious({element:i,size:240,value:r.toString()}),n.onStateChange.next({item:n,name:"arqr",value:!(0,p.isNullOrUndefined)(t),icon:i})})).catch((function(e){return qe.qL.error(e)})),!0;case"position":return this.mValue.position=t,!0;case"sharing":return this.mValue.sharing=t,this.onStateChange.next({item:this,name:"sharing",value:t}),!0;case"inverted":return this.mValue.inverted=t,this.onStateChange.next({item:this,name:"inverted",value:t}),!0}return!1}},{key:"getValue",value:function(e){switch(e){case"name":case"enabled":case"image_source":case"icon":case"icon_inverted":case"busy":case"position":case"sharing":case"protect_mutation":case"inverted":return this.mValue[e]}return null}},{key:"getSetting",value:function(e){return this.mModuleSettings?this.mModuleSettings[e]?this.mModuleSettings[e]:this.mModuleSettings.settings&&this.mModuleSettings.settings[e]?this.mModuleSettings.settings[e]:null:null}},{key:"getParent",value:function(){return this.parent}},{key:"getChildren",value:function(){return this.children}}]),n}(ze.L);function Za(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Ra,"TypeRTTI",new k.r("ToolbarItemController",ze.L.TypeRTTI));var Sa=function(e){(0,g.Z)(n,e);var t=Za(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,{name:"fullscreen",enabled:!0,icon:'\n                <svg xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 48 48" style="stroke: currentColor; stroke-width: 0.5;">\n                    <path d="M10 38v-9.65h3V35h6.65v3Zm0-18.35V10h9.65v3H13v6.65ZM28.35 38v-3H35v-6.65h3V38ZM35 19.65V13h-6.65v-3H38v9.65Z"/>\n                </svg>\n            ',icon_inverted:'\n                <svg xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 48 48" style="stroke: currentColor; stroke-width: 0.5;">\n                    <path d="M16.65 38v-6.65H10v-3h9.65V38Zm11.7 0v-9.65H38v3h-6.65V38ZM10 19.65v-3h6.65V10h3v9.65Zm18.35 0V10h3v6.65H38v3Z"/>\n                </svg>\n            '}),(0,l.Z)((0,_.Z)(r),"mViewRenderCanvas",void 0),r.mViewRenderCanvas=e,r.setValue("enabled",!Mi()),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getViewRenderCanvas",value:function(){return this.mViewRenderCanvas}}]),n}(Ra);function Ca(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Sa,"TypeRTTI",new k.r("FullscreenToolbarItemController",Ra.TypeRTTI));var Ia,Ea=function(e){(0,g.Z)(s,e);var n,i,a,o=Ca(s);function s(){var e;return(0,u.Z)(this,s),e=o.call(this,"toolbar-fullscreen-component"),(0,l.Z)((0,_.Z)(e),"mController",void 0),(0,l.Z)((0,_.Z)(e),"mIsFullscreen",!1),e}return(0,c.Z)(s,[{key:"OnAttached",value:function(){var e=this;Ni((0,M.Z)(s.prototype),"OnAttached",this).call(this),this.mController=this.getParentObject(),this.registerMessageHandler(Be.TypeRTTI,(function(){e.action().then((function(){}),(function(e){qe.qL.error(e)}))})),this.mIsFullscreen=!1,document.addEventListener("fullscreenchange",this.onFullScreen.bind(this),!1),document.addEventListener("webkitfullscreenchange",this.onFullScreen.bind(this),!1),document.addEventListener("mozfullscreenchange",this.onFullScreen.bind(this),!1),document.addEventListener("MSFullscreenChange",this.onFullScreen.bind(this),!1)}},{key:"OnDetached",value:function(){document.removeEventListener("fullscreenchange",this.onFullScreen.bind(this)),document.removeEventListener("webkitfullscreenchange",this.onFullScreen.bind(this)),document.removeEventListener("mozfullscreenchange",this.onFullScreen.bind(this)),document.removeEventListener("MSFullscreenChange",this.onFullScreen.bind(this)),this.unregisterMessageHandler(Be.TypeRTTI)}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(Sa.TypeRTTI)}},{key:"action",value:(a=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){return t.mIsFullscreen?t.closeFullscreen():t.openFullscreen(t.mController.getViewRenderCanvas()),e()})));case 1:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})},{key:"openFullscreen",value:function(e){var t=this;this.requestFullscreen(e).then((function(){t.mIsFullscreen=!0,P.eventBus().dispatch(new Di(Ei.WindowResized)),t.mController.setValue("inverted",!0)}),(function(e){qe.qL.error(e)}))}},{key:"closeFullscreen",value:function(){var e=this;this.exitFullscreen().then((function(){e.mIsFullscreen=!1,P.eventBus().dispatch(new Di(Ei.WindowResized)),e.mController.setValue("inverted",!1)}),(function(e){qe.qL.error(e)}))}},{key:"onFullScreen",value:function(){this.mIsFullscreen=null!==document.fullscreenElement,P.eventBus().dispatch(new Di(Ei.WindowResized))}},{key:"isFullscreenEnabled",value:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled}},{key:"requestFullscreen",value:(i=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if(!n.isFullscreenEnabled())return r("Fullscreen api not available.");var i=null;t.requestFullscreen?i=t.requestFullscreen():"mozRequestFullScreen"in t?i=t.mozRequestFullScreen():"webkitRequestFullScreen"in t?i=t.webkitRequestFullScreen():"msRequestFullscreen"in t?i=t.msRequestFullscreen():"webkitEnterFullscreen"in t&&(i=t.webkitEnterFullscreen()),!(0,p.isNullOrUndefined)(i)&&i instanceof Promise?i.then((function(){e()}),(function(e){r(e)})):e()})));case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"exitFullscreen",value:(n=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(!t.isFullscreenEnabled())return n("Fullscreen api not available.");var r=null;document.exitFullscreen?r=document.exitFullscreen():"webkitExitFullscreen"in document?r=document.webkitExitFullscreen():"mozCancelFullScreen"in document?r=document.mozCancelFullScreen():"msExitFullscreen"in document&&(r=document.msExitFullscreen()),!(0,p.isNullOrUndefined)(r)&&r instanceof Promise?r.then((function(){e()}),(function(e){n(e)})):e()})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"getType",value:function(){return s.TypeRTTI}}]),s}(_a);function Aa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Ea,"TypeRTTI",new k.r("FullscreenComponent",_a.TypeRTTI)),function(e){e.TOP_RIGHT="TOP_RIGHT",e.TOP_LEFT="TOP_LEFT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"}(Ia||(Ia={}));var Oa=function(e){(0,g.Z)(n,e);var t=Aa(n);function n(e){var r;(0,u.Z)(this,n),r=t.call(this,{name:"social",enabled:!0,icon:'\n                <svg viewBox="0 0 36 36" width="36" height="36">\n                    <path d="M19 12A1 1 0 0 0 23 8A1 1 0 0 0 19 12ZM12 15A1 1 0 0 0 8 19A1 1 0 0 0 12 15ZM23 22A1 1 0 0 0 19 26A1 1 0 0 0 23 22ZM18 12L13 15M13 19L18 22" style="fill:none;stroke-linecap:square;stroke-width:2;stroke:currentcolor;"/>\n                </svg>\n            '}),(0,l.Z)((0,_.Z)(r),"mViewRenderCanvas",void 0),r.mViewRenderCanvas=e,r.mModuleSettings=r.mSettings.getSubModuleSettings("social","GENERAL");var i=r.mSettings.isModuleEnabled("social")&&r.mModuleSettings.status;r.setValue("enabled",i);var a=r.mModuleSettings.settings&&r.mModuleSettings.settings.position||Ia.BOTTOM_RIGHT,o=xa[a];return r.setValue("position",o),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getViewRenderCanvas",value:function(){return this.mViewRenderCanvas}}]),n}(Ra);function Da(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Oa,"TypeRTTI",new k.r("SocialSharingToolbarItemController",Ra.TypeRTTI));var Pa=function(e){(0,g.Z)(a,e);var n,i=Da(a);function a(){var e;return(0,u.Z)(this,a),e=i.call(this,"toolbar-social-sharing-component"),(0,l.Z)((0,_.Z)(e),"mController",void 0),e}return(0,c.Z)(a,[{key:"OnAttached",value:function(){var e=this;Ni((0,M.Z)(a.prototype),"OnAttached",this).call(this),this.mController=this.getParentObject(),this.registerMessageHandler(Be.TypeRTTI,(function(){e.action().then((function(){}),(function(e){qe.qL.error(e)}))}))}},{key:"OnDetached",value:function(){}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(Oa.TypeRTTI)}},{key:"action",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){return e()})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"getType",value:function(){return a.TypeRTTI}}]),a}(_a);function Ba(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Pa,"TypeRTTI",new k.r("SocialSharingComponent",_a.TypeRTTI));var Fa=function(e){(0,g.Z)(n,e);var t=Ba(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,{enabled:!0,icon:'\n                <svg viewBox="-30 -30 215 215" width="36" height="36">\n                    <path d="M89.584,155.139V84.378h23.742l3.562-27.585H89.584V39.184c0-7.984,2.208-13.425,13.67-13.425l14.595-0.006V1.08C115.325,0.752,106.661,0,96.577,0C75.52,0,61.104,12.853,61.104,36.452v20.341H37.29v27.585h23.814v70.761H89.584z" style="fill:currentcolor;"/>\n                </svg>\n            '}),(0,l.Z)((0,_.Z)(r),"mViewRenderCanvas",void 0),r.mViewRenderCanvas=e,r.mModuleSettings=r.mSettings.getSubModuleSettings("social","facebook"),r.setValue("enabled",!0===r.mModuleSettings.status),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getViewRenderCanvas",value:function(){return this.mViewRenderCanvas}}]),n}(Ra);function La(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Fa,"TypeRTTI",new k.r("FacebookSocialSharingToolbarItemController",Ra.TypeRTTI));var Na=function(e){(0,g.Z)(a,e);var n,i=La(a);function a(){var e;return(0,u.Z)(this,a),e=i.call(this,"toolbar-facebook-social-sharing-component"),(0,l.Z)((0,_.Z)(e),"mController",void 0),e}return(0,c.Z)(a,[{key:"OnAttached",value:function(){var e=this;Ni((0,M.Z)(a.prototype),"OnAttached",this).call(this),this.mController=this.getParentObject(),this.registerMessageHandler(Be.TypeRTTI,(function(){e.mController.getValue("sharing")||e.action().then((function(){window.setTimeout((function(){e.mController.setValue("sharing",!1)}),2e3)}),(function(e){qe.qL.error(e)}))}))}},{key:"OnDetached",value:function(){}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(Fa.TypeRTTI)}},{key:"action",value:(n=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){return t.mController.setValue("sharing",t.mController.mModuleSettings),e()})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"getType",value:function(){return a.TypeRTTI}}]),a}(_a);function ja(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Na,"TypeRTTI",new k.r("FacebookSocialSharingComponent",_a.TypeRTTI));var za=function(e){(0,g.Z)(n,e);var t=ja(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,{enabled:!0,icon:'\n                <svg viewBox="-103 -101 842 842" width="36" height="36">\n                    <path d="m544.386719 93.007812c-59.875-59.945312-139.503907-92.9726558-224.335938-93.007812-174.804687 0-317.070312 142.261719-317.140625 317.113281-.023437 55.894531 14.578125 110.457031 42.332032 158.550781l-44.992188 164.335938 168.121094-44.101562c46.324218 25.269531 98.476562 38.585937 151.550781 38.601562h.132813c174.785156 0 317.066406-142.273438 317.132812-317.132812.035156-84.742188-32.921875-164.417969-92.800781-224.359376zm-224.335938 487.933594h-.109375c-47.296875-.019531-93.683594-12.730468-134.160156-36.742187l-9.621094-5.714844-99.765625 26.171875 26.628907-97.269531-6.269532-9.972657c-26.386718-41.96875-40.320312-90.476562-40.296875-140.28125.054688-145.332031 118.304688-263.570312 263.699219-263.570312 70.40625.023438 136.589844 27.476562 186.355469 77.300781s77.15625 116.050781 77.132812 186.484375c-.0625 145.34375-118.304687 263.59375-263.59375 263.59375zm144.585938-197.417968c-7.921875-3.96875-46.882813-23.132813-54.148438-25.78125-7.257812-2.644532-12.546875-3.960938-17.824219 3.96875-5.285156 7.929687-20.46875 25.78125-25.09375 31.066406-4.625 5.289062-9.242187 5.953125-17.167968 1.984375-7.925782-3.964844-33.457032-12.335938-63.726563-39.332031-23.554687-21.011719-39.457031-46.960938-44.082031-54.890626-4.617188-7.9375-.039062-11.8125 3.476562-16.171874 8.578126-10.652344 17.167969-21.820313 19.808594-27.105469 2.644532-5.289063 1.320313-9.917969-.664062-13.882813-1.976563-3.964844-17.824219-42.96875-24.425782-58.839844-6.4375-15.445312-12.964843-13.359374-17.832031-13.601562-4.617187-.230469-9.902343-.277344-15.1875-.277344-5.28125 0-13.867187 1.980469-21.132812 9.917969-7.261719 7.933594-27.730469 27.101563-27.730469 66.105469s28.394531 76.683594 32.355469 81.972656c3.960937 5.289062 55.878906 85.328125 135.367187 119.648438 18.90625 8.171874 33.664063 13.042968 45.175782 16.695312 18.984374 6.03125 36.253906 5.179688 49.910156 3.140625 15.226562-2.277344 46.878906-19.171875 53.488281-37.679687 6.601563-18.511719 6.601563-34.375 4.617187-37.683594-1.976562-3.304688-7.261718-5.285156-15.183593-9.253906zm0 0" style="fill-rule:evenodd;fill:currentcolor;"/>\n                </svg>\n            '}),(0,l.Z)((0,_.Z)(r),"mViewRenderCanvas",void 0),r.mViewRenderCanvas=e,r.mModuleSettings=r.mSettings.getSubModuleSettings("social","whatsapp"),r.setValue("enabled",!0===r.mModuleSettings.status),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getViewRenderCanvas",value:function(){return this.mViewRenderCanvas}}]),n}(Ra);function Ua(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(za,"TypeRTTI",new k.r("WhatsappSocialSharingToolbarItemController",Ra.TypeRTTI));var Va=function(e){(0,g.Z)(a,e);var n,i=Ua(a);function a(){var e;return(0,u.Z)(this,a),e=i.call(this,"toolbar-whatsapp-social-sharing-component"),(0,l.Z)((0,_.Z)(e),"mController",void 0),e}return(0,c.Z)(a,[{key:"OnAttached",value:function(){var e=this;Ni((0,M.Z)(a.prototype),"OnAttached",this).call(this),this.mController=this.getParentObject(),this.registerMessageHandler(Be.TypeRTTI,(function(){e.mController.getValue("sharing")||e.action().then((function(){window.setTimeout((function(){e.mController.setValue("sharing",!1)}),2e3)}),(function(e){qe.qL.error(e)}))}))}},{key:"OnDetached",value:function(){}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(za.TypeRTTI)}},{key:"action",value:(n=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){return t.mController.setValue("sharing",t.mController.mModuleSettings),e()})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"getType",value:function(){return a.TypeRTTI}}]),a}(_a);function Ha(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Va,"TypeRTTI",new k.r("WhatsappSocialSharingComponent",_a.TypeRTTI));var Ga=function(e){(0,g.Z)(n,e);var t=Ha(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"mChildren",new Array),(0,l.Z)((0,_.Z)(r),"mChildLock",!1),r.mName="SceneNode",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){return"child_lock"===e?(this.mChildLock=!0===t||"1"==t||"true"===t,!0):Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);return null!==t?t:"child_lock"===e?this.mChildLock:null}},{key:"parse",value:function(e,t){var r=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Ni((0,M.Z)(n.prototype),"parse",this).call(this,e,t,i),!0===i||!this.mChildLock&&this.onBeforeParseChildren()){Array.isArray(e.children)&&e.children.forEach((function(e){var n=r.mChildren.find((function(t){return t.getSceneObjectId()==e.scene_object_id}));if(n)n.parse(e,t);else if(r.onBeforeParseCreate(e.type)){var i=P.sceneManager();if("configurable"===e.type){var a=r.getChildrenDerivedOfTypeName("ConfigurableNode")[0];void 0!==e.scene_object_id&&null!==e.scene_object_id&&a.setSceneObjectId(e.scene_object_id),a.parse(e,t)}else{var o=i.createObject(e.type,e.scene_object_id);if(o){var s=o.getSceneObjectId()<0&&r.onBeforeAddNewToRenderState(o);i.addNode(o,r,s),o.parse(e,t)}else qe.qL.warn("unknown node in parse: ",e.type)}}}));for(var a=this.mChildren.length-1;a>=0;a--){var o=this.mChildren[a];o.getSceneObjectId()>=0&&!o.isInSyncWithHash(t)&&this._detachChildAtIndex(a)}}}},{key:"serialize",value:function(e,t){var r=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e,t),{type:"node"});return r.properties=Object.assign(r.properties,{child_lock:this.mChildLock}),r.children=[],!0===t||!this.mChildLock&&this.onBeforeSerializeChildren()?(this.mChildren.forEach((function(t){r.children.push(t.serialize(e))})),r):r}},{key:"_attachChild",value:function(e){return this._attachChildAtIndex(e,this.mChildren.length)}},{key:"_attachChildAtIndex",value:function(e,t){return this._beforeAttach(e)?(this.mChildren.splice(t,0,e),qe.qL.print("attaching child:",e,this),e.setParent(this),this._afterAttach(e),e.onAttached(this),P.eventBus().dispatch(new Di(Ei.SceneObjectAttached,e)),this.mChildren.indexOf(e)):-1}},{key:"_detachChild",value:function(e){return this._detachChildAtIndex(this.mChildren.indexOf(e))}},{key:"_detachChildAtIndex",value:function(e){if(!(e<0||e>=this.mChildren.length)){var t=this.mChildren[e];return qe.qL.print("detaching child:",t),t.setParent(null),t.onDetached(this),P.eventBus().dispatch(new Di(Ei.SceneObjectDetached,t)),this.mChildren.splice(e,1)[0]}}},{key:"_detachAllChildren",value:function(){var e=this;return this.getChildren().slice().map((function(t){return e._detachChild(t)}))}},{key:"getNumChildren",value:function(){return this.mChildren.length}},{key:"getChildAtIndex",value:function(e){return e>=0&&e<this.mChildren.length?this.mChildren[e]:void 0}},{key:"getChildren",value:function(){return this.mChildren}},{key:"getChildrenDerivedTypeOf",value:function(e){return this.getChildrenDerivedOfTypeName(e.getTypeName())}},{key:"getChildrenDerivedOfTypeName",value:function(e){var t=new Array;return this.mChildren.forEach((function(n){n.isDerivedOfTypeName(e)&&t.push(n)})),t}},{key:"_beforeAttach",value:function(e){return!0}},{key:"_afterAttach",value:function(e){}},{key:"fixedUpdate",value:function(e){Ni((0,M.Z)(n.prototype),"fixedUpdate",this).call(this,e),this.enabled&&this.mChildren.forEach((function(t){t.fixedUpdate(e)}))}},{key:"beforeUpdate",value:function(e){Ni((0,M.Z)(n.prototype),"beforeUpdate",this).call(this,e),this.enabled&&this.mChildren.forEach((function(t){t.beforeUpdate(e)}))}},{key:"afterUpdate",value:function(e){Ni((0,M.Z)(n.prototype),"afterUpdate",this).call(this,e),this.enabled&&this.mChildren.forEach((function(t){t.afterUpdate(e)}))}},{key:"update",value:function(e){Ni((0,M.Z)(n.prototype),"update",this).call(this,e),this.enabled&&this.mChildren.forEach((function(t){t.update(e)}))}},{key:"onSceneUpdate",value:function(e){var t=this;Ni((0,M.Z)(n.prototype),"onSceneUpdate",this).call(this,e),this.mChildren.forEach((function(e){e.layers.enableByLayer(t.mLayers)}))}},{key:"dispatchMessage",value:function(e){Ni((0,M.Z)(n.prototype),"dispatchMessage",this).call(this,e),this.mChildren.forEach((function(t){t.dispatchMessage(e)}))}},{key:"onDraw",value:function(e,t){Ni((0,M.Z)(n.prototype),"onDraw",this).call(this,e,t),this.mChildren.forEach((function(n){n.draw(e,t)}))}},{key:"onAfterDraw",value:function(e,t){Ni((0,M.Z)(n.prototype),"onAfterDraw",this).call(this,e,t),this.mChildren.forEach((function(n){n.afterDraw(e,t)}))}},{key:"onBeforeParseChildren",value:function(){return!0}},{key:"onBeforeParseCreate",value:function(e){return!0}},{key:"onBeforeAddNewToRenderState",value:function(e){return!0}},{key:"onBeforeSerializeChildren",value:function(){return!0}},{key:"destroy",value:function(e,t){this._detachAllChildren().forEach((function(n){n.destroy(e,t)})),Ni((0,M.Z)(n.prototype),"destroy",this).call(this,e,t)}},{key:"setNeedsRenderUpdate",value:function(e){this.mNeedsRenderUpdate=e,this.mChildren.forEach((function(t){t.setNeedsRenderUpdate(e)}))}}]),n}(Wi);(0,l.Z)(Ga,"TypeRTTI",new k.r("SceneNode",Wi.TypeRTTI));__webpack_require__(5192);function qa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Wa=function(e){(0,g.Z)(n,e);var t=qa(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"mWorldGlobalStates",[]),(0,l.Z)((0,_.Z)(r),"mPickable",void 0),(0,l.Z)((0,_.Z)(r),"mRenderOrder",void 0),r.mName="RenderEntity",r.mPickable=!0,r.mRenderOrder=1,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getRenderTechnique",value:function(){return this.renderTechnique}},{key:"updateWorldGlobalStates",value:function(e){this.mWorldGlobalStates=e.getCurrentGlobalStates()}},{key:"getWorldGlobalStates",value:function(){return this.mWorldGlobalStates}},{key:"onDraw",value:function(e,t){this.updateWorldGlobalStates(e),e.addDrawable(this)}},{key:"pickable",get:function(){return this.mPickable},set:function(e){this.mPickable=e}},{key:"renderOrder",get:function(){return this.mRenderOrder},set:function(e){this.mRenderOrder=e,this.markNeedsRenderUpdate()}}]),n}(Ki);(0,l.Z)(Wa,"TypeRTTI",new k.r("RenderEntity",Ki.TypeRTTI));var Ya,Ka=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"onUiSelected",new Ht),(0,l.Z)(this,"mRenderDom",void 0),(0,l.Z)(this,"mWidth",2),(0,l.Z)(this,"mHeight",2),this.mRenderDom=t}return(0,c.Z)(e,[{key:"dispose",value:function(){this.mRenderDom.remove()}},{key:"add",value:function(e){qe.qL.print("ui-renderer append child:",e),this.mRenderDom.appendChild(e)}},{key:"remove",value:function(e){qe.qL.print("ui-renderer remove child:",e),this.mRenderDom.removeChild(e)}},{key:"enableEvents",value:function(){this.mRenderDom.style.pointerEvents="auto"}},{key:"disableEvents",value:function(){this.mRenderDom.style.pointerEvents="none"}},{key:"eventsEnabled",value:function(){return"none"!==this.mRenderDom.style.pointerEvents}},{key:"getSize",value:function(){return{width:this.mWidth,height:this.mHeight}}},{key:"resize",value:function(e,t){this.mWidth=e,this.mHeight=t}},{key:"getRenderDom",value:function(){return this.mRenderDom}}]),e}();!function(e){e[e.clipping_plane=0]="clipping_plane",e[e.LAST_INDEX=1]="LAST_INDEX"}(Ya||(Ya={}));var Xa,$a=(0,c.Z)((function e(){(0,u.Z)(this,e)}));!function(e){e[e.background=0]="background",e[e.environment=1]="environment",e[e.environment_intensity=2]="environment_intensity",e[e.LAST_INDEX=3]="LAST_INDEX"}(Xa||(Xa={}));var Qa,Ja,eo,to=(0,c.Z)((function e(){(0,u.Z)(this,e)}));!function(e){e.perspective="perspective"}(Qa||(Qa={})),function(e){e.ambient="ambient",e.directional="directional",e.hemisphere="hemisphere",e.point="point",e.spot="spot",e.rectArea="rect-area"}(Ja||(Ja={})),function(e){e.effect_ao_plane="effect_ao_plane",e.effect_glare="effect_glare",e.effect_flare="effect_flare",e.effect_fire="effect_fire",e.effect_skycube="effect_skycube",e.effect_skyequirect="effect_skyequirect",e.effect_reflector="effect_reflector",e.effect_water="effect_water",e.grid_area="grid_area",e.primitive_line="primitive_line",e.primitive_box="primitive_box",e.primitive_plane="primitive_plane",e.primitive_sphere="primitive_sphere",e.draw_ui="draw_ui",e.mesh="mesh",e.mesh_line="mesh_line",e.transform_controls_gizmo="transform_controls_gizmo"}(eo||(eo={}));var no=function(){function e(t,n){(0,u.Z)(this,e),(0,l.Z)(this,"mUiRenderer",void 0),(0,l.Z)(this,"mCatalogueSettings",new si),(0,l.Z)(this,"mCameraTechniques",{}),(0,l.Z)(this,"mLightTechniques",{}),(0,l.Z)(this,"mRenderTechniques",{}),(0,l.Z)(this,"mGlobalStateTechniques",{}),(0,l.Z)(this,"mSceneStateTechniques",{}),(0,l.Z)(this,"mSceneStateCollection",new cn),(0,l.Z)(this,"mEnabledSceneStates",{}),(0,l.Z)(this,"mDeltaTime",1/60),(0,l.Z)(this,"mRenderCache",{}),(0,l.Z)(this,"mRenderPoolChecksum",void 0),(0,l.Z)(this,"mFrameCache",{}),(0,l.Z)(this,"mRendererInProgress",!1),this.mCatalogueSettings=n,this.mUiRenderer=new Ka(t),this.registerDefaultTechniques()}return(0,c.Z)(e,[{key:"getUiRenderer",value:function(){return this.mUiRenderer}},{key:"getSettings",value:function(){return this.mCatalogueSettings}},{key:"getDeviceSceneSettings",value:function(){return this.mCatalogueSettings.getSceneDeviceSettings(Ti()?ti.Mobile:ti.Desktop)}},{key:"registerDefaultTechniques",value:function(){this.registerCameraTechnique(Qa.perspective,this.enablePerspectiveCamera.bind(this)),this.registerLightTechnique(Ja.ambient,this.enableAmbientLight.bind(this)),this.registerLightTechnique(Ja.hemisphere,this.enableHemisphericLight.bind(this)),this.registerLightTechnique(Ja.directional,this.enableDirectionalLight.bind(this)),this.registerLightTechnique(Ja.point,this.enablePointLight.bind(this)),this.registerLightTechnique(Ja.spot,this.enableSpotLight.bind(this)),this.registerLightTechnique(Ja.rectArea,this.enableRectAreaLight.bind(this)),this.registerRenderTechnique(eo.mesh,this.drawMesh.bind(this)),this.registerRenderTechnique(eo.mesh_line,this.drawMeshLine.bind(this)),this.registerRenderTechnique(eo.draw_ui,this.drawUI.bind(this)),this.registerRenderTechnique(eo.primitive_line,this.drawPrimitiveLine.bind(this)),this.registerRenderTechnique(eo.primitive_box,this.drawPrimitiveBox.bind(this)),this.registerRenderTechnique(eo.primitive_plane,this.drawPrimitivePlane.bind(this)),this.registerRenderTechnique(eo.primitive_sphere,this.drawPrimitiveSphere.bind(this)),this.registerRenderTechnique(eo.grid_area,this.drawGridArea.bind(this)),this.registerRenderTechnique(eo.effect_water,this.drawEffectWater.bind(this)),this.registerRenderTechnique(eo.effect_reflector,this.drawEffectReflector.bind(this)),this.registerRenderTechnique(eo.effect_skyequirect,this.drawEffectSkyEquirect.bind(this)),this.registerRenderTechnique(eo.effect_skycube,this.drawEffectSkyCube.bind(this)),this.registerRenderTechnique(eo.effect_flare,this.drawEffectFlare.bind(this)),this.registerRenderTechnique(eo.effect_fire,this.drawEffectFire.bind(this)),this.registerRenderTechnique(eo.effect_glare,this.drawEffectGlare.bind(this)),this.registerRenderTechnique(eo.effect_ao_plane,this.drawEffectAoPlane.bind(this)),this.registerRenderTechnique(eo.transform_controls_gizmo,this.drawTransformControlsGizmo.bind(this)),this.registerGlobalStateTechnique(Ya.clipping_plane,this.enableClippingPlane.bind(this)),this.registerSceneStateTechnique(Xa.background,this.enableSceneBackground.bind(this)),this.registerSceneStateTechnique(Xa.environment,this.enableEnvironment.bind(this)),this.registerSceneStateTechnique(Xa.environment_intensity,this.enableEnvironmentIntensity.bind(this))}},{key:"registerCameraTechnique",value:function(e,t){e in this.mCameraTechniques&&qe.qL.warn("overriding existing technique: ",e),this.mCameraTechniques[e]=t}},{key:"registerLightTechnique",value:function(e,t){e in this.mLightTechniques&&qe.qL.warn("overriding existing technique: ",e),this.mLightTechniques[e]=t}},{key:"registerRenderTechnique",value:function(e,t){e in this.mRenderTechniques&&qe.qL.warn("overriding existing technique: ",e),this.mRenderTechniques[e]=t}},{key:"registerGlobalStateTechnique",value:function(e,t){e in this.mGlobalStateTechniques&&qe.qL.warn("overriding existing technique: ",e),this.mGlobalStateTechniques[e]=t}},{key:"registerSceneStateTechnique",value:function(e,t){e in this.mSceneStateTechniques&&qe.qL.warn("overriding existing technique: ",e),this.mSceneStateTechniques[e]=t}},{key:"render",value:function(e,t){this.mDeltaTime=t,this.mFrameCache={};var n=e.checksum;this.mRenderPoolChecksum!==n&&(this.mRenderPoolChecksum=n),this.clear(!0,!0,!0),this.beforeRender(e),this.pushSceneStates(e.getCurrentSceneStates()),this.syncSceneStates(),this.renderLights(e.getLights()),this.renderCameras(e.getCameras()),this.renderDrawables(e.getDrawables()),this.popSceneStates(e.getCurrentSceneStates()),this.afterRender(e),this.updateProgress()}},{key:"updateProgress",value:function(){if(this.renderCacheReady(!0))this.mRendererInProgress?(this.mRendererInProgress=!1,P.eventBus().dispatch(new Di(Ei.RendererBuildProgress,1)),P.eventBus().dispatch(new Di(Ei.RendererBuildFinished))):P.eventBus().dispatch(new Di(Ei.RendererBuildIdle));else{this.mRendererInProgress||(this.mRendererInProgress=!0,P.eventBus().dispatch(new Di(Ei.RendererBuildStarted)));var e=0,t=0;for(var n in this.mRenderCache){var r=this.mRenderCache[n];t++,r.ready&&!r.disposed&&e++}var i=0===t?0:e/t;P.eventBus().dispatch(new Di(Ei.RendererBuildProgress,i))}}},{key:"pushSceneStates",value:function(e){var t=this;e.forEach((function(e){t.mSceneStateCollection.push(e)}))}},{key:"popSceneStates",value:function(e){var t=this;e.forEach((function(e){t.mSceneStateCollection.pop(e.getType())}))}},{key:"syncSceneStates",value:function(){for(var e=this,t=this.mSceneStateCollection.currentStates().slice(),n=function(){var n=o(i[r],2),a=n[0],s=n[1],u=t.findIndex((function(e){return e.equals(s.state)}));u<0?(s.restore(),delete e.mEnabledSceneStates[a]):t.splice(u,1)},r=0,i=Object.entries(this.mEnabledSceneStates);r<i.length;r++)n();t.forEach((function(t){if(t.getType()in e.mSceneStateTechniques){var n=e.mSceneStateTechniques[t.getType()](t,e);n&&(e.mEnabledSceneStates[t.getType()]=n)}else qe.qL.print("State technique not supported: ",t.getType())}))}},{key:"restoreAllSceneStates",value:function(){var e=this;Object.keys(this.mEnabledSceneStates).forEach((function(t){e.mEnabledSceneStates[t].restore(),delete e.mEnabledSceneStates[t]}))}},{key:"renderLights",value:function(e){var t=this;e.forEach((function(e){var n=e.getLightTechnique();n in t.mLightTechniques?t.mLightTechniques[n](e,t):qe.qL.print("Light technique not supported: ",n)}))}},{key:"renderCameras",value:function(e){var t=this;e.forEach((function(e){var n=e.getCameraTechnique();n in t.mCameraTechniques?t.mCameraTechniques[n](e,t):qe.qL.print("Camera technique not supported:",n)}))}},{key:"renderDrawables",value:function(e){var t=this;e.forEach((function(e){var n=e.getRenderTechnique();n in t.mRenderTechniques?(t.pushGlobalStates(),e.getWorldGlobalStates().forEach((function(n){n.getType()in t.mGlobalStateTechniques?t.mGlobalStateTechniques[n.getType()](n,e,t):qe.qL.print("State technique not supported: ",n.getType())})),t.mRenderTechniques[n](e,t),t.popGlobalStates()):qe.qL.print("Draw technique not supported: ",n)}))}},{key:"renderCacheReady",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t="render_cache_ready";if(void 0!==this.mFrameCache[t]&&!e)return this.mFrameCache[t];for(var n in this.mRenderCache){var r=this.mRenderCache[n];if(!r.ready&&!r.disposed)return this.mFrameCache[t]=!1,!1}return this.mFrameCache[t]=!0,!0}},{key:"isBackgroundAllowed",value:function(e){return!0}}]),e}();function ro(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(no,"MAX_RENDERINGGROUPS",16);var io=function(e){(0,g.Z)(n,e);var t=ro(n);function n(e,r,i){var a;return(0,u.Z)(this,n),a=t.call(this),(0,l.Z)((0,_.Z)(a),"mHandleType",void 0),(0,l.Z)((0,_.Z)(a),"mHandle",void 0),(0,l.Z)((0,_.Z)(a),"mPoolKey",void 0),a.mHandleType=e,a.mHandle=r,a.mPoolKey=i,a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"_setHandle",value:function(e){this.mHandle=e}},{key:"_getHandle",value:function(){return this.mHandle}},{key:"_setHandleType",value:function(e){this.mHandleType=e}},{key:"getHandleType",value:function(){return this.mHandleType}},{key:"_setPoolKey",value:function(e){this.mPoolKey=e}},{key:"getPoolKey",value:function(){return this.mPoolKey}},{key:"validateHandle",value:function(e){return e&&this.getObjectId()===e.getObjectId()&&this.getPoolKey()===e.getPoolKey()}},{key:"clone",value:function(e){return new n(this.mHandleType,this.mHandle,void 0!==e?e:this.mPoolKey)}}]),n}(x.e);(0,l.Z)(io,"TypeRTTI",new k.r("ResourceHandle",x.e.TypeRTTI));var ao=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mGenericPoolKey",void 0),(0,l.Z)(this,"mPools",void 0),this.mGenericPoolKey=t,this.init()}return(0,c.Z)(e,[{key:"add",value:function(e,t){var n=e._getHandle(),r=this.resolvePoolKey(n,t);r in this.mPools||(this.mPools[r]={});var i=n._getHandle();return!(i in this.mPools[r])&&(this.mPools[r][i]=e,!0)}},{key:"remove",value:function(e,t){var n=this.resolvePoolKey(e,t);if(n in this.mPools){var r="string"==typeof e?e:e._getHandle();if(r in this.mPools[n]){var i=this.mPools[n][r];return delete this.mPools[n][r],i}}}},{key:"move",value:function(e,t,n){var r=this.remove(e,n);if(r){t in this.mPools||(this.mPools[t]={});var i="string"==typeof e?e:e._getHandle();this.mPools[t][i]=r}}},{key:"clone",value:function(e,t,n){var r=this.findByHandle(e,n);if(r){t in this.mPools||(this.mPools[t]={});var i="string"==typeof e?e:e._getHandle(),a=r.clone();return a._setHandle(r._getHandle().clone(t)),this.mPools[t][i]=a,a}}},{key:"find",value:function(e){for(var t in this.mPools)for(var n in this.mPools[t])if(e(this.mPools[t][n],Number(t)))return this.mPools[t][n]}},{key:"findAll",value:function(e){var t=[];for(var n in this.mPools)for(var r in this.mPools[n])e(this.mPools[n][r],Number(n))&&t.push(this.mPools[n][r]);return t}},{key:"findByHandle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.resolvePoolKey(e,t),i="string"==typeof e?e:e._getHandle();if(r in this.mPools&&i in this.mPools[r])return this.mPools[r][i];n&&Object.entries(this.mPools).forEach((function(e){var t=e[1];if(i in t)return t[i]}))}},{key:"has",value:function(e,t){var n=this.resolvePoolKey(e,t),r="string"==typeof e?e:e._getHandle();return n in this.mPools&&r in this.mPools[n]}},{key:"validate",value:function(e){var t=e.getPoolKey(),n=e._getHandle();return t in this.mPools&&(n in this.mPools[t]&&this.mPools[t][n]._getHandle().validateHandle(e))}},{key:"init",value:function(){this.mPools={},this.mPools[this.mGenericPoolKey]={}}},{key:"dispose",value:function(e){var t=this;Object.keys(this.mPools).forEach((function(n){Object.keys(t.mPools[n]).forEach((function(r){e(t.mPools[n][r]),delete t.mPools[n][r]})),delete t.mPools[n]})),delete this.mPools}},{key:"resolvePoolKey",value:function(e,t){return"string"!=typeof e?e.getPoolKey():void 0!==t?t:this.mGenericPoolKey}}]),e}(),oo=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mResourcePool",void 0),this.mResourcePool=new ao(e._poolKey)}var n,i,a;return(0,c.Z)(e,[{key:"cleanup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.mResourcePool.dispose((function(e){e.dispose(!0)})),e&&this.mResourcePool.init()}},{key:"validateHandle",value:function(e){if(!this.mResourcePool.validate(e))throw new Error("Invalid handle")}},{key:"validatePoolKey",value:function(t,n){var r=void 0!==n?n:e._poolKey;return t.getPoolKey()===r}},{key:"findResourceWithHandleKey",value:function(e,t){return this.mResourcePool.findByHandle(e,t,!1)}},{key:"findResourceWithHandle",value:function(e){return this.mResourcePool.findByHandle(e,void 0,!1)}},{key:"makeResource",value:function(t,n,r){if(null!=t){var i=this.makeHandleKey(t,n),a=this.findResourceWithHandleKey(i,r);if(a)return a._increaseReferenceCount(),a._getHandle();var o=f.Ft.isNumeric(r)?r:e._poolKey,s=new io(this.getResourceGroupType(),i,o),u=this.createResource(t,s,n);return u._increaseReferenceCount(),u._setHandle(s),this.mResourcePool.add(u,o),qe.qL.print("Resource created:",s._getHandle(),s.getPoolKey()),s}qe.qL.warn("Trying to make a resource with none-numeric model id: '".concat(t,"'"))}},{key:"makeResourceRaw",value:function(t,n){var r=t.getUniqueId(),i=this.makeHandleKey(r,{}),a=this.findResourceWithHandleKey(i,n);if(a)return a._increaseReferenceCount(),a._getHandle();var o=f.Ft.isNumeric(n)?n:e._poolKey,s=new io(this.getResourceGroupType(),i,o),u=this.createResource(t,s,{});return u._increaseReferenceCount(),u._lockDisposable(!0),u._setHandle(s),this.mResourcePool.add(u,o),qe.qL.print("Resource (raw) created:",s._getHandle(),s.getPoolKey()),s}},{key:"resolveResource",value:(a=t(r().mark((function e(t,n,i){var a,o,s,u,c,l,h,f,p,m,d=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=d.length>3&&void 0!==d[3]&&d[3],t){e.next=4;break}throw n&&n(),new Error("Undefined handle");case 4:e.prev=4,this.validateHandle(t),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(4),n&&n(),e.t0;case 12:return o=this.mResourcePool.findByHandle(t),e.next=15,this.onBeforeResolve(o);case 15:return u=new Promise((function(e){s=e})),c=function(e){s()},h=new Promise((function(e){l=e})),f=function(e){l()},e.next=21,o.resolve(c,i);case 21:return p=e.sent,a&&o._increaseReferenceCount(),e.next=25,this.onAfterResolve(o,p,f);case 25:return(m=e.sent).overridden||f(m.resource),Promise.allSettled([u,h]).then((function(){n&&n(m.resource)})).catch((function(e){qe.qL.error(e)})),e.abrupt("return",m.resource);case 29:case"end":return e.stop()}}),e,this,[[4,8]])}))),function(e,t,n){return a.apply(this,arguments)})},{key:"disposeResource",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||this.validateHandle(e);var n=this.mResourcePool.findByHandle(e);n&&(n._decreaseReferenceCount(),n.dispose(t)&&this.mResourcePool.remove(e))}},{key:"onBeforeResolve",value:(i=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isDisposed()){e.next=2;break}throw new Error("Resolving resource after dispose.");case 2:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"onAfterResolve",value:(n=t(r().mark((function e(t,n,i){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve({resource:n,overridden:!1}));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"makeHandleKey",value:function(e,t){return String(e)}}]),e}();(0,l.Z)(oo,"_poolKey",2147483647);var so=function(){function e(t,n,r){return(0,u.Z)(this,e),(0,l.Z)(this,"r",1),(0,l.Z)(this,"g",1),(0,l.Z)(this,"b",1),"string"==typeof t||t instanceof e||void 0===n?this.set(t):this.setRGB(t,n,r)}return(0,c.Z)(e,[{key:"x",get:function(){return this.r},set:function(e){this.r=e}},{key:"y",get:function(){return this.g},set:function(e){this.g=e}},{key:"z",get:function(){return this.b},set:function(e){this.b=e}},{key:"set",value:function(t){return t instanceof e?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}},{key:"setRGB",value:function(e,t,n){return this.r=e,this.g=t,this.b=n,this}},{key:"setHSL",value:function(t,n,r){var i;if(t=(t%(i=1)+i)%i,n=Dt(n,0,1),r=Dt(r,0,1),0===n)this.r=this.g=this.b=r;else{var a=r<=.5?r*(1+n):r+n-r*n,o=2*r-a;this.r=e.hue2rgb(o,a,t+1/3),this.g=e.hue2rgb(o,a,t),this.b=e.hue2rgb(o,a,t-1/3)}return this}},{key:"setStyle",value:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("Color: Alpha component of ".concat(e," will be ignored."))}var n;if(n=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){var r,i=n[1],a=n[2];switch(i){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[4]),this;if(r=/^\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){var o=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,u=parseInt(r[3],10)/100;return t(r[4]),this.setHSL(o,s,u)}}}else if(n=/^#([A-Fa-f\d]+)$/.exec(e)){var c=n[1],l=c.length;if(3===l)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,this}return this}},{key:"clone",value:function(){return new e(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copyGammaToLinear",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}},{key:"copyLinearToGamma",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}},{key:"convertGammaToLinear",value:function(e){return this.copyGammaToLinear(this,e),this}},{key:"convertLinearToGamma",value:function(e){return this.copyLinearToGamma(this,e),this}},{key:"copySRGBToLinear",value:function(t){return this.r=e.SRGBToLinear(t.r),this.g=e.SRGBToLinear(t.g),this.b=e.SRGBToLinear(t.b),this}},{key:"copyLinearToSRGB",value:function(t){return this.r=e.LinearToSRGB(t.r),this.g=e.LinearToSRGB(t.g),this.b=e.LinearToSRGB(t.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}},{key:"getHexString",value:function(){return"#"+("000000"+this.getHex().toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t,n,r=this.r,i=this.g,a=this.b,o=Math.max(r,i,a),s=Math.min(r,i,a),u=(s+o)/2;if(s===o)t=0,n=0;else{var c=o-s;switch(n=u<=.5?c/(o+s):c/(2-o-s),o){case r:t=(i-a)/c+(i<a?6:0);break;case i:t=(a-r)/c+2;break;case a:t=(r-i)/c+4}t/=6}return e.h=t,e.s=n,e.l=u,e}},{key:"getStyle",value:function(){return"rgb(".concat(255*this.r|0,",").concat(255*this.g|0,",").concat(255*this.b|0,")")}},{key:"offsetHSL",value:function(t,n,r){return this.getHSL(e._hslA),e._hslA.h+=t,e._hslA.s+=n,e._hslA.l+=r,this.setHSL(e._hslA.h,e._hslA.s,e._hslA.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(t,n){this.getHSL(e._hslA),t.getHSL(e._hslB);var r=Bt(e._hslA.h,e._hslB.h,n),i=Bt(e._hslA.s,e._hslB.s,n),a=Bt(e._hslA.l,e._hslB.l,n);return this.setHSL(r,i,a),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}},{key:"toJSON",value:function(){return this.getHex()}},{key:"getAvg",value:function(){return(this.r+this.g+this.b)/3}}],[{key:"hue2rgb",value:function(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}},{key:"SRGBToLinear",value:function(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}},{key:"LinearToSRGB",value:function(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}},{key:"Black",value:function(){return new e(0,0,0)}},{key:"White",value:function(){return new e(1,1,1)}},{key:"Red",value:function(){return new e(1,0,0)}},{key:"Green",value:function(){return new e(0,1,0)}},{key:"Blue",value:function(){return new e(0,0,1)}},{key:"Purple",value:function(){return new e(.5,0,.5)}},{key:"Magenta",value:function(){return new e(1,0,1)}},{key:"Yellow",value:function(){return new e(1,1,0)}},{key:"Orange",value:function(){return new e(1,.65,0)}},{key:"Gray",value:function(){return new e(.5,.5,.5)}},{key:"Teal",value:function(){return new e(0,1,1)}},{key:"Random",value:function(){return new e(Math.random(),Math.random(),Math.random())}}]),e}();(0,l.Z)(so,"_hslA",{h:0,s:0,l:0}),(0,l.Z)(so,"_hslB",{h:0,s:0,l:0});__webpack_require__(4211),__webpack_require__(1874);function uo(e){return e&&at(e.schedule)}function co(e){return e[e.length-1]}function lo(e){return at(co(e))?e.pop():void 0}function ho(e){return uo(co(e))?e.pop():void 0}var fo=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function po(e){return at(null==e?void 0:e.then)}function mo(e){return at(e[Lt])}function vo(e){return Symbol.asyncIterator&&at(null==e?void 0:e[Symbol.asyncIterator])}function yo(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var go="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function bo(e){return at(null==e?void 0:e[go])}function Mo(e){return rt(this,arguments,(function(){var t,n,r;return Qe(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,nt(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,nt(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,nt(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function ko(e){return at(null==e?void 0:e.getReader)}function _o(e){if(e instanceof zt)return e;if(null!=e){if(mo(e))return i=e,new zt((function(e){var t=i[Lt]();if(at(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(fo(e))return r=e,new zt((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(po(e))return n=e,new zt((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,mt)}));if(vo(e))return xo(e);if(bo(e))return t=e,new zt((function(e){var n,r;try{for(var i=Je(t),a=i.next();!a.done;a=i.next()){var o=a.value;if(e.next(o),e.closed)return}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}e.complete()}));if(ko(e))return xo(Mo(e))}var t,n,r,i;throw yo(e)}function xo(e){return new zt((function(t){(function(e,t){var n,r,i,a;return $e(this,void 0,void 0,(function(){var o,s;return Qe(this,(function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),n=it(e),u.label=1;case 1:return[4,n.next()];case 2:if((r=u.sent()).done)return[3,4];if(o=r.value,t.next(o),t.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=u.sent(),i={error:s},[3,11];case 6:return u.trys.push([6,,9,10]),r&&!r.done&&(a=n.return)?[4,a.call(n)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function To(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var a=t.schedule((function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(a),!i)return a}function wo(e,t){return void 0===t&&(t=0),qt((function(n,r){n.subscribe(Wt(r,(function(n){return To(r,e,(function(){return r.next(n)}),t)}),(function(){return To(r,e,(function(){return r.complete()}),t)}),(function(n){return To(r,e,(function(){return r.error(n)}),t)})))}))}function Ro(e,t){return void 0===t&&(t=0),qt((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function Zo(e,t){if(!e)throw new Error("Iterable cannot be null");return new zt((function(n){To(n,t,(function(){var r=e[Symbol.asyncIterator]();To(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function So(e,t){if(null!=e){if(mo(e))return function(e,t){return _o(e).pipe(Ro(t),wo(t))}(e,t);if(fo(e))return function(e,t){return new zt((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(po(e))return function(e,t){return _o(e).pipe(Ro(t),wo(t))}(e,t);if(vo(e))return Zo(e,t);if(bo(e))return function(e,t){return new zt((function(n){var r;return To(n,t,(function(){r=e[go](),To(n,t,(function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(e){return void n.error(e)}i?n.complete():n.next(t)}),0,!0)})),function(){return at(null==r?void 0:r.return)&&r.return()}}))}(e,t);if(ko(e))return function(e,t){return Zo(Mo(e),t)}(e,t)}throw yo(e)}function Co(e,t){return t?So(e,t):_o(e)}function Io(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Co(e,ho(e))}var Eo=Array.isArray,Ao=Object.getPrototypeOf,Oo=Object.prototype,Do=Object.keys;function Po(e){if(1===e.length){var t=e[0];if(Eo(t))return{args:t,keys:null};if((r=t)&&"object"==typeof r&&Ao(r)===Oo){var n=Do(t);return{args:n.map((function(e){return t[e]})),keys:n}}}var r;return{args:e,keys:null}}function Bo(e,t){return qt((function(n,r){var i=0;n.subscribe(Wt(r,(function(n){r.next(e.call(t,n,i++))})))}))}var Fo=Array.isArray;function Lo(e){return Bo((function(t){return function(e,t){return Fo(t)?e.apply(void 0,tt([],et(t))):e(t)}(e,t)}))}function No(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})}function jo(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=ho(e),r=lo(e),i=Po(e),a=i.args,o=i.keys;if(0===a.length)return Co([],n);var s=new zt(zo(a,n,o?function(e){return No(o,e)}:Nt));return r?s.pipe(Lo(r)):s}function zo(e,t,n){return void 0===n&&(n=Nt),function(r){Uo(t,(function(){for(var i=e.length,a=new Array(i),o=i,s=i,u=function(i){Uo(t,(function(){var u=Co(e[i],t),c=!1;u.subscribe(Wt(r,(function(e){a[i]=e,c||(c=!0,s--),s||r.next(n(a.slice()))}),(function(){--o||r.complete()})))}),r)},c=0;c<i;c++)u(c)}),r)}}function Uo(e,t,n){e?To(n,e,t):t()}function Vo(e){return qt((function(t,n){var r,i=null,a=!1;i=t.subscribe(Wt(n,void 0,void 0,(function(o){r=_o(e(o,Vo(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):a=!0}))),a&&(i.unsubscribe(),i=null,r.subscribe(n))}))}function Ho(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new Ht}:t,r=e.resetOnError,i=void 0===r||r,a=e.resetOnComplete,o=void 0===a||a,s=e.resetOnRefCountZero,u=void 0===s||s;return function(e){var t,r,a,s=0,c=!1,l=!1,h=function(){null==r||r.unsubscribe(),r=void 0},f=function(){h(),t=a=void 0,c=l=!1},p=function(){var e=t;f(),null==e||e.unsubscribe()};return qt((function(e,m){s++,l||c||h();var d=a=null!=a?a:n();m.add((function(){0!==--s||l||c||(r=Go(p,u))})),d.subscribe(m),!t&&s>0&&(t=new Tt({next:function(e){return d.next(e)},error:function(e){l=!0,h(),r=Go(f,i,e),d.error(e)},complete:function(){c=!0,h(),r=Go(f,o),d.complete()}}),_o(e).subscribe(t))}))(e)}}function Go(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!0!==t){if(!1!==t){var i=new Tt({next:function(){i.unsubscribe(),e()}});return _o(t.apply(void 0,tt([],et(n)))).subscribe(i)}}else e()}function qo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qo(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Yo=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mData",void 0),this.mData=t}return(0,c.Z)(e,[{key:"getRawData",value:function(){return this.mData}},{key:"getCatalogue",value:function(){var e;return null!==(e=this.mData.catalogue)&&void 0!==e?e:{}}},{key:"getMaterialsByGroup",value:function(){var e;return null!==(e=this.mData.materials_by_group)&&void 0!==e?e:[]}},{key:"getAttributes",value:function(){var e;return null!==(e=this.mData.attributes)&&void 0!==e?e:{}}},{key:"getRules",value:function(){var e;return null!==(e=this.mData.rules)&&void 0!==e?e:[]}},{key:"getOffsetGroups",value:function(){var e;return null!==(e=this.mData.offset_groups)&&void 0!==e?e:{}}},{key:"getCatalogueClasses",value:function(){var e;return null!==(e=this.mData.modifier_classes)&&void 0!==e?e:{}}},{key:"getPricingSettings",value:function(){return this.buildDefaultPricingSettings(this.mData.pricing_settings)}},{key:"getPricingGroups",value:function(){var e;return null!==(e=this.mData.pricing_groups)&&void 0!==e?e:{}}},{key:"getMaterials",value:function(){var e;return null!==(e=this.mData.all_materials)&&void 0!==e?e:{}}},{key:"getMedia",value:function(){var e;return null!==(e=this.mData.media)&&void 0!==e?e:{}}},{key:"getPrintReadyFiles",value:function(){var e;return null!==(e=this.mData.print_ready_files)&&void 0!==e?e:{}}},{key:"buildDefaultPricingSettings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Wo(Wo({id:null,sku_calculator:"part_sku"},e),{},{price_calculators:Wo({attribute_pricing:!0,pricing_matrix:!0,script_engine:!1,external_api:!1},(e||{}).price_calculators)})}}]),e}(),Ko=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mLoader",{})}var n,i;return(0,c.Z)(e,[{key:"resetCache",value:function(){return this.disposeCacheLoader(),this}},{key:"disposeCacheLoader",value:function(){var e=this;Object.keys(this.mLoader).forEach((function(t){e.mLoader[t]&&e.mLoader[t].error("disposed")})),this.mLoader={}}},{key:"resolveBootstrapData",value:function(e){var t=this;return f.Ft.isNumeric(e)?(this.mLoader[e]||(this.mLoader[e]=new ni(1),fi.getInstance().resolveMeta(e).pipe(sn(1)).subscribe({next:function(n){qe.qL.print("bootstrap got meta: ",n),t._resolveFromCache(e,n).then((function(n){qe.qL.print("boostrap got data from cache: ",n),t.mLoader[e].next(new Yo(n))}),(function(n){t._resolveFromAPI(e).then((function(n){qe.qL.print("boostrap got data from api: ",n),t.mLoader[e].next(new Yo(n))}),(function(n){t.mLoader[e].error(n),delete t.mLoader[e]}))}))},error:function(n){t.mLoader[e].error(n),delete t.mLoader[e]}})),this.mLoader[e].pipe(Ho())):ci((function(){return new Error("Catalogue id is not an ID")}))}},{key:"_resolveFromAPI",value:(i=t(r().mark((function e(t){var n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new URL("".concat(Jr.E.apiUrl,"catalogue/").concat(t,"/bootstrap"))).searchParams.append("include[attributes]","categories,values.categories,values.valuable,entityProperties.entityPropertyValues"),n.searchParams.append("include[pricing_groups]","pricing_rules.pricingRuleAdjustmentFields,pricing_classes"),this.isInSceneEditor()&&n.searchParams.append("useActiveDB","true"),e.next=6,ei.getInstance().get(decodeURIComponent(n.toString()));case 6:if(200===(i=e.sent).status){e.next=9;break}throw new Error("Response status: ".concat(i.status));case 9:return e.abrupt("return",i.data);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_resolveFromCache",value:(n=t(r().mark((function e(t,n){var i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof n.bootstrap_data_cache_file&&0!==n.bootstrap_data_cache_file.length){e.next=2;break}throw new Error("not hash");case 2:return i=n.bootstrap_data_cache_file,e.next=5,ei.uniqueInstance().get(i,{baseURL:Jr.E.spacesUrl});case 5:if(200===(a=e.sent).status){e.next=8;break}throw new Error("Response status: ".concat(a.status));case 8:return e.abrupt("return",a.data);case 9:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"isInSceneEditor",value:function(){return P.stateRegistery().get(Ci.SCENE_EDITOR)}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new this),this._instance}}]),e}();(0,l.Z)(Ko,"_instance",null);var Xo=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mModels",{}),(0,l.Z)(this,"mMaterialLoaders",{}),(0,l.Z)(this,"mDependencyLoaders",{})}var n,i,a,o;return(0,c.Z)(e,[{key:"getModels",value:function(){var e=this;return Object.keys(this.mModels).map((function(t){return e.mModels[t]}))}},{key:"resetCache",value:function(){return this.disposeCacheLoader(),this.mModels={},this}},{key:"disposeCacheLoader",value:function(){var e=this;Object.keys(this.mMaterialLoaders).forEach((function(t){e.mMaterialLoaders[t].error("disposed")})),this.mMaterialLoaders={},Object.keys(this.mDependencyLoaders).forEach((function(t){e.mDependencyLoaders[t].error("disposed")})),this.mDependencyLoaders={}}},{key:"resolveModel",value:(o=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if(!f.Ft.isNumeric(t))return r("requested id is not an integer: ".concat(t));var i=parseInt(t,10);if(i in n.mModels)return e(n.mModels[i]);var a=Object.keys(n.mDependencyLoaders).map((function(e){return n.mDependencyLoaders[e].pipe(Vo((function(){return Io([])})))}));qe.qL.print("material bootstrap dependencies: ",a),n.finishDependencies(a).pipe(sn(1)).subscribe((function(){qe.qL.print("material finish dependency"),n._getModelFromAPI(i).then((function(t){e(t)}),(function(e){r(e)}))}),(function(e){qe.qL.error("bootstrap material failed",e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"resolveModels",value:(a=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if(t.map((function(e){return f.Ft.isNumeric(e)})).some((function(e){return!e})))return r("requested list contains non-numeric values: "+t.join(", "));var i=Object.keys(n.mDependencyLoaders).map((function(e){return n.mDependencyLoaders[e].pipe(Vo((function(){return Io([])})))}));n.finishDependencies(i).pipe(sn(1)).subscribe((function(){qe.qL.print("Material finish dependency"),n._getModelsFromAPI(t).then(e,r)}),(function(e){qe.qL.error("Bootstrap material failed",e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"finishDependencies",value:function(e){return e.length>0?jo(e):Io(!0)}},{key:"_getModelFromAPI",value:(i=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if(t in n.mModels)return e(n.mModels[t]);t in n.mMaterialLoaders||(n.mMaterialLoaders[t]=new ni(1),ei.getInstance().get(Jr.E.makeApiRoute("material/".concat(t))).then((function(e){var r=e.data;n.mMaterialLoaders[t].next(v.getItem(r))}),(function(e){n.mMaterialLoaders[t].error(e)}))),n.mMaterialLoaders[t].pipe(sn(1)).subscribe((function(r){n.mModels[t]=r,delete n.mMaterialLoaders[t],e(r)}),(function(e){delete n.mMaterialLoaders[t],r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"_getModelsFromAPI",value:(n=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=t.map((function(e){return e in n.mModels?n.mModels[e]:e})),a=i.filter((function(e){return"number"!=typeof e})),o=i.filter((function(e){return"number"==typeof e}));o.length>0?ei.getInstance().get("".concat(Jr.E.apiUrl,"material?id=").concat(o.join("|"))).then((function(e){var t=v.getItems(e.data);return t.forEach((function(e){n.mModels[e.id]=e})),t}),(function(){return[]})).then((function(t){e(a.concat(t))}),(function(e){r(e)})):e(a)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"preloadCatalogue",value:function(e){var t=this,n=f.Ft.isNumeric(e)?parseInt("".concat(e),10):null;return null===n?ci("Catalogue id is not an ID"):(this.mDependencyLoaders[n]||(this.mDependencyLoaders[n]=new ni(1),qe.qL.print("material resolve bootstrap data"),Ko.getInstance().resolveBootstrapData(n).pipe(sn(1)).subscribe((function(e){var r=e.getMaterials(),i=v.getItems(r);i.forEach((function(e){t.mModels[e.id]=e})),qe.qL.print("bootstrap material pre load: ",i),t.mDependencyLoaders[n].next(!0)}),(function(e){qe.qL.warn("Bootstrap material pre load failed",e),t.mDependencyLoaders[n].error(e),delete t.mDependencyLoaders[n]}))),this.mDependencyLoaders[n])}}],[{key:"getInstance",value:function(){return null===this._instance&&(this._instance=new this),this._instance}}]),e}();(0,l.Z)(Xo,"_instance",null);var $o;__webpack_require__(6699),__webpack_require__(2023);!function(e){e[e.Unloaded=0]="Unloaded",e[e.InProgress=1]="InProgress",e[e.Ready=2]="Ready",e[e.Error=3]="Error"}($o||($o={}));__webpack_require__(5994);var Qo,Jo,es=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mUniqueId",void 0),this.mUniqueId=++e.sResourceCount}return(0,c.Z)(e,[{key:"getUniqueId",value:function(){return this.mUniqueId}}]),e}();function ts(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(es,"sResourceCount",Number.MIN_SAFE_INTEGER),function(e){e[e.Disable=0]="Disable",e[e.Add=1]="Add",e[e.Combine=2]="Combine",e[e.Subtract=3]="Subtract",e[e.Multiply=4]="Multiply",e[e.Maximized=5]="Maximized",e[e.OneOne=6]="OneOne",e[e.Interpolate=7]="Interpolate",e[e.ScreenMode=8]="ScreenMode"}(Qo||(Qo={})),function(e){e[e.Multiply=0]="Multiply",e[e.Mix=1]="Mix",e[e.Add=2]="Add"}(Jo||(Jo={}));var ns=function(e){(0,g.Z)(n,e);var t=ts(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(es);function rs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var is,as=function(e){(0,g.Z)(n,e);var t=rs(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(ns);function os(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}!function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(is||(is={}));var ss=function(e){(0,g.Z)(n,e);var t=os(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(ns);function us(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var cs=function(e){(0,g.Z)(n,e);var t=us(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(as);function ls(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var hs=function(e){(0,g.Z)(n,e);var t=ls(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(cs);function fs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var ps=function(e){(0,g.Z)(n,e);var t=fs(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(ns);function ms(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var ds=function(e){(0,g.Z)(n,e);var t=ms(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(ps);function vs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var ys=function(e){(0,g.Z)(n,e);var t=vs(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(ds),gs=function(){function e(){(0,u.Z)(this,e)}var n;return(0,c.Z)(e,[{key:"canHandle",value:function(e){return this.hasGroupInPropertyName(e)?this.canHandleGroup(this.getGroup(e)):this.canHandleKey(e)}},{key:"canHandleKey",value:function(e){return this.mSupportedProperties.includes(this.mapKey((0,f.B_)(e)))}},{key:"canHandleGroup",value:function(e){return this.mSupportedGroups.includes(this.mapGroupKey((0,f.B_)(e)))}},{key:"intToColor3",value:function(e){var t="string"==typeof e?parseInt(e,10):e;return new so((t>>16&255)/255,(t>>8&255)/255,(255&t)/255)}},{key:"loadTexture2d",value:(n=t(r().mark((function e(t,n,i,a,o){var s,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n){e.next=2;break}throw new Error("Undefined texture id.");case 2:return i.forceShared=!(!a||void 0===a.force_shared)&&a.force_shared,s=t.makeResource(n,i,o),e.next=6,new Promise((function(e,n){t.resolveResource(s,(function(t){if(!t)throw new Error("Failed to load texture");e(t)})).then((function(){}),(function(e){n(e)}))}));case 6:return u=e.sent,e.abrupt("return",u);case 8:case"end":return e.stop()}}),e)}))),function(e,t,r,i,a){return n.apply(this,arguments)})},{key:"disposeTexture",value:function(e,t,n,r){t&&e.disposeTexture(t,n,r)}},{key:"getGroup",value:function(e){var t=e.split(".");return 1===t.length?t.join(""):t.splice(0,t.length-1).join(".")}},{key:"getPropertyName",value:function(e){var t=e.split(".");return t[t.length-1]}},{key:"hasGroupInPropertyName",value:function(e){return e.includes(".")}}]),e}();function bs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ms=function(e){(0,g.Z)(n,e);var t=bs(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(ns);function ks(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var _s,xs,Ts,ws,Rs,Zs,Ss,Cs=function(e){(0,g.Z)(n,e);var t=ks(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(ns);function Is(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}!function(e){e[e.UnsignedByte=1009]="UnsignedByte",e[e.Byte=1010]="Byte",e[e.Short=1011]="Short",e[e.UnsignedShort=1012]="UnsignedShort",e[e.Int=1013]="Int",e[e.UnsignedInt=1014]="UnsignedInt",e[e.Float=1015]="Float",e[e.HalfFloat=1016]="HalfFloat",e[e.UnsignedShort4444=1017]="UnsignedShort4444",e[e.UnsignedShort5551=1018]="UnsignedShort5551",e[e.UnsignedShort565=1019]="UnsignedShort565",e[e.UnsignedInt248=1020]="UnsignedInt248"}(_s||(_s={})),function(e){e[e.Alpha=1021]="Alpha",e[e.Red=1028]="Red",e[e.RedInt=1029]="RedInt",e[e.RG=1030]="RG",e[e.RGInt=1031]="RGInt",e[e.RGB=1022]="RGB",e[e.RGBInt=1032]="RGBInt",e[e.RGBA=1023]="RGBA",e[e.RGBAInt=1033]="RGBAInt",e[e.Luminance=1024]="Luminance",e[e.LuminanceAlpha=1025]="LuminanceAlpha",e[e.Depth=1026]="Depth",e[e.DepthStencil=1027]="DepthStencil"}(xs||(xs={})),function(e){e[e.Linear=3e3]="Linear",e[e.sRGB=3001]="sRGB",e[e.Gamma=3007]="Gamma",e[e.RGBE=3002]="RGBE",e[e.LogLuv=3003]="LogLuv",e[e.RGBM7=3004]="RGBM7",e[e.RGBM16=3005]="RGBM16",e[e.RGBD=3006]="RGBD",e[e.BasicDepthPacking=3200]="BasicDepthPacking",e[e.RGBADepthPacking=3201]="RGBADepthPacking"}(Ts||(Ts={})),function(e){e[e.UV=300]="UV",e[e.Cube=301]="Cube",e[e.Equirectangular=303]="Equirectangular",e[e.Spherical=305]="Spherical"}(ws||(ws={})),function(e){e[e.Reflect=1]="Reflect",e[e.Refract=2]="Refract",e[e.ReflectRefract=3]="ReflectRefract"}(Rs||(Rs={})),function(e){e[e.None=-1]="None",e[e.Nearest=1003]="Nearest",e[e.Linear=1006]="Linear"}(Zs||(Zs={})),function(e){e[e.Repeat=1e3]="Repeat",e[e.ClampToEdge=1001]="ClampToEdge",e[e.MirrorRepeat=1002]="MirrorRepeat"}(Ss||(Ss={}));var Es,As=function(e){(0,g.Z)(n,e);var t=Is(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(es);function Os(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}!function(e){e[e.Front=0]="Front",e[e.Back=1]="Back",e[e.Double=2]="Double"}(Es||(Es={}));var Ds=function(e){(0,g.Z)(n,e);var t=Os(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(ns);function Ps(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Bs=function(e){(0,g.Z)(i,e);var n=Ps(i);function i(){var e;(0,u.Z)(this,i);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e=n.call.apply(n,[this].concat(r)),(0,l.Z)((0,_.Z)(e),"mSupportedProperties",["id","uuid","type","shading","side","combine","blending","depthTest","depthWrite","fog","premultipliedAlpha","transparent","wireframe","enableFresnelDiff","enableFresnelEnv","enableSpecularGlossiness","alphaTest","opacity","aoMapIntensity","lightMapIntensity","envMapIntensity","reflectivity","refractionRatio","wireframeLineWidth","emissiveIntensity","bumpScale","displacementScale","displacementBias","shininess","metalness","roughness","clearCoat","clearCoatRoughness","envMapScale","fresnelDiffScale","fresnelDiffBias","fresnelDiffPower","fresnelEnvBias","fresnelEnvScale","fresnelEnvPower","glossiness","normalScale","normalMapScale","color","diffuse","diffuseColor","emissive","emissiveColor","specular","specularColor","fresnelDiffColorLeft","alphaMap","aoMap","lightMap","map","diffuseMap","specularMap","emissiveMap","bumpMap","displacementMap","normalMap","metalnessMap","roughnessMap","gradientMap","glossinessMap","envMap","cameraLayer","lights","name","ssrl","renderOrder","userdata","textureSx","textureSy","propertyId"]),(0,l.Z)((0,_.Z)(e),"mSupportedGroups",[]),e}return(0,c.Z)(i,[{key:"mapKey",value:function(e){switch(e){case"emissiveMapIntensity":return"emissiveIntensity";case"materialId":return"id"}return e}},{key:"mapGroupKey",value:function(e){return e}},{key:"handle",value:function(e,n,i,a,o,s){var u=this,c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=arguments.length>7?arguments[7]:void 0,h=this.mapKey((0,f.B_)(n));switch(h){case"id":case"uuid":case"name":case"type":return!1;case"cameraLayer":var p=e.getMetaData();return(p=p||{}).cameraLayer=i,p.cameraLayerNeedsUpdate=!0,e.setMetaData(p),!0}switch(h){case"shading":var m="flatshading"===String(i).toLocaleLowerCase();return e.setFlatShading(m),!0;case"side":return"backside"===String(i).toLowerCase()?e.setSide(Es.Back):"frontside"===String(i).toLowerCase()?e.setSide(Es.Front):"doubleside"===String(i).toLowerCase()&&e.setSide(Es.Double),!0;case"combine":if(e instanceof as||e instanceof Cs)switch(String(i).toLowerCase()){case"multiply":e.setEnvMapCombine(Jo.Multiply);break;case"mixoperation":e.setEnvMapCombine(Jo.Mix);break;case"addoperation":e.setEnvMapCombine(Jo.Add)}return!0;case"blending":switch(i.toLowerCase()){case"normalblending":e.setAlphaMode(Qo.Combine);break;case"additiveblending":e.setAlphaMode(Qo.Add);break;case"subtractiveblending":e.setAlphaMode(Qo.Subtract);break;case"multiplyblending":e.setAlphaMode(Qo.Multiply)}return!0}switch(h){case"depthTest":return e.setDepthTest((0,f.oA)(i)),!0;case"depthWrite":return e.setDepthWrite((0,f.oA)(i)),!0;case"fog":return e.setFog((0,f.oA)(i)),!0;case"premultipliedAlpha":return e.setPremultipliedAlpha((0,f.oA)(i)),!0;case"transparent":return e.setTransparent((0,f.oA)(i)),!0;case"wireframe":return e.setWireframe((0,f.oA)(i)),!0;case"enableFresnelDiff":return(e instanceof hs||e instanceof ys)&&e.setFresnelDiffuseEnabled((0,f.oA)(i)),!0;case"enableFresnelEnv":return(e instanceof hs||e instanceof ys)&&e.setFresnelEnvMapEnabled((0,f.oA)(i)),!0;case"enableSpecularGlossiness":return e instanceof ys&&e.setSpecularGlossinessEnabled((0,f.oA)(i)),!0}switch(h){case"alphaTest":var d=parseFloat(i);return isNaN(d)||e.setAlphaTest(d),!0;case"opacity":var v=parseFloat(i);return isNaN(v)||e.setOpacity(v),!0;case"aoMapIntensity":if(e instanceof ss){var y=parseFloat(i);isNaN(y)||e.setAoIntensity(y)}else if(e instanceof as||e instanceof Cs||e instanceof ps){var g=parseFloat(i);isNaN(g)||e.setAoIntensity(g)}return!0;case"lightMapIntensity":if(e instanceof ss){var b=parseFloat(i);isNaN(b)||e.setLightMapIntensity(b)}else if(e instanceof Cs||e instanceof cs||e instanceof ps){var M=parseFloat(i);isNaN(M)||e.setLightMapIntensity(M)}return!0;case"envMapIntensity":if(e instanceof ss){var k=parseFloat(i);isNaN(k)||e.setEnvironmentIntensity(k)}else if(e instanceof Cs||e instanceof cs||e instanceof ps){var _=parseFloat(i);isNaN(_)||e.setEnvMapIntensity(_)}return!0;case"reflectivity":if(e instanceof ss){var x=parseFloat(i);isNaN(x)||e.setReflectionColor(new so(x,x,x))}else if(e instanceof Cs||e instanceof as||e instanceof ds){var T=parseFloat(i);isNaN(T)||e.setReflectivity(T)}return!0;case"refractionRatio":if(e instanceof ss){var w=parseFloat(i);isNaN(w)||e.setSubSurfaceConfiguration({indexOfRefraction:w})}else if(e instanceof Cs||e instanceof as||e instanceof ps){var R=parseFloat(i);isNaN(R)||e.setIOR(R)}return!0;case"wireframeLinewidth":var Z=parseFloat(i);return isNaN(Z)||e.setWireframeLineWidth(Z),!0;case"emissiveIntensity":if(e instanceof ss){var S=parseFloat(i);isNaN(S)||e.setEmissiveIntensity(S)}else if(e instanceof Cs||e instanceof cs||e instanceof ps){var C=parseFloat(i);isNaN(C)||e.setEmissiveIntensity(C)}return!0;case"bumpScale":if(e instanceof ss){var I=parseFloat(i);isNaN(I)||e.setNormalScale(new D(I,I))}else if(e instanceof cs||e instanceof ps){var E=parseFloat(i);isNaN(E)||e.setBumpScale(E)}return!0;case"displacementScale":if(e instanceof ss){var A=parseFloat(i);isNaN(A)||e.setParallaxScaleBias(A)}else if(e instanceof cs||e instanceof ps){var O=parseFloat(i);isNaN(O)||e.setDisplacementScale(O)}return!0;case"displacementBias":if(e instanceof cs||e instanceof ps){var P=parseFloat(i);isNaN(P)||e.setDisplacementBias(P)}return!0;case"metalness":if(e instanceof ss){var B=parseFloat(i);isNaN(B)||e.setMetalness(B)}else if(e instanceof ps){var F=parseFloat(i);isNaN(F)||e.setMetalness(F)}return!0;case"roughness":if(e instanceof ss){var L=parseFloat(i);isNaN(L)||e.setRoughness(L)}else if(e instanceof ps){var N=parseFloat(i);isNaN(N)||e.setRoughness(N)}return!0;case"clearCoat":if(e instanceof ss){var j=parseFloat(i);isNaN(j)||e.setClearCoatConfiguration({isEnabled:!0,intensity:j})}else if(e instanceof ds){var z=parseFloat(i);isNaN(z)||e.setClearCoat(z)}return!0;case"clearCoatRoughness":if(e instanceof ss){var U=parseFloat(i);isNaN(U)||e.setClearCoatConfiguration({isEnabled:!0,roughness:U})}else if(e instanceof ds){var V=parseFloat(i);isNaN(V)||e.setClearCoatRoughness(V)}return!0;case"fresnelDiffScale":if(e instanceof hs||e instanceof ys){var H=parseFloat(i);isNaN(H)||e.setFresnelDiffuseScale(H)}return!0;case"fresnelDiffBias":if(e instanceof hs||e instanceof ys){var G=parseFloat(i);isNaN(G)||e.setFresnelDiffuseBias(G)}return!0;case"fresnelDiffPower":if(e instanceof hs||e instanceof ys){var q=parseFloat(i);isNaN(q)||e.setFresnelDiffusePower(q)}return!0;case"fresnelEnvBias":if(e instanceof hs||e instanceof ys){var W=parseFloat(i);isNaN(W)||e.setFresnelEnvMapBias(W)}return!0;case"fresnelEnvScale":if(e instanceof hs||e instanceof ys){var Y=parseFloat(i);isNaN(Y)||e.setFresnelEnvMapScale(Y)}return!0;case"fresnelEnvPower":if(e instanceof hs||e instanceof ys){var K=parseFloat(i);isNaN(K)||e.setFresnelEnvMapPower(K)}return!0;case"glossiness":if(e instanceof ss){var X=parseFloat(i);isNaN(X)||e.setMicroSurface(X)}else if(e instanceof ys){var $=parseFloat(i);isNaN($)||e.setGlossiness($)}return!0}switch(h){case"shininess":if(e instanceof ss){var Q=parseInt(i,10);if(!isNaN(Q)){var J=Q/100;e.setSpecularIntensity(J)}}else if(e instanceof cs){var ee=parseInt(i,10);isNaN(ee)||e.setShininess(ee)}return!0;case"renderOrder":var te=parseInt(i,10);if(!isNaN(te))(e.getMetaData()||{}).renderOrder=te;return!0}switch(h){case"envMapScale":if(e instanceof ss){var ne=parseFloat(i);isNaN(ne)||e.setEnvironmentBdrfMapScale(new D(ne,ne))}else if(e instanceof hs||e instanceof ys){var re=parseFloat(i);isNaN(re)||e.setEnvMapScale(new D(re,re))}return!0;case"normalScale":case"normalMapScale":if(e instanceof ss){var ie=parseFloat(i);isNaN(ie)||e.setNormalScale(new D(ie,ie))}else if(e instanceof ps||e instanceof cs){var ae=parseFloat(i);isNaN(ae)||e.setNormalScale(new D(ae,ae))}return!0}switch(h){case"color":case"diffuse":case"diffuseColor":return(e instanceof Ms||e instanceof ss||e instanceof Cs||e instanceof as||e instanceof ps||e instanceof Ds)&&(isNaN(i)||e.setDiffuseColor(this.intToColor3(i))),!0;case"emissive":case"emissiveColor":return(e instanceof ss||e instanceof Cs||e instanceof cs||e instanceof ps)&&(isNaN(i)||e.setEmissiveColor(this.intToColor3(i))),!0;case"specular":case"specularColor":return e instanceof ss?isNaN(i)||e.setSpecularColor(this.intToColor3(i)):(e instanceof cs||e instanceof ys)&&(isNaN(i)||e.setSpecular(this.intToColor3(i))),!0;case"fresnelDiffColorLeft":return(e instanceof hs||e instanceof ys)&&(isNaN(i)||e.setFresnelDiffuseColor(this.intToColor3(i))),!0}switch(h){case"alphaMap":return s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n={properties:{useRGBasAlpha:!0}};if(e instanceof ss){var r=e.getAlphaMap();if(r&&c&&u.disposeTexture(o,r,l),null==i)return e.setAlphaMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setAlphaMap(t)}),(function(t){qe.qL.error(t),e.setAlphaMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else if(e instanceof Cs||e instanceof as||e instanceof ps){var s=e.getAlphaMap();if(s&&c&&u.disposeTexture(o,s,l),null==i)return e.setAlphaMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setAlphaMap(t)}),(function(t){qe.qL.error(t),e.setAlphaMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else t(!1)})));case 1:case"end":return t.stop()}}),t)})))),!0;case"aoMap":return s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n={properties:{uvChannel:1}};if(e instanceof ss){n.properties.level=e.getAoIntensity();var r=e.getAoMap();if(r&&c&&u.disposeTexture(o,r,l),null==i)return e.setAoMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setAoMap(t)}),(function(t){qe.qL.error(t),e.setAoMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else if(e instanceof Cs||e instanceof as||e instanceof ps){n.properties.level=e.getAoIntensity();var s=e.getAoMap();if(s&&c&&u.disposeTexture(o,s,l),null==i)return e.setAoMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setAoMap(t)}),(function(t){qe.qL.error(t),e.setAoMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else t(!1)})));case 1:case"end":return t.stop()}}),t)})))),!0;case"lightMap":return s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n={properties:{uvChannel:1}};if(e instanceof ss){n.properties.level=e.getLightMapIntensity();var r=e.getLightMap();if(r&&c&&u.disposeTexture(o,r,l),null==i)return e.setLightMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setLightMap(t)}),(function(t){qe.qL.error(t),e.setLightMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else if(e instanceof Cs||e instanceof cs||e instanceof ps){n.properties.level=e.getLightMapIntensity();var s=e.getLightMap();if(s&&c&&u.disposeTexture(o,s,l),null==i)return e.setLightMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setLightMap(t)}),(function(t){qe.qL.error(t),e.setLightMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else t(!1)})));case 1:case"end":return t.stop()}}),t)})))),!0;case"map":case"diffuseMap":return s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n={properties:{}};if(e instanceof ss){var r=e.getDiffuseMap();if(r&&c&&u.disposeTexture(o,r,l),null==i)return e.setDiffuseMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setDiffuseMap(t)}),(function(t){qe.qL.error(t),e.setDiffuseMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else if(e instanceof Cs||e instanceof as||e instanceof ps){var s=e.getDiffuseMap();if(s&&c&&u.disposeTexture(o,s,l),null==i)return e.setDiffuseMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setDiffuseMap(t)}),(function(t){qe.qL.error(t),e.setDiffuseMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else t(!1)})));case 1:case"end":return t.stop()}}),t)})))),!0;case"specularMap":return s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n={properties:{}};if(e instanceof ss){n.properties.level=e.getSpecularIntensity();var r=e.getSpecularMap();if(r&&c&&u.disposeTexture(o,r,l),null==i)return e.setSpecularMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setSpecularMap(t)}),(function(t){qe.qL.error(t),e.setSpecularMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else if(e instanceof Cs||e instanceof as){var s=e.getSpecularMap();if(s&&c&&u.disposeTexture(o,s,l),null==i)return e.setSpecularMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setSpecularMap(t)}),(function(t){qe.qL.error(t),e.setSpecularMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else t(!1)})));case 1:case"end":return t.stop()}}),t)})))),!0;case"emissiveMap":return s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n={properties:{}};if(e instanceof ss){n.properties.level=e.getEmissiveIntensity();var r=e.getEmissiveMap();if(r&&c&&u.disposeTexture(o,r,l),null==i)return e.setEmissiveMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setEmissiveMap(t)}),(function(t){qe.qL.error(t),e.setEmissiveMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else if(e instanceof Cs||e instanceof cs||e instanceof ps){n.properties.level=e.getEmissiveIntensity();var s=e.getEmissiveMap();if(s&&c&&u.disposeTexture(o,s,l),null==i)return e.setEmissiveMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setEmissiveMap(t)}),(function(t){qe.qL.error(t),e.setEmissiveMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else t(!1)})));case 1:case"end":return t.stop()}}),t)})))),!0;case"bumpMap":return s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n={properties:{}};if(e instanceof ss){n.properties.level=e.getNormalScale().x;var r=e.getNormalMap();if(r&&c&&u.disposeTexture(o,r,l),null==i)return e.setNormalMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setNormalMap(t)}),(function(t){qe.qL.error(t),e.setNormalMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else if(e instanceof cs||e instanceof ps){n.properties.level=e.getBumpScale();var s=e.getBumpMap();if(s&&c&&u.disposeTexture(o,s,l),null==i)return e.setBumpMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setBumpMap(t)}),(function(t){qe.qL.error(t),e.setBumpMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else t(!1)})));case 1:case"end":return t.stop()}}),t)})))),!0;case"displacementMap":return s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n={properties:{}};if(e instanceof ss){if(n.properties.level=e.getParallaxScaleBias(),!e.getNormalMap()){if(null==i)return e.setFlags({useParallax:!1}),e.setNormalMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setFlags({useParallax:!0,useParallaxOcclusion:!1}),e.setNormalMap(t)}),(function(t){qe.qL.error(t),e.setFlags({useParallax:!1}),e.setNormalMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}}else if(e instanceof cs||e instanceof ps){n.properties.level=e.getDisplacementScale();var r=e.getDisplacementMap();if(r&&c&&u.disposeTexture(o,r,l),null==i)return e.setDisplacementMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setDisplacementMap(t)}),(function(t){qe.qL.error(t),e.setDisplacementMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else t(!1)})));case 1:case"end":return t.stop()}}),t)})))),!0;case"normalMap":return s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n={properties:{}};if(e instanceof ss){n.properties.level=e.getNormalScale().x;var r=e.getNormalMap();if(r&&c&&u.disposeTexture(o,r,l),null==i)return e.setNormalMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setNormalMap(t)}),(function(t){qe.qL.error(t),e.setNormalMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else if(e instanceof cs||e instanceof ps){n.properties.level=e.getNormalScale().x;var s=e.getNormalMap();if(s&&c&&u.disposeTexture(o,s,l),null==i)return e.setNormalMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setNormalMap(t)}),(function(t){qe.qL.error(t),e.setNormalMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else t(!1)})));case 1:case"end":return t.stop()}}),t)})))),!0;case"metalnessMap":return s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n={properties:{level:1}};if(e instanceof ss){n.properties.level=e.getMetalness();var r=e.getMetalnessMap();if(r&&c&&u.disposeTexture(o,r,l),null==i)return e.setMetalnessMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setMetalnessMap(t)}),(function(t){qe.qL.error(t),e.setMetalnessMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else if(e instanceof ps){n.properties.level=e.getMetalness();var s=e.getMetalnessMap();if(s&&c&&u.disposeTexture(o,s,l),null==i)return e.setMetalnessMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setMetalnessMap(t)}),(function(t){qe.qL.error(t),e.setMetalnessMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else t(!1)})));case 1:case"end":return t.stop()}}),t)})))),!0;case"roughnessMap":return s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n={properties:{level:1}};if(e instanceof ss){n.properties.level=e.getRoughness();var r=e.getMicroSurfaceMap();if(r&&c&&u.disposeTexture(o,r,l),null==i)return e.setMicroSurfaceMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setMicroSurfaceMap(t)}),(function(t){qe.qL.error(t),e.setMicroSurfaceMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else if(e instanceof ps){n.properties.level=e.getRoughness();var s=e.getRoughnessMap();if(s&&c&&u.disposeTexture(o,s,l),null==i)return e.setRoughnessMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setRoughnessMap(t)}),(function(t){qe.qL.error(t),e.setRoughnessMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else t(!1)})));case 1:case"end":return t.stop()}}),t)})))),!0;case"gradientMap":return!1;case"glossinessMap":return s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n={properties:{}};if(e instanceof ss){n.properties.level=e.getMicroSurface();var r=e.getMicroSurfaceMap();if(r&&c&&u.disposeTexture(o,r,l),null==i)return e.setMicroSurfaceMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setMicroSurfaceMap(t)}),(function(t){qe.qL.error(t),e.setMicroSurfaceMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else if(e instanceof ys){n.properties.level=e.getGlossiness();var s=e.getGlossinessMap();if(s&&c&&u.disposeTexture(o,s,l),null==i)return e.setGlossinessMap(null),t(!0);u.loadTexture2d(o,i,n,a,l).then((function(t){e.setGlossinessMap(t)}),(function(t){qe.qL.error(t),e.setGlossinessMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else t(!1)})));case 1:case"end":return t.stop()}}),t)})))),!0;case"envMap":return s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=(a&&a.name?a.name:"").includes("enable_refraction_e"),r={properties:{mapping:ws.Equirectangular,renderMode:n?Rs.Refract:Rs.Reflect}};if(e instanceof ss){r.properties.level=e.getEnvironmentIntensity();var s=e.getReflectionMap();if(s&&c&&u.disposeTexture(o,s,l),null==i)return e.setReflectionMap(null),t(!0);u.loadTexture2d(o,i,r,a,l).then((function(t){e.setReflectionMap(t)}),(function(t){qe.qL.error(t),e.setReflectionMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else if(e instanceof Cs||e instanceof as||e instanceof ps){(e instanceof cs||e instanceof ps)&&(r.properties.level=e.getEnvMapIntensity());var h=e.getEnvMap();if(h&&c&&u.disposeTexture(o,h,l),null==i)return e.setEnvMap(null),t(!0);u.loadTexture2d(o,i,r,a,l).then((function(t){e.setEnvMap(t)}),(function(t){qe.qL.error(t),e.setEnvMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))}else t(!1)})));case 1:case"end":return t.stop()}}),t)})))),!0}return!1}}]),i}(gs);function Fs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ls=function(e){(0,g.Z)(i,e);var n=Fs(i);function i(){var e;(0,u.Z)(this,i);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e=n.call.apply(n,[this].concat(r)),(0,l.Z)((0,_.Z)(e),"mSupportedProperties",["useAlphaFromDiffuseMap","ambientColor","aoMapImpactOnAnalyticalLights","directLightIntensity","environmentIntensity","environmentBrdfMap","environmentBrdfMapScale","parallaxScaleBias","reflectionColor","reflectionMap","specularIntensity","twoSidedLighting","unlit","reflectanceMap","microSurface","microSurfaceMap","metalnessF0Factor","metallicReflectanceColor","metallicReflectanceMap","useSpecularGlossinessWorkflow","brdfConfiguration","detailMapConfiguration","clearCoatConfiguration","sheenConfiguration","anisotropicConfiguration","subSurfaceConfiguration","iridescenceConfiguration","flags"]),(0,l.Z)((0,_.Z)(e),"mSupportedGroups",["brdfConfiguration","detailMapConfiguration","clearCoatConfiguration","sheenConfiguration","anisotropicConfiguration","subSurfaceConfiguration","iridescenceConfiguration","flags"]),e}return(0,c.Z)(i,[{key:"mapKey",value:function(e){return e}},{key:"mapGroupKey",value:function(e){return e}},{key:"handle",value:function(e,n,i,a,o,s){var u=this,c=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],h=arguments.length>7?arguments[7]:void 0,p=this.mapKey((0,f.B_)(n)),m=this.getGroup(p);if(!(e instanceof ss))return!0;switch(m){case"ambientColor":return e.setAmbientColor(this.intToColor3(i)),!0;case"useAlphaFromDiffuseMap":return e.useAlphaFromDiffuseMap((0,f.oA)(i)),!0;case"aoMapImpactOnAnalyticalLights":return(0,f.fk)(i)<=0?e.setAoMapImpactOnAnalyticalLights(0):e.setAoMapImpactOnAnalyticalLights(1),!0;case"directLightIntensity":var d=(0,f.a6)(i);return isNaN(d)||e.setDirectLightIntensity(d),!0;case"environmentIntensity":var v=(0,f.a6)(i);return isNaN(v)||e.setEnvironmentIntensity(v),!0;case"environmentBrdfMapScale":var y=(0,f.a6)(i);return isNaN(y)||e.setEnvironmentBdrfMapScale(new D(y,y)),!0;case"parallaxScaleBias":var g=(0,f.a6)(i);return isNaN(g)||e.setParallaxScaleBias(g),!0;case"reflectionColor":return e.setReflectionColor(this.intToColor3(i)),!0;case"specularIntensity":var b=(0,f.a6)(i);return isNaN(b)||e.setSpecularIntensity(b),!0;case"twoSidedLighting":return e.setTwoSidedLighting((0,f.oA)(i)),!0;case"unlit":return e.setUnlit((0,f.oA)(i)),!0;case"reflectanceMap":return(0,f.le)(i)||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getReflectanceMap();n&&c&&u.disposeTexture(o,n,h),u.loadTexture2d(o,i,{},a,h).then((function(t){e.setReflectanceMap(t)}),(function(t){qe.qL.error(t),e.setReflectanceMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)})))),!0;case"microSurface":var M=(0,f.a6)(i);return isNaN(M)||e.setMicroSurface(M),!0;case"metalnessF0Factor":var k=(0,f.a6)(i);return isNaN(k)||e.setMetalnessF0Factor(k),!0;case"metallicReflectanceColor":return e.setMetallicReflectanceColor(this.intToColor3(i)),!0;case"useSpecularGlossinessWorkflow":return e.useSpecularGlossinessWorkflow((0,f.oA)(i)),!0;case"metallicReflectanceMap":return(0,f.le)(i)||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getMetallicReflectanceMap();n&&c&&u.disposeTexture(o,n,h),u.loadTexture2d(o,i,{},a,h).then((function(t){e.setMetallicReflectanceMap(t)}),(function(t){qe.qL.error(t),e.setMetallicReflectanceMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)})))),!0;case"environmentBrdfMap":return(0,f.le)(i)||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getEnvironmentBrdfMap();n&&c&&u.disposeTexture(o,n,h),u.loadTexture2d(o,i,{},a,h).then((function(t){e.setEnvironmentBrdfMap(t)}),(function(t){qe.qL.error(t),e.setEnvironmentBrdfMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)})))),!0;case"reflectionMap":return(0,f.le)(i)||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getReflectionMap();n&&c&&u.disposeTexture(o,n,h),u.loadTexture2d(o,i,{},a,h).then((function(t){e.setReflectionMap(t)}),(function(t){qe.qL.error(t),e.setReflectionMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)})))),!0;case"microSurfaceMap":return(0,f.le)(i)||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getMicroSurfaceMap();n&&c&&u.disposeTexture(o,n,h),u.loadTexture2d(o,i,{},a,h).then((function(t){e.setMicroSurfaceMap(t)}),(function(t){qe.qL.error(t),e.setMicroSurfaceMap(null)})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)})))),!0}switch(m){case"brdfConfiguration":return(this.hasGroupInPropertyName(this.mapKey((0,f.B_)(n)))?[(0,l.Z)({},this.getPropertyName(p),i)]:Object.entries(i||{}).map((function(e){return(0,l.Z)({},(0,f.B_)(e[0]),e[1])}))).forEach((function(t){var n=Object.entries(t)[0],r=n[0],i=n[1];switch(r){case"useEnergyConservation":e.setBrdfConfiguration({useEnergyConservation:(0,f.oA)(i)});break;case"useSpecularGlossinessInputEnergyConservation":e.setBrdfConfiguration({useSpecularGlossinessInputEnergyConservation:(0,f.oA)(i)})}})),!0;case"detailMapConfiguration":return(this.hasGroupInPropertyName(this.mapKey((0,f.B_)(n)))?[(0,l.Z)({},this.getPropertyName(p),i)]:Object.entries(i||{}).map((function(e){return(0,l.Z)({},(0,f.B_)(e[0]),e[1])}))).forEach((function(n){var i=Object.entries(n)[0],l=i[0],p=i[1];switch(l){case"isEnabled":e.setDetailMapConfiguration({isEnabled:(0,f.oA)(p)});break;case"map":(0,f.le)(p)&&!e.getDetailMapConfiguration().map||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getDetailMapConfiguration().map;if(n&&c&&u.disposeTexture(o,n,h),(0,f.le)(p))return e.setDetailMapConfiguration({map:null}),t(!0);u.loadTexture2d(o,p,{},a,h).then((function(t){return e.setDetailMapConfiguration({map:t})}),(function(t){qe.qL.error(t),e.setDetailMapConfiguration({map:null})})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)}))));break;case"diffuseBlendLevel":e.setDetailMapConfiguration({diffuseBlendLevel:(0,f.a6)(p)});break;case"roughnessBlendLevel":e.setDetailMapConfiguration({roughnessBlendLevel:(0,f.a6)(p)});break;case"bumpLevel":e.setDetailMapConfiguration({bumpLevel:(0,f.a6)(p)});break;case"normalBlendMethod":e.setDetailMapConfiguration({normalBlendMethod:(0,f.a6)(p)})}})),!0;case"clearCoatConfiguration":return(this.hasGroupInPropertyName(this.mapKey((0,f.B_)(n)))?[(0,l.Z)({},this.getPropertyName(p),i)]:Object.entries(i||{}).map((function(e){return(0,l.Z)({},(0,f.B_)(e[0]),e[1])}))).forEach((function(n){var i=Object.entries(n)[0],l=i[0],p=i[1];switch(l){case"isEnabled":e.setClearCoatConfiguration({isEnabled:(0,f.oA)(p)});break;case"intensity":e.setClearCoatConfiguration({intensity:(0,f.a6)(p)});break;case"roughness":e.setClearCoatConfiguration({roughness:(0,f.a6)(p)});break;case"indexOfRefraction":e.setClearCoatConfiguration({indexOfRefraction:(0,f.a6)(p)});break;case"map":(0,f.le)(p)&&!e.getClearCoatConfiguration().map||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getClearCoatConfiguration().map;if(n&&c&&u.disposeTexture(o,n,h),(0,f.le)(p))return e.setClearCoatConfiguration({map:null}),t(!0);u.loadTexture2d(o,p,{},a,h).then((function(t){return e.setClearCoatConfiguration({map:t})}),(function(t){qe.qL.error(t),e.setClearCoatConfiguration({map:null})})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)}))));break;case"useRoughnessFromMainMap":e.setClearCoatConfiguration({useRoughnessFromMainMap:(0,f.oA)(p)});break;case"roughnessMap":(0,f.le)(p)&&!e.getClearCoatConfiguration().roughnessMap||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getClearCoatConfiguration().roughnessMap;if(n&&c&&u.disposeTexture(o,n,h),(0,f.le)(p))return e.setClearCoatConfiguration({roughnessMap:null}),t(!0);u.loadTexture2d(o,p,{},a,h).then((function(t){return e.setClearCoatConfiguration({roughnessMap:t})}),(function(t){qe.qL.error(t),e.setClearCoatConfiguration({roughnessMap:null})})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)}))));break;case"remapF0OnInterfaceChange":e.setClearCoatConfiguration({remapF0OnInterfaceChange:(0,f.oA)(p)});break;case"bumpMap":(0,f.le)(p)&&!e.getClearCoatConfiguration().bumpMap||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getClearCoatConfiguration().bumpMap;if(n&&c&&u.disposeTexture(o,n,h),(0,f.le)(p))return e.setClearCoatConfiguration({bumpMap:null}),t(!0);u.loadTexture2d(o,p,{},a,h).then((function(t){return e.setClearCoatConfiguration({bumpMap:t})}),(function(t){qe.qL.error(t),e.setClearCoatConfiguration({bumpMap:null})})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)}))));break;case"isTintEnabled":e.setClearCoatConfiguration({isTintEnabled:(0,f.oA)(p)});break;case"tintColor":e.setClearCoatConfiguration({tintColor:u.intToColor3(p)});break;case"tintColorAtDistance":e.setClearCoatConfiguration({tintColorAtDistance:(0,f.a6)(p)});break;case"tintThickness":e.setClearCoatConfiguration({tintThickness:(0,f.a6)(p)});break;case"tintMap":(0,f.le)(p)&&!e.getClearCoatConfiguration().tintMap||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getClearCoatConfiguration().tintMap;if(n&&c&&u.disposeTexture(o,n,h),(0,f.le)(p))return e.setClearCoatConfiguration({tintMap:null}),t(!0);u.loadTexture2d(o,p,{},a,h).then((function(t){return e.setClearCoatConfiguration({tintMap:t})}),(function(t){qe.qL.error(t),e.setClearCoatConfiguration({tintMap:null})})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)}))))}})),!0;case"sheenConfiguration":return(this.hasGroupInPropertyName(this.mapKey((0,f.B_)(n)))?[(0,l.Z)({},this.getPropertyName(p),i)]:Object.entries(i||{}).map((function(e){return(0,l.Z)({},(0,f.B_)(e[0]),e[1])}))).forEach((function(n){var i=Object.entries(n)[0],l=i[0],p=i[1];switch(l){case"isEnabled":e.setSheenConfiguration({isEnabled:(0,f.oA)(p)});break;case"linkSheenWithDiffuse":e.setSheenConfiguration({linkSheenWithDiffuse:(0,f.oA)(p)});break;case"intensity":e.setSheenConfiguration({intensity:(0,f.a6)(p)});break;case"color":e.setSheenConfiguration({color:u.intToColor3(p)});break;case"map":(0,f.le)(p)&&!e.getSheenConfiguration().map||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getSheenConfiguration().map;if(n&&c&&u.disposeTexture(o,n,h),(0,f.le)(p))return e.setSheenConfiguration({map:null}),t(!0);u.loadTexture2d(o,p,{},a,h).then((function(t){return e.setSheenConfiguration({map:t})}),(function(t){qe.qL.error(t),e.setSheenConfiguration({map:null})})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)}))));break;case"useRoughnessFromMainMap":e.setSheenConfiguration({useRoughnessFromMainMap:(0,f.oA)(p)});break;case"roughness":var m=(0,f.a6)(p);e.setSheenConfiguration({roughness:isNaN(m)?null:m});break;case"roughnessMap":(0,f.le)(p)&&!e.getSheenConfiguration().roughnessMap||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getSheenConfiguration().roughnessMap;if(n&&c&&u.disposeTexture(o,n,h),(0,f.le)(p))return e.setSheenConfiguration({roughnessMap:null}),t(!0);u.loadTexture2d(o,p,{},a,h).then((function(t){return e.setSheenConfiguration({roughnessMap:t})}),(function(t){qe.qL.error(t),e.setSheenConfiguration({roughnessMap:null})})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)}))));break;case"diffuseScaling":e.setSheenConfiguration({diffuseScaling:(0,f.oA)(p)})}})),!0;case"anisotropicConfiguration":return(this.hasGroupInPropertyName(this.mapKey((0,f.B_)(n)))?[(0,l.Z)({},this.getPropertyName(p),i)]:Object.entries(i||{}).map((function(e){return(0,l.Z)({},(0,f.B_)(e[0]),e[1])}))).forEach((function(n){var i=Object.entries(n)[0],l=i[0],p=i[1];switch(l){case"isEnabled":e.setAnisotropicConfiguration({isEnabled:(0,f.oA)(p)});break;case"intensity":e.setAnisotropicConfiguration({intensity:(0,f.a6)(p)});break;case"direction":var m=new D(1,0);Array.isArray(p)?(m.x=(0,f.a6)(p[0]),m.y=(0,f.a6)(p[1])):Number.isFinite((0,f.a6)(null==p?void 0:p.direction_x))&&(m.x=(0,f.a6)(p.direction_x),m.y=(0,f.a6)(p.direction_y)),e.setAnisotropicConfiguration({direction:m});break;case"map":(0,f.le)(p)&&!e.getAnisotropicConfiguration().map||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getAnisotropicConfiguration().map;if(n&&c&&u.disposeTexture(o,n,h),(0,f.le)(p))return e.setAnisotropicConfiguration({map:null}),t(!0);u.loadTexture2d(o,p,{},a,h).then((function(t){return e.setAnisotropicConfiguration({map:t})}),(function(t){qe.qL.error(t),e.setAnisotropicConfiguration({map:null})})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)}))))}})),!0;case"subSurfaceConfiguration":return(this.hasGroupInPropertyName(this.mapKey((0,f.B_)(n)))?[(0,l.Z)({},this.getPropertyName(p),i)]:Object.entries(i||{}).map((function(e){return(0,l.Z)({},(0,f.B_)(e[0]),e[1])}))).forEach((function(n){var i=Object.entries(n)[0],l=i[0],p=i[1];switch(l){case"isRefractionEnabled":e.setSubSurfaceConfiguration({isRefractionEnabled:(0,f.oA)(p)});break;case"isTranslucencyEnabled":e.setSubSurfaceConfiguration({isTranslucencyEnabled:(0,f.oA)(p)});break;case"isScatteringEnabled":e.setSubSurfaceConfiguration({isScatteringEnabled:(0,f.oA)(p)});break;case"scatteringDiffusionProfile":var m=(0,f.kE)(p);e.setSubSurfaceConfiguration({scatteringDiffusionProfile:m?u.intToColor3(p):null});break;case"refractionIntensity":e.setSubSurfaceConfiguration({refractionIntensity:(0,f.a6)(p)});break;case"translucencyIntensity":e.setSubSurfaceConfiguration({translucencyIntensity:(0,f.a6)(p)});break;case"useDiffuseToTintRefraction":e.setSubSurfaceConfiguration({useDiffuseToTintRefraction:(0,f.oA)(p)});break;case"useDiffuseToTintTranslucency":e.setSubSurfaceConfiguration({useDiffuseToTintTranslucency:(0,f.oA)(p)});break;case"thicknessMap":(0,f.le)(p)&&!e.getSubSurfaceConfiguration().thicknessMap||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getSubSurfaceConfiguration().thicknessMap;if(n&&c&&u.disposeTexture(o,n,h),(0,f.le)(p))return e.setSubSurfaceConfiguration({thicknessMap:null}),t(!0);u.loadTexture2d(o,p,{},a,h).then((function(t){return e.setSubSurfaceConfiguration({thicknessMap:t})}),(function(t){qe.qL.error(t),e.setSubSurfaceConfiguration({thicknessMap:null})})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)}))));break;case"indexOfRefraction":e.setSubSurfaceConfiguration({indexOfRefraction:(0,f.a6)(p)});break;case"volumeIndexOfRefraction":e.setSubSurfaceConfiguration({volumeIndexOfRefraction:(0,f.a6)(p)});break;case"linkRefractionWithTransparency":e.setSubSurfaceConfiguration({linkRefractionWithTransparency:(0,f.oA)(p)});break;case"minimumThickness":e.setSubSurfaceConfiguration({minimumThickness:(0,f.a6)(p)});break;case"maximumThickness":e.setSubSurfaceConfiguration({maximumThickness:(0,f.a6)(p)});break;case"useThicknessAsDepth":e.setSubSurfaceConfiguration({useThicknessAsDepth:(0,f.oA)(p)});break;case"tintColor":e.setSubSurfaceConfiguration({tintColor:u.intToColor3(p)});break;case"tintColorAtDistance":e.setSubSurfaceConfiguration({tintColorAtDistance:(0,f.a6)(p)});break;case"diffusionDistance":e.setSubSurfaceConfiguration({diffusionDistance:u.intToColor3(p)});break;case"useMaskFromThicknessMap":e.setSubSurfaceConfiguration({useMaskFromThicknessMap:(0,f.oA)(p)});break;case"translucencyIntensityMap":(0,f.le)(p)&&!e.getSubSurfaceConfiguration().translucencyIntensityMap||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getSubSurfaceConfiguration().translucencyIntensityMap;if(n&&c&&u.disposeTexture(o,n,h),(0,f.le)(p))return e.setSubSurfaceConfiguration({translucencyIntensityMap:null}),t(!0);u.loadTexture2d(o,p,{},a,h).then((function(t){return e.setSubSurfaceConfiguration({translucencyIntensityMap:t})}),(function(t){qe.qL.error(t),e.setSubSurfaceConfiguration({translucencyIntensityMap:null})})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)}))))}})),!0;case"iridescenceConfiguration":return(this.hasGroupInPropertyName(this.mapKey((0,f.B_)(n)))?[(0,l.Z)({},this.getPropertyName(p),i)]:Object.entries(i||{}).map((function(e){return(0,l.Z)({},(0,f.B_)(e[0]),e[1])}))).forEach((function(n){var i=Object.entries(n)[0],l=i[0],p=i[1];switch(l){case"isEnabled":e.setIridescenceConfiguration({isEnabled:(0,f.oA)(p)});break;case"intensity":e.setIridescenceConfiguration({intensity:(0,f.a6)(p)});break;case"minimumThickness":e.setIridescenceConfiguration({minimumThickness:(0,f.a6)(p)});break;case"maximumThickness":e.setIridescenceConfiguration({maximumThickness:(0,f.a6)(p)});break;case"indexOfRefraction":e.setIridescenceConfiguration({indexOfRefraction:(0,f.a6)(p)});break;case"map":(0,f.le)(p)&&!e.getIridescenceConfiguration().map||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getIridescenceConfiguration().map;if(n&&c&&u.disposeTexture(o,n,h),(0,f.le)(p))return e.setIridescenceConfiguration({map:null}),t(!0);u.loadTexture2d(o,p,{},a,h).then((function(t){return e.setIridescenceConfiguration({map:t})}),(function(t){qe.qL.error(t),e.setIridescenceConfiguration({map:null})})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)}))));break;case"thicknessMap":(0,f.le)(p)&&!e.getIridescenceConfiguration().thicknessMap||s.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=e.getIridescenceConfiguration().thicknessMap;if(n&&c&&u.disposeTexture(o,n,h),(0,f.le)(p))return e.setIridescenceConfiguration({thicknessMap:null}),t(!0);u.loadTexture2d(o,p,{},a,h).then((function(t){return e.setIridescenceConfiguration({thicknessMap:t})}),(function(t){qe.qL.error(t),e.setIridescenceConfiguration({thicknessMap:null})})).then((function(){return t(!0)}),(function(){return t(!1)}))})));case 1:case"end":return t.stop()}}),t)}))))}})),!0;case"flags":return(this.hasGroupInPropertyName(this.mapKey((0,f.B_)(n)))?[(0,l.Z)({},this.getPropertyName(p),i)]:Object.entries(i||{}).map((function(e){return(0,l.Z)({},(0,f.B_)(e[0]),e[1])}))).forEach((function(t){var n=Object.entries(t)[0],r=n[0],i=n[1];switch(r){case"useAlphaFresnel":e.setFlags({useAlphaFresnel:(0,f.oA)(i)});break;case"useAlphaFromDiffuseMap":e.setFlags({useAlphaFromDiffuseMap:(0,f.oA)(i)});break;case"useAmbientInGrayScale":e.setFlags({useAmbientInGrayScale:(0,f.oA)(i)});break;case"useAmbientOcclusionFromMetallicMapRed":e.setFlags({useAmbientOcclusionFromMetallicMapRed:(0,f.oA)(i)});break;case"useAutoMicroSurfaceFromReflectivityMap":e.setFlags({useAutoMicroSurfaceFromReflectivityMap:(0,f.oA)(i)});break;case"useLightmapAsShadowmap":e.setFlags({useLightmapAsShadowmap:(0,f.oA)(i)});break;case"useLinearAlphaFresnel":e.setFlags({useLinearAlphaFresnel:(0,f.oA)(i)});break;case"useMetalnessFromMetallicMapBlue":e.setFlags({useMetalnessFromMetallicMapBlue:(0,f.oA)(i)});break;case"useMicroSurfaceFromReflectivityMapAlpha":e.setFlags({useMicroSurfaceFromReflectivityMapAlpha:(0,f.oA)(i)});break;case"useParallax":e.setFlags({useParallax:(0,f.oA)(i)});break;case"useParallaxOcclusion":e.setFlags({useParallaxOcclusion:(0,f.oA)(i)});break;case"useHorizonOcclusion":e.setFlags({useHorizonOcclusion:(0,f.oA)(i)});break;case"useRadianceOcclusion":e.setFlags({useRadianceOcclusion:(0,f.oA)(i)});break;case"useRadianceOverAlpha":e.setFlags({useRadianceOverAlpha:(0,f.oA)(i)});break;case"useRoughnessFromMetallicMapAlpha":e.setFlags({useRoughnessFromMetallicMapAlpha:(0,f.oA)(i)});break;case"useRoughnessFromMetallicMapGreen":e.setFlags({useRoughnessFromMetallicMapGreen:(0,f.oA)(i)});break;case"useSpecularAntiAliasing":e.setFlags({useSpecularAntiAliasing:(0,f.oA)(i)});break;case"useSpecularOverAlpha":e.setFlags({useSpecularOverAlpha:(0,f.oA)(i)});break;case"useOnlyMetallicFromMetallicReflectanceMap":e.setFlags({useOnlyMetallicFromMetallicReflectanceMap:(0,f.oA)(i)});break;case"usePhysicalLightFalloff":e.setFlags({usePhysicalLightFalloff:(0,f.oA)(i)})}})),!0}return!1}}]),i}(gs);function Ns(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return js(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return js(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function js(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var zs,Us=function(){function e(){(0,u.Z)(this,e)}var n;return(0,c.Z)(e,null,[{key:"parseModel",value:(n=t(r().mark((function t(n,i,a){var o,s,u,c=arguments;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=!(c.length>3&&void 0!==c[3])||c[3],s=c.length>4?c[4]:void 0,u=[],Object.keys(i).forEach((function(t){e.setMaterialProperty(n,t,i[t],i,a,u,o,s)&&P.eventBus().dispatch(new Di(Ei.RequestFrame))})),t.prev=4,t.next=7,new Promise((function(e){h.resolveAll(u,(function(){e()}))}));case 7:t.next=12;break;case 9:t.prev=9,t.t0=t.catch(4),qe.qL.error("Failed to parse material:",t.t0);case 12:return n.markDirty(),P.eventBus().dispatch(new Di(Ei.RequestFrame)),t.abrupt("return",i);case 15:case"end":return t.stop()}}),t,null,[[4,9]])}))),function(e,t,r){return n.apply(this,arguments)})},{key:"setMaterialProperty",value:function(t,n,r,i,a,o){var s,u=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],c=arguments.length>7?arguments[7]:void 0,l=Ns(e.mMaterialPropertyHandlers);try{for(l.s();!(s=l.n()).done;){var h=s.value;if(h.canHandle(n))return h.handle(t,n,r,i,a,o,u,c)}}catch(e){l.e(e)}finally{l.f()}return!1}},{key:"disposeMaterial",value:function(t,n,r){if(t instanceof ss){e.disposeTexture(n,t.getDiffuseMap(),r),t.setDiffuseMap(null),e.disposeTexture(n,t.getAlphaMap(),r),t.setAlphaMap(null),e.disposeTexture(n,t.getNormalMap(),r),t.setNormalMap(null),e.disposeTexture(n,t.getAoMap(),r),t.setAoMap(null),e.disposeTexture(n,t.getEmissiveMap(),r),t.setEmissiveMap(null),e.disposeTexture(n,t.getEnvironmentBrdfMap(),r),t.setEnvironmentBrdfMap(null),e.disposeTexture(n,t.getLightMap(),r),t.setLightMap(null),e.disposeTexture(n,t.getReflectionMap(),r),t.setReflectionMap(null),e.disposeTexture(n,t.getSpecularMap(),r),t.setSpecularMap(null),e.disposeTexture(n,t.getReflectanceMap(),r),t.setReflectanceMap(null),e.disposeTexture(n,t.getMicroSurfaceMap(),r),t.setMicroSurfaceMap(null),e.disposeTexture(n,t.getMetalnessMap(),r),t.setMetalness(null),e.disposeTexture(n,t.getMetallicReflectanceMap(),r),t.setMetallicReflectanceMap(null);var i=t.getDetailMapConfiguration();e.disposeTexture(n,i.map,r),t.setDetailMapConfiguration({map:null});var a=t.getClearCoatConfiguration();e.disposeTexture(n,a.map,r),e.disposeTexture(n,a.bumpMap,r),e.disposeTexture(n,a.tintMap,r),e.disposeTexture(n,a.roughnessMap,r),t.setClearCoatConfiguration({map:null,bumpMap:null,tintMap:null,roughnessMap:null});var o=t.getSheenConfiguration();e.disposeTexture(n,o.map,r),e.disposeTexture(n,o.roughnessMap,r),t.setSheenConfiguration({map:null,roughnessMap:null});var s=t.getAnisotropicConfiguration();e.disposeTexture(n,s.map,r),t.setAnisotropicConfiguration({map:null});var u=t.getSubSurfaceConfiguration();e.disposeTexture(n,u.thicknessMap,r),e.disposeTexture(n,u.translucencyIntensityMap,r),t.setSubSurfaceConfiguration({thicknessMap:null,translucencyIntensityMap:null});var c=t.getIridescenceConfiguration();e.disposeTexture(n,c.map,r),e.disposeTexture(n,c.thicknessMap,r),t.setIridescenceConfiguration({map:null,thicknessMap:null})}t instanceof as&&(e.disposeTexture(n,t.getDiffuseMap(),r),t.setDiffuseMap(null),e.disposeTexture(n,t.getAoMap(),r),t.setAoMap(null),e.disposeTexture(n,t.getSpecularMap(),r),t.setSpecularMap(null),e.disposeTexture(n,t.getAlphaMap(),r),t.setAlphaMap(null),e.disposeTexture(n,t.getEnvMap(),r),t.setEnvMap(null)),t instanceof cs&&(e.disposeTexture(n,t.getBumpMap(),r),t.setBumpMap(null),e.disposeTexture(n,t.getNormalMap(),r),t.setNormalMap(null),e.disposeTexture(n,t.getDisplacementMap(),r),t.setDisplacementMap(null),e.disposeTexture(n,t.getLightMap(),r),t.setLightMap(null),e.disposeTexture(n,t.getEmissiveMap(),r),t.setEmissiveMap(null)),t instanceof ps&&(e.disposeTexture(n,t.getDiffuseMap(),r),t.setDiffuseMap(null),e.disposeTexture(n,t.getAlphaMap(),r),t.setAlphaMap(null),e.disposeTexture(n,t.getAoMap(),r),t.setAoMap(null),e.disposeTexture(n,t.getBumpMap(),r),t.setBumpMap(null),e.disposeTexture(n,t.getDisplacementMap(),r),t.setDisplacementMap(null),e.disposeTexture(n,t.getEmissiveMap(),r),t.setEmissiveMap(null),e.disposeTexture(n,t.getEnvMap(),r),t.setEnvMap(null),e.disposeTexture(n,t.getLightMap(),r),t.setLightMap(null),e.disposeTexture(n,t.getMetalnessMap(),r),t.setMetalnessMap(null),e.disposeTexture(n,t.getNormalMap(),r),t.setNormalMap(null),e.disposeTexture(n,t.getRoughnessMap(),r),t.setRoughnessMap(null)),t instanceof ys&&(e.disposeTexture(n,t.getSpecularMap(),r),t.setSpecularMap(null),e.disposeTexture(n,t.getGlossinessMap(),r),t.setGlossinessMap(null)),t.dispose()}},{key:"disposeTexture",value:function(e,t,n){t&&t instanceof As&&e.disposeTexture(t,n)}}]),e}();(0,l.Z)(Us,"mMaterialPropertyHandlers",[new Bs,new Ls]),function(e){e.DIFFUSE="DiffuseMap",e.ALPHA="AlphaMap",e.ENVIRONMENT="EnvironmentMap",e.BUMP="BumpMap",e.DISPLACEMENT="DisplacementMap",e.NORMAL="NormalMap",e.METALNESS="MetalnessMap",e.ROUGHNESS="RoughnessMap",e.AO="AOMap",e.LIGHTMAP="LightMap",e.EMISSIVE="EmissiveMap",e.GLOSSINESS="GlossinessMap"}(zs||(zs={}));var Vs=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mHandle",void 0),(0,l.Z)(this,"mReferenceCount",0),(0,l.Z)(this,"mLockDisposable",!1),(0,l.Z)(this,"mDisposed",!1)}return(0,c.Z)(e,[{key:"_setHandle",value:function(e){this.mHandle=e}},{key:"_getHandle",value:function(){return this.mHandle}},{key:"_increaseReferenceCount",value:function(){return++this.mReferenceCount}},{key:"_decreaseReferenceCount",value:function(){return this.mReferenceCount=Math.max(--this.mReferenceCount,0),this.mReferenceCount}},{key:"dispose",value:function(e){return!!this.mDisposed||!(this.mLockDisposable&&!e)&&(qe.qL.print("Resource disposed:",this.mHandle._getHandle(),this.mHandle.getPoolKey(),this.mReferenceCount,e),!(0!==this.mReferenceCount&&!e)&&(this.mDisposed=!0,this.onDispose(e),!0))}},{key:"isDisposed",value:function(){return this.mDisposed}},{key:"_lockDisposable",value:function(e){this.mLockDisposable=e}},{key:"isLockedForDisposal",value:function(){return this.mLockDisposable}}]),e}();function Hs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Gs=function(e){(0,g.Z)(n,e);var t=Hs(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(As);function qs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ws=function(e){(0,g.Z)(o,e);var n,i,a=qs(o);function o(e,t,n,r){var i;return(0,u.Z)(this,o),i=a.call(this),(0,l.Z)((0,_.Z)(i),"mId",void 0),(0,l.Z)((0,_.Z)(i),"mForcedType",void 0),(0,l.Z)((0,_.Z)(i),"mModel",void 0),(0,l.Z)((0,_.Z)(i),"mMaterial",void 0),(0,l.Z)((0,_.Z)(i),"mState",void 0),(0,l.Z)((0,_.Z)(i),"mReadySubscriptions",[]),(0,l.Z)((0,_.Z)(i),"mMaterialLoader",void 0),(0,l.Z)((0,_.Z)(i),"mTextureManager",void 0),(0,l.Z)((0,_.Z)(i),"mColorOverwrite",void 0),(0,l.Z)((0,_.Z)(i),"mMapOverwrite",[]),(0,l.Z)((0,_.Z)(i),"mForceSharedTextures",!1),"number"==typeof e?(i.mId=e,i.mState=$o.Unloaded):(i.mMaterial=e,i.mState=$o.Ready),i.mModel=n,i.mForcedType=r,i.mTextureManager=t,i}return(0,c.Z)(o,[{key:"getModelId",value:function(){return this.mId}},{key:"setColorOverwrite",value:function(e){this.mColorOverwrite=e}},{key:"applyColorOverwrite",value:function(){if(this.mMaterial)if(this.mMaterial instanceof Ms||this.mMaterial instanceof ss){var e=this.mColorOverwrite?this.mColorOverwrite:so.White();this.mMaterial.setDiffuseColor(e),this.mMaterial.markDirty()}else if(this.mMaterial instanceof Cs||this.mMaterial instanceof as||this.mMaterial instanceof ps){var t=this.mColorOverwrite?this.mColorOverwrite:so.White();this.mMaterial.setDiffuseColor(t),this.mMaterial.markDirty()}else qe.qL.warn("Material not found to apply color overwrite.")}},{key:"setMapOverwrite",value:function(e,t){var n=this.getTextureProperties(e),r=this.mTextureManager.makeResource(t,n,this.mHandle.getPoolKey()),i=this.mMapOverwrite.findIndex((function(t){return t.type===e}));if(i>=0)return this.mMapOverwrite[i].handle&&this.mTextureManager.disposeResource(this.mMapOverwrite[i].handle),void(this.mMapOverwrite[i].handle=r);this.mMapOverwrite.push({type:e,handle:r})}},{key:"applyMapOverwrite",value:(i=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if(!n.mMaterial)return r("material is not ready");var i=n.mMapOverwrite.find((function(e){return e.type===t}));return i?i.handle?void n.mTextureManager.resolveResource(i.handle,(function(r){r instanceof Gs&&n.applyMapOverwriteTexture(t,r),e(r)})).then((function(){})).catch((function(e){r(e)})):(n.applyMapOverwriteTexture(t),e(void 0)):r("No overwrite for type ".concat(t))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"applyMapOverwriteTexture",value:function(e,t){try{switch(e){case zs.DIFFUSE:(this.mMaterial instanceof Ms||this.mMaterial instanceof ss||this.mMaterial instanceof Cs||this.mMaterial instanceof as||this.mMaterial instanceof ps)&&this.mMaterial.setDiffuseMap(t);break;case zs.ALPHA:(this.mMaterial instanceof ss||this.mMaterial instanceof Cs||this.mMaterial instanceof as||this.mMaterial instanceof ps)&&this.mMaterial.setAlphaMap(t);break;case zs.ENVIRONMENT:this.mMaterial instanceof ss?this.mMaterial.setReflectionMap(t):(this.mMaterial instanceof Cs||this.mMaterial instanceof as||this.mMaterial instanceof ps)&&this.mMaterial.setEnvMap(t);break;case zs.BUMP:this.mMaterial instanceof ss?this.mMaterial.setNormalMap(t):(this.mMaterial instanceof cs||this.mMaterial instanceof ps)&&this.mMaterial.setBumpMap(t);break;case zs.DISPLACEMENT:this.mMaterial instanceof ss?this.mMaterial.setFlags({useParallax:!0}):(this.mMaterial instanceof cs||this.mMaterial instanceof ps)&&this.mMaterial.setDisplacementMap(t);break;case zs.NORMAL:(this.mMaterial instanceof ss||this.mMaterial instanceof cs||this.mMaterial instanceof ps)&&this.mMaterial.setNormalMap(t);break;case zs.METALNESS:(this.mMaterial instanceof ss||this.mMaterial instanceof ps)&&this.mMaterial.setMetalnessMap(t);break;case zs.ROUGHNESS:this.mMaterial instanceof ss?this.mMaterial.setMicroSurfaceMap(t):this.mMaterial instanceof ps&&this.mMaterial.setRoughnessMap(t);break;case zs.AO:(this.mMaterial instanceof ss||this.mMaterial instanceof Cs||this.mMaterial instanceof as||this.mMaterial instanceof ps)&&this.mMaterial.setAoMap(t);break;case zs.LIGHTMAP:(this.mMaterial instanceof ss||this.mMaterial instanceof Cs||this.mMaterial instanceof cs||this.mMaterial instanceof ps)&&this.mMaterial.setLightMap(t);break;case zs.EMISSIVE:(this.mMaterial instanceof ss||this.mMaterial instanceof Cs||this.mMaterial instanceof cs||this.mMaterial instanceof ps)&&this.mMaterial.setEmissiveMap(t);break;case zs.GLOSSINESS:this.mMaterial instanceof ss?this.mMaterial.setMicroSurfaceMap(t):this.mMaterial instanceof ys&&this.mMaterial.setGlossinessMap(t)}this.mMaterial.markDirty()}catch(e){}}},{key:"getTextureProperties",value:function(e){var t={properties:{},forceShared:!(!this.mModel||void 0===this.mModel.force_shared)&&this.mModel.force_shared};switch(e){case zs.ALPHA:t.properties.useRGBasAlpha=!0;break;case zs.AO:var n=1;(this.mMaterial instanceof ss||this.mMaterial instanceof Cs||this.mMaterial instanceof as||this.mMaterial instanceof ps)&&(n=this.mMaterial.getAoIntensity()),t.properties.level=n,t.properties.uvChannel=1;break;case zs.LIGHTMAP:var r=1;(this.mMaterial instanceof ss||this.mMaterial instanceof Cs||this.mMaterial instanceof cs||this.mMaterial instanceof ps)&&(r=this.mMaterial.getLightMapIntensity()),t.properties.level=r,t.properties.uvChannel=1;break;case zs.EMISSIVE:var i=1;(this.mMaterial instanceof ss||this.mMaterial instanceof Cs||this.mMaterial instanceof cs||this.mMaterial instanceof ps)&&(i=this.mMaterial.getEmissiveIntensity()),t.properties.level=i;break;case zs.BUMP:var a=1;this.mMaterial instanceof ss?a=this.mMaterial.getNormalScale().x:(this.mMaterial instanceof cs||this.mMaterial instanceof ps)&&(a=this.mMaterial.getBumpScale()),t.properties.level=a;break;case zs.NORMAL:var o=1;(this.mMaterial instanceof ss||this.mMaterial instanceof cs||this.mMaterial instanceof ps)&&(o=this.mMaterial.getNormalScale().x),t.properties.level=o;break;case zs.DISPLACEMENT:var s=1;this.mMaterial instanceof ss?s=this.mMaterial.getParallaxScaleBias():(this.mMaterial instanceof cs||this.mMaterial instanceof ps)&&(s=this.mMaterial.getDisplacementScale()),t.properties.level=s;break;case zs.GLOSSINESS:var u=1;this.mMaterial instanceof ss?u=this.mMaterial.getMicroSurface():this.mMaterial instanceof ys&&(u=this.mMaterial.getGlossiness()),t.properties.level=u;break;case zs.METALNESS:var c=this.mMaterial instanceof ss||this.mMaterial instanceof ps?this.mMaterial.getMetalness():1;t.properties.level=c;break;case zs.ROUGHNESS:var l=this.mMaterial instanceof ss||this.mMaterial instanceof ps?this.mMaterial.getRoughness():1;t.properties.level=l;break;case zs.ENVIRONMENT:var h,f=((null===(h=this.mModel)||void 0===h?void 0:h.name)||"").includes("enable_refraction_e");t.properties.mapping=ws.Equirectangular,t.properties.renderMode=f?Rs.Refract:Rs.Reflect;var p=1;this.mMaterial instanceof ss?p=this.mMaterial.getEnvironmentIntensity():(this.mMaterial instanceof cs||this.mMaterial instanceof ps)&&(p=this.mMaterial.getEnvMapIntensity()),t.properties.level=p}return t}},{key:"resolve",value:(n=t(r().mark((function e(t,n){var i=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if("function"==typeof t)switch(i.mState){case $o.Ready:t(i.mMaterial);break;case $o.Error:t();break;case $o.Unloaded:case $o.InProgress:default:i.mReadySubscriptions.push(t)}return i.mState===$o.Ready?("function"==typeof n&&n(1),qe.qL.print("Material resource resolved:",i.mHandle._getHandle(),i.mReferenceCount),e(i.mMaterial)):i.mState===$o.Error?r("Failed to resolve material id: ".concat(i.mId)):(i.mMaterialLoader||(i.mState=$o.InProgress,i.mMaterialLoader=new ni(1),i.mModel?(void 0!==i.mModel.force_shared&&(i.mForceSharedTextures=i.mModel.force_shared),i.mMaterialLoader.next(i.createMaterial())):Xo.getInstance().resolveModel(i.mId).then((function(e){i.mState!==$o.Unloaded?(i.mModel=e,void 0!==i.mModel.force_shared&&(i.mForceSharedTextures=i.mModel.force_shared),i.mMaterialLoader.next(i.createMaterial())):r("Material disposed before finished loading!")})).catch((function(e){i.mState=$o.Error,i.dispatchFinalize(i.mMaterial),i.mMaterialLoader?i.mMaterialLoader.error(e):r(e)}))),void i.mMaterialLoader.pipe(sn(1)).subscribe({next:function(t){"function"==typeof n&&n(1),qe.qL.print("Material resource resolved:",i.mHandle._getHandle(),i.mReferenceCount),P.eventBus().dispatch(new Di(Ei.RequestFrame)),e(t)},error:function(e){r(e)}}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"dispatchFinalize",value:function(e){this.mReadySubscriptions.splice(0).forEach((function(t){return t(e)})),P.eventBus().dispatch(new Di(Ei.RequestFrame))}},{key:"createMaterial",value:function(){var e=this,t="res_id:".concat(this.mId),n=this.mForcedType?this.mForcedType:this.mModel.type;if(this.mMaterial=this.resolveMaterialByType(n,t),this.mMaterial)return Us.parseModel(this.mMaterial,this.mModel,this.mTextureManager,!0,this.mHandle.getPoolKey()).then((function(){if(e.mState!==$o.Unloaded)if(e.mColorOverwrite&&e.applyColorOverwrite(),e.mMapOverwrite.length>0){for(var t=[],n=0;n<e.mMapOverwrite.length;n++)t.push(e.applyMapOverwrite(e.mMapOverwrite[n].type));Promise.allSettled(t).then((function(){e.mState=$o.Ready,e.dispatchFinalize(e.mMaterial)})).catch((function(t){qe.qL.error(t),e.dispatchFinalize()}))}else e.mState=$o.Ready,e.dispatchFinalize(e.mMaterial);else e.dispatchFinalize()})).catch((function(t){qe.qL.error("Failed to parse material resource:",t),e.dispatchFinalize()})),this.mMaterial;this.dispatchFinalize()}},{key:"onDispose",value:function(e){return qe.qL.print("Material resource disposed.",this.mHandle._getHandle()),this.mState=$o.Unloaded,this.mMaterial&&(Us.disposeMaterial(this.mMaterial,this.mTextureManager,this.mHandle.getPoolKey()),delete this.mMaterial),this.mModel&&delete this.mModel,this.mMaterialLoader&&(this.mMaterialLoader.complete(),delete this.mMaterialLoader),this.dispatchFinalize(),!0}},{key:"resolveMaterialByType",value:function(e,t){switch(e){case"MeshLambertMaterial":return P.renderer().getRenderEngine().createMaterialLambert(t);case"MeshBasicMaterial":return P.renderer().getRenderEngine().createMaterialBasic(t);case"MeshPhongMaterial":return P.renderer().getRenderEngine().createMaterialPhong(t);case"MeshPhongMaterialExt":return P.renderer().getRenderEngine().createMaterialPhongExt(t);case"MeshStandardMaterial":return P.renderer().getRenderEngine().createMaterialStandard(t);case"MeshPhysicalMaterial":return P.renderer().getRenderEngine().createMaterialPhysical(t);case"MeshPhysicalMaterialExt":return P.renderer().getRenderEngine().createMaterialPhysicalExt(t);case"MaterialSimple":return P.renderer().getRenderEngine().createMaterialSimple(t);case"MaterialPBR":case"PbrMaterial":return P.renderer().getRenderEngine().createMaterialPBR(t);default:return}}},{key:"clone",value:function(){var e=new o(this.mId,this.mTextureManager,void 0,this.mForcedType);return e._setHandle(this._getHandle().clone()),e.mColorOverwrite=this.mColorOverwrite?this.mColorOverwrite.clone():void 0,e.mMapOverwrite=JSON.parse(JSON.stringify(this.mMapOverwrite)),this.mModel?(e.mModel=JSON.parse(JSON.stringify(this.mModel)),e.mModel.uuid=y.F.uuidV4(),e.mMaterial=this.mMaterial?this.mMaterial.cloneMaterial():void 0,e.mMaterial?(e.mState=$o.InProgress,Us.parseModel(e.mMaterial,e.mModel,this.mTextureManager,!1,e._getHandle().getPoolKey()).then((function(){if(e.mState!==$o.Unloaded){e.mColorOverwrite&&e.applyColorOverwrite(),e.mMapOverwrite&&0!==e.mMapOverwrite.length||(e.mState=$o.Ready);for(var t=[],n=0;n<e.mMapOverwrite.length;n++)t.push(e.applyMapOverwrite(e.mMapOverwrite[n].type));h.resolveArray(t,(function(){e.mState=$o.Ready}))}})).catch((function(e){qe.qL.error(e)}))):e.mState=this.mState):(e.mMaterial=this.mMaterial?this.mMaterial.cloneMaterial():void 0,e.mState=this.mState),e}},{key:"isForceSharedTextures",get:function(){return this.mForceSharedTextures}},{key:"getMapOverwrites",value:function(){return this.mMapOverwrite}}]),o}(Vs);function Ys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ks(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Xs=function(e){(0,g.Z)(f,e);var n,i,a,o,s,h=Ks(f);function f(e){var t;return(0,u.Z)(this,f),t=h.call(this),(0,l.Z)((0,_.Z)(t),"mTextureManager",void 0),(0,l.Z)((0,_.Z)(t),"mColorOverwrites",{}),(0,l.Z)((0,_.Z)(t),"mMapOverwrites",{}),t.mTextureManager=e,t.mMapOverwrites[f._poolKey]={},t.mColorOverwrites[f._poolKey]={},t}return(0,c.Z)(f,[{key:"getResourceGroupType",value:function(){return"Material"}},{key:"getTextureManager",value:function(){return this.mTextureManager}},{key:"loadLibrary",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(qe.qL.print("cleanup materials"),Xo.getInstance().resetCache(),this.cleanup(!0)),this}},{key:"cleanup",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Ni((0,M.Z)(f.prototype),"cleanup",this).call(this,e),this.mMapOverwrites[f._poolKey]={},this.mColorOverwrites[f._poolKey]={}}},{key:"setColorOverwrite",value:function(e,t,n){var r=void 0!==n?n:f._poolKey;if(this.mColorOverwrites[r]||(this.mColorOverwrites[r]={}),!(0,p.isNullOrUndefined)(t)&&0!==t.length||(0,p.isNullOrUndefined)(this.mColorOverwrites[r][e]))try{var i=new so(t);this.mColorOverwrites[r][e]=i}catch(e){qe.qL.error("Could not add color overwrite:",e)}else this.mColorOverwrites[r][e]=void 0;var a=this.mColorOverwrites[r][e],o=a||so.White();this.applyColorOverwrite(e,o,r)}},{key:"applyColorOverwrite",value:function(e,t,n){var r=void 0!==n?n:f._poolKey;this.resolveResourcePool(e,r);var i=this.findResourceWithHandleKey(String(e),r);i&&(i.setColorOverwrite(t),i.applyColorOverwrite(),P.eventBus().dispatch(new Di(Ei.RequestFrame),void 0,void 0,0))}},{key:"setMapOverwrite",value:(s=t(r().mark((function e(t,n,i,a){var o=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if((0,p.isNullOrUndefined)(n))return r("incorrect type");var s=void 0!==a?a:f._poolKey;o.mMapOverwrites[s]||(o.mMapOverwrites[s]={}),o.mMapOverwrites[s][t]||(o.mMapOverwrites[s][t]=[]);var u=o.mMapOverwrites[s][t].findIndex((function(e){return e.type===n}));if(((0,p.isNullOrUndefined)(i)||i<0)&&!(0,p.isNullOrUndefined)(o.mMapOverwrites[s][t][u]))u>=0&&delete o.mMapOverwrites[s][t][u].textureId;else try{u>=0?o.mMapOverwrites[s][t][u].textureId=i:(o.mMapOverwrites[s][t].push({type:n,textureId:i}),u=o.mMapOverwrites[s][t].length-1)}catch(e){}var c=o.mMapOverwrites[s][t][u].textureId;o.applyMapOverwrite(t,n,c,s).then((function(t){e(t)})).catch((function(e){r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return s.apply(this,arguments)})},{key:"applyMapOverwrite",value:(o=t(r().mark((function e(t,n,i,a){var o=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var s=void 0!==a?a:f._poolKey;o.resolveResourcePool(t,s);var u=o.findResourceWithHandleKey(String(t),s);if(!u)return r("Unable to find resource");u.setMapOverwrite(n,i),u.applyMapOverwrite(n).then((function(t){P.eventBus().dispatch(new Di(Ei.RequestFrame),void 0,void 0,0),e(t)})).catch((function(e){r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return o.apply(this,arguments)})},{key:"saveModel",value:(a=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=["id","uuid","name","type","hash","alpha_test","blending","depth_test","depth_write","fog","lights","opacity","premultiplied_alpha","shading","side","transparent","ssrl","render_order","resource_folder_id","camera_layer","created_at","updated_at","deleted_at"],i={};Object.keys(t).filter((function(e){return-1!==r.indexOf(e)})).forEach((function(e){(0,p.isUndefined)(t[e])||(i[e]=t[e])})),i.properties={id:t.properties_id},Object.keys(t).filter((function(e){return-1===r.indexOf(e)})).forEach((function(e){i.properties[e]=t[e]})),((0,p.isNull)(i.resource_folder_id)||!(0,p.isUndefined)(i.resource_folder_id)&&i.resource_folder_id<0)&&delete i.resource_folder_id,ei.getInstance().patch("material/".concat(t.id),i).then((function(){e(!0)}),(function(e){return n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"deleteModel",value:(i=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deleteModelById(t.id));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"deleteModelById",value:(n=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){ei.getInstance().delete("material/".concat(t)).then((function(){e(!0)}),(function(e){n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"setOverwritesOnResource",value:function(e,t){var n=e.getModelId(),r=this.mColorOverwrites[t.getPoolKey()]?this.mColorOverwrites[t.getPoolKey()][n]:void 0;r&&e.setColorOverwrite(r);var i=this.mMapOverwrites[t.getPoolKey()]?this.mMapOverwrites[t.getPoolKey()][n]:void 0;if(Array.isArray(i))for(var a=0;a<i.length;a++){var o=i[a].type,s=i[a].textureId;e.setMapOverwrite(o,s)}}},{key:"makeOptions",value:function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ys(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({forceType:void 0,forceShared:!0,forceModel:void 0},e)}},{key:"createResource",value:function(e,t,n){var r=this.makeOptions(n),i=new Ws("string"==typeof e?+e:e,this.mTextureManager,r.forceModel,r.forceType);return i._setHandle(t),this.setOverwritesOnResource(i,t),i}},{key:"findResourceWithHandleKey",value:function(e,t){return this.resolveResourcePool(Number(e),void 0!==t?t:f._poolKey),Ni((0,M.Z)(f.prototype),"findResourceWithHandleKey",this).call(this,e,t)}},{key:"resolveResourcePool",value:function(e,t){if(t!==f._poolKey){var n=String(e);!this.mResourcePool.has(n,t)&&this.mResourcePool.has(n,f._poolKey)?(this.mResourcePool.clone(n,t,f._poolKey),f._poolKey in this.mColorOverwrites&&!(t in this.mColorOverwrites)&&(this.mColorOverwrites[t]=JSON.parse(JSON.stringify(this.mColorOverwrites[f._poolKey]))),f._poolKey in this.mMapOverwrites&&!(t in this.mMapOverwrites)&&(this.mMapOverwrites[t]=JSON.parse(JSON.stringify(this.mMapOverwrites[f._poolKey]))),P.messenger().send(new G(e,t),String(t),0)):this.mResourcePool.has(n,f._poolKey)||(t in this.mColorOverwrites||(this.mColorOverwrites[t]={}),t in this.mMapOverwrites||(this.mMapOverwrites[t]={}),this.mResourcePool.has(n,t)||P.messenger().send(new G(e,t),String(t),0))}}}]),f}(oo),$s=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mModels",{}),(0,l.Z)(this,"mMediaLoaders",{}),(0,l.Z)(this,"mDependencyLoaders",{})}var n,i;return(0,c.Z)(e,[{key:"getModels",value:function(){var e=this;return Object.keys(this.mModels).map((function(t){return e.mModels[t]}))}},{key:"resetCache",value:function(){return this.disposeCacheLoader(),this.mModels={},this}},{key:"disposeCacheLoader",value:function(){var e=this;Object.keys(this.mMediaLoaders).forEach((function(t){e.mMediaLoaders[t]&&e.mMediaLoaders[t].error("disposed")})),this.mMediaLoaders={},Object.keys(this.mDependencyLoaders).forEach((function(t){e.mDependencyLoaders[t]&&e.mDependencyLoaders[t].error("disposed")})),this.mDependencyLoaders={}}},{key:"resolveModel",value:(i=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if(!f.Ft.isNumeric(t))return r("requested id is not an integer: ".concat(t));var i=parseInt(t,10);if(i in n.mModels)return e(n.mModels[i]);var a=Object.keys(n.mDependencyLoaders).map((function(e){return n.mDependencyLoaders[e].pipe(Vo((function(e){return Io([])})))}));n.finishDependencies(a).pipe(sn(1)).subscribe((function(){n._getModelFromAPI(i).then((function(t){e(t)}),(function(e){r(e)}))}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"finishDependencies",value:function(e){return e.length>0?jo(e):Io(!0)}},{key:"_getModelFromAPI",value:(n=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if(t in n.mModels)return e(n.mModels[t]);t in n.mMediaLoaders||(n.mMediaLoaders[t]=new ni(1),ei.getInstance().get(Jr.E.makeApiRoute("media/".concat(t))).then((function(e){var r=e.data;n.mMediaLoaders[t].next(v.getItem(r))}),(function(e){n.mMediaLoaders[t].error(e)}))),n.mMediaLoaders[t].pipe(sn(1)).subscribe((function(r){n.mModels[t]=r,delete n.mMediaLoaders[t],e(r)}),(function(e){delete n.mMediaLoaders[t],r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"preloadCatalogue",value:function(e){var t=this,n=f.Ft.isNumeric(e)?parseInt(e,10):null;return null===n?ci("Catalogue id is not an ID"):(this.mDependencyLoaders[n]||(this.mDependencyLoaders[n]=new ni(1),Ko.getInstance().resolveBootstrapData(n).pipe(sn(1)).subscribe((function(e){var r=e.getMedia();v.getItems(r).forEach((function(e){t.mModels[e.id]=e})),t.mDependencyLoaders[n].next(!0)}),(function(e){t.mDependencyLoaders[n].error(e),t.mDependencyLoaders[n]=null}))),this.mDependencyLoaders[n])}}],[{key:"getInstance",value:function(){return this.sInstance||(this.sInstance=new e),this.sInstance}}]),e}();(0,l.Z)($s,"sInstance",void 0);__webpack_require__(2550);function Qs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Js=function(e){(0,g.Z)(n,e);var t=Qs(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mTextureKey",void 0),r.mTextureKey=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getTextureKey",value:function(){return this.mTextureKey}}],[{key:"isSupported",value:function(e){return!1}}]),n}(x.e);(0,l.Z)(Js,"TypeRTTI",new k.r("TextureController"));var eu;__webpack_require__(4603),__webpack_require__(8450),__webpack_require__(8386),__webpack_require__(3290);function tu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function nu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tu(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ru(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return iu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return iu(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function iu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}!function(e){e.LeftRight="left_right",e.TopBottom="top_bottom"}(eu||(eu={}));var au,ou=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mDocCanvas",void 0),(0,l.Z)(this,"mSvgCanvas",void 0),(0,l.Z)(this,"mSvgGroup",void 0),(0,l.Z)(this,"mObjectCache",[]),(0,l.Z)(this,"mSvgCanvasGroups",[])}var n,i,a,o,s,h,p,m,d,v,y,g,b,M,k,_,x,T,w;return(0,c.Z)(e,[{key:"create",value:function(){var e=t(r().mark((function e(t,n,i){var a,o,s,u,c,l=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadLibrary();case 2:if(this.resetObjectCache(),this.createDocumentCanvas(n,n,i.getCanvas()),this.mSvgCanvas=new fabric.StaticCanvas(this.mDocCanvas,{enableRetinaScaling:!1,width:n,height:n}),!f.Ft.isValidURL(t)&&!f.Ft.isBase64(t)){e.next=11;break}return e.next=8,this.loadSVGFromUrl(t);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,this.loadSVGFromString(t);case 13:e.t0=e.sent;case 14:return a=e.t0,o=a.objects,s=a.options,u=this.getPlaceholders(t),o.forEach((function(e){var t=u.find((function(t){return t===e.id}));e.set("visible",e.get("visible")&&!t)})),c=fabric.util.groupSVGElements(o,s),this.mSvgGroup="group"===c.type?c:new fabric.Group([c],s),this.mSvgGroup.width>this.mSvgGroup.height?this.mSvgGroup.scaleToWidth(n):this.mSvgGroup.scaleToHeight(n),this.mSvgCanvas.add(this.mSvgGroup),this.mSvgCanvas.renderAll(),this.mObjectCache=o.map((function(e){return{group:l.mSvgGroup,element:e,visible:!0}})),e.abrupt("return",{width:this.mSvgGroup.getScaledWidth(),height:this.mSvgGroup.getScaledHeight(),canvas:this.mDocCanvas});case 26:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){this.mSvgCanvas&&(this.mSvgCanvas.clear(),this.mSvgCanvas.dispose(),delete this.mSvgCanvas),this.mSvgGroup&&delete this.mSvgGroup,this.mDocCanvas&&void 0!==this.mDocCanvas.parentNode&&null!==this.mDocCanvas.parentNode&&this.mDocCanvas.parentNode.removeChild&&this.mDocCanvas.parentNode.removeChild(this.mDocCanvas),delete this.mDocCanvas,this.mSvgCanvasGroups.splice(0),this.resetObjectCache()}},{key:"resolveObject",value:(w=t(r().mark((function e(t,n){var i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=this.mObjectCache.find((function(e){return e.element.id==t})))){e.next=5;break}return e.next=4,this.createClipping(i,n);case 4:i=e.sent;case 5:return e.abrupt("return",i);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return w.apply(this,arguments)})},{key:"resolveObjectsLike",value:(T=t(r().mark((function e(t,n){var i,a,o,s,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=new RegExp("^"+t.replace(/\*/g,".*")+"$","i"),a=[],o=ru(this.mObjectCache),e.prev=3,o.s();case 5:if((s=o.n()).done){e.next=15;break}if(u=s.value,!i.test(u.element.id)){e.next=13;break}return e.t0=a,e.next=11,this.createClipping(u,n);case 11:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 13:e.next=5;break;case 15:e.next=20;break;case 17:e.prev=17,e.t2=e.catch(3),o.e(e.t2);case 20:return e.prev=20,o.f(),e.finish(20);case 23:return e.abrupt("return",a);case 24:case"end":return e.stop()}}),e,this,[[3,17,20,23]])}))),function(e,t){return T.apply(this,arguments)})},{key:"getBoundaries",value:(x=t(r().mark((function e(t){var n,i,a,o,s,u=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]&&u[1],e.next=3,this.resolveObject(t);case 3:if((i=e.sent)&&i.element){e.next=6;break}return e.abrupt("return",null);case 6:return a=i.element,o={left:a.left*a.scaleX,top:a.top*a.scaleY,width:a.width*a.scaleX,height:a.height*a.scaleY},n&&(s=a.getObjectScaling(),o.localScaleX=a.scaleX,o.localScaleY=a.scaleY,o.scaleX=s.scaleX,o.scaleY=s.scaleY),e.abrupt("return",o);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"getBoundariesSync",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t){var i=this.mSvgCanvasGroups.find((function(e){return e.id===t}));if(!i)return;n=i.group.getObjects().find((function(t){return t.id==e}))}else{var a=this.mObjectCache.find((function(t){return t.element.id==e}));if(!a)return;n=a.element}if(n){r&&n.setCoords();var o=n.getObjectScaling(),s=n.getCoords(),u=n.getBoundingRect();return{left:n.left,top:n.top,width:n.width,height:n.height,coords:{tl:s[0],tr:s[1],br:s[2],bl:s[3]},angle:n.angle,scaleX:n.scaleX,scaleY:n.scaleY,worldScaleX:o.scaleX,worldScaleY:o.scaleY,bbox:{min:{x:u.left,y:u.top},max:{x:u.left+u.width,y:u.top+u.height}}}}}},{key:"getCanvasBoundaries",value:function(){if(!this.mSvgCanvas)return null;var e=this.mSvgCanvas.getCenter(),t=this.mSvgCanvas.getWidth(),n=this.mSvgCanvas.getHeight();return{left:e.left-.5*t,top:e.top-.5*n,width:t,height:n}}},{key:"updateImageProperties",value:(_=t(r().mark((function e(t,n,i,a,o,s,u,c){var l,h,f,p,m,d;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=u||0,h=null!=c?c:1,f=this.initImageObject(t),e.next=5,this.setImageSource(f,n,i);case 5:(f=e.sent).element.set({visible:t.visible,originX:"center",originY:"center",scaleX:f.sx*h*f.fit,scaleY:f.sy*h*f.fit}).rotate(f.angle+l),p=this.applyContainerOffset(f,s,a,o),m=p.offsetX,d=p.offsetY,f.element.set({top:f.top+d,left:f.left+m});case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i,a,o,s){return _.apply(this,arguments)})},{key:"updatePattern",value:(k=t(r().mark((function e(t,n,i){var a,o,s,u,c,l,h=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.src!==n){e.next=2;break}return e.abrupt("return");case 2:return a=i||1,(o=this.initImageObject(t)).src=n,o.pattern=f.Ft.isSvg(n),e.next=8,this.resolvePatternElement(n);case 8:s=e.sent,u=o.element,o.element=s,o.fit=this.calImageFit(o,"cover"),o.pattern&&(this.mObjectCache=this.mObjectCache.filter((function(e){var t;return(null===(t=e.group)||void 0===t?void 0:t.id)!==u.id}))),c=u.getPointByOrigin("center","center"),(l=u.group?u.group:this.mSvgGroup).remove(u),l.add(s),s.set({id:u.id,scaleX:o.sx*a*o.fit,scaleY:o.sy*a*o.fit,dirty:!0}).rotate(o.angle).setPositionByOrigin(c,"center","center"),o.pattern&&s.getObjects().forEach((function(e){h.mObjectCache.push({element:e,group:s,parent:o,visible:!0})}));case 19:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return k.apply(this,arguments)})},{key:"updateTextProperty",value:(M=t(r().mark((function e(t,n,i,a,o,s,u,c,l,h,p,m){var d,v,y,g,b;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d=this.initTextObject(t,i),f.Ft.isNumeric(a)&&d.element.set("fontSize",a),o&&d.element.set("fontFamily",o),h&&d.element.set("fill",h),d.element.set({text:n.toString(),textAlign:m,visible:d.visible,scaleX:d.sx*s,scaleY:d.sy*s,styles:p}),v=null!=u?u:0,d.element.rotate(d.angle+v),y=this.applyContainerOffset(d,l,c[0],c[1]),g=y.offsetX,b=y.offsetY,d.element.set({top:d.top+b,left:d.left+g});case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i,a,o,s,u,c,l,h){return M.apply(this,arguments)})},{key:"updateGradientProperty",value:(b=t(r().mark((function e(t,n,i,a){var o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=new fabric.Gradient({type:"linear",gradientUnits:"percentage",coords:a===eu.LeftRight?{x1:0,y1:0,x2:1,y2:0}:{x1:0,y1:0,x2:0,y2:1},colorStops:[{offset:0,color:n},{offset:1,color:i}]}),t.element.set("fill",o);case 2:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return b.apply(this,arguments)})},{key:"updateElementProperty",value:function(e,t,n){e.element.set(t,n)}},{key:"updateElementVisibility",value:function(e,t){e.element.set("visible",t);var n=this.mSvgCanvasGroups.find((function(t){return t.originalId===e.element.id}));n&&n.group.set("visible",t)}},{key:"render",value:function(){this.mSvgCanvas&&(this.sortSettingsLayers(),this.mSvgCanvas.renderAll())}},{key:"upSertObjectToGroupOnCanvas",value:(g=t(r().mark((function t(n,i){var a,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,o=i._objects.find((function(e){return e.id===n.id}))){t.next=14;break}t.t0=n.type,t.next="image"===t.t0?6:"i-text"===t.t0?10:12;break;case 6:return t.next=8,this.loadImageFromUrl(null!==(a=n.imageSrc)&&void 0!==a?a:"");case 8:return o=t.sent,t.abrupt("break",13);case 10:return o=e.createNewFabricText(n),t.abrupt("break",13);case 12:return t.abrupt("break",13);case 13:i.add(o);case 14:if(!o){t.next=26;break}t.t1=n.type,t.next="image"===t.t1?18:"i-text"===t.t1?23:25;break;case 18:if(o.setOptions(nu(nu({scaleX:n.scaleX,scaleY:n.scaleY,top:n.top+i.clipPath.top,left:n.left+i.clipPath.left,angle:n.angle,id:n.id,fileName:n.fileName},n.originX&&{originX:n.originX}),n.originY&&{originY:n.originY})),o.getSrc()===n.imageSrc){t.next=22;break}return t.next=22,this.replaceImageSource(o,n.imageSrc);case 22:return t.abrupt("break",26);case 23:return o.setOptions(nu(nu({scaleX:n.scaleX,scaleY:n.scaleY,top:n.top+i.clipPath.top,left:n.left+i.clipPath.left,angle:n.angle,id:n.id,text:n.text?n.text.toString():"",fontFamily:e.fontWithFallback(n.fontFamily),fill:n.fill||"#000000"},n.originX&&{originX:n.originX}),n.originY&&{originY:n.originY})),t.abrupt("break",26);case 25:return t.abrupt("break",26);case 26:t.next=31;break;case 28:t.prev=28,t.t2=t.catch(0),qe.qL.error(t.t2);case 31:case"end":return t.stop()}}),t,this,[[0,28]])}))),function(e,t){return g.apply(this,arguments)})},{key:"getPlaceholders",value:function(e){var t=document.createElement("div");t.innerHTML=e;var n=t.querySelectorAll("[data-printmark],[data-hide],[data-placeholder]"),r=[];return n.forEach((function(e){(e.hasAttribute("data-hide")||"true"===e.getAttribute("data-printmark")||"true"===e.getAttribute("data-placeholder"))&&r.push(e.id)})),r}},{key:"getGroupWrapped",value:(y=t(r().mark((function e(t,n){var i,a,o,s,u=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.mSvgCanvasGroups.find((function(e){return e.id===t})),!i){e.next=3;break}return e.abrupt("return",i);case 3:if(a=this.mObjectCache.find((function(e){return e.element.id===n}))){e.next=6;break}return e.abrupt("return",null);case 6:return e.next=8,new Promise((function(e){return a.element.clone((function(t){u.mSvgCanvas._objects.length>0&&u.mSvgCanvas._objects[0].remove(a.element);var n=u.createNewSvgGroup();n.clipPath=t,e(n)}))}));case 8:return(o=e.sent).remove(o.getObjects()),s={group:o,id:t,originalId:n},this.mSvgCanvasGroups.push(s),this.mSvgCanvas.add(s.group),e.abrupt("return",s);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"removeFromGroup",value:function(e,t){var n=this.mSvgCanvasGroups.find((function(e){return e.id===t}));n&&n.group.remove(e)}},{key:"rotate2dVector",value:function(e,t){if(2!==e.length)return e;var n=.0174533*t,r=Math.cos(n),i=Math.sin(n);return[r*e[0]-i*e[1],i*e[0]+r*e[1]]}},{key:"rotateSize",value:function(e,t,n){var r=this.rotate2dVector([e,t],n);return{width:Math.abs(r[0]),height:Math.abs(r[1])}}},{key:"applyContainerOffset",value:function(e,t,n,r){var i=n,a=r;if("percentage"!==t||!e.element||!e.hasClipping)return{offsetX:i,offsetY:a};var o=this.rotateSize(e.element.getScaledWidth(),e.element.getScaledHeight(),e.angle||0),s=this.rotateSize(e.group.clipPath.getScaledWidth(),e.group.clipPath.getScaledHeight(),e.group.clipPath.angle);return{offsetX:i=(s.width+.5*(o.width-s.width))*(i/100),offsetY:a=(s.height+.5*(o.height-s.height))*(a/100)}}},{key:"loadImageSource",value:(v=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){t.element.setSrc(f.Ft.makeUrlUnique(n),(function(i,a){if(a)return r("Unable to load image source: ".concat(n));t.element.set({dirty:!0}),e()}),{crossOrigin:"anonymous"})})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return v.apply(this,arguments)})},{key:"replaceImageSource",value:(d=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=t.width,a=t.height;t.setSrc(n,(function(o,s){if(s)return r("Unable to load image source: ".concat(n));if(t.set({dirty:!0}),f.Ft.isSvg(t.getSrc())){var u=i/o.width,c=a/o.height;o.scaleX=u,o.scaleY=c}e()}),{crossOrigin:"anonymous"})})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return d.apply(this,arguments)})},{key:"setImageSource",value:(m=t(r().mark((function e(t,n,i){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||t.src!==n){e.next=2;break}return e.abrupt("return",t);case 2:return t.src=n,e.next=5,this.loadImageSource(t,n);case 5:if(n&&0!==n.length){e.next=8;break}return t.fit=1,e.abrupt("return",t);case 8:return t.fit=this.calImageFit(t,i),e.abrupt("return",t);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return m.apply(this,arguments)})},{key:"calImageFit",value:function(e,t){var n=e.element.width<.001?.001:e.element.width,r=e.element.height<.001?.001:e.element.height,i=e.width/n,a=e.height/r;switch(t){case"contain":return a>i?i:a;case"cover":return a>i?a:i;default:return 1}}},{key:"initImageObject",value:function(e){if(e.init)return e;var t=e.element,n=this.rotate2dVector([.5*t.getScaledWidth(),.5*t.getScaledHeight()],t.angle);return e=Object.assign(e,{init:!0,width:t.getScaledWidth(),height:t.getScaledHeight(),sx:1,sy:1,angle:t.angle,top:t.top+n[1],left:t.left+n[0],fit:1,src:null})}},{key:"loadImageFromUrl",value:(p=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){return fabric.Image.fromURL(f.Ft.makeUrlUnique(t),(function(r,i){if(i)return n("Unable to load image: ".concat(t));e(r)}),{crossOrigin:"anonymous"})})));case 1:case"end":return e.stop()}}),e)}))),function(e){return p.apply(this,arguments)})},{key:"initTextObject",value:function(e,t){if(e.init)return e;var n=e.element,r=this.rotate2dVector([(.5*n.width+.5*n.strokeWidth)*n.scaleX,(.5*n.height+.5*n.strokeWidth)*n.scaleY],n.angle);if(e=Object.assign(e,{init:!0,top:n.top+r[1],left:n.left+r[0],angle:n.angle,sx:n.scaleX,sy:n.scaleY}),n.set({originX:"center",originY:"center",fill:n.fill,top:e.top,left:e.left}).setCoords(),!t)return e;var i=new fabric.Textbox("",{id:n.id,fontSize:16,fill:n.fill,originX:"center",originY:"center"});return this.copyWorldDefinition(n,i),e.group.remove(n),e.group.add(i),e.element=i,e}},{key:"createNewSvgGroup",value:function(){var e=new fabric.Group;return this.copyWorldDefinition(this.mSvgGroup,e),e}},{key:"getRootGroup",value:function(){return this.mSvgGroup}},{key:"getObjects",value:function(){return this.mObjectCache}},{key:"getCanvas",value:function(){return this.mDocCanvas}},{key:"getSvgCanvas",value:function(){return this.mSvgCanvas}},{key:"createClipping",value:(h=t(r().mark((function e(t,n){var i=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&!t.hasClipping){e.next=2;break}return e.abrupt("return",t);case 2:return e.abrupt("return",new Promise((function(e){var r=t.element,a=i.mObjectCache.findIndex((function(e){return e.element.id==n})),o=i.mObjectCache[a].element;o.set("visible",!1),o.clone((function(n){n.set("visible",!0),i.mSvgGroup.remove(r);var a=i.createNewSvgGroup();a.clipPath=n,a.add(r),i.mSvgCanvas.add(a),t.hasClipping=!0,t.group=a,e(t)}))})));case 3:case"end":return e.stop()}}),e)}))),function(e,t){return h.apply(this,arguments)})},{key:"copyWorldDefinition",value:function(e,t){["aCoords","oCoords","width","height","scaleX","scaleY","zoomX","zoomY","minX","minY","viewBoxHeight","viewBoxWidth","lineCoords"].forEach((function(n){void 0!==t[n]&&void 0!==e[n]&&(t[n]=e[n])}))}},{key:"resetObjectCache",value:function(){this.mObjectCache=[]}},{key:"loadLibrary",value:(s=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof fabric){e.next=2;break}return e.abrupt("return",Ta.loadScript("https://cdn.jsdelivr.net/npm/fabric@4.6.0/dist/fabric.min.js"));case 2:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)})},{key:"createDocumentCanvas",value:function(e,t,n){this.mDocCanvas=n||document.createElement("canvas"),this.mDocCanvas.width=e,this.mDocCanvas.height=t,this.mDocCanvas.style.background="transparent",this.mDocCanvas.style.display="none",n||document.body.appendChild(this.mDocCanvas)}},{key:"loadSVGFromString",value:(o=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){fabric.loadSVGFromString(t,(function(t,n){return e({objects:t,options:n})}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"loadSVGFromUrl",value:(a=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){fabric.loadSVGFromURL(t,(function(t,n){return e({objects:t,options:n})}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"checkPointInsideObject",value:function(e,t,n,r){var i;if(r){var a=this.mSvgCanvasGroups.find((function(e){return e.id===r}));if(!a)return!1;i=a.group.getObjects().find((function(e){return e.id==n}))}else{var o=this.mObjectCache.find((function(e){return e.element.id==n}));if(!o)return!1;i=o.element}return!!i&&i.containsPoint(new fabric.Point(e,t),void 0,!1,!0)}},{key:"sortSettingsLayers",value:function(){var e=this,t=this.mObjectCache.filter((function(e){return e.element.isWatermark}));t.length&&t.forEach((function(t){e.mSvgCanvas.bringToFront(t.element)}))}},{key:"resolvePatternElement",value:(i=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f.Ft.isSvg(t)){e.next=2;break}return e.abrupt("return",this.loadObjectsFromSvgSource(t));case 2:return e.abrupt("return",this.loadImageFromUrl(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"loadObjectsFromSvgSource",value:(n=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){fabric.loadSVGFromURL(f.Ft.makeUrlUnique(t),(function(t,r){if(null!==t){r.width&&r.height?r.centerPoint={x:r.width/2,y:r.height/2}:(delete r.width,delete r.height);var i=new fabric.Group(t,r);e(i)}else n(!1)}),null,{crossOrigin:"anonymous"})})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}],[{key:"createNewFabricText",value:function(t){return new fabric.Text(t.text?t.text.toString():"",{fontSize:t.fontSize||16,fontFamily:e.fontWithFallback(t.fontFamily)})}},{key:"fontWithFallback",value:function(t){return t&&"".concat(t,", ").concat(e.fallbackFont)}}]),e}();function su(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return uu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return uu(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function uu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function cu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(ou,"fallbackFont",'"Times New Roman", sans-serif, Arial'),function(e){e[e.Tablet=2048]="Tablet",e[e.Desktop=2048]="Desktop",e[e.Mobile=1024]="Mobile"}(au||(au={}));var lu=function(e){(0,g.Z)(T,e);var n,i,a,h,m,d,v,y,b,M,k,x=cu(T);function T(e){var t;return(0,u.Z)(this,T),t=x.call(this,e),(0,l.Z)((0,_.Z)(t),"mTexture",void 0),(0,l.Z)((0,_.Z)(t),"mTextureReady",new ni(1)),(0,l.Z)((0,_.Z)(t),"mediaService",void 0),(0,l.Z)((0,_.Z)(t),"svgEngine",void 0),(0,l.Z)((0,_.Z)(t),"throttleTextureHandle",void 0),(0,l.Z)((0,_.Z)(t),"printReadyFileStore",{}),(0,l.Z)((0,_.Z)(t),"onElementUpdated",new Ht),t.mediaService=$s.getInstance(),t}return(0,c.Z)(T,[{key:"getType",value:function(){return T.TypeRTTI}},{key:"getTexture",value:function(){return this.mTexture}},{key:"onTextureReady",value:function(){return this.mTextureReady}},{key:"loadTexture",value:function(e,n,i){var a=this;this.svgEngine=new ou;var o=document.createElement("canvas");return o.width=T.RENDER_RESOLUTION,o.height=T.RENDER_RESOLUTION,o.style.display="none",document.body.appendChild(o),this.mTexture=P.renderer().getRenderEngine().createTextureCanvas(e,o,!0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,xs.RGBA,void 0,4),this.loadSVGFile(e).then(function(){var e=t(r().mark((function e(t){var n,o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.svgEngine){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,a.svgEngine.create(t,T.RENDER_RESOLUTION,a.mTexture);case 4:if(n=e.sent,o=n.width,s=n.height,a.svgEngine){e.next=9;break}return e.abrupt("return");case 9:a.svgEngine.render(),a.mTexture.setRepeat(new D(o/T.RENDER_RESOLUTION,s/T.RENDER_RESOLUTION)),a.mTexture.setOffset(new D(0,1-s/T.RENDER_RESOLUTION)),a.mTexture.markDirty(),i(Promise.resolve(a.mTexture)),a.mTextureReady.next(a.mTexture);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){qe.qL.error(e),i(Promise.reject(e)),a.mTextureReady.error("Failed to load the texture"),a.mTextureReady.next(null)})),this.mTexture}},{key:"getBoundaries",value:(k=t(r().mark((function e(t){var n,i=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]&&i[1],e.abrupt("return",this.svgEngine.getBoundaries(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"getBoundariesSync",value:function(e,t,n){return this.svgEngine.getBoundariesSync(e,t,n)}},{key:"getCanvasBoundaries",value:function(){return this.svgEngine.getCanvasBoundaries()}},{key:"checkPointInsideObject",value:function(e,t,n,r){return this.svgEngine.checkPointInsideObject(e,t,n,r)}},{key:"getSourceFromMedia",value:function(e){return null==e?null:"string"!=typeof e?e.source_url:e}},{key:"getCoverageType",value:function(e,t){return(0,p.isNullOrUndefined)(e)||(0,p.isNullOrUndefined)(e.size)?(0,p.isNullOrUndefined)(t)||(0,p.isNullOrUndefined)(t.size_type)?"cover":t.size_type:e.size}},{key:"updateImage",value:(M=t(r().mark((function e(t,n,i,a,s){var u,c,l,h,f,m;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.svgEngine.resolveObject(t,i.clipping_element);case 2:if(u=e.sent,c=this.getSourceFromMedia(n),l=this.getCoverageType(i,a),s&&(c=s.canvas.toDataURL()),(0,p.isNullOrUndefined)(i)||(0,p.isNullOrUndefined)(u)){e.next=10;break}return h=o(i.offset,2),f=h[0],m=h[1],e.next=10,this.svgEngine.updateImageProperties(u,c,l,f,m,a.offset_unit,i.rotation,i.scale);case 10:return e.abrupt("return",this.renderTexture());case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i){return M.apply(this,arguments)})},{key:"updateCanvas",value:(b=t(r().mark((function e(t,n,i,a){var o,u,c,l,h,f,p,m,d=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.svgEngine.getGroupWrapped(n,t);case 2:if(o=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:u=s(o.group._objects),c=su(i.canvas.objects),e.prev=7,h=r().mark((function e(){var t,n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.value,(n=u.findIndex((function(e){return e.id===t.id})))>=0&&u.splice(n,1),"image"===t.type&&t.id in a&&(t.imageSrc=a[t.id].canvas.toDataURL()),e.next=6,d.svgEngine.upSertObjectToGroupOnCanvas(t,o.group);case 6:case"end":return e.stop()}}),e)})),c.s();case 10:if((l=c.n()).done){e.next=14;break}return e.delegateYield(h(),"t0",12);case 12:e.next=10;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(7),c.e(e.t1);case 19:return e.prev=19,c.f(),e.finish(19);case 22:f=su(u);try{for(f.s();!(p=f.n()).done;)m=p.value,this.svgEngine.removeFromGroup(m,n)}catch(e){f.e(e)}finally{f.f()}return e.abrupt("return",this.renderTexture());case 25:case"end":return e.stop()}}),e,this,[[7,16,19,22]])}))),function(e,t,n,r){return b.apply(this,arguments)})},{key:"updateVisibility",value:(y=t(r().mark((function e(t){var n,i,a,s,u,c,l,h,f;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0,i=Object.entries(t);case 1:if(!(n<i.length)){e.next=11;break}return a=o(i[n],2),s=a[0],u=a[1],e.next=5,this.svgEngine.resolveObjectsLike(s);case 5:c=e.sent,l=su(c);try{for(l.s();!(h=l.n()).done;)(f=h.value).visible=u,this.svgEngine.updateElementVisibility(f,u)}catch(e){l.e(e)}finally{l.f()}case 8:n++,e.next=1;break;case 11:return e.abrupt("return",this.renderTexture());case 12:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"updatePattern",value:(v=t(r().mark((function e(t,n,i){var a,o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.svgEngine.resolveObject(t);case 2:return a=e.sent,o=this.getSourceFromMedia(n),s=a.src,e.next=7,this.svgEngine.updatePattern(a,o,i.scale);case 7:return s!==o&&f.Ft.isSvg(o)&&this.onElementUpdated.next(),e.abrupt("return",this.renderTexture());case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return v.apply(this,arguments)})},{key:"updateText",value:(d=t(r().mark((function e(t,n,i){var a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.svgEngine.resolveObject(t,n.clipping_element);case 2:return a=e.sent,o=n.text,e.next=6,this.svgEngine.updateTextProperty(a,o,n.multiline,n.size,n.font,n.scale,n.rotation,n.offset,i.offset_unit,n.color,n.styles,n.align);case 6:return e.abrupt("return",this.renderTexture());case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"updateElement",value:(m=t(r().mark((function e(t,n){var i,a,o,s,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.svgEngine.resolveObjectsLike(t);case 2:if(i=e.sent,!(0,p.isNullOrUndefined)(n.value)){e.next=5;break}return e.abrupt("return",this.renderTexture());case 5:a="style."===n.attribute.substr(0,6)?n.attribute.substring(6):n.attribute,o=su(i);try{for(o.s();!(s=o.n()).done;)u=s.value,this.svgEngine.updateElementProperty(u,a,n.value)}catch(e){o.e(e)}finally{o.f()}return e.abrupt("return",this.renderTexture());case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"updateGradient",value:(h=t(r().mark((function e(t,n){var i,a,o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.svgEngine.resolveObjectsLike(t,n.clipping_element);case 2:i=e.sent,a=su(i),e.prev=4,a.s();case 6:if((o=a.n()).done){e.next=12;break}return s=o.value,e.next=10,this.svgEngine.updateGradientProperty(s,n.primary_color,n.secondary_color,n.direction);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),a.e(e.t0);case 17:return e.prev=17,a.f(),e.finish(17);case 20:return e.abrupt("return",this.renderTexture());case 21:case"end":return e.stop()}}),e,this,[[4,14,17,20]])}))),function(e,t){return h.apply(this,arguments)})},{key:"getCurrentRawTextFromObject",value:(a=t(r().mark((function e(t,n){var i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.svgEngine.resolveObject(t,n.clipping_element);case 2:return i=e.sent,(a=this.svgEngine.initTextObject(i,n.multiline)).element.set({text:n.text.toString()}),e.abrupt("return",a.element._textLines.map((function(e){return e.join("")})).join("\n")||n.text);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"renderTexture",value:function(){var e=this;return this.throttleTextureHandle||(this.throttleTextureHandle=window.setTimeout((function(){delete e.throttleTextureHandle,e.svgEngine&&e.svgEngine.render(),e.mTexture&&e.mTexture.markDirty()}),16)),this.mTexture}},{key:"loadSVGFile",value:(i=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){window.fetch(t,{method:"GET",mode:"cors",cache:"no-cache",credentials:"omit",redirect:"follow"}).then((function(t){if(!n.mTexture||!n.svgEngine)return r("Texture is unloaded");t&&t.ok?e(t.text()):r("Could not download SVG file")}),(function(e){r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"unload",value:function(){this.mTexture&&(this.mTexture.dispose(),delete this.mTexture),this.mTextureReady&&(this.mTextureReady.complete(),this.mTextureReady.unsubscribe()),this.mTextureReady=new ni(1),this.onElementUpdated&&(this.onElementUpdated.complete(),this.onElementUpdated.unsubscribe()),this.onElementUpdated=new Ht,this.svgEngine&&(this.svgEngine.destroy(),delete this.svgEngine),this.printReadyFileStore&&(this.printReadyFileStore={})}},{key:"addWatermark",value:(n=t(r().mark((function e(t,n){var i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.svgEngine.resolveObject(n);case 2:return(i=e.sent).element.set("isWatermark",!0),e.next=6,this.svgEngine.updateImageProperties(i,this.printReadyFileStore[t].watermarkMedia.source_url,"contain",0,0,"pixels",0,1);case 6:this.renderTexture();case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getSvgCanvasAsBase64",value:function(){var e=this.mTexture;if(e){this.svgEngine&&this.svgEngine.render();var t=this.mTexture.getCanvas(),n=document.createElement("canvas");n.width=t.width,n.height=t.height,n.setAttribute("crossorigin","anonymous"),n.style.display="none",document.body.appendChild(n);var r=n.getContext("2d");r.resetTransform(),r.clearRect(0,0,n.width,n.height);var i=t.width/e.getRepeat().x,a=t.height/e.getRepeat().y;r.drawImage(t,0,0,t.width,t.height,0,0,i,a);var o=n.toDataURL("image/png");return n.width=0,n.height=0,n.remove(),o}}}],[{key:"isSupported",value:function(e){return f.Ft.isValidURL(e)&&/\.(svg)$/gm.test(e)}},{key:"getRenderResolution",value:function(){return function(){if(bi())return!0;var e=navigator.userAgent;return/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/i.test(e)}()?au.Tablet:Ti()?au.Mobile:au.Desktop}}]),T}(Js);function hu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(lu,"TypeRTTI",new k.r("TextureSVGController",Js.TypeRTTI)),(0,l.Z)(lu,"RENDER_RESOLUTION",lu.getRenderResolution());var fu=function(e){(0,g.Z)(n,e);var t=hu(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e),(0,l.Z)((0,_.Z)(i),"mImageLoader",void 0),(0,l.Z)((0,_.Z)(i),"mTexture",void 0),(0,l.Z)((0,_.Z)(i),"mTextureReady",new ni(1)),i.mImageLoader=r,i}return(0,c.Z)(n,[{key:"getType",value:function(){return lu.TypeRTTI}},{key:"getTexture",value:function(){return this.mTexture}},{key:"onTextureReady",value:function(){return this.mTextureReady}},{key:"loadTexture",value:function(e,t,n){var r=this,i=e.search(/\.(jpg|jpeg)$/)>0||0===e.search(/^data:image\/jpeg/)?xs.RGB:xs.RGBA;return this.mTexture=P.renderer().getRenderEngine().createTexture2D(e,void 0,void 0===t.flipY||t.flipY,void 0!==t.mapping?t.mapping:ws.UV,void 0!==t.wrapU?t.wrapU:Ss.Repeat,void 0!==t.wrapV?t.wrapV:Ss.Repeat,void 0!==t.magFilter?t.magFilter:Zs.Linear,void 0!==t.minFilter?t.minFilter:Zs.Linear,void 0!==t.mipmapFilter?t.mipmapFilter:Zs.Linear,void 0===t.generateMipmaps||Boolean(t.generateMipmaps),void 0!==t.format?t.format:i,void 0!==t.dataType?t.dataType:void 0,void 0!==t.anisotropy?Number(t.anisotropy):4,void 0!==t.encoding?t.encoding:void 0),void 0!==t.uvChannel&&this.mTexture.setUVChannel(Number(t.uvChannel)),void 0!==t.level?this.mTexture.setLevel(Number(t.level)):void 0!==t.intensity&&this.mTexture.setLevel(Number(t.intensity)),void 0!==t.useRGBasAlpha&&this.mTexture.useRGBasAlpha(Boolean(t.useRGBasAlpha)),void 0!==t.renderMode&&this.mTexture.setTextureRenderMode(t.renderMode),this.mImageLoader.load(e,(function(e){r.mTexture&&(r.mTexture.updateSource(e),r.mTexture.markDirty(),n(Promise.resolve(r.mTexture)),r.mTextureReady.next(r.mTexture))}),(function(){}),(function(e){qe.qL.error(e),n(Promise.reject(e)),r.mTextureReady.error("Failed to load the texture"),r.mTextureReady.next(null)})),this.mTexture}},{key:"unload",value:function(){this.mTexture.dispose(),this.mTexture=void 0,this.mTextureReady.unsubscribe(),this.mTextureReady=new ni(1)}}],[{key:"isSupported",value:function(e){return f.Ft.isValidURL(e)&&/\.(jpg|jpeg|png)$/gm.test(e)}}]),n}(Js);(0,l.Z)(fu,"TypeRTTI",new k.r("TextureSVGController",Js.TypeRTTI));var pu={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};var mu=new function(e,t,n){var r=this,i=!1,a=0,o=0,s=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===i&&void 0!==r.onStart&&r.onStart(e,a,o),i=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,o),a===o&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this}},du=function(){function e(t){(0,u.Z)(this,e),this.manager=void 0!==t?t:mu,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return(0,c.Z)(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}();function vu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var yu=function(e){(0,g.Z)(n,e);var t=vu(n);function n(e){return(0,u.Z)(this,n),t.call(this,e)}return(0,c.Z)(n,[{key:"load",value:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=pu.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1),pu.add(e,this),t&&t(this),i.manager.itemEnd(e)}function u(t){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return o.addEventListener("load",s,!1),o.addEventListener("error",u,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o}}]),n}(du);function gu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var bu=function(e){(0,g.Z)(a,e);var n,i=gu(a);function a(e,t,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,u.Z)(this,a),r=i.call(this),(0,l.Z)((0,_.Z)(r),"mId",void 0),(0,l.Z)((0,_.Z)(r),"mResource",void 0),(0,l.Z)((0,_.Z)(r),"mLod",void 0),(0,l.Z)((0,_.Z)(r),"mModel",void 0),(0,l.Z)((0,_.Z)(r),"mMediaLoader",void 0),(0,l.Z)((0,_.Z)(r),"mState",void 0),(0,l.Z)((0,_.Z)(r),"mReadySubscriptions",[]),(0,l.Z)((0,_.Z)(r),"mTextureProperties",void 0),(0,l.Z)((0,_.Z)(r),"mTextureKey",void 0),(0,l.Z)((0,_.Z)(r),"mFactoryControllers",[fu,lu]),(0,l.Z)((0,_.Z)(r),"mController",void 0),(0,l.Z)((0,_.Z)(r),"mImageLoader",void 0),"number"==typeof e?(r.mId=e,r.mState=$o.Unloaded):(r.mResource=e,r.mState=$o.Ready),r.mLod=Math.max(0,Math.min(2,o)),r.mTextureProperties=n,r.mTextureKey=t,r.mImageLoader=new yu,r}return(0,c.Z)(a,[{key:"getTextureKey",value:function(){return this.mTextureKey}},{key:"getTexture",value:function(){return this.mResource?this.mResource:this.mController?this.mController.getTexture():void 0}},{key:"getController",value:function(){return this.mController}},{key:"resolve",value:(n=t(r().mark((function e(t,n){var i=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if("function"==typeof t)switch(i.mState){case $o.Ready:t(i.getTexture());break;case $o.Error:t();break;case $o.Unloaded:case $o.InProgress:default:i.mReadySubscriptions.push(t)}return i.mState===$o.Ready?("function"==typeof n&&n(1),qe.qL.print("Texture resource resolved:",i.mHandle._getHandle(),i.mReferenceCount),e(i.getTexture())):i.mState===$o.Error?r("Failed to resolve media id:".concat(i.mId)):(i.mMediaLoader||(i.mState=$o.InProgress,i.mMediaLoader=new ni(1),$s.getInstance().resolveModel(i.mId).then((function(e){if(i.mState!==$o.Unloaded){i.mModel=e;var t=i.createTexture();t?i.mMediaLoader.next(t):(i.mState=$o.Error,i.dispatchFinalize(t),i.mMediaLoader.error("No controllers can handle this type of image"))}else r("Media disposed before finished loading!")})).catch((function(e){i.mState=$o.Error,i.dispatchFinalize(i.getTexture()),i.mMediaLoader?i.mMediaLoader.error(e):r(e)}))),void i.mMediaLoader.pipe(sn(1)).subscribe({next:function(t){"function"==typeof n&&n(1),qe.qL.print("Texture resource resolved:",i.mHandle._getHandle(),i.mReferenceCount),P.eventBus().dispatch(new Di(Ei.RequestFrame)),e(t)},error:function(e){r(e)}}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"dispatchFinalize",value:function(e){this.mReadySubscriptions.splice(0).forEach((function(t){return t(e)})),P.eventBus().dispatch(new Di(Ei.RequestFrame))}},{key:"createTexture",value:function(){for(var e,t=this,n=this.mLod;n>=0;n--){var r=encodeURI(this.mModel["lod".concat(n,"_url")]);if(r&&r.length>0){e=r;break}}e||(e=this.mModel.source_url);var i=this.mFactoryControllers.find((function(t){return t.isSupported(e)}));if(i)return this.mController=new i(this.mTextureKey,this.mImageLoader),this.mController.loadTexture(e,this.mTextureProperties,(function(n){n.then((function(n){if(t.mState===$o.Unloaded)return qe.qL.error("Texture ".concat(e," has finished loading after disposal of ResourceManager.")),void t.dispose(!0);t.mState=$o.Ready,n.setName(t.mModel.name),t.dispatchFinalize(n)})).catch((function(e){qe.qL.error(e),t.mState=$o.Error,t.dispatchFinalize()}))})),this.getTexture();this.dispatchFinalize()}},{key:"onDispose",value:function(){return qe.qL.print("Texture resource disposed.",this.mHandle._getHandle()),this.mState=$o.Unloaded,this.mController&&(this.mController.unload(),delete this.mController),this.mMediaLoader&&(this.mMediaLoader.complete(),delete this.mMediaLoader),this.dispatchFinalize(),!0}},{key:"clone",value:function(){return new a(this.mId||this.mResource,this.mTextureKey,JSON.parse(JSON.stringify(this.mTextureProperties)),this.mLod)}},{key:"getId",value:function(){return this.mId}},{key:"isSvg",value:function(){return this.mController instanceof lu}},{key:"getTextureProperties",value:function(){return this.mTextureProperties}}]),a}(Vs);function Mu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ku(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var _u,xu=function(e){(0,g.Z)(h,e);var n,i,a,o,s=ku(h);function h(){return(0,u.Z)(this,h),s.apply(this,arguments)}return(0,c.Z)(h,[{key:"getResourceGroupType",value:function(){return"Texture"}},{key:"loadLibrary",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(qe.qL.print("cleanup texture cache..."),$s.getInstance().resetCache(),this.cleanup(!0)),this}},{key:"_getIdPath",value:function(e,t){var n="".concat(e,"/").concat(t.lod);return t.forceShared||(n+="/".concat(y.F.Md5(JSON.stringify(t.properties)))),n}},{key:"saveModel",value:(o=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){ei.getInstance().patch("media/".concat(t.id),t).then((function(t){e(!0)}),(function(e){return n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"deleteModel",value:(a=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.deleteModelById(t.id));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"deleteModelById",value:(i=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){ei.getInstance().delete("media/".concat(t)).then((function(t){e(!0)}),(function(e){n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"makeOptions",value:function(e){return(0,f.Ee)({lod:Ti()?1:0,properties:{flipY:!0,mapping:ws.UV,wrapU:Ss.Repeat,wrapV:Ss.Repeat,magFilter:Zs.Linear,minFilter:Zs.Linear,mipmapFilter:Zs.Linear,format:void 0,dataType:_s.UnsignedByte,renderMode:Rs.Reflect,anisotropy:4,encoding:Ts.Linear,useRGBasAlpha:!1,uvChannel:0,level:1,generateMipmaps:!0},forceShared:!1},e)}},{key:"makeHandleKey",value:function(e,t){var n=this.makeOptions(t);return this._getIdPath(e,n)}},{key:"createResource",value:function(e,t,n){var r=this.makeOptions(n),i=new bu("string"==typeof e?+e:e,t._getHandle(),function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mu(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({forceShared:r.forceShared},r.properties),r.lod);return i}},{key:"onAfterResolve",value:(n=t(r().mark((function e(t,n,i){var a,o,s,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=t).isSvg()||a.getTextureProperties().forceShared){e.next=9;break}return o=(0,f.Ee)(a.getTextureProperties(),{forceShared:!0}),s=this.makeResource(a.getId(),o),u=this.mResourcePool.findByHandle(s),e.next=7,u.resolve(i);case 7:return e.t0=e.sent,e.abrupt("return",{resource:e.t0,overridden:!0});case 9:return e.abrupt("return",{resource:n,overridden:!1});case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"disposeTexture",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=f.Ft.isNumeric(t)?t:h._poolKey,i=this.mResourcePool.find((function(t,n){if(n!==r)return!1;var i=t.getTexture();return!!i&&i.getUniqueId()===e.getUniqueId()}));i?this.disposeResource(i._getHandle(),n):e.dispose()}}]),h}(oo);__webpack_require__(9135),__webpack_require__(8675),__webpack_require__(2990),__webpack_require__(8927),__webpack_require__(3105),__webpack_require__(5035),__webpack_require__(4345),__webpack_require__(7174),__webpack_require__(3408),__webpack_require__(2958),__webpack_require__(2846),__webpack_require__(4731),__webpack_require__(7209),__webpack_require__(6319),__webpack_require__(8867),__webpack_require__(7789),__webpack_require__(3739),__webpack_require__(9368),__webpack_require__(4483),__webpack_require__(2056),__webpack_require__(3462),__webpack_require__(678),__webpack_require__(7462),__webpack_require__(3824),__webpack_require__(5021),__webpack_require__(2974),__webpack_require__(5016),__webpack_require__(8922),__webpack_require__(5835),__webpack_require__(3767),__webpack_require__(8585),__webpack_require__(8970),__webpack_require__(4444),__webpack_require__(8696),__webpack_require__(4197);function Tu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}!function(e){e[e.POSITION=0]="POSITION",e[e.NORMAL=1]="NORMAL",e[e.TANGENT=2]="TANGENT",e[e.UV=3]="UV",e[e.UV2=4]="UV2",e[e.COLOR=5]="COLOR"}(_u||(_u={}));var wu=function(e){(0,g.Z)(n,e);var t=Tu(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(es),Ru=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,u.Z)(this,e),(0,l.Z)(this,"mData",void 0),(0,l.Z)(this,"mItemSize",void 0),(0,l.Z)(this,"mNormalized",void 0),this.mData=t,this.mItemSize=n,this.mNormalized=r}return(0,c.Z)(e,[{key:"getData",value:function(){return this.mData}},{key:"getItemSize",value:function(){return this.mItemSize}},{key:"isNormalized",value:function(){return this.mNormalized}}]),e}(),Zu=function(){function e(){(0,u.Z)(this,e)}var n;return(0,c.Z)(e,[{key:"loadGeometry",value:(n=t(r().mark((function e(t,n,i,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=(0,p.isFunction)(a)?a:function(){};i.load(t,(function(t){try{var r,i=t,a=new Uint32Array(i,0,8),o=a[1],s=a[2],u=a[3],c=a[4],l=a[5],h=a[6],f=a[7],p=new Float32Array(i,c,o),m=new Float32Array(i,l,o),d=new Float32Array(i,h,o/3*2);u>1&&(r=new Float32Array(i,h+o/3*2*4,o/3*2));var v=new Uint32Array(i,f,s),y=P.renderer().getRenderEngine().createBuffer();y.setIndexData(new Ru(v,1)),y.setVertexData(_u.POSITION,new Ru(p,3)),y.setVertexData(_u.NORMAL,new Ru(m,3)),y.setVertexData(_u.UV,new Ru(d,2)),r&&y.setVertexData(_u.UV2,new Ru(r,2)),e(y)}catch(e){n(e)}}),(function(e){r(e.loaded/e.total)}),(function(e){n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"dispose",value:function(){}}],[{key:"cleanup",value:function(){}}]),e}();__webpack_require__(4129),__webpack_require__(8206),__webpack_require__(2714),__webpack_require__(2707),__webpack_require__(7145),__webpack_require__(5109),__webpack_require__(5125),__webpack_require__(2472),__webpack_require__(8255),__webpack_require__(5505);function Su(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Cu={},Iu=function(e){(0,g.Z)(n,e);var t=Su(n);function n(e){return(0,u.Z)(this,n),t.call(this,e)}return(0,c.Z)(n,[{key:"load",value:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=pu.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;if(void 0===Cu[e]){var o,s=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var u=s[1],c=!!s[2],l=s[3];l=decodeURIComponent(l),c&&(l=atob(l));try{var h,f=(this.responseType||"").toLowerCase();switch(f){case"arraybuffer":case"blob":for(var p=new Uint8Array(l.length),m=0;m<l.length;m++)p[m]=l.charCodeAt(m);h="blob"===f?new Blob([p.buffer],{type:u}):p.buffer;break;case"document":var d=new DOMParser;h=d.parseFromString(l,u);break;case"json":h=JSON.parse(l);break;default:h=l}setTimeout((function(){t&&t(h),i.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{for(var v in Cu[e]=[],Cu[e].push({onLoad:t,onProgress:n,onError:r}),(o=new XMLHttpRequest).open("GET",e,!0),o.addEventListener("load",(function(t){var n=this.response,r=Cu[e];if(delete Cu[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),pu.add(e,n);for(var a=0,o=r.length;a<o;a++){var s=r[a];s.onLoad&&s.onLoad(n)}i.manager.itemEnd(e)}else{for(var u=0,c=r.length;u<c;u++){var l=r[u];l.onError&&l.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),o.addEventListener("progress",(function(t){for(var n=Cu[e],r=0,i=n.length;r<i;r++){var a=n[r];a.onProgress&&a.onProgress(t)}}),!1),o.addEventListener("error",(function(t){var n=Cu[e];delete Cu[e];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),o.addEventListener("abort",(function(t){var n=Cu[e];delete Cu[e];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(o.responseType=this.responseType),void 0!==this.withCredentials&&(o.withCredentials=this.withCredentials),o.overrideMimeType&&o.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)o.setRequestHeader(v,this.requestHeader[v]);o.send(null)}return i.manager.itemStart(e),o}Cu[e].push({onLoad:t,onProgress:n,onError:r})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),n}(du);function Eu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Au=new WeakMap,Ou=function(e){(0,g.Z)(n,e);var t=Eu(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e)).decoderPath="",r.decoderConfig={},r.decoderBinary=null,r.decoderPending=null,r.workerLimit=4,r.workerPool=[],r.workerNextTaskID=1,r.workerSourceURL="",r.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD",uv2:"TEX_COORD"},r.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array",uv2:"Float32Array"},r}return(0,c.Z)(n,[{key:"setDecoderPath",value:function(e){return this.decoderPath=e,this}},{key:"setDecoderConfig",value:function(e){return this.decoderConfig=e,this}},{key:"setWorkerLimit",value:function(e){return this.workerLimit=e,this}},{key:"load",value:function(e,t,n,r){var i=this,a=new Iu(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(e){var n={attributeIDs:i.defaultAttributeIDs,attributeTypes:i.defaultAttributeTypes,useUniqueIDs:!1,useAttributeByMetaDataName:!0};i.decodeGeometry(e,n).then(t).catch(r)}),n,r)}},{key:"decodeDracoFile",value:function(e,t,n,r){var i={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n,useAttributeByMetaDataName:!0};this.decodeGeometry(e,i).then(t)}},{key:"decodeGeometry",value:function(e,t){var n=this;for(var r in t.attributeTypes){var i=t.attributeTypes[r];void 0!==i.BYTES_PER_ELEMENT&&(t.attributeTypes[r]=i.name)}var a,o=JSON.stringify(t);if(Au.has(e)){var s=Au.get(e);if(s.key===o)return s.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var u=this.workerNextTaskID++,c=e.byteLength,l=this._getWorker(u,c).then((function(n){return a=n,new Promise((function(n,r){a._callbacks[u]={resolve:n,reject:r},a.postMessage({type:"decode",id:u,taskConfig:t,buffer:e},[e])}))})).then((function(e){return n._createGeometry(e.geometry)}));return l.catch((function(){return!0})).then((function(){a&&u&&n._releaseTask(a,u)})),Au.set(e,{key:o,promise:l}),l}},{key:"_createGeometry",value:function(e){return e}},{key:"_loadLibrary",value:function(e,t){var n=new Iu(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((function(t,r){n.load(e,t,void 0,r)}))}},{key:"preload",value:function(){return this._initDecoder(),this}},{key:"_initDecoder",value:function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!==("undefined"==typeof WebAssembly?"undefined":(0,ui.Z)(WebAssembly))||"js"===this.decoderConfig.type,n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then((function(n){var r=n[0];t||(e.decoderConfig.wasmBinary=n[1]);var i=Du.toString(),a=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([a]))})),this.decoderPending}},{key:"_getWorker",value:function(e,t){var n=this;return this._initDecoder().then((function(){if(n.workerPool.length<n.workerLimit){var r=new Worker(n.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:n.decoderConfig}),r.onmessage=function(e){var t=e.data;switch(t.type){case"decode":r._callbacks[t.id].resolve(t);break;case"error":r._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},n.workerPool.push(r)}else n.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));var i=n.workerPool[n.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}},{key:"_releaseTask",value:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}},{key:"debug",value:function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))}},{key:"dispose",value:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}]),n}(du);function Du(){var e,t;function n(e,t,n,r,i,a){var o=a.num_components(),s=n.num_points()*o,u=s*i.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),l=e._malloc(u);t.GetAttributeDataArrayForAllPoints(n,a,c,u,l);var h=new i(e.HEAPF32.buffer,l,s).slice();return e._free(l),{name:r,array:h,itemSize:o}}onmessage=function(r){var i=r.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var a=i.buffer,o=i.taskConfig;t.then((function(e){var t=e.draco,r=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(a),a.byteLength);try{var u=function(e,t,r,i){var a,o,s=i.attributeIDs,u=i.attributeTypes,c=t.GetEncodedGeometryType(r);if(c===e.TRIANGULAR_MESH)a=new e.Mesh,o=t.DecodeBufferToMesh(r,a);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,o=t.DecodeBufferToPointCloud(r,a)}if(!o.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());var l={index:null,attributes:[]};for(var h in s){var f=self[u[h]],p=void 0,m=void 0;if(i.useUniqueIDs)m=s[h],p=t.GetAttributeByUniqueId(a,m);else if(i.useAttributeByMetaDataName){if(-1===(m=t.GetAttributeIdByMetadataEntry(a,"name",h)))continue;p=t.GetAttribute(a,m)}else{if(-1===(m=t.GetAttributeId(a,e[s[h]])))continue;p=t.GetAttribute(a,m)}l.attributes.push(n(e,t,a,h,f,p))}c===e.TRIANGULAR_MESH&&(l.index=function(e,t,n){var r=n.num_faces(),i=3*r,a=4*i,o=e._malloc(a);t.GetTrianglesUInt32Array(n,a,o);var s=new Uint32Array(e.HEAPF32.buffer,o,i).slice();return e._free(o),{array:s,itemSize:1}}(e,t,a));return e.destroy(a),l}(t,r,s,o),c=u.attributes.map((function(e){return e.array.buffer}));u.index&&c.push(u.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:u},c)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(s),t.destroy(r)}}))}}}var Pu,Bu=function(){function e(){(0,u.Z)(this,e)}var n;return(0,c.Z)(e,[{key:"loadGeometry",value:(n=t(r().mark((function t(n,i,a,o){var s=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){var i="function"==typeof o?o:function(){};e.sFirstInit&&(e.sFirstInit=!1,e.sDracoLoader=new Ou,e.sDracoLoader.setDecoderConfig({type:s.isWebAssemblySupported()?void 0:"js"}),e.sDracoLoader.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.4.3/")),e.sDracoLoader.load(n,(function(e){var n=P.renderer().getRenderEngine().createBuffer();if(e.index){var i=e.index.array;n.setIndexData(new Ru(i,1))}if(Array.isArray(e.attributes))for(var a=0;a<e.attributes.length;a++){var o=e.attributes[a].name,s=e.attributes[a].array,u=e.attributes[a].itemSize||0;if(u>0)switch(o){case"position":n.setVertexData(_u.POSITION,new Ru(s,u));break;case"normal":n.setVertexData(_u.NORMAL,new Ru(s,u));break;case"tangent":n.setVertexData(_u.TANGENT,new Ru(s,u));break;case"uv":n.setVertexData(_u.UV,new Ru(s,u));break;case"uv2":n.setVertexData(_u.UV2,new Ru(s,u));break;case"color":n.setVertexData(_u.COLOR,new Ru(s,u))}}try{t(n)}catch(e){r(e)}}),(function(e){i(e.loaded/e.total)}),(function(e){r(e)}))})));case 1:case"end":return t.stop()}}),t)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"isWebAssemblySupported",value:function(){return"object"===("undefined"==typeof WebAssembly?"undefined":(0,ui.Z)(WebAssembly))&&"function"==typeof WebAssembly.instantiate}},{key:"dispose",value:function(){}}],[{key:"cleanup",value:function(){e.sDracoLoader&&(e.sDracoLoader.dispose(),delete e.sDracoLoader,e.sFirstInit=!0)}}]),e}();(0,l.Z)(Bu,"sDracoLoader",void 0),(0,l.Z)(Bu,"sFirstInit",!0),function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.EBM=0]="EBM",e[e.DRC=1]="DRC"}(Pu||(Pu={}));var Fu=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mLoaders",void 0),this.mLoaders=new Map,this.mLoaders.set(Pu.EBM,new Zu),this.mLoaders.set(Pu.DRC,new Bu)}var n;return(0,c.Z)(e,[{key:"loadGeometry",value:(n=t(r().mark((function e(t,n,i,a){var o,s,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((o=this.getExtension(t))!==Pu.UNKNOWN){e.next=3;break}throw new Error("Geometry extension not recognized");case 3:return s=this.mLoaders.get(o),e.next=6,s.loadGeometry(t,n,i,a);case 6:return u=e.sent,e.abrupt("return",u);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"getExtension",value:function(e){var t=e.match(/.*\.(drc|ebm)$/i);if(t.length>1)switch(t[1]){case"ebm":return Pu.EBM;case"drc":return Pu.DRC;default:return Pu.UNKNOWN}return Pu.UNKNOWN}},{key:"dispose",value:function(){this.mLoaders&&(this.mLoaders.forEach((function(e){e.dispose()})),delete this.mLoaders)}}],[{key:"cleanup",value:function(){Zu.cleanup(),Bu.cleanup()}}]),e}();function Lu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Nu=function(e){(0,g.Z)(a,e);var n,i=Lu(a);function a(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,u.Z)(this,a),n=i.call(this),(0,l.Z)((0,_.Z)(n),"mSource",void 0),(0,l.Z)((0,_.Z)(n),"mModel",void 0),(0,l.Z)((0,_.Z)(n),"mResourceResolver",void 0),(0,l.Z)((0,_.Z)(n),"mState",void 0),(0,l.Z)((0,_.Z)(n),"mReadySubscriptions",[]),(0,l.Z)((0,_.Z)(n),"mProperties",void 0),(0,l.Z)((0,_.Z)(n),"mFileLoader",void 0),(0,l.Z)((0,_.Z)(n),"mGeometryLoader",void 0),n._setHandle(e),"string"==typeof t?(n.mSource=t,n.mState=$o.Unloaded):(n.mModel=t,n.mState=$o.Ready),n.mProperties=r,n.mFileLoader=new Iu,n.mFileLoader.setResponseType("arraybuffer"),n.mGeometryLoader=new Fu,n}return(0,c.Z)(a,[{key:"getGeometry",value:function(){return this.mModel}},{key:"resolve",value:(n=t(r().mark((function e(t,n){var i=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if("function"==typeof t)switch(i.mState){case $o.Unloaded:case $o.InProgress:i.mReadySubscriptions.push(t);break;case $o.Ready:t(i.getGeometry());break;case $o.Error:t()}return i.mState===$o.Ready?("function"==typeof n&&n(1),qe.qL.print("Geometry resource resolved:",i.mHandle._getHandle(),i.mReferenceCount),e(i.getGeometry())):i.mState===$o.Error?r("Failed to resolve resource: ".concat(i.mSource)):(i.mResourceResolver||(i.mState=$o.InProgress,i.mResourceResolver=new ni(1),i.mGeometryLoader.loadGeometry(i.mSource,i.mProperties,i.mFileLoader,n).then((function(e){$o.Unloaded||(i.mModel=e,i.mState=$o.Ready,i.mResourceResolver.next(i.mModel),i.dispatchFinalize(i.getGeometry()))}),(function(e){i.mState=$o.Error,i.mResourceResolver.error(e),i.dispatchFinalize()}))),void i.mResourceResolver.pipe(sn(1)).subscribe((function(t){"function"==typeof n&&n(1),qe.qL.print("Geometry resource resolved:",i.mHandle._getHandle(),i.mReferenceCount),e(t)}),(function(e){r(e)})))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"onDispose",value:function(){return qe.qL.print("Geometry resource disposed.",this.mHandle._getHandle()),this.dispatchFinalize(),this.mModel&&(this.mModel.dispose(),delete this.mModel),this.mGeometryLoader&&(this.mGeometryLoader.dispose(),delete this.mGeometryLoader),this.mState=$o.Unloaded,!0}},{key:"dispatchFinalize",value:function(e){this.mReadySubscriptions.splice(0).forEach((function(t){return t(e)}))}},{key:"clone",value:function(){return new a(this.mHandle,this.mSource||this.mModel,JSON.parse(JSON.stringify(this.mProperties)))}}]),a}(Vs);function ju(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Uu=function(e){(0,g.Z)(n,e);var t=zu(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"getResourceGroupType",value:function(){return"Geometry"}},{key:"loadLibrary",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(qe.qL.print("Cleanup geometry cache..."),this.cleanup(!0)),this}},{key:"makeOptions",value:function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ju(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ju(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({properties:{}},e)}},{key:"makeHandleKey",value:function(e,t){var n=this.makeOptions(t);return this.getIdPath(e,n.properties)}},{key:"createResource",value:function(e,t,n){var r=this.makeOptions(n);return new Nu(t,e,r.properties)}},{key:"disposeGeometry",value:function(e,t){var r=f.Ft.isNumeric(t)?t:n._poolKey,i=this.mResourcePool.find((function(t,n){return n===r&&t===e}));i&&this.disposeResource(i._getHandle())}},{key:"getIdPath",value:function(e,t){return"".concat(e,"/").concat(y.F.Md5(JSON.stringify(t)))}}]),n}(oo),Vu=(__webpack_require__(541),function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mMaterialManager",void 0),(0,l.Z)(this,"DEBUG",!1),(0,l.Z)(this,"requestFrameSubject",new Ht),this.mMaterialManager=t}var n;return(0,c.Z)(e,[{key:"destroy",value:function(){this.requestFrameSubject.unsubscribe()}},{key:"loadFont",value:(n=t(r().mark((function t(n){var i,a=this,o=arguments;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=o.length>1&&void 0!==o[1]?o[1]:"",t.abrupt("return",new Promise((function(t){if(!f.Ft.isNonEmptyString(n))return t(!1);var r=e.resolveFontName(n);if(void 0===e.sFontLoader[r]){if(e.sFontLoader[r]={name:n,finished:!1,subject:new ni(1)},f.Ft.isNonEmptyString(i)&&a.createLink(n,i),a.createSpan(n),a.isFontAvailable(n))return e.sFontLoader[r].finished=!0,e.sFontLoader[r].subject.next(!0),e.sFontLoader[r].subject.complete(),void t(!0);qe.qL.print("Font not available! Using FontFaceObserver to load font.."),new FontFaceObserver(n,{weight:400,style:"normal",stretch:"normal"}).load(null,1500).then((function(){e.sFontLoader[r].finished=!0,e.sFontLoader[r].subject.next(!0),e.sFontLoader[r].subject.complete()}),(function(t){qe.qL.error("Failed to load font:",t),e.sFontLoader[r].finished=!0,e.sFontLoader[r].subject.next(!1),e.sFontLoader[r].subject.complete()}))}e.sFontLoader[r].subject.subscribe((function(){t(!0)}),(function(e){qe.qL.error(e),t(!1)}))})));case 2:case"end":return t.stop()}}),t)}))),function(e){return n.apply(this,arguments)})},{key:"createSpan",value:function(t){var n=e.resolveFontName(t)+"_preload";if(!document.getElementById(n)){var r=document.createElement("span");r.id=n,r.textContent="Preload font: "+t,Object.assign(r.style,{position:"fixed",opacity:"0","pointer-events":"none","font-family":"'".concat(t,"'")}),document.body.appendChild(r)}}},{key:"createLink",value:function(t,n){var r=e.resolveFontName(t);if(!document.getElementById(r)){var i="\n                @font-face {\n                    font-family: '".concat(t,"';\n                    src: url('").concat(n,"') format('truetype');\n                }\n            "),a=document.createElement("link");a.setAttribute("id",r),a.setAttribute("rel","stylesheet"),a.setAttribute("href","data:text/css;charset=UTF-8,"+encodeURIComponent(i)),document.head.appendChild(a)}}},{key:"isFontLoaded",value:function(t){var n=e.resolveFontName(t);return e.sFontLoader[n]&&e.sFontLoader[n].finished}},{key:"isFontAvailable",value:function(e){return document.fonts&&document.fonts.check('normal normal 16px "'.concat(e,'"'))?(qe.qL.print("Font installed locally! [using experiment api]"),!0):!(document.fonts||!["arial","calibri","comic sans","comic sans ms","consolas","courier","courier new","georgia","garamond","helvetica","impact","tahoma","trebuchet ms","monospace","sans-serif","serif","times","times new roman","verdana","wingdings"].includes(e.toLowerCase()))&&(qe.qL.print("Font installed locally! [using custom list]"),!0)}}],[{key:"cleanup",value:function(){if(e.sFontLoader){for(var t in e.sFontLoader){var n=e.sFontLoader[t];n.subject.unsubscribe();var r=e.resolveFontName(n.name)+"_preload",i=e.resolveFontName(n.name),a=document.getElementById(r),o=document.getElementById(i);a&&a.remove(),o&&o.remove(),delete e.sFontLoader[t]}e.sFontLoader={}}}},{key:"resolveFontName",value:function(e){return"$__font__".concat(e)}}]),e}());function Hu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Gu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hu(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Vu,"sFontLoader",{});var Wu=function(e){(0,g.Z)(s,e);var n,i,a=qu(s);function s(){var e;(0,u.Z)(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=a.call.apply(a,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mDiffuseTexture",void 0),(0,l.Z)((0,_.Z)(e),"mNormalTexture",void 0),(0,l.Z)((0,_.Z)(e),"mResourceHandles",{}),(0,l.Z)((0,_.Z)(e),"mDiffuseCanvas",void 0),(0,l.Z)((0,_.Z)(e),"mNormalCanvas",void 0),e}return(0,c.Z)(s,[{key:"update",value:(i=t(r().mark((function e(t,n,i,a){var o,s,u,c=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.resolveContext(t,n,i),s=a?a.getSceneObjectId():void 0,e.prev=2,e.next=5,this.loadFont(o.symbol.font,o.symbol.fileUrl);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),qe.qL.warn("Failed to inject font:",e.t0);case 10:return e.prev=10,e.next=13,this.buildTexture(o);case 13:return u=e.sent,t.material_id in this.mResourceHandles&&this.mResourceHandles[t.material_id].getPoolKey()===s||(t.material_id in this.mResourceHandles&&(this.mMaterialManager.disposeResource(this.mResourceHandles[t.material_id]),delete this.mResourceHandles[t.material_id]),this.mResourceHandles[t.material_id]=this.mMaterialManager.makeResource(t.material_id,void 0,s)),e.next=17,this.mMaterialManager.resolveResource(this.mResourceHandles[t.material_id],(function(e){if(e){if(e instanceof Ms||e instanceof ss?(e.setDiffuseMap(u[0]),e instanceof ss&&e.useAlphaFromDiffuseMap(!0)):(e instanceof Cs||e instanceof as||e instanceof ps)&&(e.setDiffuseMap(u[0]),e.useAlphaFromDiffuseMap(!0)),"carved"===t.engraving||"relief"===t.engraving){var n=t.engraving_scale/100||.002;if(e instanceof ss){var r=new D(n,n);e.setNormalMap(u[1]),e.setNormalScale(r)}else(e instanceof cs||e instanceof ps)&&(e.setBumpMap(u[1]),e.setBumpScale(n))}e.setTransparent(!0),e.getOpacity()<1e-5&&e.setOpacity(1),e.markDirty(),c.requestFrameSubject.next()}}));case 17:e.next=22;break;case 19:e.prev=19,e.t1=e.catch(10),qe.qL.error(e.t1);case 22:case"end":return e.stop()}}),e,this,[[2,7],[10,19]])}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"destroy",value:function(){var e=this;this.mDiffuseTexture&&(this.mMaterialManager.getTextureManager().disposeTexture(this.mDiffuseTexture),this.mDiffuseTexture=null),this.mNormalTexture&&(this.mMaterialManager.getTextureManager().disposeTexture(this.mNormalTexture),this.mNormalTexture=null),this.mDiffuseCanvas=null,this.mNormalCanvas=null,Object.entries(this.mResourceHandles).forEach((function(t){var n=o(t,2)[1];try{e.mMaterialManager.disposeResource(n)}catch(e){}})),this.mResourceHandles={}}},{key:"buildEngraving",value:function(e,t,n,r,i){(0,p.isNullOrUndefined)(this.mNormalTexture)&&(this.mNormalCanvas=document.createElement("canvas"),this.mNormalCanvas.style.display="none",document.body.appendChild(this.mNormalCanvas),this.mNormalTexture=P.renderer().getRenderEngine().createTextureCanvas("text2image:normal:v1",this.mNormalCanvas));var a=this.mNormalTexture.getContext();return a.clearRect(0,0,a.canvas.width,a.canvas.height),a.canvas.width=.5*t,a.canvas.height=.5*i.image.height,e.forEach((function(e){if(a.font="".concat(.5*r,"px '").concat(e.font,"'"),a.textAlign=n,a.textBaseline=i.text.baseline,"relief"===i.engraving.type)a.fillStyle="#f3f3f3",a.shadowColor="#181818",a.shadowBlur=2,a.strokeStyle="#181818",a.lineWidth=1,a.strokeText(e.text,.5*e.left,.5*e.top);else a.fillStyle="#181818",a.shadowColor="#bababa",a.shadowBlur=i.engraving.outline,a.strokeStyle="#bababa",a.lineWidth=.5*i.engraving.outline;a.fillText(e.text,.5*e.left,.5*e.top)})),this.mNormalTexture.markDirty(),this.mNormalTexture}},{key:"buildTexture",value:(n=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=t.textValue,i=t.font.family,a=t.font.size,o=[],s=0;if(!(0,p.isNullOrUndefined)(t.symbol.font)&&t.symbol.font.length>0&&!(0,p.isNullOrUndefined)(t.symbol.list)&&t.symbol.list.length>0)for(var u,c=/(&(.*?);)/gi,l=function(){if(u.index>s){var e=u.index-s;o.push({text:r.substr(s,e),font:i,left:0,top:0,width:0})}var n=u[2],a=t.symbol.list.findIndex((function(e){return e.name===n}));a>=0&&t.symbol.list[a].enabled&&o.push({text:t.symbol.list[a].glyph_tag,font:t.symbol.font,left:0,top:0,width:0}),s=u.index+u[0].length};null!==(u=c.exec(r));)l();if(s<r.length&&o.push({text:r.substr(s,r.length-s),font:i,left:0,top:0,width:0}),t.symbol.left&&t.symbol.left.length>0&&t.symbol.list&&t.symbol.list.length>0){var h=t.symbol.list.findIndex((function(e){return e.name===t.symbol.left}));h>=0&&t.symbol.list[h].enabled&&o.unshift({text:t.symbol.list[h].glyph_tag,font:t.symbol.font,left:0,top:0,width:0})}if(t.symbol.right&&t.symbol.right.length>0&&t.symbol.list&&t.symbol.list.length>0){var f=t.symbol.list.findIndex((function(e){return e.name===t.symbol.right}));f>=0&&t.symbol.list[f].enabled&&o.push({text:t.symbol.list[f].glyph_tag,font:t.symbol.font,left:0,top:0,width:0})}if(!n.mDiffuseTexture){n.mDiffuseCanvas=document.createElement("canvas"),n.mDiffuseCanvas.style.display="none",document.body.appendChild(n.mDiffuseCanvas);var m=t.options.disableAntiAliasing;n.mDiffuseTexture=P.renderer().getRenderEngine().createTextureCanvas("text2image:diffuse:v1",n.mDiffuseCanvas,!0,void 0,Ss.ClampToEdge,Ss.ClampToEdge,m?Zs.Nearest:void 0,m?Zs.Nearest:void 0,m?Zs.None:void 0,void 0,void 0,void 0,m?0:void 0)}var d=n.mDiffuseTexture.getContext();d.clearRect(0,0,d.canvas.width,d.canvas.height);var v=1-a,y=t.image.padding+t.image.height*v,g=t.image.height*t.image.widthRatio;d.canvas.width=g,d.canvas.height=t.image.height;var b=Math.max(t.image.height-y,0),M=Math.max(t.image.height-2*t.image.padding,0),k=0,_=0,x=0;x="alphabetic"===t.text.baseline?.5*t.image.height+.5*M:.5*b+.5*y,o.forEach((function(e){d.font="".concat(b,"px '").concat(e.font,"'"),d.textAlign="left",d.textBaseline="middle";var t=d.measureText(e.text);e.width=t.width+0,k+=e.width}));var T="left";switch(t.text.align){case"left":T="left",_=0;break;case"center":T="left",_=.5*g-.5*k;break;case"right":T="right",_=g}var w=_;n.DEBUG&&(d.strokeStyle="#800080",d.strokeRect(10,0,g-20,x),d.strokeStyle="#ff6a00",d.beginPath(),d.moveTo(10,x),d.lineTo(g-10,x),d.lineWidth=1,d.stroke()),o.forEach((function(e){e.top=x,e.left=w,"right"===t.text.align?w-=e.width:w+=e.width})),o.forEach((function(e){t.text.outline>0&&(d.strokeStyle=t.text.outlineColor,d.lineWidth=t.text.outline,d.strokeText(e.text,e.left,e.top)),d.font="".concat(b,"px '").concat(e.font,"'"),d.textAlign=T,d.textBaseline=t.text.baseline,d.fillStyle=t.text.color,d.fillText(e.text,e.left,e.top)})),n.DEBUG&&(d.strokeStyle="#ff0000",d.beginPath(),d.moveTo(0,.5*t.image.height),d.lineTo(g,.5*t.image.height),d.lineWidth=2,d.stroke(),d.strokeStyle="#ff0000",d.strokeRect(0,0,g,t.image.height),d.strokeStyle="#0000ff",d.strokeRect(0,0,g,t.image.padding),d.strokeRect(0,t.image.height-t.image.padding,g,t.image.padding)),n.mDiffuseTexture.markDirty();var R=[];if(R.push(n.mDiffuseTexture),"carved"===t.engraving.type||"relief"===t.engraving.type){var Z=n.buildEngraving(o,g,T,b,t);R.push(Z)}else R.push(null);return e(R)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"getTextWidth",value:function(e,t,n){var r=this.resolveContext(e,t,n),i=document.createElement("span"),a=document.createElement("style");i.id="xpv-text-measuring",i.textContent=r.textValue,a.textContent="\n            span#xpv-text-measuring {\n                position: fixed;\n                top: 1px;\n                left: 1px;\n                visibility: hidden;\n                padding: 0;\n                border-width: 0;\n                transform: translate(-100%, -100%);\n                white-space: nowrap;\n                font-size: ".concat(16*r.font.size,"px;\n                font-family: '").concat(r.font.family,"';\n            }\n            span#xpv-text-measuring::before,\n            span#xpv-text-measuring::after { content: none; }\n        "),i.appendChild(a),document.body.appendChild(i);var o=i.getBoundingClientRect().width;return document.body.removeChild(i),o}},{key:"resolveContext",value:function(e,t,n){var r={textValue:(0,p.isNullOrUndefined)(t.value)?e.value||"":t.value,image:{height:e.height||512,widthRatio:e.width_ratio||2.5,padding:e.padding_y||e.padding||0},text:{outline:e.outline||0,color:e.color||"#ffffff",outlineColor:e.outline_color||"#ffffff",align:t.position||e.position||"center",transform:e.text_transform||"none",autoResize:e.auto_resize||!1,resizeThreshold:e.resize_threshold||6,baseline:e.text_baseline||"middle"},font:{size:t.size||1,family:t.font||e.available_fonts&&e.available_fonts[0]||"Arial"},symbol:{font:e.symbol_font||"",list:e.symbol_list||[],fileUrl:e.symbol_file_url,left:t.symbol_left||null,right:t.symbol_right||null},options:Gu({disableAntiAliasing:!1},n),engraving:{type:e.engraving||"none",outline:e.engraving_outline||0,scale:e.engraving_scale||1}};return r.textValue=function(e){switch(r.text.transform){case"lowercase":return e.toLowerCase();case"capitalize":return e.replace(/(^| )[a-z]/g,(function(e){return e.toUpperCase()}));case"uppercase":return e.toUpperCase();default:return e}}(r.textValue),r.text.autoResize&&(r.font.size*=Math.min(1,r.text.resizeThreshold/r.textValue.length)),r}},{key:"applyTexturesToModel",value:function(e){if(this.mDiffuseCanvas){var t=this.mDiffuseCanvas.toDataURL("image/png");if("PbrMaterial"===e.type?e.diffuse_map=t:e.map=t,this.mNormalCanvas){var n=this.mNormalCanvas.toDataURL("image/jpeg");"PbrMaterial"===e.type?e.normal_map=n:"MeshToonMaterial"!==e.type&&"MeshPhongMaterial"!==e.type&&"MeshPhongMaterialExt"!==e.type&&"MeshStandardMaterial"!==e.type&&"MeshPhysicalMaterial"!==e.type&&"MeshPhysicalMaterialExt"!==e.type||(e.bump_map=n)}}}}]),s}(Vu);function Yu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ku(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yu(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var $u=function(e){(0,g.Z)(s,e);var n,i,a=Xu(s);function s(){var e;(0,u.Z)(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=a.call.apply(a,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mDiffuseTexture",void 0),(0,l.Z)((0,_.Z)(e),"mNormalTexture",void 0),(0,l.Z)((0,_.Z)(e),"mResourceHandles",{}),(0,l.Z)((0,_.Z)(e),"mDiffuseCanvas",void 0),(0,l.Z)((0,_.Z)(e),"mNormalCanvas",void 0),(0,l.Z)((0,_.Z)(e),"mTextMetricsCanvas",void 0),e}return(0,c.Z)(s,[{key:"update",value:(i=t(r().mark((function e(n,i,a,o){var s,u,c=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.resolveContext(n,i,a),u=o?o.getSceneObjectId():void 0,e.prev=2,n.material_id in this.mResourceHandles&&this.mResourceHandles[n.material_id].getPoolKey()===u||(n.material_id in this.mResourceHandles&&(this.mMaterialManager.disposeResource(this.mResourceHandles[n.material_id]),delete this.mResourceHandles[n.material_id]),this.mResourceHandles[n.material_id]=this.mMaterialManager.makeResource(n.material_id,void 0,u)),e.next=6,this.mMaterialManager.resolveResource(this.mResourceHandles[n.material_id],function(){var e=t(r().mark((function e(t){var i,a,o,u,l,h;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return i=!f.Ft.isNonEmptyString(s.font.family)||c.isFontLoaded(s.font.family),a=!f.Ft.isNonEmptyString(s.symbol.font)||c.isFontLoaded(s.symbol.font),i&&a||(o=c.createInvisibleTexture(),t instanceof Ms||t instanceof ss?(t.setDiffuseMap(o),t instanceof ss&&t.useAlphaFromDiffuseMap(!0)):(t instanceof Cs||t instanceof as||t instanceof ps)&&(t.setDiffuseMap(o),t.useAlphaFromDiffuseMap(!0)),t.setTransparent(!0),t.markDirty(),c.requestFrameSubject.next()),e.prev=5,e.next=8,Promise.all([c.loadFont(s.symbol.font,s.symbol.fileUrl),c.loadFont(s.font.family)]);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),qe.qL.error("Failed to load font:",e.t0);case 13:return e.next=15,c.buildTexture(s);case 15:u=e.sent,t instanceof Ms||t instanceof ss?(t.setDiffuseMap(u[0]),t instanceof ss&&t.useAlphaFromDiffuseMap(!0)):(t instanceof Cs||t instanceof as||t instanceof ps)&&(t.setDiffuseMap(u[0]),t.useAlphaFromDiffuseMap(!0)),"carved"!==n.engraving&&"relief"!==n.engraving||(l=n.engraving_scale/100||.002,t instanceof ss?(h=new D(l,l),t.setNormalMap(u[1]),t.setNormalScale(h)):(t instanceof cs||t instanceof ps)&&(t.setBumpMap(u[1]),t.setBumpScale(l))),t.setTransparent(!0),t.getOpacity()<1e-5&&t.setOpacity(1),t.markDirty(),c.requestFrameSubject.next();case 22:case"end":return e.stop()}}),e,null,[[5,10]])})));return function(t){return e.apply(this,arguments)}}());case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),qe.qL.error(e.t0);case 11:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"destroy",value:function(){var e=this;this.mDiffuseTexture&&(this.mMaterialManager.getTextureManager().disposeTexture(this.mDiffuseTexture),this.mDiffuseTexture=null),this.mNormalTexture&&(this.mMaterialManager.getTextureManager().disposeTexture(this.mNormalTexture),this.mNormalTexture=null),this.mDiffuseCanvas=null,this.mNormalCanvas=null,Object.entries(this.mResourceHandles).forEach((function(t){var n=o(t,2)[1];try{e.mMaterialManager.disposeResource(n)}catch(e){}})),this.mResourceHandles={}}},{key:"buildEngraving",value:function(e,t,n,r,i){(0,p.isNullOrUndefined)(this.mNormalTexture)&&(this.mNormalCanvas=document.createElement("canvas"),this.mNormalCanvas.style.display="none",this.mNormalCanvas.style.letterSpacing="0px",this.mNormalCanvas.style.lineHeight="0px",document.body.appendChild(this.mNormalCanvas),this.mNormalTexture=P.renderer().getRenderEngine().createTextureCanvas("text2image:normal:v2",this.mNormalCanvas));var a=this.mNormalTexture.getContext();return a.clearRect(0,0,a.canvas.width,a.canvas.height),a.canvas.width=.5*t,a.canvas.height=.5*i.image.height,e.forEach((function(e){if(a.font="normal normal normal ".concat(.5*r,"px/0px '").concat(e.fontFamily,"'"),a.textAlign=n,a.textBaseline="alphabetic","relief"===i.engraving.type)a.fillStyle="#f3f3f3",a.shadowColor="#181818",a.shadowBlur=2,a.strokeStyle="#181818",a.lineWidth=1,a.strokeText(e.text,.5*e.x,.5*e.y);else a.fillStyle="#181818",a.shadowColor="#bababa",a.shadowBlur=i.engraving.outline,a.strokeStyle="#bababa",a.lineWidth=.5*i.engraving.outline;a.fillText(e.text,.5*e.x,.5*e.y)})),this.mNormalTexture.markDirty(),this.mNormalTexture}},{key:"buildTexture",value:(n=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=t.textValue,i=t.font.family,a=Math.max(0,t.font.size),o=t.image.height*t.image.widthRatio,s=t.image.height,u=[],c=0;if(!(0,p.isNullOrUndefined)(t.symbol.font)&&t.symbol.font.length>0&&!(0,p.isNullOrUndefined)(t.symbol.list)&&t.symbol.list.length>0)for(var l,h=/(&(.*?);)/gi,f=function(){if(l.index>c){var e=l.index-c;u.push({text:r.substr(c,e),fontFamily:i})}var n=l[2],a=t.symbol.list.findIndex((function(e){return e.name===n}));a>=0&&t.symbol.list[a].enabled&&u.push({text:t.symbol.list[a].glyph_tag,fontFamily:t.symbol.font}),c=l.index+l[0].length};null!==(l=h.exec(r));)f();if(c<r.length&&u.push({text:r.substr(c,r.length-c),fontFamily:i}),!(0,p.isNullOrUndefined)(t.symbol.left)&&t.symbol.left.length>0&&!(0,p.isNullOrUndefined)(t.symbol.list)&&t.symbol.list.length>0){var m=t.symbol.list.findIndex((function(e){return e.name===t.symbol.left}));m>=0&&t.symbol.list[m].enabled&&u.unshift({text:t.symbol.list[m].glyph_tag,fontFamily:t.symbol.font})}if(!(0,p.isNullOrUndefined)(t.symbol.right)&&t.symbol.right.length>0&&!(0,p.isNullOrUndefined)(t.symbol.list)&&t.symbol.list.length>0){var d=t.symbol.list.findIndex((function(e){return e.name===t.symbol.right}));d>=0&&t.symbol.list[d].enabled&&u.push({text:t.symbol.list[d].glyph_tag,fontFamily:t.symbol.font})}if((0,p.isNullOrUndefined)(n.mDiffuseTexture)){n.mDiffuseCanvas=document.createElement("canvas"),n.mDiffuseCanvas.style.display="none",n.mDiffuseCanvas.style.letterSpacing="0px",n.mDiffuseCanvas.style.lineHeight="0px",document.body.appendChild(n.mDiffuseCanvas);var v=t.options.disableAntiAliasing;n.mDiffuseTexture=P.renderer().getRenderEngine().createTextureCanvas("text2image:diffuse:v2",n.mDiffuseCanvas,!0,void 0,Ss.ClampToEdge,Ss.ClampToEdge,v?Zs.Nearest:void 0,v?Zs.Nearest:void 0,v?Zs.None:void 0,void 0,void 0,void 0,v?0:void 0)}var y=n.mDiffuseTexture.getContext();y.clearRect(0,0,y.canvas.width,y.canvas.height);var g=Math.max(s-2*t.image.padding_y,0)*a,b=n.resolveFontMetrics(t.font.family);y.canvas.width=o,y.canvas.height=s;var M=0,k=b.height*(g/b.fontSize),_=0,x=0,T=b.baselineHeight*(g/b.fontSize);if(u.forEach((function(e){y.font="normal normal normal ".concat(g,"px/0px '").concat(e.fontFamily,"'"),y.textAlign="left",y.textBaseline="alphabetic";var t=y.measureText(e.text);e.width=t.width+0,e.height=k,M+=e.width})),t.text.autoResize&&"bounding_box"===t.text.autoResizeType){var w=Math.max(0,o-2*t.image.padding_x);if(w<M){var R=w/M;M=w,k*=R,g*=R,T*=R,u.forEach((function(e){e.width*=R,e.height*=R}))}}x="alphabetic"===t.text.baseline?s-t.image.padding_y:.5*s+T;var Z="left";switch(t.text.align){case"left":Z="left",_=t.image.padding_x;break;case"center":Z="left",_=.5*o-.5*M;break;case"right":Z="left",_=o-t.image.padding_x-M}var S=_;u.forEach((function(e){e.x=S,e.y=x,S+=e.width})),u.forEach((function(e){if(n.DEBUG){var r=e.x,i="alphabetic"===t.text.baseline?x-e.height:.5*s-.5*e.height;y.strokeStyle="#800080",y.strokeRect(r,i,e.width,e.height),y.strokeStyle="#ffd700",y.beginPath(),y.moveTo(t.image.padding_x,x),y.lineTo(o-t.image.padding_x,x),y.lineWidth=1,y.stroke()}y.font="normal normal normal ".concat(g,"px/0px '").concat(e.fontFamily,"'"),y.textAlign=Z,y.textBaseline="alphabetic",t.text.outline>0&&(y.strokeStyle=t.text.outlineColor,y.lineWidth=t.text.outline,y.strokeText(e.text,e.x,e.y)),y.fillStyle=t.text.color,y.fillText(e.text,e.x,e.y)})),n.DEBUG&&(y.strokeStyle="#ff0000",y.beginPath(),y.moveTo(0,.5*s),y.lineTo(o,.5*s),y.lineWidth=2,y.stroke(),y.strokeStyle="#ff0000",y.strokeRect(0,0,o,s),y.strokeStyle="#0000ff",y.strokeRect(t.image.padding_x,0,o-2*t.image.padding_x,t.image.padding_y),y.strokeRect(t.image.padding_x,s-t.image.padding_y,o-2*t.image.padding_x,t.image.padding_y),y.strokeRect(0,0,t.image.padding_x,s),y.strokeRect(o-t.image.padding_x,0,t.image.padding_x,s)),n.mDiffuseTexture.markDirty();var C=[];if(C.push(n.mDiffuseTexture),"carved"===t.engraving.type||"relief"===t.engraving.type){var I=n.buildEngraving(u,o,Z,g,t);C.push(I)}else C.push(null);return e(C)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"getTextWidth",value:function(e,t,n){var r=this.resolveContext(e,t,n),i=document.createElement("span"),a=document.createElement("style");i.id="xpv-text-measuring",i.textContent=r.textValue,a.textContent="\n            span#xpv-text-measuring {\n                position: fixed;\n                top: 1px;\n                left: 1px;\n                visibility: hidden;\n                padding: 0;\n                border-width: 0;\n                transform: translate(-100%, -100%);\n                white-space: nowrap;\n                font-size: ".concat(16*r.font.size,"px;\n                font-family: '").concat(r.font.family,"';\n            }\n            span#xpv-text-measuring::before,\n            span#xpv-text-measuring::after { content: none; }\n        "),i.appendChild(a),document.body.appendChild(i);var o=i.getBoundingClientRect().width;return document.body.removeChild(i),o}},{key:"calculateTextMetrics",value:function(e,t,n){var r=n,i=4*t,a=4*t,o={left:0,right:i,top:0,bottom:a};(0,p.isNullOrUndefined)(this.mTextMetricsCanvas)&&(this.mTextMetricsCanvas=document.createElement("canvas"),this.mTextMetricsCanvas.style.display="none",this.mTextMetricsCanvas.style.letterSpacing="normal",this.mTextMetricsCanvas.style.lineHeight="0px",document.body.appendChild(this.mTextMetricsCanvas));var s=this.mTextMetricsCanvas.getContext("2d",{alpha:!1});s.canvas.width=i,s.canvas.height=a,s.fillStyle="#ffffff",s.fillRect(0,0,i,a),s.font="normal normal normal ".concat(t,"px/0px '").concat(e,"'"),s.textAlign="left",s.textBaseline="alphabetic",s.fillStyle="#000000";for(var u=.33*i,c=.5*a+.33*t,l=0;l<r.length;l++)s.fillText(r[l],u,c);for(var h=s.getImageData(0,0,i,a).data,f=i,m=a,d=-1,v=-1,y=!1,g=0;g<a;g++){y=!1;for(var b=0;b<i;b++){var M=g*(4*i)+4*b;h[M]+h[M+1]+h[M+2]===0&&(y=!0,b<f&&(f=b),b>d&&(d=b))}y&&(g<m&&(m=g),g>v&&(v=g))}return o.left=f<i?f:0,o.top=m<a?m:0,o.right=d>0?d+1:i,o.bottom=v>0?v+1:a,{width:o.right-o.left,height:o.bottom-o.top}}},{key:"resolveFontMetrics",value:function(e){if(!s.sFontMetrics.has(e)){var t=s.sFontSize,n=this.calculateTextMetrics(e,t,"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890.:,;'\"(!?)+-*/=@"),r=this.calculateTextMetrics(e,t,"eo");s.sFontMetrics.set(e,{fontSize:t,width:n.width,height:n.height,baselineHeight:.5*r.height})}return s.sFontMetrics.get(e)}},{key:"resolveContext",value:function(e,t,n){var r={textValue:(0,p.isNullOrUndefined)(t.value)?e.value||"":t.value,image:{height:e.height||512,widthRatio:e.width_ratio||2.5,padding_x:e.padding_x||0,padding_y:e.padding_y||0},text:{outline:e.outline||0,color:e.color||"#ffffff",outlineColor:e.outline_color||"#ffffff",align:t.position||e.position||"center",transform:e.text_transform||"none",autoResize:e.auto_resize||!1,autoResizeType:e.auto_resize_type||"character",resizeThreshold:e.resize_threshold||6,baseline:e.text_baseline||"middle"},font:{size:t.size||1,family:t.font||e.available_fonts&&e.available_fonts[0]||"Arial"},symbol:{font:e.symbol_font||"",list:e.symbol_list||[],fileUrl:e.symbol_file_url,left:t.symbol_left||null,right:t.symbol_right||null},options:Ku({disableAntiAliasing:!1},n),engraving:{type:e.engraving||"none",outline:e.engraving_outline||0,scale:e.engraving_scale||1}};return r.textValue=function(e){switch(r.text.transform){case"lowercase":return e.toLowerCase();case"capitalize":return e.replace(/(^| )[a-z]/g,(function(e){return e.toUpperCase()}));case"uppercase":return e.toUpperCase();default:return e}}(r.textValue),r.text.autoResize&&"character"===r.text.autoResizeType&&(r.font.size*=Math.min(1,r.text.resizeThreshold/r.textValue.length)),r}},{key:"createInvisibleTexture",value:function(){if((0,p.isNullOrUndefined)(s.sTransparentTexture)){var e=document.createElement("canvas");e.style.display="none",e.style.backgroundColor="transparent",e.width=1,e.height=1,document.body.appendChild(e),s.sTransparentTexture=P.renderer().getRenderEngine().createTextureCanvas("text2image:transparent:v2",e,!0,void 0,Ss.ClampToEdge,Ss.ClampToEdge),e.getContext("2d",{alpha:!0}).clearRect(0,0,e.width,e.height),s.sTransparentTexture.markDirty()}return s.sTransparentTexture}},{key:"applyTexturesToModel",value:function(e){if(this.mDiffuseCanvas){var t=this.mDiffuseCanvas.toDataURL("image/png");if("PbrMaterial"===e.type?e.diffuse_map=t:e.map=t,this.mNormalCanvas){var n=this.mNormalCanvas.toDataURL("image/jpeg");"PbrMaterial"===e.type?e.normal_map=n:"MeshToonMaterial"!==e.type&&"MeshPhongMaterial"!==e.type&&"MeshPhongMaterialExt"!==e.type&&"MeshStandardMaterial"!==e.type&&"MeshPhysicalMaterial"!==e.type&&"MeshPhysicalMaterialExt"!==e.type||(e.bump_map=n)}}}}]),s}(Vu);(0,l.Z)($u,"sTransparentTexture",void 0),(0,l.Z)($u,"sFontSize",128),(0,l.Z)($u,"sFontMetrics",new Map);var Qu,Ju=function(){function e(t,n){(0,u.Z)(this,e),(0,l.Z)(this,"mController",void 0),qe.qL.print("TextToImageController: Attribute version:",n.version),2===n.version?this.mController=new $u(t):this.mController=new Wu(t)}var n;return(0,c.Z)(e,[{key:"update",value:(n=t(r().mark((function e(t,n,i,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mController.update(t,n,i,a));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"destroy",value:function(){this.mController.destroy()}},{key:"getTextWidth",value:function(e,t,n){return this.mController.getTextWidth(e,t,n)}},{key:"requestFrameSubject",value:function(){return this.mController.requestFrameSubject}},{key:"applyTexturesToModel",value:function(e){this.mController.applyTexturesToModel(e)}}]),e}();!function(e){e[e.TextureManager=0]="TextureManager",e[e.MaterialManager=1]="MaterialManager",e[e.GeometryManager=2]="GeometryManager",e[e.MaxTypes=3]="MaxTypes"}(Qu||(Qu={}));var ec,tc=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mManagers",{}),(0,l.Z)(this,"mDirty",void 0);var t=new xu;this.mManagers[Qu.TextureManager]=t,this.mManagers[Qu.MaterialManager]=new Xs(t),this.mManagers[Qu.GeometryManager]=new Uu,this.mDirty={}}return(0,c.Z)(e,[{key:"resolveManager",value:function(t,n){var r=n||e.isDirty(t);return e.setDirty(t,!1),void 0!==this.mManagers[t].loadLibrary(r)}}],[{key:"getInstance",value:function(){return this.sInstance||(this.sInstance=new e),this.sInstance}},{key:"setDirty",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.getInstance();if(void 0===t)for(var i in Qu)isNaN(Number(i))||Number(i)>=Qu.MaxTypes||(r.mDirty[i]=n);else r.mDirty[t]=n}},{key:"isDirty",value:function(t){var n=e.getInstance();if(void 0===t)for(var r=0,i=Object.entries(n.mDirty);r<i.length;r++){if(!0===o(i[r],2)[1])return!0}return!0===n.mDirty[t]}},{key:"getManager",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.getInstance();return r.resolveManager(t,n),r.mManagers[t]}},{key:"destroy",value:function(){if(e.sInstance){for(var t in e.sInstance.mManagers)e.sInstance.mManagers[t].cleanup();delete e.sInstance.mDirty,delete e.sInstance.mManagers,delete e.sInstance}Vu.cleanup(),Fu.cleanup()}}]),e}();function nc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(tc,"sInstance",void 0),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(ec||(ec={}));var rc=function(e){(0,g.Z)(n,e);var t=nc(n);function n(e,r,i,a){var o;return(0,u.Z)(this,n),o=t.call(this,e),(0,l.Z)((0,_.Z)(o),"renderTechnique",eo.mesh),(0,l.Z)((0,_.Z)(o),"mGeometrySource",void 0),(0,l.Z)((0,_.Z)(o),"mMaterialId",void 0),(0,l.Z)((0,_.Z)(o),"mGeometryHandle",void 0),(0,l.Z)((0,_.Z)(o),"mMaterialHandle",void 0),(0,l.Z)((0,_.Z)(o),"mDrawMode",ec.TRIANGLES),(0,l.Z)((0,_.Z)(o),"mSharedKeyOverwrite",{}),(0,l.Z)((0,_.Z)(o),"mOnAttachSubscriptions",[]),o.mName="MeshEntity",void 0!==r&&(r instanceof wu?o.setGeometry(r,a):"string"==typeof r&&o.setGeometryBySource(r,a)),void 0!==i&&(i instanceof ns?o.setMaterial(i,a):Number.isFinite(i)&&o.setMaterialById(i,a)),o}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"setGeometryBySource",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.mGeometrySource=e,this.disposeGeometry(n);var r=tc.getManager(Qu.GeometryManager);this.mGeometryHandle=r.makeResource("".concat(Jr.E.cacheUrl).concat(this.mGeometrySource),void 0,t),this.markNeedsRenderUpdate()}},{key:"setGeometry",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];delete this.mGeometrySource,this.disposeGeometry(n);var r=tc.getManager(Qu.GeometryManager);this.mGeometryHandle=r.makeResourceRaw(e,t),this.markNeedsRenderUpdate()}},{key:"getGeometrySource",value:function(){return this.mGeometrySource}},{key:"getMaterialId",value:function(){return this.mMaterialId}},{key:"setMaterialById",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=tc.getManager(Qu.MaterialManager);e in this.mSharedKeyOverwrite&&(t=this.mSharedKeyOverwrite[e]),this.mMaterialId===e&&this.mMaterialHandle&&r.validatePoolKey(this.mMaterialHandle,t)||(this.unsetMaterial(n),this.mMaterialId=e,this.mMaterialHandle=r.makeResource(e,void 0,t),this.markNeedsRenderUpdate())}},{key:"setMaterial",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.getUniqueId(),i=tc.getManager(Qu.MaterialManager);r in this.mSharedKeyOverwrite&&(t=this.mSharedKeyOverwrite[r]),this.mMaterialId===r&&this.mMaterialHandle&&i.validatePoolKey(this.mMaterialHandle,t)||(this.unsetMaterial(n),this.mMaterialId=r,this.mMaterialHandle=i.makeResourceRaw(e,t),this.markNeedsRenderUpdate())}},{key:"unsetMaterial",value:function(e){if(delete this.mMaterialId,this.mMaterialHandle){var t=tc.getManager(Qu.MaterialManager);try{t.disposeResource(this.mMaterialHandle,e)}catch(e){qe.qL.error("MeshEntity: Unable to dispose material.",e)}finally{delete this.mMaterialHandle,this.markNeedsRenderUpdate()}}}},{key:"disposeGeometry",value:function(e){if(this.mGeometryHandle){var t=tc.getManager(Qu.GeometryManager);try{t.disposeResource(this.mGeometryHandle,e)}catch(e){qe.qL.error("MeshEntity: Unable to dispose geometry.",e)}finally{delete this.mGeometryHandle}}}},{key:"getGeometry",value:function(){return this.mGeometryHandle}},{key:"getMaterial",value:function(){return this.mMaterialHandle}},{key:"drawMode",get:function(){return this.mDrawMode},set:function(e){this.mDrawMode=e}},{key:"onAttached",value:function(e){Ni((0,M.Z)(n.prototype),"onAttached",this).call(this,e),this.subscribeToMaterialChanges()}},{key:"onDetached",value:function(e){Ni((0,M.Z)(n.prototype),"onDetached",this).call(this,e),this.mOnAttachSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"destroy",value:function(e,t){this.disposeGeometry(e),this.unsetMaterial(e),Ni((0,M.Z)(n.prototype),"destroy",this).call(this,e,t)}},{key:"subscribeToMaterialChanges",value:function(){var e=this,t=P.eventBus().subscribe(Di.getTopicName(Ei.MaterialUpdated),(function(t){var n,r;null!==(n=t.getData())&&void 0!==n&&n.material_id&&e.mMaterialId===(null===(r=t.getData())||void 0===r?void 0:r.material_id)&&e.markNeedsRenderUpdate()}));this.mOnAttachSubscriptions.push(t)}},{key:"setMaterialOverwrite",value:function(e,t){void 0!==t&&(this.mSharedKeyOverwrite[e]=t),this.mMaterialId===e&&this.setMaterialById(e,t)}}]),n}(Wa);(0,l.Z)(rc,"TypeRTTI",new k.r("MeshEntity",Wa.TypeRTTI));var ic,ac=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,null,[{key:"Create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;arguments.length>7&&void 0!==arguments[7]||Es.Front;t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));for(var s=Math.min(a+o,Math.PI),u=0,c=[],l=new Bi,h=new Bi,f=[],p=[],m=[],d=[],v=0;v<=n;v++){var y=[],g=v/n,b=0;0==v&&0==a?b=.5/t:v==n&&s==Math.PI&&(b=-.5/t);for(var M=0;M<=t;M++){var k=M/t;l.x=-e*Math.cos(r+k*i)*Math.sin(a+g*o),l.y=e*Math.cos(a+g*o),l.z=e*Math.sin(r+k*i)*Math.sin(a+g*o),p.push(l.x,l.y,l.z),h.copy(l).normalize(),m.push(h.x,h.y,h.z),d.push(k+b,1-g),y.push(u++)}c.push(y)}for(var _=0;_<n;_++)for(var x=0;x<t;x++){var T=c[_][x+1],w=c[_][x],R=c[_+1][x],Z=c[_+1][x+1];(0!==_||a>0)&&f.push(T,w,Z),(_!==n-1||s<Math.PI)&&f.push(w,R,Z)}var S=P.renderer().getRenderEngine().createBuffer();return S.setIndexData(new Ru(new Uint32Array(f),1)),S.setVertexData(_u.POSITION,new Ru(new Float32Array(p),3)),S.setVertexData(_u.NORMAL,new Ru(new Float32Array(m),3)),S.setVertexData(_u.UV,new Ru(new Float32Array(d),2)),S}}]),e}(),oc=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,null,[{key:"Create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;arguments.length>6&&void 0!==arguments[6]||Es.Front;r=Math.floor(r),i=Math.floor(i),a=Math.floor(a);var o=[],s=[],u=[],c=[],l=0;[{u:2,v:1,w:0,udir:-1,vdir:-1,width:n,height:t,depth:e,gridX:a,gridY:i},{u:2,v:1,w:0,udir:1,vdir:-1,width:n,height:t,depth:-e,gridX:a,gridY:i},{u:0,v:2,w:1,udir:1,vdir:1,width:e,height:n,depth:t,gridX:r,gridY:a},{u:0,v:2,w:1,udir:1,vdir:-1,width:e,height:n,depth:-t,gridX:r,gridY:a},{u:0,v:1,w:2,udir:1,vdir:-1,width:e,height:t,depth:n,gridX:r,gridY:i},{u:0,v:1,w:2,udir:-1,vdir:-1,width:e,height:t,depth:-n,gridX:r,gridY:i}].forEach((function(e){for(var t=e.width/e.gridX,n=e.height/e.gridY,r=e.width/2,i=e.height/2,a=e.depth/2,h=e.gridX+1,f=e.gridY+1,p=0,m=new Bi,d=0;d<f;d++)for(var v=d*n-i,y=0;y<h;y++){var g=y*t-r;m.setComponent(e.u,g*e.udir),m.setComponent(e.v,v*e.vdir),m.setComponent(e.w,a),s.push(m.x,m.y,m.z),m.setComponent(e.u,0),m.setComponent(e.v,0),m.setComponent(e.w,e.depth>0?1:-1),u.push(m.x,m.y,m.z),c.push(y/e.gridX),c.push(1-d/e.gridY),p+=1}for(var b=0;b<e.gridY;b++)for(var M=0;M<e.gridX;M++){var k=l+M+h*b,_=l+M+h*(b+1),x=l+(M+1)+h*(b+1),T=l+(M+1)+h*b;o.push(k,_,T),o.push(_,x,T)}l+=p}));var h=P.renderer().getRenderEngine().createBuffer();return h.setIndexData(new Ru(new Uint32Array(o),1)),h.setVertexData(_u.POSITION,new Ru(new Float32Array(s),3)),h.setVertexData(_u.NORMAL,new Ru(new Float32Array(u),3)),h.setVertexData(_u.UV,new Ru(new Float32Array(c),2)),h}}]),e}();function sc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}!function(e){e[e.Sphere=0]="Sphere",e[e.Box=1]="Box"}(ic||(ic={}));var uc=function(e){(0,g.Z)(n,e);var t=sc(n);function n(e){var r;(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mBody",void 0),r.mName="body-helper",r.mBody=e,r.layers.enable(2),r.layers.enable(4),r.layers.enable(5),r.layers.enable(6),r.pickable=!1,r.castShadow=!1,r.receiveShadow=!1,r.updateChanges();var i=P.renderer().getRenderEngine().createMaterialPBR("body-helper");return i.setUnlit(!0),i.setDiffuseColor(so.Black()),i.setEmissiveColor(so.Yellow()),i.setWireframe(!0),r.setMaterial(i),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"updateChanges",value:function(){var e=this.mBody.getShape();e.getShapeType()===ic.Sphere?this.setGeometry(ac.Create(e.getRadius(),32,32),void 0,!0):e.getShapeType()===ic.Box&&this.setGeometry(oc.Create(e.getWidth(),e.getHeight(),e.getDepth(),1,1,1),void 0,!0)}},{key:"update",value:function(e){Ni((0,M.Z)(n.prototype),"update",this).call(this,e),this.transform.position.copy(this.mBody.getPosition()),this.transform.quaternion.copy(this.mBody.getQuaternion())}}]),n}(rc);function cc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(uc,"TypeRTTI",new k.r("BodyHelper",rc.TypeRTTI));var lc,hc,fc=function(e){(0,g.Z)(n,e);var t=cc(n);function n(e,r,i){var a;return(0,u.Z)(this,n),a=t.call(this,n.getTopicName(e)),(0,l.Z)((0,_.Z)(a),"mType",void 0),(0,l.Z)((0,_.Z)(a),"mVisible",void 0),(0,l.Z)((0,_.Z)(a),"mData",void 0),a.mType=e,a.mVisible=r,a.mData=i,a}return(0,c.Z)(n,[{key:"getType",value:function(){return this.mType}},{key:"isVisible",value:function(){return this.mVisible}},{key:"getData",value:function(){return this.mData}}],[{key:"getTopicName",value:function(e){return"EditorGizmoVisibilityEvent.".concat(e)}}]),n}(Zi);function pc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}!function(e){e[e.PhysicsCollider=0]="PhysicsCollider"}(lc||(lc={})),function(e){e[e.Dynamic=1]="Dynamic",e[e.Static=2]="Static",e[e.Kinematic=3]="Kinematic"}(hc||(hc={}));var mc=function(e){(0,g.Z)(n,e);var t=pc(n);function n(){var e;return(0,u.Z)(this,n),e=t.call(this,"physics-object-collider"),(0,l.Z)((0,_.Z)(e),"mEnabled",!0),(0,l.Z)((0,_.Z)(e),"mSceneObjectId",void 0),(0,l.Z)((0,_.Z)(e),"mBody",void 0),(0,l.Z)((0,_.Z)(e),"mOffset",new Bi),(0,l.Z)((0,_.Z)(e),"mShape",void 0),(0,l.Z)((0,_.Z)(e),"mAutomatic",!1),(0,l.Z)((0,_.Z)(e),"mBodyType",hc.Kinematic),(0,l.Z)((0,_.Z)(e),"mDebug",!1),(0,l.Z)((0,_.Z)(e),"mHelper",void 0),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"OnAttached",value:function(){var e=this,t=P.physicsSystem().getWorld();this.mShape=this.createShape(),this.mBody=t.createBody(this.mShape,this.mBodyType),this.mBody.setOffset(this.mOffset);var n=this.getParentObject();this.mSceneObjectId=n.getSceneObjectId(),P.physicsSystem().registerMesh(n,this.mBody),this.mEnabled=!0,this.mDebug=P.physicsSystem().showHelpers(),this.mDebug&&this.createHelper(),this.mSubscriptions.push(P.eventBus().subscribe(fc.getTopicName(lc.PhysicsCollider),(function(t){e.mDebug=t.isVisible(),e.mDebug?e.createHelper():e.destroyHelper()})),P.eventBus().subscribe(Hi.getTopicName(),(function(){e.mAutomatic&&e.onAutomaticUpdate()}),"".concat(this.mSceneObjectId)))}},{key:"OnDetached",value:function(){this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.destroyHelper(),this.mEnabled&&(P.physicsSystem().unregisterMesh(this.mSceneObjectId),delete this.mSceneObjectId,this.mEnabled=!1),this.mBody&&(this.mBody.dispose(),delete this.mBody),this.mShape&&delete this.mShape}},{key:"isAttachable",value:function(e){return e.isTypeName("ConfigurableNode")||e.isTypeName("ProductNode")||e.isTypeName("ReferenceProductNode")}},{key:"createHelper",value:function(){this.mHelper||(this.mHelper=new uc(this.mBody),P.sceneManager().addNode(this.mHelper,void 0,!1))}},{key:"destroyHelper",value:function(){this.mHelper&&(P.sceneManager().removeNode(this.mHelper,!0,!0,!0,!1),this.mHelper.destroy(!0),delete this.mHelper)}},{key:"isEnabled",value:function(){return this.mEnabled}},{key:"setEnabled",value:function(e){if(this.mEnabled!==e)if(this.mEnabled=e,this.mEnabled){var t=this.getParentObject();P.physicsSystem().registerMesh(t,this.mBody),this.mDebug&&this.createHelper()}else{var n=this.getParentObject();P.physicsSystem().unregisterMesh(n.getSceneObjectId()),this.destroyHelper()}}},{key:"isAutomatic",value:function(){return this.mAutomatic}},{key:"setAutomatic",value:function(e){this.mAutomatic=e,this.mAutomatic&&this.mBody&&this.onAutomaticUpdate()}},{key:"getOffset",value:function(){return this.mOffset}},{key:"setOffset",value:function(e){var t;this.mOffset.copy(e),null===(t=this.mBody)||void 0===t||t.setOffset(this.mOffset)}},{key:"getBodyType",value:function(){return this.mBodyType}},{key:"setBodyType",value:function(e){this.mBodyType!==e&&(this.mBodyType=e,this.mBody.setBodyType(this.mBodyType))}},{key:"getBody",value:function(){return this.mBody}},{key:"parse",value:function(e){if(!e)return!1;this.mBodyType="number"==typeof e.body_type&&e.body_type in hc?e.body_type:hc.Kinematic;var t=Array.isArray(e.offset)&&e.offset.length>=3?e.offset:[0,0,0];return this.mOffset.fromArray(t),this.setAutomatic(void 0!==e.automatic&&Boolean(e.automatic)),this.mBody&&(this.mBody.setBodyType(this.mBodyType),this.mBody.setOffset(this.mOffset)),!0}},{key:"serialize",value:function(){return{type:this.getShapeType(),body_type:this.mBodyType,offset:this.mOffset.toArray(),automatic:this.mAutomatic,properties:{}}}}]),n}(Xi.H);function dc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(mc,"TypeRTTI",new k.r("PhysicsColliderComponent",Xi.H.TypeRTTI));var vc=function(e){(0,g.Z)(n,e);var t=dc(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,u.Z)(this,n),e=t.call(this),(0,l.Z)((0,_.Z)(e),"mRadius",void 0),e.mRadius=r,e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"createShape",value:function(){return P.physicsSystem().getWorld().createSphere(this.mRadius)}},{key:"getShapeType",value:function(){return"sphere"}},{key:"getRadius",value:function(){return this.mRadius}},{key:"setRadius",value:function(e){var t;this.mRadius=e,this.mShape.setRadius(e),null===(t=this.mHelper)||void 0===t||t.updateChanges()}},{key:"onAutomaticUpdate",value:function(){var e,t=this.getParentObject().getBoundingBox(!0),n=new Bi;t.getSize(n);var r=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);this.mRadius=.5*r,this.mShape.setRadius(this.mRadius),this.setOffset(new Bi(0,.5*n.y,0)),null===(e=this.mHelper)||void 0===e||e.updateChanges()}},{key:"parse",value:function(e){if(!Ni((0,M.Z)(n.prototype),"parse",this).call(this,e))return!1;var t;(e.properties&&(this.mRadius="number"==typeof e.properties.radius?e.properties.radius:1),this.mShape)&&(this.mShape.setRadius(this.mRadius),null===(t=this.mHelper)||void 0===t||t.updateChanges());return!0}},{key:"serialize",value:function(){var e=Ni((0,M.Z)(n.prototype),"serialize",this).call(this);return e.properties=Object.assign(e.properties,{radius:this.mRadius}),e}}]),n}(mc);function yc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(vc,"TypeRTTI",new k.r("SphereColliderComponent",mc.TypeRTTI));var gc=function(e){(0,g.Z)(n,e);var t=yc(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(0,u.Z)(this,n),e=t.call(this),(0,l.Z)((0,_.Z)(e),"mWidth",1),(0,l.Z)((0,_.Z)(e),"mHeight",1),(0,l.Z)((0,_.Z)(e),"mDepth",1),e.mWidth=r,e.mHeight=i,e.mDepth=a,e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"createShape",value:function(){return P.physicsSystem().getWorld().createBox(new Bi(this.mWidth,this.mHeight,this.mDepth))}},{key:"getShapeType",value:function(){return"box"}},{key:"getWidth",value:function(){return this.mWidth}},{key:"setWidth",value:function(e){var t;this.mWidth=e,this.mShape.setWidth(this.mWidth),null===(t=this.mHelper)||void 0===t||t.updateChanges()}},{key:"getHeight",value:function(){return this.mHeight}},{key:"setHeight",value:function(e){var t;this.mHeight=e,this.mShape.setHeight(this.mHeight),null===(t=this.mHelper)||void 0===t||t.updateChanges()}},{key:"getDepth",value:function(){return this.mDepth}},{key:"setDepth",value:function(e){var t;this.mDepth=e,this.mShape.setDepth(this.mDepth),null===(t=this.mHelper)||void 0===t||t.updateChanges()}},{key:"onAutomaticUpdate",value:function(){var e,t=this.getParentObject().getBoundingBox(!0),n=new Bi;t.getSize(n),this.mWidth=n.x,this.mHeight=n.y,this.mDepth=n.z,this.mShape.setWidth(this.mWidth),this.mShape.setHeight(this.mHeight),this.mShape.setDepth(this.mDepth),this.setOffset(new Bi(0,.5*n.y,0)),null===(e=this.mHelper)||void 0===e||e.updateChanges()}},{key:"parse",value:function(e){if(!Ni((0,M.Z)(n.prototype),"parse",this).call(this,e))return!1;var t;(e.properties&&(this.mWidth="number"==typeof e.properties.width?e.properties.width:1,this.mHeight="number"==typeof e.properties.height?e.properties.height:1,this.mDepth="number"==typeof e.properties.depth?e.properties.depth:1),this.mShape)&&(this.mShape.setWidth(this.mWidth),this.mShape.setHeight(this.mHeight),this.mShape.setDepth(this.mDepth),null===(t=this.mHelper)||void 0===t||t.updateChanges());return!0}},{key:"serialize",value:function(){var e=Ni((0,M.Z)(n.prototype),"serialize",this).call(this);return e.properties=Object.assign(e.properties,{width:this.mWidth,height:this.mHeight,depth:this.mDepth}),e}}]),n}(mc);function bc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(gc,"TypeRTTI",new k.r("BoxColliderComponent",mc.TypeRTTI));var Mc=function(e){(0,g.Z)(a,e);var n,i=bc(a);function a(e){var t;return(0,u.Z)(this,a),t=i.call(this,e),(0,l.Z)((0,_.Z)(t),"mPreconfiguredOptions",void 0),(0,l.Z)((0,_.Z)(t),"mMeshList",void 0),(0,l.Z)((0,_.Z)(t),"mFirstBuild",!0),(0,l.Z)((0,_.Z)(t),"mSubscriptions",void 0),(0,l.Z)((0,_.Z)(t),"mUnit","M"),(0,l.Z)((0,_.Z)(t),"mWorldRatio",1),(0,l.Z)((0,_.Z)(t),"onMeshListUpdate",new Ht),(0,l.Z)((0,_.Z)(t),"onConfigurableNodeUpdated",new Ht),t.mSubscriptions=[],t.mName="ConfigurableNode",t}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"proxySetValue",value:function(e,t,n){switch(e){case"unit":return this.mUnit=t,!0;case"world_ratio":return this.mWorldRatio=t,!0;case"collider":if(!n)break;if(!P.settingsManager().getSettings().getSceneSettings().physics.enabled)break;var r="string"==typeof t?JSON.parse(t):t;if(o(this.getComponents(mc.TypeRTTI),1)[0])break;return this.addColliderWithParsedData(r),!0}return Ni((0,M.Z)(a.prototype),"proxySetValue",this).call(this,e,t,n)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(a.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"unit":return this.mUnit;case"world_ratio":return this.mWorldRatio}return null}},{key:"_setPreconfiguredOptions",value:function(e){this.mPreconfiguredOptions=e}},{key:"_getPreconfiguredOptions",value:function(){return this.mPreconfiguredOptions}},{key:"_setFirstBuild",value:function(e){this.mFirstBuild=e}},{key:"_isFirstBuild",value:function(){return this.mFirstBuild}},{key:"onAttached",value:function(e){var t=this;Ni((0,M.Z)(a.prototype),"onAttached",this).call(this,e);var n=this.findParentOfTypeName("ProductNode");this.mSubscriptions.push(P.messenger().listen(G.TypeRTTI,(function(e){t.dispatchMessageToComponents(e)}),String(n.getSceneObjectId())))}},{key:"onDetached",value:function(e){Ni((0,M.Z)(a.prototype),"onDetached",this).call(this,e),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"resolveSceneOffsetManager",value:(n=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.getComponent("offsetManager").load().pipe(sn(1)).subscribe({next:function(t){e(t)},error:function(e){qe.qL.error(e),n(e)}})})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"setMeshList",value:function(e){this.mMeshList=e,this.onMeshListUpdate.next()}},{key:"getMeshList",value:function(){return this.mMeshList}},{key:"onBeforeSerializeChildren",value:function(){return!1}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(a.prototype),"serialize",this).call(this,e),{type:"configurable"});if(t.properties=Object.assign(t.properties,{unit:this.mUnit,world_ratio:this.mWorldRatio}),this.shouldSerializeColliderData()){var n=o(this.getComponents(mc.TypeRTTI),1)[0];n&&(t.properties.collider=n.serialize())}return t}},{key:"notifyMaterialOverwrite",value:function(e,t){this.dispatchMessageToComponents(new G(e,t))}},{key:"shouldSerializeColliderData",value:function(){var e=this.findParentOfTypeName("ProductNode"),t=this.findParentOfTypeName("ReferenceProductNode");return!!e&&(!t&&this.getSceneObjectId()>=0)}},{key:"addColliderWithParsedData",value:function(e){if(e){var t=this.getParent(),n=-1===t.getSceneObjectId();if(!!!t.findParentOfTypeName("ReferenceProductNode")){var r=n?this:t;switch(r.removeComponents(mc.TypeRTTI),e.type){case"sphere":var i=new vc;i.parse(e),r.addComponent(i);break;case"box":var a=new gc;a.parse(e),r.addComponent(a)}}}}},{key:"_updateBoundingBox",value:function(e){Ni((0,M.Z)(a.prototype),"_updateBoundingBox",this).call(this,e);var t=this.getParent();t&&t._updateBoundingBox(this.getBoundingBox(!0))}}]),a}(Ga);(0,l.Z)(Mc,"TypeRTTI",new k.r("ConfigurableNode",Ga.TypeRTTI));var kc=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"elements",[]),this.elements=[1,0,0,0,1,0,0,0,1]}return(0,c.Z)(e,[{key:"set",value:function(e,t,n,r,i,a,o,s,u){var c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=i,c[5]=s,c[6]=n,c[7]=a,c[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],u=n[1],c=n[4],l=n[7],h=n[2],f=n[5],p=n[8],m=r[0],d=r[3],v=r[6],y=r[1],g=r[4],b=r[7],M=r[2],k=r[5],_=r[8];return i[0]=a*m+o*y+s*M,i[3]=a*d+o*g+s*k,i[6]=a*v+o*b+s*_,i[1]=u*m+c*y+l*M,i[4]=u*d+c*g+l*k,i[7]=u*v+c*b+l*_,i[2]=h*m+f*y+p*M,i[5]=h*d+f*g+p*k,i[8]=h*v+f*b+p*_,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],c=e[8];return t*a*c-t*o*u-n*i*c+n*o*s+r*i*u-r*a*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],c=e[8],l=c*a-o*u,h=o*s-c*i,f=u*i-a*s,p=t*l+n*h+r*f;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);var m=1/p;return e[0]=l*m,e[1]=(r*u-c*n)*m,e[2]=(o*n-r*a)*m,e[3]=h*m,e[4]=(c*t-r*s)*m,e[5]=(r*i-o*t)*m,e[6]=f*m,e[7]=(n*s-u*t)*m,e[8]=(a*t-n*i)*m,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,r,i,a,o){var s=Math.cos(i),u=Math.sin(i);return this.set(n*s,n*u,-n*(s*a+u*o)+a+e,-r*u,r*s,-r*(-u*a+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],a=r[3],o=r[6],s=r[1],u=r[4],c=r[7];return r[0]=t*i+n*s,r[3]=t*a+n*u,r[6]=t*o+n*c,r[1]=-n*i+t*s,r[4]=-n*a+t*u,r[7]=-n*o+t*c,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}}]),e}(),_c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Bi.Right(),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,u.Z)(this,e),(0,l.Z)(this,"normal",void 0),(0,l.Z)(this,"constant",void 0),this.normal=t,this.constant=n}return(0,c.Z)(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(t,n,r){var i=e._vector1.subVectors(r,n).cross(e._vector2.subVectors(t,n)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e,t){return this.distanceToPoint(e)-t}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(t,n,r){var i=e._vector1.subVectors(n,t),a=this.normal.dot(i);if(0===a)return 0===this.distanceToPoint(t)?r.copy(t):null;var o=-(t.dot(this.normal)+this.constant)/a;return o<0||o>1?null:r.copy(i).multiplyScalar(o).add(t)}},{key:"intersectsLine",value:function(e,t){var n=this.distanceToPoint(e),r=this.distanceToPoint(t);return n<0&&r>0||r<0&&n>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(t,n){var r=n||e._normalMatrix.getNormalMatrix(t),i=this.coplanarPoint(e._vector1).applyMatrix4(t),a=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(a),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new e).copy(this)}}]),e}();(0,l.Z)(_c,"_vector1",new Bi),(0,l.Z)(_c,"_vector2",new Bi),(0,l.Z)(_c,"_normalMatrix",new kc);var xc=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mHash",void 0),this.newHash()}return(0,c.Z)(e,[{key:"getHash",value:function(){return this.mHash}},{key:"newHash",value:function(){return this.mHash=y.F.guid()+String(e._gid_count++),this.mHash}},{key:"copy",value:function(e){this.mHash=e.mHash}},{key:"isSame",value:function(e){return this.mHash===e.mHash}}]),e}();function Tc(e){return e instanceof Date&&!isNaN(e)}function wc(e,t,n){void 0===e&&(e=0),void 0===n&&(n=rn);var r=-1;return null!=t&&(uo(t)?n=t:r=t),new zt((function(t){var i=Tc(e)?+e-n.now():e;i<0&&(i=0);var a=0;return n.schedule((function(){t.closed||(t.next(a++),0<=r?this.schedule(void 0,r):t.complete())}),i)}))}function Rc(e){var t,n,r=1/0;return null!=e&&("object"==typeof e?(t=e.count,r=void 0===t?1/0:t,n=e.delay):r=e),r<=0?function(){return on}:qt((function(e,t){var i,a=0,o=function(){if(null==i||i.unsubscribe(),i=null,null!=n){var e="number"==typeof n?wc(n):_o(n(a)),r=Wt(t,(function(){r.unsubscribe(),s()}));e.subscribe(r)}else s()},s=function(){var n=!1;i=e.subscribe(Wt(t,void 0,(function(){++a<r?i?o():n=!0:t.complete()}))),n&&o()};s()}))}(0,l.Z)(xc,"_gid_count",1);var Zc={leading:!0,trailing:!1};function Sc(e,t){return void 0===t&&(t=Zc),qt((function(n,r){var i=t.leading,a=t.trailing,o=!1,s=null,u=null,c=!1,l=function(){null==u||u.unsubscribe(),u=null,a&&(p(),c&&r.complete())},h=function(){u=null,c&&r.complete()},f=function(t){return u=_o(e(t)).subscribe(Wt(r,l,h))},p=function(){if(o){o=!1;var e=s;s=null,r.next(e),!c&&f(e)}};n.subscribe(Wt(r,(function(e){o=!0,s=e,(!u||u.closed)&&(i?p():f(e))}),(function(){c=!0,(!(a&&o&&u)||u.closed)&&r.complete()})))}))}function Cc(e,t){return t?function(n){return n.pipe(Cc((function(n,r){return _o(e(n,r)).pipe(Bo((function(e,i){return t(n,e,r,i)})))})))}:qt((function(t,n){var r=0,i=null,a=!1;t.subscribe(Wt(n,(function(t){i||(i=Wt(n,void 0,(function(){i=null,a&&n.complete()})),_o(e(t,r++)).subscribe(i))}),(function(){a=!0,!i&&n.complete()})))}))}function Ic(e){return function(t){return n=function(){var n=new Ht;return t.pipe(Sc((function(){return n}),{leading:!0,trailing:!0}),Cc((function(t,r){return Co(e(t,r)).pipe((i=function(){return n.next()},qt((function(e,t){try{e.subscribe(t)}finally{t.add(i)}}))));var i})))},new zt((function(e){_o(n()).subscribe(e)}));var n}}var Ec=We((function(e){return function(t){void 0===t&&(t=null),e(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=t}}));function Ac(e,t){var n=Tc(e)?{first:e}:"number"==typeof e?{each:e}:e,r=n.first,i=n.each,a=n.with,o=void 0===a?Oc:a,s=n.scheduler,u=void 0===s?null!=t?t:nn:s,c=n.meta,l=void 0===c?null:c;if(null==r&&null==i)throw new TypeError("No timeout provided.");return qt((function(e,t){var n,a,s=null,c=0,h=function(e){a=To(t,u,(function(){try{n.unsubscribe(),_o(o({meta:l,lastValue:s,seen:c})).subscribe(t)}catch(e){t.error(e)}}),e)};n=e.subscribe(Wt(t,(function(e){null==a||a.unsubscribe(),c++,t.next(s=e),i>0&&h(i)}),void 0,void 0,(function(){(null==a?void 0:a.closed)||null==a||a.unsubscribe(),s=null}))),!c&&h(null!=r?"number"==typeof r?r:+r-u.now():i)}))}function Oc(e){throw new Ec(e)}function Dc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Pc=function(e){(0,g.Z)(a,e);var n,i=Dc(a);function a(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;return(0,u.Z)(this,a),n=i.call(this,e),(0,l.Z)((0,_.Z)(n),"mHashHelper",new xc),(0,l.Z)((0,_.Z)(n),"mProductId",void 0),(0,l.Z)((0,_.Z)(n),"mProductIdChanged",!1),(0,l.Z)((0,_.Z)(n),"mIsBundled",void 0),(0,l.Z)((0,_.Z)(n),"mTemporaryUId",void 0),(0,l.Z)((0,_.Z)(n),"mPreconfiguredOptions",void 0),(0,l.Z)((0,_.Z)(n),"mEventBrokerSubscriptions",void 0),(0,l.Z)((0,_.Z)(n),"mSharedKeyOverwrite",{}),(0,l.Z)((0,_.Z)(n),"mFirstBuild",!0),(0,l.Z)((0,_.Z)(n),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(n),"mUpdateArticleEvent",new Ht),(0,l.Z)((0,_.Z)(n),"onConfigurableNodeReady",new ni(1)),(0,l.Z)((0,_.Z)(n),"mFuncLoaderPlaceHolder",void 0),(0,l.Z)((0,_.Z)(n),"mClippingPlane",void 0),(0,l.Z)((0,_.Z)(n),"mClippingPlaneUuid",void 0),(0,l.Z)((0,_.Z)(n),"mArticlesBusyStream",new ni),n.mName="Product Node",n.mProductId=null!=t?t:-1,n.mIsBundled=r,n.mPreconfiguredOptions=o,n.mEventBrokerSubscriptions=[],n}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"onAttached",value:function(e){var t=this;Ni((0,M.Z)(a.prototype),"onAttached",this).call(this,e);var n=P.sceneManager().createObject("configurable");n.setValue("name","Configurable"),n.setValue("object_lock",!0),this._attachChildAtIndex(n,0),this.mEventBrokerSubscriptions.push(P.messenger().listen(G.TypeRTTI,(function(e){t.mSharedKeyOverwrite[e.materialModelId]=e.sharedKey,t.dispatchMessageToComponents(e)}),String(this.getSceneObjectId()))),this.mArticlesBusyStream=new ni(1),this.mUpdateArticleEvent.pipe(Kt((function(e){return t.mArticlesBusyStream.next(!0),e})),Ic((function(e){var t=e.articleListManager,n=e.models;return Co(t.syncObjectModels(n))}))).subscribe({next:function(){t.mArticlesBusyStream.next(!1)},error:function(e){qe.qL.warn("Failed to update article (pipeline):",e),t.mArticlesBusyStream.next(!1)}})}},{key:"onDetached",value:function(e){Ni((0,M.Z)(a.prototype),"onDetached",this).call(this,e),this.mArticlesBusyStream&&(this.mArticlesBusyStream.complete(),delete this.mArticlesBusyStream),this.detachClippingPlaneFromComponent(),this.mEventBrokerSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mSubscriptions.splice(0).forEach((function(e){return e.subscription.unsubscribe()}))}},{key:"onBeforeParseChildren",value:function(){return!1}},{key:"onBeforeSerializeChildren",value:function(){return!1}},{key:"onBeforeParseCreate",value:function(e){return!("product"===e&&this.mIsBundled)}},{key:"addComponent",value:function(e){var t=Ni((0,M.Z)(a.prototype),"addComponent",this).call(this,e);if(t){var n;if("articleListManager"===e.getComponentName())n=e.onModelsChanged.subscribe(this.handleArticlesChanged.bind(this));void 0!==n&&this.mSubscriptions.push({name:e.getComponentName(),subscription:n})}return t}},{key:"removeComponent",value:function(e){var t=Ni((0,M.Z)(a.prototype),"removeComponent",this).call(this,e);if(t){var n=this.mSubscriptions.findIndex((function(t){return t.name===e}));n>=0&&this.mSubscriptions.splice(n,1).forEach((function(e){return e.subscription.unsubscribe()}))}return t}},{key:"serialize",value:function(e,t){var n=Object.assign(Ni((0,M.Z)(a.prototype),"serialize",this).call(this,e,t),{type:"product"});if(n.properties=Object.assign(n.properties,{product_id:this.mProductId}),this.shouldSerializeColliderData()){var r=o(this.getComponents(mc.TypeRTTI),1)[0];r&&(n.properties.collider=r.serialize())}return n}},{key:"proxySetValue",value:function(e,t,n){switch(e){case"product_id":return this.mProductId=Number(t),this.mProductIdChanged=!0,this.dispatchMessageToComponents(new Ie("product_id",this.mProductId)),!0;case"temporary_uid":return this.mTemporaryUId=t,!0;case"placeHolder":case"place_holder":return this.mFuncLoaderPlaceHolder=t,!0;case"clipping_plane":if(t)if("string"==typeof t)try{var r=JSON.parse(t);this.mClippingPlane=(new _c).setFromNormalAndCoplanarPoint((new Bi).fromArray(r.normal),(new Bi).fromArray(r.point))}catch(e){qe.qL.warn("Failed to parse the set clipping value:",t),delete this.mClippingPlane}else"function"==typeof t.clone&&(this.mClippingPlane=t.clone());else delete this.mClippingPlane;return!0;case"collider":if(!n)break;if(!P.settingsManager().getSettings().getSceneSettings().physics.enabled)break;var i="string"==typeof t?JSON.parse(t):t;return this.getChildrenDerivedTypeOf(Mc.TypeRTTI)[0].addColliderWithParsedData(i),!0}return Ni((0,M.Z)(a.prototype),"proxySetValue",this).call(this,e,t,n)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(a.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"product_id":return this.mProductId;case"temporary_uid":return this.mTemporaryUId;case"place_holder":case"placeHolderFunction":return this.mFuncLoaderPlaceHolder;case"clipping_plane":return this.mClippingPlane}return null}},{key:"isBundled",value:function(){return this.mIsBundled}},{key:"handleArticlesChanged",value:function(e){P.eventBus().dispatch(new Di(Ei.ProductArticlesChanged,e))}},{key:"_updateArticles",value:(n=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getComponent("articleListManager"),this.mUpdateArticleEvent.next({models:t.models,articleListManager:n}),e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_updateHierarchy",value:function(e){var t=this;try{qe.qL.print("Product node handle build ready!"),this.mHashHelper.newHash();var n=this.resolveSceneHierarchy(e.nodes);qe.qL.print("resolved hierarchy: ",n);var r={children:n=0===n.length?this.createDefaultNodes():this.checkForDefaultView(n)};this.findParentOfType(a.TypeRTTI)||(r.name="Product Node"),this.parse(r,this.mHashHelper.getHash(),!0);var i=this.getComponent("catalogueMeta").getCatalogueMeta();this.name=i.name;var o=this.getChildrenDerivedTypeOf(Mc.TypeRTTI)[0];if(this.mFirstBuild&&(this.mFirstBuild=!1,Object.keys(this.mSharedKeyOverwrite).forEach((function(e){var n=Number(e);o.notifyMaterialOverwrite(n,t.mSharedKeyOverwrite[n])}))),this.mPreconfiguredOptions&&o._setPreconfiguredOptions(this.mPreconfiguredOptions),o.setMeshList(e.batches),this.onConfigurableNodeReady.next(o),!P.sceneManager().getActiveView()){var s=this.getChildrenDerivedOfTypeName("ViewNode");s.length>0&&P.sceneManager().setActiveView(s[0])}}catch(e){qe.qL.error("Product node failed to read scene:",e)}}},{key:"resolveSceneHierarchy",value:function(e){var t=P.sceneManager().getPersistPool(),n=t.getNodeNamespace(this);return qe.qL.print("Product node namespace:",n),P.sceneManager().getPersistPool().getNewNodes(n).forEach((function(t){e.push(t.serialize(!1))})),(e=e.filter((function(e){return!t.isNodeDeleted(n,e.scene_object_id)}))).forEach((function(e){var r=t.isNodeMoved(n,e.scene_object_id);null!==r&&(e.parent_id=-1===r?null:r)})),this.generateHierarchy(e)}},{key:"generateHierarchy",value:function(e,t){var n=this,r=[];return e.forEach((function(i){(i.parent_id==t||!t&&i.parent_id===n.getSceneObjectId())&&(i.children=n.generateHierarchy(e,i.scene_object_id),r.push(i))})),r}},{key:"checkForDefaultView",value:function(e){var t=this,n=!1,r=[];for(e.forEach((function(e){return r.push(e)}));!n&&r.length>0;){var i=r.shift();"view"===i.type?n=!0:Array.isArray(i.children)&&i.children.forEach((function(e){return r.push(e)}))}if(!n){qe.qL.print("create default view");var a=-++x.e.ObjectIdCount,o={type:"view",name:"Default",scene_object_id:a,children:[]},s=[o];return e.forEach((function(e){"configurable"!==e.type&&(!(0,f.kE)(e.parent_id)||e.parent_id<0)?(e.parent_id=a,o.children.push(e),P.sceneManager().getPersistPool().setNodeMoved(t,e.scene_object_id,a)):s.push(e)})),s}return e}},{key:"createDefaultNodes",value:function(){return[{type:"view",name:"Default",children:[]}]}},{key:"detachClippingPlaneFromComponent",value:function(){this.mClippingPlaneUuid&&(this.getComponent("clippingController").removeClippingPlane(this.mClippingPlaneUuid),delete this.mClippingPlaneUuid)}},{key:"updatePlane",value:function(){if(this.mClippingPlane){var e=this.getComponent("clippingController");this.mClippingPlaneUuid||(this.mClippingPlaneUuid=e.addClippingPlane(new _c)),e.setClippingPlane(this.mClippingPlaneUuid,this.mClippingPlane)}else this.detachClippingPlaneFromComponent()}},{key:"onBeforeSceneUpdate",value:function(e){Ni((0,M.Z)(a.prototype),"onBeforeSceneUpdate",this).call(this,e),this.updatePlane()}},{key:"productId",get:function(){return this.mProductId}},{key:"awaitArticlesFinished",value:function(){return this.mArticlesBusyStream.pipe(Ac(7e3),Rc({count:1/0,delay:50}),Xt((function(e){return!e})),Bo((function(e){return!e})),sn(1),Ho())}},{key:"shouldSerializeColliderData",value:function(){var e=!this.findParentOfType(a.TypeRTTI),t=!!this.findParentOfTypeName("ReferenceProductNode");return!e&&!t&&this.getSceneObjectId()>=0}}]),a}(Ga);function Bc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Pc,"TypeRTTI",new k.r("ProductNode",Ga.TypeRTTI));var Fc=function(e){(0,g.Z)(n,e);var t=Bc(n);function n(){var e;(0,u.Z)(this,n);var r=!1;if((e=t.call(this,{name:"web-ar",enabled:!0,icon:'\n                <svg viewBox="0 0 72 36" width="72" height="36">\n                    <path d="M21 17L10 11L21 5L32 11L21 17L32 11V24L21 31V17V31L10 24V11L21 17Z" style="stroke:currentcolor;fill:none;stroke-width:2;stroke-linejoin:round;stroke-linecap:round;"/>\n                    <path d="M40 24L44 13Q45 11 46 13L50 24M42 20H48M53 24V12H58A1 1 0 0 1 58 18H53H55Q58 18 60 21L62 24" style="stroke:currentcolor;stroke-width:2;stroke-linejoin:round;stroke-linecap:round;fill:none;"/>\n                </svg>\n            '})).mSettings.isModuleEnabled("webar"))if(_i())r=!0;else if(Mi()){r=document.createElement("a").relList.supports("ar")||function(){if(/iP(hone|od|ad)/.test(navigator.platform)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||"0",10)]}return[0,0,0]}()[0]>=16}else wi()&&(r=!0);return e.setValue("enabled",r),e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(Ra);(0,l.Z)(Fc,"TypeRTTI",new k.r("WebArToolbarItemController",Ra.TypeRTTI));var Lc;__webpack_require__(7852),__webpack_require__(2087);function Nc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}!function(e){e[e.NoToneMapping=0]="NoToneMapping",e[e.LinearToneMapping=1]="LinearToneMapping",e[e.ReinhardToneMapping=2]="ReinhardToneMapping",e[e.Uncharted2ToneMapping=3]="Uncharted2ToneMapping",e[e.CineonToneMapping=4]="CineonToneMapping"}(Lc||(Lc={}));var jc=function(e){(0,g.Z)(n,e);var t=Nc(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"mTechnique",Qa.perspective),(0,l.Z)((0,_.Z)(r),"mFov",45),(0,l.Z)((0,_.Z)(r),"mPipeline",void 0),(0,l.Z)((0,_.Z)(r),"mToneMappingType",Lc[Lc.Uncharted2ToneMapping]),(0,l.Z)((0,_.Z)(r),"mToneMappingExposure",1),(0,l.Z)((0,_.Z)(r),"mToneMappingWhitePoint",1),r.mName="Camera Perspective",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"fov":return(0,f.kE)(t)&&(this.mFov=parseFloat(t),this.mNeedsUpdateProjectionMatrix=!0),!0;case"pipeline":return this.mPipeline=String(t),!0;case"tonemapping_type":this.mToneMappingType=String(t);break;case"tonemapping_exposure":(0,f.kE)(t)&&(this.mToneMappingExposure=parseFloat(t));break;case"tonemapping_whitepoint":(0,f.kE)(t)&&(this.mToneMappingWhitePoint=parseFloat(t));break;default:return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}}},{key:"proxyGetValue",value:function(e){switch(e){case"fov":return this.mFov;case"pipeline":return this.mPipeline;case"tonemapping_type":return this.mToneMappingType;case"tonemapping_exposure":return this.mToneMappingExposure;case"tonemapping_whitepoint":return this.mToneMappingWhitePoint;case"needs_update_projection_matrix":return this.mNeedsUpdateProjectionMatrix;default:return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}}},{key:"getGarbageHash",value:function(){return this.getType().getTypeName()}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"camera_perspective"});return t.properties=Object.assign(t.properties,{fov:this.mFov,pipeline:this.mPipeline,tonemapping_type:this.mToneMappingType,tonemapping_exposure:this.mToneMappingExposure,tonemapping_whitepoint:this.mToneMappingWhitePoint}),t}},{key:"getProjectionMatrix",value:function(){var e=P.renderer().getRenderEngine().getCanvas(),t=this.mNear,n=e.width/e.height,r=t*Math.tan(.5*At*this.mFov)/1,i=2*r,a=n*i,o=-.5*a;return(new Fi).makePerspective(o,o+a,r,r-i,t,this.mFar)}},{key:"fov",get:function(){return this.mFov},set:function(e){this.mFov=e}},{key:"updatePositionByAutoFocus",value:function(e){if(e===Qi.NONE)return!0;var t=P.renderer().getRenderEngine().getSceneBoundingBox();if(t.isEmpty())return!1;var n=new Bi,r=new Bi;t.getCenter(n),t.getSize(r);var i=r.x>r.z?r.x:r.z,a=r.z>r.y?r.z:r.y,o=r.x>r.y?r.x:r.y,s=a/2/Math.tan(Math.PI*this.fov/360),u=i/2/Math.tan(Math.PI*this.fov/360),c=o/2/Math.tan(Math.PI*this.fov/360),l=n.clone();switch(e){case Qi.BACK:l.add(new Bi(0,.5*r.y,-1.5*c));break;case Qi.LEFT:l.add(new Bi(-1.5*s,.5*r.y,0));break;case Qi.RIGHT:l.add(new Bi(1.5*s,.5*r.y,0));break;case Qi.TOP:l.add(new Bi(0,1.5*u,0));break;case Qi.BOTTOM:l.add(new Bi(0,-1.5*u,0));break;case Qi.FRONT:default:l.add(new Bi(0,.5*r.y,1.5*c))}return this.transform.position.copy(l),this.target.copy(n),this.updateMatrixLocal(),this.updateMatrixWorld(),this.mAutoFocusNeedsUpdate=!1,!0}}]),n}(ga);function zc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(jc,"TypeRTTI",new k.r("CameraEntityPerspective",ga.TypeRTTI));var Uc=function(e){(0,g.Z)(n,e);var t=zc(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"mColor",so.White()),(0,l.Z)((0,_.Z)(r),"mIntensity",1),(0,l.Z)((0,_.Z)(r),"mShadowBias",0),(0,l.Z)((0,_.Z)(r),"mShadowCameraNear",.1),(0,l.Z)((0,_.Z)(r),"mShadowCameraFar",500),r.mName="LightEntity",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getLightTechnique",value:function(){return this.lightTechnique}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"color":case"light_color":return this.mColor.set(t),!0;case"intensity":case"light_intensity":return this.mIntensity=t,!0;case"shadow_bias":return this.mShadowBias=t,!0;case"shadow_camera_near":return this.mShadowCameraNear=t,!0;case"shadow_camera_far":return this.mShadowCameraFar=t,!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"color":case"light_color":return this.mColor;case"intensity":case"light_intensity":return this.mIntensity;case"shadow_bias":return this.mShadowBias;case"shadow_camera_near":return this.mShadowCameraNear;case"shadow_camera_far":return this.mShadowCameraFar}return null}},{key:"onDraw",value:function(e,t){Ni((0,M.Z)(n.prototype),"onDraw",this).call(this,e,t),e.addLight(this)}},{key:"serialize",value:function(e){var t=Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e);return t.properties=Object.assign(t.properties,{light_color:this.mColor.getHexString(),light_intensity:this.mIntensity,shadow_bias:this.mShadowBias,shadow_camera_near:this.mShadowCameraNear,shadow_camera_far:this.mShadowCameraFar}),t}},{key:"color",get:function(){return this.mColor},set:function(e){this.mColor.copy(e)}},{key:"intensity",get:function(){return this.mIntensity},set:function(e){this.mIntensity=e}},{key:"shadowBias",get:function(){return this.mShadowBias},set:function(e){this.mShadowBias=e}},{key:"shadowCameraNear",get:function(){return this.mShadowCameraNear},set:function(e){this.mShadowCameraNear=e}},{key:"shadowCameraFar",get:function(){return this.mShadowCameraFar},set:function(e){this.mShadowCameraFar=e}}]),n}(Ki);function Vc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Uc,"TypeRTTI",new k.r("LightEntity",Ki.TypeRTTI));var Hc=function(e){(0,g.Z)(n,e);var t=Vc(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"lightTechnique",Ja.ambient),r.mName="LightEntityAmbient",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"serialize",value:function(e){return Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"ambientLight"})}}]),n}(Uc);function Gc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Hc,"TypeRTTI",new k.r("LightEntityAmbient",Uc.TypeRTTI));var qc=function(e){(0,g.Z)(n,e);var t=Gc(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"lightTechnique",Ja.directional),(0,l.Z)((0,_.Z)(r),"mTarget",Bi.Zero()),(0,l.Z)((0,_.Z)(r),"mSubscriptions",[]),r.mName="LightEntityDirectional",r.mSubscriptions.push(r.mTarget.onChange.subscribe((function(){r.markNeedsRenderUpdate()}))),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"target":return this.mTarget.copy(t),!0;case"target_x":return this.mTarget.x=parseFloat(t),!0;case"target_y":return this.mTarget.y=parseFloat(t),!0;case"target_z":return this.mTarget.z=parseFloat(t),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"target":return this.mTarget;case"target_x":return this.mTarget.x;case"target_y":return this.mTarget.y;case"target_z":return this.mTarget.z}return null}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"directionalLight"});return t.properties=Object.assign(t.properties,{target_x:this.mTarget.x,target_y:this.mTarget.y,target_z:this.mTarget.z}),t}},{key:"getGarbageHash",value:function(){return"".concat(this.getType().getTypeName(),"/").concat(this.mCastShadow)}},{key:"getGarbageTime",value:function(){return 500}},{key:"destroy",value:function(e,t){Ni((0,M.Z)(n.prototype),"destroy",this).call(this,e,t),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"target",get:function(){return this.mTarget},set:function(e){this.mTarget.copy(e),this.markNeedsRenderUpdate()}}]),n}(Uc);function Wc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(qc,"TypeRTTI",new k.r("LightEntityDirectional",Uc.TypeRTTI));var Yc=function(e){(0,g.Z)(n,e);var t=Wc(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"lightTechnique",Ja.hemisphere),(0,l.Z)((0,_.Z)(r),"mGroundColor",so.White()),r.mName="LightEntityHemisphere",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){return"light_groundColor"===e?(this.mGroundColor.set(t),!0):Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);return null!==t?t:"light_groundColor"===e?this.mGroundColor:null}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"hemisphereLight"});return t.properties=Object.assign(t.properties,{light_groundColor:this.mGroundColor.getHexString()}),t}},{key:"groundColor",get:function(){return this.mGroundColor},set:function(e){this.mGroundColor.copy(e)}}]),n}(Uc);function Kc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Yc,"TypeRTTI",new k.r("LightEntityHemisphere",Uc.TypeRTTI));var Xc=function(e){(0,g.Z)(n,e);var t=Kc(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"lightTechnique",Ja.point),(0,l.Z)((0,_.Z)(r),"mDistance",0),(0,l.Z)((0,_.Z)(r),"mDecay",1),r.mName="LightEntityPoint",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"light_distance":return this.mDistance=parseFloat(t),!0;case"light_decay":return this.mDecay=parseFloat(t),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"light_distance":case"radius":return this.mDistance;case"light_decay":return this.mDecay}return null}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"pointLight"});return t.properties=Object.assign(t.properties,{light_distance:this.mDistance,light_decay:this.mDecay}),t}},{key:"getGarbageHash",value:function(){return"".concat(this.getType().getTypeName(),"/").concat(this.mCastShadow)}},{key:"getGarbageTime",value:function(){return 500}},{key:"distance",get:function(){return this.mDistance},set:function(e){this.mDistance=e}},{key:"decay",get:function(){return this.mDecay},set:function(e){this.mDecay=e}}]),n}(Uc);function $c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Xc,"TypeRTTI",new k.r("LightEntityPoint",Uc.TypeRTTI));var Qc=function(e){(0,g.Z)(n,e);var t=$c(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"lightTechnique",Ja.spot),(0,l.Z)((0,_.Z)(r),"mDistance",0),(0,l.Z)((0,_.Z)(r),"mAngle",.1*Math.PI),(0,l.Z)((0,_.Z)(r),"mPenumbra",0),(0,l.Z)((0,_.Z)(r),"mDecay",1),(0,l.Z)((0,_.Z)(r),"mTarget",Bi.Zero()),r.mName="LightEntitySpot",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"light_distance":return this.mDistance=parseFloat(t),!0;case"light_angle":return this.mAngle=parseFloat(t),!0;case"light_penumbra":return this.mPenumbra=parseFloat(t),!0;case"light_decay":return this.mDecay=parseFloat(t),!0;case"target":return this.mTarget.copy(t),!0;case"target_x":return this.mTarget.x=parseFloat(t),!0;case"target_y":return this.mTarget.y=parseFloat(t),!0;case"target_z":return this.mTarget.z=parseFloat(t),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"light_distance":case"distance":return this.mDistance;case"light_angle":return this.mAngle;case"radius":return.5*((Number.isFinite(this.mDistance)&&this.mDistance>0?this.mDistance:1e3)*Math.tan(this.mAngle));case"light_penumbra":return this.mPenumbra;case"light_decay":return this.mDecay;case"target":return this.mTarget;case"target_x":return this.mTarget.x;case"target_y":return this.mTarget.y;case"target_z":return this.mTarget.z}return null}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"spotLight"});return t.properties=Object.assign(t.properties,{light_distance:this.mDistance,light_angle:this.mAngle,light_penumbra:this.mPenumbra,light_decay:this.mDecay,target_x:this.mTarget.x,target_y:this.mTarget.y,target_z:this.mTarget.z}),t}},{key:"getGarbageHash",value:function(){return"".concat(this.getType().getTypeName(),"/").concat(this.mCastShadow)}},{key:"getGarbageTime",value:function(){return 500}},{key:"distance",get:function(){return this.mDistance},set:function(e){this.mDistance=e}},{key:"angle",get:function(){return this.mAngle},set:function(e){this.mAngle=e}},{key:"decay",get:function(){return this.mDecay},set:function(e){this.mDecay=e}},{key:"penumbra",get:function(){return this.mPenumbra},set:function(e){this.mPenumbra=Math.min(1,Math.max(0,e))}},{key:"target",get:function(){return this.mTarget},set:function(e){this.mTarget.copy(e)}}]),n}(Uc);function Jc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(0,l.Z)(Qc,"TypeRTTI",new k.r("LightEntitySpot",Uc.TypeRTTI));var el=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,null,[{key:"convertToPbr",value:function(e){var t=this.getDefaultPBRMaterial();if(t.id=e.id,t.uuid=e.uuid,t.name=e.name,t.alpha_test=e.alpha_test,t.blending=e.blending,t.depth_test=e.depth_test,t.depth_write=e.depth_write,t.fog=e.fog,t.lights=e.lights,t.opacity=e.opacity,t.premultiplied_alpha=e.premultiplied_alpha,t.shading=e.shading,t.side=e.side,t.transparent=e.transparent,t.ssrl=e.ssrl,t.render_order=Math.min(no.MAX_RENDERINGGROUPS,e.render_order),t.camera_layer=e.camera_layer,t.resource_folder_id=e.resource_folder_id,t.properties_id=e.properties_id,t.force_shared=e.force_shared,"MeshBasicMaterial"===e.type||"MeshLambertMaterial"===e.type||"MeshPhongMaterial"===e.type||"MeshPhongMaterialExt"===e.type||"MeshToonMaterial"===e.type){var n=e;t.alpha_map=n.alpha_map,t.ao_map=n.ao_map,t.ao_map_intensity=n.ao_map_intensity,t.diffuse_color=n.color,t.environment_brdf_map=n.env_map,t.light_map=n.light_map,t.light_map_intensity=n.light_map_intensity,t.diffuse_map=n.map,t.sub_surface_configuration.index_of_refraction=n.refraction_ratio,t.specular_map=n.specular_map,t.use_specular_glossiness_workflow=!0}if("MeshLambertMaterial"===e.type){var r=e;t.emissive_color=r.emissive,t.emissive_map=r.emissive_map,t.emissive_intensity=r.emissive_map_intensity}if(e.type,"MeshStandardMaterial"===e.type||"MeshPhysicalMaterial"===e.type||"MeshPhysicalMaterialExt"===e.type){var i=e;t.alpha_map=i.alpha_map,t.ao_map=i.ao_map,t.ao_map_intensity=i.ao_map_intensity,t.diffuse_color=i.color,t.environment_brdf_map=i.env_map,t.environment_intensity=i.env_map_intensity,t.light_map=i.light_map,t.light_map_intensity=i.light_map_intensity,t.diffuse_map=i.map,t.sub_surface_configuration.index_of_refraction=i.refraction_ratio,t.emissive_color=i.emissive,t.emissive_map=i.emissive_map,t.emissive_intensity=i.emissive_map_intensity,void 0!==i.normal_map||null!==i.normal_map?(t.normal_map=i.normal_map,t.normal_map_scale=i.normal_scale):void 0===i.bump_map&&null===i.bump_map||(t.normal_map=i.bump_map,t.normal_map_scale=i.bump_scale),t.metalness=i.metalness,t.metalness_map=i.metalness_map,t.roughness=i.roughness,!i.metalness_map&&i.roughness_map&&(t.metalness_map=i.roughness_map),t.use_specular_glossiness_workflow=!1}if("MeshPhongMaterial"===e.type||"MeshPhongMaterialExt"===e.type){var a=e;t.emissive_color=a.emissive,t.emissive_map=a.emissive_map,t.emissive_intensity=a.emissive_map_intensity,void 0!==a.normal_map||null!==a.normal_map?(t.normal_map=a.normal_map,t.normal_map_scale=a.normal_scale):void 0===a.bump_map&&null===a.bump_map||(t.normal_map=a.bump_map,t.normal_map_scale=a.bump_scale),t.specular_color=a.specular}if("MeshPhongMaterialExt"===e.type){var o=e;t.environment_brdf_map_scale=o.env_map_scale}if("MeshPhysicalMaterial"===e.type||"MeshPhysicalMaterialExt"===e.type){var s=e;t.clear_coat_configuration.is_enabled=!0,t.clear_coat_configuration.intensity=s.clear_coat,t.clear_coat_configuration.roughness=s.clear_coat_roughness}if("MeshPhysicalMaterialExt"===e.type){var u=e;t.use_specular_glossiness_workflow=u.enable_specular_glossiness,t.specular_color=u.specular,t.specular_map=u.specular_map,t.micro_surface=u.glossiness,t.micro_surface_map=u.glossiness_map}return t}},{key:"getDefaultPBRMaterial",value:function(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jc(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({id:-1,uuid:"",name:"",type:"PbrMaterial",alpha_test:.4,blending:"NormalBlending",depth_test:!0,depth_write:!0,fog:!1,lights:!0,opacity:1,premultiplied_alpha:!1,shading:"SmoothShading",side:"FrontSide",transparent:!1,ssrl:0},this.getDefaultPBRMaterialProperties())}},{key:"getDefaultPBRMaterialProperties",value:function(){return{diffuse_color:so.White().getHex(),diffuse_map:null,use_alpha_from_diffuse_map:!1,alpha_map:null,normal_map:null,normal_map_scale:1,ambient_color:so.Black().getHex(),ao_map:null,ao_map_intensity:1,ao_map_impact_on_analytical_lights:0,direct_light_intensity:1,emissive_color:so.Black().getHex(),emissive_intensity:1,emissive_map:null,environment_intensity:1,environment_brdf_map:null,environment_brdf_map_scale:1,light_map:null,light_map_intensity:1,parallax_scale_bias:.05,reflection_color:so.White().getHex(),reflection_map:null,specular_color:so.White().getHex(),specular_map:null,specular_intensity:1,two_sided_lighting:!1,unlit:!1,reflectance_map:null,micro_surface:1,micro_surface_map:null,roughness:1,metalness:0,metalness_f0_factor:1,metalness_map:null,metallic_reflectance_color:so.White().getHex(),metallic_reflectance_map:null,use_specular_glossiness_workflow:!1,brdf_configuration:this.getDefaultPBRMaterialBRDFConfiguration(),detail_map_configuration:this.getDefaultPBRMaterialDetailMapConfiguration(),clear_coat_configuration:this.getDefaultPBRMaterialClearCoatConfiguration(),sheen_configuration:this.getDefaultPBRMaterialSheenConfiguration(),anisotropic_configuration:this.getDefaultPBRMaterialAnisotropicConfiguration(),sub_surface_configuration:this.getDefaultPBRMaterialSubSurfaceConfiguration(),iridescence_configuration:this.getDefaultPBRMaterialIridescenceConfiguration(),flags:this.getDefaultPBRMaterialFlagsConfiguration()}}},{key:"getDefaultPBRMaterialBRDFConfiguration",value:function(){return{use_energy_conservation:!0,specular_glossiness_input_energy_conservation:!0}}},{key:"getDefaultPBRMaterialDetailMapConfiguration",value:function(){return{is_enabled:!1,map:null,diffuse_blend_level:1,roughness_blend_level:1,bump_level:1,normal_blend_method:0}}},{key:"getDefaultPBRMaterialClearCoatConfiguration",value:function(){return{is_enabled:!1,intensity:1,roughness:0,index_of_refraction:1.5,map:null,use_roughness_from_main_map:!0,roughness_map:null,remap_f0_on_interface_change:!0,bump_map:null,is_tint_enabled:!1,tint_color:so.White().getHex(),tint_color_at_distance:1,tint_thickness:1,tint_map:null}}},{key:"getDefaultPBRMaterialSheenConfiguration",value:function(){return{is_enabled:!1,link_sheen_with_diffuse:!1,intensity:1,color:so.White().getHex(),map:null,use_roughness_from_main_map:!0,roughness:null,roughness_map:null,diffuse_scaling:!1}}},{key:"getDefaultPBRMaterialAnisotropicConfiguration",value:function(){return{is_enabled:!1,intensity:1,direction_x:1,direction_y:0,map:null}}},{key:"getDefaultPBRMaterialSubSurfaceConfiguration",value:function(){return{is_refraction_enabled:!1,is_translucency_enabled:!1,is_scattering_enabled:!1,scattering_diffusion_profile:null,refraction_intensity:1,translucency_intensity:1,use_diffuse_to_tint_refraction:!1,use_diffuse_to_tint_translucency:!1,thickness_map:null,index_of_refraction:1.5,volume_index_of_refraction:-1,link_refraction_with_transparency:!1,minimum_thickness:0,maximum_thickness:1,use_thickness_as_depth:!1,tint_color:so.White().getHex(),tint_color_at_distance:1,diffusion_distance:so.White().getHex(),use_mask_from_thickness_map:!1,translucency_intensity_map:null}}},{key:"getDefaultPBRMaterialIridescenceConfiguration",value:function(){return{is_enabled:!1,intensity:1,minimum_thickness:100,maximum_thickness:400,index_of_refraction:1.3,map:null,thickness_map:null}}},{key:"getDefaultPBRMaterialFlagsConfiguration",value:function(){return{use_alpha_fresnel:!1,use_alpha_from_diffuse_map:!1,use_ambient_in_gray_scale:!1,use_ambient_occlusion_from_metallic_map_red:!1,use_auto_micro_surface_from_reflectivity_map:!1,use_lightmap_as_shadowmap:!1,use_linear_alpha_fresnel:!1,use_metalness_from_metallic_map_blue:!1,use_micro_surface_from_reflectivity_map_alpha:!1,use_parallax:!1,use_parallax_occlusion:!1,use_horizon_occlusion:!0,use_radiance_occlusion:!0,use_radiance_over_alpha:!0,use_roughness_from_metallic_map_alpha:!0,use_roughness_from_metallic_map_green:!1,use_specular_anti_aliasing:!0,use_specular_over_alpha:!0,use_only_metallic_from_metallic_reflectance_map:!1,use_physical_light_falloff:!0}}}]),e}();__webpack_require__(3210);function tl(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=lo(e),r=Po(e),i=r.args,a=r.keys,o=new zt((function(e){var t=i.length;if(t)for(var n=new Array(t),r=t,o=t,s=function(t){var s=!1;_o(i[t]).subscribe(Wt(e,(function(e){s||(s=!0,o--),n[t]=e}),(function(){return r--}),void 0,(function(){r&&s||(o||e.next(a?No(a,n):n),e.complete())})))},u=0;u<t;u++)s(u);else e.complete()}));return n?o.pipe(Lo(n)):o}function nl(e,t,n){return void 0===n&&(n=1/0),at(t)?nl((function(n,r){return Bo((function(e,i){return t(n,e,r,i)}))(_o(e(n,r)))}),n):("number"==typeof t&&(n=t),qt((function(t,r){return function(e,t,n,r,i,a,o,s){var u=[],c=0,l=0,h=!1,f=function(){!h||u.length||c||t.complete()},p=function(e){return c<r?m(e):u.push(e)},m=function(e){a&&t.next(e),c++;var s=!1;_o(n(e,l++)).subscribe(Wt(t,(function(e){null==i||i(e),a?p(e):t.next(e)}),(function(){s=!0}),void 0,(function(){if(s)try{c--;for(var e=function(){var e=u.shift();o?To(t,o,(function(){return m(e)})):m(e)};u.length&&c<r;)e();f()}catch(e){t.error(e)}})))};return e.subscribe(Wt(t,p,(function(){h=!0,f()}))),function(){null==s||s()}}(t,r,e,n)})))}var rl=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mProductAttributeManager",void 0),this.mProductAttributeManager=t}var n,i;return(0,c.Z)(e,[{key:"onAttributeChanged",get:function(){return this.mProductAttributeManager.onAttributeChanged}},{key:"onAttributeUpdated",get:function(){return this.mProductAttributeManager.onAttributeUpdated}},{key:"getProduct",value:function(){return this.mProductAttributeManager._getProduct()}},{key:"onAttributeModerated",get:function(){return this.mProductAttributeManager.onAttributeModerated}},{key:"getMaterialGroupManager",value:function(){return this.mProductAttributeManager._getMaterialGroupManager()}},{key:"hasAttribute",value:function(e){this.mProductAttributeManager._hasAttribute(e)}},{key:"getRawAttributes",value:function(){return this.mProductAttributeManager._getRawAttributes()}},{key:"getAttributes",value:function(){return this.mProductAttributeManager._getAttributes()}},{key:"cloneAttributes",value:function(){return this.mProductAttributeManager._cloneAttributes()}},{key:"getAttribute",value:function(e){return this.mProductAttributeManager._getAttribute(e)}},{key:"getAttributeByName",value:function(e){return this.mProductAttributeManager._getAttributeByName(e)}},{key:"getAttributeControllers",value:function(){return this.mProductAttributeManager._getAttributeControllers()}},{key:"getAttributeController",value:function(e){return this.mProductAttributeManager._getAttributeController(e)}},{key:"getAttributeControllerByName",value:function(e){return this.mProductAttributeManager._getAttributeControllerByName(e)}},{key:"setValue",value:(i=t(r().mark((function e(t,n,i){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mProductAttributeManager._setValue(t,n,i);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"getValue",value:function(e){return this.mProductAttributeManager._getValue(e)}},{key:"getValueName",value:function(e){return this.mProductAttributeManager._getValueName(e)}},{key:"resetValue",value:function(e,t){this.mProductAttributeManager._resetValue(e,t)}},{key:"setValueByName",value:(n=t(r().mark((function e(t,n,i){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mProductAttributeManager._setValueByName(t,n,i);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"getValueByName",value:function(e){return this.mProductAttributeManager._getValueByName(e)}},{key:"setValueByKey",value:function(e,t,n){this.mProductAttributeManager._setValueByKey(e,t,n)}},{key:"getValueByKey",value:function(e){return this.mProductAttributeManager._getValueByKey(e)}},{key:"getValueNameByName",value:function(e){return this.mProductAttributeManager._getValueNameByName(e)}},{key:"resetValueByName",value:function(e,t){this.mProductAttributeManager._resetValueByName(e,t)}},{key:"resetAllValues",value:function(e){return this.mProductAttributeManager._resetAllValues(e)}},{key:"setVisibility",value:function(e,t,n){this.mProductAttributeManager._setVisibility(e,t,n)}},{key:"setVisibilityByName",value:function(e,t,n){this.mProductAttributeManager._setVisibilityByName(e,t,n)}},{key:"isVisible",value:function(e,t){return this.mProductAttributeManager._isVisible(e,t)}},{key:"buildQueryParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.mProductAttributeManager._buildQueryParams(e,t)}},{key:"serialize",value:function(e){return this.mProductAttributeManager._serialize(e)}},{key:"parse",value:function(e,t){this.mProductAttributeManager._parse(e,t)}},{key:"hashConfiguration",value:function(){return this.mProductAttributeManager._hashConfiguration()}}]),e}();__webpack_require__(8285);function il(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var al=function(e){(0,g.Z)(a,e);var n,i=il(a);function a(e,t){var n;return(0,u.Z)(this,a),n=i.call(this),(0,l.Z)((0,_.Z)(n),"mAttributeData",void 0),(0,l.Z)((0,_.Z)(n),"mAttributeManagerComp",void 0),(0,l.Z)((0,_.Z)(n),"middleware",null),n.mAttributeData=e,n.mAttributeManagerComp=t,Array.isArray(n.mAttributeData.attribute_values)||(n.mAttributeData.attribute_values=[]),n}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"destroy",value:function(){}},{key:"getAttributeType",value:function(){return this.mAttributeData.type}},{key:"resolveProductNode",value:function(){return this.mAttributeManagerComp.getParentObject()}},{key:"broadcastValueChange",value:function(e,t,n,r){var i=this.mAttributeManagerComp,a=this.resolveProductNode(),o=a.getValue("product_id"),s=a.getSceneObjectId(),u=a.getValue("object_uuid"),c=this.getAttribute();i.onAttributeChanged.next({attribute_type:this.getAttributeType(),attribute_id:c.id,attribute_name:c.name,attribute_value_id:e,attribute_value:t,attribute_value_name:this.getValueName(),attribute_slug:c.slug,rebuild:n,product_id:o,product_scene_id:s,product_uuid:u,user_data:r})}},{key:"broadcastAttributeUpdated",value:function(){this.mAttributeManagerComp.onAttributeUpdated.next({attribute:this.getAttribute(),attribute_id:this.mAttributeData.id,attribute_type:this.getAttributeType()})}},{key:"broadcastAttributeModerated",value:function(e){var t=this.mAttributeManagerComp,n=this.resolveProductNode(),r=n.getValue("product_id"),i=n.getSceneObjectId(),a=n.getValue("object_uuid");t.onAttributeModerated.next({attribute:this.getAttribute(),attribute_id:this.mAttributeData.id,attribute_type:this.getAttributeType(),product_id:r,product_scene_id:i,product_uuid:a,moderate_data:e})}},{key:"_getDefaultSetOptions",value:function(e){return Object.assign({emitEvent:!0,rebuild:!0},e||{})}},{key:"visibleOnFrame",get:function(){return!1!==this.mAttributeData.visible_on_frame}},{key:"setVisibility",value:function(e,t){this.mAttributeData.visible=!!this.visibleOnFrame&&e}},{key:"isVisible",value:function(e){return!!this.visibleOnFrame&&("boolean"==typeof this.mAttributeData.visible?this.mAttributeData.visible:0!==this.mAttributeData.visibility&&!1!==this.mAttributeData.visibility)}},{key:"isVisibleInQuote",value:function(){return!!this.visibleOnFrame&&2!==this.mAttributeData.visibility}},{key:"serialize",value:function(e){if(!(!0!==e.discard_hidden||this.isVisible()&&this.isVisibleInQuote()))return null;var t=this.getAttribute(),n={attribute_id:t.id,attribute_name:t.name,attribute_value:this.getValue(),attribute_value_name:this.getValueName()};return e.include_keys&&(n.attribute_value_key=this.getValueKey(),n.attribute_key=t.key),n}},{key:"compareValue",value:function(e){return e===this.getValueName()}},{key:"registerMiddleware",value:function(e){this.middleware?this.middleware.setNext(e):this.middleware=e}},{key:"setNextValue",value:(n=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.middleware){e.next=4;break}return e.next=3,this.middleware.execute(t);case 3:t=e.sent;case 4:return e.abrupt("return",this.setValue(t,n));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getValueKey",value:function(){}},{key:"getQueryParam",value:function(){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&!this.isVisible()?{}:!0===e?(0,l.Z)({},this.mAttributeData.id,this.getValueName()):{}}},{key:"broadcast",value:function(e){var t=this._getDefaultSetOptions(e);t.emitEvent&&this.broadcastValueChange(this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,this.getValue(),t.rebuild,t.userData)}},{key:"onMaterialUpdated",value:function(e){}},{key:"getMiddleware",value:function(){return this.middleware}}]),a}(x.e);function ol(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(al,"TypeRTTI",new k.r("AttributeController",x.e.TypeRTTI));var sl=function(e){(0,g.Z)(a,e);var n,i=ol(a);function a(e,t){var n;(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mValueMutations",{}),(0,l.Z)((0,_.Z)(n),"mValue",{value:""});var r=n.resolveValuable();if(r){Array.isArray(r.colors)||(r.colors=[]);var o=r.colors.findIndex((function(e){return!0===e.default}));o>=0&&n.setValue(r.colors[o].color)}return n}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"updateValues",value:function(){var e=this,t=this.resolveValuable();t&&t.colors.forEach((function(t){var n=e.resolveValueMutation(t.color);t.visible=n.visible})),this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,this.mAttributeData.selected_value_value=this.getValue()}},{key:"setValue",value:function(e,t){this.mValue.value=e,this.dispatchToRenderer(t).then((function(){}),(function(e){qe.qL.error(e)})),this.updateValues(),this.broadcast(t)}},{key:"setValueByKey",value:function(e,t){this.setValue(e,t)}},{key:"getValue",value:function(){return this.mValue}},{key:"getValueName",value:function(){var e=this,t=this.mValue.value,n=this.resolveValuable();if(n){n.colors=n.colors||[];var r=n.colors.find((function(t){return t.color===e.mValue.value}));r&&(t=r.name)}return t}},{key:"resetValue",value:function(e){this.mValue.value="",this.broadcast(e)}},{key:"resolveValuable",value:function(){if(this.mAttributeData&&this.mAttributeData.attribute_values.length>0)return this.mAttributeData.attribute_values[0].attribute_value_valuable}},{key:"parse",value:function(e,t){e&&(0,f.HD)(e.value)&&this.setValue(e.value,t)}},{key:"setVisibility",value:function(e,t){if(!this.visibleOnFrame)return Ni((0,M.Z)(a.prototype),"setVisibility",this).call(this,!1);if(t&&null!==t.color&&void 0!==t.color){var n=this.resolveValueMutation(t.color);n&&(n.visible=e)}else Ni((0,M.Z)(a.prototype),"setVisibility",this).call(this,e,t)}},{key:"resolveValueMutation",value:function(e){if(null!=e){if(!this.mValueMutations[e]){var t=this.mAttributeData.attribute_values[0].attribute_value_valuable.colors.find((function(t){return t.color===e}));t&&(this.mValueMutations[e]={visible:t.visible})}return this.mValueMutations[e]}}},{key:"dispatchToRenderer",value:(n=t(r().mark((function e(t){var n,i,a,o,s,u,c,l;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.resolveValuable()){e.next=3;break}return e.abrupt("return");case 3:Number.isSafeInteger(n.material_group_id)?(i=this.mAttributeManagerComp._getMaterialGroupManager(),a=(0,f.HH)(this.mValue.value)?this.mValue.value.substring(0,7):"",o=this.resolveProductNode(),i.setColorOverwrite(n.material_group_id,a,o.getSceneObjectId())):Number.isSafeInteger(n.material_id)&&(s=this.resolveProductNode(),u=tc.getManager(Qu.MaterialManager),c=(0,f.HH)(this.mValue.value)?this.mValue.value.substring(0,7):"",l=Number(n.material_id),u.setColorOverwrite(l,c,s.getSceneObjectId()));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),a}(al);(0,l.Z)(sl,"TypeRTTI",new k.r("AttributeColorController",al.TypeRTTI));var ul=__webpack_require__(2515),cl=__webpack_require__.n(ul);function ll(e,t){var n=new(cl())(e);return n.success?n.to(null!=t?t:"hex"):null}function hl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var fl=function(e){(0,g.Z)(a,e);var n,i=hl(a);function a(e,t){var n;return(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mValue",{value:"",output:""}),n}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"updateValues",value:function(){this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,this.mAttributeData.selected_value_value=this.getValue()}},{key:"setValue",value:function(e,t){var n;this.mValue.value=e,this.mValue.output=null!==(n=ll(e,this.mAttributeData.meta.output_color_format))&&void 0!==n?n:"",this.dispatchToRenderer(t).then((function(){}),(function(e){qe.qL.error(e)})),this.updateValues(),this.broadcast(t)}},{key:"setValueByKey",value:function(e,t){this.setValue(e,t)}},{key:"getValue",value:function(){return this.mValue}},{key:"getValueName",value:function(){return this.mValue.value}},{key:"resetValue",value:function(e){this.mValue.value="",this.broadcast(e)}},{key:"resolveValuable",value:function(){return this.mAttributeData&&this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].attribute_value_valuable:null}},{key:"parse",value:function(e,t){null!=e&&void 0!==e.value&&this.setValue(e.value,t)}},{key:"dispatchToRenderer",value:(n=t(r().mark((function e(t){var n,i,a,o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.resolveValuable()){e.next=3;break}return e.abrupt("return");case 3:if(Number.isSafeInteger(i.material_id)){e.next=5;break}return e.abrupt("return");case 5:a=this.resolveProductNode(),o=tc.getManager(Qu.MaterialManager),s=null!==(n=ll(this.mValue.value,"hex"))&&void 0!==n?n:"#FFFFFF",o.setColorOverwrite(i.material_id,s,a.getSceneObjectId());case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),a}(al);(0,l.Z)(fl,"TypeRTTI",new k.r("AttributeColorPickerController",al.TypeRTTI));__webpack_require__(6977);var pl=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,null,[{key:"Arctangent",value:function(e,t,n,r){var i=r-t,a=n-e,o=Math.atan2(i,a);return(o*=180/Math.PI)<0&&(o=360+o),o}},{key:"AngleTwoLines",value:function(e,t,n,r,i,a){var o=e-n,s=t-r,u=i-n,c=a-n,l=o*u+s*c,h=Math.sqrt(o*o+s*s)*Math.sqrt(u*u+c*c);return Math.acos(l/h)}},{key:"AngleOfTwoPoints",value:function(e,t,n,r){var i=n-e,a=r-t;return-Math.atan2(a,i)}},{key:"Clamp",value:function(e,t,n,r){return f.Ft.isNumeric(e)?e>n?n:e<t?t:e:r}},{key:"RotateBasedOnUpAxis",value:function(t,n){var r=new Bi(0,1,0).applyQuaternion(t),i=n.dot(r);if(Math.abs(i)>1-e.EPS)return t;var a=Math.acos(i),o=r.cross(n).normalize();return(new Pi).setFromAxisAngle(o,a).multiply(t)}},{key:"Vec2Cross",value:function(e,t){return e.x*t.y-e.y*t.x}},{key:"LineLineIntersection",value:function(e,t,n,r){var i=t.clone().sub(e),a=r.clone().sub(n),o=this.Vec2Cross(n.clone().sub(e),i),s=this.Vec2Cross(i,a);if(0==o&&0==s)return!!(e.equals(n)||e.equals(r)||t.equals(n)||t.equals(r))||!(n.x-e.x<0&&n.x-t.x<0&&r.x-e.x<0&&r.x-t.x<0&&n.y-e.y<0&&n.y-t.y<0&&r.y-e.y<0&&r.y-t.y<0);if(s===this.EPS)return!1;var u=o/s,c=this.Vec2Cross(n.clone().sub(e),a)/s;return c>=0&&c<=1&&u>=0&&u<=1}}]),e}();(0,l.Z)(pl,"EPS",1e-6);var ml=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mImageSource",null),(0,l.Z)(this,"mDefaultTexture",null),(0,l.Z)(this,"mDefaultTextureSet",!1),(0,l.Z)(this,"mDefaultTextureAssigned",!0),(0,l.Z)(this,"mImageRepeatType",void 0),(0,l.Z)(this,"mImageSizeType",void 0),(0,l.Z)(this,"mImageWidth",0),(0,l.Z)(this,"mImageHeight",0),(0,l.Z)(this,"mMaterialManager",void 0),(0,l.Z)(this,"mActiveMaterial",void 0),(0,l.Z)(this,"mTextureCanvas",void 0),this.mMaterialManager=t}var n,i,a;return(0,c.Z)(e,[{key:"update",value:(a=t(r().mark((function e(t,n,i){var a,s,u,c,l,h,f,p,m,d,v,y,g,b=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u=!1,c=[],l=i?i.getSceneObjectId():void 0,this.mActiveMaterial&&this.mActiveMaterial.handle&&-1!==this.mActiveMaterial.id&&this.mActiveMaterial.id!==t.material_id?(h=this.mActiveMaterial.handle,c.push(new Promise((function(e){b.mMaterialManager.resolveResource(h,(function(t){e(t)})).then((function(){}),(function(){e(null)}))})))):c.push(Promise.resolve(null)),this.mActiveMaterial={id:t.material_id,handle:this.mMaterialManager.makeResource(t.material_id,void 0,l)},c.push(new Promise((function(e){b.mMaterialManager.resolveResource(b.mActiveMaterial.handle,(function(t){e(t)})).then((function(){}),(function(){e(null)}))}))),e.next=9,Promise.all(c);case 9:if(f=e.sent,p=o(f,1),m=p[0],a=f[1],m&&(this.hasDiffuseMap(m)&&(s=m.getDiffuseMap(),m.setDiffuseMap(this.mDefaultTexture)),m.markDirty(),this.mDefaultTextureSet=!1,this.mDefaultTextureAssigned=!0,this.mDefaultTexture=null,u=!0),a){e.next=18;break}return this.mDefaultTextureSet=!1,this.mDefaultTexture=null,this.mDefaultTextureAssigned=!0,e.abrupt("return");case 18:if(this.mDefaultTextureSet||(this.mDefaultTextureSet=!0,this.hasDiffuseMap(a)&&(this.mDefaultTexture=a.getDiffuseMap())),u&&(this.hasDiffuseMap(a)&&a.setDiffuseMap(s),a.setTransparent(!0)),s||this.hasDiffuseMap(a)&&(s=a.getDiffuseMap()),d=void 0!==n.image_source&&null!==n.image_source?n.image_source:t.image_source,v=void 0!==n.repeat_type&&null!==n.repeat_type?n.repeat_type:t.repeat_type,y=void 0!==n.size&&null!==n.size?n.size:t.size_type,d){e.next=31;break}this.hasDiffuseMap(a)&&(a.setDiffuseMap(this.mDefaultTexture),this.mDefaultTextureAssigned=!0,delete this.mTextureCanvas),s=null,this.mImageRepeatType=void 0,this.mImageSizeType=void 0,e.next=44;break;case 31:if(null!==this.mImageSource&&this.mImageSource===d&&v===this.mImageRepeatType&&y===this.mImageSizeType){e.next=44;break}return this.mImageRepeatType=v,this.mImageSizeType=y,e.next=36,this.buildTexture(t,n,a,d);case 36:g=e.sent,s=g.texture,this.mImageWidth=g.width,this.mImageHeight=g.height,this.mDefaultTextureAssigned=!1,this.hasDiffuseMap(a)&&a.setDiffuseMap(s),a.setTransparent(!0),a.getOpacity()<pl.EPS&&a.setOpacity(1);case 44:this.mImageSource=d,this.recalculate(t,n,s,this.mImageWidth,this.mImageHeight),a.markDirty(),e.next=52;break;case 49:e.prev=49,e.t0=e.catch(0),a&&(this.hasDiffuseMap(a)&&(a.getDiffuseMap()&&this.mMaterialManager.getTextureManager().disposeTexture(a.getDiffuseMap()),a.setDiffuseMap(null)),a.setTransparent(!0),a.markDirty());case 52:case"end":return e.stop()}}),e,this,[[0,49]])}))),function(e,t,n){return a.apply(this,arguments)})},{key:"destroy",value:function(){this.mImageSource=null,this.mActiveMaterial&&this.mMaterialManager&&(this.mMaterialManager.disposeResource(this.mActiveMaterial.handle),delete this.mActiveMaterial)}},{key:"buildTexture",value:(i=t(r().mark((function t(n,i,a,o){var s=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){if(!a||!o)return r();var u=s.hasDiffuseMap(a)?a.getDiffuseMap():null;u&&s.mDefaultTexture&&u.getUniqueId()!==s.mDefaultTexture.getUniqueId()&&(s.mMaterialManager.getTextureManager().disposeTexture(u),u=null);var c=document.createElement("img");c.setAttribute("crossorigin","anonymous"),c.addEventListener("load",(function(){var r=document.createElement("canvas");r.setAttribute("crossorigin","anonymous"),r.style.display="none",document.body.appendChild(r);var a=void 0!==i.repeat_type&&null!==i.repeat_type?i.repeat_type:n.repeat_type,o="clamp"===a?e.TRANSPARENT_PIXELS:0;r.width=e.IMAGE_COPY_SIZE,r.height=e.IMAGE_COPY_SIZE,s.mTextureCanvas=r;var u=P.renderer().getRenderEngine().createTextureCanvas("image-upload:diffuse",r,!0,void 0,"clamp"===a?Ss.ClampToEdge:Ss.Repeat,"clamp"===a?Ss.ClampToEdge:Ss.Repeat,Zs.Nearest,Zs.Nearest,Zs.None,void 0,void 0,void 0,0);u.getContext().drawImage(c,o,o,r.width-2*o,r.height-2*o),u.markDirty(),t({texture:u,width:c.width,height:c.height})})),c.addEventListener("error",(function(e){qe.qL.error(e),r()})),c.src=o})));case 1:case"end":return t.stop()}}),t)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"recalculate",value:function(t,n,r,i,a){if(t&&n&&r){var o=t.ratio,s=void 0!==n.size&&null!==n.size?n.size:t.size_type,u=i||1,c=a||1,l=Array.isArray(n.offset)&&void 0!==n.offset[0]&&null!==n.offset[0]?n.offset[0]:t.offset_x,h=Array.isArray(n.offset)&&void 0!==n.offset[1]&&null!==n.offset[1]?n.offset[1]:t.offset_y,f=void 0!==n.rotation&&null!==n.rotation?n.rotation:t.rotation,p=void 0!==n.scale&&null!==n.scale?n.scale:t.scale,m=o,d=void 0!==n.repeat_type&&null!==n.repeat_type?n.repeat_type:t.repeat_type,v=1/e.IMAGE_COPY_SIZE,y="clamp"===d?e.TRANSPARENT_PIXELS:0,g=D.One(),b=(u>c?1:u/c)/m,M=(u>c?c/u:1)/1,k=1,_=1;switch(s){case"contain":var x=1,T=1;b>M?(x=1,T=M/b):(T=1,x=b/M),k=1/x,_=1/T;break;case"cover":var w=1,R=1;b<M?(w=1,R=M/b):(R=1,w=b/M),k=1/w,_=1/R}var Z=(1+v)/(1-v*(2*y));g.set(k/Z/p,_/Z/p);var S=new D(-l,h).multiplyScalar(.01).multiply(new D(k,_));r.setOffset(S),r.setCenter(new D(.5,.5).sub(S)),r.setRotation(-Pt(f)),r.setRepeat(g),r.updateMatrix(),r.markDirty()}}},{key:"hasDiffuseMap",value:function(e){return e instanceof Ms||e instanceof ss||(e instanceof as||e instanceof Cs||e instanceof ps)}},{key:"applyTexturesToModel",value:(n=t(r().mark((function e(t){var n,i,a,o,s,u,c,l,h;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mActiveMaterial&&!this.mDefaultTextureAssigned&&this.mTextureCanvas){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.mMaterialManager.resolveResource(this.mActiveMaterial.handle);case 4:if(n=e.sent,this.hasDiffuseMap(n)&&(i=n.getDiffuseMap()),i){e.next=8;break}return e.abrupt("return");case 8:a=this.mTextureCanvas,(o=document.createElement("canvas")).width=a.width,o.height=a.height,o.setAttribute("crossorigin","anonymous"),o.style.display="none",document.body.appendChild(o),(s=o.getContext("2d")).resetTransform(),s.clearRect(0,0,o.width,o.height),u=a.width/i.getRepeat().x,c=a.height/i.getRepeat().y,s.translate(.5*a.width,.5*a.height),s.rotate(-i.getRotation()),s.translate(-.5*a.width,-.5*a.height),l=(new D).copy(i.getOffset()).rotateAround(new D,-i.getRotation()),s.drawImage(a,0,0,a.width,a.height,.5*a.width-.5*u-l.x*a.width,.5*a.height-.5*c- -l.y*a.height,u,c),h=o.toDataURL("image/png"),"PbrMaterial"===t.type?t.diffuse_map=h:t.map=h,o.width=0,o.height=0,o.remove();case 30:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),e}();function dl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(ml,"TRANSPARENT_PIXELS",4),(0,l.Z)(ml,"IMAGE_COPY_SIZE",1024);var vl=function(e){(0,g.Z)(a,e);var n,i=dl(a);function a(e,t){var n;if((0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mValue",{image_source:"",offset:[0,0],ratio:1,repeat_type:"clamp",size:"contain",rotation:0,scale:1}),(0,l.Z)((0,_.Z)(n),"mImageUploadController",void 0),(0,l.Z)((0,_.Z)(n),"mImageUploadEvent",new Ht),Array.isArray(n.mAttributeData.attribute_values)&&n.mAttributeData.attribute_values.length>0){var r=o(n.mAttributeData.attribute_values,1)[0].attribute_value_valuable||{};n.mValue.image_source=r.image_source||n.mValue.image_source,n.mValue.ratio=Number.isSafeInteger(r.ratio)?r.ratio:n.mValue.ratio,n.mValue.size=r.size_type||n.mValue.size,n.mValue.repeat_type=r.repeat_type||n.mValue.repeat_type,Number.isSafeInteger(r.offset_x)&&Number.isSafeInteger(r.offset_y)&&(n.mValue.offset=[r.offset_x,r.offset_y]),n.mValue.rotation=Number.isSafeInteger(r.rotation)?r.rotation:n.mValue.rotation,n.mValue.scale=Number.isSafeInteger(r.scale)?r.scale:n.mValue.scale}return n}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"destroy",value:function(){this.mImageUploadEvent.unsubscribe(),this.mImageUploadController&&(this.mImageUploadController.destroy(),delete this.mImageUploadController)}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"broadcastAttributeUpdated",value:function(){this.updateValues(),this.dispatchToRenderer().then((function(){}),(function(e){qe.qL.error(e)})),Ni((0,M.Z)(a.prototype),"broadcastAttributeUpdated",this).call(this)}},{key:"updateValues",value:function(){if(Array.isArray(this.mAttributeData.attribute_values)&&this.mAttributeData.attribute_values.length>0){var e=o(this.mAttributeData.attribute_values,1)[0].attribute_value_valuable||{};Number.isSafeInteger(e.ratio)&&(this.mValue.ratio=e.ratio)}this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,this.mAttributeData.selected_value_value=this.getValue()}},{key:"setValue",value:function(e,t){"string"!=typeof e&&(this.mValue=Object.assign(this.mValue,e));var n="string"==typeof e?e:e.image_source;if((0,f.HD)(n)){var r=n.length;if(/@offset:(.*?);/.test(n)){var i,a=n.match(/@offset:(.*?);/);r=r>a.index?a.index:r;var o=a[1],s=null;try{s=JSON.parse(o)}catch(e){}Array.isArray(s)&&(null===(i=s)||void 0===i?void 0:i.length)>1&&(this.mValue.offset=[s[0],s[1]])}if(/@rotation:(.*?);/.test(n)){var u=n.match(/@rotation:(.*?);/),c=u[1];r=r>u.index?u.index:r;var l=parseInt(c,10);isNaN(l)||(this.mValue.rotation=l)}if(/@scale:(.*?);/.test(n)){var h=n.match(/@scale:(.*?);/),p=h[1];r=r>h.index?h.index:r;var m=parseFloat(p);isNaN(m)||(this.mValue.scale=m)}r>0&&(n=n.slice(0,r)),this.mValue.image_source=n.trim()}this.updateValues(),this.dispatchToRenderer(t).then((function(){}),(function(e){qe.qL.error(e)})),this.broadcast(t)}},{key:"setValueByKey",value:function(e,t){this.setValue(e,t)}},{key:"getValue",value:function(){return this.mValue}},{key:"getValueName",value:function(){var e=Array.isArray(this.mValue.offset)&&this.mValue.offset.length>1?"[".concat(this.mValue.offset.map((function(e){return Number(e).toFixed(2)})),"]"):"[0,0]",t=Number.isSafeInteger(this.mValue.rotation)?"".concat(this.mValue.rotation):"0",n=Number.isSafeInteger(this.mValue.scale)?"".concat(Number(this.mValue.scale).toFixed(2)):"0";return(0,f.HH)(this.mValue.image_source)?"".concat(this.mValue.image_source," @offset:").concat(e,"; @rotation:").concat(t,"; @scale:").concat(n,";"):""}},{key:"resetValue",value:function(e){this.mValue.image_source="",this.broadcast(e)}},{key:"resolveValuable",value:function(){return this.mAttributeData&&this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].attribute_value_valuable:null}},{key:"parse",value:function(e,t){e&&(0,f.HD)(e.image_source)&&this.setValue(e,t)}},{key:"onMaterialUpdated",value:function(e){var t=this.resolveValuable().material_id;e.materialModelId===t&&this.visibleOnFrame&&![0,3].includes(this.mAttributeData.visibility)&&this.mAttributeData.visible&&this.dispatchToRenderer().then((function(){}),(function(e){qe.qL.error(e)}))}},{key:"dispatchToRenderer",value:(n=t(r().mark((function e(t){var n,i,a=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.resolveValuable()){e.next=3;break}return e.abrupt("return");case 3:this.mImageUploadController||(i=tc.getManager(Qu.MaterialManager),this.mImageUploadController=new ml(i),this.mImageUploadEvent.pipe(Ic((function(){return Co(new Promise((function(e){var t=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(a.mValue));a.mImageUploadController.update(t,r,a.resolveProductNode()).then((function(){return e()}),(function(t){qe.qL.warn("Failed to update image upload:",t),e()}))})))}))).subscribe({next:function(){qe.qL.print("Image upload updated."),P.eventBus().dispatch(new Di(Ei.RequestFrame))},error:function(e){qe.qL.warn("Failed to update image upload (pipeline):",e)}})),this.mImageUploadEvent.next();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getResourceController",value:function(){return this.mImageUploadController}}]),a}(al);function yl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(vl,"TypeRTTI",new k.r("AttributeImageUploadController",al.TypeRTTI));var gl=function(e){(0,g.Z)(a,e);var n,i=yl(a);function a(e,t){var n;(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mStreamMaterialChanges",void 0);var r=n.mAttributeManagerComp._getMaterialGroupManager();return r&&(n.mStreamMaterialChanges=r.onMaterialChanged.subscribe((function(e){n.resolveMaterialGroupId()===e.id&&n.updateValues()}))),n}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"destroy",value:function(){this.mStreamMaterialChanges&&this.mStreamMaterialChanges.unsubscribe(),Ni((0,M.Z)(a.prototype),"destroy",this).call(this)}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"resolveMaterialGroupId",value:function(){if(this.mAttributeData&&this.mAttributeData.attribute_values.length>0){var e=this.mAttributeData.attribute_values[0].attribute_value_valuable;if(e&&Number.isSafeInteger(e.material_group_id))return e.material_group_id}return null}},{key:"updateValues",value:function(){var e=this.resolveMaterialGroupId();if(null!==e){var t=this.mAttributeManagerComp._getMaterialGroupManager();if(t)this.mAttributeData.attribute_values[0].attribute_value_valuable.material_group=t.getGroup(e)}this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,this.mAttributeData.selected_value_value=this.getValue()}},{key:"setValue",value:function(e,t){var n=this.mAttributeManagerComp._getMaterialGroupManager();if(n){var r=e;if(!Number.isSafeInteger(e)&&"string"==typeof e){var i=n.getGroup(this.resolveMaterialGroupId());if(Array.isArray(i.materials)){var a=e.toLowerCase(),o=i.materials.find((function(e){return"string"==typeof e.name&&e.name.toLowerCase()===a||"string"==typeof e.material_name&&e.material_name.toLowerCase()===a}));o&&(r=o.id)}}var s=t&&!0===t.emitEvent;n.setActiveMaterial(this.resolveMaterialGroupId(),r,s)}this.updateValues(),this.broadcast(t)}},{key:"broadcast",value:function(e){var t=this._getDefaultSetOptions(e);if(t.emitEvent){var n=this.mAttributeManagerComp._getMaterialGroupManager(),r=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,i=n?n.getActiveRefId(this.resolveMaterialGroupId()):null;this.broadcastValueChange(r,i,t.rebuild,t.userData)}}},{key:"setValueByKey",value:function(e,t){var n=this.mAttributeManagerComp._getMaterialGroupManager();if(n){qe.qL.print("Setting material group reference via key on group: ".concat(this.resolveMaterialGroupId()));var r=n.getGroup(this.resolveMaterialGroupId());if(Array.isArray(r.materials)){var i=e.toLowerCase(),a=r.materials.find((function(e){return"string"==typeof e.sku&&e.sku.toLowerCase()===i}));a&&this.setValue(a.id,t)}}}},{key:"getValue",value:function(){var e=this.mAttributeManagerComp._getMaterialGroupManager();return{material_id:e?e.getActiveRefId(this.resolveMaterialGroupId()):null}}},{key:"getValueName",value:function(){var e=this.mAttributeManagerComp._getMaterialGroupManager();if(!e)return null;var t=e.getActiveRefModel(this.resolveMaterialGroupId());return t?(0,f.HH)(t.name)?t.name:t.material_name:null}},{key:"getValueKey",value:function(){var e=this.mAttributeManagerComp._getMaterialGroupManager();if(e){var t=e.getGroup(this.resolveMaterialGroupId());if(Array.isArray(t.materials)){var n=this.getValue(),r=t.materials.find((function(e){return e.id===n.material_id}));if(r)return r.sku}}}},{key:"resetValue",value:function(e){var t=this.mAttributeManagerComp._getMaterialGroupManager();if(t){var n=e&&!0===e.emitEvent;t.resetActiveMaterial(this.resolveMaterialGroupId(),n)}this.broadcast(e)}},{key:"isVisibleInQuote",value:function(){if(!Ni((0,M.Z)(a.prototype),"isVisibleInQuote",this).call(this))return!1;var e=this.getValue(),t=this.mAttributeManagerComp._getMaterialGroupManager();if(t){var n=t.getGroup(this.resolveMaterialGroupId());if(n&&Array.isArray(n.materials)){var r=n.materials.find((function(t){return t.id===e.material_id}));if(r)return 2!=r.visible}}return!0}},{key:"setVisibility",value:function(e,t){if(!this.visibleOnFrame)return Ni((0,M.Z)(a.prototype),"setVisibility",this).call(this,!1);if(t&&Number.isSafeInteger(t.option_id)){var n=this.mAttributeManagerComp._getMaterialGroupManager();null!==this.resolveMaterialGroupId()&&Number.isSafeInteger(t.option_id)&&n.setMaterialVisibility(this.resolveMaterialGroupId(),t.option_id,e)}else Ni((0,M.Z)(a.prototype),"setVisibility",this).call(this,e,t)}},{key:"parse",value:function(e,t){e&&Number.isSafeInteger(e.material_id)&&this.setValue(e.material_id,t)}},{key:"dispatchToRenderer",value:(n=t(r().mark((function e(t){var n,i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.mAttributeManagerComp._getMaterialGroupManager()){e.next=3;break}return e.abrupt("return");case 3:i=this.resolveMaterialGroupId(),a=n.getActiveRefId(i),n.setActiveMaterial(i,a,t.emitEvent);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),a}(al);(0,l.Z)(gl,"TypeRTTI",new k.r("AttributeMatgroupController",al.TypeRTTI));var bl=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,[{key:"applyMinMax",value:function(e,t){return(0,f.kE)(e)?((0,f.kE)(t.min_value)&&(e=e<t.min_value?t.min_value:e),(0,f.kE)(t.max_value)&&(e=e>t.max_value?t.max_value:e),e):null}}]),e}();function Ml(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var kl=function(e){(0,g.Z)(n,e);var t=Ml(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"calculate",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(e))return null;var r=0;return e.every((function(e){if(!(0,f.kE)(e.value))return!1;var i=parseFloat(e.value);return n&&(i=t.applyMinMax(i,e)),r+=i,!0}))?r:null}}]),n}(bl);function _l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var xl=function(e){(0,g.Z)(n,e);var t=_l(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"calculate",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(e))return null;var r=null;return e.every((function(e){if(!(0,f.kE)(e.value))return!1;var i=parseFloat(e.value);return n&&(i=t.applyMinMax(i,e)),null===r?r=i:r*=i,!0}))?r:null}}]),n}(bl);function Tl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var wl=function(e){(0,g.Z)(n,e);var t=Tl(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"calculate",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(e))return null;var r=null;return e.every((function(e){if(!(0,f.kE)(e.value))return!1;var i=parseFloat(e.value);return n&&(i=t.applyMinMax(i,e)),null===r?r=i:0===i?r=0:r/=i,!0}))?r:null}}]),n}(bl);function Rl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Zl=function(e){(0,g.Z)(n,e);var t=Rl(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"calculate",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(e))return null;var r=null;return e.every((function(e){if(!(0,f.kE)(e.value))return!1;var i=parseFloat(e.value);return n&&(i=t.applyMinMax(i,e)),null===r?r=i:r-=i,!0}))?r:null}}]),n}(bl);function Sl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Cl=function(e){(0,g.Z)(n,e);var t=Sl(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"calculate",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(e))return null;var r=0;return e.every((function(e){if(!(0,f.kE)(e.value))return!1;var i=parseFloat(e.value);return n&&(i=t.applyMinMax(i,e)),r+=i,r*=r,!0}))?r:null}}]),n}(bl);function Il(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var El=function(e){(0,g.Z)(n,e);var t=Il(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,u.Z)(this,n),e=t.call(this),(0,l.Z)((0,_.Z)(e),"mUseDiameter",void 0),(0,l.Z)((0,_.Z)(e),"mHalfCircle",void 0),e.mUseDiameter=r,e.mHalfCircle=i,e}return(0,c.Z)(n,[{key:"calculate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(e)||0===e.length)return null;var n=e[0].value;if(!(0,f.kE)(n))return null;t&&(n=this.applyMinMax(n,e[0])),this.mUseDiameter&&(n*=.5);var r=n*n*3.14159265359;return this.mHalfCircle&&(r*=.5),r}}]),n}(bl);function Al(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ol=function(e){(0,g.Z)(n,e);var t=Al(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"calculate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(e)||e.length<3)return null;var n=e[0].value;if(!(0,f.kE)(n))return null;t&&(n=this.applyMinMax(n,e[0]));var r=e[1].value;if(!(0,f.kE)(r))return null;t&&(r=this.applyMinMax(r,e[1]));var i=e[2].value;return(0,f.kE)(i)?(t&&(i=this.applyMinMax(i,e[2])),i*(n+r)*.5):null}}]),n}(bl);function Dl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Pl=function(e){(0,g.Z)(n,e);var t=Dl(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"calculate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(e)||e.length<2)return null;var n=e[0].value;if(!(0,f.kE)(n))return null;t&&(n=this.applyMinMax(n,e[0]));var r=e[1].value;return(0,f.kE)(r)?(t&&(r=this.applyMinMax(r,e[1])),r*n*.5):null}}]),n}(bl);function Bl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Fl=function(e){(0,g.Z)(n,e);var t=Bl(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"calculate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(e)||e.length<3)return null;var n=e[0].value;if(!(0,f.kE)(n))return null;t&&(n=this.applyMinMax(n,e[0]));var r=e[1].value;if(!(0,f.kE)(r))return null;t&&(r=this.applyMinMax(r,e[1]));var i=e[2].value;return(0,f.kE)(i)?(t&&(i=this.applyMinMax(i,e[2])),.5*(n+r)*i):null}}]),n}(bl);function Ll(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Nl=function(e){(0,g.Z)(n,e);var t=Ll(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"calculate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(e)||e.length<3)return null;var n=e[0].value;if(!(0,f.kE)(n))return null;t&&(n=this.applyMinMax(n,e[0]));var r=e[1].value;if(!(0,f.kE)(r))return null;t&&(r=this.applyMinMax(r,e[1]));var i=e[2].value;return(0,f.kE)(i)?(t&&(i=this.applyMinMax(i,e[2])),n*i+(r-n)*i*.5):null}}]),n}(bl);function jl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var zl=function(e){(0,g.Z)(n,e);var t=jl(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"calculate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(e)||e.length<3)return null;var n=e[0].value;if(!(0,f.kE)(n))return null;t&&(n=this.applyMinMax(n,e[0]));var r=e[1].value;if(!(0,f.kE)(r))return null;t&&(r=this.applyMinMax(r,e[1]));var i=e[2].value;return(0,f.kE)(i)?(t&&(i=this.applyMinMax(i,e[2])),i*(n+r)):null}}]),n}(bl);function Ul(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Vl=function(e){(0,g.Z)(n,e);var t=Ul(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"calculate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!Array.isArray(e)||e.length<3)return null;var n=e[0].value;if(!(0,f.kE)(n))return null;t&&(n=this.applyMinMax(n,e[0]));var r=e[1].value;if(!(0,f.kE)(r))return null;t&&(r=this.applyMinMax(r,e[1]));var i=e[2].value;return(0,f.kE)(i)?(t&&(i=this.applyMinMax(i,e[2])),i*(n>r?n:r)):null}}]),n}(bl);function Hl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Gl=function(e){(0,g.Z)(a,e);var n,i=Hl(a);function a(e,t){var n;return(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mOperationController",null),(0,l.Z)((0,_.Z)(n),"mDefaultOperands",null),(0,l.Z)((0,_.Z)(n),"mValue",{operands:[],calculated_value:null}),n.updateValueOperands(),n}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"updateValueOperands",value:function(){this.mOperationController=null,this.mValue.operands=[];var e=this.mAttributeData.attribute_values;if(e.length>0){var t=e[0].attribute_value_valuable;Array.isArray(t.operands)&&(this.mDefaultOperands=JSON.parse(JSON.stringify(t.operands)),this.mValue.operands=t.operands,this.mValue.operands.forEach((function(e){(0,f.kE)(e.value)?e.value=parseFloat(e.value):e.value=null,(0,f.kE)(e.min_value)?e.min_value=parseFloat(e.min_value):e.min_value=null,(0,f.kE)(e.max_value)?e.max_value=parseFloat(e.max_value):e.max_value=null}))),(0,f.HH)(t.operation)&&this.createOperationController(t.operation)}this.updateCalculatedValue()}},{key:"createOperationController",value:function(e){if((0,f.HH)(e))switch(e){case"add":this.mOperationController=new kl;break;case"multiply":this.mOperationController=new xl;break;case"divide":this.mOperationController=new wl;break;case"subtract":this.mOperationController=new Zl;break;case"squared":this.mOperationController=new Cl;break;case"circle_area":this.mOperationController=new El(!1,!1);break;case"half_circle_area":this.mOperationController=new El(!1,!0);break;case"circle_area_d":this.mOperationController=new El(!0,!1);break;case"half_circle_area_d":this.mOperationController=new El(!0,!0);break;case"triangle_area":case"parallelogram_area":this.mOperationController=new Ol;break;case"right_triangle_area":case"symmetric_triangle_area":this.mOperationController=new Pl;break;case"trapezium_area":this.mOperationController=new Fl;break;case"rect_bevelled_long_area":case"rect_bevelled_short_area":this.mOperationController=new Nl;break;case"max_length_area":this.mOperationController=new Vl;break;case"composite_length_area":this.mOperationController=new zl}}},{key:"broadcastAttributeUpdated",value:function(){this.updateValueOperands(),Ni((0,M.Z)(a.prototype),"broadcastAttributeUpdated",this).call(this)}},{key:"updateCalculatedValue",value:function(){this.mValue.calculated_value=null,this.mOperationController&&(this.mValue.calculated_value=this.mOperationController.calculate(this.mValue.operands,!1))}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"updateValues",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,this.mAttributeData.selected_value_value=this.getValue(e)}},{key:"setValue",value:function(e,t){var n=this;e&&Object.keys(e).forEach((function(t){if((0,f.kE)(t)){var r=parseInt(t,10);(0,f.kE)(e[t].value)&&r<n.mValue.operands.length&&(n.mValue.operands[r].value=parseFloat(e[t].value))}})),this.updateCalculatedValue(),this.updateValues(!1),this.broadcast(t)}},{key:"setValueByKey",value:function(e,t){this.setValue(e,t)}},{key:"compareValue",value:function(e){return e==this.getValue().calculated_value}},{key:"getValue",value:function(){return(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.updateCalculatedValue(),this.mValue}},{key:"getValueName",value:function(){return this.updateCalculatedValue(),Number.isSafeInteger(this.mValue.calculated_value)?"".concat(this.mValue.calculated_value):""}},{key:"resetValue",value:function(e){this.mValue.calculated_value=null,Array.isArray(this.mDefaultOperands)?this.mValue.operands=JSON.parse(JSON.stringify(this.mDefaultOperands)):Array.isArray(this.mValue.operands)&&this.mValue.operands.forEach((function(e){e.value=null})),this.broadcast(e)}},{key:"parse",value:function(e,t){if(qe.qL.print("parsing operable with: ",e),e&&Array.isArray(e.operands)){var n={};e.operands.forEach((function(e,t){n[t]=e})),this.setValue(n,t)}}},{key:"dispatchToRenderer",value:(n=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}]),a}(al);function ql(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Gl,"TypeRTTI",new k.r("AttributeOperableNumbersInputController",al.TypeRTTI));var Wl=function(e){(0,g.Z)(a,e);var n,i=ql(a);function a(e,t){var n;return(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mValueMutations",{}),n.mAttributeData.attribute_values.sort((function(e,t){var n=e.attribute_value_valuable,r=t.attribute_value_valuable;return n.position-r.position})),n}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"resolveValueMutation",value:function(e){if(null!=e){if(!this.mValueMutations[e]){var t=this.mAttributeData.attribute_values.find((function(t){return t.id===e}));t&&(this.mValueMutations[e]={selected:!1,visible:0!==t.visibility,disabled:!0===t.disabled})}return this.mValueMutations[e]}}},{key:"updateValues",value:function(){var e=this;this.mAttributeData.attribute_values.forEach((function(t){var n=e.resolveValueMutation(t.id);t.visible=n.visible,t.disabled=n.disabled}));var t=this.getValue(),n=Number.isSafeInteger(t.attribute_value_id)?t.attribute_value_id:null;this.mAttributeData.selected_value_id=n,this.mAttributeData.selected_value_value=t}},{key:"setValue",value:function(e,t){var n=this,r=null;if((0,f.kE)(e))r="string"==typeof e?parseInt(e,10):e;else{var i="string"==typeof e?e.toLowerCase():e,a=this.mAttributeData.attribute_values.find((function(e){return"string"==typeof e.name&&e.name.toLowerCase()===i}));a&&(r=a.id)}Object.keys(this.mValueMutations).forEach((function(e){n.mValueMutations[e].selected=!1}));var o=this.resolveValueMutation(r);o?(o.selected=!0,this.updateValues(),this.broadcast(t)):qe.qL.warn("trying to select none existing value ".concat(r," in question@setValue"))}},{key:"broadcast",value:function(e){var t=this._getDefaultSetOptions(e);t.emitEvent&&this.broadcastValueChange(this.mAttributeData.selected_value_id,this.getValue(),t.rebuild,t.userData)}},{key:"setValueByKey",value:function(e,t){var n="string"==typeof e?e.toLowerCase():e,r=this.mAttributeData.attribute_values.find((function(e){return"string"==typeof e.key&&e.key.toLowerCase()===n}));r&&this.setValue(r.id,t)}},{key:"compareValue",value:function(e){return e==this.getValue().attribute_value_id}},{key:"getValue",value:function(){var e=this,t={attribute_value_id:null};if(Object.keys(this.mValueMutations).every((function(n){return!e.mValueMutations[n].selected||(t.attribute_value_id=parseInt(n,10),!1)})),null!==t.attribute_value_id)return t;var n=this.mAttributeData.attribute_values.find((function(e){return!0===e.default}));return n?{attribute_value_id:n.id}:this.mAttributeData.attribute_values.length>0?{attribute_value_id:this.mAttributeData.attribute_values[0].id}:{attribute_value_id:null}}},{key:"getValueName",value:function(){var e=this.getValue();if(!Number.isSafeInteger(e.attribute_value_id))return"";var t=this.mAttributeData.attribute_values.find((function(t){return t.id==e.attribute_value_id}));return t?t.name:""}},{key:"getValueKey",value:function(){var e=this.getValue(),t=this.mAttributeData.attribute_values.find((function(t){return t.id===e.attribute_value_id}));if(t)return t.key}},{key:"resetValue",value:function(e){var t=this,n=this._getDefaultSetOptions(e);Object.keys(this.mValueMutations).forEach((function(e){var r=!1!==t.mValueMutations[e].selected;t.mValueMutations[e].selected=!1,n.emitEvent&&r&&t.broadcastValueChange(parseInt(e,10),!1,n.rebuild,n.userData)}))}},{key:"isVisibleInQuote",value:function(){if(!Ni((0,M.Z)(a.prototype),"isVisibleInQuote",this).call(this))return!1;var e=this.getValue(),t=this.mAttributeData.attribute_values.find((function(t){return t.id===e.attribute_value_id}));return!t||2!==t.visibility}},{key:"setVisibility",value:function(e,t){if(!this.visibleOnFrame)return Ni((0,M.Z)(a.prototype),"setVisibility",this).call(this,!1);if(t&&Number.isSafeInteger(t.option_id)){var n=this.resolveValueMutation(t.option_id);n&&(n.visible=e)}else Ni((0,M.Z)(a.prototype),"setVisibility",this).call(this,e,t)}},{key:"setDisabled",value:function(e,t){if(t&&Number.isSafeInteger(t.option_id)){var n=this.resolveValueMutation(t.option_id);n&&(n.disabled=e)}}},{key:"getQueryParam",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getValue();if(!Number.isSafeInteger(t.attribute_value_id))return{};var n={};return e&&(!this.isVisible()||!1===this.resolveValueMutation(t.attribute_value_id).visible)||(n[this.mAttributeData.id]=t.attribute_value_id),n}},{key:"parse",value:function(e,t){e&&Number.isSafeInteger(e.attribute_value_id)&&this.setValue(e.attribute_value_id,t)}},{key:"dispatchToRenderer",value:(n=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}]),a}(al);function Yl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Wl,"TypeRTTI",new k.r("AttributeQuestionController",al.TypeRTTI));var Kl=function(e){(0,g.Z)(a,e);var n,i=Yl(a);function a(e,t){var n;return(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mValue",""),n}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"getAttribute",value:function(){return this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,this.mAttributeData.selected_value_value=this.getValue(),this.mAttributeData}},{key:"setValue",value:function(e,t){this.mValue=e,this.broadcast(t)}},{key:"setValueByKey",value:function(e,t){this.setValue(e,t)}},{key:"getValue",value:function(){return this.mValue}},{key:"getValueName",value:function(){return this.mValue}},{key:"resetValue",value:function(e){this.mValue="",this.broadcast(e)}},{key:"parse",value:function(e,t){}},{key:"serialize",value:function(e){return null}},{key:"dispatchToRenderer",value:(n=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}]),a}(al);(0,l.Z)(Kl,"TypeRTTI",new k.r("AttributeSeparatorController",al.TypeRTTI));__webpack_require__(189),__webpack_require__(1295);function Xl(e,t){return qt((function(n,r){var i=null,a=0,o=!1,s=function(){return o&&!i&&r.complete()};n.subscribe(Wt(r,(function(n){null==i||i.unsubscribe();var o=0,u=a++;_o(e(n,u)).subscribe(i=Wt(r,(function(e){return r.next(t?t(n,e,u,o++):e)}),(function(){i=null,s()})))}),(function(){o=!0,s()})))}))}function $l(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ql(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ql(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ql(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Jl=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mModels",{}),(0,l.Z)(this,"mPrintReadyFileLoaders",{}),(0,l.Z)(this,"mDependencyLoaders",{})}var n,i,a;return(0,c.Z)(e,[{key:"resetCache",value:function(){var e=this;Object.keys(this.mPrintReadyFileLoaders).forEach((function(t){e.mPrintReadyFileLoaders[t].error("disposed")})),this.mPrintReadyFileLoaders={},Object.keys(this.mDependencyLoaders).forEach((function(t){e.mDependencyLoaders[t].error("disposed")})),this.mDependencyLoaders={},this.mModels={}}},{key:"resolveModel",value:(a=t(r().mark((function e(t){var n,i,a=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f.Ft.isNumeric(t)){e.next=2;break}throw new Error("Requested id is not an integer: ".concat(t));case 2:if(!((n=t)in this.mModels)){e.next=5;break}return e.abrupt("return",this.mModels[n]);case 5:return i=Object.keys(this.mDependencyLoaders).map((function(e){return a.mDependencyLoaders[e].pipe(Vo((function(){return Io([])})))})),e.next=8,this.finishDependencies(i);case 8:return e.abrupt("return",this.getModelFromAPI(n));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"finishDependencies",value:(i=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.length>0&&tl(t).pipe(Bo((function(e){return e.every((function(e){return e}))}))).subscribe({next:function(t){e(t)},error:function(e){n(e)}}),e(!0)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"getModelFromAPI",value:(n=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if(t in n.mModels)return e(n.mModels[t]);t in n.mPrintReadyFileLoaders||(n.mPrintReadyFileLoaders[t]=new ni(1),ei.getInstance().get("".concat(Jr.E.apiUrl,"print-ready-file/").concat(t)).then((function(e){return n.mPrintReadyFileLoaders[t].next(v.getItem(e.data))}),(function(e){return n.mPrintReadyFileLoaders[t].error(e)}))),n.mPrintReadyFileLoaders[t].pipe(sn(1)).subscribe({next:function(r){n.mModels[t]=r,delete n.mPrintReadyFileLoaders[t],e(r)},error:function(e){delete n.mPrintReadyFileLoaders[t],r(e)}})})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"preloadCatalogue",value:function(e){var t=this;return this.mDependencyLoaders[e]||(this.mDependencyLoaders[e]=new ni(1),Ko.getInstance().resolveBootstrapData(e).pipe(sn(1)).subscribe({next:function(n){var r,i=n.getPrintReadyFiles(),a=$l(v.getItems(i));try{for(a.s();!(r=a.n()).done;){var o=r.value;t.mModels[o.id]=o}}catch(e){a.e(e)}finally{a.f()}t.mDependencyLoaders[e].next(!0)},error:function(n){t.mDependencyLoaders[e].error(n),delete t.mDependencyLoaders[e]}})),this.mDependencyLoaders[e]}}],[{key:"getInstance",value:function(){return e.sInstance||(e.sInstance=new e),e.sInstance}}]),e}();(0,l.Z)(Jl,"sInstance",null);var eh=function(){function e(t,n){(0,u.Z)(this,e),(0,l.Z)(this,"name",void 0),(0,l.Z)(this,"mediaId",void 0),(0,l.Z)(this,"settings",void 0),(0,l.Z)(this,"id",void 0),(0,l.Z)(this,"media",void 0),(0,l.Z)(this,"watermarkMedia",void 0),this.name=t,this.mediaId=n,this.settings=this.settingsDefaultValues()}var n,i;return(0,c.Z)(e,[{key:"getMedia",value:(i=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$s.getInstance().resolveModel(t));case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"settingsDefaultValues",value:function(){return{placeholders:!1,print_marks:!0,resolution:1024,dpi:300,output_format:"png"}}},{key:"hasWatermark",value:function(){return!!(this.settings&&this.settings.watermark&&this.settings.watermark.svg_element&&this.settings.watermark.media_id)}},{key:"loadWatermarkMedia",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMedia(this.settings.watermark.media_id);case 2:this.watermarkMedia=e.sent;case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}],[{key:"parse",value:function(t){var n,r,i=new e(t.name,t.media_id);(t.id&&(i.id=t.id),t.settings)&&(i.settings={placeholders:null!==(n=t.settings.placeholders)&&void 0!==n?n:i.settings.placeholders,print_marks:null!==(r=t.settings.print_marks)&&void 0!==r?r:i.settings.print_marks,resolution:t.settings.resolution||i.settings.resolution,dpi:t.settings.dpi||i.settings.dpi,output_format:t.settings.output_format||i.settings.output_format});return t.settings&&t.settings.watermark&&(i.settings.watermark=t.settings.watermark),i}},{key:"serialize",value:function(e){var t=e.settingsDefaultValues(),n={name:e.name,media_id:e.mediaId,settings:{placeholders:e.settings.placeholders,print_marks:e.settings.print_marks,resolution:e.settings.resolution||t.resolution,dpi:e.settings.dpi||t.dpi,output_format:e.settings.output_format||t.output_format}};return e.id&&(n.id=e.id),e.settings.watermark&&(n.settings.watermark=e.settings.watermark),n}}]),e}();function th(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var nh=function(e){(0,g.Z)(s,e);var n,i,a,o=th(s);function s(e,t){var n;return(0,u.Z)(this,s),n=o.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mTextureMediaId",void 0),(0,l.Z)((0,_.Z)(n),"mTextureResolver",void 0),(0,l.Z)((0,_.Z)(n),"mPrintReadyFileId",void 0),(0,l.Z)((0,_.Z)(n),"mDisposed",!1),(0,l.Z)((0,_.Z)(n),"mElementUpdatedSubscription",void 0),(0,l.Z)((0,_.Z)(n),"mPalletizationContexts",{}),n}return(0,c.Z)(s,[{key:"getType",value:function(){return s.TypeRTTI}},{key:"resolveSvgTextureController",value:(a=t(r().mark((function e(n){var i=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){var o,s,u,c,l;i.mTextureResolver&&i.mPrintReadyFileId!==n&&i.disposeSvgTexture(),i.mPrintReadyFileId=n,i.mTextureResolver||(i.mTextureResolver=new ni(1),Jl.getInstance().resolveModel(n).then(function(){var e=t(r().mark((function e(t){var n,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.mTextureResolver&&!i.mDisposed){e.next=2;break}throw new Error("Media is disposed before resolving!");case 2:return u=eh.parse(t),i.mTextureMediaId=t.media_id,n=i.mTextureMediaId,a=tc.getManager(Qu.TextureManager),o=a.makeResource(n,{forceShared:!0}),s=a.findResourceWithHandle(o),e.abrupt("return",a.resolveResource(o));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then(t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i.mTextureResolver&&!i.mDisposed){e.next=2;break}throw new Error("Media is disposed before resolving!");case 2:if(!(t=s.getController()).isTypeOf(lu.TypeRTTI)){e.next=6;break}return c=t,e.abrupt("return",i.resolvePrintReadyFile(c,u));case 6:i.mTextureResolver.error("Controller is not svg");case 7:case"end":return e.stop()}}),e)})))).then((function(){if(!i.mTextureResolver||i.mDisposed)throw new Error("Media is disposed before resolving!");i.mTextureResolver.next({handle:o,controller:c,printReadyFile:u})})).catch((function(e){qe.qL.error(e),i.mTextureResolver?i.mTextureResolver.error(e):a()}))),i.mTextureResolver.pipe(sn(1),Xt((function(e){return!!e.controller})),Xl((function(e){return e.controller.onTextureReady().pipe(Bo((function(){return e})),Vo((function(e){return ci(e)})))}))).subscribe({next:(l=t(r().mark((function t(n){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.printReadyFile){t.next=3;break}return t.next=3,i.resolvePrintReadyFileSettings(n.controller,n.printReadyFile);case 3:i.mElementUpdatedSubscription&&(i.mElementUpdatedSubscription.unsubscribe(),delete i.mElementUpdatedSubscription),i.mElementUpdatedSubscription=n.controller.onElementUpdated.subscribe({next:function(){i.dispatchToRenderer().then((function(){P.eventBus().dispatch(new Di(Ei.RequestFrame))}),(function(e){qe.qL.error(e)}))}}),e(n.controller);case 6:case"end":return t.stop()}}),t)}))),function(e){return l.apply(this,arguments)}),error:function(e){a(e)},complete:function(){i.mTextureResolver&&(i.mTextureResolver.unsubscribe(),delete i.mTextureResolver),i.mElementUpdatedSubscription&&(i.mElementUpdatedSubscription.unsubscribe(),delete i.mElementUpdatedSubscription),delete i.mPrintReadyFileId,i.mDisposed||i.dispatchToRenderer().then((function(){P.eventBus().dispatch(new Di(Ei.RequestFrame))}),(function(e){qe.qL.error(e)}))}})})));case 1:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"disposeSvgTexture",value:function(){this.mTextureResolver&&(this.mTextureResolver.pipe(sn(1)).subscribe({next:function(e){tc.getManager(Qu.TextureManager).disposeResource(e.handle)},error:function(){}}),this.mTextureResolver&&(this.mTextureResolver.unsubscribe(),delete this.mTextureResolver),delete this.mPrintReadyFileId)}},{key:"broadcastAttributeUpdated",value:function(e){this.updateValues();var t=null!=e?e:this._getDefaultSetOptions(),n=structuredClone(this.getValue());this.setValue(n,t),Ni((0,M.Z)(s.prototype),"broadcastAttributeUpdated",this).call(this)}},{key:"destroy",value:function(){this.mDisposed=!0,Ni((0,M.Z)(s.prototype),"destroy",this).call(this),this.disposeSvgTexture()}},{key:"onMaterialUpdated",value:function(e){}},{key:"resolvePrintReadyFile",value:(i=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.printReadyFileStore[n.id]){e.next=2;break}return e.abrupt("return");case 2:if(!n.hasWatermark()){e.next=6;break}if(n.watermarkMedia){e.next=6;break}return e.next=6,n.loadWatermarkMedia();case 6:t.printReadyFileStore[n.id]=n;case 7:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"resolvePrintReadyFileSettings",value:(n=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.settings){e.next=2;break}return e.abrupt("return");case 2:if(!n.hasWatermark()){e.next=5;break}return e.next=5,t.addWatermark(n.id,n.settings.watermark.svg_element);case 5:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"getMediaId",value:function(){return this.mTextureMediaId}},{key:"resolveValuable",value:function(){return this.mAttributeData&&this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].attribute_value_valuable:null}},{key:"getPalletizationContext",value:function(e){return this.mPalletizationContexts[e]}}]),s}(al);function rh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ih(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rh(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rh(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ah(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(nh,"TypeRTTI",new k.r("AttributeSvgController",al.TypeRTTI));var oh=function(e){(0,g.Z)(a,e);var n,i=ah(a);function a(e,t){var n;(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mValue",{name:"",attribute:"",key:"",media_id:null,print_ready_file_id:null,svg_element:null});var r=n.resolveValuable();if(r&&Array.isArray(r.attributes)&&r.attributes.length>0){var o=r.attributes.find((function(e){return f.Ft.isTrue(e.default)}));o?n.setValue(o.key):n.setValue(r.attributes[0].key)}return n}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"updateValues",value:function(){this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,this.mAttributeData.selected_value_value=this.getValue()}},{key:"setValue",value:function(e,t){if("string"==typeof e){var n=this.mAttributeData.attribute_values[0].attribute_value_valuable,r=n.attributes.find((function(t){return t.key===e}));r&&(this.mValue={key:r.key,media_id:n.media_id,print_ready_file_id:n.print_ready_file_id,svg_element:n.svg_element,name:r.name,attribute:r.attribute,value:r.value})}else this.mValue=ih(ih({},this.mValue),e);this.updateValues(),this.dispatchToRenderer(t).then((function(){}),(function(e){qe.qL.error(e)})),this.broadcast(t)}},{key:"setValueByKey",value:function(e,t){this.setValue(e,t)}},{key:"compareValue",value:function(e){return e==this.getValue().value}},{key:"getValue",value:function(){if(this.mAttributeData.attribute_values.length>0){var e=this.mAttributeData.attribute_values[0].attribute_value_valuable;e&&(this.mValue.media_id=e.media_id,this.mValue.print_ready_file_id=e.print_ready_file_id,this.mValue.svg_element=e.svg_element)}return this.mValue}},{key:"getValueName",value:function(){return this.getValue().name}},{key:"resetValue",value:function(e){this.mValue.name="",this.mValue.attribute="",this.mValue.key="",delete this.mValue.value,this.broadcast(e)}},{key:"setVisibility",value:function(e,t){if(!this.visibleOnFrame)return Ni((0,M.Z)(a.prototype),"setVisibility",this).call(this,!1);if(t&&null!==t.option_id&&void 0!==t.option_id)try{var n=this.mAttributeData.attribute_values[0].attribute_value_valuable.attributes.find((function(e){return e.key===t.option_id}));n&&(n.visible=e)}catch(e){qe.qL.print("failed to get svg valuable: ",e)}else Ni((0,M.Z)(a.prototype),"setVisibility",this).call(this,e,t)}},{key:"parse",value:function(e,t){null!=e&&this.setValue(e,t)}},{key:"resolveValuable",value:function(){return this.mAttributeData&&this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].attribute_value_valuable:null}},{key:"dispatchToRenderer",value:(n=t(r().mark((function e(t){var n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.resolveValuable()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.resolveSvgTextureController(n.print_ready_file_id);case 5:return i=e.sent,e.next=8,i.updateElement(n.svg_element,this.getValue());case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),a}(nh);function sh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function uh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sh(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sh(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ch(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(oh,"TypeRTTI",new k.r("AttributeSvgElementController",nh.TypeRTTI));var lh=function(e){(0,g.Z)(a,e);var n,i=ch(a);function a(e,t){var n;(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mValue",{name:"",media_id:null,print_ready_file_id:null,selected_element_id:null,elements:[]});var r=n.resolveValuable();if(r&&Array.isArray(r.attributes)&&r.attributes.length>0){var o=r.attributes.find((function(e){return f.Ft.isTrue(e.default)}));o?n.setValue(o.key):n.setValue(r.attributes[0].key)}return n}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"updateValues",value:function(){this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,this.mAttributeData.selected_value_value=this.getValue()}},{key:"setValue",value:function(e,t){if((0,f.HD)(e)){var n=this.mAttributeData.attribute_values[0].attribute_value_valuable,r=n.attributes.find((function(t){return t.key===e}));r&&(this.mValue={key:r.key,media_id:n.media_id,print_ready_file_id:n.print_ready_file_id,name:r.name,selected_element_id:r.selected_element_id})}else this.mValue=uh(uh({},this.mValue),e);this.updateValues(),this.dispatchToRenderer(t).then((function(){}),(function(e){qe.qL.error(e)})),this.broadcast(t)}},{key:"setValueByKey",value:function(e,t){this.setValue(e,t)}},{key:"compareValue",value:function(e){return e==this.getValue().value}},{key:"getValue",value:function(){if(this.mAttributeData.attribute_values.length>0){var e=this.mAttributeData.attribute_values[0].attribute_value_valuable;e&&(this.mValue.media_id=e.media_id,this.mValue.print_ready_file_id=e.print_ready_file_id,this.mValue.elements=e.attributes.map((function(e){return e.selected_element_id})))}return this.mValue}},{key:"getValueName",value:function(){return this.getValue().name}},{key:"resetValue",value:function(e){this.mValue.name="",delete this.mValue.selected_element_id,delete this.mValue.value,this.broadcast(e)}},{key:"setVisibility",value:function(e,t){if(!this.visibleOnFrame)return Ni((0,M.Z)(a.prototype),"setVisibility",this).call(this,!1);if(t&&Number.isSafeInteger(t.option_id))try{var n=this.mAttributeData.attribute_values[0].attribute_value_valuable.attributes.find((function(e){return e.key===t.option_id}));n&&(n.visible=e)}catch(e){qe.qL.print("failed to get svg valuable: ",e)}else Ni((0,M.Z)(a.prototype),"setVisibility",this).call(this,e,t)}},{key:"parse",value:function(e,t){e&&void 0!==e.value&&this.setValue(e.value,t)}},{key:"resolveValuable",value:function(){return this.mAttributeData&&this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].attribute_value_valuable:null}},{key:"dispatchToRenderer",value:(n=t(r().mark((function e(t){var n,i,a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.resolveValuable()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.resolveSvgTextureController(n.print_ready_file_id);case 5:return i=e.sent,a=this.getValue(),o=a.elements.reduce((function(e,t){return uh(uh({},e),{},(0,l.Z)({},t,t===a.selected_element_id))}),{}),e.next=10,i.updateVisibility(o);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),a}(nh);(0,l.Z)(lh,"TypeRTTI",new k.r("AttributeSvgElementSelectorController",nh.TypeRTTI));var hh={r:.2126,g:.7152,b:.0722};function fh(e){var t="#"===e[0]?e.substring(1):e;return 3===t.length?[parseInt(String(17*parseInt(t[0],16)),10),parseInt(String(17*parseInt(t[1],16)),10),parseInt(String(17*parseInt(t[2],16)),10)]:t.length>=6?[parseInt(String(parseInt(t[0]+t[1],16)),10),parseInt(String(parseInt(t[2]+t[3],16)),10),parseInt(String(parseInt(t[4]+t[5],16)),10)]:[0,0,0]}function ph(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:hh,i=Math.abs(t[0]-e[0]),a=Math.abs(t[1]-e[1]),o=Math.abs(t[2]-e[2]);return(r.r*i+r.g*a+r.b*o)/(255*(n=r).r+255*n.g+255*n.b)}var mh=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mNext",void 0)}var n;return(0,c.Z)(e,[{key:"setNext",value:function(e){return this.mNext=e,this}},{key:"handle",value:(n=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve(this.execute(t,n));case 2:if(!this.mNext){e.next=5;break}return e.next=5,this.mNext.handle(t,n);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}]),e}();function dh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var vh=function(e){(0,g.Z)(n,e);var t=dh(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"execute",value:function(e,t){var n=e.svgEngine.getRootGroup();n.getObjects().forEach((function(e){e.visible||n.remove(e)}))}}]),n}(mh);function yh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var gh=function(e){(0,g.Z)(n,e);var t=yh(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"execute",value:function(e,t){var n=this;e.svgEngine.getObjects().forEach((function(e){switch(t.transparency_mode){case"allow":break;case"ignore":n.removeInvisibleObject(e);break;default:n.makeObjectOpaque(e),n.removeInvisibleObject(e)}}))}},{key:"makeObjectOpaque",value:function(e){(e.element.opacity>0||e.element.fillOpacity>0)&&(e.element.opacity=1,void 0!==e.element.fillOpacity&&null!==e.element.fillOpacity&&(e.element.fillOpacity=1))}},{key:"removeInvisibleObject",value:function(e){(e.element.opacity<=0||e.element.fillOpacity<=0)&&(e.element.visible=!1)}}]),n}(mh);function bh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Mh=function(e){(0,g.Z)(n,e);var t=bh(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"execute",value:function(e,t){e.svgEngine.getObjects().forEach((function(e){if(!e.element.hasFill()||"linear"===e.element.fill.type||"radial"===e.element.fill.type){var t=e.element.fill.colorStops;if(t&&0!==t.length){var n=o(t.sort((function(e,t){return e.offset-t.offset})),1)[0];n&&(e.element.fill=n.color)}}}))}}]),n}(mh);function kh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var _h=function(e){(0,g.Z)(n,e);var t=kh(n);function n(e,r,i,a){var o;return(0,u.Z)(this,n),o=t.call(this,e,r,i),(0,l.Z)((0,_.Z)(o),"a",1),"string"==typeof e||e instanceof so||void 0===r?(0,b.Z)(o,o.set(e)):(0,b.Z)(o,o.setRGBA(e,r,i,a))}return(0,c.Z)(n,[{key:"w",get:function(){return this.a},set:function(e){this.a=e}},{key:"set",value:function(e){return e instanceof n?this.copy(e):e instanceof so?this.copyColor3(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.r=e,this.g=e,this.b=e,t&&(this.a=e),this}},{key:"setRGBA",value:function(e,t,n,r){return this.setRGB(e,t,n),this.a=r,this}},{key:"clone",value:function(){return new n(this.r,this.g,this.b,this.a)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this}},{key:"copyColor3",value:function(e){return Ni((0,M.Z)(n.prototype),"copy",this).call(this,e),this.a=1,this}},{key:"getStyle",value:function(){return"rgba(".concat(255*this.r|0,",").concat(255*this.g|0,",").concat(255*this.b|0,",").concat(this.a,")")}},{key:"setStyle",value:function(e){var t;if(t=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){var n,r=t[1],i=t[2];switch(r){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,this.a=Math.min(1,parseFloat(n.length>3?n[4]:"1.0")),this;if(n=/^\s*(\d+)%\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,this.a=Math.min(1,parseFloat(n.length>3?n[4]:"1.0")),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){var a=parseFloat(n[1])/360,o=parseInt(n[2],10)/100,s=parseInt(n[3],10)/100;return this.a=Math.min(1,parseFloat(n.length>3?n[4]:"1.0")),this.setHSL(a,o,s),this}}}else if(t=/^#([A-Fa-f\d]+)$/.exec(e)){var u=t[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this.a=1,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this.a=1,this;if(8===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this.a=parseInt(u.charAt(6)+u.charAt(7),16)/255,this}return this}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.r+=e.r,this.g+=e.g,this.b+=e.b,t&&(this.a+=e.a),this}},{key:"addColors",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,n&&(this.a=e.a+t.a),this}},{key:"addScalar",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.r+=e,this.g+=e,this.b+=e,t&&(this.a+=e),this}},{key:"sub",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),t&&(this.a=Math.max(0,this.a-e.a)),this}},{key:"multiply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.r*=e.r,this.g*=e.g,this.b*=e.b,t&&(this.a*=e.a),this}},{key:"multiplyScalar",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.r*=e,this.g*=e,this.b*=e,t&&(this.a*=e),this}},{key:"lerp",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,n&&(this.a+=(e.a-this.a)*t),this}},{key:"lerpAlpha",value:function(e,t,n){return this.a=e+(t-e)*n,this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this.a=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,e}},{key:"getAvg",value:function(){return(this.r+this.g+this.b+this.a)/4}}],[{key:"TransparentWhite",value:function(){return new n(1,1,1,0)}},{key:"TransparentBlack",value:function(){return new n(0,0,0,0)}}]),n}(so);function xh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Th=function(e){(0,g.Z)(n,e);var t=xh(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"execute",value:function(e,t){var n=this,r=e.svgEngine.getObjects(),i=new Map;r.forEach((function(e){if(e.element.type&&"group"!==e.element.type){var r=n.getColor(e,t);0!==r.length&&(i.has(r)?i.get(r).push(e):i.set(r,[e]))}})),e.palette=i}},{key:"getColor",value:function(e,t){if(!Array.isArray(e.element.colorProperties)||0===e.element.colorProperties.length)return"";if(e.element.hasFill()&&"string"!=typeof e.element.fill){if("linear"===e.element.fill.type||"radial"===e.element.fill.type){var n=e.element.fill.colorStops[0];return this.convertToHex(n.color,t)}return""}return this.convertToHex(e.element.fill,t)}},{key:"convertToHex",value:function(e,t){switch(t.transparency_mode){case"allow":case"ignore":return"".concat(new _h(e).getHexString());default:return"".concat(new so(e).getHexString())}}}]),n}(mh);function wh(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Rh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rh(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Rh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Zh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Sh=function(e){(0,g.Z)(n,e);var t=Zh(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mColorDistanceMethod","manhattan"),e}return(0,c.Z)(n,[{key:"execute",value:function(e,t){var n=e.palette,r=t.maxColors||1;if(!(n.size<=r)){for(var i=.01;n.size>r;){for(var a=Array.from(n.keys()),u=0;u<a.length;u++)if(n.has(a[u]))for(var c=0;c<a.length;c++)if(n.has(a[c])&&u!==c){var l=a[u],h=a[c],f=fh(l),p=fh(h);if(this.colorDistance(f,p)<=i){var m,d=n.get(h);n.delete(h),(m=n.get(l)).push.apply(m,s(d))}if(n.size<=r)break}i+=.005}var v,y=wh(n);try{var g=function(){var e=o(v.value,2),t=e[0];e[1].forEach((function(e){e.element.hasFill()&&(e.element.fill=t),e.element.hasStroke()&&(e.element.stroke=t)}))};for(y.s();!(v=y.n()).done;)g()}catch(e){y.e(e)}finally{y.f()}}}},{key:"colorDistance",value:function(e,t){return"euclidean"===this.mColorDistanceMethod?function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:hh,i=t[0]-e[0],a=t[1]-e[1],o=t[2]-e[2];return Math.sqrt((r.r*(i*i)+r.g*(a*a)+r.b*(o*o))/(65025*(n=r).r+65025*n.g+65025*n.b))}(e,t):ph(e,t)}}]),n}(mh);function Ch(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ih(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ih(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ih(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Eh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ah=function(e){(0,g.Z)(n,e);var t=Eh(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"execute",value:function(e,t){var n,r=this,i=e.palette,a=Ch(e.paletteOverride);try{var s=function(){var e=o(n.value,2),a=e[0],s=e[1];if(!s)return{v:void 0};var u=i.get(a);if(!u)return{v:void 0};u.forEach((function(e){var n=r.applyTransparentModeToColor(e,s,t);r.overrideColor(e.element,n.color,n.opacity)}))};for(a.s();!(n=a.n()).done;){var u=s();if("object"===(0,ui.Z)(u))return u.v}}catch(e){a.e(e)}finally{a.f()}}},{key:"overrideColor",value:function(e,t,n){var r=e.colorProperties;Array.isArray(r)&&r.length>0?(r.forEach((function(n){f.Ft.isNonEmptyString(e[n])&&(e[n]=t)})),e.clipPath&&this.overrideColor(e.clipPath,t,n)):e.hasFill()&&(e.fill=t),e.opacity=n,e.fillOpacity=n}},{key:"applyTransparentModeToColor",value:function(e,t,n){var r=t,i=1;switch(n.transparency_mode){case"allow":9===r.length&&(i=parseInt(r.charAt(7)+r.charAt(8),16)/255),r=r.slice(0,7);break;case"ignore":r=r.slice(0,7),i=void 0!==e.element.fillOpacity&&null!==e.element.fillOpacity?e.element.fillOpacity:void 0!==e.element.opacity&&null!==e.element.opacity?e.element.opacity:1;break;default:r=r.slice(0,7),i=1}return{color:r,opacity:i}}}]),n}(mh);function Oh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Dh=function(e){(0,g.Z)(n,e);var t=Oh(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"execute",value:function(e,t){var n=this;e.svgEngine.getObjects().forEach((function(e){n.fixColor(e.element,t)}))}},{key:"fixColor",value:function(e,t){if(Array.isArray(e.colorProperties)&&0!==e.colorProperties.length)if(!e.hasFill()||"string"==typeof e.fill||"linear"!==e.fill.type&&"radial"!==e.fill.type){e.clipPath&&this.fixColor(e.clipPath,t);var n=this.convertToHex(e,e.fill,t);f.Ft.isNonEmptyString(n)&&(e.hasFill()&&(e.fill=n),e.hasStroke()&&(e.stroke=n)),f.Ft.isNonEmptyString(e.fillRule)&&(e.fillRule="nonzero")}else{var r=e.fill.colorStops[0],i=this.convertToHex(e,r.color,t);f.Ft.isNonEmptyString(i)&&(r.color=i)}}},{key:"convertToHex",value:function(e,t,n){if(t){if("currentColor"===t)return e.group?this.convertToHex(e.group,e.group.fill,n):"#000000";switch(n.transparency_mode){case"allow":case"ignore":return"".concat(new _h(t).getHexString());default:return"".concat(new so(t).getHexString())}}}}]),n}(mh);function Ph(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Bh=function(e){(0,g.Z)(n,e);var t=Ph(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"execute",value:function(e,t){var n=this;e.svgEngine.getObjects().forEach((function(e){n.removeShadows(e)}))}},{key:"removeShadows",value:function(e){e.element.shadow&&(e.element.shadow=null)}}]),n}(mh);function Fh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Lh=function(e){(0,g.Z)(n,e);var t=Fh(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"execute",value:function(e,t){}}]),n}(mh);function Nh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var jh=function(e){(0,g.Z)(n,e);var t=Nh(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"execute",value:function(e,t){}}]),n}(mh);function zh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Uh=function(e){(0,g.Z)(n,e);var t=zh(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"renderResolution",1024),e}return(0,c.Z)(n,[{key:"execute",value:function(e,t){var n=this,r=e.svgEngine.getSvgCanvas(),i=e.svgEngine.getRootGroup(),a=e.svgEngine.getObjects();this.makeNumberSafe(r,"width",this.renderResolution),this.makeNumberSafe(r,"height",this.renderResolution),this.makeNumberSafe(i,"width",r.width),this.makeNumberSafe(i,"height",r.height),i.width<=0&&(i.width=r.width),i.height<=0&&(i.height=r.height),this.makeObjectSafe(i),a.forEach((function(e){n.makeObjectSafe(e.element)}))}},{key:"makeNumberSafe",value:function(e,t,n){e&&void 0!==e[t]&&Number.isNaN(e[t])&&(e[t]=n)}},{key:"makeObjectSafe",value:function(e){var t=this;e&&(this.makeNumberSafe(e,"width",this.renderResolution),this.makeNumberSafe(e,"height",this.renderResolution),this.makeNumberSafe(e,"zoomX",1),this.makeNumberSafe(e,"zoomY",1),this.makeNumberSafe(e,"scaleX",1),this.makeNumberSafe(e,"scaleY",1),this.makeNumberSafe(e,"top",0),this.makeNumberSafe(e,"left",0),e.lineCoords&&Object.keys(e.lineCoords).forEach((function(n){void 0!==e.lineCoords[n].x&&t.makeNumberSafe(e.lineCoords[n],"x",0),void 0!==e.lineCoords[n].y&&t.makeNumberSafe(e.lineCoords[n],"y",0)})),e.aCoords&&Object.keys(e.aCoords).forEach((function(n){void 0!==e.aCoords[n].x&&t.makeNumberSafe(e.aCoords[n],"x",0),void 0!==e.aCoords[n].y&&t.makeNumberSafe(e.aCoords[n],"y",0)})),e.clipPath&&this.makeObjectSafe(e.clipPath))}}]),n}(mh);__webpack_require__(6755);function Vh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Hh=function(e){(0,g.Z)(n,e);var t=Vh(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"execute",value:function(e,t){var n=this;e.svgEngine.getObjects().forEach((function(e){n.removeImage(e.element)}))}},{key:"hasImage",value:function(e){return!(!e||"string"!=typeof e)&&(e.startsWith("http")||e.substring(0,50).includes("base64,"))}},{key:"removeImage",value:function(e){var t=this;if(e){if(Array.isArray(e.colorProperties)&&0===e.colorProperties.length?e.colorProperties.forEach((function(n){t.hasImage(e[n])&&delete e[n]})):e.hasFill()&&this.hasImage(e.fill)&&delete e.fill,e.hasFill()&&"string"!=typeof e.fill&&("linear"===e.fill.type||"radial"===e.fill.type)){var n=e.fill.colorStops;Array.isArray(n)&&n.forEach((function(e){t.hasImage(e.color)&&delete e.color}))}"image"===e.type&&this.hasImage(e.getSrc())&&e.setSrc(""),e.clipPath&&this.removeImage(e.clipPath)}}}]),n}(mh),Gh=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mOptimizeHandler",void 0),(0,l.Z)(this,"mAnalyzeHandler",void 0),(0,l.Z)(this,"mPalletizeHandler",void 0),this.mOptimizeHandler=this.setHandlers([new Uh,new Hh,new gh,new vh,new Dh,new Mh,new Bh,new Lh,new jh]),this.mAnalyzeHandler=this.setHandlers([new Th,new Sh]),this.mPalletizeHandler=this.setHandlers([new Ah])}var n,i,a;return(0,c.Z)(e,[{key:"optimize",value:(a=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mOptimizeHandler.handle(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"analyze",value:(i=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mAnalyzeHandler.handle(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"palletize",value:(n=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mPalletizeHandler.handle(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"setHandlers",value:function(e){for(var t=1;t<e.length;t++)e[t-1].setNext(e[t]);return e[0]}}]),e}(),qh=function(){function e(t){if((0,u.Z)(this,e),(0,l.Z)(this,"mOptions",void 0),(0,l.Z)(this,"mEngine",void 0),this.mOptions=t,1===this.mOptions.version)this.mEngine=new Gh;else qe.qL.warn("Version is not provided to svg palletization. Using latest version instead."),this.mEngine=new Gh}var n,i,a;return(0,c.Z)(e,[{key:"optimize",value:(a=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mEngine.optimize(t,this.mOptions);case 2:t.optimized=!0;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"analyze",value:(i=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mEngine.analyze(t,this.mOptions);case 2:t.analyzed=!0;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"palletize",value:(n=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mEngine.palletize(t,this.mOptions);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"render",value:function(e){return e.svgEngine.getRootGroup().dirty=!0,e.svgEngine.getObjects().forEach((function(e){e.element.dirty=!0})),e.svgEngine.render(),e.canvas}}],[{key:"create",value:function(){var e=t(r().mark((function e(t,n,i){var a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new ou,e.next=3,a.create(t,n,i);case 3:return o=e.sent,e.abrupt("return",{svgEngine:a,canvas:o.canvas,palette:new Map,paletteOverride:new Map,optimized:!1,analyzed:!1});case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"destroy",value:function(e){e&&(e.svgEngine&&(e.svgEngine.destroy(),delete e.svgEngine),e.canvas&&delete e.canvas,e.palette&&(e.palette.clear(),delete e.palette),e.paletteOverride&&(e.paletteOverride.clear(),delete e.paletteOverride),e.optimized=!1,e.analyzed=!1)}}]),e}(),Wh={sanitizeColors:function(e){for(var t=0;t<e.palletization_colors.length;t++){var n=e.palletization_colors[t].color;switch("#"!==n[0]&&(n="#".concat(n)),e.palletization_transparency_mode){case"ignore":case"allow":break;default:n=n.slice(0,7)}e.palletization_colors[t].color=n}},createTexture:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,n=document.createElement("canvas");return n.width=t,n.height=t,n.style.display="none",document.body.appendChild(n),P.renderer().getRenderEngine().createTextureCanvas(e,n,!0,void 0,void 0,void 0,void 0,void 0,void 0,!1,xs.RGBA,void 0,4)},clearPalettes:function(e){e.palette=[],e.palette_override=[]},applyPalletization:function(e,n,i,a,o,s){var u=this;return t(r().mark((function t(){var c,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=new qh({version:o.version,maxColors:a.palletization_max_colors||1,transparency_mode:o.transparency_mode}),e){t.next=6;break}return 1024,t.next=5,qh.create(i,1024,n);case 5:e=t.sent;case 6:if(e.optimized){t.next=9;break}return t.next=9,c.optimize(e);case 9:if(e.analyzed){t.next=13;break}return t.next=12,c.analyze(e);case 12:s.palette=Array.from(e.palette.keys());case 13:if(s.palette&&s.palette.length>0)for(o.allowed_colors=o.allowed_colors.filter((function(e){return e.visible})),u.applyPalletizationOverrides(s,o),e.paletteOverride.clear(),l=0;l<s.palette.length;l++)e.paletteOverride.set(s.palette[l],s.palette_override[l]);if(!(e.optimized&&e.analyzed&&e.palette&&e.palette.size>0&&e.paletteOverride&&e.paletteOverride.size>0)){t.next=17;break}return t.next=17,c.palletize(e);case 17:return t.abrupt("return",{context:e,render:c.render(e)});case 18:case"end":return t.stop()}}),t)})))()},applyPalletizationOverrides:function(e,t){for(var n,r=(null===(n=t.allowed_colors[0])||void 0===n?void 0:n.color)||"#ffffff",i=function(n){if(!e.palette_override[n])return"continue";var r=t.allowed_colors.find((function(t){return t.color===e.palette_override[n]}));r&&r.visible||(e.palette_override[n]=null)},a=0;a<e.palette.length;a++)i(a);if(e.palette.length!==e.palette_override.filter((function(e){return!!e})).length){for(var s=new Map,u=function(){var n,i,a,u,l=fh(e.palette[c]),h={index:c,locked:!1,selectedIndex:0,palette:[]};t.allowed_colors.forEach((function(e,t){h.palette.push({index:t,distance:ph(fh(e.color),l),color:e.color,visible:e.visible})})),h.palette.sort((function(e,t){return e.distance-t.distance}));var f=o(h.palette.filter((function(e){return e.visible})),1)[0];h.locked=(null!==(n=null==f?void 0:f.distance)&&void 0!==n?n:1/0)<=.05,h.selectedIndex=null!==(i=null==f?void 0:f.index)&&void 0!==i?i:0,s.set(e.palette[c],h),e.palette_override[c]=null!==(a=null===(u=t.allowed_colors[null==f?void 0:f.index])||void 0===u?void 0:u.color)&&void 0!==a?a:r},c=0;c<e.palette.length;c++)u();if(0!==t.allowed_colors.length){qe.qL.print("SVG Palletization: Originally chosen colors:",s,JSON.parse(JSON.stringify(t.allowed_colors)),JSON.parse(JSON.stringify(e.palette_override)));var l=Math.floor(e.palette.length/Math.max(t.allowed_colors.length,1)),h=function(){var e=new Map;return t.allowed_colors.forEach((function(t,n){e.set(t.color,{index:n,count:0,visible:t.visible})})),s.forEach((function(n){var r=t.allowed_colors[n.selectedIndex],i=e.get(r.color);i&&i.count++})),e}(),f=Array.from(h),p=f.filter((function(e){return 0===e[1].count&&e[1].visible}));0!==f.filter((function(e){return e[1].count>l&&e[1].visible})).length?(qe.qL.print("SVG Palletization: We need to randomize override colors:",e.palette.length,t.allowed_colors.length,e.palette_override.length),p.forEach((function(e){var n=o(e,2),r=n[0],i=n[1],a=Array.from(s).map((function(e){var n=o(e,2),i=n[0],a=n[1],s=a.palette.find((function(e){return t.allowed_colors[e.index].color===r})),u=h.get(t.allowed_colors[a.selectedIndex].color);return{originalColor:i,allowedColorIndex:u.index,distance:s.distance,count:u.count,locked:a.locked,visible:u.visible}}));a.sort((function(e,t){return t.count-e.count}));var u,c=a[0].count,l=a.filter((function(e){return!e.locked&&e.visible})),p=o(a.filter((function(e){return e.count===c&&!e.locked&&e.visible})).sort((function(e,t){return e.distance-t.distance})),1)[0];p||(p=null!==(u=l[0])&&void 0!==u?u:a[0]);var m=t.allowed_colors[p.allowedColorIndex],d=f.find((function(e){return o(e,1)[0]===m.color})),v=o(d,2)[1];s.get(p.originalColor).selectedIndex=i.index,v.count--,i.count++})),s.forEach((function(n){e.palette_override[n.index]=t.allowed_colors[n.selectedIndex].color}))):qe.qL.print("SVG Palletization: No need to randomize colors!",t.allowed_colors,e.palette_override)}else qe.qL.print("SVG Palletization: Terminate palletization process, as no allowed colors are available. Fallback colors are assigned instead.")}},generateHash:function(e){return y.F.Md5(JSON.stringify({object_id:e.object_id,palette:e.palette,overrides:e.palette_override}))},destroyContext:function(e){qh.destroy(e)}};function Yh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Kh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yh(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yh(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var $h=function(e){(0,g.Z)(h,e);var n,i,a,o,s=Xh(h);function h(e,t){var n;(0,u.Z)(this,h),n=s.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mValue",{image_source:"",media_id:null,print_ready_file_id:null,svg_element:null,clipping_element:null,offset:[],size:null,scale:1,rotation:0,palletization:{settings:{enabled:!1,version:1,max_colors:1,allowed_colors:[],transparency_mode:"opaque"}}}),(0,l.Z)((0,_.Z)(n),"mUpdateEvent",new Ht),(0,l.Z)((0,_.Z)(n),"mOriginalImageSource",void 0),(0,l.Z)((0,_.Z)(n),"mPalletizationContext",void 0),(0,l.Z)((0,_.Z)(n),"mPalletizationTexture",void 0),(0,l.Z)((0,_.Z)(n),"mPalletizationDirtyFlag",void 0),n.mUpdateEvent.pipe(Ic((function(e){return Co(n.processUpdateEvent(e))}))).subscribe({next:function(){qe.qL.print("Image upload updated."),P.eventBus().dispatch(new Di(Ei.RequestFrame))},error:function(e){qe.qL.warn("Failed to update image upload (pipeline):",e)}});var r,i,a=n.resolveValuable();a&&(Array.isArray(a.palletization_colors)&&Wh.sanitizeColors(a),n.mValue={size:(0,f.HH)(a.size_type)?"cover":a.size_type,scale:a.allow_scaling&&(0,f.kE)(a.scale)?Number(a.scale):void 0,rotation:a.allow_rotation&&(0,f.kE)(a.rotation)?Number(a.rotation):void 0,offset:[a.allow_offset&&(0,f.kE)(a.offset_x)?Number(a.offset_x):0,a.allow_offset&&(0,f.kE)(a.offset_y)?Number(a.offset_y):0],palletization:{settings:{enabled:a.allow_palletization,version:1,max_colors:null!==(r=a.palletization_max_colors)&&void 0!==r?r:1,allowed_colors:a.allow_palletization?a.palletization_colors.slice(0):[],transparency_mode:null!==(i=a.palletization_transparency_mode)&&void 0!==i?i:"opaque"}}},n.updateValues(),n.mUpdateEvent.next({broadcast_options:{emitEvent:!1,rebuild:!0}}));return n}return(0,c.Z)(h,[{key:"processUpdateEvent",value:(o=t(r().mark((function e(t){var n,i,a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,i=JSON.parse(JSON.stringify(this.resolveValuable())),a=JSON.parse(JSON.stringify(this.mValue)),void 0!==i.media_id&&i.svg_element){e.next=6;break}return this.broadcast(t.broadcast_options),e.abrupt("return");case 6:if(!i.allow_palletization){e.next=10;break}return e.next=9,this.processPalletization(i,a);case 9:a.image_source=e.sent;case 10:return e.next=12,this.resolveSvgTextureController(i.print_ready_file_id);case 12:return o=e.sent,e.next=15,o.updateImage(i.svg_element,null!==(n=a.image_source)&&void 0!==n?n:null,a,i,this.mPalletizationContext);case 15:P.eventBus().dispatch(new Di(Ei.RequestFrame)),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),qe.qL.error("Failed in processUpdateEvent:",e.t0);case 21:return e.prev=21,this.broadcast(t.broadcast_options),e.finish(21);case 24:case"end":return e.stop()}}),e,this,[[0,18,21,24]])}))),function(e){return o.apply(this,arguments)})},{key:"getType",value:function(){return h.TypeRTTI}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"updateValues",value:function(){var e=this.mAttributeData.attribute_values[0].attribute_value_valuable;this.mValue.palletization.settings.enabled=e.allow_palletization,this.mValue.palletization.settings.enabled&&!e.external_colors&&(this.mValue.palletization.settings.allowed_colors=e.palletization_colors.slice(0)),this.mValue.media_id=e.media_id,this.mValue.print_ready_file_id=e.print_ready_file_id,this.mValue.svg_element=e.svg_element,this.mValue.clipping_element=e.clipping_element,this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:void 0,this.mAttributeData.selected_value_value=this.getValue()}},{key:"setValue",value:function(e,t){if(e){var n=this.resolveValuable();if("string"!=typeof e&&e){var r=e;r.palletization&&(this.copyValueFromPalletization(r,n),delete r.palletization),this.mValue=Kh(Kh({},this.mValue),r)}else this.mValue.image_source=e;n.allow_palletization&&this.updatePalletizationObject(),this.updateValues(),this.dispatchToRenderer(t).then((function(){})).catch((function(e){qe.qL.error(e)}))}}},{key:"setValueByKey",value:function(e,t){this.setValue(e,t)}},{key:"copyValueFromPalletization",value:function(e,t){var n=this;e.palletization&&(e.palletization.settings&&Array.isArray(e.palletization.settings.allowed_colors)&&t.external_colors&&(this.mValue.palletization.settings.allowed_colors.splice(0),e.palletization.settings.allowed_colors.forEach((function(e,t){var r,i,a=ll(e.color,"hex");a&&n.mValue.palletization.settings.allowed_colors.push({name:null!==(r=e.name)&&void 0!==r?r:a,color:a,position:null!==(i=e.position)&&void 0!==i?i:t,visible:!1!==e.visible})})),this.mValue.palletization.object&&(this.mValue.palletization.object.palette_override=[],this.mPalletizationDirtyFlag=!0)),e.palletization.object?(this.mValue.palletization.object||(this.mValue.palletization.object={object_id:null,hash:"",palette:[],palette_override:[]}),this.mValue.palletization.object.object_id=e.palletization.object.object_id,e.palletization.object.palette_override&&(this.mValue.palletization.object.palette_override=e.palletization.object.palette_override.slice(0),this.mPalletizationDirtyFlag=!0)):this.disposePalletizationObject())}},{key:"updatePalletizationObject",value:function(){this.mValue.image_source||!this.mValue.palletization.object?this.mValue.image_source&&!this.mValue.palletization.object&&(this.mValue.palletization.object={object_id:null,hash:"",palette:[],palette_override:[]}):this.disposePalletizationObject()}},{key:"compareValue",value:function(e){return e===this.getValue().image_source}},{key:"getValue",value:function(){return this.mValue}},{key:"getValueName",value:function(){if(!this.getValue().image_source)return"";var e=[];return e.push("".concat(this.getValue().image_source)),isFinite(this.mValue.scale)&&null!==this.mValue.scale&&e.push("@scale:".concat(this.mValue.scale,";")),isFinite(this.mValue.rotation)&&null!==this.mValue.rotation&&e.push("@rotation:".concat(this.mValue.rotation,";")),e.join(" ")}},{key:"resetValue",value:function(e){this.mValue.image_source="",delete this.mValue.value,this.broadcast(e)}},{key:"parse",value:function(e,t){if("string"==typeof e)return this.setValue(e,t);if(e&&void 0!==e.image_source&&null!==e.image_source){var n,r,i,a,o=e;if(!e.palletization&&o.palletization_palette)e.palletization={settings:{enabled:Boolean(null!==(n=null!==(r=o.allow_palletization)&&void 0!==r?r:o.palletization_enabled)&&void 0!==n&&n),version:Number(null!==(i=o.palletization_version)&&void 0!==i?i:1),max_colors:Number(null!==(a=o.palletization_max_colors)&&void 0!==a?a:1),allowed_colors:o.palletization_colors,transparency_mode:o.palletization_transparency_mode},object:{object_id:null,hash:"",palette:Array.isArray(o.palletization_palette)?o.palletization_palette.slice(0):[],palette_override:Array.isArray(o.palletization_palette_override)?o.palletization_palette_override.slice(0):[]}};this.setValue(e,t)}}},{key:"resolveValuable",value:function(){return this.mAttributeData&&this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].attribute_value_valuable:null}},{key:"dispatchToRenderer",value:(a=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.mUpdateEvent.next({broadcast_options:t});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"processPalletization",value:(i=t(r().mark((function e(t,n){var i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.image_source,n.palletization.object){e.next=4;break}return this.disposePalletizationObject(),e.abrupt("return","");case 4:if(a=this.mPalletizationDirtyFlag,this.mOriginalImageSource!==i&&(this.mOriginalImageSource=i,a=!0),0===n.palletization.object.palette_override.length&&(a=!0),!(this.mOriginalImageSource&&f.Ft.isSvg(this.mOriginalImageSource)&&a)){e.next=13;break}return this.mPalletizationDirtyFlag=!1,this.mPalletizationTexture||(this.mPalletizationTexture=Wh.createTexture("svg-image-palletization")),e.next=12,this.executePalletization(t,n,n.palletization.object);case 12:i=e.sent;case 13:return e.abrupt("return",i);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"executePalletization",value:(n=t(r().mark((function e(t,n,i){var a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.image_source,e.prev=1,e.next=4,Wh.applyPalletization(this.mPalletizationContext,this.mPalletizationTexture,this.mOriginalImageSource,t,n.palletization.settings,i);case 4:o=e.sent,this.mPalletizationContext=o.context,this.mValue.palletization.object&&(this.mValue.palletization.object.palette=n.palletization.object.palette.slice(0),this.mValue.palletization.object.palette_override=n.palletization.object.palette_override.slice(0),this.mValue.palletization.object.hash=Wh.generateHash(n.palletization.object)),a=o.render.toDataURL(),e.next=17;break;case 10:e.prev=10,e.t0=e.catch(1),qe.qL.error("Unable to palletize image:",e.t0),this.mOriginalImageSource="",n.image_source="",this.mValue.image_source="",a="";case 17:return e.abrupt("return",a);case 18:case"end":return e.stop()}}),e,this,[[1,10]])}))),function(e,t,r){return n.apply(this,arguments)})},{key:"setVisibilityPalletizationColors",value:function(e){var t=this;this.mPalletizationDirtyFlag=!1;var n=this.resolveValuable();null==n||n.palletization_colors.forEach((function(t){Object.keys(e).includes(t.color)&&(t.visible=!!e[t.color])})),this.mValue.palletization.settings.allowed_colors.forEach((function(n){Object.keys(e).includes(n.color)&&(n.visible=!!e[n.color],t.mPalletizationDirtyFlag=!0)}));var r={emitEvent:!1,rebuild:!1};this.processUpdateEvent({broadcast_options:r}).then((function(){t.broadcastAttributeUpdated(r)})).catch((function(e){qe.qL.error(e)}))}},{key:"disposePalletizationObject",value:function(){this.mValue.palletization.object&&(Wh.clearPalettes(this.mValue.palletization.object),delete this.mValue.palletization.object),this.mPalletizationContext&&(Wh.destroyContext(this.mPalletizationContext),delete this.mPalletizationContext),this.mPalletizationTexture&&(this.mPalletizationTexture.dispose(),delete this.mPalletizationTexture)}}]),h}(nh);function Qh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qh(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qh(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ef(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)($h,"TypeRTTI",new k.r("AttributeSvgImageController",nh.TypeRTTI));var tf=function(e){(0,g.Z)(a,e);var n,i=ef(a);function a(e,t){var n;(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mValue",{name:"",media_id:null,print_ready_file_id:null,selected_media_id:null,svg_element:null});var r=n.resolveValuable();if(r&&Array.isArray(r.attributes)&&r.attributes.length>0){var o=r.attributes.find((function(e){return f.Ft.isTrue(e.default)}));o?n.setValue(o.key):n.setValue(r.attributes[0].key)}return n}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"updateValues",value:function(){this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,this.mAttributeData.selected_value_value=this.getValue()}},{key:"setValue",value:function(e,t){if((0,f.HD)(e)){var n=this.mAttributeData.attribute_values[0].attribute_value_valuable,r=n.attributes.find((function(t){return t.key===e}));r&&(this.mValue={key:r.key,media_id:n.media_id,print_ready_file_id:n.print_ready_file_id,svg_element:n.svg_element,name:r.name,selected_media_id:r.selected_media_id})}else this.mValue=Jh(Jh({},this.mValue),e);this.updateValues(),this.dispatchToRenderer(t).then((function(){P.eventBus().dispatch(new Di(Ei.RequestFrame))}),(function(e){qe.qL.error(e)})),this.broadcast(t)}},{key:"setValueByKey",value:function(e,t){this.setValue(e,t)}},{key:"compareValue",value:function(e){return e==this.getValue().key}},{key:"getValue",value:function(){if(this.mAttributeData.attribute_values.length>0){var e=this.mAttributeData.attribute_values[0].attribute_value_valuable;e&&(this.mValue.media_id=e.media_id,this.mValue.print_ready_file_id=e.print_ready_file_id,this.mValue.svg_element=e.svg_element,this.mValue.scale=e.scale)}return this.mValue}},{key:"getValueName",value:function(){return this.getValue().name}},{key:"resetValue",value:function(e){this.mValue.name="",delete this.mValue.selected_media_id,delete this.mValue.value,this.broadcast(e)}},{key:"setVisibility",value:function(e,t){if(!this.visibleOnFrame)return Ni((0,M.Z)(a.prototype),"setVisibility",this).call(this,!1);if(t&&Number.isSafeInteger(t.option_id))try{var n=this.mAttributeData.attribute_values[0].attribute_value_valuable.attributes.find((function(e){return e.key===t.option_id}));n&&(n.visible=e)}catch(e){qe.qL.print("failed to get svg valuable: ",e)}else Ni((0,M.Z)(a.prototype),"setVisibility",this).call(this,e,t)}},{key:"parse",value:function(e,t){e&&this.setValue(e,t)}},{key:"resolveValuable",value:function(){return this.mAttributeData&&this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].attribute_value_valuable:null}},{key:"dispatchToRenderer",value:(n=t(r().mark((function e(t){var n,i,a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.resolveValuable()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.resolveSvgTextureController(n.print_ready_file_id);case 5:return i=e.sent,a=this.getValue(),e.next=9,$s.getInstance().resolveModel(a.selected_media_id);case 9:return o=e.sent,e.next=12,i.updatePattern(n.svg_element,o.source_url,a);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),a}(nh);(0,l.Z)(tf,"TypeRTTI",new k.r("AttributeSvgImageSelectorController",nh.TypeRTTI));var nf=/[#*0-9]\uFE0F?\u20E3|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26AA\u26B0\u26B1\u26BD\u26BE\u26C4\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0-\u26F5\u26F7\u26F8\u26FA\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B55\u3030\u303D\u3297\u3299]\uFE0F?|[\u261D\u270C\u270D](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\u270A\u270B](?:\uD83C[\uDFFB-\uDFFF])?|[\u23E9-\u23EC\u23F0\u23F3\u25FD\u2693\u26A1\u26AB\u26C5\u26CE\u26D4\u26EA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2795-\u2797\u27B0\u27BF\u2B50]|\u26F9(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\u2764\uFE0F?(?:\u200D(?:\uD83D\uDD25|\uD83E\uDE79))?|\uD83C(?:[\uDC04\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE37\uDF21\uDF24-\uDF2C\uDF36\uDF7D\uDF96\uDF97\uDF99-\uDF9B\uDF9E\uDF9F\uDFCD\uDFCE\uDFD4-\uDFDF\uDFF5\uDFF7]\uFE0F?|[\uDF85\uDFC2\uDFC7](?:\uD83C[\uDFFB-\uDFFF])?|[\uDFC3\uDFC4\uDFCA](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDFCB\uDFCC](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDCCF\uDD8E\uDD91-\uDD9A\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF84\uDF86-\uDF93\uDFA0-\uDFC1\uDFC5\uDFC6\uDFC8\uDFC9\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF8-\uDFFF]|\uDDE6\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF]|\uDDE7\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF]|\uDDE8\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF]|\uDDE9\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF]|\uDDEA\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA]|\uDDEB\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7]|\uDDEC\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE]|\uDDED\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA]|\uDDEE\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9]|\uDDEF\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5]|\uDDF0\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF]|\uDDF1\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE]|\uDDF2\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF]|\uDDF3\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF]|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE]|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC]|\uDDF8\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF]|\uDDF9\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF]|\uDDFA\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF]|\uDDFB\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA]|\uDDFC\uD83C[\uDDEB\uDDF8]|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C[\uDDEA\uDDF9]|\uDDFF\uD83C[\uDDE6\uDDF2\uDDFC]|\uDFF3\uFE0F?(?:\u200D(?:\u26A7\uFE0F?|\uD83C\uDF08))?|\uDFF4(?:\u200D\u2620\uFE0F?|\uDB40\uDC67\uDB40\uDC62\uDB40(?:\uDC65\uDB40\uDC6E\uDB40\uDC67|\uDC73\uDB40\uDC63\uDB40\uDC74|\uDC77\uDB40\uDC6C\uDB40\uDC73)\uDB40\uDC7F)?)|\uD83D(?:[\uDC08\uDC26](?:\u200D\u2B1B)?|[\uDC3F\uDCFD\uDD49\uDD4A\uDD6F\uDD70\uDD73\uDD76-\uDD79\uDD87\uDD8A-\uDD8D\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA\uDECB\uDECD-\uDECF\uDEE0-\uDEE5\uDEE9\uDEF0\uDEF3]\uFE0F?|[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC6B-\uDC6D\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDC8F\uDC91\uDCAA\uDD7A\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC](?:\uD83C[\uDFFB-\uDFFF])?|[\uDC6E\uDC70\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD74\uDD90](?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?|[\uDC00-\uDC07\uDC09-\uDC14\uDC16-\uDC25\uDC27-\uDC3A\uDC3C-\uDC3E\uDC40\uDC44\uDC45\uDC51-\uDC65\uDC6A\uDC79-\uDC7B\uDC7D-\uDC80\uDC84\uDC88-\uDC8E\uDC90\uDC92-\uDCA9\uDCAB-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDDA4\uDDFB-\uDE2D\uDE2F-\uDE34\uDE37-\uDE44\uDE48-\uDE4A\uDE80-\uDEA2\uDEA4-\uDEB3\uDEB7-\uDEBF\uDEC1-\uDEC5\uDED0-\uDED2\uDED5-\uDED7\uDEDC-\uDEDF\uDEEB\uDEEC\uDEF4-\uDEFC\uDFE0-\uDFEB\uDFF0]|\uDC15(?:\u200D\uD83E\uDDBA)?|\uDC3B(?:\u200D\u2744\uFE0F?)?|\uDC41\uFE0F?(?:\u200D\uD83D\uDDE8\uFE0F?)?|\uDC68(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDC68\uDC69]\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?\uDC68\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFE])))?))?|\uDC69(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:\uDC8B\u200D\uD83D)?[\uDC68\uDC69]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D(?:[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?))|\uD83E[\uDDAF-\uDDB3\uDDBC\uDDBD])|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFC-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFD-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFD\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D\uD83D(?:[\uDC68\uDC69]|\uDC8B\u200D\uD83D[\uDC68\uDC69])\uD83C[\uDFFB-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83D[\uDC68\uDC69]\uD83C[\uDFFB-\uDFFE])))?))?|\uDC6F(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDD75(?:\uFE0F|\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|\uDE2E(?:\u200D\uD83D\uDCA8)?|\uDE35(?:\u200D\uD83D\uDCAB)?|\uDE36(?:\u200D\uD83C\uDF2B\uFE0F?)?)|\uD83E(?:[\uDD0C\uDD0F\uDD18-\uDD1F\uDD30-\uDD34\uDD36\uDD77\uDDB5\uDDB6\uDDBB\uDDD2\uDDD3\uDDD5\uDEC3-\uDEC5\uDEF0\uDEF2-\uDEF8](?:\uD83C[\uDFFB-\uDFFF])?|[\uDD26\uDD35\uDD37-\uDD39\uDD3D\uDD3E\uDDB8\uDDB9\uDDCD-\uDDCF\uDDD4\uDDD6-\uDDDD](?:\uD83C[\uDFFB-\uDFFF])?(?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDDDE\uDDDF](?:\u200D[\u2640\u2642]\uFE0F?)?|[\uDD0D\uDD0E\uDD10-\uDD17\uDD20-\uDD25\uDD27-\uDD2F\uDD3A\uDD3F-\uDD45\uDD47-\uDD76\uDD78-\uDDB4\uDDB7\uDDBA\uDDBC-\uDDCC\uDDD0\uDDE0-\uDDFF\uDE70-\uDE7C\uDE80-\uDE88\uDE90-\uDEBD\uDEBF-\uDEC2\uDECE-\uDEDB\uDEE0-\uDEE8]|\uDD3C(?:\u200D[\u2640\u2642]\uFE0F?|\uD83C[\uDFFB-\uDFFF])?|\uDDD1(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1))|\uD83C(?:\uDFFB(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFC-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFC(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFD-\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFD(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFE(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFD\uDFFF]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?|\uDFFF(?:\u200D(?:[\u2695\u2696\u2708]\uFE0F?|\u2764\uFE0F?\u200D(?:\uD83D\uDC8B\u200D)?\uD83E\uDDD1\uD83C[\uDFFB-\uDFFE]|\uD83C[\uDF3E\uDF73\uDF7C\uDF84\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\uD83E(?:[\uDDAF-\uDDB3\uDDBC\uDDBD]|\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF])))?))?|\uDEF1(?:\uD83C(?:\uDFFB(?:\u200D\uD83E\uDEF2\uD83C[\uDFFC-\uDFFF])?|\uDFFC(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFD-\uDFFF])?|\uDFFD(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])?|\uDFFE(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFD\uDFFF])?|\uDFFF(?:\u200D\uD83E\uDEF2\uD83C[\uDFFB-\uDFFE])?))?)/g,rf=function(e){return(0,p.isNullOrUndefined)(e)?e:String(e).replace(nf,"")};function af(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function of(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?af(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):af(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function sf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var uf=function(e){(0,g.Z)(a,e);var n,i=sf(a);function a(e,t){var n;(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mValue",{text:"",media_id:null,print_ready_file_id:null,svg_element:null,clipping_element:null,multiline:!1,font:null,size:null,offset:[0,0],rotation:0,scale:0,color:null,color_output:null,styles:null,align:"center"});var r=n.resolveValuable();return r&&n.setValue({text:r.text,font:Array.isArray(r.available_fonts)&&r.available_fonts.length>0?r.available_fonts[0]:void 0,size:f.Ft.isNumeric(r.font_size)?r.font_size:void 0,scale:r.allow_scaling&&f.Ft.isNumeric(r.scale)?r.scale:void 0,rotation:r.allow_rotation&&f.Ft.isNumeric(r.rotation)?r.rotation:void 0,offset:[r.allow_offset&&f.Ft.isNumeric(r.offset_x)?r.offset_x:0,r.allow_offset&&f.Ft.isNumeric(r.offset_y)?r.offset_y:0]}),n}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"validateMinMax",value:function(e){if(f.Ft.isString(this.mValue.text)&&f.Ft.isNumeric(e.max_length)&&e){var t=e.max_length;if(this.mValue.multiline){var n=this.mValue.text.match(/\n/g);n&&(t+=n.length)}this.mValue.text=this.mValue.text.slice(0,t)}}},{key:"updateValues",value:function(){this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,this.mAttributeData.selected_value_value=this.getValue()}},{key:"setValue",value:function(e,t){var n=this;"string"==typeof e?this.mValue.text=e:this.mValue=of(of({},this.mValue),e),"string"==typeof this.mValue.color&&(this.mValue.color_output=ll(this.mValue.color,this.mAttributeData.meta.output_color_format));var r=this.resolveValuable();if(this.validateMinMax(r),this.mValue.text=rf(this.mValue.text),this.mValue.multiline&&this.isExtendedEditorViewSelected()&&this.validateLineBreaks(),this.updateValues(),this.mValue.multiline&&this.isExtendedEditorViewSelected()){var i=of({},this.getValue());this.resolveSvgTextureController(r.print_ready_file_id).then((function(e){e.getCurrentRawTextFromObject(r.svg_element,i).then((function(e){n.mValue.text=e,n.updateValues(),n.dispatchToRenderer(t).then((function(){n.broadcast(t)}),(function(e){qe.qL.error(e),n.broadcast(t)}))}),(function(e){qe.qL.error(e),n.broadcast(t)}))}),(function(e){qe.qL.error(e),n.broadcast(t)}))}else this.dispatchToRenderer(t).then((function(){}),(function(e){qe.qL.error(e)})),this.broadcast(t)}},{key:"setValueByKey",value:function(e,t){this.setValue(e,t)}},{key:"compareValue",value:function(e){return e==this.getValue().text}},{key:"getValue",value:function(){if(this.mAttributeData.attribute_values.length>0){var e=this.mAttributeData.attribute_values[0].attribute_value_valuable;e&&(this.mValue.media_id=e.media_id,this.mValue.print_ready_file_id=e.print_ready_file_id,this.mValue.svg_element=e.svg_element,this.mValue.clipping_element=e.clipping_element,this.mValue.multiline=e.multiline)}return this.mValue}},{key:"getValueName",value:function(){if(!this.getValue().text||this.getValue().styles)return this.getValue().text;var e=[];return e.push("".concat(this.getValue().text)),this.mValue.size&&e.push("@size:".concat(this.mValue.size,";")),this.mValue.font&&e.push("@font:".concat(this.mValue.font,";")),e.join(" ")}},{key:"resetValue",value:function(e){this.mValue.text="",delete this.mValue.value,this.broadcast(e)}},{key:"parse",value:function(e,t){e&&this.setValue(e,t)}},{key:"resolveValuable",value:function(){return this.mAttributeData&&this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].attribute_value_valuable:null}},{key:"validateLineBreaks",value:function(){this.validateMaxCharactersForEachLine(),this.validateMaxLineBreaks()}},{key:"validateMaxCharactersForEachLine",value:function(){var e=this,t=this.mValue.text.split("\n"),n=parseInt(this.mAttributeData.meta.maxCharactersForEachLine,10)||0,r=[];0!==n&&(t.forEach((function(t){"string"!=typeof t||t.length<n?r.push(t):e.breakLines(t,n).forEach((function(e){r.push(e.trim())}))})),this.mValue.text=r.join("\n"))}},{key:"breakLines",value:function(e,t){if(!e)return[];if(e.length<=t)return[e];var n=e.slice(0,t),r=n.lastIndexOf(" ");return e.length>t&&" "===e[t]?e.slice(t).trim()?[n].concat(this.breakLines(e.slice(t).trim(),t)):[n]:-1===r?[n].concat(this.breakLines(e.slice(t),t)):[n=n.slice(0,r+1)].concat(this.breakLines(e.slice(r+1),t))}},{key:"validateMaxLineBreaks",value:function(){var e=parseInt(this.mAttributeData.meta.maxLineBreaks,10)||0;if(0!==e){var t=this.mValue.text.split("\n");t=t.slice(0,e),this.mValue.text=t.join("\n")}}},{key:"isExtendedEditorViewSelected",value:function(){return this.mAttributeData.meta&&"SvgTextEditorView"===this.mAttributeData.meta.render_function}},{key:"dispatchToRenderer",value:(n=t(r().mark((function e(t){var n,i,a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.resolveValuable()){e.next=3;break}return e.abrupt("return");case 3:return"string"==typeof(i=of({},this.getValue())).color?i.color=null!==(a=ll(i.color,"hex"))&&void 0!==a?a:"#000000":delete i.color,e.next=7,this.resolveSvgTextureController(n.print_ready_file_id);case 7:return o=e.sent,e.next=10,o.updateText(n.svg_element,i,n);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),a}(nh);function cf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(uf,"TypeRTTI",new k.r("AttributeSvgTextController",nh.TypeRTTI));var lf=function(e){(0,g.Z)(a,e);var n,i=cf(a);function a(e,t){var n;if((0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mValue",{value:""}),n.mAttributeData.attribute_values.length){var r=n.mAttributeData.attribute_values[0].attribute_value_valuable;r&&r.value&&(n.mValue.value=r.value)}return n}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"updateValues",value:function(){this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,this.mAttributeData.selected_value_value=this.getValue()}},{key:"setValue",value:function(e,t){"string"==typeof e?this.mValue.value=e:this.mValue=Object.assign(this.mValue,e),this.updateValues(),this.broadcast(t)}},{key:"setValueByKey",value:function(e,t){this.setValue(e,t)}},{key:"compareValue",value:function(e){return e==this.getValue().value}},{key:"getValue",value:function(){return this.mValue}},{key:"getValueName",value:function(){return this.getValue().value}},{key:"resetValue",value:function(e){this.mValue.value="",this.broadcast(e)}},{key:"parse",value:function(e,t){e&&void 0!==e.value&&this.setValue(e.value,t)}},{key:"dispatchToRenderer",value:(n=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}]),a}(al);function hf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(lf,"TypeRTTI",new k.r("AttributeTextInputController",al.TypeRTTI));var ff=function(e){(0,g.Z)(o,e);var n,i,a=hf(o);function o(e,t){var n;(0,u.Z)(this,o),n=a.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mValue",{value:""}),(0,l.Z)((0,_.Z)(n),"mMeta",void 0),(0,l.Z)((0,_.Z)(n),"mTextToImageEvent",new Ht),(0,l.Z)((0,_.Z)(n),"mTextToImageController",void 0);var r=n.resolveValuable(),i=r?r.value:"";return n.mMeta=n.mAttributeData&&n.mAttributeData.meta||{},n.setValue(i),n}return(0,c.Z)(o,[{key:"getType",value:function(){return o.TypeRTTI}},{key:"destroy",value:function(){this.mTextToImageEvent.unsubscribe(),this.mTextToImageController&&(this.mTextToImageController.destroy(),delete this.mTextToImageController),delete this.mTextToImageController}},{key:"getResourceController",value:function(){return this.mTextToImageController}},{key:"broadcastAttributeUpdated",value:function(){this.setValue(this.getValue()),Ni((0,M.Z)(o.prototype),"broadcastAttributeUpdated",this).call(this)}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"updateValues",value:function(){this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,this.mAttributeData.selected_value_value=this.getValue()}},{key:"setValue",value:function(e,t){"string"!=typeof e&&(this.mValue=Object.assign(this.mValue,e));var n="string"==typeof e?e:e.value;if(null!=(n=rf(n))){var r=n.length;if(/@size:(\d+\.?\d*);?/.test(n)){var i=n.match(/@size:(\d+\.?\d*)x?;?/),a=i[1];r=r>i.index?i.index:r;var o=parseFloat(a);isNaN(o)||(this.mValue.size=o)}if(/@font:'?"?(.*?)'?"?;?$/.test(n)){var s=n.match(/@font:'?"?(.*?)'?"?;?$/);r=r>s.index?s.index:r;var u=s[1];u.length>1&&(this.mValue.font=u)}r>0&&(r!==n.length&&(r-=1),n=n.slice(0,r)),this.mValue.value=n}this.updateValues(),this.dispatchToRenderer(t).then((function(){}),(function(e){qe.qL.error(e)})),this.broadcast(t)}},{key:"setValueByKey",value:function(e,t){this.setValue(e,t)}},{key:"getValue",value:function(){return this.mValue}},{key:"getValueName",value:function(){var e=this.resolveValuable(),t=this.mValue.font||e&&e.available_fonts&&e.available_fonts[0]||"Arial",n=Number.isSafeInteger(this.mValue.size)?"".concat(Number(this.mValue.size).toFixed(2)):"1.00";return(0,f.HH)(this.mValue.value)?"".concat(this.mValue.value," @size:").concat(n,"; @font:").concat(t,";"):""}},{key:"resetValue",value:function(e){this.mValue={value:""},this.broadcast(e)}},{key:"parse",value:function(e,t){e&&void 0!==e.value&&this.setValue(e,t)}},{key:"resolveValuable",value:function(){return this.mAttributeData&&this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].attribute_value_valuable:null}},{key:"onMaterialUpdated",value:function(e){var t=this.resolveValuable().material_id;e.materialModelId===t&&this.mAttributeData.visible&&0!==this.mAttributeData.visibility&&3!==this.mAttributeData.visibility&&this.dispatchToRenderer().then((function(){}),(function(e){qe.qL.error(e)}))}},{key:"dispatchToRenderer",value:(i=t(r().mark((function e(t){var n,i,a=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.resolveValuable()){e.next=3;break}return e.abrupt("return");case 3:this.mTextToImageController||(i=tc.getManager(Qu.MaterialManager),this.mTextToImageController=new Ju(i,this.mAttributeData),this.mTextToImageController.requestFrameSubject().subscribe((function(){P.eventBus().dispatch(new Di(Ei.RequestFrame))})),this.mTextToImageEvent.pipe(Ic((function(){return Co(new Promise((function(e){if(null===n.material_id)return e();var t=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(a.mValue)),i=JSON.parse(JSON.stringify(a.mMeta));a.mTextToImageController.update(t,r,i,a.resolveProductNode()).then((function(){e()}),(function(t){qe.qL.warn("Failed to update text to image: ",t),e()}))})))}))).subscribe((function(){qe.qL.print("Text to image updated"),P.eventBus().dispatch(new Di(Ei.RequestFrame))}),(function(e){qe.qL.warn("Failed to update text to image (pipeline):",e)}))),this.mTextToImageEvent.next();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setNextValue",value:(n=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.getMiddleware()){e.next=4;break}return e.next=3,this.getMiddleware().execute(JSON.parse(JSON.stringify(t)));case 3:t=e.sent;case 4:return e.abrupt("return",this.setValue(t,n));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}]),o}(al);function pf(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return mf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mf(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function mf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function df(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?df(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):df(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function yf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(ff,"TypeRTTI",new k.r("AttributeTextToImageController",al.TypeRTTI));var gf=function(e){(0,g.Z)(m,e);var n,i,a,s,h,p=yf(m);function m(e,t){var n;(0,u.Z)(this,m),n=p.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mValue",vf({media_id:0,print_ready_file_id:0,svg_element:"",clipping_element:void 0},m.getDefaultOptions())),(0,l.Z)((0,_.Z)(n),"canvasGroup",""),(0,l.Z)((0,_.Z)(n),"mTextureController",void 0),(0,l.Z)((0,_.Z)(n),"mSvgElementBoundary",void 0),(0,l.Z)((0,_.Z)(n),"mUpdateEvent",new Ht),(0,l.Z)((0,_.Z)(n),"mPalletizationTextures",{}),(0,l.Z)((0,_.Z)(n),"mPalletizationDirtyFlags",{}),n.canvasGroup=y.F.uuidV4(),n.mUpdateEvent.pipe(Ic((function(e){return Co(n.processUpdateEvent(e))}))).subscribe({next:function(){qe.qL.print("Svg Canvas updated."),P.eventBus().dispatch(new Di(Ei.RequestFrame))},error:function(e){qe.qL.warn("Failed to update Svg Canvas (pipeline):",e)}});var r=n.resolveValuable();if(r){var i,a,o;Array.isArray(r.palletization_colors)&&Wh.sanitizeColors(r);var s=m.getDefaultOptions(),c=s.palletization;c.settings.enabled=r.allow_palletization,c.settings.max_colors=null!==(i=r.palletization_max_colors)&&void 0!==i?i:1,c.settings.allowed_colors=(null!==(a=r.palletization_colors)&&void 0!==a?a:[]).slice(0),c.settings.transparency_mode=null!==(o=r.palletization_transparency_mode)&&void 0!==o?o:"opaque",r.external_colors&&(c.settings.allowed_colors=[]),n.mValue=s,n.updateValues(),n.mUpdateEvent.next({broadcast_options:{emitEvent:!1,rebuild:!0}})}return n.mTextureResolver.subscribe({next:function(e){n.mTextureController=e.controller}}),n}return(0,c.Z)(m,[{key:"getType",value:function(){return m.TypeRTTI}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"getValue",value:function(){return this.mValue}},{key:"getValueName",value:function(){var e,t=["id","dirty"],n=[],r=pf(this.mValue.canvas.objects);try{for(r.s();!(e=r.n()).done;){for(var i=e.value,a=[],s=0,u=Object.entries(i);s<u.length;s++){var c=o(u[s],2),l=c[0],h=c[1];t.includes(l)||a.push("@".concat(l,":").concat(h,";"))}n.push(a.join(" "))}}catch(e){r.e(e)}finally{r.f()}return n.join("|")}},{key:"parse",value:function(e,t){e&&this.setValue(e,t)}},{key:"serialize",value:function(e){var t=Ni((0,M.Z)(m.prototype),"serialize",this).call(this,e);return!0===e.calculate_approximations&&t&&this.mTextureController?(this.mSvgElementBoundary||(this.mSvgElementBoundary=this.mTextureController.getBoundariesSync(this.mValue.svg_element,void 0,!0)),this.mSvgElementBoundary?(t.attribute_value.svg_canvas_surface=this.calculateSurfaceCoverage(),t):t):t}},{key:"resetValue",value:function(e){try{this.setValue(m.getDefaultOptions(),e)}finally{this.broadcast(e)}}},{key:"setValue",value:function(e,t){var n=this,r=this.resolveValuable(),i=void 0!==e.type?{canvas:e}:e;i&&(i.canvas&&this.copyValueFromCanvas(i),this.validateEmojisInTextObjects(),i.palletization&&this.copyValueFromPalletization(i,r),(i.canvas||i.palletization)&&this.updatePalletizationObjectsFromCanvas(),this.needPalletizationRefreshForExternalColors(r)&&(r.palletization_colors=this.mValue.palletization.settings.allowed_colors.slice(0),qe.qL.print("Svg canvas (palletization): external colors changed. Updating colors and marking all objects dirty."),Object.keys(this.mPalletizationDirtyFlags).forEach((function(e){n.mPalletizationDirtyFlags[e]=!0}))),this.updateValues(),this.dispatchToRenderer(t).then((function(){}),(function(e){qe.qL.error(e)})))}},{key:"convertColorsForCanvasObjects",value:function(e){var t,n=pf(e);try{for(n.s();!(t=n.n()).done;){var r,i=t.value;if("string"==typeof i.fill)i.fill=null!==(r=ll(i.fill,"hex"))&&void 0!==r?r:"#FFFFFF"}}catch(e){n.e(e)}finally{n.f()}return e}},{key:"validateEmojisInTextObjects",value:function(){var e=this.mValue.canvas.objects.filter((function(e){return"i-text"===e.type}));if(Array.isArray(e)){var t,n=pf(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.text=rf(r.text)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"setValueByKey",value:function(e,t){this.setValue(e,t)}},{key:"copyValueFromCanvas",value:function(e){var t,n,r=this;e.canvas.objects=Array.isArray(e.canvas.objects)?e.canvas.objects:[],this.mValue.canvas.type=null!==(t=e.canvas.type)&&void 0!==t?t:"",this.mValue.canvas.version=Number(null!==(n=e.canvas.version)&&void 0!==n?n:1),this.mValue.canvas.objects=e.canvas.objects.map((function(e){var t=JSON.parse(JSON.stringify(e));Object.keys(t).forEach((function(e){t[e]=f.Ft.isNumeric(t[e])?Number(t[e]):t[e]}));var n,i=vf({id:y.F.guid(),key:"",type:"",width:0,height:0,scaleX:1,scaleY:1,angle:0,top:0,left:0},t);"string"==typeof i.fill&&(i.fill_output=null!==(n=ll(i.fill,r.mAttributeData.meta.output_color_format))&&void 0!==n?n:"#FFFFFF");return i}))}},{key:"copyValueFromPalletization",value:function(e,t){var n=this;e.palletization&&(e.palletization.settings&&("number"==typeof e.palletization.settings.max_colors&&(this.mValue.palletization.settings.max_colors=e.palletization.settings.max_colors),Array.isArray(e.palletization.settings.allowed_colors)&&t.external_colors&&(this.mValue.palletization.settings.allowed_colors.splice(0),e.palletization.settings.allowed_colors.forEach((function(e,t){var r,i,a=ll(e.color,"hex");a&&n.mValue.palletization.settings.allowed_colors.push({name:null!==(r=e.name)&&void 0!==r?r:a,color:a,position:null!==(i=e.position)&&void 0!==i?i:t,visible:!1!==e.visible})})),Object.keys(this.mValue.palletization.objects).forEach((function(e){n.mValue.palletization.objects[e].palette_override=[],n.mPalletizationDirtyFlags[e]=!0})))),e.palletization.objects&&(Object.keys(e.palletization.objects).forEach((function(t){var r=e.palletization.objects[t];r?(t in n.mValue.palletization.objects||(n.mValue.palletization.objects[t]={object_id:null,hash:"",palette:[],palette_override:[]}),n.mValue.palletization.objects[t].object_id=r.object_id,r.palette_override&&(n.mValue.palletization.objects[t].palette_override=r.palette_override.slice(0),n.mPalletizationDirtyFlags[t]=!0)):n.disposePalletizationObject(t)})),Object.keys(this.mValue.palletization.objects).forEach((function(t){t in e.palletization.objects||n.disposePalletizationObject(t)}))))}},{key:"updatePalletizationObjectsFromCanvas",value:function(){var e=this,t=this.getImagesForPalletizationFromCanvas(this.mValue.canvas.objects),n={};Object.keys(this.mValue.palletization.objects).forEach((function(e){n[e]=!1})),t.forEach((function(t){t.id in e.mValue.palletization.objects||(e.mValue.palletization.objects[t.id]={object_id:t.id,hash:"",palette:[],palette_override:[]},e.mPalletizationDirtyFlags[t.id]=!0),n[t.id]=!0})),Object.keys(n).filter((function(e){return e})).forEach((function(t){n[t]||e.disposePalletizationObject(t)}))}},{key:"updateValues",value:function(){if(this.mAttributeData.attribute_values.length>0){this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values[0].id;var e=this.mAttributeData.attribute_values[0].attribute_value_valuable;Array.isArray(e.available_fonts)&&0!==e.available_fonts.length||(e.available_fonts=["Arial","Times New Roman"]),this.mValue.palletization.settings.enabled=e.allow_palletization,this.mValue.palletization.settings.enabled&&!e.external_colors&&(this.mValue.palletization.settings.allowed_colors=e.palletization_colors.slice(0)),this.mValue.media_id=e.media_id||0,this.mValue.print_ready_file_id=e.print_ready_file_id||0,this.mValue.svg_element=e.svg_element}this.mAttributeData.selected_value_value=this.getValue()}},{key:"dispatchToRenderer",value:(h=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.mUpdateEvent.next({broadcast_options:t});case 1:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"calculateSurfaceCoverage",value:function(){var e=this,t=this.mSvgElementBoundary.left,n=this.mSvgElementBoundary.top,r=Math.floor(this.mSvgElementBoundary.width*this.mSvgElementBoundary.scaleX),i=Math.floor(this.mSvgElementBoundary.height*this.mSvgElementBoundary.scaleY),a=(this.mValue.canvas.objects||[]).map((function(t){var n=e.mTextureController.getBoundariesSync(t.id,e.canvasGroup,!0);if(n)switch(n.id=t.id,n.width*=n.scaleX,n.height*=n.scaleY,t.type){case"i-text":case"image":return n;default:return}})).filter((function(e){if(!e)return!1;var a=e.bbox.min.x,o=e.bbox.min.y,s=e.bbox.max.x,u=e.bbox.max.y;if(a>t&&o>n&&s<t+r&&u<n+i)return!0;if(a<t&&s>t+r||o<n&&u>n+i)return!0;var c=e.coords.tl.x>t&&e.coords.tl.x<t+r&&e.coords.tl.y>n&&e.coords.tl.y<n+i,l=e.coords.tr.x>t&&e.coords.tr.x<t+r&&e.coords.tr.y>n&&e.coords.tr.y<n+i,h=e.coords.bl.x>t&&e.coords.bl.x<t+r&&e.coords.bl.y>n&&e.coords.bl.y<n+i,f=e.coords.br.x>t&&e.coords.br.x<t+r&&e.coords.br.y>n&&e.coords.br.y<n+i;if(c||l||h||f)return!0;var p=new THREE.Vector2(t,n),m=new THREE.Vector2(t+r,n),d=new THREE.Vector2(t,n+i),v=new THREE.Vector2(t+r,n+i),y=new THREE.Vector2(e.coords.tl.x,e.coords.tl.y),g=new THREE.Vector2(e.coords.tr.x,e.coords.tr.y),b=new THREE.Vector2(e.coords.bl.x,e.coords.bl.y),M=new THREE.Vector2(e.coords.br.x,e.coords.br.y),k=pl.LineLineIntersection(p,m,y,g),_=pl.LineLineIntersection(p,m,g,M),x=pl.LineLineIntersection(p,m,M,b),T=pl.LineLineIntersection(p,m,b,y);if(k||_||x||T)return!0;var w=pl.LineLineIntersection(v,d,y,g),R=pl.LineLineIntersection(v,d,g,M),Z=pl.LineLineIntersection(v,d,M,b),S=pl.LineLineIntersection(v,d,b,y);return!!(w||R||Z||S)})),o=r*i,s=0,u=0;a.length>0&&o>0&&(a.map((function(e){return e.minX=e.bbox.min.x<t?t:e.bbox.min.x,e.minY=e.bbox.min.y<n?n:e.bbox.min.y,e.maxX=e.bbox.max.x>t+r?t+r:e.bbox.max.x,e.maxY=e.bbox.max.y>n+i?n+i:e.bbox.max.y,e})).forEach((function(e){s+=(e.maxX-e.minX)*(e.maxY-e.minY)})),u=(s=Math.min(s,o))/o*100);return u}},{key:"setNextValue",value:(s=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.getMiddleware()){e.next=4;break}return e.next=3,this.getMiddleware().execute(JSON.parse(JSON.stringify(t)));case 3:t=e.sent;case 4:return e.abrupt("return",this.setValue(t,n));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"disposeSvgTexture",value:function(){Ni((0,M.Z)(m.prototype),"disposeSvgTexture",this).call(this),this.mTextureController&&delete this.mTextureController}},{key:"processUpdateEvent",value:(a=t(r().mark((function e(t){var n,i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=JSON.parse(JSON.stringify(this.resolveValuable())),i=JSON.parse(JSON.stringify(this.mValue)),e.next=5,this.resolveSvgTextureController(n.print_ready_file_id);case 5:if(a=e.sent,this.mTextureController=a,!n.allow_palletization){e.next=10;break}return e.next=10,this.processPalletization(n,i);case 10:return i.canvas.objects=this.convertColorsForCanvasObjects(i.canvas.objects),e.next=13,a.updateCanvas(this.mValue.svg_element,this.canvasGroup,i,this.mPalletizationContexts);case 13:this.broadcast(t.broadcast_options),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),qe.qL.error("Error in processUpdateEvent:",e.t0);case 19:case"end":return e.stop()}}),e,this,[[0,16]])}))),function(e){return a.apply(this,arguments)})},{key:"processPalletization",value:(i=t(r().mark((function e(t,n){var i,a,o,s=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=n.palletization.objects,a=r().mark((function e(a){var o,u,c;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i[a],u=n.canvas.objects.find((function(e){return e.id===a}))){e.next=5;break}return s.disposePalletizationObject(a),e.abrupt("return","continue");case 5:if(c=!(a in s.mPalletizationDirtyFlags)||s.mPalletizationDirtyFlags[a],u.id in s.mPalletizationTextures||(s.mPalletizationTextures[u.id]=Wh.createTexture("svg-canvas-palletization_".concat(u.id)),c=!0),0===o.palette_override.length&&(c=!0),!c){e.next=12;break}return s.mPalletizationDirtyFlags[a]=!1,e.next=12,s.executePalletization(t,n,u,o);case 12:case"end":return e.stop()}}),e)})),e.t0=r().keys(i);case 3:if((e.t1=e.t0()).done){e.next=11;break}return o=e.t1.value,e.delegateYield(a(o),"t2",6);case 6:if("continue"!==e.t2){e.next=9;break}return e.abrupt("continue",3);case 9:e.next=3;break;case 11:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"executePalletization",value:(n=t(r().mark((function e(t,n,i,a){var o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Wh.applyPalletization(this.mPalletizationContexts[i.id],this.mPalletizationTextures[i.id],i.imageSrc,t,n.palletization.settings,a);case 3:o=e.sent,this.mPalletizationContexts[i.id]=o.context,i.id in this.mValue.palletization.objects&&(this.mValue.palletization.objects[i.id].palette=a.palette,this.mValue.palletization.objects[i.id].palette_override=a.palette_override,this.mValue.palletization.objects[i.id].hash=Wh.generateHash(a)),e.next=13;break;case 8:e.prev=8,e.t0=e.catch(0),qe.qL.error("Unable to palletize image:",e.t0),delete this.mPalletizationContexts[a.object_id],i.imageSrc="";case 13:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"getImagesForPalletizationFromCanvas",value:function(e){var t=this;return e.filter((function(e){return"image"===e.type&&(e.id in t.mValue.palletization.objects||!!e.imageSrc&&(0,f.Dc)(e.imageSrc))}))}},{key:"needPalletizationRefreshForExternalColors",value:function(e){return!!e.allow_palletization&&(!!e.external_colors&&(this.mValue.palletization.settings.allowed_colors.length!==e.palletization_colors.length||!this.mValue.palletization.settings.allowed_colors.every((function(t){return e.palletization_colors.some((function(e){return e.color===t.color}))}))))}},{key:"setVisibilityPalletizationColors",value:function(e){var t=this,n=!1,r=this.resolveValuable();null==r||r.palletization_colors.forEach((function(t){Object.keys(e).includes(t.color)&&(t.visible=!!e[t.color])})),this.mValue.palletization.settings.allowed_colors.forEach((function(t){Object.keys(e).includes(t.color)&&(t.visible=!!e[t.color],n=!0)})),n&&Object.keys(this.mPalletizationDirtyFlags).forEach((function(e){t.mPalletizationDirtyFlags[e]=!0}));this.processUpdateEvent({broadcast_options:{emitEvent:!1,rebuild:!1}}).then((function(){t.broadcastAttributeUpdated()})).catch((function(e){qe.qL.error(e)}))}},{key:"disposePalletizationObject",value:function(e){e in this.mValue.palletization.objects&&(Wh.clearPalettes(this.mValue.palletization.objects[e]),e in this.mPalletizationContexts&&(Wh.destroyContext(this.mPalletizationContexts[e]),delete this.mPalletizationContexts[e]),e in this.mPalletizationTextures&&(this.mPalletizationTextures[e].dispose(),delete this.mPalletizationTextures[e]),delete this.mPalletizationDirtyFlags[e],delete this.mValue.palletization.objects[e])}}],[{key:"getDefaultOptions",value:function(){return{canvas:{objects:[],type:"",version:1},palletization:{settings:{enabled:!1,version:1,max_colors:1,transparency_mode:"opaque",allowed_colors:[]},objects:{}}}}}]),m}(nh);function bf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bf(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function kf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(gf,"TypeRTTI",new k.r("AttributeSvgCanvasController",nh.TypeRTTI));var _f,xf=function(e){(0,g.Z)(a,e);var n,i=kf(a);function a(e,t){var n;(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mValue",{media_id:null,print_ready_file_id:null,svg_element:null,clipping_element:null,primary_color:"",primary_color_output:"",secondary_color:"",secondary_color_output:"",direction:null});var r=n.resolveValuable();return null!=r&&n.setValue({primary_color:r.primary_color,primary_color_output:r.primary_color_output,secondary_color:r.secondary_color,secondary_color_output:r.secondary_color_output,direction:r.direction}),n}return(0,c.Z)(a,[{key:"resolveValuable",value:function(){return this.mAttributeData&&this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].attribute_value_valuable:null}},{key:"getAttribute",value:function(){return this.updateValues(),this.mAttributeData}},{key:"updateValues",value:function(){this.mAttributeData.selected_value_id=this.mAttributeData.attribute_values.length>0?this.mAttributeData.attribute_values[0].id:null,this.mAttributeData.selected_value_value=this.getValue()}},{key:"getValue",value:function(){if(this.mAttributeData.attribute_values.length>0){var e=this.mAttributeData.attribute_values[0].attribute_value_valuable;null!=e&&(this.mValue.media_id=e.media_id,this.mValue.print_ready_file_id=e.print_ready_file_id,this.mValue.svg_element=e.svg_element,this.mValue.clipping_element=e.clipping_element)}return this.mValue}},{key:"getValueName",value:function(){var e=this.resolveValuable(),t=this.mValue.primary_color||e&&e.primary_color||"",n=this.mValue.secondary_color||e&&e.secondary_color||"",r=this.mValue.direction||e&&e.direction||"";return"primary_color: ".concat(t,", secondary_color: ").concat(n,", direction: ").concat(r,"; ")}},{key:"parse",value:function(e,t){null!=e&&this.setValue(e,t)}},{key:"resetValue",value:function(e){var t=this.resolveValuable();this.mValue.primary_color=t&&t.primary_color||"",this.mValue.primary_color_output=t&&t.primary_color_output||"",this.mValue.secondary_color=t&&t.secondary_color||"",this.mValue.secondary_color_output=t&&t.secondary_color_output||"",this.mValue.direction=t&&t.direction||null,this.mValue.media_id=t&&t.media_id||null,this.mValue.print_ready_file_id=t&&t.print_ready_file_id||null,this.mValue.svg_element=t&&t.svg_element||null,this.mValue.clipping_element=t&&t.clipping_element||null,delete this.mValue.value,this.broadcast(e)}},{key:"setValue",value:function(e,t){var n,r;(this.mValue=Mf(Mf({},this.mValue),e),"string"==typeof this.mValue.primary_color)&&(this.mValue.primary_color_output=null!==(n=ll(this.mValue.primary_color,this.mAttributeData.meta.output_color_format))&&void 0!==n?n:"");"string"==typeof this.mValue.secondary_color&&(this.mValue.secondary_color_output=null!==(r=ll(this.mValue.secondary_color,this.mAttributeData.meta.output_color_format))&&void 0!==r?r:"");this.updateValues(),this.dispatchToRenderer(t).then((function(){}),(function(e){qe.qL.error(e)})),this.broadcast(t)}},{key:"setValueByKey",value:function(e,t){this.setValue(e,t)}},{key:"dispatchToRenderer",value:(n=t(r().mark((function e(t){var n,i,a,o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.resolveValuable()){e.next=3;break}return e.abrupt("return");case 3:return(o=Mf({},this.getValue())).primary_color=null!==(n=ll(o.primary_color,"hex"))&&void 0!==n?n:"#000000",o.secondary_color=null!==(i=ll(o.secondary_color,"hex"))&&void 0!==i?i:"#FFFFFF",e.next=8,this.resolveSvgTextureController(a.print_ready_file_id);case 8:return s=e.sent,e.next=11,s.updateGradient(a.svg_element,o);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),a}(nh);function Tf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tf(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Rf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}!function(e){e.en="en",e.ar="ar",e.fr="fr",e.de="de",e.hi="hi",e.ja="ja",e.it="it",e.pt="pt",e.ru="ru",e.es="es",e.th="th",e.tr="tr",e.zh="zh",e.ko="ko",e.pa="pa"}(_f||(_f={}));var Zf=function(e){(0,g.Z)(o,e);var n,i,a=Rf(o);function o(){return(0,u.Z)(this,o),a.apply(this,arguments)}return(0,c.Z)(o,[{key:"filterProfanityText",value:(i=t(r().mark((function e(t,n){var i,a,s,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.getLocale(),a=wf({text:t,lang:i,replacesymbol:"*",requestComplete:!0},n),s={success:!0,text:t,found:0,plain_text:t},!(t.length<=2)){e.next=5;break}return e.abrupt("return",s);case 5:return e.prev=5,e.next=8,this.sendRequestFilter(a);case 8:if("complete"!==(u=e.sent).status||!u.data.result.found){e.next=11;break}return e.abrupt("return",wf(wf({},s),{},{text:u.data.result.text,found:parseInt(u.data.result.found,10)}));case 11:return e.abrupt("return",s);case 14:return e.prev=14,e.t0=e.catch(5),qe.qL.error("Profanity service failed",e.t0),e.abrupt("return",wf(wf({},s),{},{success:!1}));case 18:case"end":return e.stop()}}),e,this,[[5,14]])}))),function(e,t){return i.apply(this,arguments)})},{key:"sendRequestFilter",value:(n=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ei.getInstance().post(Jr.E.makeApiRoute("services/webpurify:profanity"),t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}],[{key:"getInstance",value:function(){return null===this._instance&&(this._instance=new this),this._instance}},{key:"getLocale",value:function(){var e=ei.getInstance().getAcceptLanguage();if(!e)return _f.en;var t=e.split("-")[0];return _f[t]||_f.en}}]),o}((0,c.Z)((function e(){(0,u.Z)(this,e)})));(0,l.Z)(Zf,"_instance",null);var Sf=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"next",void 0)}var n;return(0,c.Z)(e,[{key:"setNext",value:function(e){this.next?this.next.setNext(e):this.next=e}},{key:"execute",value:(n=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.handler(t);case 2:if(n=e.sent,this.next){e.next=5;break}return e.abrupt("return",n);case 5:return e.abrupt("return",this.next.execute(n));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),e}();function Cf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function If(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Cf(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ef(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Af(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Af(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Af(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Of(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Df=function(e){(0,g.Z)(p,e);var n,i,a,o,s,h,f=Of(p);function p(e,n){var i;return(0,u.Z)(this,p),i=f.call(this),(0,l.Z)((0,_.Z)(i),"aController",void 0),(0,l.Z)((0,_.Z)(i),"aProductAttributeComponent",void 0),(0,l.Z)((0,_.Z)(i),"mModerate$",new Ht),(0,l.Z)((0,_.Z)(i),"mModerateResult$",new Ht),(0,l.Z)((0,_.Z)(i),"mControllerName",void 0),(0,l.Z)((0,_.Z)(i),"mService",void 0),i.aController=e,i.aProductAttributeComponent=n,i.mControllerName=e.getType().getTypeName(),i.setProfanityFilter(e),i.mModerate$.pipe(an(500),Xl(function(){var e=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Io(i.resolveModerateText(t)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).subscribe(function(){var e=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.mModerateResult$.next(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),i}return(0,c.Z)(p,[{key:"setProfanityFilter",value:function(e){var t=e.getAttribute().meta;if(t&&t.filters&&t.filters.profanity){var n=t.filters.profanity;this.mService=this.resolveService(n)}}},{key:"resolveService",value:function(e){var t=Object.entries(e).find((function(e){return!0===e[1]})),n=null;if(!t)return n;if("enable_webpurify"===t[0])n=Zf.getInstance();return n}},{key:"resolveModerateText",value:(h=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.mControllerName,e.next="AttributeSvgTextController"===e.t0?3:"AttributeTextToImageController"===e.t0?7:"AttributeSvgCanvasController"===e.t0?11:15;break;case 3:return e.next=5,this.getTextFromSvgText(t);case 5:case 9:case 13:return t=e.sent,e.abrupt("break",15);case 7:return e.next=9,this.getTextFromTextToImage(t);case 11:return e.next=13,this.getTextFromSvgCanvas(t);case 15:return e.abrupt("return",t);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"moderateText",value:(s=t(r().mark((function e(t){var n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={text:t,found:0,plain_text:t},0!==t.length){e.next=3;break}return e.abrupt("return",n);case 3:return e.next=5,this.mService.filterProfanityText(t);case 5:return(i=e.sent).success&&i.found&&(n.text=i.text,n.found=i.found,n.plain_text=i.plain_text),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"handler",value:(o=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mService){e.next=2;break}return e.abrupt("return",t);case 2:return this.mModerate$.next(t),e.next=5,this.mModerateResult$.pipe(sn(1)).toPromise();case 5:return e.next=7,e.sent.toPromise();case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getTextFromSvgCanvas",value:(a=t(r().mark((function e(t){var n,i,a,o,s,u,c;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.objects.filter((function(e){return"i-text"===e.type})),i=!1,a=[],o=Ef(n),e.prev=4,o.s();case 6:if((s=o.n()).done){e.next=15;break}return u=s.value,e.next=10,this.moderateText(u.text);case 10:c=e.sent,u.text=c.text,c.found&&(i=!0,a.push(If(If({},c),{object_id:u.id})));case 13:e.next=6;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(4),o.e(e.t0);case 20:return e.prev=20,o.f(),e.finish(20);case 23:return i&&this.aController.broadcastAttributeModerated(a),e.abrupt("return",t);case 25:case"end":return e.stop()}}),e,this,[[4,17,20,23]])}))),function(e){return a.apply(this,arguments)})},{key:"getTextFromSvgText",value:(i=t(r().mark((function e(t){var n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=8;break}return e.next=3,this.moderateText(t);case 3:return(n=e.sent).found&&this.aController.broadcastAttributeModerated(n),e.abrupt("return",n.text);case 8:return e.next=10,this.moderateText(t.text);case 10:return i=e.sent,t.text=i.text,i.found&&this.aController.broadcastAttributeModerated(i),e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getTextFromTextToImage",value:(n=t(r().mark((function e(t){var n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=8;break}return e.next=3,this.moderateText(t);case 3:return(n=e.sent).found&&this.aController.broadcastAttributeModerated(n),e.abrupt("return",n.text);case 8:return e.next=10,this.moderateText(t.value);case 10:return i=e.sent,t.value=i.text,i.found&&this.aController.broadcastAttributeModerated(i),e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),p}(Sf);function Pf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Bf=function(e){(0,g.Z)(h,e);var n,i,a,s=Pf(h);function h(){var e;return(0,u.Z)(this,h),e=s.call(this,"attributeManager"),(0,l.Z)((0,_.Z)(e),"mProductId",void 0),(0,l.Z)((0,_.Z)(e),"mLoaderService",void 0),(0,l.Z)((0,_.Z)(e),"mProductAttributes",[]),(0,l.Z)((0,_.Z)(e),"mAttributeControllers",{}),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mEventBrokers",[]),(0,l.Z)((0,_.Z)(e),"mMaterialGroupManagerAccessor",null),(0,l.Z)((0,_.Z)(e),"onAttributeChanged",new Ht),(0,l.Z)((0,_.Z)(e),"onAttributeUpdated",new Ht),(0,l.Z)((0,_.Z)(e),"onAttributeModerated",new Ht),(0,l.Z)((0,_.Z)(e),"_handleOptionVisibilityChange",(function(t){t.product_scene_uuid===e.getParentObject().getObjectUUID()&&e._setVisibility(t.attribute_id,t.visible,t)})),(0,l.Z)((0,_.Z)(e),"handleSetValue",(function(t){if("product_id"===t.key)e._setProductId(t.value)})),e}return(0,c.Z)(h,[{key:"getType",value:function(){return h.TypeRTTI}},{key:"OnAttached",value:function(){var e=this,t=this.getParentObject(),n=t.getValue("product_id");void 0!==n&&this._setProductId(n),this.mSubscriptions.push(this.onAttributeChanged.subscribe((function(e){P.eventBus().dispatch(new Di(Ei.ProductOptionChanged,e))})),this.onAttributeUpdated.subscribe((function(e){P.eventBus().dispatch(new Di(Ei.ProductAttributeUpdated,e))})),this.onAttributeModerated.subscribe((function(e){P.eventBus().dispatch(new Di(Ei.ProductAttributeModerated,e))}))),this.mEventBrokers.push(P.messenger().listen(J.TypeRTTI,this._handleOptionVisibilityChange.bind(this)),P.messenger().listen(G.TypeRTTI,(function(t){e._getAttributeControllers().forEach((function(e){e.onMaterialUpdated(t)}))}),String(t.getSceneObjectId()))),this.registerMessageHandler(Ie.TypeRTTI,this.handleSetValue)}},{key:"OnDetached",value:function(){this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mEventBrokers.splice(0).forEach((function(e){return e.unsubscribe()})),this.unregisterMessageHandler(Ie.TypeRTTI),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mLoaderService&&(this.mLoaderService.error("product options detached"),delete this.mLoaderService),this.mProductAttributes.splice(0),Object.entries(this.mAttributeControllers).forEach((function(e){o(e,2)[1].destroy()}))}},{key:"isAttachable",value:function(e){return e.isDerivedOfTypeName("ProductNode")}},{key:"_loadDependencies",value:function(){return tl(this._depResolveMaterialManager())}},{key:"_depResolveMaterialManager",value:function(){var e=this,t=this.getParentObject().getComponent("materialGroupManager");return(0,p.isNullOrUndefined)(t)?ci("material group component not found"):t.resolveMaterialGroups().pipe(Kt((function(t){return e.mMaterialGroupManagerAccessor=t,t})))}},{key:"_loadProductAttributes",value:(a=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){Ko.getInstance().resolveBootstrapData(+t.mProductId).pipe(sn(1)).subscribe((function(n){var r=n.getAttributes(),i=JSON.parse(JSON.stringify(v.getItems(r)));i.sort((function(e,t){return e.position-t.position})),t.mProductAttributes=i,t._makeAttributeControllers(),e(i)}),(function(e){n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})},{key:"_getProduct",value:function(){return this.getParentObject()}},{key:"_setProductId",value:function(e){this.mProductId!=e&&(this.mProductId=e,this.mMaterialGroupManagerAccessor=null,this.mLoaderService&&(this.mLoaderService.error("product id has changed"),delete this.mLoaderService))}},{key:"resolveAttributeManager",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,p.isNullOrUndefined)(this.mProductId)?(qe.qL.warn("trying to load product options with undefined product id"),ci("undefined product id")):(this.mLoaderService&&n&&delete this.mLoaderService,this.mLoaderService||(this.mLoaderService=new ni(1),this._loadDependencies().pipe(nl(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._loadProductAttributes());case 1:case"end":return t.stop()}}),t)}))))).pipe(sn(1)).subscribe((function(){e.mLoaderService&&e.mLoaderService.next(new rl(e))}),(function(t){e.mLoaderService&&e.mLoaderService.error(t),delete e.mLoaderService}))),this.mLoaderService.pipe(di()))}},{key:"_makeAttributeControllers",value:function(){var e=this,t={};Object.keys(this.mAttributeControllers).forEach((function(n){var r=Number(n);t[r]=e.mAttributeControllers[r].serialize({include_keys:!1,discard_hidden:!1,calculate_approximations:!1}),e.mAttributeControllers[r].destroy()})),this.mAttributeControllers={},this.mProductAttributes.forEach((function(n){var r=!0;switch(n.type){case"question":e.mAttributeControllers[n.id]=new Wl(n,e);break;case"matgroup":e.mAttributeControllers[n.id]=new gl(n,e);break;case"color":e.mAttributeControllers[n.id]=new sl(n,e);break;case"color_picker":e.mAttributeControllers[n.id]=new fl(n,e);break;case"image_upload":e.mAttributeControllers[n.id]=new vl(n,e);break;case"text_input":e.mAttributeControllers[n.id]=new lf(n,e);break;case"text_to_image":e.mAttributeControllers[n.id]=new ff(n,e),e.mAttributeControllers[n.id].registerMiddleware(new Df(e.mAttributeControllers[n.id],e));break;case"operable_numbers_input":e.mAttributeControllers[n.id]=new Gl(n,e);break;case"svg_element":e.mAttributeControllers[n.id]=new oh(n,e);break;case"svg_image":e.mAttributeControllers[n.id]=new $h(n,e);break;case"svg_image_selector":e.mAttributeControllers[n.id]=new tf(n,e);break;case"svg_element_selector":e.mAttributeControllers[n.id]=new lh(n,e);break;case"svg_text":e.mAttributeControllers[n.id]=new uf(n,e),e.mAttributeControllers[n.id].registerMiddleware(new Df(e.mAttributeControllers[n.id],e));break;case"title":case"header":case"custom":case"step":e.mAttributeControllers[n.id]=new Kl(n,e);break;case"svg_canvas":e.mAttributeControllers[n.id]=new gf(n,e),e.mAttributeControllers[n.id].registerMiddleware(new Df(e.mAttributeControllers[n.id],e));break;case"svg_gradient":e.mAttributeControllers[n.id]=new xf(n,e);break;default:r=!1}r&&!(0,p.isNullOrUndefined)(t[n.id])&&e.mAttributeControllers[n.id].parse(t[n.id])}))}},{key:"_getMaterialGroupManager",value:function(){return this.mMaterialGroupManagerAccessor}},{key:"_hasAttribute",value:function(e){return!(0,p.isNullOrUndefined)(this.mAttributeControllers[e])}},{key:"_getRawAttributes",value:function(){return this.mProductAttributes}},{key:"_getAttributes",value:function(){var e=new Array;return this._getAttributeControllers().forEach((function(t){e.push(t.getAttribute())})),e}},{key:"_cloneAttributes",value:function(){return f.Ft.deepCloneJSON(this._getAttributes())}},{key:"_getAttribute",value:function(e){var t=this._getAttributeController(e);if(!(0,p.isNullOrUndefined)(t))return t.getAttribute()}},{key:"_getAttributeByName",value:function(e){var t=this._getAttributeControllerByName(e);if(!(0,p.isNullOrUndefined)(t))return t.getAttribute()}},{key:"_getAttributeIdByName",value:function(e){return this._getAttributeIdBy("name",e)}},{key:"_getAttributeIdByKey",value:function(e){return this._getAttributeIdBy("key",e)}},{key:"_getAttributeIdBy",value:function(e,t){var n=t.toLowerCase().trim();n=(n=n.replace(/\u202d/g,"")).replace(/\u202c/g,"");var r=this.mProductAttributes.find((function(t){if("string"!=typeof t[e])return!1;var r=t[e].toLowerCase().trim();return(r=(r=r.replace(/\u202d/g,"")).replace(/\u202c/g,""))===n}));return(0,p.isUndefined)(r)?-1:r.id}},{key:"_getAttributeControllers",value:function(){var e=this;return Object.keys(this.mAttributeControllers).map((function(t){return e.mAttributeControllers[Number(t)]}))}},{key:"_getAttributeController",value:function(e){if(this._hasAttribute(e))return this.mAttributeControllers[e];qe.qL.warn("Attribute id '".concat(e,"' not found@getAttriubte"))}},{key:"_getAttributeControllerByName",value:function(e){var t=this._getAttributeIdByName(e);if(t>=0)return this.mAttributeControllers[t]}},{key:"_setValue",value:(i=t(r().mark((function e(t,n,i){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._hasAttribute(t)){e.next=3;break}return qe.qL.warn("Attribute id '".concat(t,"' not found@setValue")),e.abrupt("return");case 3:return e.next=5,this.mAttributeControllers[t].setNextValue(n,i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"_getValue",value:function(e){if(this._hasAttribute(e))return this.mAttributeControllers[e].getValue();qe.qL.warn("Attribute id '".concat(e,"' not found@_getValue"))}},{key:"_getValueName",value:function(e){if(this._hasAttribute(e))return this.mAttributeControllers[e].getValueName();qe.qL.warn("Attribute id '".concat(e,"' not found@_getValueName"))}},{key:"_resetValue",value:function(e,t){if(this._hasAttribute(e))return this.mAttributeControllers[e].resetValue(t);qe.qL.warn("Attribute id '".concat(e,"' not found@_resetValue"))}},{key:"_setValueByName",value:(n=t(r().mark((function e(t,n,i){var a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((a=this._getAttributeIdByName(t))>=0)){e.next=4;break}return e.next=4,this._setValue(a,n,i);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"_getValueByName",value:function(e){var t=this._getAttributeIdByName(e);if(t>=0)return this._getValue(t)}},{key:"_setValueByKey",value:function(e,t,n){var r=this._getAttributeIdByKey(e);r>=0&&this.mAttributeControllers[r].setValueByKey(t,n)}},{key:"_getValueByKey",value:function(e){var t=this._getAttributeIdByKey(e);if(t>=0)return this._getValue(t)}},{key:"_getValueNameByName",value:function(e){var t=this._getAttributeIdByName(e);if(t>=0)return this._getValueName(t)}},{key:"_resetValueByName",value:function(e,t){var n=this._getAttributeIdByName(e);if(n>=0)return this._resetValue(n,t)}},{key:"_resetAllValues",value:function(e){var t=this;return Object.keys(this.mAttributeControllers).map((function(n){return t.mAttributeControllers[n].resetValue(e)}))}},{key:"_setVisibility",value:function(e,t,n){this._hasAttribute(e)?this.mAttributeControllers[e].setVisibility(t,n):qe.qL.warn("Attribute id '".concat(e,"' not found@_setVisibility"))}},{key:"_setVisibilityByName",value:function(e,t,n){var r=this._getAttributeIdByName(e);if(r>=0)return this._setVisibility(r,t,n)}},{key:"_isVisible",value:function(e,t){if(this._hasAttribute(e))return this.mAttributeControllers[e].isVisible(t);qe.qL.warn("Attribute id '".concat(e,"' not found@_isVisible"))}},{key:"_buildQueryParams",value:function(e,t){var n=this,r={};return Object.keys(this.mAttributeControllers).forEach((function(i){var a=Number(i),o=n.mAttributeControllers[a].getQueryParam(e,t);Object.assign(r,o)})),r}},{key:"_serialize",value:function(e){var t=[];return this._getAttributeControllers().sort((function(e,t){return e.getAttribute().position-t.getAttribute().position})).forEach((function(n){var r=n.serialize(e);(0,p.isNullOrUndefined)(r)||t.push(r)})),t}},{key:"_parse",value:function(e,t){var n=this;e.forEach((function(e){(0,p.isUndefined)(e.attribute_id)||(0,p.isNullOrUndefined)(n.mAttributeControllers[e.attribute_id])||n.mAttributeControllers[e.attribute_id].parse(e.attribute_value,t)}))}},{key:"_hashConfiguration",value:function(){var e="";return this._serialize({discard_hidden:!1,include_keys:!1,calculate_approximations:!1}).forEach((function(t){e+="".concat(t.attribute_id,"/").concat(t.attribute_value_name)})),y.F.Md5(e)}}]),h}(Xi.H);function Ff(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Bf,"TypeRTTI",new k.r("ProductAttributeManagerComponent",Xi.H.TypeRTTI));var Lf=function(e){(0,g.Z)(n,e);var t=Ff(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"mFirstProductCreation",!0),r.mName="ReferenceProductNode",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"parse",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{if(this.mFirstProductCreation){this.mFirstProductCreation=!1;var i=null!=e&&e.asset_meta?JSON.parse(e.asset_meta):{},a=i.node_matrix,o=new Fi,s=new Bi(0,0,0),u=new Pi,c=new Bi(1,1,1);Array.isArray(a)&&a.length>15&&(o.set(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]),o.decompose(s,u,c),qe.qL.print("Reference product: initial values:",s,u,c)),e.children=e.children||[],e.children.push({type:"product",name:"Referenced product id:".concat(i.product_id),properties:JSON.stringify({child_lock:!1,product_id:i.product_id,object_lock:!1,position_x:s.x,position_y:s.y,position_z:s.z,quaternion_x:u.x,quaternion_y:u.y,quaternion_z:u.z,quaternion_w:u.w,scale_x:c.x,scale_y:c.y,scale_z:c.z})}),qe.qL.print("Reference product node (serialized):",e)}Ni((0,M.Z)(n.prototype),"parse",this).call(this,e,t,r)}catch(e){qe.qL.error("Parsing reference product failed:",e)}}},{key:"onBeforeAddNewToRenderState",value:function(e){return qe.qL.print("Reference before add to render state:",e.getType().isDerivedOfTypeName("ProductNode")),!e.getType().isDerivedOfTypeName("ProductNode")}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"collider":if(!r)break;if(!P.settingsManager().getSettings().getSceneSettings().physics.enabled)break;var i="string"==typeof t?JSON.parse(t):t;return this.addColliderWithParsedData(i),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"serialize",value:function(e){var t=Object.assign(Wi.prototype.serialize.call(this,e,!1),{type:"asset"}),n=o(this.getComponents(mc.TypeRTTI),1)[0];return n&&(t.properties.collider=n.serialize()),t}},{key:"addColliderWithParsedData",value:function(e){if(e)switch(this.removeComponents(mc.TypeRTTI),e.type){case"sphere":var t=new vc;t.parse(e),this.addComponent(t);break;case"box":var n=new gc;n.parse(e),this.addComponent(n)}}}]),n}(Ga);function Nf(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return jf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jf(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function jf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(0,l.Z)(Lf,"TypeRTTI",new k.r("ReferenceProductNode",Ga.TypeRTTI));var zf=function(){function e(){(0,u.Z)(this,e)}var n,i,a,s;return(0,c.Z)(e,null,[{key:"exportEsd",value:(s=t(r().mark((function t(n){var i,a,o,s,u,c,l,h,p,m,d,y,g,b,M,k,_,x,T,w,R,Z,S,C,I,E,A,O=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.findProductNode()){t.next=3;break}throw new Error("Could not find product node");case 3:a=P.sceneManager(),o=e.exportSceneTransform(a,P.settingsManager()),s=e.exportSceneCameras(a),u=s.cameras,c=s.main_camera_id,l=e.exportSceneLights(a),h=P.sceneManager().findNodesOfType(Pc.TypeRTTI),p=P.sceneManager().getRootProductNode(),m=[],d=Nf(h),t.prev=13,d.s();case 15:if((y=d.n()).done){t.next=33;break}return g=y.value,t.next=19,St(Ko.getInstance().resolveBootstrapData(g.productId));case 19:return b=t.sent,t.next=22,St(g.onConfigurableNodeReady);case 22:return M=t.sent,k=g.getObjectUUID(),_=M.getObjectUUID(),t.next=27,M.resolveSceneOffsetManager();case 27:x=t.sent,T=x.getOffsets(),g.getObjectUUID()===i.getObjectUUID()&&null!=n&&(k=n,_=n),m.push({productUuid:k,productNode:g,configurableUuid:_,configurableNode:M,offsetGroups:T,bootstrap:b});case 31:t.next=15;break;case 33:t.next=38;break;case 35:t.prev=35,t.t0=t.catch(13),d.e(t.t0);case 38:return t.prev=38,d.f(),t.finish(38);case 41:w=[],R=[],Z=[],S=[],C=r().mark((function t(){var n,i,a,o,s,u,c,l,h,d,y,g,b,M,k,_,x,T,C,A,D,P,B,F,L,N,j,z,U,V,H,G,q,W,Y,K,X,$,Q,J,ee,te;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=E[I],i=n.productNode,a=n.bootstrap,o=n.configurableNode,s=m.find((function(e){return e.productNode.getObjectUUID()===i.getObjectUUID()})),u=i.findParentOfType(Pc.TypeRTTI),c=null,u&&(c=m.find((function(e){return e.productNode.getObjectUUID()===u.getObjectUUID()}))),l=s.productUuid===p.getObjectUUID(),h=l?s.configurableUuid:s.productUuid,d=i.productId,o){t.next=11;break}return qe.qL.error("Failed to get configurable node"),t.abrupt("return","continue");case 11:y=v.getItems(a.getMaterials()),g=v.getItems(a.getMedia()),b={},y.forEach((function(e){b[e.id]=JSON.parse(JSON.stringify(e))})),M={},g.forEach((function(e){M[e.id]=e})),k=i.getComponents(Bf.TypeRTTI)[0],_=k._getAttributeControllers(),x=[],T=Nf(_),t.prev=21,A=r().mark((function e(){var t,n,i,a,o,s,u,c,l;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=C.value)instanceof ff)){e.next=10;break}if(n=t.resolveValuable(),null!=(i=null==n?void 0:n.material_id)&&b[i]){e.next=6;break}return e.abrupt("return","continue");case 6:t.getResourceController().applyTexturesToModel(b[i]),e.next=30;break;case 10:if(!(t instanceof vl)){e.next=20;break}if(a=t.resolveValuable(),null!=(o=null==a?void 0:a.material_id)&&b[o]){e.next=15;break}return e.abrupt("return",{v:{v:void 0}});case 15:return s=t.getResourceController(),e.next=18,null==s?void 0:s.applyTexturesToModel(b[o]);case 18:e.next=30;break;case 20:if(!(t instanceof nh)){e.next=30;break}if(u=t.resolveValuable(),c=null==u?void 0:u.print_ready_file_id,null!=(l=t.getMediaId())&&null!=c){e.next=26;break}return e.abrupt("return","continue");case 26:if(!x.find((function(e){return e.media_id===l}))){e.next=29;break}return e.abrupt("return","continue");case 29:x.push({media_id:l,print_ready_file_id:c,controller:t});case 30:case"end":return e.stop()}}),e)})),T.s();case 24:if((C=T.n()).done){t.next=33;break}return t.delegateYield(A(),"t0",26);case 26:if("continue"!==(D=t.t0)){t.next=29;break}return t.abrupt("continue",31);case 29:if("object"!==(0,ui.Z)(D)){t.next=31;break}return t.abrupt("return",D.v);case 31:t.next=24;break;case 33:t.next=38;break;case 35:t.prev=35,t.t1=t.catch(21),T.e(t.t1);case 38:return t.prev=38,T.f(),t.finish(38);case 41:P=0,B=x;case 42:if(!(P<B.length)){t.next=51;break}return F=B[P],t.next=46,F.controller.resolveSvgTextureController(F.print_ready_file_id);case 46:L=t.sent,M[F.media_id]=L.getSvgCanvasAsBase64()||"";case 48:P++,t.next=42;break;case 51:N=[],j=o.getComponent("buildConfigurable"),z=j.getBatches(),U=Nf(z),t.prev=55,H=r().mark((function t(){var n,i,a,o,u,c,l,h,f,p,m,d,v;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=V.value,u=e.exportAttachment(o.getOffsetGroups(),s.offsetGroups),-1===S.findIndex((function(e){return e.id===u.id}))&&S.push(u),c=o.getMaterialId(),l=tc.getManager(Qu.MaterialManager),t.next=7,l.resolveResource(o.getMaterial());case 7:if(h=t.sent,f=l.findResourceWithHandle(o.getMaterial()),R.some((function(e){return void 0!==e.id&&e.id===c}))||!h||!f){t.next=22;break}if(!O.isMaterialPbr(b[c])){t.next=18;break}return t.next=14,e.exportMaterialPbr(h,b[c],f,M);case 14:p=t.sent,R.push(p),t.next=22;break;case 18:return t.next=20,e.exportMaterial(h,b[c],f,M);case 20:m=t.sent,R.push(m);case 22:(d=o.getGeometrySource())&&!Z.some((function(e){return e.id===d}))&&(v="drc",d&&(d.endsWith("drc")?v="drc":d.endsWith("ebm")&&(v="ebm")),Z.push({id:d,data:"".concat(Jr.E.cacheUrl).concat(d),compression:v})),N.push({id:"".concat(u.id,"_").concat(d,"_").concat(c),attachment_id:u.id,geometry_id:d,material_id:c,visible:null===(n=!(null!==(i=b[c])&&void 0!==i&&null!==(a=i.name)&&void 0!==a&&a.includes("disable_ar_e")))||void 0===n||n});case 25:case"end":return t.stop()}}),t)})),U.s();case 58:if((V=U.n()).done){t.next=62;break}return t.delegateYield(H(),"t2",60);case 60:t.next=58;break;case 62:t.next=67;break;case 64:t.prev=64,t.t3=t.catch(55),U.e(t.t3);case 67:return t.prev=67,U.f(),t.finish(67);case 70:G="root_".concat(h),-1===S.findIndex((function(e){return e.id===G}))&&(W=null!==(q=i.getParent())&&void 0!==q&&q.isTypeOf(Lf.TypeRTTI)?i.getParent():i,Y=W.transform.position,K=W.transform.rotation,X=(new Pi).setFromEuler(K),$=W.transform.scale,Q=(new Fi).compose(Y,X,$),S.push({id:G,name:(0,f.HH)(i.name)?i.name:"attachment_".concat(G),visible:!0,matrix:Q.toArray(),position:Y.toArray(),quaternion:X.toArray(),rotation:K.toArray(),scale:$.toArray()})),c&&(ee=void 0===u.findParentOfType(Pc.TypeRTTI),(te=m.find((function(e){return e.productUuid===c.productUuid})))&&(J=ee?te.configurableUuid:te.productUuid)),w.push({id:h,catalogue_id:d,parent_id:J,data:N,attachment_id:G});case 74:case"end":return t.stop()}}),t,null,[[21,35,38,41],[55,64,67,70]])})),I=0,E=m;case 47:if(!(I<E.length)){t.next=57;break}return t.delegateYield(C(),"t1",49);case 49:if("continue"!==(A=t.t1)){t.next=52;break}return t.abrupt("continue",54);case 52:if("object"!==(0,ui.Z)(A)){t.next=54;break}return t.abrupt("return",A.v);case 54:I++,t.next=47;break;case 57:return t.abrupt("return",{version:1,scene:o,products:w,materials:R,geometries:Z,attachments:S,main_camera_id:c,cameras:u,lights:l});case 58:case"end":return t.stop()}}),t,null,[[13,35,38,41]])}))),function(e){return s.apply(this,arguments)})},{key:"exportSceneTransform",value:function(e,t){var n=e.getScene();if(!n)return{position:Bi.Zero().toArray(),rotation:(new Li).toArray(),quaternion:Pi.identity().toArray(),scale:Bi.One().toArray(),matrix:(new Fi).identity().toArray()};var r=t.getSettings().getSceneSettings().esd_scene_scale,i=n.transform.scale.clone().multiplyScalar(r),a=(new Fi).makeScale(r,r,r);n.transform.updateMatrix(!0);var o=n.transform.matrix.clone().multiply(a);return{position:n.transform.position.toArray(),rotation:n.transform.rotation.toArray(),quaternion:n.transform.quaternion.toArray(),scale:i.toArray(),matrix:o.toArray()}}},{key:"exportSceneCameras",value:function(t){var n,r=t.findNodesOfType(ga.TypeRTTI),i=o(t.findNodesOfType(ga.TypeRTTI,(function(e){return e.isCameraActive()})),1)[0],a=i?e.exportSceneCamera(i):void 0,s=[],u=Nf(r);try{for(u.s();!(n=u.n()).done;){var c=n.value;s.push(e.exportSceneCamera(c))}}catch(e){u.e(e)}finally{u.f()}return{cameras:s,main_camera_id:a?a.id:-1}}},{key:"exportSceneCamera",value:function(e){var t={id:e.id,type:"Camera",matrix:e.transform.matrix.toArray(),position:e.transform.position.toArray(),rotation:e.transform.rotation.toArray(),quaternion:e.transform.quaternion.toArray(),scale:e.transform.scale.toArray(),aspect:e.getValue("aspect_ratio"),far:e.far,near:e.near,zoom:e.getValue("zoom")};if(e instanceof jc){var n=t;n.type="PerspectiveCamera",n.fov=e.getValue("fov")}return t}},{key:"exportSceneLights",value:function(e){var t,n=[],r=Nf(e.findNodesOfType(Uc.TypeRTTI));try{for(r.s();!(t=r.n()).done;){var i=t.value,a={id:i.getSceneObjectId(),type:i.getType().getTypeName(),position:i.transform.position.toArray(),color:i.color.getHex(),intensity:i.intensity,cast_shadow:i.castShadow};switch(i.getType().getTypeName()){case Qc.TypeRTTI.getTypeName():var o=a;o.type="SpotLight",o.distance=i.distance,o.angle=i.angle,o.penumbra=i.penumbra,o.decay=i.decay,o.target=i.target.toArray();break;case qc.TypeRTTI.getTypeName():var s=a;s.type="DirectionalLight",s.target=i.target.toArray();break;case Yc.TypeRTTI.getTypeName():var u=a;u.type="HemisphereLight",u.ground_color=i.groundColor.getHex();break;case Xc.TypeRTTI.getTypeName():var c=a;c.type="PointLight",c.distance=i.distance,c.decay=i.decay;break;case Hc.TypeRTTI.getTypeName():a.type="AmbientLight"}n.push(a)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"exportMaterial",value:(a=t(r().mark((function t(n,i,a,o){var s,u,c,h,f,p,m,d,v,y,g,b;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s={id:i.id,physical:!1,name:i.name,type:i.type,alpha_test:i.alpha_test,blending:i.blending,depth_test:i.depth_test,depth_write:i.depth_write,fog:i.fog,lights:i.lights,opacity:i.opacity,premultiplied_alpha:i.premultiplied_alpha,shading:i.shading,side:i.side,transparent:i.transparent,ssrl:i.ssrl,render_order:i.render_order},!this.isBaseMaterial(i)){t.next=16;break}if(c=n,(u=s).ao_map_intensity=i.ao_map_intensity,u.diffuse=c.getDiffuseColor().getHex(),u.light_map_intensity=i.light_map_intensity,u.texture_sx=i.texture_sx,u.texture_sy=i.texture_sy,u.refraction_ratio=i.refraction_ratio,u.wireframe=i.wireframe,u.wireframe_line_width=i.wireframe_line_width,e.applyTextures(u,i,["alpha_map","ao_map","env_map","light_map","map"],o),!a){t.next=16;break}return t.next=16,e.applyMapOverwrite(u,a,(h={},(0,l.Z)(h,zs.ALPHA,"alpha_map"),(0,l.Z)(h,zs.AO,"ao_map"),(0,l.Z)(h,zs.ENVIRONMENT,"env_map"),(0,l.Z)(h,zs.LIGHTMAP,"light_map"),(0,l.Z)(h,zs.DIFFUSE,"map"),h),o);case 16:if(!this.isStandardMaterial(i)){t.next=28;break}if((f=s).emissive=i.emissive,f.emissive_map_intensity=i.emissive_map_intensity,f.bump_scale=i.bump_scale,f.displacement_scale=i.displacement_scale,f.displacement_bias=i.displacement_bias,f.normal_scale=i.normal_scale,e.applyTextures(f,i,["emissive_map","bump_map","displacement_map","normal_map"],o),!a){t.next=28;break}return t.next=28,e.applyMapOverwrite(f,a,(p={},(0,l.Z)(p,zs.EMISSIVE,"emissive_map"),(0,l.Z)(p,zs.BUMP,"bump_map"),(0,l.Z)(p,zs.DISPLACEMENT,"displacement_map"),(0,l.Z)(p,zs.NORMAL,"normal_map"),p),o);case 28:if(this.hasMaterialReflectivity(i)&&(s.reflectivity=i.reflectivity),!this.isMaterialStandardPhysical(i)){t.next=39;break}if((m=s).physical=!0,m.metalness=i.metalness,m.roughness=i.roughness,m.env_map_intensity=i.env_map_intensity,e.applyTextures(m,i,["metalness_map","roughness_map"],o),!a){t.next=39;break}return t.next=39,e.applyMapOverwrite(m,a,(d={},(0,l.Z)(d,zs.METALNESS,"metalness_map"),(0,l.Z)(d,zs.ROUGHNESS,"roughness_map"),d),o);case 39:return this.isMaterialBasicPhong(i)&&((v=s).physical=!1,v.combine=i.combine,e.applyTextures(v,i,["specular_map"],o)),this.isMaterialPhysical(i)&&((y=s).clear_coat=i.clear_coat,y.clear_coat_roughness=i.clear_coat_roughness),this.isMaterialPhong(i)&&((g=s).shininess=i.shininess,g.specular=i.specular),this.isMaterialExtended(i)&&((b=s).enable_fresnel_diff=i.enable_fresnel_diff,b.fresnel_diff_bias=i.fresnel_diff_bias,b.fresnel_diff_scale=i.fresnel_diff_scale,b.fresnel_diff_power=i.fresnel_diff_power,b.fresnel_diff_color_left=i.fresnel_diff_color_left,b.enable_fresnel_env=i.enable_fresnel_env,b.fresnel_env_bias=i.fresnel_env_bias,b.fresnel_env_scale=i.fresnel_env_scale,b.fresnel_env_power=i.fresnel_env_power),this.isMaterialPhongExt(i)&&(s.env_map_scale=i.env_map_scale),t.abrupt("return",s);case 45:case"end":return t.stop()}}),t,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"exportMaterialPbr",value:(i=t(r().mark((function t(n,i,a,o){var s,u,c;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=JSON.parse(JSON.stringify(i)),u=n,s.brdf_configuration=s.brdf_configuration||el.getDefaultPBRMaterialBRDFConfiguration(),s.detail_map_configuration=s.detail_map_configuration||el.getDefaultPBRMaterialDetailMapConfiguration(),s.clear_coat_configuration=s.clear_coat_configuration||el.getDefaultPBRMaterialClearCoatConfiguration(),s.sheen_configuration=s.sheen_configuration||el.getDefaultPBRMaterialSheenConfiguration(),s.anisotropic_configuration=s.anisotropic_configuration||el.getDefaultPBRMaterialAnisotropicConfiguration(),s.sub_surface_configuration=s.sub_surface_configuration||el.getDefaultPBRMaterialSubSurfaceConfiguration(),s.iridescence_configuration=s.iridescence_configuration||el.getDefaultPBRMaterialIridescenceConfiguration(),s.flags=s.flags||el.getDefaultPBRMaterialFlagsConfiguration(),s.diffuse_color=u.getDiffuseColor().getHex(),s.ambient_color=u.getAmbientColor().getHex(),s.emissive_color=u.getEmissiveColor().getHex(),s.reflection_color=u.getReflectionColor().getHex(),s.specular_color=u.getSpecularColor().getHex(),s.metallic_reflectance_color=u.getMetallicReflectanceColor().getHex(),s.clear_coat_configuration.tint_color=u.getClearCoatConfiguration().tintColor.getHex(),s.sheen_configuration.color=u.getSheenConfiguration().color.getHex(),s.sub_surface_configuration.tint_color=u.getSubSurfaceConfiguration().tintColor.getHex(),s.sub_surface_configuration.tint_color=u.getSubSurfaceConfiguration().diffusionDistance.getHex(),e.applyTextures(s,i,["diffuse_map","alpha_map","normal_map","ao_map","emissive_map","environment_brdf_map","light_map","reflection_map","specular_map","reflectance_map","micro_surface_map","metalness_map","metallic_reflectance_map","detail_map_configuration.map","clear_coat_configuration.map","clear_coat_configuration.roughness_map","clear_coat_configuration.bump_map","clear_coat_configuration.tint_map","sheen_configuration.roughness_map","anisotropic_configuration.map","sub_surface_configuration.thickness_map","sub_surface_configuration.refraction_map","sub_surface_configuration.refraction_intensity_map","sub_surface_configuration.translucency_intensity_map","iridescence_configuration.map","iridescence_configuration.thickness_map"],o),!a){t.next=24;break}return t.next=24,e.applyMapOverwrite(s,a,(c={},(0,l.Z)(c,zs.DIFFUSE,"diffuse_map"),(0,l.Z)(c,zs.ALPHA,"alpha_map"),(0,l.Z)(c,zs.NORMAL,"normal_map"),(0,l.Z)(c,zs.AO,"ao_map"),(0,l.Z)(c,zs.EMISSIVE,"emissive_map"),(0,l.Z)(c,zs.LIGHTMAP,"light_map"),c),o);case 24:return t.abrupt("return",s);case 25:case"end":return t.stop()}}),t)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"exportAttachment",value:function(e,t){var n=new Fi;e.forEach((function(e){var r=t.findIndex((function(t){return t.id===e}));if(-1!==r){var i=t[r],a=new Bi;Object.keys(i.levels||[]).forEach((function(e){var t=Number(e);i.levels&&i.levels[t]&&a.add(i.levels[t])}));var o=Bi.Zero(),s=Pi.identity(),u=Bi.One();i.matrix&&(new Fi).set(i.matrix[0],i.matrix[1],i.matrix[2],i.matrix[3],i.matrix[4],i.matrix[5],i.matrix[6],i.matrix[7],i.matrix[8],i.matrix[9],i.matrix[10],i.matrix[11],i.matrix[12],i.matrix[13],i.matrix[14],i.matrix[15]).decompose(o,s,u);var c=new Fi,l=(new Fi).makeTranslation(o.x,o.y,o.z);c.multiply(l);var h=(new Fi).makeRotationFromQuaternion(s.multiply(i.rotation));c.multiply(h);var f=(new Fi).makeScale(u.x,u.y,u.z);c.multiply(f);var p=(new Fi).makeTranslation(a.x,a.y,a.z);c.premultiply(p),n.multiply(c)}}));var r=e.join("/"),i=r.length>0?r:"default_attachment",a=Bi.Zero(),o=Pi.identity(),s=Bi.One();n.decompose(a,o,s);var u=(new Li).setFromQuaternion(o);return{id:i,name:i,visible:!0,matrix:n.toArray(),position:a.toArray(),quaternion:o.toArray(),rotation:u.toArray(),scale:s.toArray()}}},{key:"findProductNode",value:function(e){var t,n=f.Ft.resolveInt(e),r=f.Ft.resolveUuid(e);return void 0===r&&void 0===n?P.sceneManager().getRootProductNode():(P.sceneManager().findNodesOfType(Pc.TypeRTTI).every((function(e){return r&&e.getObjectUUID()===r?(t=e,!1):!(!r&&e.getSceneObjectId()===n)||(t=e,!1)})),t)}},{key:"applyTextures",value:function(e,t,n,r){var i,a=Nf(n);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=(0,f.sK)(t,o);if(null!=s)if("string"==typeof s)(0,f.$p)(e,o,s);else{var u=r[s];if(!u)continue;"string"==typeof u?(0,f.$p)(e,o,u):(0,f.$p)(e,o,u.lod0_url)}}}catch(e){a.e(e)}finally{a.f()}}},{key:"applyMapOverwrite",value:(n=t(r().mark((function e(t,n,i,a){var o,s,u,c,l,h;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=tc.getManager(Qu.TextureManager),s=Nf(n.getMapOverwrites()),e.prev=2,s.s();case 4:if((u=s.n()).done){e.next=24;break}if(c=u.value,i[c.type]){e.next=8;break}return e.abrupt("continue",22);case 8:if(void 0!==(l=o.findResourceWithHandle(c.handle)).getId()){e.next=11;break}return e.abrupt("continue",22);case 11:if(h=void 0,!(l.getId()in a)){e.next=16;break}h=a[l.getId()],e.next=19;break;case 16:return e.next=18,$s.getInstance().resolveModel(l.getId());case 18:h=e.sent;case 19:if(h){e.next=21;break}return e.abrupt("continue",22);case 21:t[i[c.type]]="string"==typeof h?h:h.lod0_url;case 22:e.next=4;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(2),s.e(e.t0);case 29:return e.prev=29,s.f(),e.finish(29);case 32:case"end":return e.stop()}}),e,null,[[2,26,29,32]])}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"isBaseMaterial",value:function(e){return/(Standard|Physical|Basic|Phong)/i.test(e.type)}},{key:"isStandardMaterial",value:function(e){return/(Standard|Physical|Phong)/i.test(e.type)}},{key:"hasMaterialReflectivity",value:function(e){return/(Basic|Physical|Phong)/i.test(e.type)}},{key:"isMaterialBasicPhong",value:function(e){return/(Basic|Phong)/i.test(e.type)}},{key:"isMaterialStandardPhysical",value:function(e){return/(Standard|Physical)/i.test(e.type)}},{key:"isMaterialPhysical",value:function(e){return/(Physical)/i.test(e.type)}},{key:"isMaterialPhong",value:function(e){return/(Phong)/i.test(e.type)}},{key:"isMaterialExtended",value:function(e){return/(PhongExt|PhysicalExt)/i.test(e.type)}},{key:"isMaterialPhongExt",value:function(e){return/(PhongExt)/i.test(e.type)}},{key:"isMaterialPbr",value:function(e){return"PbrMaterial"===e.type}}]),e}(),Uf=function(){function e(){(0,u.Z)(this,e)}var n;return(0,c.Z)(e,null,[{key:"resolveWebArFiles",value:function(e,t){var n=e.find((function(e){var n=e.substr(e.lastIndexOf(".")+1);return"usdz"===t?"usdz"===n:"gltf"!==t||("gltf"===n||"glb"===n)}));if((0,p.isNullOrUndefined)(n))throw"File not found.";return n}},{key:"requestNewArFile",value:(n=t(r().mark((function e(t,n,i,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){ei.getInstance().post("".concat(Jr.E.apiUrl,"ar/request"),{esd:i,hash:n,catalogue_id:t,format:a}).then((function(t){if("complete"===t.data.status)e(t.data.files);else if("in_progress"===t.data.status)var i=setInterval((function(){ei.getInstance().get("".concat(Jr.E.apiUrl,"ar/check/").concat(n)).then((function(t){return"complete"===t.data.status?(clearInterval(i),e(t.data.files)):"not_processing"===t.data.status||"failed"===t.data.status?(clearInterval(i),r()):void 0}),(function(e){return clearInterval(i),r(e)}))}),1e3);else r()}),(function(e){r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r,i){return n.apply(this,arguments)})}]),e}();function Vf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Hf=function(e){(0,g.Z)(s,e);var n,i,a=Vf(s);function s(){var e;return(0,u.Z)(this,s),e=a.call(this,"toolbar-webar-component"),(0,l.Z)((0,_.Z)(e),"mController",void 0),e}return(0,c.Z)(s,[{key:"OnAttached",value:function(){var e=this;Ni((0,M.Z)(s.prototype),"OnAttached",this).call(this),this.mController=this.getParentObject(),this.registerMessageHandler(Be.TypeRTTI,(function(){var t=e.getParentObject();t.getValue("busy")||(t.setValue("busy",!0),e.action().then((function(e){t.setValue("busy",!1),Array.isArray(e)&&t.setValue("arqr",e)}),(function(n){qe.qL.error(n),t.setValue("busy",!1),e.mController.onError.next("Could not load AR file.")})))}))}},{key:"OnDetached",value:function(){this.unregisterMessageHandler(Be.TypeRTTI)}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(Fc.TypeRTTI)}},{key:"action",value:(i=t(r().mark((function e(){var n,i,a,o,s,u,c,l,h,f,p,m=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=xi(),i=li()&&n===yi.iOS?window.open("","_blank"):null,qe.qL.print("Try to retrieve AR file..."),a=P.sceneManager().findNodesOfType(Pc.TypeRTTI),o=a.find((function(e){return null===e.getValue("parent_id")}))){e.next=7;break}return e.abrupt("return");case 7:return s=o.productId,qe.qL.print("AR file for product:",s),u=a.map(function(){var e=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",m.getHashFromProduct(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.t0=y.F,e.next=13,Promise.all(u);case 13:return e.t1=e.sent.join(""),c=e.t0.Md5.call(e.t0,e.t1),l=wi()||Mi()?"usdz":"gltf",e.next=18,zf.exportEsd();case 18:return h=e.sent,e.next=21,Uf.requestNewArFile(s,c,h,l);case 21:if(f=e.sent,!wi()){e.next=24;break}return e.abrupt("return",f);case 24:p=Uf.resolveWebArFiles(f,l),this.openLink(p,n,i);case 26:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"getHashFromProduct",value:(n=t(r().mark((function e(t){var n,i,a,s,u,c,l,h,f,p,m,d,v,g,b,M,k,_,x;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getComponent("attributeManager"),i=t.getComponent("catalogueSettings"),a=t.getComponent("materialGroupManager"),e.next=5,Promise.all([St(n.resolveAttributeManager()),St(i.resolveSettings()),St(a.resolveMaterialGroups())]);case 5:return s=e.sent,u=o(s,3),c=u[0],l=u[1],h=u[2],f=t.productId,p=c.serialize({discard_hidden:!1,include_keys:!1,calculate_approximations:!1}),m=y.F.Md5(JSON.stringify(p)),d=h.buildQueryParams(!1),v=Ti()?ti.Mobile:ti.Desktop,g=l.getSceneDeviceSettings(v),b=parseInt(g.compression,10),M=Object.keys(d).map((function(e){return"".concat(e,":").concat(d[e])})).join("/"),k=l.getGraphRevId(),_=l.getSceneRevId(),x="".concat(f,"/").concat(k,"/").concat(_,"/").concat(b,"/").concat(m,"/").concat(M,"/"),e.abrupt("return",y.F.Md5(x));case 22:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"openLink",value:function(e,t,n){var r="";if(t===yi.Android){qe.qL.print("Opening AR file for Android.");r="".concat("intent://arvr.google.com/scene-viewer/1.1","?file=").concat(encodeURIComponent(e),"&mode=").concat("ar_preferred","&enable_vertical_placement=").concat("true","&resizable=").concat("true","#Intent;scheme=").concat("https",";package=").concat("com.google.android.googlequicksearchbox;action=android.intent.action.VIEW",";S.browser_fallback_url=").concat("https://developers.google.com/ar",";end;")}else{if(t!==yi.iOS)return qe.qL.print("Can not open AR file as device is unknown."),void(n&&n.close());qe.qL.print("Opening AR file for iOS."),r=e}if(qe.qL.print("Url to webar file: ".concat(r)),n)n.location.href=r;else{var i=document.createElement("a"),a=document.createElement("img");i.appendChild(a),i.href=r,i.style.display="none",t===yi.iOS&&(i.rel="ar"),document.body.appendChild(i),i.click(),i.remove()}}},{key:"getType",value:function(){return s.TypeRTTI}}]),s}(_a);function Gf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Hf,"TypeRTTI",new k.r("WebArComponent",_a.TypeRTTI));var qf=function(e){(0,g.Z)(n,e);var t=Gf(n);function n(){var e,r;(0,u.Z)(this,n);var i=null===(e=(r=t.call(this,{name:"freemium",enabled:!0,position:xa.BOTTOM_LEFT,icon:'\n                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="Laag_1" x="0px" y="0px" viewBox="0 0 722.8 354.3" style="enable-background:new 0 0 722.8 354.3;" xml:space="preserve">\n                    <style type="text/css">\n                        .st0{fill:#FF4B00;}\n                    </style>\n                    <g>\n                        <path class="st0" d="M161,74.7L72.2,126v102.5l88.8,51.3l88.8-51.3V126L161,74.7z M161,248.6l-24.4-14.1l24.4-14.1l24.4,14.1   L161,248.6z M222.7,186.5l-22.8,13.2v26.5l-8.4,4.8L164,215.1v-9.2l14.2-8.2v-7h-34.5v7l14.3,8.2v9.2L130.5,231l-8.4-4.8v-26.5   l-22.8-13.2v-44.9l38.9-22.4l22.9,13.2l22.8-13.2l38.9,22.4V186.5z"></path>\n                        <polygon class="st0" points="178.2,173.2 189.8,173.2 206,163.9 206,161.7 178.2,161.7  "></polygon>\n                        <polygon class="st0" points="116,163.9 132.1,173.2 143.7,173.2 143.7,161.7 116,161.7  "></polygon>\n                        <polygon points="359.7,168.4 359.7,183 309.7,183 309.7,214.1 368.1,214.1 368.1,228.5 292.6,228.5 292.6,126.1 366.7,126.1    366.7,140.6 309.7,140.6 309.7,168.4  "></polygon>\n                        <polygon points="392.7,155.3 409.4,181.1 409.6,181.1 426.3,155.3 443.3,155.3 418.7,191.1 446,228.5 428.5,228.5 409.6,201    409.4,201 390.7,228.5 373.1,228.5 400.5,191.1 375.7,155.3  "></polygon>\n                        <path d="M523.5,192c0,24.1-13.9,38.7-32.5,38.7c-11.5,0-18.6-5.4-22.5-10.9h-0.3v33.7H453v-98.1h15.2v8.6h0.3   c3.9-5.2,11-10.6,22.5-10.6C509.6,153.3,523.5,167.9,523.5,192 M508.3,192c0-14.3-7-26.4-20.2-26.4c-12.2,0-19.8,10-19.8,26.4   s7.6,26.4,19.8,26.4C501.3,218.4,508.3,206.4,508.3,192"></path>\n                        <path d="M533.3,135c0-5.2,4.3-7.9,8.5-7.9c4.5,0,8.6,2.7,8.6,7.9s-4.2,8-8.6,8C537.6,143,533.3,140.1,533.3,135 M549.3,228.6h-15   v-73.2h15V228.6z"></path>\n                        <polygon points="573.5,155.3 591.9,212.6 592.1,212.6 610.5,155.3 626.5,155.3 600.5,228.5 583.5,228.5 557.5,155.3  "></polygon>\n                        <path d="M633.6,135c0-5.2,4.3-7.9,8.5-7.9c4.4,0,8.6,2.7,8.6,7.9s-4.2,8-8.6,8C637.9,143,633.6,140.1,633.6,135 M649.6,228.6h-15   v-73.2h15V228.6z"></path>\n                    </g>\n                </svg>\n            ',protect_mutation:!0})).mSettings.getProductPresentationSettings())||void 0===e?void 0:e.show_branding,a=r.mSettings.isModuleEnabled("freemium"),o=i||a;return r.setValue("enabled",o),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(Ra);function Wf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(qf,"TypeRTTI",new k.r("FreemiumToolbarItemController",Ra.TypeRTTI));var Yf=function(e){(0,g.Z)(a,e);var n,i=Wf(a);function a(){var e;return(0,u.Z)(this,a),e=i.call(this,"toolbar-freemium-component"),(0,l.Z)((0,_.Z)(e),"mController",void 0),e}return(0,c.Z)(a,[{key:"OnAttached",value:function(){var e=this;Ni((0,M.Z)(a.prototype),"OnAttached",this).call(this),this.mController=this.getParentObject(),this.registerMessageHandler(Be.TypeRTTI,t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.action();case 3:t.next=8;break;case 5:t.prev=5,t.t0=t.catch(0),qe.qL.error(t.t0);case 8:case"end":return t.stop()}}),t,null,[[0,5]])}))))}},{key:"OnDetached",value:function(){}},{key:"action",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){return window.open("https://www.expivi.com/"),e()})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(qf.TypeRTTI)}},{key:"getType",value:function(){return a.TypeRTTI}}]),a}(_a);(0,l.Z)(Yf,"TypeRTTI",new k.r("FreemiumToolbarComponent",_a.TypeRTTI));var Kf=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,[{key:"createObject",value:function(t){for(var n=this,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];var o=null;if(t in e.mFactories){var s=e.mFactories[t],u=(0,p.isUndefined)(s.view)?s:s.view,c=s.components||[],l=s.children||[];o=(0,p.isUndefined)(i)?new u:Ma(u,i),c.forEach((function(e){o.addComponent(new e)})),l.forEach((function(e){var t=n.createObject.apply(n,[e].concat(i));t.parent=o,o.children.push(t)}))}return o}}]),e}();(0,l.Z)(Kf,"mFactories",{web_ar:{view:Fc,components:[Hf]},fullscreen:{view:Sa,components:[Ea]},social:{view:Oa,components:[Pa],children:["social_facebook","social_whatsapp"]},social_facebook:{view:Fa,components:[Na]},social_whatsapp:{view:za,components:[Va]},freemium:{view:qf,components:[Yf]}});var Xf=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mViewRenderCanvas",void 0),(0,l.Z)(this,"mFactory",void 0),(0,l.Z)(this,"mItems",[]),this.mViewRenderCanvas=t,this.mFactory=new Kf}return(0,c.Z)(e,[{key:"init",value:function(){this.mItems.push(this.mFactory.createObject("freemium"),this.mFactory.createObject("social"),this.mFactory.createObject("web_ar"),this.mFactory.createObject("fullscreen",this.mViewRenderCanvas))}},{key:"dispose",value:function(){this.mItems.splice(0)}},{key:"getItems",value:function(){return this.mItems}}]),e}();function $f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Qf=function(e){(0,g.Z)(n,e);var t=$f(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mViewContainer",void 0),(0,l.Z)((0,_.Z)(r),"mViewerComponent",void 0),(0,l.Z)((0,_.Z)(r),"mControllers",new Array),(0,l.Z)((0,_.Z)(r),"mInitialized",!1),r.mViewerComponent=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"setViewContainer",value:function(e){this.mViewContainer=e}},{key:"getViewComponent",value:function(){return this.mViewerComponent}},{key:"getViewContainer",value:function(){return this.mViewContainer}},{key:"initialize",value:function(){var e=this;this.mControllers.forEach((function(t){e.addComponent(t)})),this.mInitialized=!0}},{key:"dispose",value:function(){this.removeAllComponents(),this.mInitialized=!1}},{key:"resize",value:function(e,t){this.dispatchMessage(new Ae(e,t))}},{key:"mouseDown",value:function(e){this.dispatchMessage(new Y("down",e))}},{key:"mouseUp",value:function(e){this.dispatchMessage(new Y("up",e))}},{key:"mouseMove",value:function(e){this.dispatchMessage(new Y("move",e))}},{key:"mouseLeave",value:function(e){this.dispatchMessage(new Y("out",e))}},{key:"mouseDbClick",value:function(e){this.dispatchMessage(new Y("dbclick",e))}},{key:"dragStart",value:function(e){this.dispatchMessage(new F("start",e.position,e.dragData))}},{key:"dragMove",value:function(e){this.dispatchMessage(new F("move",e.position,e.dragData))}},{key:"dragEnd",value:function(e){this.dispatchMessage(new F("leave",e.position,e.dragData))}},{key:"dropItem",value:function(e){this.dispatchMessage(new F("drop",e.position,e.dragData))}},{key:"update",value:function(e){this.dispatchMessage(new je(e))}},{key:"addController",value:function(e){this.mControllers.push(e),this.mInitialized&&this.addComponent(e)}}]),n}(ze.L);(0,l.Z)(Qf,"TypeRTTI",new k.r("ViewportRenderer",ze.L.TypeRTTI));var Jf=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,u.Z)(this,e),(0,l.Z)(this,"mParentContainer",void 0),(0,l.Z)(this,"mViewLayerOptions",void 0),(0,l.Z)(this,"mLayerContainer",void 0),(0,l.Z)(this,"mLayerIndex",void 0),(0,l.Z)(this,"mInitialized",!1),(0,l.Z)(this,"mIsAttached",!1),this.mLayerIndex=t,this.mViewLayerOptions=n}return(0,c.Z)(e,[{key:"init",value:function(){this.mLayerContainer=this.createContainer(),this.mLayerContainer&&(this.mLayerContainer.style.zIndex="".concat(this.getLayerIndex())),this.mInitialized=!0}},{key:"destroyContainer",value:function(){this.detach()}},{key:"attach",value:function(){this.mIsAttached||(this.mLayerContainer&&this.mParentContainer.appendChild(this.mLayerContainer),this.mIsAttached=!0)}},{key:"detach",value:function(){this.mIsAttached&&(this.mParentContainer.removeChild(this.mLayerContainer),this.mIsAttached=!1)}},{key:"destroy",value:function(){this.destroyContainer(),this.mLayerContainer&&delete this.mLayerContainer}},{key:"setParentContainer",value:function(e){this.mParentContainer=e}},{key:"getLayerContainer",value:function(){return this.mLayerContainer}},{key:"getLayerIndex",value:function(){return this.mLayerIndex}},{key:"isLayerAttached",value:function(){return this.mIsAttached}},{key:"isLayerInitialized",value:function(){return this.mInitialized}}]),e}();function ep(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var tp=function(e){(0,g.Z)(n,e);var t=ep(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"mLoadingIcon",void 0),(0,l.Z)((0,_.Z)(i),"mArQrContainer",void 0),(0,l.Z)((0,_.Z)(i),"mToolbar",void 0),(0,l.Z)((0,_.Z)(i),"mGlobalStyleElement",void 0),(0,l.Z)((0,_.Z)(i),"mItems",{}),(0,l.Z)((0,_.Z)(i),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(i),"mEnabled",!0),i.mToolbar=r.toolbar,Object.keys(xa).forEach((function(e){i.mItems[e]=[]})),i}return(0,c.Z)(n,[{key:"createContainer",value:function(){this.initializeGlobalStyle();var e=document.createElement("div");return e.classList.add("xpv__viewer_toolbar_container"),this.mLoadingIcon=this.getLoadingIcon(),this.mArQrContainer=this.getArQrContainer(),this.mParentContainer.appendChild(this.mLoadingIcon),this.mParentContainer.appendChild(this.mArQrContainer),e}},{key:"destroyContainer",value:function(){this.mLoadingIcon&&(this.mLoadingIcon.remove(),delete this.mLoadingIcon),this.mArQrContainer&&(this.mArQrContainer.remove(),delete this.mArQrContainer),this.mGlobalStyleElement.remove(),delete this.mGlobalStyleElement,Ni((0,M.Z)(n.prototype),"destroyContainer",this).call(this)}},{key:"init",value:function(){var e=this;Ni((0,M.Z)(n.prototype),"init",this).call(this),this.mToolbar.getItems().filter((function(e){return!0===e.getValue("enabled")})).forEach((function(t){var n=t.getChildren();n.length>0?e.mLayerContainer.appendChild(e.createGroup(t,n)):e.mLayerContainer.appendChild(e.createToolbarElement(t))}))}},{key:"createToolbarElement",value:function(e,t){var n=this.createItemButton(e,t);return e.getValue("protect_mutation")&&this.setProtectMutation(e),n}},{key:"getLoadingIcon",value:function(){var e=document.createElement("div");return e.innerHTML='\n            <div id="xpv-toolbar-loader" hidden>\n                <div id="xpv-toolbar-loader-icon"></div>\n                <div id="xpv-toolbar-loader-message">Loading...</div>\n            </div>\n        ',e.firstElementChild}},{key:"getArQrContainer",value:function(){var e=document.createElement("div");e.innerHTML='\n            <div id="xpv-toolbar-ar-qr" hidden>\n                <div id="xpv-toolbar-ar-qr-code"></div>\n                <div id="xpv-toolbar-ar-qr-message">\n                    Scan the code with a compatible\n                    <br>\n                    Android/iOS device\n                </div>\n            </div>\n        ';var t=e.firstElementChild;return t.addEventListener("click",(function(){t.hidden=!0})),t}},{key:"listenToStateChange",value:function(e){var t=this,n=e.onStateChange.subscribe({next:function(e){t.itemStateChange(e)},error:function(e){qe.qL.error("Toolbar state failed: ",e)}});this.mSubscriptions.push(n)}},{key:"getButtonIcon",value:function(e){var t=e.getValue("icon");if(t){var n=document.createElement("div");n.innerHTML=t;var r=n.firstElementChild;return r.classList.add("xpv-toolbar-item-icon"),r}var i=e.getValue("image_source"),a=document.createElement("img");return a.src=i,a.alt="",a}},{key:"getButtonIconInverted",value:function(e){var t=e.getValue("icon_inverted");if(!t)return null;var n=document.createElement("div");n.innerHTML=t;var r=n.firstElementChild;return r.classList.add("xpv-toolbar-item-icon-inverted"),r}},{key:"createItemButton",value:function(e,t){var n=this;e.onError.subscribe({next:function(e){null!==e&&e.length>0&&alert(e)},error:function(){}});var r=document.createElement("button"),i=e.getValue("name");if(i&&(r.id="xpv-toolbar-item-".concat(i)),r.type="button",!t){var a=e.getValue("position"),o=this.getClassNameFromPosition(a);r.classList.add(o)}var s=this.getButtonIcon(e);r.appendChild(s);var u=this.getButtonIconInverted(e);return u&&r.appendChild(u),r.addEventListener("click",(function(t){n.mEnabled&&e.getValue("enabled")&&e.dispatchMessageToComponents(new Be(t))})),this.listenToStateChange(e),r}},{key:"getClassNameFromPosition",value:function(e){switch(e){case"TOP_LEFT":return"top-left";case"TOP_RIGHT":return"top-right";case"BOTTOM_LEFT":return"bottom-left";default:return"bottom-right"}}},{key:"createGroup",value:function(e,t){var n=this,r=document.createElement("div");r.classList.add("xpv__viewer_toolbar_group_container");var i=document.createElement("div");i.classList.add("xpv__viewer_toolbar_group");var a=document.createElement("div"),o=this.createToolbarElement(e),s=e.getValue("position"),u=this.getClassNameFromPosition(s);r.classList.add(u);var c=!1,l=!1;return t.filter((function(e){return!0===e.getValue("enabled")})).forEach((function(t){var r=n.createToolbarElement(t,e);if("social"===t.getSetting("name")){var i=t.getSetting("scope");r.classList.add(i)}!0===t.getSetting("mobile")&&(r.classList.add("mobile-enabled"),c=!0),!0===t.getSetting("desktop")&&(r.classList.add("desktop-enabled"),l=!0),a.appendChild(r)})),c||(o.classList.add("mobile-disabled"),i.classList.add("mobile-disabled")),l||(o.classList.add("desktop-disabled"),i.classList.add("desktop-disabled")),"social"===e.getSetting("name")&&o.classList.add("expand_social_channels"),i.appendChild(a),r.appendChild(o),r.appendChild(i),o.addEventListener("click",(function(){r.classList.toggle("open")})),r}},{key:"destroy",value:function(){for(var e in this.mItems)this.mItems[e].splice(0).forEach((function(e){e.item&&e.item.remove(),e.group&&e.group.remove()}));this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),Ni((0,M.Z)(n.prototype),"destroy",this).call(this)}},{key:"enable",value:function(){this.mEnabled=!0,this.mLayerContainer.hidden=!1}},{key:"disable",value:function(){this.mEnabled=!1,this.mLayerContainer.hidden=!0}},{key:"itemStateChange",value:function(e){switch(e.name){case"busy":if(!0===e.value){var t=this.mLoadingIcon.querySelector("#xpv-toolbar-loader-icon"),n=this.mLoadingIcon.querySelector("#xpv-toolbar-loader-message"),r=e.message,i=void 0===r?"":r,a=e.icon,o=void 0===a?"":a;t&&(t.innerHTML="string"==typeof o?o:o.innerHTML),n&&(n.textContent=i),this.mLoadingIcon.hidden=!1}else this.mLoadingIcon.hidden=!0;break;case"sharing":e.value&&P.eventBus().dispatch(new Di(Ei.Shared,e.value));break;case"arqr":if(!0===e.value){var s=this.mArQrContainer.querySelector("#xpv-toolbar-ar-qr-code");s&&e.icon&&e.icon instanceof HTMLElement&&(s.innerHTML="",s.append(e.icon)),this.mArQrContainer.hidden=!1,P.eventBus().dispatch(new Di(Ei.QrWebAr,{enabled:e.value,icon:e.icon}))}else this.mArQrContainer.hidden=!0;break;case"inverted":var u=this.mLayerContainer.querySelector("#xpv-toolbar-item-".concat(e.item.getValue("name")));if(!u)return;u.classList.toggle("xpv-toolbar-item-inverted",e.value)}}},{key:"setProtectMutation",value:function(e){var t=this,n=e.getValue("name"),r=function(){var r=t.mLayerContainer.querySelector("#xpv-toolbar-item-".concat(n));r&&r.remove(),t.mLayerContainer.prepend(t.createToolbarElement(e))},i=new MutationObserver((function(e){e.forEach((function(e){if(e.target instanceof HTMLElement&&e.target.closest("#xpv-toolbar-item-".concat(n)))return i.disconnect(),void r();e.removedNodes.forEach((function(e){e instanceof HTMLElement&&("svg"!==e.tagName&&e.id!=="xpv-toolbar-item-".concat(n)||(i.disconnect(),r()))}))}))}));i.observe(this.mLayerContainer,{subtree:!0,childList:!0,attributes:!0})}},{key:"initializeGlobalStyle",value:function(){this.mGlobalStyleElement=He.createElement("style"),document.getElementsByTagName("head")[0].appendChild(this.mGlobalStyleElement),He.setAttribute(this.mGlobalStyleElement,"type","text/css"),He.setHtml(this.mGlobalStyleElement,'.xpv__viewer_toolbar_container .mobile-enabled,\n            .xpv__viewer_toolbar_container .desktop-enabled {\n                display: none;\n            }\n\n            @media screen and (max-width: 768px){\n                .xpv__viewer_toolbar_container .mobile-disabled {\n                    display: none;\n                }\n                .xpv__viewer_toolbar_container .mobile-enabled {\n                    display: block;\n                }\n            }\n\n            @media screen and (min-width: 769px){\n                .xpv__viewer_toolbar_container .desktop-disabled {\n                    display: none;\n                }\n                .xpv__viewer_toolbar_container .desktop-enabled {\n                    display: block;\n                }\n            }\n\n            /*\n                The toolbar is one big flex container. It orders the elements like so:\n\n                 ______________________\n                | 1                  2 |\n                |                      |\n                |                      |\n                |          3           |\n                |      [::after]       |\n                |                      |\n                | 4                  5 |\n                |______________________|\n\n                The ::after element is there purely to force the flex-wrap. The elements\n                get positioned properly using the .top-left, .top-right, .bottom-left and\n                .bottom-right classes (exactly one of those is required).\n            */\n\n            .xpv__viewer_toolbar_container::after {\n                content: "";\n                order: 3;\n                display: block;\n                width: 100%;\n            }\n\n            .xpv__viewer_toolbar_container {\n                display: flex;\n                flex-flow: row wrap;\n                align-items: flex-end;\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                pointer-events: none;\n                opacity: 0;\n                transition: opacity 1s 4.5s;\n            }\n\n            .xpv__viewer_toolbar_container > * {\n                pointer-events: all;\n            }\n\n            /*\n                Set the position for each corner\n            */\n\n            .xpv__viewer_toolbar_container .top-left {\n                order: 1;\n                align-self: flex-start;\n            }\n            .xpv__viewer_toolbar_container .top-right {\n                order: 2;\n                align-self: flex-start;\n            }\n            .xpv__viewer_toolbar_container .bottom-left {\n                order: 4;\n                align-self: flex-end;\n            }\n            .xpv__viewer_toolbar_container .bottom-right {\n                order: 5;\n                align-self: flex-end;\n            }\n\n            /*\n                Force the items to justify correctly,\n                i.e. force the right side to the right and the left side to the left\n            */\n\n            .xpv__viewer_toolbar_container .top-right { margin-left: auto; }\n            .xpv__viewer_toolbar_container .top-right ~ .top-right { margin-left: 6px; }\n\n            .xpv__viewer_toolbar_container .bottom-right { margin-left: auto; }\n            .xpv__viewer_toolbar_container .bottom-right ~ .bottom-right { margin-left: 6px; }\n\n            .xpv__viewer_toolbar_container button {\n                height: 48px;\n                padding: 6px;\n                margin: 6px;\n                position: relative;\n                color: inherit;\n                background-color: rgba(224, 224, 224, 0.4);\n                border-radius: 30px;\n                border: none;\n                outline: none;\n                cursor: pointer;\n                transition: .3s;\n            }\n\n            .xpv__viewer_toolbar_container button > svg,\n            .xpv__viewer_toolbar_container button > img {\n                height: 100%;\n            }\n\n            .xpv__viewer_toolbar_container button:hover,\n            .xpv__viewer_toolbar_container button:focus {\n                background-color: rgba(175, 175, 175, .4);\n            }\n\n            .xpv__viewer_toolbar_container button:active {\n                background-color: rgba(155, 155, 155, .5);\n            }\n\n            /*\n                Toolbar should appear when hovering the viewer\n            */\n\n            :hover ~ .xpv__viewer_toolbar_container,\n            .interacted > .xpv__viewer_toolbar_container,\n            .xpv__viewer_toolbar_container:hover {\n                opacity: 1;\n                transition: opacity 0s 0s;\n            }\n\n            .xpv__viewer_toolbar_container:focus-within {\n                opacity: 1;\n                transition: opacity 0s 0s;\n            }\n\n            .xpv__viewer_toolbar_group_container {\n                position: relative;\n            }\n\n            .xpv__viewer_toolbar_group_container:not(.open) .xpv__viewer_toolbar_group {\n                opacity: 0;\n                pointer-events: none;\n                transform: scale(0.9, .85);\n            }\n\n            .xpv__viewer_toolbar_group {\n                position: absolute;\n                top: 0;\n                background-color: rgb(238, 238, 238);\n                border-radius: 30px;\n                transition: .3s;\n            }\n\n            .xpv__viewer_toolbar_group > div {\n                display: flex;\n                flex-direction: row;\n            }\n\n            .xpv__viewer_toolbar_group::before {\n                content: "";\n                display: block;\n                width: 30px;\n                height: 30px;\n                position: absolute;\n                top: 50%;\n                transform: translateY(-50%) rotate(45deg);\n                background-color: inherit;\n            }\n\n            .xpv__viewer_toolbar_group_container.top-left .xpv__viewer_toolbar_group {\n                left: calc(100% + 12px);\n                transform-origin: -12px 50%;\n            }\n            .xpv__viewer_toolbar_group_container.top-right .xpv__viewer_toolbar_group {\n                right: calc(100% + 12px);\n                transform-origin: calc(100% + 12px) 50%;\n            }\n            .xpv__viewer_toolbar_group_container.bottom-left .xpv__viewer_toolbar_group,\n            .xpv__viewer_toolbar_group_container.bottom-right .xpv__viewer_toolbar_group {\n                top: auto;\n                bottom: calc(100% + 12px);\n                transform-origin: 50% calc(100% + 12px);\n            }\n            .xpv__viewer_toolbar_group_container.bottom-left .xpv__viewer_toolbar_group {\n                left: 0;\n            }\n            .xpv__viewer_toolbar_group_container.bottom-right .xpv__viewer_toolbar_group {\n                right: 0;\n            }\n\n            .xpv__viewer_toolbar_group_container.top-left .xpv__viewer_toolbar_group::before {\n                left: -2px;\n            }\n            .xpv__viewer_toolbar_group_container.top-right .xpv__viewer_toolbar_group::before {\n                right: -2px;\n            }\n\n            .xpv__viewer_toolbar_group_container.bottom-left .xpv__viewer_toolbar_group::before {\n                top: 75%;\n                left: 15px;\n            }\n            .xpv__viewer_toolbar_group_container.bottom-right .xpv__viewer_toolbar_group::before {\n                top: 75%;\n                right: 15px;\n            }\n\n            #xpv-toolbar-loader {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                padding: 12px 18px;\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                color: white;\n                background-color: rgb(0, 0, 0, 0.4);\n                border-radius: 12px;\n                z-index: 4;\n            }\n\n            #xpv-toolbar-loader[hidden] { display: none; }\n\n            #xpv-toolbar-loader-icon { height: 60px; }\n            #xpv-toolbar-loader-icon > * { height: 100%; }\n\n            #xpv-toolbar-loader-message {\n                font: 20px / 1.5 Arial, sans-serif;\n            }\n\n            #xpv-toolbar-ar-qr {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                padding: 18px;\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                color: white;\n                background-color: rgb(0, 0, 0, 0.4);\n                cursor: pointer;\n                z-index: 4;\n            }\n\n            #xpv-toolbar-ar-qr[hidden] { display: none; }\n\n            #xpv-toolbar-ar-qr-code { margin-bottom: 8px; }\n            #xpv-toolbar-ar-qr-message {\n                text-align: center;\n                font: 20px / 1.3 Arial, sans-serif;\n            }\n\n            .xpv-toolbar-item-icon {\n                display: inline-block;\n            }\n            .xpv-toolbar-item-icon-inverted {\n                display: none;\n            }\n\n            .xpv-toolbar-item-inverted .xpv-toolbar-item-icon {\n                display: none;\n            }\n            .xpv-toolbar-item-inverted .xpv-toolbar-item-icon-inverted {\n                display: inline-block;\n            }')}}]),n}(Jf);function np(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var rp,ip,ap,op=function(e){(0,g.Z)(n,e);var t=np(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getViewportRenderer",value:function(){return this.getParentObject()}},{key:"isAttachable",value:function(e){return e.isTypeName("ViewportRenderer")}}]),n}(Xi.H);function sp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(op,"TypeRTTI",new k.r("ViewportController",Xi.H.TypeRTTI)),function(e){e[e.Linear=0]="Linear",e[e.EaseIn=1]="EaseIn",e[e.EaseOut=2]="EaseOut",e[e.EaseInOut=3]="EaseInOut",e[e.Brezier=4]="Brezier",e[e.Parametric=5]="Parametric"}(rp||(rp={})),function(e){e[e.Default=0]="Default",e[e.Parent=1]="Parent",e[e.Always=2]="Always",e[e.OnlySelf=3]="OnlySelf"}(ip||(ip={})),function(e){e[e.color=0]="color",e[e.equirect=1]="equirect",e[e.image=2]="image",e[e.skybox=3]="skybox",e[e.transparent=4]="transparent",e[e.environment=5]="environment",e[e.LAST_INDEX=6]="LAST_INDEX"}(ap||(ap={}));var up=function(e){(0,g.Z)(n,e);var t=sp(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"equalsBackgroundType",value:function(e){var t=e;return"function"==typeof t.getBackgroundType&&t.getBackgroundType()===this.getBackgroundType()}}]),n}(to);function cp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var lp=function(e){(0,g.Z)(n,e);var t=cp(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"getType",value:function(){return Xa.background}},{key:"getBackgroundType",value:function(){return ap.transparent}},{key:"equals",value:function(e){return this.equalsBackgroundType(e)}}]),n}(up);function hp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var fp=function(e){(0,g.Z)(n,e);var t=hp(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mColor",new so),r.mColor.copy(e||new so),r}return(0,c.Z)(n,[{key:"getType",value:function(){return Xa.background}},{key:"getBackgroundType",value:function(){return ap.color}},{key:"equals",value:function(e){return this.equalsBackgroundType(e)&&e.getColor().equals(this.mColor)}},{key:"getColor",value:function(){return this.mColor}},{key:"setColor",value:function(e){this.mColor.copy(e)}}]),n}(up);function pp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var mp=function(e){(0,g.Z)(n,e);var t=pp(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mMediaId",void 0),r.mMediaId=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return Xa.background}},{key:"getBackgroundType",value:function(){return ap.image}},{key:"equals",value:function(e){return this.equalsBackgroundType(e)&&e.getMediaId()===this.getMediaId()}},{key:"getMediaId",value:function(){return this.mMediaId}},{key:"setMediaId",value:function(e){this.mMediaId=e}}]),n}(up);function dp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var vp=function(e){(0,g.Z)(n,e);var t=dp(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mMediaIds",void 0),r.mMediaIds=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return Xa.background}},{key:"getBackgroundType",value:function(){return ap.skybox}},{key:"equals",value:function(e){if(!this.equalsBackgroundType(e))return!1;var t=this.getMediaIds(),n=e.getMediaIds();return n.length===t.length&&n.every((function(e,n){return e===t[n]}))}},{key:"getMediaIds",value:function(){return this.mMediaIds}},{key:"setMediaId",value:function(e){this.mMediaIds=e}}]),n}(up);function yp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yp(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yp(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var bp=[{id:"adams_place_bridge",name:"Adams Place Bridge",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/adams_place_bridge/adams_place_bridge.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/adams_place_bridge/adams_place_bridge_4k_environment.env")},{id:"brown_photostudio_02",name:"Brown Photostudio 02",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/brown_photostudio_02/brown_photostudio_02.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/brown_photostudio_02/brown_photostudio_02_4k_environment.env")},{id:"dancing_hall",name:"Dancing Hall",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/dancing_hall/dancing_hall.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/dancing_hall/dancing_hall_4k_environment.env")},{id:"je_gray_02",name:"J&E Gray 02",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/je_gray_02/je_gray_02.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/je_gray_02/je_gray_02_4k_environment.env")},{id:"modern_buildings_2",name:"Modern Buildings 2",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/modern_buildings_2/modern_buildings_2.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/modern_buildings_2/modern_buildings_2_4k_environment.env")},{id:"phalzer_forest_01",name:"Phalzer Forest 01",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/phalzer_forest_01/phalzer_forest_01.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/phalzer_forest_01/phalzer_forest_01_4k_environment.env")},{id:"rainforest_trail",name:"Rainforest Trail",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/rainforest_trail/rainforest_trail.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/rainforest_trail/rainforest_trail_4k_environment.env")},{id:"studio_small_09",name:"Studio Small 09",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/studio_small_09/studio_small_09.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/studio_small_09/studio_small_09_4k_environment.env")},{id:"acoustical_shell",name:"Acoustical Shell",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/acoustical_shell/acoustical_shell.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/acoustical_shell/acoustical_shell_4k_environment.env")},{id:"basement_boxing_ring",name:"Basement Boxing Ring",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/basement_boxing_ring/basement_boxing_ring.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/basement_boxing_ring/basement_boxing_ring_4k_environment.env")},{id:"blocky_photo_studio",name:"Blocky Photo Studio",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/blocky_photo_studio/blocky_photo_studio.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/blocky_photo_studio/blocky_photo_studio_4k_environment.env")},{id:"blue_photo_studio",name:"Blue Photo Studio",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/blue_photo_studio/blue_photo_studio.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/blue_photo_studio/blue_photo_studio_4k_environment.env")},{id:"canary_wharf",name:"Canary Wharf",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/canary_wharf/canary_wharf.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/canary_wharf/canary_wharf_4k_environment.env")},{id:"cyclorama_hard_light",name:"Cyclorama Hard Light",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/cyclorama_hard_light/cyclorama_hard_light.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/cyclorama_hard_light/cyclorama_hard_light_4k_environment.env")},{id:"kiara_1_dawn",name:"Kiara 1 Dawn",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/kiara_1_dawn/kiara_1_dawn.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/kiara_1_dawn/kiara_1_dawn_4k_environment.env")},{id:"leadenhall_market",name:"Leadenhall Market",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/leadenhall_market/leadenhall_market.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/leadenhall_market/leadenhall_market_4k_environment.env")},{id:"lilienstein",name:"Lilienstein",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/lilienstein/lilienstein.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/lilienstein/lilienstein_4k_environment.env")},{id:"piazza_san_marco",name:"Piazza San Marco",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/piazza_san_marco/piazza_san_marco.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/piazza_san_marco/piazza_san_marco_4k_environment.env")},{id:"royal_esplanade",name:"Royal Esplanade",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/royal_esplanade/royal_esplanade.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/royal_esplanade/royal_esplanade_4k_environment.env")},{id:"shanghai_bund",name:"Shanghai Bund",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/shanghai_bund/shanghai_bund.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/shanghai_bund/shanghai_bund_4k_environment.env")},{id:"small_cathedral_02",name:"Small Cathedral 02",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/small_cathedral_02/small_cathedral_02.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/small_cathedral_02/small_cathedral_02_4k_environment.env")},{id:"small_empty_room_1",name:"Small Empty Room 1",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/small_empty_room_1/small_empty_room_1.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/small_empty_room_1/small_empty_room_1_4k_environment.env")},{id:"small_empty_room_3",name:"Small Empty Room 3",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/small_empty_room_3/small_empty_room_3.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/small_empty_room_3/small_empty_room_3_4k_environment.env")},{id:"small_empty_room_4",name:"Small Empty Room 4",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/small_empty_room_4/small_empty_room_4.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/small_empty_room_4/small_empty_room_4_4k_environment.env")},{id:"studio_small_08",name:"Studio Small 08",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/studio_small_08/studio_small_08.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/studio_small_08/studio_small_08_4k_environment.env")},{id:"venice_sunrise",name:"Venice Sunrise",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/venice_sunrise/venice_sunrise.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/venice_sunrise/venice_sunrise_4k_environment.env")},{id:"venice_sunset",name:"Venice Sunset",thumbnail:"".concat(Jr.E.assetsUrl,"system/textures/hdri/venice_sunset/venice_sunset.png"),environment:"".concat(Jr.E.assetsUrl,"system/textures/hdri/venice_sunset/venice_sunset_4k_environment.env")}],Mp=bp.reduce((function(e,t){return gp(gp({},e),{},(0,l.Z)({},t.id,t))}),{});function kp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var _p=function(e){(0,g.Z)(n,e);var t=kp(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mEnvironment",void 0),r.mEnvironment=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return Xa.environment}},{key:"equals",value:function(e){var t,n;return e.getType()===this.getType()&&(null===(t=e.getEnvironment())||void 0===t?void 0:t.environment)===(null===(n=this.mEnvironment)||void 0===n?void 0:n.environment)}},{key:"getEnvironment",value:function(){return this.mEnvironment}}]),n}(to);function xp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Tp=function(e){(0,g.Z)(n,e);var t=xp(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return(0,u.Z)(this,n),a=t.call(this),(0,l.Z)((0,_.Z)(a),"mEnvironment",void 0),(0,l.Z)((0,_.Z)(a),"mScale",void 0),(0,l.Z)((0,_.Z)(a),"mBlur",void 0),(0,l.Z)((0,_.Z)(a),"mIntensity",void 0),a.mScale=e,a.mBlur=r,a.mEnvironment=i,a.mIntensity=o,a}return(0,c.Z)(n,[{key:"getType",value:function(){return Xa.background}},{key:"getBackgroundType",value:function(){return ap.environment}},{key:"equals",value:function(e){var t,n,r=e;return this.equalsBackgroundType(e)&&r.getScale()===this.mScale&&r.getBlur()===this.mBlur&&r.getIntensity()===this.mIntensity&&(null===(t=r.getEnvironment())||void 0===t?void 0:t.environment)===(null===(n=this.getEnvironment())||void 0===n?void 0:n.environment)}},{key:"getScale",value:function(){return this.mScale}},{key:"getBlur",value:function(){return this.mBlur}},{key:"getEnvironment",value:function(){return this.mEnvironment}},{key:"getIntensity",value:function(){return this.mIntensity}}]),n}(up);function wp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Rp=function(e){(0,g.Z)(n,e);var t=wp(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,u.Z)(this,n),e=t.call(this),(0,l.Z)((0,_.Z)(e),"mIntensity",void 0),e.mIntensity=r,e}return(0,c.Z)(n,[{key:"getType",value:function(){return Xa.environment_intensity}},{key:"equals",value:function(e){return e.getType()===this.getType()&&e.getIntensity()===this.mIntensity}},{key:"getIntensity",value:function(){return this.mIntensity}}]),n}(to);function Zp(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Sp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zp(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zp(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Cp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ip,Ep=function(e){(0,g.Z)(n,e);var t=Cp(n);function n(e){var r,i;return(0,u.Z)(this,n),i=t.call(this,e),(0,l.Z)((0,_.Z)(i),"mViewId",void 0),(0,l.Z)((0,_.Z)(i),"mViewVisibilityType",ip.Default),(0,l.Z)((0,_.Z)(i),"mMenuNavigation",!0),(0,l.Z)((0,_.Z)(i),"mBgType","none"),(0,l.Z)((0,_.Z)(i),"mTextureIds",void 0),(0,l.Z)((0,_.Z)(i),"mColor",so.White()),(0,l.Z)((0,_.Z)(i),"mProductSettings",{}),(0,l.Z)((0,_.Z)(i),"mViewSettings",{}),(0,l.Z)((0,_.Z)(i),"mLightSettings",{}),(0,l.Z)((0,_.Z)(i),"mEnvironmentSettings",void 0),(0,l.Z)((0,_.Z)(i),"mUxSettings",{}),(0,l.Z)((0,_.Z)(i),"mAssetSettings",{}),i.mName="ViewNode",i.mViewId=y.F.guid(),i.mTextureIds=[null,null,null,null,null,null],i.mEnvironmentSettings={intensity:1,scale:99,blur:.2,environment_id:null===(r=bp[0])||void 0===r?void 0:r.id},i.mViewSettings={automatic_camera:!1},i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"view"});return t.properties=Object.assign(t.properties,{view_id:this.mViewId,view_visibility:this.mViewVisibilityType,menu_navigation:this.mMenuNavigation,bg_type:this.mBgType,skycube_tex_0:this.mTextureIds[0],skycube_tex_1:this.mTextureIds[1],skycube_tex_2:this.mTextureIds[2],skycube_tex_3:this.mTextureIds[3],skycube_tex_4:this.mTextureIds[4],skycube_tex_5:this.mTextureIds[5],color:this.mColor.getHexString(),product_settings:this.mProductSettings,view_settings:this.mViewSettings,light_settings:this.mLightSettings,environment_settings:this.mEnvironmentSettings,ux_settings:this.mUxSettings,asset_settings:this.mAssetSettings}),t}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"view_id":return this.mViewId=t,!0;case"view_visibility":return this.mViewVisibilityType=+t,!0;case"menu_navigation":return this.mMenuNavigation=(0,f.oA)(t),!0;case"bg_type":return this.mBgType=t,!0;case"skycube_tex_0":return this.mTextureIds[0]=(0,f.kE)(t)?parseInt(t,10):null,!0;case"skycube_tex_1":return this.mTextureIds[1]=(0,f.kE)(t)?parseInt(t,10):null,!0;case"skycube_tex_2":return this.mTextureIds[2]=(0,f.kE)(t)?parseInt(t,10):null,!0;case"skycube_tex_3":return this.mTextureIds[3]=(0,f.kE)(t)?parseInt(t,10):null,!0;case"skycube_tex_4":return this.mTextureIds[4]=(0,f.kE)(t)?parseInt(t,10):null,!0;case"skycube_tex_5":return this.mTextureIds[5]=(0,f.kE)(t)?parseInt(t,10):null,!0;case"skybox_env_scale":return this.mEnvironmentSettings.scale=Number(t),!0;case"skybox_env_blur":return this.mEnvironmentSettings.blur=Number(t),!0;case"skybox_env_intensity":return this.mEnvironmentSettings.intensity=Number(t),!0;case"color":return this.mColor.set(t),!0;case"product_settings":return this.mProductSettings=Sp(Sp({},this.mProductSettings),t),!0;case"view_settings":return this.mViewSettings=Sp(Sp({},this.mViewSettings),t),!0;case"light_settings":return this.mLightSettings=Sp(Sp({},this.mLightSettings),t),!0;case"environment_settings":return this.mEnvironmentSettings=Sp(Sp({},this.mEnvironmentSettings),t),t&&t.environment_id||delete this.mEnvironmentSettings.environment_id,!0;case"ux_settings":return this.mUxSettings=Sp(Sp({},this.mUxSettings),t),!0;case"asset_settings":return this.mAssetSettings=Sp(Sp({},this.mAssetSettings),t),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"view_id":return this.mViewId;case"view_visibility":return this.mViewVisibilityType;case"menu_navigation":return this.mMenuNavigation;case"bg_type":return this.mBgType;case"skycube_tex_0":return this.mTextureIds[0];case"skycube_tex_1":return this.mTextureIds[1];case"skycube_tex_2":return this.mTextureIds[2];case"skycube_tex_3":return this.mTextureIds[3];case"skycube_tex_4":return this.mTextureIds[4];case"skycube_tex_5":return this.mTextureIds[5];case"skybox_env_scale":return this.mEnvironmentSettings.scale;case"skybox_env_blur":return this.mEnvironmentSettings.blur;case"skybox_env_intensity":return this.mEnvironmentSettings.intensity;case"color":return this.mColor;case"product_settings":return this.mProductSettings;case"view_settings":return this.mViewSettings;case"light_settings":return this.mLightSettings;case"environment_settings":return this.mEnvironmentSettings;case"ux_settings":return this.mUxSettings;case"asset_settings":return this.mAssetSettings}return null}},{key:"onBeforeParseCreate",value:function(e){var t=this.findParentOfType(Pc.TypeRTTI);if("product"===e&&t&&t.isBundled())return!1;var r=P.sceneManager().getScene().getChildrenDerivedTypeOf(Pc.TypeRTTI),i=t&&r.length>0&&r[0].getSceneObjectId()===t.getSceneObjectId();return!("product"!==e&&!i)&&Ni((0,M.Z)(n.prototype),"onBeforeParseCreate",this).call(this,e)}},{key:"getViewId",value:function(){return this.mViewId}},{key:"getVisibilityType",value:function(){return this.mViewVisibilityType}},{key:"setVisibilityType",value:function(e){this.mViewVisibilityType=e}},{key:"getVisibilityMenu",value:function(){return this.mMenuNavigation}},{key:"setVisibleMenu",value:function(e){this.mMenuNavigation=e}},{key:"getParentProductSceneObjectId",value:function(){var e=this.findParentOfType(Pc.TypeRTTI);if(e)return e.getSceneObjectId()}},{key:"isParentViewVisible",value:function(){for(var e=this.getParent();e;){if(e.isDerivedTypeOf(n.TypeRTTI))return e.isViewVisible();e=e.getParent()}return!1}},{key:"descendingViewActive",value:function(){var e=new Array;this.mChildren.forEach((function(t){t.isDerivedTypeOf(Pc.TypeRTTI)||e.push(t)}));for(var t=P.sceneManager().getActiveView().getViewId(),r=function(){var r=e.shift();if(r.isDerivedTypeOf(Ga.TypeRTTI)){if(r.isDerivedTypeOf(n.TypeRTTI)&&r.getViewId()===t)return{v:!0};r.getChildren().forEach((function(t){r.isDerivedTypeOf(Pc.TypeRTTI)||e.push(t)}))}};e.length>0;){var i=r();if("object"===(0,ui.Z)(i))return i.v}return!1}},{key:"isViewVisible",value:function(){var e=P.sceneManager().getActiveView();if(!e)return!1;var t=this.getParentProductSceneObjectId(),n=e.getParentProductSceneObjectId();if(void 0===t||void 0===n||t!==n)return!1;var r=e.getViewId()===this.getViewId(),i=!1;switch(this.getVisibilityType()){case ip.Default:i=r||this.descendingViewActive();break;case ip.Parent:i=r||this.descendingViewActive()||this.isParentViewVisible();break;case ip.Always:i=!0;break;case ip.OnlySelf:i=r}return i}},{key:"isAutomaticCameraInScene",value:function(){var e;return null!==(e=this.mViewSettings.automatic_camera)&&void 0!==e&&e}},{key:"setAutomaticCameraInScene",value:function(e){this.mViewSettings.automatic_camera=e}},{key:"enableBackgroundState",value:function(e){switch(this.mBgType){case"transparent":e.pushSceneState(new lp);break;case"color":e.pushSceneState(new fp(this.mColor));break;case"image":if(!(0,f.kE)(this.mTextureIds[0]))return;e.pushSceneState(new mp(this.mTextureIds[0]));break;case"cube":for(var t=[],n=0;n<this.mTextureIds.length;n++){if(!(0,f.kE)(this.mTextureIds[n]))return;t.push(this.mTextureIds[n])}e.pushSceneState(new vp(t));break;case"environment":var r=null==Mp?void 0:Mp[this.mEnvironmentSettings.environment_id];if(!r)return;e.pushSceneState(new Tp(this.mEnvironmentSettings.scale,this.mEnvironmentSettings.blur,r,this.mEnvironmentSettings.intensity))}}},{key:"enableEnvironmentState",value:function(e){var t=null==Mp?void 0:Mp[this.mEnvironmentSettings.environment_id];t&&(e.pushSceneState(new _p(t)),e.pushSceneState(new Rp(this.mEnvironmentSettings.intensity)))}},{key:"draw",value:function(e,t){if(this.isViewVisible()){var r=P.sceneManager().getActiveView();(null==r?void 0:r.getViewId())===this.getViewId()&&(this.enableEnvironmentState(e),this.enableBackgroundState(e)),Ni((0,M.Z)(n.prototype),"draw",this).call(this,e,t)}}}]),n}(Ga);(0,l.Z)(Ep,"TypeRTTI",new k.r("ViewNode",Ga.TypeRTTI)),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SEQUENCE=1]="SEQUENCE"}(Ip||(Ip={}));var Ap,Op=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ip.DEFAULT,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];(0,u.Z)(this,e),(0,l.Z)(this,"mAnimations",void 0),(0,l.Z)(this,"mDelay",void 0),(0,l.Z)(this,"mAutoStart",void 0),(0,l.Z)(this,"mSequence",void 0),(0,l.Z)(this,"mRepeatCount",void 0),(0,l.Z)(this,"mStarted",void 0),(0,l.Z)(this,"mFinished",void 0),(0,l.Z)(this,"mDelayTimer",void 0),(0,l.Z)(this,"mRepeat",void 0),this.mAnimations=t,this.mSequence=n,this.mDelay=r,this.mRepeatCount=i,this.mAutoStart=a,this.mStarted=this.mAutoStart,this.mAutoStart&&this.start()}return(0,c.Z)(e,[{key:"update",value:function(e){if(this.mStarted&&!this.mFinished)if(this.mDelayTimer<this.mDelay)this.mDelayTimer+=e;else{switch(this.mSequence){case Ip.DEFAULT:this.mAnimations.forEach((function(t){t.isFinished()||t.update(e)}));break;case Ip.SEQUENCE:var t=this.mAnimations.filter((function(e){return!e.isFinished()}));t.length>0&&t[0].update(e)}!this.mAnimations.some((function(e){return!e.isFinished()}))&&(this.mRepeat>=this.mRepeatCount?this.mFinished=!0:(this.mRepeat+=1,this.mAnimations.forEach((function(e){return e.start()}))))}}},{key:"start",value:function(){this.mStarted=!0,this.mFinished=!1,this.mDelayTimer=0,this.mRepeat=0}},{key:"finish",value:function(){this.mFinished=!0,this.mAnimations.forEach((function(e){e.isFinished()||e.finish()}))}},{key:"isFinished",value:function(){return this.mFinished}}]),e}(),Dp=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;(0,u.Z)(this,e),(0,l.Z)(this,"x",0),(0,l.Z)(this,"y",0),(0,l.Z)(this,"z",0),(0,l.Z)(this,"w",0),this.x=t,this.y=n,this.z=r,this.w=i}return(0,c.Z)(e,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: ".concat(e))}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: ".concat(e))}}},{key:"clone",value:function(){return new e(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,r,i,a=.01,o=.1,s=e.elements,u=s[0],c=s[4],l=s[8],h=s[1],f=s[5],p=s[9],m=s[2],d=s[6],v=s[10];if(Math.abs(c-h)<a&&Math.abs(l-m)<a&&Math.abs(p-d)<a){if(Math.abs(c+h)<o&&Math.abs(l+m)<o&&Math.abs(p+d)<o&&Math.abs(u+f+v-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var y=(u+1)/2,g=(f+1)/2,b=(v+1)/2,M=(c+h)/4,k=(l+m)/4,_=(p+d)/4;return y>g&&y>b?y<a?(n=0,r=.707106781,i=.707106781):(r=M/(n=Math.sqrt(y)),i=k/n):g>b?g<a?(n=.707106781,r=0,i=.707106781):(n=M/(r=Math.sqrt(g)),i=_/r):b<a?(n=.707106781,r=.707106781,i=0):(n=k/(i=Math.sqrt(b)),r=_/i),this.set(n,r,i,t),this}var x=Math.sqrt((d-p)*(d-p)+(l-m)*(l-m)+(h-c)*(h-c));return Math.abs(x)<.001&&(x=1),this.x=(d-p)/x,this.y=(l-m)/x,this.z=(h-c)/x,this.w=Math.acos((u+f+v-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}],[{key:"Zero",value:function(){return new e(0,0,0,0)}},{key:"One",value:function(){return new e(1,1,1,1)}}]),e}();!function(e){e[e.Linear=0]="Linear",e[e.EaseIn=1]="EaseIn",e[e.EaseOut=2]="EaseOut",e[e.EaseInOut=3]="EaseInOut",e[e.Bezier=4]="Bezier",e[e.Parametric=5]="Parametric"}(Ap||(Ap={}));var Pp=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ap.Linear,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];(0,u.Z)(this,e),(0,l.Z)(this,"mStart",void 0),(0,l.Z)(this,"mEnd",void 0),(0,l.Z)(this,"mTarget",void 0),(0,l.Z)(this,"mDuration",0),(0,l.Z)(this,"mDelay",0),(0,l.Z)(this,"mAutoStart",!1),(0,l.Z)(this,"mEffect",void 0),(0,l.Z)(this,"mStarted",!1),(0,l.Z)(this,"mFinished",!1),(0,l.Z)(this,"mDelayTimer",0),(0,l.Z)(this,"mDelta",0),this.mStart=n,this.mEnd=r,this.mTarget=t,this.mDuration=i,this.mEffect=a,this.mDelay=o,this.mAutoStart=s,this.mAutoStart&&this.start()}return(0,c.Z)(e,[{key:"update",value:function(e){if(!this.mStarted)return this.mStart;if(this.mFinished)return this.mEnd;if(this.mDelayTimer<this.mDelay)return this.mDelayTimer+=e,this.mStart;if(this.mDelta+=e,this.mDelta>=this.mDuration)return this.mFinished=!0,this.updateTarget(1),this.mEnd;var t=this.mDelta/this.mDuration;switch(this.mEffect){case Ap.EaseIn:t=Math.sin(t*Math.PI*.5);break;case Ap.EaseOut:t=Math.cos(t*(.5*Math.PI)+Math.PI)+1;break;case Ap.EaseInOut:t=.5*Math.sin(t*Math.PI-.5*Math.PI)+.5;break;case Ap.Bezier:t=t*t*(3-2*t);break;case Ap.Parametric:var n=t*t;t=n/(2*(n-t)+1);case Ap.Linear:}return this.updateTarget(t)}},{key:"start",value:function(){this.mStarted=!0,this.mDelayTimer=0,this.mDelta=0,this.mFinished=!1}},{key:"finish",value:function(){this.mFinished=!0,this.updateTarget(1)}},{key:"isStarted",value:function(){return this.mStarted&&!this.mFinished}},{key:"isFinished",value:function(){return this.mFinished}},{key:"updateTarget",value:function(e){return this.mTarget instanceof Pi&&this.mStart instanceof Pi&&this.mEnd instanceof Pi?this.mTarget.slerpQuaternions(this.mStart,this.mEnd,e):this.mTarget instanceof Bi&&this.mStart instanceof Bi&&this.mEnd instanceof Bi||this.mTarget instanceof D&&this.mStart instanceof D&&this.mEnd instanceof D||this.mTarget instanceof Dp&&this.mStart instanceof Dp&&this.mEnd instanceof Dp?this.mTarget.lerpVectors(this.mStart,this.mEnd,e):"number"==typeof this.mTarget&&"number"==typeof this.mStart&&"number"==typeof this.mEnd&&(this.mTarget=this.mStart+(this.mEnd-this.mStart)*e),this.mTarget}}]),e}();function Bp(e,t){return void 0===t&&(t=Nt),e=null!=e?e:Fp,qt((function(n,r){var i,a=!0;n.subscribe(Wt(r,(function(n){var o=t(n);!a&&e(i,o)||(a=!1,i=o,r.next(n))})))}))}function Fp(e,t){return e===t}function Lp(e){return qt((function(t,n){_o(e).subscribe(Wt(n,(function(){return n.complete()}),dt)),!n.closed&&t.subscribe(n)}))}var Np=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mBrokerSubscriptions",[]),(0,l.Z)(this,"mOnRendererIdle",void 0),(0,l.Z)(this,"mOnEngineIdle",void 0),(0,l.Z)(this,"mSceneIdle",!0),(0,l.Z)(this,"mRendererIdle",!0),(0,l.Z)(this,"mAttached",!1),(0,l.Z)(this,"mDetached$",void 0)}return(0,c.Z)(e,[{key:"attach",value:function(){this.mAttached=!0,this.mOnEngineIdle=new Ht,this.mOnRendererIdle=new Ht,this.mDetached$=new Ht,this.observeRenderer(),this.observeScene()}},{key:"detach",value:function(){this.mAttached&&(this.mBrokerSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mOnEngineIdle.complete(),this.mOnRendererIdle.complete(),this.mDetached$.next(),this.mDetached$.complete())}},{key:"observeRenderer",value:function(){var e=this;this.mBrokerSubscriptions.push(P.eventBus().subscribe(Di.getTopicName(Ei.RendererBuildStarted),(function(){return e.mOnRendererIdle.next(!1)})),P.eventBus().subscribe(Di.getTopicName(Ei.RendererBuildFinished),(function(){return e.mOnRendererIdle.next(!0)})),P.eventBus().subscribe(Di.getTopicName(Ei.RendererBuildIdle),(function(){return e.mOnRendererIdle.next(!0)}))),this.onRendererIdle.pipe(Bp((function(t,n){return e.mRendererIdle===t&&e.mRendererIdle===n&&t===n}))).subscribe({next:function(t){e.mRendererIdle=t,e.dispatchEngineIdle()}})}},{key:"observeScene",value:function(){var e=this;this.onSceneManagerIdle.pipe(Bp(),Kt((function(){return P.eventBus().dispatch(new Di(Ei.RequestFrame))}))).subscribe((function(t){e.mSceneIdle=t,e.mRendererIdle=!1,e.dispatchEngineIdle()}))}},{key:"dispatchEngineIdle",value:function(){this.mOnEngineIdle.next(this.mSceneIdle&&this.mRendererIdle)}},{key:"onRendererIdle",get:function(){return this.mOnRendererIdle.pipe(Lp(this.mDetached$))}},{key:"onSceneManagerIdle",get:function(){return P.sceneManager().onSceneIdle.pipe(Lp(this.mDetached$))}},{key:"onEngineIdle",get:function(){if(!this.mAttached)throw new Error("EngineProgressObserver is not attached");return this.mOnEngineIdle.pipe(Lp(this.mDetached$))}}]),e}(),jp=Array.isArray;function zp(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=lo(e);return n?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return jt(e)}(zp.apply(void 0,tt([],et(e))),Lo(n)):qt((function(t,n){zo(tt([t],et(function(e){return 1===e.length&&jp(e[0])?e[0]:e}(e))))(n)}))}function Up(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Vp=function(e){(0,g.Z)(n,e);var t=Up(n);function n(){var e;return(0,u.Z)(this,n),e=t.call(this,"viewport-camera-selector"),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mActiveCamera",void 0),(0,l.Z)((0,_.Z)(e),"mCameras",[]),(0,l.Z)((0,_.Z)(e),"mStartup",!0),(0,l.Z)((0,_.Z)(e),"mAnimator",void 0),(0,l.Z)((0,_.Z)(e),"mEngineProgressObserver",void 0),(0,l.Z)((0,_.Z)(e),"mOnMoveToCameraIdMessage",void 0),e.mEngineProgressObserver=new Np,e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"OnAttached",value:function(){var e=this;this.mSubscriptions.push(P.eventBus().subscribe(Di.getTopicName(Ei.NodeAdded),(function(t){var n=t.getData();n instanceof ga&&n.isCameraPartOfScene()&&(e.mCameras.push(n),e.syncCameras())})),P.eventBus().subscribe(Di.getTopicName(Ei.NodeRemoved),(function(t){var n=t.getData();if(n instanceof ga){var r=e.mCameras.findIndex((function(e){return n.getSceneObjectId()===e.getSceneObjectId()}));r>=0&&(e.mCameras.splice(r,1),e.syncCameras())}}))),this.registerMessageHandler(je.TypeRTTI,(function(t){e.animate(t.delta),e.mStartup&&e.syncCameras()})),this.mEngineProgressObserver.attach(),this.mOnMoveToCameraIdMessage=new Ht,this.observeMoveToCameraId(),this.registerMessageHandler(Re.TypeRTTI,(function(t){e.mOnMoveToCameraIdMessage.next(t)})),this.registerMessageHandler(Se.TypeRTTI,(function(t){e.moveToViewById(t.viewId)})),this.registerMessageHandler(X.TypeRTTI,(function(t){e.moveToPoint(t.origin,t.dir,t.action,t.delta,t.forceUpdate)})),this.registerMessageHandler(z.TypeRTTI,(function(t){e.setCameraToObject(t.targetObject,t.fitPosition,t.animate)}))}},{key:"OnDetached",value:function(){this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.unregisterMessageHandler(je.TypeRTTI),this.unregisterMessageHandler(Re.TypeRTTI),this.unregisterMessageHandler(Se.TypeRTTI),this.unregisterMessageHandler(X.TypeRTTI),this.unregisterMessageHandler(z.TypeRTTI),this.mCameras.splice(0),this.mEngineProgressObserver.detach(),this.mOnMoveToCameraIdMessage.complete()}},{key:"observeMoveToCameraId",value:function(){var e=this;this.mOnMoveToCameraIdMessage.pipe(Xl((function(t){return Io(t).pipe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return zp.apply(void 0,tt([],et(e)))}([e.mEngineProgressObserver.onEngineIdle.pipe(Xt((function(e){return e})),sn(1))]))})),Bo((function(e){return o(e,1)[0]}))).subscribe((function(t){e.moveToCameraById(t.camId,t.animate,t.openView)}))}},{key:"syncCameras",value:function(){if(this.mStartup&&0!==this.mCameras.length){var e=P.sceneManager().getActiveView();if(e){var t=e.isAutomaticCameraInScene()?this.mCameras.findIndex((function(e){return e.autoFocus!==Qi.NONE})):this.mCameras.findIndex((function(e){return e.autoFocus===Qi.NONE}));if(!(t<0)){var n=this.mCameras[t];e.isAutomaticCameraInScene()&&null!=n&&n.autoFocusNeedsUpdate&&!n.updateAutoFocus()||(this.mStartup=!1,this.moveToCameraByIndex(t,!0,!1))}}}}},{key:"moveToViewById",value:function(e){var t=this,n=P.sceneManager().getRootProductNode(),r=P.sceneManager().findNodesOfType(Ep.TypeRTTI,(function(t){return!(t.findParentOfType(Pc.TypeRTTI).getSceneObjectId()!==n.getSceneObjectId())&&t.getSceneObjectId()===e}));if(0!==r.length){var i=r[0];qe.qL.print("Move to view id:",e,"(".concat(i.name,")"));for(var a=i.findRootOfType(Ep.TypeRTTI),o=[a=a||i,i],s=i.getParent();s&&s.getSceneObjectId()!==a.getSceneObjectId();)s.isDerivedTypeOf(Ep.TypeRTTI)&&o.push(s),s=s.getParent();var u=P.sceneManager().findNodesOfType(ga.TypeRTTI,(function(e){if(!e.isCameraPartOfScene())return!1;var t=e.findParentOfType(Ep.TypeRTTI);return!!o.find((function(e){return e.getSceneObjectId()===t.getSceneObjectId()}))}),a);if(u.length>0){this.mActiveCamera&&!!u.find((function(e){return e.getSceneObjectId()===t.mActiveCamera.getSceneObjectId()}))||(qe.qL.print("Activating first camera in view node",e,"(".concat(i.name,")")),this.setActiveCamera(u[0],!0,rp.EaseIn))}else{var c=this.mActiveCamera?this.mActiveCamera:P.sceneManager().createObject("camera_perspective"),l=P.sceneManager().createObject("camera_perspective");l.parse(c.serialize(!0,!0),c.getSyncHash()),l.name+="#copy",qe.qL.print("Cloning and activating active camera in view node as none are present",e,"(".concat(i.name,")")),P.sceneManager().addNode(l,i,!1),this.setActiveCamera(l,!0,rp.EaseIn)}P.sceneManager().setActiveView(i)}else qe.qL.error("View node not found.",e)}},{key:"moveToCameraById",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:rp.EaseIn;qe.qL.print("Move to camera id:",e);var i=this.mCameras.findIndex((function(t){return t.getSceneObjectId()===e}));i>=0&&this.moveToCameraByIndex(i,t,n,r)}},{key:"moveToCameraByIndex",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:rp.EaseIn,i=this.mCameras[e],a=n?i.findParentOfType(Ep.TypeRTTI):void 0,o=P.sceneManager().getActiveView();o&&a&&o.getViewId()!==a.getViewId()?(P.sceneManager().setActiveView(a),this.setActiveCamera(i,!0,r)):this.setActiveCamera(i,t,r)}},{key:"setCameraToObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ii.FIT_OBJECT_FRONT,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];arguments.length>3&&void 0!==arguments[3]||rp.EaseIn;if(e){var r=P.renderer().getRenderEngine().getSceneBoundingBox(),i=new Bi;r.getCenter(i);var a=new Bi;r.getSize(a);var o=a.x>a.z?a.x:a.z,s=a.z>a.y?a.z:a.y,u=a.x>a.y?a.x:a.y;qe.qL.print("Fit object product radius:",o,s,u);var c=.001,l=1e3,h=0,f=0,p=0;if(this.mActiveCamera instanceof jc){var m=this.mActiveCamera.fov;h=s/2/Math.tan(Math.PI*m/360),f=o/2/Math.tan(Math.PI*m/360),p=u/2/Math.tan(Math.PI*m/360);var d=Math.max(h,f,p),v=Math.max(a.x,a.y,a.z);c=Math.max(.001,.1*(d-v)),l=4*(v+d)}qe.qL.print("Fit object near/far:",c,l);var y=i.clone();switch(t){case Ii.FIT_OBJECT_FRONT:y.add(new Bi(0,.5*a.y,1.5*p));break;case Ii.FIT_OBJECT_BACK:y.add(new Bi(0,.5*a.y,-1.5*p));break;case Ii.FIT_OBJECT_LEFT:y.add(new Bi(1.5*h,.5*a.y,0));break;case Ii.FIT_OBJECT_RIGHT:y.add(new Bi(-1.5*h,.5*a.y,0));break;case Ii.FIT_OBJECT_TOP:y.add(new Bi(0,1.5*f,0));break;case Ii.FIT_OBJECT_BOTTOM:y.add(new Bi(0,-1.5*f,0));break;default:y.add(new Bi(0,.5*a.y,1.5*p))}this.mActiveCamera.updateMatrixWorld();var g=this.mActiveCamera.transform.position.clone();if(n){this.mActiveCamera.updateMatrixWorld();var b=Ap.EaseIn;this.mAnimator=new Op([new Pp(this.mActiveCamera.transform.position,g,y,1,b),new Pp(this.mActiveCamera.target,this.mActiveCamera.target.clone(),i,1,b)]),this.applyCameraValues(c,l,45)}else this.mActiveCamera.transform.position.copy(y),this.mActiveCamera.target.copy(i),this.applyCameraValues(c,l,45),this.mActiveCamera.updateMatrixLocal(),this.mActiveCamera.updateMatrixWorld(),this.mActiveCamera.markNeedsRenderUpdate(),P.messenger().send(new C),P.eventBus().dispatch(new Di(Ei.RequestFrame))}}},{key:"setActiveCamera",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:rp.EaseIn;if(qe.qL.print("Activate camera:",e.getSceneObjectId(),"(".concat(e.name,")"),t,n),!this.mActiveCamera){var r=P.sceneManager().getActiveCamera();return this.mActiveCamera=e,void(r&&r.getSceneObjectId()!==e.getSceneObjectId()&&(r.setCameraActive(!1),this.mActiveCamera.setCameraActive(!0)))}var i=new Bi;this.mActiveCamera.transform.getWorldPosition(i);var a=(new Bi).copy(e.initialTransform.position),o=this.mActiveCamera.initialTarget.clone(),s=e.initialTarget.clone(),u=Ap.Linear;this.mAnimator&&(this.mAnimator.finish(),this.mActiveCamera.transform.updateMatrix(),delete this.mAnimator),this.mAnimator=new Op([new Pp(e.transform.position,i,a,1,u),new Pp(e.target,o,s,1,u)]),this.mActiveCamera.setCameraActive(!1),e.setCameraActive(!0),this.mActiveCamera=e,t||(this.mAnimator.finish(),this.applyCameraValues(this.mActiveCamera.near,this.mActiveCamera.far,this.mActiveCamera instanceof jc?this.mActiveCamera.fov:void 0),this.mActiveCamera.updateMatrixWorld(),this.mActiveCamera.markNeedsRenderUpdate(),P.messenger().send(new C),P.eventBus().dispatch(new Di(Ei.RequestFrame))),this.mActiveCamera.updateProjectionMatrix()}},{key:"applyCameraValues",value:function(e,t,n){this.mActiveCamera.near=e,this.mActiveCamera.far=t,n&&this.mActiveCamera instanceof jc&&(this.mActiveCamera.fov=n),this.mActiveCamera.updateProjectionMatrix()}},{key:"moveToPoint",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;arguments.length>5&&void 0!==arguments[5]||rp.EaseIn;qe.qL.print("Camera move to point:",e,t);var i=(new Bi).copy(e),a=(new Pi).setFromEuler((new Li).setFromVector3(t)),o=Ap.EaseIn;this.mAnimator=new Op([new Pp(this.mActiveCamera.transform.position,this.mActiveCamera.transform.position.clone(),i.clone(),1,o),new Pp(this.mActiveCamera.transform.quaternion,this.mActiveCamera.transform.quaternion.clone(),a.clone(),1,o)],Ip.DEFAULT),r>=1&&this.mAnimator.finish()}},{key:"animate",value:function(e){this.mAnimator&&(this.mAnimator.update(e),this.mActiveCamera.updateMatrixLocal(),this.mActiveCamera.updateMatrixWorld(),this.mActiveCamera.markNeedsRenderUpdate(),this.mAnimator.isFinished()&&delete this.mAnimator,P.messenger().send(new C),P.eventBus().dispatch(new Di(Ei.RequestFrame)))}}]),n}(op);function Hp(e,t,n){void 0===t&&(t=nn),void 0===n&&(n=Zc);var r=wc(e,t);return Sc((function(){return r}),n)}function Gp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Vp,"TypeRTTI",new k.r("ViewportControllerCameraSelector",op.TypeRTTI));var qp=function(e){(0,g.Z)(a,e);var n,i=Gp(a);function a(){var e;return(0,u.Z)(this,a),e=i.call(this,"droppable"),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mMoveSubject",new Ht),(0,l.Z)((0,_.Z)(e),"mCurrentDragOver",void 0),(0,l.Z)((0,_.Z)(e),"mCellWidth",1),(0,l.Z)((0,_.Z)(e),"mCellHeight",1),(0,l.Z)((0,_.Z)(e),"mDragMaterial",void 0),e.mDragMaterial=P.renderer().getRenderEngine().createMaterialBasic("droppable-drag-material"),e.mDragMaterial.setDiffuseColor(new so(65280)),e}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"OnAttached",value:function(){var e=this;this.mSubscriptions.push(this.mMoveSubject.pipe(Hp(50)).subscribe(this.dragMoveHandler.bind(this))),this.registerMessageHandler(F.TypeRTTI,(function(t){switch(t.name){case"start":e.onDragStarted();break;case"move":e.onDragMoved(t);break;case"end":e.onDragEnd(t);break;case"drop":e.onItemDropped(t).then((function(){}),(function(e){qe.qL.error(e)}))}}))}},{key:"OnDetached",value:function(){this.resetDragMaterial(),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.unregisterMessageHandler(F.TypeRTTI)}},{key:"setCellSize",value:function(e,t){this.mCellWidth=e,this.mCellHeight=t}},{key:"resolveDroppableComponent",value:function(e){if(e)return e.getComponent("droppable-handler")}},{key:"dragMoveHandler",value:function(e){var t=e.canvasPosition,n=e.data;if(Array.isArray(n.types)&&0!==n.types.length){for(var r,i=this.getIntersects(t),a=0;a<i.length;a++){var o=this.resolveDroppableComponent(i[a].entity);if(o&&o.interceptDragMove(i[a],this.mCellWidth,this.mCellHeight)){r=i[a].entity;break}}this.markDragMaterial(r)}else this.resetDragMaterial()}},{key:"onDragStarted",value:function(){}},{key:"onDragMoved",value:function(e){this.mMoveSubject.next(e)}},{key:"onDragEnd",value:function(e){this.resetDragMaterial()}},{key:"markDragMaterial",value:function(e){if(this.mCurrentDragOver!==e)if(e){this.resetDragMaterial(),this.mCurrentDragOver=e;var t=this.resolveDroppableComponent(this.mCurrentDragOver);t&&t.markDragMaterial(this.mCurrentDragOver)}else this.resetDragMaterial()}},{key:"resetDragMaterial",value:function(){if(this.mCurrentDragOver){var e=this.resolveDroppableComponent(this.mCurrentDragOver);e&&e.resetDragMaterial(this.mCurrentDragOver),delete this.mCurrentDragOver}}},{key:"onItemDropped",value:(n=t(r().mark((function e(t){var n,i,a,o,s,u,c,l=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.resetDragMaterial(),null!=t&&t.data){e.next=4;break}return P.messenger().send(new N("drop",!1)),e.abrupt("return");case 4:if(n=!1,qe.qL.print("Item dropped:",t),i=t.data.product_id,t.data.model_id,void 0===i){e.next=28;break}if(a=this.getIntersects(t.canvasPosition),!(o=a.find((function(e){return!!l.resolveDroppableComponent(e.entity)})))){e.next=25;break}if(!(s=this.resolveDroppableComponent(o.entity))){e.next=23;break}return e.next=16,s.acceptDrop(o);case 16:u=e.sent,(c=P.sceneManager().createObject("product",void 0,i)).name="Product id:".concat(i),c.transform.position.copy(u.position),c.transform.quaternion.copy(u.quaternion),P.sceneManager().addNode(c,void 0,!1),n=!0;case 23:e.next=26;break;case 25:qe.qL.print("Item dropped on non-droppable entity.",t);case 26:e.next=29;break;case 28:case 29:P.messenger().send(new N("drop",n,t.data));case 30:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getIntersects",value:function(e){var t=P.renderer().getRenderEngine().getForwardRayFromScreenCoords(P.sceneManager().getActiveCamera(),e.x,e.y,1/0);return P.renderer().getRenderEngine().raycast(t)}}]),a}(op);function Wp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(qp,"TypeRTTI",new k.r("ViewportControllerDroppable",op.TypeRTTI));var Yp=function(e){(0,g.Z)(n,e);var t=Wp(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e)).mName="GroupEntity",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"serialize",value:function(e){return Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"group"})}}]),n}(Ga);(0,l.Z)(Yp,"TypeRTTI",new k.r("GroupEntity",Ga.TypeRTTI));var Kp=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,null,[{key:"Create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;arguments.length>6&&void 0!==arguments[6]||Es.Front;n=Math.max(3,n);for(var o=[],s=[],u=[],c=[],l=e,h=(t-e)/(r=Math.max(1,r)),f=new Bi,p=new D,m=0;m<=r;m++){for(var d=0;d<=n;d++){var v=i+d/n*a;f.x=l*Math.cos(v),f.y=l*Math.sin(v),s.push(f.x,f.y,f.z),u.push(0,0,1),p.x=(f.x/t+1)/2,p.y=(f.y/t+1)/2,c.push(p.x,p.y)}l+=h}for(var y=0;y<r;y++)for(var g=y*(n+1),b=0;b<n;b++){var M=b+g,k=M,_=M+n+1,x=M+n+2,T=M+1;o.push(k,_,T),o.push(_,x,T)}var w=P.renderer().getRenderEngine().createBuffer();return w.setIndexData(new Ru(new Uint32Array(o),1)),w.setVertexData(_u.POSITION,new Ru(new Float32Array(s),3)),w.setVertexData(_u.NORMAL,new Ru(new Float32Array(u),3)),w.setVertexData(_u.UV,new Ru(new Float32Array(c),2)),w}}]),e}(),Xp=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,null,[{key:"Create",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=(arguments.length>4&&void 0!==arguments[4]||Es.Front,e/2),a=t/2,o=Math.floor(n),s=Math.floor(r),u=o+1,c=s+1,l=e/o,h=t/s,f=[],p=[],m=[],d=[],v=0;v<c;v++)for(var y=v*h-a,g=0;g<u;g++){var b=g*l-i;p.push(b,-y,0),m.push(0,0,1),d.push(g/o),d.push(1-v/s)}for(var M=0;M<s;M++)for(var k=0;k<o;k++){var _=k+u*M,x=k+u*(M+1),T=k+1+u*(M+1),w=k+1+u*M;f.push(_,x,w),f.push(x,T,w)}var R=P.renderer().getRenderEngine().createBuffer();return R.setIndexData(new Ru(new Uint32Array(f),1)),R.setVertexData(_u.POSITION,new Ru(new Float32Array(p),3)),R.setVertexData(_u.NORMAL,new Ru(new Float32Array(m),3)),R.setVertexData(_u.UV,new Ru(new Float32Array(d),2)),R}}]),e}(),$p=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,null,[{key:"Create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;arguments.length>4&&void 0!==arguments[4]||Es.Front;t=Math.max(3,t);var i=[],a=[],o=[],s=[],u=new Bi,c=new D;a.push(0,0,0),o.push(0,0,1),s.push(.5,.5);for(var l=0,h=3;l<=t;l++,h+=3){var f=n+l/t*r;u.x=e*Math.cos(f),u.y=e*Math.sin(f),a.push(u.x,u.y,u.z),o.push(0,0,1),c.x=(a[h]/e+1)/2,c.y=(a[h+1]/e+1)/2,s.push(c.x,c.y)}for(var p=1;p<=t;p++)i.push(p,p+1,0);var m=P.renderer().getRenderEngine().createBuffer();return m.setIndexData(new Ru(new Uint32Array(i),1)),m.setVertexData(_u.POSITION,new Ru(new Float32Array(a),3)),m.setVertexData(_u.NORMAL,new Ru(new Float32Array(o),3)),m.setVertexData(_u.UV,new Ru(new Float32Array(s),2)),m}}]),e}(),Qp=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,null,[{key:"Create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:so.White();t=Math.max(1,t);for(var r=[],i=[],a=[],o=new Bi,s=n,u=0;u<=t;u++){var c=u/t;o.x=e*c,r.push(o.x,o.y,o.z),a.push(s.r,s.g,s.b,1),i.push((r.length-1)/3)}var l=P.renderer().getRenderEngine().createBuffer();return l.setIndexData(new Ru(new Uint32Array(i),3)),l.setVertexData(_u.POSITION,new Ru(new Float32Array(r),3)),l.setVertexData(_u.COLOR,new Ru(new Float32Array(a),4)),l}},{key:"CreateStartEnd",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:so.White();n=Math.max(1,n);for(var i=e.distanceTo(t),a=t.clone().sub(e).normalize(),o=[],s=[],u=[],c=new Bi,l=r,h=0;h<=n;h++){var f=h/n;c.copy(e.clone().add(a.clone().multiplyScalar(i*f))),o.push(c.x,c.y,c.z),u.push(l.r,l.g,l.b,1),s.push((o.length-1)/3)}var p=P.renderer().getRenderEngine().createBuffer();return p.setIndexData(new Ru(new Uint32Array(s),3)),p.setVertexData(_u.POSITION,new Ru(new Float32Array(o),3)),p.setVertexData(_u.COLOR,new Ru(new Float32Array(u),4)),p}},{key:"CreateLines",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:so.White();t=Math.max(1,t);var i=[],a=[],o=[],s=new Bi,u=r,c=e.slice(0);n&&c.push(c[0]);for(var l=1;l<c.length;l++)for(var h=c[l-1],f=c[l],p=h.distanceTo(f),m=f.clone().sub(h).normalize(),d=0;d<=t;d++){var v=d/t;s.copy(h.clone().add(m.clone().multiplyScalar(p*v))),i.push(s.x,s.y,s.z),o.push(u.r,u.g,u.b,1),a.push((i.length-1)/3)}var y=P.renderer().getRenderEngine().createBuffer();return y.setIndexData(new Ru(new Uint32Array(a),3)),y.setVertexData(_u.POSITION,new Ru(new Float32Array(i),3)),y.setVertexData(_u.COLOR,new Ru(new Float32Array(o),4)),y}}]),e}();function Jp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var em=function(e){(0,g.Z)(n,e);var t=Jp(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,u.Z)(this,n),e=t.call(this,"drop-area-object-collider"),(0,l.Z)((0,_.Z)(e),"mGroundBody",void 0),(0,l.Z)((0,_.Z)(e),"mEdgeBodies",[]),(0,l.Z)((0,_.Z)(e),"mEdgesGroup",void 0),(0,l.Z)((0,_.Z)(e),"mEdgeSceneObjects",[]),(0,l.Z)((0,_.Z)(e),"mBodyType",hc.Kinematic),(0,l.Z)((0,_.Z)(e),"mMass",0),(0,l.Z)((0,_.Z)(e),"mCollisionEdgedEnabled",!1),(0,l.Z)((0,_.Z)(e),"mDebug",!1),(0,l.Z)((0,_.Z)(e),"mGroundHelper",void 0),(0,l.Z)((0,_.Z)(e),"mEdgeHelpers",[]),(0,l.Z)((0,_.Z)(e),"mSubscriptionBrokers",[]),(0,l.Z)((0,_.Z)(e),"PlaneThickness",.01),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mScaleX",1),(0,l.Z)((0,_.Z)(e),"mScaleY",1),e.mCollisionEdgedEnabled=r,e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"OnAttached",value:function(){var e=this,t=this.getParentObject(),n=P.physicsSystem().getWorld(),r=new Bi(nm.PlaneWidth,nm.PlaneHeight,this.PlaneThickness);this.mGroundBody=n.createBody(n.createBox(r),this.mBodyType),this.mGroundBody.setMass(this.mMass),P.physicsSystem().registerMesh(t,this.mGroundBody),this.mDebug=P.physicsSystem().showHelpers(),this.mCollisionEdgedEnabled?this.createEdges():this.updateProperties(),this.mDebug&&this.createHelpers(),this.mSubscriptionBrokers.push(P.eventBus().subscribe(fc.getTopicName(lc.PhysicsCollider),(function(t){e.mDebug=t.isVisible(),e.mDebug?e.createHelpers():e.destroyHelpers()}))),this.registerMessageHandler(_e.TypeRTTI,(function(){e.OnDetached()})),this.registerMessageHandler(Te.TypeRTTI,this.onSceneUpdate.bind(this)),this.mSubscriptions.push(t.transform.scale.onChange.subscribe((function(){Ft(e.mScaleX,t.transform.scale.x)&&Ft(e.mScaleY,t.transform.scale.y)||(e.mScaleX=t.transform.scale.x,e.mScaleY=t.transform.scale.y,e.updateProperties())})))}},{key:"OnDetached",value:function(){this.mSubscriptionBrokers.splice(0).forEach((function(e){return e.unsubscribe()})),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.unregisterMessageHandler(Te.TypeRTTI),this.unregisterMessageHandler(_e.TypeRTTI),this.destroyHelpers();var e=this.getParentObject();P.physicsSystem().unregisterMesh(e.getSceneObjectId()),this.mGroundBody&&delete this.mGroundBody,this.destroyEdges()}},{key:"isAttachable",value:function(e){return e.isTypeOf(nm.TypeRTTI)}},{key:"onSceneUpdate",value:function(e){this.mCollisionEdgedEnabled&&this.mEdgesGroup&&this.mEdgesGroup.update(e)}},{key:"createEdges",value:function(){var e=this,t=this.getParentObject();this.mEdgesGroup=new Yp,this.mEdgesGroup.name="drop-area-edges-group",this.mEdgesGroup.setParent(t),["left-edge","right-edge","back-edge","front-edge"].forEach((function(t){return e.createEdge(t,e.mEdgesGroup)})),this.updateProperties(),this.mEdgeSceneObjects.forEach((function(t,n){var r=e.mEdgeBodies[n];P.physicsSystem().registerMesh(t,r)})),this.mDebug&&this.createHelpers()}},{key:"destroyEdges",value:function(){this.mEdgeSceneObjects.splice(0).forEach((function(e){P.physicsSystem().unregisterMesh(e.getSceneObjectId())})),this.mEdgeBodies.splice(0).forEach((function(e){e.dispose()})),this.mEdgesGroup&&(this.mEdgesGroup.destroy(),delete this.mEdgesGroup),this.destroyHelpers(!0)}},{key:"createEdge",value:function(e,t){var n=P.physicsSystem().getWorld(),r=n.createBody(n.createBox(Bi.One()),this.mBodyType);r.setMass(this.mMass),r.setIgnoreSync(!0),this.mEdgeBodies.push(r);var i=new Yp;i.name=e,i.setParent(t),P.sceneManager().addNode(i,t,!1),this.mEdgeSceneObjects.push(i)}},{key:"updateProperties",value:function(){var e=this.getParentObject(),t=nm.PlaneWidth*e.transform.scale.x,n=nm.PlaneHeight*e.transform.scale.y,r=.5,i=this.mGroundBody.getShape();if(i.setWidth(t),i.setHeight(n),i.setDepth(this.PlaneThickness),this.mGroundHelper&&this.mGroundHelper.updateChanges(),this.mCollisionEdgedEnabled){var a=this.mEdgeBodies[0].getShape();a.setWidth(this.PlaneThickness),a.setHeight(n),a.setDepth(r),this.mEdgeSceneObjects[0].transform.position.set(-.5*nm.PlaneWidth,0,.25);var o=this.mEdgeBodies[1].getShape();o.setWidth(this.PlaneThickness),o.setHeight(n),o.setDepth(r),this.mEdgeSceneObjects[1].transform.position.set(.5*nm.PlaneWidth,0,.25);var s=this.mEdgeBodies[2].getShape();s.setWidth(t),s.setHeight(this.PlaneThickness),s.setDepth(r),this.mEdgeSceneObjects[2].transform.position.set(0,.5*nm.PlaneHeight,.25);var u=this.mEdgeBodies[3].getShape();u.setWidth(t),u.setHeight(this.PlaneThickness),u.setDepth(r),this.mEdgeSceneObjects[3].transform.position.set(0,-.5*nm.PlaneHeight,.25),this.mEdgeHelpers.forEach((function(e){e.updateChanges()}))}}},{key:"createHelpers",value:function(){var e=this;this.mGroundHelper||(this.mGroundHelper=new uc(this.mGroundBody),P.sceneManager().addNode(this.mGroundHelper,void 0,!1)),this.mCollisionEdgedEnabled&&0===this.mEdgeHelpers.length&&this.mEdgeBodies.forEach((function(t){var n=new uc(t);e.mEdgeHelpers.push(n),P.sceneManager().addNode(n,void 0,!1)}))}},{key:"destroyHelpers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.mGroundHelper&&!e&&(P.sceneManager().removeNode(this.mGroundHelper),this.mGroundHelper.destroy(),delete this.mGroundHelper),this.mEdgeHelpers.splice(0).forEach((function(e){P.sceneManager().removeNode(e),e.destroy(!0)}))}},{key:"getCollisionEdgesEnabled",value:function(){return this.mCollisionEdgedEnabled}},{key:"setCollisionEdgesEnabled",value:function(e){this.mCollisionEdgedEnabled!==e&&(this.mCollisionEdgedEnabled=e,this.mCollisionEdgedEnabled?this.createEdges():this.destroyEdges())}},{key:"parse",value:function(e){var t=this;if(e)return this.mBodyType="number"==typeof e.body_type&&e.body_type in hc?e.body_type:hc.Kinematic,this.mMass="number"==typeof e.mass?e.mass:0,e.properties&&(this.mCollisionEdgedEnabled="boolean"==typeof e.properties.collision_edges_enabled&&e.properties.collision_edges_enabled),this.mGroundBody&&(this.mGroundBody.setBodyType(this.mBodyType),this.mGroundBody.setMass(this.mMass),this.mEdgeBodies.forEach((function(e){e.setBodyType(t.mBodyType),e.setMass(t.mMass)})),this.updateProperties()),!0}},{key:"serialize",value:function(){return{type:"drop-area",body_type:this.mBodyType,mass:this.mMass,properties:{collision_edges_enabled:this.mCollisionEdgedEnabled}}}}]),n}(Xi.H);function tm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(em,"TypeRTTI",new k.r("DropAreaColliderComponent",Xi.H.TypeRTTI));var nm=function(e){(0,g.Z)(n,e);var t=tm(n);function n(e,r,i){var a;if((0,u.Z)(this,n),a=t.call(this,e,Xp.Create(n.PlaneWidth,n.PlaneHeight,1,1,Es.Double),r,i),(0,l.Z)((0,_.Z)(a),"mCellWidth",1),(0,l.Z)((0,_.Z)(a),"mCellHeight",1),(0,l.Z)((0,_.Z)(a),"renderTechnique",eo.grid_area),a.mName="DropAreaEntity",a.mPickable=!0,a.mCastShadow=!1,void 0===r){var o=P.renderer().getRenderEngine().createMaterialPBR("drop_area_material");o.setDiffuseColor(new so(15987699)),o.setTransparent(!0),o.setOpacity(0),o.setSpecularIntensity(0),o.setSpecularColor(so.Black()),o.setEnvironmentIntensity(0),o.setEmissiveIntensity(0),o.setSide(Es.Double),a.setMaterial(o)}return a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"cell_width":return this.mCellWidth=parseFloat(t),!0;case"cell_height":return this.mCellHeight=parseFloat(t),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"cell_width":return this.mCellWidth;case"cell_height":return this.mCellHeight;case"cell_size":return this.getCellSize()}return null}},{key:"getCellSize",value:function(){return{width:this.mCellWidth,height:this.mCellHeight}}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"drop_area"});t.properties=Object.assign(t.properties,{cell_width:this.mCellWidth,cell_height:this.mCellHeight});var r=o(this.getComponents(em.TypeRTTI),1)[0];return r&&(t.properties.collider=r.serialize()),t}},{key:"cellWidth",get:function(){return this.mCellWidth},set:function(e){this.mCellWidth=e,this.markNeedsRenderUpdate()}},{key:"cellHeight",get:function(){return this.mCellHeight},set:function(e){this.mCellHeight=e,this.markNeedsRenderUpdate()}}]),n}(rc);function rm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(nm,"TypeRTTI",new k.r("DropAreaEntity",rc.TypeRTTI)),(0,l.Z)(nm,"PlaneWidth",2),(0,l.Z)(nm,"PlaneHeight",2);var im=function(e){(0,g.Z)(n,e);var t=rm(n);function n(e,r,i,a,o,s,c){var h;return(0,u.Z)(this,n),h=t.call(this,e,r,i,c),(0,l.Z)((0,_.Z)(h),"mNodes",void 0),(0,l.Z)((0,_.Z)(h),"mOffsetNodesGroups",[]),h.mName="MeshBatchEntity",o&&h.setNodes(o),a&&(h.mOffsetNodesGroups=a),s&&h.setSyncHash(s),h}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"setNodes",value:function(e){this.mNodes=e}},{key:"getNodes",value:function(){return this.mNodes}},{key:"getOffsetGroups",value:function(){return this.mOffsetNodesGroups}}]),n}(rc);function am(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(im,"TypeRTTI",new k.r("MeshBatchEntity",rc.TypeRTTI));var om=function(e){(0,g.Z)(n,e);var t=am(n);function n(e,r,i){var a;return(0,u.Z)(this,n),a=t.call(this,e,r,i),(0,l.Z)((0,_.Z)(a),"renderTechnique",eo.mesh_line),a.mName="MeshLineEntity",a.drawMode=ec.LINE_STRIP,a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(rc);function sm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(om,"TypeRTTI",new k.r("MeshLineEntity",Wa.TypeRTTI));var um,cm,lm=function(e){(0,g.Z)(n,e);var t=sm(n);function n(){var e;return(0,u.Z)(this,n),e=t.call(this,"draggable-component"),(0,l.Z)((0,_.Z)(e),"mSceneObject",void 0),(0,l.Z)((0,_.Z)(e),"mColliderComponent",void 0),(0,l.Z)((0,_.Z)(e),"mNextPosition",new Bi),(0,l.Z)((0,_.Z)(e),"mNextQuaternion",new Pi),(0,l.Z)((0,_.Z)(e),"mBrokerSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mObjectMovementSpeed",100),(0,l.Z)((0,_.Z)(e),"mPlanePoint",new Bi(0,0,0)),(0,l.Z)((0,_.Z)(e),"mPlaneNormal",Bi.Up()),(0,l.Z)((0,_.Z)(e),"mPlaneNormalOld",Bi.Up()),(0,l.Z)((0,_.Z)(e),"mPlaneNormalChanged",!1),e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"OnAttached",value:function(){var e=this.getParentObject();this.mSceneObject=e,this.mNextPosition.copy(this.mSceneObject.transform.position),this.mNextQuaternion.copy(this.mSceneObject.transform.quaternion);var t=o(e.getComponents(mc.TypeRTTI),1);this.mColliderComponent=t[0],this.registerMessageHandler(Te.TypeRTTI,this.update.bind(this))}},{key:"update",value:function(){if(this.mColliderComponent){var e=this.mNextPosition.distanceTo(this.mSceneObject.transform.position),t=this.mNextPosition.clone().sub(this.mSceneObject.transform.position).normalize().clone().multiplyScalar(e*this.mObjectMovementSpeed);if(this.mColliderComponent.getBody().setLinearVelocity(t),this.mPlaneNormalChanged){var n=(new Pi).setFromUnitVectors(this.mPlaneNormalOld,this.mPlaneNormal);this.mSceneObject.transform.quaternion.premultiply(n),this.mSceneObject.transform.position.copy(this.mPlanePoint),this.mColliderComponent.getBody().setLinearVelocity(new Bi(0,0,0)),this.mColliderComponent.getBody().setAngularVelocity(Pi.identity()),this.mPlaneNormalChanged=!1}}}},{key:"OnDetached",value:function(){this.unregisterMessageHandler(Te.TypeRTTI),this.mBrokerSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"isAttachable",value:function(e){return e.isTypeOf(Mc.TypeRTTI)||e.isTypeOf(Pc.TypeRTTI)||e.isTypeOf(Lf.TypeRTTI)}},{key:"setNextPosition",value:function(e){this.mNextPosition.equals(e)||this.mNextPosition.copy(e)}},{key:"setNextQuaternion",value:function(e){this.mNextQuaternion.equals(e)||this.mNextQuaternion.copy(e)}},{key:"setPlaneNormal",value:function(e){Ft(this.mPlaneNormal.x,e.x)&&Ft(this.mPlaneNormal.y,e.y)&&Ft(this.mPlaneNormal.z,e.z)||(this.mPlaneNormalOld.copy(this.mPlaneNormal),this.mPlaneNormal.copy(e),this.mPlaneNormalChanged=!0)}},{key:"setPlanePoint",value:function(e){this.mPlanePoint.equals(e)||this.mPlanePoint.copy(e)}}]),n}(Xi.H);function hm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(lm,"TypeRTTI",new k.r("DraggableComponent",Xi.H.TypeRTTI)),function(e){e[e.X=1]="X",e[e.Y=2]="Y",e[e.Z=4]="Z"}(um||(um={})),function(e){e[e.POSITIVE=0]="POSITIVE",e[e.NEGATIVE=1]="NEGATIVE"}(cm||(cm={}));var fm,pm=function(e){(0,g.Z)(m,e);var n,i,a,h,f,p=hm(m);function m(){var e;return(0,u.Z)(this,m),e=p.call(this,"transform-controls"),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mEventBrokerSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"enabled",!0),(0,l.Z)((0,_.Z)(e),"rotationEnabled",!1),(0,l.Z)((0,_.Z)(e),"panEnabled",!1),(0,l.Z)((0,_.Z)(e),"isRotating",!1),(0,l.Z)((0,_.Z)(e),"isPanning",!1),(0,l.Z)((0,_.Z)(e),"visible",!1),(0,l.Z)((0,_.Z)(e),"arrowsVisible",!1),(0,l.Z)((0,_.Z)(e),"rotationAxisEnabled",um.X|um.Y|um.Z),(0,l.Z)((0,_.Z)(e),"object",void 0),(0,l.Z)((0,_.Z)(e),"protractorTexture",void 0),(0,l.Z)((0,_.Z)(e),"gizmoArrowTextures",void 0),(0,l.Z)((0,_.Z)(e),"domElement",void 0),(0,l.Z)((0,_.Z)(e),"rotationAxis",void 0),(0,l.Z)((0,_.Z)(e),"rotationAxisSide",void 0),(0,l.Z)((0,_.Z)(e),"originalRotation",void 0),(0,l.Z)((0,_.Z)(e),"previousRotation",void 0),(0,l.Z)((0,_.Z)(e),"previousUVCoord",void 0),(0,l.Z)((0,_.Z)(e),"rotationOffset",0),(0,l.Z)((0,_.Z)(e),"protractorGroup",void 0),(0,l.Z)((0,_.Z)(e),"protractorMeshMaterial",void 0),(0,l.Z)((0,_.Z)(e),"protractorMesh",void 0),(0,l.Z)((0,_.Z)(e),"rotationRingMesh",void 0),(0,l.Z)((0,_.Z)(e),"rotationLine",void 0),(0,l.Z)((0,_.Z)(e),"rotationRaycastPlane",void 0),(0,l.Z)((0,_.Z)(e),"panningRaycastPlanes",[]),(0,l.Z)((0,_.Z)(e),"dragging",!1),(0,l.Z)((0,_.Z)(e),"mousedown",!1),(0,l.Z)((0,_.Z)(e),"arrowAxisXMesh",[]),(0,l.Z)((0,_.Z)(e),"arrowAxisYMesh",[]),(0,l.Z)((0,_.Z)(e),"arrowAxisZMesh",[]),(0,l.Z)((0,_.Z)(e),"boundingBoxObject",void 0),(0,l.Z)((0,_.Z)(e),"boundingRect",void 0),(0,l.Z)((0,_.Z)(e),"UnitX",Bi.AxisX()),(0,l.Z)((0,_.Z)(e),"UnitY",Bi.AxisY()),(0,l.Z)((0,_.Z)(e),"UnitZ",Bi.AxisZ()),(0,l.Z)((0,_.Z)(e),"sizeArrows",{scale:.5,min:.1,max:40}),(0,l.Z)((0,_.Z)(e),"sizeProtractor",{scale:.5,min:.1,max:30}),(0,l.Z)((0,_.Z)(e),"ringThickness",.045),(0,l.Z)((0,_.Z)(e),"protractorRadius",.3),(0,l.Z)((0,_.Z)(e),"objectUpDirectionBasedOnAxis",void 0),(0,l.Z)((0,_.Z)(e),"rotationText",void 0),(0,l.Z)((0,_.Z)(e),"mResourceHandles",void 0),(0,l.Z)((0,_.Z)(e),"mImageLoader",void 0),(0,l.Z)((0,_.Z)(e),"mArrowXMaterialhandle",void 0),(0,l.Z)((0,_.Z)(e),"mArrowYMaterialhandle",void 0),(0,l.Z)((0,_.Z)(e),"mArrowZMaterialhandle",void 0),(0,l.Z)((0,_.Z)(e),"mUsePhysicsCollider",!1),(0,l.Z)((0,_.Z)(e),"mObjectSelectedSubject",new Ht),(0,l.Z)((0,_.Z)(e),"mNextObjectPosition",new Bi),(0,l.Z)((0,_.Z)(e),"mNextObjectQuaternion",new Pi),(0,l.Z)((0,_.Z)(e),"mNextObjectPlaneNormal",Bi.Up()),(0,l.Z)((0,_.Z)(e),"mNextObjectPlanePoint",Bi.Zero()),(0,l.Z)((0,_.Z)(e),"mCameraToObjectDistance",-1),e.previousUVCoord=new D,e.boundingBoxObject=new ji,e.boundingRect=new Dp,e.mResourceHandles=[],e.gizmoArrowTextures=[],e.objectUpDirectionBasedOnAxis=Bi.Up(),e.mImageLoader=new yu,e.mImageLoader.setCrossOrigin("anonymous"),e.protractorGroup=new Yp,e.protractorGroup.name="transform-controls-protractor-group",e.protractorGroup.layers.enable(5),e.protractorGroup.layers.enable(8),e}return(0,c.Z)(m,[{key:"getType",value:function(){return m.TypeRTTI}},{key:"OnAttached",value:(f=t(r().mark((function e(){var n,i,a,o,s,u,c,l,h,f,p,m=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.domElement=P.renderer().getRenderEngine().getCanvas(),n=tc.getManager(Qu.MaterialManager),Promise.all([this.loadTexture("".concat(Jr.E.assetsUrl,"system/floorplanner/gizmo-arrow-x-2x.png"),"gizmo-arrow-x-texture"),this.loadTexture("".concat(Jr.E.assetsUrl,"system/floorplanner/gizmo-arrow-y-2x.png"),"gizmo-arrow-y-texture"),this.loadTexture("".concat(Jr.E.assetsUrl,"system/floorplanner/gizmo-arrow-z-2x.png"),"gizmo-arrow-z-texture")]).then(function(){var e=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach((function(e){e.setRepeat(D.One()),e.markDirty()})),m.gizmoArrowTextures.push(t[0]),m.gizmoArrowTextures.push(t[1]),m.gizmoArrowTextures.push(t[2]),e.next=6,m.createGizmoArrows();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){qe.qL.error("TransformControls: Unable to load gizmo arrow textures.",e)})),this.loadTexture("".concat(Jr.E.assetsUrl,"system/floorplanner/protractor-texture.png"),"protractor-texture").then(function(){var e=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m.protractorTexture=t,m.protractorTexture.setRepeat(D.One()),m.protractorTexture.markDirty(),m.protractorMeshMaterial.setDiffuseMap(m.protractorTexture),m.protractorMeshMaterial.markDirty();case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){qe.qL.error("TransformControls: Unable to load protractor texture.",e)})),this.object=void 0,this.rotationAxis=void 0,this.rotationAxisSide=void 0,this.previousRotation=0,this.originalRotation=0,(i=P.renderer().getRenderEngine().createMaterialBasic("rotation-ring-material")).setDiffuseColor(so.Blue()),i.setSide(Es.Double),i.setTransparent(!0),i.setDepthTest(!1),i.setDepthWrite(!1),a=n.makeResourceRaw(i),e.t0=rc,e.t1=void 0,e.t2=Kp.Create(2.6,3.1,64,1,Pt(0),Pt(1)),e.next=21,n.resolveResource(a);case 21:return e.t3=e.sent,this.rotationRingMesh=new e.t0(e.t1,e.t2,e.t3),this.rotationRingMesh.name="transform-controls-rotation-ring",this.rotationRingMesh.visible=!1,this.rotationRingMesh.pickable=!1,this.rotationRingMesh.castShadow=!1,this.rotationRingMesh.receiveShadow=!1,this.rotationRingMesh.renderOrder=3,this.rotationRingMesh.layers.enable(5),this.rotationRingMesh.layers.enable(8),(o=P.renderer().getRenderEngine().createMaterialLine("line-material")).setDiffuseColor(so.Blue()),o.setSide(Es.Double),o.setTransparent(!0),o.setDepthTest(!1),o.setDepthWrite(!1),s=n.makeResourceRaw(o),e.t4=om,e.t5=void 0,e.t6=Qp.Create(.5,1,so.Blue()),e.next=43,n.resolveResource(s);case 43:return e.t7=e.sent,this.rotationLine=new e.t4(e.t5,e.t6,e.t7),this.rotationLine.name="transform-controls-rotation-line",this.rotationLine.visible=!1,this.rotationLine.pickable=!1,this.rotationLine.castShadow=!1,this.rotationLine.receiveShadow=!1,this.rotationLine.renderOrder=3,this.rotationLine.layers.enable(5),this.rotationLine.layers.enable(8),(u=P.renderer().getRenderEngine().createMaterialBasic("rotation-raycast-plane-material")).setDiffuseColor(so.Yellow()),u.setOpacity(0),u.setTransparent(!0),u.setSide(Es.Double),c=n.makeResourceRaw(u),e.t8=rc,e.t9=void 0,e.t10=Xp.Create(1e4,1e4,1,1),e.next=64,n.resolveResource(c);case 64:return e.t11=e.sent,this.rotationRaycastPlane=new e.t8(e.t9,e.t10,e.t11),this.rotationRaycastPlane.name="transform-controls-rotation-raycast-plane",this.rotationRaycastPlane.visible=!0,this.rotationRaycastPlane.pickable=!0,this.rotationRaycastPlane.castShadow=!1,this.rotationRaycastPlane.receiveShadow=!1,this.rotationRaycastPlane.renderOrder=999999,this.rotationRaycastPlane.layers.enable(4),this.rotationRaycastPlane.layers.enable(5),this.rotationRaycastPlane.layers.enable(8),(l=P.renderer().getRenderEngine().createMaterialBasic("protractor-mesh-material")).setDiffuseColor(so.White()),l.setTransparent(!0),l.useAlphaFromDiffuseMap(!0),l.setDepthTest(!1),l.setDepthWrite(!1),l.setSide(Es.Double),l.markDirty(),h=n.makeResourceRaw(l),e.next=86,n.resolveResource(h);case 86:this.protractorMeshMaterial=e.sent,this.protractorMesh=new rc(void 0,$p.Create(this.protractorRadius,64),this.protractorMeshMaterial),this.protractorMesh.name="transform-controls-protractor-mesh",this.protractorMesh.visible=!0,this.protractorMesh.pickable=!1,this.protractorMesh.castShadow=!1,this.protractorMesh.receiveShadow=!1,this.protractorMesh.renderOrder=3,this.protractorMesh.layers.enable(5),this.protractorMesh.layers.enable(8),this.protractorMesh.transform.position.set(0,.001,0),this.protractorMesh.transform.quaternion.setFromAxisAngle(Bi.AxisX(),Pt(-90)),P.sceneManager().addNode(this.protractorMesh,this.protractorGroup,!1),(f=document.createElement("div")).style.position="absolute",f.style.display="none",f.style.top="0px",f.style.left="0px",f.style.width="auto",f.style.height="auto",f.style.padding="15px 5px 14px 5px",f.style.margin="0px",f.style.font="normal 16px Arial",f.style.textAlign="center",f.style.lineHeight="0",f.style.color="rgba(0,0,0,1)",f.style.backgroundColor="rgba(255,255,255,1)",f.style.border="1px solid rgba(0,0,0,1)",f.style.borderRadius="3px",f.style.whiteSpace="nowrap",f.style.boxSizing="border-box",f.style.zIndex="5",f.style.pointerEvents="none",f.innerHTML="".concat(0,"&#176;"),this.rotationText=f,document.body.appendChild(f),p=P.sceneManager().getScene(),P.sceneManager().addNode(this.rotationRaycastPlane,p,!1),P.sceneManager().addNode(this.protractorGroup,p,!1),P.sceneManager().addNode(this.rotationRingMesh,p,!1),P.sceneManager().addNode(this.rotationLine,p,!1),this.enablePanning(),this.setRotationVisibility(!1),this.initialize(),this.mEventBrokerSubscriptions.push(P.eventBus().subscribe(Di.getTopicName(Ei.ObjectSelected),(function(e){m.mObjectSelectedSubject.next(e)})),P.eventBus().subscribe(Di.getTopicName(Ei.NodeAdded),this.objectAddedHandler.bind(this)),P.eventBus().subscribe(Di.getTopicName(Ei.NodeRemoved),this.objectRemovedHandler.bind(this)),P.eventBus().subscribe(Di.getTopicName(Ei.NodeChanged),this.objectAddedHandler.bind(this))),this.mObjectSelectedSubject.pipe(Hp(50)).subscribe(function(){var e=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m.objectSelectedHandler(t).then((function(){}),(function(e){qe.qL.error(e)}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.registerMessageHandler(je.TypeRTTI,(function(){m.update()}));case 133:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"OnDetached",value:function(){this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mEventBrokerSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mObjectSelectedSubject.unsubscribe(),this.dispose()}},{key:"objectAddedHandler",value:function(e){var t=e.getData();if(t){var n=this.resolveDroppableComponent(t);if(n){var r=n.getParentObject(),i=r.isDerivedTypeOf(nm.TypeRTTI)?r:t;this.addPanningRaycastPlane(i)}}}},{key:"objectRemovedHandler",value:function(e){var t=e.getData();t&&(this.resolveDroppableComponent(t)&&this.removePanningRaycastPlane(t))}},{key:"resolveDroppableComponent",value:function(e){if(e&&e instanceof Wi)return e.getComponent("droppable-handler")}},{key:"objectSelectedHandler",value:(h=t(r().mark((function e(t){var n,i,a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.detach(),n=t.getData(),i=n?n.selection:void 0){e.next=5;break}return e.abrupt("return");case 5:if(!(i instanceof Lf)){e.next=10;break}return e.next=8,this.attach(i);case 8:e.next=20;break;case 10:if(i instanceof Pc?a=i:i instanceof Ki&&(a=i.findParentOfType(Pc.TypeRTTI)),!a){e.next=20;break}if(!((o=a.getParent())&&o instanceof Lf)){e.next=18;break}return e.next=16,this.attach(o);case 16:e.next=20;break;case 18:return e.next=20,this.attach(a);case 20:P.eventBus().dispatch(new Di(Ei.RequestFrame));case 21:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"attach",value:(a=t(r().mark((function e(t){var n,i,a,u,c,l,h=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||P.sceneManager().getScene().getSceneObjectId()!==t.getSceneObjectId()||P.sceneManager().getRootProductNode().getSceneObjectId()!==t.getSceneObjectId()){e.next=2;break}return e.abrupt("return");case 2:if(!this.object||!t||this.object.getSceneObjectId()!==t.getSceneObjectId()){e.next=4;break}return e.abrupt("return");case 4:return this.object&&this.detach(),this.object=t,this.updateBoundingBox(),e.next=9,this.createGizmoArrows();case 9:n=new Bi,i=new Pi,this.object.transform.getWorldPosition(n),this.object.transform.getWorldQuaternion(i),[].concat(s(this.arrowAxisXMesh),s(this.arrowAxisYMesh),s(this.arrowAxisZMesh)).forEach((function(e){P.sceneManager().addNode(e,h.object,!1)})),this.repositionGizmoArrows(),this.rotationLine.transform.position.copy(n),this.rotationLine.transform.quaternion.copy(i),this.rotationRingMesh.transform.position.copy(n),this.rotationRingMesh.transform.quaternion.copy(i),this.rotationRaycastPlane.transform.position.copy(n),this.rotationRaycastPlane.transform.quaternion.copy(i),this.setRotationVisibility(!1,this.rotationEnabled),this.mNextObjectPosition.copy(this.object.transform.position),this.mNextObjectQuaternion.copy(this.object.transform.quaternion),this.mNextObjectPlaneNormal.copy(this.object.up),this.mNextObjectPlanePoint.copy(this.object.transform.position),a=this.object.getComponents(mc.TypeRTTI),u=o(a,1),c=u[0],this.mUsePhysicsCollider=!!c,c&&(l=new lm,this.object.addComponent(l),c.getBody().setBodyType(hc.Dynamic),c.getBody().setMass(1),c.getBody().setLinearVelocity(Bi.Zero()),c.getBody().setAngularVelocity(Pi.identity()),l.setNextPosition(this.mNextObjectPosition),l.setNextQuaternion(this.mNextObjectQuaternion),l.setPlaneNormal(this.mNextObjectPlaneNormal),l.setPlanePoint(this.mNextObjectPlanePoint)),this.update(),P.eventBus().dispatch(new Di(Ei.RequestFrame));case 31:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"detach",value:function(){if(this.hasObject()){this.arrowAxisXMesh.forEach((function(e){P.sceneManager().removeNode(e,!1,!1,!1,!1)})),this.arrowAxisYMesh.forEach((function(e){P.sceneManager().removeNode(e,!1,!1,!1,!1)})),this.arrowAxisZMesh.forEach((function(e){P.sceneManager().removeNode(e,!1,!1,!1,!1)})),this.object.removeComponents(lm.TypeRTTI);var e=o(this.object.getComponents(mc.TypeRTTI),1)[0];e&&(e.getBody().setBodyType(hc.Kinematic),e.getBody().setMass(0),e.getBody().setLinearVelocity(Bi.Zero()),e.getBody().setAngularVelocity(Pi.identity()))}delete this.object,this.setRotationVisibility(!1),this.rotationAxis=void 0,this.rotationAxisSide=void 0,this.isRotating=!1,this.rotationRingMesh.visible=!1,this.rotationLine.visible=!1,this.mUsePhysicsCollider=!1}},{key:"update",value:function(){if(this.object&&this.enabled&&this.rotationEnabled){var e=P.sceneManager().getActiveCamera(),t=new Bi,n=new Pi,r=new Bi;this.object.transform.getWorldPosition(t),this.object.transform.getWorldQuaternion(n),this.boundingBoxObject.getCenter(r),r.applyQuaternion(n);var i=t.clone().add(r),a=i.clone().sub(e.transform.position).normalize();if(this.arrowAxisXMesh.length>0&&this.arrowsVisible&&(this.rotationAxisEnabled&um.X)===um.X)for(var s=0,u=-1/0,c=new Bi,l=0;l<this.arrowAxisXMesh.length;l++){this.arrowAxisXMesh[l].visible=!1,this.arrowAxisXMesh[l].transform.getWorldPosition(c);var h=i.clone().sub(c).normalize(),f=a.dot(h);if(f>u&&(s=l,u=f),3===l||7===l){var p=new Bi;this.arrowAxisXMesh[s].transform.getWorldDirection(p),this.arrowAxisXMesh[s].visible=a.dot(p)<0,u=-1/0}}if(this.arrowAxisYMesh.length>0&&this.arrowsVisible&&(this.rotationAxisEnabled&um.Y)===um.Y)for(var m=0,d=-1/0,v=new Bi,y=0;y<this.arrowAxisYMesh.length;y++){this.arrowAxisYMesh[y].visible=!1,this.arrowAxisYMesh[y].transform.getWorldPosition(v);var g=i.clone().sub(v).normalize(),b=a.dot(g);if(b>d&&(m=y,d=b),3===y||7===y){var M=new Bi;this.arrowAxisYMesh[m].transform.getWorldDirection(M),this.arrowAxisYMesh[m].visible=a.dot(M)<0,d=-1/0}}if(this.arrowAxisZMesh.length>0&&this.arrowsVisible&&(this.rotationAxisEnabled&um.Z)===um.Z)for(var k=0,_=-1/0,x=new Bi,T=0;T<this.arrowAxisZMesh.length;T++){this.arrowAxisZMesh[T].visible=!1,this.arrowAxisZMesh[T].transform.getWorldPosition(x);var w=i.clone().sub(x).normalize(),R=a.dot(w);if(R>_&&(k=T,_=R),3===T||7===T){var Z=new Bi;this.arrowAxisZMesh[k].transform.getWorldDirection(Z),this.arrowAxisZMesh[k].visible=a.dot(Z)<0,_=-1/0}}var S=t.distanceTo(e.transform.position);if(S!==this.mCameraToObjectDistance){this.mCameraToObjectDistance=S;var C=Dt(S*this.sizeProtractor.scale,this.sizeProtractor.min,this.sizeProtractor.max);this.protractorGroup.transform.scale.set(C,C,C),this.arrowsVisible&&this.repositionGizmoArrows()}if(this.mUsePhysicsCollider){var I=o(this.object.getComponents(lm.TypeRTTI),1)[0];I&&(I.setNextPosition(this.mNextObjectPosition),I.setNextQuaternion(this.mNextObjectQuaternion),I.setPlaneNormal(this.mNextObjectPlaneNormal),I.setPlanePoint(this.mNextObjectPlanePoint))}}}},{key:"EnableRotationAxis",value:function(e){this.rotationAxisEnabled|=e,this.setRotationVisibility(!1,!0)}},{key:"DisableRotationAxis",value:function(e){this.rotationAxisEnabled&=~e,this.setRotationVisibility(!1,!0)}},{key:"toggleRotationAxis",value:function(e){this.rotationAxisEnabled^=e,this.setRotationVisibility(!1,!0)}},{key:"isRotationAxisEnabled",value:function(e){return(this.rotationAxisEnabled&e)===e}},{key:"enablePanning",value:function(){this.panEnabled=!0}},{key:"disablePanning",value:function(){this.panEnabled=!1}},{key:"isPanningEnabled",value:function(){return this.panEnabled}},{key:"EnableRotation",value:function(){this.rotationEnabled=!0,this.setRotationVisibility(!1,!0)}},{key:"DisableRotation",value:function(){this.rotationEnabled=!1,this.setRotationVisibility(!1,!1)}},{key:"isRotationEnabled",value:function(){return this.rotationEnabled}},{key:"initialize",value:function(){var e=this;try{if(document.body.contains(this.domElement)){var t=this.domElement.getBoundingClientRect();this.boundingRect.set(t.left,t.top,t.width,t.height)}}catch(e){qe.qL.error(e)}this.registerMessageHandler(Ae.TypeRTTI,(function(t){e.onWindowResize(t.width,t.height)})),this.registerMessageHandler(Y.TypeRTTI,(function(t){switch(t.name){case"up":e.onBeforeMouseUp(t.event);break;case"down":e.onBeforeMouseDown(t.event);break;case"move":e.onBeforeMouseMove(t.event)}}))}},{key:"dispose",value:function(){this.object&&this.detach(),this.arrowAxisXMesh.splice(0).forEach((function(e){e.unsetMaterial(),e.destroy(!0)})),this.arrowAxisYMesh.splice(0).forEach((function(e){e.unsetMaterial(),e.destroy(!0)})),this.arrowAxisZMesh.splice(0).forEach((function(e){e.unsetMaterial(),e.destroy(!0)}));var e=tc.getManager(Qu.MaterialManager);e.disposeResource(this.mArrowXMaterialhandle,!0),e.disposeResource(this.mArrowYMaterialhandle,!0),e.disposeResource(this.mArrowZMaterialhandle,!0),delete this.mArrowXMaterialhandle,delete this.mArrowYMaterialhandle,delete this.mArrowZMaterialhandle;var t=tc.getManager(Qu.TextureManager);this.protractorTexture&&(t.disposeTexture(this.protractorTexture,void 0,!0),delete this.protractorTexture),this.gizmoArrowTextures.splice(0).forEach((function(e){t.disposeTexture(e,void 0,!0)})),P.sceneManager().removeNode(this.protractorGroup,!1,!0),this.protractorGroup.destroy(!0),delete this.protractorGroup,this.protractorMesh.destroy(!0),delete this.protractorMesh,P.sceneManager().removeNode(this.rotationRingMesh,!1,!0),this.rotationRingMesh.destroy(!0),delete this.rotationRingMesh,P.sceneManager().removeNode(this.rotationLine,!1,!0),this.rotationLine.destroy(!0),P.sceneManager().removeNode(this.rotationRaycastPlane,!1,!0),this.rotationRaycastPlane.destroy(!0),delete this.rotationRaycastPlane,this.object=void 0,this.unregisterMessageHandler(Ae.TypeRTTI),this.unregisterMessageHandler(Y.TypeRTTI)}},{key:"addPanningRaycastPlane",value:function(e){this.panningRaycastPlanes.findIndex((function(t){return t.id===e.id}))<0&&this.panningRaycastPlanes.push(e)}},{key:"removePanningRaycastPlane",value:function(e){var t=this.panningRaycastPlanes.findIndex((function(t){return t.id===e.id}));t>=0&&this.panningRaycastPlanes.splice(t,1)}},{key:"updateBoundingBox",value:function(){var e=new Bi,t=new ji;this.object.updateMatrixWorld(),this.object.transform.getWorldScale(e);var n=this.object.getChildrenDerivedTypeOf(Mc.TypeRTTI);if(n.length>0){var r=o(n,1)[0];t.copy(r.boundingBox)}var i=(new Fi).makeScale(e.x,e.y,e.z);t.applyMatrix4(i),this.boundingBoxObject.copy(t)}},{key:"onMouseDown",value:function(e,t){if(this.object&&this.enabled){this.update(),this.isRotating=!1,this.isPanning=!1,this.mousedown=!0,this.object.updateMatrixWorld(),this.updateBoundingBox(),this.repositionGizmoArrows();var n=new Bi;this.boundingBoxObject.getSize(n);var r=n.x,i=n.y,a=n.z,s=new Pi,u=Bi.Up(),c=new Bi;this.object.transform.getWorldQuaternion(s),u.applyQuaternion(s),this.object.transform.getWorldDirection(c);var l=c.clone().cross(u),h=new Bi;if(this.object.transform.getWorldPosition(h),this.rotationEnabled&&!this.isPanning){var f=[];if(this.isRotationAxisEnabled(um.X))for(var p=0;p<this.arrowAxisXMesh.length;p++)this.arrowAxisXMesh[p].visible&&f.push(this.arrowAxisXMesh[p]);if(this.isRotationAxisEnabled(um.Y))for(var m=0;m<this.arrowAxisYMesh.length;m++)this.arrowAxisYMesh[m].visible&&f.push(this.arrowAxisYMesh[m]);if(this.isRotationAxisEnabled(um.Z))for(var d=0;d<this.arrowAxisZMesh.length;d++)this.arrowAxisZMesh[d].visible&&f.push(this.arrowAxisZMesh[d]);var v=this.intersectObjects(e,t,f);if(v.length>0){var y=o(v,1)[0];P.eventBus().dispatch(new Di(Ei.TransformControlChanged,this.object)),this.isRotating=!0,this.rotationAxis=void 0,this.rotationAxisSide=void 0;var g=P.sceneManager().getActiveCamera(),b=new Bi;g.transform.getWorldPosition(b);var M=this.arrowAxisXMesh.findIndex((function(e){return e.id===y.entity.id}));M>=0&&(this.rotationAxis=um.X,this.rotationAxisSide=this.arrowAxisXMesh[M].metaData.AxisSide),this.rotationAxis||(M=this.arrowAxisYMesh.findIndex((function(e){return e.id===y.entity.id})))>=0&&(this.rotationAxis=um.Y,this.rotationAxisSide=this.arrowAxisYMesh[M].metaData.AxisSide),this.rotationAxis||(M=this.arrowAxisZMesh.findIndex((function(e){return e.id===y.entity.id})))>=0&&(this.rotationAxis=um.Z,this.rotationAxisSide=this.arrowAxisZMesh[M].metaData.AxisSide);var k=new Bi(0,0,0),_=this.object.transform.quaternion.clone();if(this.rotationAxis===um.X){var x=l.clone();this.rotationAxisSide===cm.POSITIVE?(k.copy(x.multiplyScalar(-.5*r)),_.multiply((new Pi).setFromAxisAngle(new Bi(0,1,0),Pt(270)))):(k.copy(x.multiplyScalar(.5*r)),_.multiply((new Pi).setFromAxisAngle(new Bi(0,1,0),Pt(90))))}else if(this.rotationAxis===um.Y){var T=u.clone();this.rotationAxisSide===cm.NEGATIVE?(k.copy(T.multiplyScalar(-.5*i)),_.multiply((new Pi).setFromAxisAngle(new Bi(1,0,0),Pt(270)))):(k.copy(T.multiplyScalar(.5*i)),_.multiply((new Pi).setFromAxisAngle(new Bi(1,0,0),Pt(90))))}else if(this.rotationAxis===um.Z){var w=c.clone();this.rotationAxisSide===cm.NEGATIVE?k.copy(w.multiplyScalar(-.5*a)):(k.copy(w.multiplyScalar(.5*a)),_.multiply((new Pi).setFromAxisAngle(new Bi(0,1,0),Pt(180))))}else this.rotationAxis=void 0;this.previousRotation=void 0,this.rotationOffset=0,this.originalRotation=0;var R=h.clone().add(k);this.protractorGroup.transform.position.copy(h);var Z=h.clone(),S=new Bi;this.protractorMesh.transform.getWorldPosition(S);var C=new D(Z.x,Z.z),I=new D(S.x,S.z);(C.distanceTo(I)<pl.EPS||Math.abs(I.x)<pl.EPS&&Math.abs(I.y)<pl.EPS)&&Z.add(new Bi(0,0,.001));var E=(new Fi).lookAt(Z,R,Bi.Up()),A=(new Pi).setFromRotationMatrix(E);this.protractorMesh.transform.quaternion.copy(A),this.rotationRingMesh.transform.position.copy(h),this.rotationRingMesh.transform.quaternion.copy(_),this.rotationLine.transform.position.copy(h),this.rotationLine.transform.quaternion.copy(_);var O=window.pageXOffset||document.documentElement.scrollLeft,B=window.pageYOffset||document.documentElement.scrollTop,F=this.worldToScreen(R.x,R.y,R.z),L=this.boundingRect.x+F.x+O-15,N=this.boundingRect.y+F.y+B-15;this.rotationText.style.transform="translate3d(".concat(L,"px,").concat(N,"px,0px)"),this.rotationText.innerHTML="".concat(0,"&#176;"),this.rotationRaycastPlane.transform.position.copy(h),this.rotationRaycastPlane.transform.quaternion.copy(_),this.rotationRaycastPlane.layers.disable(4),this.objectUpDirectionBasedOnAxis.copy(Bi.Up().applyQuaternion(_)),this.setRotationVisibility(!0,!0),this.dragging=!0}else this.isRotating=!1,this.rotationAxis=void 0,this.rotationAxisSide=void 0,this.dragging=!1,this.rotationRaycastPlane.layers.enable(4),this.setRotationVisibility(!1,!0)}if(this.panEnabled&&!this.isRotating)if(this.panningRaycastPlanes.length>0)this.intersectProductNode(e,t,this.object)&&(P.eventBus().dispatch(new Di(Ei.TransformControlChanged,this.object)),this.isPanning=!0);else qe.qL.warn("TransformControls: Raycast plane for panning is not defined!");(this.isPanning||this.isRotating)&&(this.mNextObjectPosition.copy(this.object.transform.position),this.mNextObjectQuaternion.copy(this.object.transform.quaternion)),this.update(),P.eventBus().dispatch(new Di(Ei.RequestFrame))}}},{key:"onMouseUp",value:function(e,t){var n=this;this.object&&this.enabled&&(this.isPanning=!1,this.isRotating=!1,this.mousedown=!1,this.rotationEnabled&&void 0!==this.rotationAxis&&this.setRotationVisibility(!1,!0),this.dragging=!1,this.rotationAxis=void 0,this.rotationAxisSide=void 0,this.rotationOffset=0,this.previousRotation=void 0,this.rotationRaycastPlane.layers.enable(4),window.setTimeout((function(){n.rotationRingMesh.visible=!1,n.rotationLine.visible=!1}),10),this.update(),P.eventBus().dispatch(new Di(Ei.RequestFrame)))}},{key:"getCellPosition",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=t.clone().multiply((new Pi).setFromEuler(new Li(-.5*Math.PI,0,0))),a=new Bi(n,0,r).addScalar(1e-5),o=a.clone().applyQuaternion(i),s=a.clone().multiplyScalar(.5).applyQuaternion(i);return(new Bi).copy(e).divide(o).floor().multiply(o).add(s)}},{key:"calculateUVCoordPlane",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bi.Up(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Pi.identity(),i=n.clone(),a=new Bi;e.transform.getWorldDirection(a),a.applyQuaternion(r),Math.abs(a.x-i.x)<pl.EPS&&Math.abs(a.y-i.y)<pl.EPS&&Math.abs(a.z-i.z)<pl.EPS&&i.applyAxisAngle(Bi.Right(),Pt(90));var o=new Bi;e.transform.getWorldPosition(o);var s=a.clone().cross(i),u=a.clone(),c=new _c(u),l=new Bi,h=new Bi;c.projectPoint(t,l),c.projectPoint(o,h);var f=i.dot(l),p=s.dot(l),m=i.dot(h),d=s.dot(h);return new D(f,p).sub(new D(m,d)).normalize()}},{key:"getObjectsSnappedRotation",value:function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=this.protractorGroup.transform.scale.x,s=this.protractorRadius*o*2,u=n,c=u-Dt(r.distanceTo(i)/s*u,0,u),l=360-pl.Arctangent(0,0,e.x,e.y);return this.snapToDegrees(Pt(l),Pt(t),Pt(c),Pt(a))*Ot}},{key:"onMouseMove",value:function(e,t){var n=this;if(this.object&&this.enabled){if(this.panEnabled&&this.isPanning&&!this.isRotating&&this.mousedown&&this.panningRaycastPlanes.length>0){var r=this.intersectObjects(e,t,this.panningRaycastPlanes);if(r.length>0){var i=o(r,1)[0];P.eventBus().dispatch(new Di(Ei.TransformControlChanged,this.object));var a=this.panningRaycastPlanes.find((function(e){return e.id===i.entity.id})),s=new Pi;a.transform.getWorldQuaternion(s),this.mNextObjectPlanePoint.copy(i.point),this.mNextObjectPlaneNormal.copy(i.normal);var u=1,c=1;a instanceof nm&&(u=a.cellWidth,c=a.cellHeight);var l=this.getCellPosition(i.point,s,u,c),h=this.getCellPosition(this.object.transform.position,s,u,c);if(l.clone().sub(h).lengthSq()>pl.EPS){var f=l.clone(),p=i.faceNormal.clone().applyQuaternion(i.entity.transform.quaternion),m=pl.RotateBasedOnUpAxis(this.object.transform.quaternion.clone(),p);this.mUsePhysicsCollider?(this.mNextObjectPosition.copy(f),this.mNextObjectQuaternion.copy(m)):(this.object.transform.position.copy(f),this.object.transform.quaternion.copy(m),P.eventBus().dispatch(new Di(Ei.ObjectChanged,{name:"position",object:this.object})),P.eventBus().dispatch(new Di(Ei.ObjectChanged,{name:"rotation",object:this.object})),P.eventBus().dispatch(new Di(Ei.ObjectTransformed,{object:this.object})),P.eventBus().dispatch(new Di(Ei.TransformControlChanged,this.object)))}}}if(this.rotationEnabled&&!this.isPanning&&this.rotationAxis&&this.dragging){var d=this.intersectObjects(e,t,[this.rotationRaycastPlane]);if(d.length>0){var v=o(d,1)[0];P.eventBus().dispatch(new Di(Ei.TransformControlChanged,this.object));var y=new Bi,g=new Pi;this.object.transform.getWorldPosition(y),this.object.transform.getWorldQuaternion(g);var b=P.sceneManager().getActiveCamera();this.object.updateMatrixWorld(),b.updateMatrixWorld();var M=(new Fi).extractRotation(this.object.transform.matrixWorld),k=(new Pi).setFromRotationMatrix(M),_=new Bi;this.boundingBoxObject.getCenter(_),_.applyQuaternion(g);var x=void 0===this.previousRotation,T=Bi.Up(),w=Pi.identity();this.protractorMesh.transform.getWorldQuaternion(w),T.applyQuaternion(w);var R=this.calculateUVCoordPlane(this.protractorMesh,v.point,T),Z=360-pl.Arctangent(0,0,R.x,R.y),S=this.getObjectsSnappedRotation(R,30,10,v.point,this.rotationRaycastPlane.transform.position),C=this.getRotationOffset(S,Z);Math.abs(C)>11&&(C=0);var I=this.calculateUVCoordPlane(this.rotationRaycastPlane,v.point,this.objectUpDirectionBasedOnAxis),E=360-pl.Arctangent(0,0,I.x,I.y);E+=C,E=Math.round(E);var A=0;x&&(this.originalRotation=this.setToClosestBy(E%360,[0,90,180,270,360]),this.previousRotation=E,this.previousUVCoord.copy(I),A=this.getRotationOffset(E-this.originalRotation,E-this.previousRotation));var O=(E-this.previousRotation+A)%360;k.setFromRotationMatrix(M);var D=this.rotationAxisSide===cm.POSITIVE?1:-1;if(this.rotationAxis===um.X?k.multiply((new Pi).setFromAxisAngle(this.UnitX,Pt(O*D))):this.rotationAxis===um.Y?k.multiply((new Pi).setFromAxisAngle(this.UnitY,Pt(O*D))):this.rotationAxis===um.Z&&k.multiply((new Pi).setFromAxisAngle(this.UnitZ,Pt(O*D))),this.rotationAxis){this.rotationOffset+=this.getRotationOffset(E,this.previousRotation),this.rotationOffset+=A,this.rotationOffset%=360;var B=this.rotationOffset>=0,F=0===this.originalRotation||180===this.originalRotation?90:270,L=E-this.originalRotation;B&&L<0&&(L+=360);var N=(B?L:-(360-L))%360,j=(this.originalRotation-N+F)%360;j<0&&(j+=360);var z=Dt(y.distanceTo(b.transform.position)*this.sizeProtractor.scale,this.sizeProtractor.min,this.sizeProtractor.max);this.protractorGroup.transform.scale.set(z,z,z),this.object.transform.updateMatrix(),this.updateBoundingBox();var U=new Bi;this.boundingBoxObject.getCenter(U);var V=this.object.transform.quaternion.clone().conjugate().multiply(k),H=(new Fi).makeTranslation(U.x,U.y,U.z);H.multiply((new Fi).makeRotationFromQuaternion(V)),H.multiply((new Fi).makeTranslation(-U.x,-U.y,-U.z));var G=new Bi,q=new Pi,W=new Bi;if(this.object.transform.matrix.clone().multiply(H).decompose(G,q,W),this.mUsePhysicsCollider,this.object.transform.quaternion.copy(q),this.object.transform.updateMatrix(),this.rotationText.innerHTML="".concat(Math.abs(Math.round(N)),"&#176;"),Math.abs(N)>1e-5){var Y=this.protractorRadius*z-this.ringThickness*z,K=this.protractorRadius*z,X=Kp.Create(Y,K,64,1,Pt(j),Pt(N),Es.Double);this.rotationRingMesh.setGeometry(X,void 0,!0),window.setTimeout((function(){n.rotationRingMesh.visible=!0}),0)}else window.setTimeout((function(){n.rotationRingMesh.visible=!1}),0);var $=Pt(360-(E-90));this.rotationLine.setGeometry(Qp.CreateStartEnd(Bi.Zero(),new Bi(Math.cos($)*(this.protractorRadius*z),Math.sin($)*(this.protractorRadius*z),0),1,so.Blue()),void 0,!0),window.setTimeout((function(){n.rotationLine.visible=!0}),10),P.eventBus().dispatch(new Di(Ei.TransformControlChanged,this.object)),this.previousRotation=E,this.previousUVCoord.copy(I)}}}}}},{key:"onWindowResize",value:function(e,t){var n=this;window.setTimeout((function(){try{var e=n.domElement.getBoundingClientRect();n.boundingRect.set(e.left,e.top,e.width,e.height)}catch(e){qe.qL.error(e)}}),50)}},{key:"setRotationVisibility",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.visible=e||t,this.protractorGroup.visible=e,this.rotationText&&(this.rotationText.style.display=e?"block":"none"),this.arrowsVisible=t?!e:e,this.isRotationAxisEnabled(um.X)||this.isRotationAxisEnabled(um.Y)||this.isRotationAxisEnabled(um.Z)||(this.arrowsVisible=!1);for(var n=0;n<this.arrowAxisXMesh.length;n++)this.arrowAxisXMesh[n]&&(this.arrowAxisXMesh[n].visible=!!this.isRotationAxisEnabled(um.X)&&this.arrowsVisible);for(var r=0;r<this.arrowAxisYMesh.length;r++)this.arrowAxisYMesh[r]&&(this.arrowAxisYMesh[r].visible=!!this.isRotationAxisEnabled(um.Y)&&this.arrowsVisible);for(var i=0;i<this.arrowAxisZMesh.length;i++)this.arrowAxisZMesh[i]&&(this.arrowAxisZMesh[i].visible=!!this.isRotationAxisEnabled(um.Z)&&this.arrowsVisible);P.eventBus().dispatch(new Di(Ei.RequestFrame))}},{key:"repositionGizmoArrows",value:function(){this.object&&this.updateBoundingBox();var e=this.scaleGizmoArrows(),t=new Bi,n=new Bi;this.boundingBoxObject.getSize(t),this.boundingBoxObject.getCenter(n);for(var r=t.x,i=t.y,a=t.z,o=.05,s=.5*r+.5*(.05*e)+o,u=.5*i+.5*(.05*e)+o,c=.5*a+.5*(.05*e)+o,l=[new Bi(0,u,0),new Bi(0,0,c),new Bi(0,-u,0),new Bi(0,0,-c)],h=0;h<this.arrowAxisXMesh.length;h++)this.arrowAxisXMesh[h].transform.position.set(h<4?-.5*r:.5*r,l[h%4].y,l[h%4].z),this.arrowAxisXMesh[h].transform.position.add(n);l=[new Bi(0,0,c),new Bi(-s,0,0),new Bi(0,0,-c),new Bi(s,0,0)];for(var f=0;f<this.arrowAxisYMesh.length;f++)this.arrowAxisYMesh[f].transform.position.set(l[f%4].x,f<4?.5*i:-.5*i,l[f%4].z),this.arrowAxisYMesh[f].transform.position.add(n);l=[new Bi(0,u,0),new Bi(-s,0,0),new Bi(0,-u,0),new Bi(s,0,0)];for(var p=0;p<this.arrowAxisZMesh.length;p++)this.arrowAxisZMesh[p].transform.position.set(l[p%4].x,l[p%4].y,p<4?-.5*a:.5*a),this.arrowAxisZMesh[p].transform.position.add(n)}},{key:"scaleGizmoArrows",value:function(){var e=new Bi(0,0,0);this.object&&this.object.transform.getWorldPosition(e);for(var t=P.sceneManager().getActiveCamera(),n=Dt(e.distanceTo(t.transform.position)*this.sizeArrows.scale,this.sizeArrows.min,this.sizeArrows.max),r=0;r<this.arrowAxisXMesh.length;r++)this.arrowAxisXMesh[r].transform.scale.set(n,n,n);for(var i=0;i<this.arrowAxisYMesh.length;i++)this.arrowAxisYMesh[i].transform.scale.set(n,n,n);for(var a=0;a<this.arrowAxisZMesh.length;a++)this.arrowAxisZMesh[a].transform.scale.set(n,n,n);return n}},{key:"createGizmoArrows",value:(i=t(r().mark((function e(){var t,n,i,a,o,s,u,c,l,h,f,p,m,d,v,y,g,b,M,k,_,x,T,w;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.gizmoArrowTextures.length){e.next=2;break}return e.abrupt("return");case 2:if(t=tc.getManager(Qu.MaterialManager),n=tc.getManager(Qu.TextureManager),i=[Pt(0),Pt(90),Pt(180),Pt(270)],a=[Pt(90),Pt(270)],s=[cm.NEGATIVE,cm.POSITIVE],this.mArrowXMaterialhandle){e.next=22;break}return u=n.makeResourceRaw(this.gizmoArrowTextures[0]),e.next=11,n.resolveResource(u);case 11:c=e.sent,(l=P.renderer().getRenderEngine().createMaterialBasic("arrow-x-material")).setDiffuseColor(so.White()),l.setDiffuseMap(c),l.useAlphaFromDiffuseMap(!0),l.setTransparent(!0),l.setOpacity(.5),l.setDepthTest(!1),l.setDepthWrite(!1),l.setSide(Es.Front),this.mArrowXMaterialhandle=t.makeResourceRaw(l);case 22:h=0===this.arrowAxisXMesh.length,f=0;case 24:if(!(f<8)){e.next=40;break}if(!h){e.next=35;break}return e.next=28,t.resolveResource(this.mArrowXMaterialhandle);case 28:p=e.sent,this.arrowAxisXMesh.push(new rc(void 0,Xp.Create(.05,.05,1,1),p)),this.arrowAxisXMesh[f].name="transform-controls-gizmo-arrow-x",this.arrowAxisXMesh[f].pickable=!0,this.arrowAxisXMesh[f].metaData.AxisSide=s[Math.floor(f/4)],this.arrowAxisXMesh[f].layers.enable(5),this.arrowAxisXMesh[f].layers.enable(8);case 35:this.arrowAxisXMesh[f].transform.quaternion.multiplyQuaternions((new Pi).setFromAxisAngle(this.UnitX,i[f%4]),(new Pi).setFromAxisAngle(this.UnitY,a[Math.floor(f/4)])),this.arrowAxisXMesh[f].visible=this.rotationEnabled&&this.arrowsVisible&&this.isRotationAxisEnabled(um.X);case 37:f++,e.next=24;break;case 40:if(i=[Pt(90),Pt(270)],o=[Pt(0),Pt(90),Pt(180),Pt(270),Pt(180),Pt(90),Pt(0),Pt(270)],s=[cm.POSITIVE,cm.NEGATIVE],this.mArrowYMaterialhandle){e.next=58;break}return m=n.makeResourceRaw(this.gizmoArrowTextures[1]),e.next=47,n.resolveResource(m);case 47:d=e.sent,(v=P.renderer().getRenderEngine().createMaterialBasic("arrow-y-material")).setDiffuseColor(so.White()),v.setDiffuseMap(d),v.useAlphaFromDiffuseMap(!0),v.setTransparent(!0),v.setOpacity(.5),v.setDepthTest(!1),v.setDepthWrite(!1),v.setSide(Es.Front),this.mArrowYMaterialhandle=t.makeResourceRaw(v);case 58:y=0===this.arrowAxisYMesh.length,g=0;case 60:if(!(g<8)){e.next=76;break}if(!y){e.next=71;break}return e.next=64,t.resolveResource(this.mArrowYMaterialhandle);case 64:b=e.sent,this.arrowAxisYMesh.push(new rc(void 0,Xp.Create(.05,.05,1,1),b)),this.arrowAxisYMesh[g].name="transform-controls-gizmo-arrow-y",this.arrowAxisYMesh[g].pickable=!0,this.arrowAxisYMesh[g].metaData.AxisSide=s[Math.floor(g/4)],this.arrowAxisYMesh[g].layers.enable(5),this.arrowAxisYMesh[g].layers.enable(8);case 71:this.arrowAxisYMesh[g].transform.quaternion.multiplyQuaternions((new Pi).setFromAxisAngle(this.UnitX,i[Math.floor(g/4)]),(new Pi).setFromAxisAngle(this.UnitZ,o[g])),this.arrowAxisYMesh[g].visible=this.rotationEnabled&&this.arrowsVisible&&this.isRotationAxisEnabled(um.Y);case 73:g++,e.next=60;break;case 76:if(a=[Pt(0),Pt(180)],o=[Pt(0),Pt(90),Pt(180),Pt(270),Pt(0),Pt(270),Pt(180),Pt(90)],s=[cm.NEGATIVE,cm.POSITIVE],this.mArrowZMaterialhandle){e.next=94;break}return M=n.makeResourceRaw(this.gizmoArrowTextures[2]),e.next=83,n.resolveResource(M);case 83:k=e.sent,(_=P.renderer().getRenderEngine().createMaterialBasic("arrow-z-material")).setDiffuseColor(so.White()),_.setDiffuseMap(k),_.useAlphaFromDiffuseMap(!0),_.setTransparent(!0),_.setOpacity(.5),_.setDepthTest(!1),_.setDepthWrite(!1),_.setSide(Es.Front),this.mArrowZMaterialhandle=t.makeResourceRaw(_);case 94:x=0===this.arrowAxisZMesh.length,T=0;case 96:if(!(T<8)){e.next=112;break}if(!x){e.next=107;break}return e.next=100,t.resolveResource(this.mArrowZMaterialhandle);case 100:w=e.sent,this.arrowAxisZMesh.push(new rc(void 0,Xp.Create(.05,.05,1,1),w)),this.arrowAxisZMesh[T].name="transform-controls-gizmo-arrow-z",this.arrowAxisZMesh[T].pickable=!0,this.arrowAxisZMesh[T].metaData.AxisSide=s[Math.floor(T/4)],this.arrowAxisZMesh[T].layers.enable(5),this.arrowAxisZMesh[T].layers.enable(8);case 107:this.arrowAxisZMesh[T].transform.quaternion.multiplyQuaternions((new Pi).setFromAxisAngle(this.UnitY,a[Math.floor(T/4)]),(new Pi).setFromAxisAngle(this.UnitZ,o[T])),this.arrowAxisZMesh[T].visible=this.rotationEnabled&&this.arrowsVisible&&this.isRotationAxisEnabled(um.Z);case 109:T++,e.next=96;break;case 112:this.repositionGizmoArrows();case 113:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"intersectObjects",value:function(e,t,n){var r=e-this.boundingRect.x,i=t-this.boundingRect.y,a=P.sceneManager().getActiveCamera(),o=P.renderer().getRenderEngine().getForwardRayFromScreenCoords(a,r,i,1/0);return P.renderer().getRenderEngine().raycastIntersects(o,n,!1)}},{key:"intersectProductNode",value:function(e,t,n){var r=this,i=e-this.boundingRect.x,a=t-this.boundingRect.y,o=P.sceneManager().getActiveCamera(),s=P.renderer().getRenderEngine().getForwardRayFromScreenCoords(o,i,a,1/0),u=P.renderer().getRenderEngine().raycast(s);if(u.length>0){var c=u.find((function(e){var t=e.entity;return t&&t.visible&&!r.panningRaycastPlanes.find((function(e){return e.getSceneObjectId()===t.getSceneObjectId()}))&&!(r.rotationRaycastPlane&&r.rotationRaycastPlane.getSceneObjectId()===t.getSceneObjectId())&&!r.arrowAxisXMesh.find((function(e){return e.getSceneObjectId()===t.getSceneObjectId()}))&&!r.arrowAxisYMesh.find((function(e){return e.getSceneObjectId()===t.getSceneObjectId()}))&&!r.arrowAxisZMesh.find((function(e){return e.getSceneObjectId()===t.getSceneObjectId()}))&&!(r.rotationRingMesh&&r.rotationRingMesh.getSceneObjectId()===t.getSceneObjectId())&&!(r.rotationLine&&r.rotationLine.getSceneObjectId()===t.getSceneObjectId())&&!(r.protractorMesh&&r.protractorMesh.getSceneObjectId()===t.getSceneObjectId())}));if(c&&c.entity instanceof im){var l=c.entity.findParentOfType(Pc.TypeRTTI),h=c.entity.findParentOfType(Lf.TypeRTTI);if(l&&l.getSceneObjectId()===n.getSceneObjectId())return c;if(h&&h.getSceneObjectId()===n.getSceneObjectId())return c}}}},{key:"hasObject",value:function(e){return e?this.object&&this.object.getSceneObjectId()===e.getSceneObjectId():!!this.object}},{key:"snapToDegrees",value:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=2*Math.PI,a=void 0!==n?n:Math.PI/48,o=void 0!==t?t:Math.PI/12,s=Math.floor(i/o),u=a,c=0;c<s;c++){var l=o*c;if(Math.abs(e+r-l)<u||e+r+u>=i){e=l;break}}return e}},{key:"setToClosestBy",value:function(e,t){for(var n=o(t,1)[0],r=0;r<t.length;r++)Math.abs(e-t[r])<Math.abs(e-n)&&(n=t[r]);return n}},{key:"worldToScreen",value:function(e,t,n){var r=new Bi(e,t,n),i=P.sceneManager().getActiveCamera();return r.project(i.transform.matrixWorld.clone().invert(),i.getProjectionMatrix()),new D(Math.round((r.x+1)*this.boundingRect.z/2),Math.round(-(r.y-1)*this.boundingRect.w/2))}},{key:"getRotationOffset",value:function(e,t){return t>=270&&e<=90?e-(t-360):e>=270&&t<=90?e-360-t:e-t}},{key:"onBeforeMouseDown",value:function(e){try{var t=this.domElement.getBoundingClientRect();this.boundingRect.set(t.left,t.top,t.width,t.height)}catch(e){qe.qL.error("onBeforeMouseDown:",e)}var n=e.changedTouches?e.changedTouches[0]:e;this.onMouseDown(n.clientX,n.clientY)}},{key:"onBeforeMouseUp",value:function(e){try{var t=this.domElement.getBoundingClientRect();this.boundingRect.set(t.left,t.top,t.width,t.height)}catch(e){qe.qL.error("onBeforeMouseUp:",e)}var n=e.changedTouches?e.changedTouches[0]:e;this.onMouseUp(n.clientX,n.clientY)}},{key:"onBeforeMouseMove",value:function(e){try{var t=this.domElement.getBoundingClientRect();this.boundingRect.set(t.left,t.top,t.width,t.height)}catch(e){qe.qL.error("onBeforeMouseMove:",e)}var n=e.changedTouches?e.changedTouches[0]:e;this.onMouseMove(n.clientX,n.clientY)}},{key:"loadTexture",value:(n=t(r().mark((function e(t,n){var i,a,o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=tc.getManager(Qu.TextureManager),e.next=3,this.mImageLoader.loadAsync(t);case 3:return a=e.sent,(o=P.renderer().getRenderEngine().createTexture2D(void 0!==n?n:"transform-controls-texture",void 0,!0,ws.UV,Ss.Repeat,Ss.Repeat,Zs.Linear,Zs.Linear,Zs.Linear,!0,xs.RGBA,_s.UnsignedByte,1,Ts.Linear)).updateSource(a),n&&o.setName(n),s=i.makeResourceRaw(o),e.next=10,i.resolveResource(s);case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})}]),m}(op);function mm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(pm,"TypeRTTI",new k.r("ViewportControllerTransformControls",op.TypeRTTI)),function(e){e[e.RayPickedSceneObject=0]="RayPickedSceneObject",e[e.RayHoverSceneObject=1]="RayHoverSceneObject",e[e.MaxTypeValue=2]="MaxTypeValue"}(fm||(fm={}));var dm=function(e){(0,g.Z)(n,e);var t=mm(n);function n(){var e;return(0,u.Z)(this,n),e=t.call(this,"selector"),(0,l.Z)((0,_.Z)(e),"mOnDownPosition",void 0),(0,l.Z)((0,_.Z)(e),"mOnUpPosition",void 0),(0,l.Z)((0,_.Z)(e),"mOnDoublePosition",void 0),(0,l.Z)((0,_.Z)(e),"mHoverEnabled",!1),(0,l.Z)((0,_.Z)(e),"mHoverThrottle",void 0),(0,l.Z)((0,_.Z)(e),"mHoverThrottleTime",300),(0,l.Z)((0,_.Z)(e),"mDragging",!1),e.mOnDownPosition=new D,e.mOnUpPosition=new D,e.mOnDoublePosition=new D,e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"OnAttached",value:function(){var e=this;this.registerMessageHandler(Y.TypeRTTI,(function(t){switch(t.name){case"down":e.handleViewMouseDown(t.event);break;case"up":e.handleViewMouseUp(t.event);break;case"move":e.handleViewMouseMove(t.event);break;case"leave":e.handleViewMouseLeave(t.event);break;case"dbclick":e.handleDoubleClick(t.event)}})),this.registerMessageHandler(F.TypeRTTI,(function(t){"start"===t.name?e.mDragging=!0:"end"!==t.name&&"drop"!==t.name||(e.mDragging=!1)}))}},{key:"OnDetached",value:function(){this.unregisterMessageHandler(Y.TypeRTTI)}},{key:"enableHover",value:function(e){this.mHoverEnabled=e}},{key:"setHoverThrothleTime",value:function(e){this.mHoverThrottleTime=e}},{key:"clearDocumentSelections",value:function(){document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()}},{key:"getMousePosition",value:function(e,t){var n=this.getViewportRenderer().getViewContainer();if(n){var r=n.getBoundingClientRect();return[e-r.left,t-r.top]}return[0,0]}},{key:"handleViewMouseMove",value:function(e){var t=this;this.mHoverEnabled&&!this.mDragging&&void 0===this.mHoverThrottle&&(this.mHoverThrottle=window.setTimeout((function(){delete t.mHoverThrottle;var n=window.TouchEvent&&e instanceof TouchEvent?e.changedTouches[0].clientX:e.clientX,r=window.TouchEvent&&e instanceof TouchEvent?e.changedTouches[0].clientY:e.clientY,i=t.getIntersects((new D).fromArray(t.getMousePosition(n,r)));i.length>0&&P.interceptorManager().intercept(fm.RayHoverSceneObject,i[0]).then((function(e){}),(function(e){}))}),this.mHoverThrottleTime))}},{key:"handleViewMouseLeave",value:function(e){}},{key:"handleViewMouseDown",value:function(e){this.clearDocumentSelections();var t=window.TouchEvent&&e instanceof TouchEvent?e.changedTouches[0].clientX:e.clientX,n=window.TouchEvent&&e instanceof TouchEvent?e.changedTouches[0].clientY:e.clientY;this.mOnDownPosition.fromArray([t,n])}},{key:"handleViewMouseUp",value:function(e){var t=window.TouchEvent&&e instanceof TouchEvent?e.changedTouches[0].clientX:e.clientX,n=window.TouchEvent&&e instanceof TouchEvent?e.changedTouches[0].clientY:e.clientY;this.mOnUpPosition.fromArray([t,n]),this.handleClick(!0===e.ctrlKey)}},{key:"handleDoubleClick",value:function(e){var t=window.TouchEvent&&e instanceof TouchEvent?e.changedTouches[0].clientX:e.clientX,n=window.TouchEvent&&e instanceof TouchEvent?e.changedTouches[0].clientY:e.clientY;this.mOnDoublePosition.fromArray(this.getMousePosition(t,n));var r=this.getIntersects(this.mOnDoublePosition);if(r.length>0){var i=r[0];P.eventBus().dispatch(new Di(Ei.ObjectFocused,i.entity))}}},{key:"handleClick",value:function(e){if(this.mOnDownPosition.distanceTo(this.mOnUpPosition)<.01){var t=this.getIntersects((new D).fromArray(this.getMousePosition(this.mOnUpPosition.x,this.mOnUpPosition.y)));qe.qL.print("clicked, intersects:",t),t.length>0?P.interceptorManager().intercept(fm.RayPickedSceneObject,t[0],e).then((function(t){qe.qL.print("clicked item after interceptors:",t),P.eventBus().dispatch(new Di(Ei.ObjectSelected,{selection:t.entity,options:{control:e}}))}),(function(e){qe.qL.print("clicked item discarded")})):P.eventBus().dispatch(new Di(Ei.ObjectSelected,{selection:void 0,options:{control:e}}))}}},{key:"getIntersects",value:function(e){var t=P.sceneManager().getActiveCamera(),n=P.renderer().getRenderEngine().getForwardRayFromScreenCoords(t,e.x,e.y);return P.renderer().getRenderEngine().raycast(n).filter((function(e){return!!e.entity}))}}]),n}(op);function vm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(dm,"TypeRTTI",new k.r("ViewportControllerEditorSelector",op.TypeRTTI));var ym=function(e){(0,g.Z)(n,e);var t=vm(n);function n(){var e;return(0,u.Z)(this,n),e=t.call(this,"viewport-camera-controls"),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mEventBrokerSubcriptions",[]),(0,l.Z)((0,_.Z)(e),"mControlChanged",void 0),(0,l.Z)((0,_.Z)(e),"mTransformLocked",!1),e.mControlChanged=new Ht,e}return(0,c.Z)(n,[{key:"OnAttached",value:function(){var e=this;this.mEventBrokerSubcriptions.push(P.eventBus().subscribe(Di.getTopicName(Ei.TransformControlChanged),(function(){return e.mControlChanged.next()})),P.eventBus().subscribe(Di.getTopicName(Ei.TransformControlLock),(function(){e.mTransformLocked=!0,P.sceneManager().getScene().dispatchMessage(new Le(e.mTransformLocked,!1))})),P.eventBus().subscribe(Di.getTopicName(Ei.TransformControlUnLock),(function(){e.mTransformLocked=!1,P.sceneManager().getScene().dispatchMessage(new Le(e.mTransformLocked,!1))})),P.eventBus().subscribe(aa.getTopicName(),(function(){P.eventBus().dispatch(new Di(Ei.ZoomChanged)),P.eventBus().dispatch(new Di(Ei.RequestFrame))})),P.eventBus().subscribe(ta.getTopicName(),(function(){P.eventBus().dispatch(new Di(Ei.RequestFrame))}))),this.mSubscriptions.push(this.mControlChanged.pipe(Kt((function(){P.sceneManager().getScene().dispatchMessage(new Le(e.mTransformLocked,!0))})),an(300)).subscribe((function(){P.sceneManager().getScene().dispatchMessage(new Le(e.mTransformLocked,!0))})))}},{key:"OnDetached",value:function(){this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mEventBrokerSubcriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}}]),n}(op);class gm{constructor(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashStr(e,t=!1){return this.onePassHasher.start().appendStr(e).end(t)}static hashAsciiStr(e,t=!1){return this.onePassHasher.start().appendAsciiStr(e).end(t)}static _hex(e){const t=gm.hexChars,n=gm.hexOut;let r,i,a,o;for(o=0;o<4;o+=1)for(i=8*o,r=e[o],a=0;a<8;a+=2)n[i+1+a]=t.charAt(15&r),r>>>=4,n[i+0+a]=t.charAt(15&r),r>>>=4;return n.join("")}static _md5cycle(e,t){let n=e[0],r=e[1],i=e[2],a=e[3];n+=(r&i|~r&a)+t[0]-680876936|0,n=(n<<7|n>>>25)+r|0,a+=(n&r|~n&i)+t[1]-389564586|0,a=(a<<12|a>>>20)+n|0,i+=(a&n|~a&r)+t[2]+606105819|0,i=(i<<17|i>>>15)+a|0,r+=(i&a|~i&n)+t[3]-1044525330|0,r=(r<<22|r>>>10)+i|0,n+=(r&i|~r&a)+t[4]-176418897|0,n=(n<<7|n>>>25)+r|0,a+=(n&r|~n&i)+t[5]+1200080426|0,a=(a<<12|a>>>20)+n|0,i+=(a&n|~a&r)+t[6]-1473231341|0,i=(i<<17|i>>>15)+a|0,r+=(i&a|~i&n)+t[7]-45705983|0,r=(r<<22|r>>>10)+i|0,n+=(r&i|~r&a)+t[8]+1770035416|0,n=(n<<7|n>>>25)+r|0,a+=(n&r|~n&i)+t[9]-1958414417|0,a=(a<<12|a>>>20)+n|0,i+=(a&n|~a&r)+t[10]-42063|0,i=(i<<17|i>>>15)+a|0,r+=(i&a|~i&n)+t[11]-1990404162|0,r=(r<<22|r>>>10)+i|0,n+=(r&i|~r&a)+t[12]+1804603682|0,n=(n<<7|n>>>25)+r|0,a+=(n&r|~n&i)+t[13]-40341101|0,a=(a<<12|a>>>20)+n|0,i+=(a&n|~a&r)+t[14]-1502002290|0,i=(i<<17|i>>>15)+a|0,r+=(i&a|~i&n)+t[15]+1236535329|0,r=(r<<22|r>>>10)+i|0,n+=(r&a|i&~a)+t[1]-165796510|0,n=(n<<5|n>>>27)+r|0,a+=(n&i|r&~i)+t[6]-1069501632|0,a=(a<<9|a>>>23)+n|0,i+=(a&r|n&~r)+t[11]+643717713|0,i=(i<<14|i>>>18)+a|0,r+=(i&n|a&~n)+t[0]-373897302|0,r=(r<<20|r>>>12)+i|0,n+=(r&a|i&~a)+t[5]-701558691|0,n=(n<<5|n>>>27)+r|0,a+=(n&i|r&~i)+t[10]+38016083|0,a=(a<<9|a>>>23)+n|0,i+=(a&r|n&~r)+t[15]-660478335|0,i=(i<<14|i>>>18)+a|0,r+=(i&n|a&~n)+t[4]-405537848|0,r=(r<<20|r>>>12)+i|0,n+=(r&a|i&~a)+t[9]+568446438|0,n=(n<<5|n>>>27)+r|0,a+=(n&i|r&~i)+t[14]-1019803690|0,a=(a<<9|a>>>23)+n|0,i+=(a&r|n&~r)+t[3]-187363961|0,i=(i<<14|i>>>18)+a|0,r+=(i&n|a&~n)+t[8]+1163531501|0,r=(r<<20|r>>>12)+i|0,n+=(r&a|i&~a)+t[13]-1444681467|0,n=(n<<5|n>>>27)+r|0,a+=(n&i|r&~i)+t[2]-51403784|0,a=(a<<9|a>>>23)+n|0,i+=(a&r|n&~r)+t[7]+1735328473|0,i=(i<<14|i>>>18)+a|0,r+=(i&n|a&~n)+t[12]-1926607734|0,r=(r<<20|r>>>12)+i|0,n+=(r^i^a)+t[5]-378558|0,n=(n<<4|n>>>28)+r|0,a+=(n^r^i)+t[8]-2022574463|0,a=(a<<11|a>>>21)+n|0,i+=(a^n^r)+t[11]+1839030562|0,i=(i<<16|i>>>16)+a|0,r+=(i^a^n)+t[14]-35309556|0,r=(r<<23|r>>>9)+i|0,n+=(r^i^a)+t[1]-1530992060|0,n=(n<<4|n>>>28)+r|0,a+=(n^r^i)+t[4]+1272893353|0,a=(a<<11|a>>>21)+n|0,i+=(a^n^r)+t[7]-155497632|0,i=(i<<16|i>>>16)+a|0,r+=(i^a^n)+t[10]-1094730640|0,r=(r<<23|r>>>9)+i|0,n+=(r^i^a)+t[13]+681279174|0,n=(n<<4|n>>>28)+r|0,a+=(n^r^i)+t[0]-358537222|0,a=(a<<11|a>>>21)+n|0,i+=(a^n^r)+t[3]-722521979|0,i=(i<<16|i>>>16)+a|0,r+=(i^a^n)+t[6]+76029189|0,r=(r<<23|r>>>9)+i|0,n+=(r^i^a)+t[9]-640364487|0,n=(n<<4|n>>>28)+r|0,a+=(n^r^i)+t[12]-421815835|0,a=(a<<11|a>>>21)+n|0,i+=(a^n^r)+t[15]+530742520|0,i=(i<<16|i>>>16)+a|0,r+=(i^a^n)+t[2]-995338651|0,r=(r<<23|r>>>9)+i|0,n+=(i^(r|~a))+t[0]-198630844|0,n=(n<<6|n>>>26)+r|0,a+=(r^(n|~i))+t[7]+1126891415|0,a=(a<<10|a>>>22)+n|0,i+=(n^(a|~r))+t[14]-1416354905|0,i=(i<<15|i>>>17)+a|0,r+=(a^(i|~n))+t[5]-57434055|0,r=(r<<21|r>>>11)+i|0,n+=(i^(r|~a))+t[12]+1700485571|0,n=(n<<6|n>>>26)+r|0,a+=(r^(n|~i))+t[3]-1894986606|0,a=(a<<10|a>>>22)+n|0,i+=(n^(a|~r))+t[10]-1051523|0,i=(i<<15|i>>>17)+a|0,r+=(a^(i|~n))+t[1]-2054922799|0,r=(r<<21|r>>>11)+i|0,n+=(i^(r|~a))+t[8]+1873313359|0,n=(n<<6|n>>>26)+r|0,a+=(r^(n|~i))+t[15]-30611744|0,a=(a<<10|a>>>22)+n|0,i+=(n^(a|~r))+t[6]-1560198380|0,i=(i<<15|i>>>17)+a|0,r+=(a^(i|~n))+t[13]+1309151649|0,r=(r<<21|r>>>11)+i|0,n+=(i^(r|~a))+t[4]-145523070|0,n=(n<<6|n>>>26)+r|0,a+=(r^(n|~i))+t[11]-1120210379|0,a=(a<<10|a>>>22)+n|0,i+=(n^(a|~r))+t[2]+718787259|0,i=(i<<15|i>>>17)+a|0,r+=(a^(i|~n))+t[9]-343485551|0,r=(r<<21|r>>>11)+i|0,e[0]=n+e[0]|0,e[1]=r+e[1]|0,e[2]=i+e[2]|0,e[3]=a+e[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(gm.stateIdentity),this}appendStr(e){const t=this._buffer8,n=this._buffer32;let r,i,a=this._bufferLength;for(i=0;i<e.length;i+=1){if(r=e.charCodeAt(i),r<128)t[a++]=r;else if(r<2048)t[a++]=192+(r>>>6),t[a++]=63&r|128;else if(r<55296||r>56319)t[a++]=224+(r>>>12),t[a++]=r>>>6&63|128,t[a++]=63&r|128;else{if(r=1024*(r-55296)+(e.charCodeAt(++i)-56320)+65536,r>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");t[a++]=240+(r>>>18),t[a++]=r>>>12&63|128,t[a++]=r>>>6&63|128,t[a++]=63&r|128}a>=64&&(this._dataLength+=64,gm._md5cycle(this._state,n),a-=64,n[0]=n[16])}return this._bufferLength=a,this}appendAsciiStr(e){const t=this._buffer8,n=this._buffer32;let r,i=this._bufferLength,a=0;for(;;){for(r=Math.min(e.length-a,64-i);r--;)t[i++]=e.charCodeAt(a++);if(i<64)break;this._dataLength+=64,gm._md5cycle(this._state,n),i=0}return this._bufferLength=i,this}appendByteArray(e){const t=this._buffer8,n=this._buffer32;let r,i=this._bufferLength,a=0;for(;;){for(r=Math.min(e.length-a,64-i);r--;)t[i++]=e[a++];if(i<64)break;this._dataLength+=64,gm._md5cycle(this._state,n),i=0}return this._bufferLength=i,this}getState(){const e=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[e[0],e[1],e[2],e[3]]}}setState(e){const t=e.buffer,n=e.state,r=this._state;let i;for(this._dataLength=e.length,this._bufferLength=e.buflen,r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],i=0;i<t.length;i+=1)this._buffer8[i]=t.charCodeAt(i)}end(e=!1){const t=this._bufferLength,n=this._buffer8,r=this._buffer32,i=1+(t>>2);this._dataLength+=t;const a=8*this._dataLength;if(n[t]=128,n[t+1]=n[t+2]=n[t+3]=0,r.set(gm.buffer32Identity.subarray(i),i),t>55&&(gm._md5cycle(this._state,r),r.set(gm.buffer32Identity)),a<=4294967295)r[14]=a;else{const e=a.toString(16).match(/(.*?)(.{0,8})$/);if(null===e)return;const t=parseInt(e[2],16),n=parseInt(e[1],16)||0;r[14]=t,r[15]=n}return gm._md5cycle(this._state,r),e?this._state:gm._hex(this._state)}}if(gm.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),gm.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),gm.hexChars="0123456789abcdef",gm.hexOut=[],gm.onePassHasher=new gm,"5d41402abc4b2a76b9719d911017c592"!==gm.hashStr("hello"))throw new Error("Md5 self test failed.");function bm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Mm=function(e){(0,g.Z)(p,e);var n,i,a,o,s,h,f=bm(p);function p(){var e;return(0,u.Z)(this,p),e=f.call(this,"productSceneLoaderComponent"),(0,l.Z)((0,_.Z)(e),"_dependenciesReplay$$",void 0),(0,l.Z)((0,_.Z)(e),"_attributeUpdate$$",void 0),(0,l.Z)((0,_.Z)(e),"_destroy$$",void 0),(0,l.Z)((0,_.Z)(e),"_loadingFailed$$",void 0),(0,l.Z)((0,_.Z)(e),"_queryFromServer",!1),(0,l.Z)((0,_.Z)(e),"_queryInProgress",!1),(0,l.Z)((0,_.Z)(e),"_loaderBusy",!1),(0,l.Z)((0,_.Z)(e),"_loaderIdle$$",void 0),(0,l.Z)((0,_.Z)(e),"mAttributeManager",void 0),(0,l.Z)((0,_.Z)(e),"mCatalogueSettings",void 0),(0,l.Z)((0,_.Z)(e),"mFirstBuild",!0),(0,l.Z)((0,_.Z)(e),"mBrokerSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mClientCache",{}),e}return(0,c.Z)(p,[{key:"getType",value:function(){return p.TypeRTTI}},{key:"OnAttached",value:function(){var e=this;this._attributeUpdate$$=new Ht,this._destroy$$=new Ht,this._loaderIdle$$=new ni(1),this.markLoaderBusy(),this.registerMessageHandler(Te.TypeRTTI,this.onSceneUpdate.bind(this)),this.mBrokerSubscriptions.push(P.eventBus().subscribe(Di.getTopicName(Ei.DrawingTechniqueFailed),(function(){var t;e._queryFromServer=!0,null===(t=e._loadingFailed$$)||void 0===t||t.next()})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductOptionChanged),(function(){return e._attributeUpdate$$.next()})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductAttributeUpdated),(function(){return e._attributeUpdate$$.next()})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductQuestionChanged),(function(){return e._attributeUpdate$$.next()}))),this.observeAttributeUpdates()}},{key:"OnDetached",value:function(){var e;this.unregisterFromAllMessages(),this.mBrokerSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this._destroy$$.next(),this._destroy$$.complete(),this.markLoaderIdle(),this._loaderIdle$$.complete(),null===(e=this._loadingFailed$$)||void 0===e||e.complete()}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(Pc.TypeRTTI)}},{key:"markLoaderBusy",value:function(){this._loaderBusy=!0,this._loaderIdle$$.next(!this._loaderBusy)}},{key:"markLoaderIdle",value:function(){this._loaderBusy=!1,this._loaderIdle$$.next(!this._loaderBusy)}},{key:"loaderIdle",value:function(){return this._loaderIdle$$.pipe(Ho())}},{key:"createMeshFailObserver",value:function(){this._loadingFailed$$&&this._loadingFailed$$.complete(),this._loadingFailed$$=new Ht}},{key:"observeAttributeUpdates",value:function(){var e=this;this._attributeUpdate$$.pipe(Kt((function(){return e.markLoaderBusy()})),Cc(this.resolveDependencies.bind(this)),an(50),Bo(this.buildQuery.bind(this)),Bp((function(t,n){var r=t.clientHash===n.clientHash;return r&&!e._queryInProgress&&e.markLoaderIdle(),r})),Kt((function(){e.createMeshFailObserver(),e._queryFromServer=!1,e._queryInProgress=!0})),Xl((function(t){return Io(t).pipe(Ic((function(){return Co(e.queryScene(t,e._queryFromServer))})),Xl((function(t){return Co(e.updateArticles(t))})),Kt((function(t){return e.updateHierarchy(t)})),Rc({count:2,delay:function(){return e._loadingFailed$$}}))})),Lp(this._destroy$$)).subscribe({next:function(){e._queryInProgress=!1,e.markLoaderIdle()},error:function(t){e._queryInProgress=!1,e.markLoaderIdle(),qe.qL.error(t),e.broadcastBuildEvent(!0)},complete:function(){e._queryInProgress=!1}})}},{key:"resolveFromCache",value:(h=t(r().mark((function e(t,n){var i,a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.getParentObject(),!(a=i.getComponent("propertyValue"))||!0!==a.getValue("disable_bootstrap")){e.next=5;break}throw qe.qL.print("API Batch Query Cache is disabled"),new Error("API Cache is disabled");case 5:return e.next=7,ei.uniqueInstance().get("configuration_cache/".concat(t,"/configuration_").concat(n,".json"),{baseURL:Jr.E.spacesUrl});case 7:return o=e.sent,e.abrupt("return",o.data);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"resolveFromServer",value:(s=t(r().mark((function e(t,n,i,a){var o,s,u,c,l;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.getParentObject(),s=o.getComponent("propertyValue"),u=new URLSearchParams,s&&!0===s.getValue("disable_bootstrap")&&(qe.qL.print("API Batch Query Cache is disabled. Using active db."),u.append("useActiveDB","true")),c=Array.from(u.keys()).length>0?"?".concat(u.toString()):"",e.next=7,ei.getInstance().post("scene_object/batch/".concat(t).concat(c),{id:t,attributes:n,nodes:!0,hash:i,compression:a});case 7:return l=e.sent,e.abrupt("return",l.data);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return s.apply(this,arguments)})},{key:"buildQuery",value:function(){var e=this.getParentObject().productId,t=this.mAttributeManager.buildQueryParams(!1,!1),n=this.mAttributeManager.buildQueryParams(!1,!0),r=this.mCatalogueSettings.getSceneDeviceSettings(Ti()?ti.Mobile:ti.Desktop),i=parseInt(r.compression,10),a="";Object.keys(t).forEach((function(e){a+="".concat(e,":").concat(t[e],"/")}));var o="".concat(e,"/").concat(this.mCatalogueSettings.getGraphRevId(),"/").concat(this.mCatalogueSettings.getSceneRevId(),"/").concat(i,"/").concat(a),s=gm.hashStr(o).toString(),u="";return Object.keys(n).forEach((function(e){u+="".concat(e,":").concat(n[e],"/")})),{id:e,serverHash:s,clientHash:gm.hashStr(u).toString(),query:t,compression:i}}},{key:"queryScene",value:(o=t(r().mark((function e(t){var n,i=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]&&i[1],qe.qL.print("request configuration with new hash path:",t.serverHash,t.query),n||!(t.serverHash in this.mClientCache)){e.next=4;break}return e.abrupt("return",this.mClientCache[t.serverHash]);case 4:return this.mClientCache={},e.next=7,this.resolveBatchQuery(t,n);case 7:return this.mClientCache[t.serverHash]=e.sent,e.abrupt("return",this.mClientCache[t.serverHash]);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"resolveBatchQuery",value:(a=t(r().mark((function e(t){var n=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.length>1&&void 0!==n[1]&&n[1]){e.next=10;break}return e.prev=2,e.next=5,this.resolveFromCache(t.id,t.serverHash);case 5:return e.abrupt("return",e.sent);case 8:e.prev=8,e.t0=e.catch(2);case 10:return e.abrupt("return",this.resolveFromServer(t.id,t.query,t.serverHash,t.compression));case 11:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(e){return a.apply(this,arguments)})},{key:"updateArticles",value:(i=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getParentObject(),e.next=3,n._updateArticles(t);case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"updateHierarchy",value:function(e){this.getParentObject()._updateHierarchy(e)}},{key:"loadDependencies",value:(n=t(r().mark((function e(){var t,n,i,a,o,s,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getParentObject(),n=t.productId,i=t.getComponent("processManager"),a=t.getComponent("attributeManager"),o=t.getComponent("catalogueSettings"),s=t.getComponent("catalogueMeta"),e.next=8,Promise.all([i.resolveManager(),a.resolveAttributeManager().toPromise(),o.resolveSettings().toPromise(),s.loadCatalogueMeta(),Xo.getInstance().preloadCatalogue(n),$s.getInstance().preloadCatalogue(n),Jl.getInstance().preloadCatalogue(n)]);case 8:u=e.sent,this.mAttributeManager=u[1],this.mCatalogueSettings=u[2];case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"resolveDependencies",value:function(){var e=this;return this._dependenciesReplay$$||(this._dependenciesReplay$$=new ni(1),this.loadDependencies().then((function(){e._dependenciesReplay$$.next(),e._dependenciesReplay$$.complete()}),(function(t){e._dependenciesReplay$$.error(t)}))),this._dependenciesReplay$$}},{key:"onSceneUpdate",value:function(e){this.broadcastFirstBuild(),this.setProcessStatus(e)}},{key:"setProcessStatus",value:function(e){e.setProcessStatus(p.TypeRTTI.getTypeName(),this._loaderBusy?ke.InProgress:ke.Idle)}},{key:"broadcastFirstBuild",value:function(){this.mFirstBuild&&(this.mFirstBuild=!1,this.broadcastBuildEvent(),this._attributeUpdate$$.next())}},{key:"broadcastBuildEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getParentObject();if(t){var n=e?Ei.ProductErrorLoading:Ei.ProductStartLoading;P.eventBus().dispatch(new Di(n,{catalogue_id:t.productId,scene_object_id:t.getSceneObjectId(),object_uuid:t.getObjectUUID()}))}}}]),p}(Xi.H);function km(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Mm,"TypeRTTI",new k.r("ProductSceneLoaderComponent",Xi.H.TypeRTTI));var _m=function(e){(0,g.Z)(n,e);var t=km(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mEventBrokerSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mRendererBuildBusy",!0),(0,l.Z)((0,_.Z)(e),"mBuildFullyLoaded",!1),(0,l.Z)((0,_.Z)(e),"mBuildReady",!1),(0,l.Z)((0,_.Z)(e),"mInitialBuildFinished",!1),(0,l.Z)((0,_.Z)(e),"mTransparentLoadingScreen",!1),(0,l.Z)((0,_.Z)(e),"mLoadDisplayDelay",void 0),(0,l.Z)((0,_.Z)(e),"mProductsLoading",new Map),(0,l.Z)((0,_.Z)(e),"mGlobalStyleElement",void 0),(0,l.Z)((0,_.Z)(e),"mBlockLoadingScreen",!1),(0,l.Z)((0,_.Z)(e),"mProducts",[]),e}return(0,c.Z)(n,[{key:"createContainer",value:function(){var e=He.createElement("div");He.setAttribute(e,"id","xpv__viewer_load_backdrop"),He.setStyle(e,{width:"100%",height:"100%",flex:"1",position:"absolute",zIndex:"4",textAlign:"center",display:"flex",fontSize:"9px",backgroundColor:"rgba(255, 255, 255, 1.0)",alignItems:"center",justifyContent:"center",top:"0",pointerEvents:"none"});var t=He.createElement("div");He.setStyle(t,"width","20%"),He.append(e,t);var n=He.createElement("div");return He.setHtml(n,'<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>'),He.append(t,n),e}},{key:"init",value:function(){var e=this;Ni((0,M.Z)(n.prototype),"init",this).call(this),this.initializeGlobalStyle(),this.mProductsLoading.clear(),this.mEventBrokerSubscriptions.push(P.eventBus().subscribe(Di.getTopicName(Ei.RendererBuildStarted),(function(){e.mRendererBuildBusy=!0,e.checkBuildProcess()})),P.eventBus().subscribe(Di.getTopicName(Ei.RendererBuildFinished),(function(){e.mRendererBuildBusy=!1,e.checkBuildProcess()})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductStartLoading),(function(t){var n=t.getData().scene_object_id;e.mProductsLoading.set(n,!0),e.checkBuildProcess()})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductErrorLoading),(function(t){var n=t.getData().scene_object_id;e.mProductsLoading.set(n,!1),e.checkBuildProcess()})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductFinishedLoading),(function(t){var n=t.getData().scene_object_id;e.mProductsLoading.set(n,!1),e.checkBuildProcess()})),P.eventBus().subscribe(Di.getTopicName(Ei.BuildFailed),(function(){e.mBuildFullyLoaded=!0,e.checkBuildProcess()})),P.eventBus().subscribe(Di.getTopicName(Ei.BuildFullyLoaded),(function(){e.mBuildFullyLoaded=!0,e.checkBuildProcess()})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductOptionChanged),(function(){e.showTransparentLoading(!0)})),P.eventBus().subscribe(Di.getTopicName(Ei.LoadConfigurationStarted),(function(){e.mInitialBuildFinished=!1,e.mBuildReady=!1,e.showTransparentLoading(!0)})),P.messenger().listen(F.TypeRTTI,(function(t){"start"===t.name?e.mBlockLoadingScreen=!0:"leave"===t.name&&(e.mBlockLoadingScreen=!1),e.checkBuildProcess()})),P.eventBus().subscribe(Di.getTopicName(Ei.NodeAdded),(function(t){var n=t.getData();if(n instanceof Pc){var r=n.findParentOfType(Ep.TypeRTTI);r&&r.isViewVisible()&&e.subscribeToProductNode(n)}})),P.eventBus().subscribe(Di.getTopicName(Ei.NodeRemoved),(function(t){var n=t.getData();if(n instanceof Pc){var r=e.mProducts.findIndex((function(e){return e.product.getSceneObjectId()===n.getSceneObjectId()}));-1!==r&&e.mProducts.splice(r,1).forEach((function(e){return e.subscription.unsubscribe()}))}})));var t=P.sceneManager().getRootProductNode();t&&this.subscribeToProductNode(t)}},{key:"subscribeToProductNode",value:function(e){var t=this;if(!(this.mProducts.findIndex((function(t){return t.product.getSceneObjectId()===e.getSceneObjectId()}))>=0)){var n=e.getComponents(Mm.TypeRTTI)[0];n&&this.mProducts.push({product:e,subscription:n.loaderIdle().subscribe((function(n){t.mProductsLoading.set(e.getSceneObjectId(),!n),t.checkBuildProcess()}))})}}},{key:"showTransparentLoading",value:function(e){this.mInitialBuildFinished&&(this.mTransparentLoadingScreen=e,this.updateLoader())}},{key:"checkBuildProcess",value:function(){var e=!Array.from(this.mProductsLoading.values()).some((function(e){return!0===e}));!this.mInitialBuildFinished&&e&&!this.mRendererBuildBusy&&this.mBuildFullyLoaded&&(this.mInitialBuildFinished=!0,this.mTransparentLoadingScreen=!0,this.mBuildReady=!0,this.mProductsLoading.clear(),this.updateLoader()),this.mInitialBuildFinished&&(e&&!this.mRendererBuildBusy?(this.mBuildReady=!0,this.mProductsLoading.clear()):this.mBuildReady=!1,this.updateLoader())}},{key:"updateLoader",value:function(){var e=this;this.mTransparentLoadingScreen||this.mBlockLoadingScreen?"transparent"!==He.getStyle(this.mLayerContainer,"backgroundColor")&&window.setTimeout((function(){He.setStyle(e.mLayerContainer,"backgroundColor","transparent")}),100):He.setStyle(this.mLayerContainer,"backgroundColor","rgba(255, 255, 255, 1.0)");this.mBuildReady||this.mBlockLoadingScreen?(void 0!==this.mLoadDisplayDelay&&(window.clearTimeout(this.mLoadDisplayDelay),delete this.mLoadDisplayDelay),He.setStyle(this.mLayerContainer,"display","none")):"none"===He.getStyle(this.mLayerContainer,"display")&&this.mTransparentLoadingScreen?void 0===this.mLoadDisplayDelay&&(qe.qL.print("show loader with delay"),this.mLoadDisplayDelay=window.setTimeout((function(){delete e.mLoadDisplayDelay,e.showLoader()}),300)):this.showLoader()}},{key:"showLoader",value:function(){He.setStyle(this.mLayerContainer,"display","flex")}},{key:"destroy",value:function(){this.mBuildReady=!1,this.mEventBrokerSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mProducts.splice(0).forEach((function(e){return e.subscription.unsubscribe()})),this.mProducts.splice(0),this.mProductsLoading.clear(),this.mGlobalStyleElement.remove(),delete this.mGlobalStyleElement,Ni((0,M.Z)(n.prototype),"destroy",this).call(this)}},{key:"initializeGlobalStyle",value:function(){this.mGlobalStyleElement=He.createElement("style"),document.getElementsByTagName("head")[0].appendChild(this.mGlobalStyleElement),He.setAttribute(this.mGlobalStyleElement,"type","text/css"),He.setHtml(this.mGlobalStyleElement,".lds-ellipsis {\n              display: inline-block;\n              position: relative;\n              width: 64px;\n              height: 64px;\n            }\n            .lds-ellipsis div {\n              position: absolute;\n              top: 27px;\n              width: 11px;\n              height: 11px;\n              border-radius: 50%;\n              background: #ff6432;\n              animation-timing-function: cubic-bezier(0, 1, 1, 0);\n            }\n            .lds-ellipsis div:nth-child(1) {\n              left: 6px;\n              animation: lds-ellipsis1 0.6s infinite;\n            }\n            .lds-ellipsis div:nth-child(2) {\n              left: 6px;\n              animation: lds-ellipsis2 0.6s infinite;\n            }\n            .lds-ellipsis div:nth-child(3) {\n              left: 26px;\n              animation: lds-ellipsis2 0.6s infinite;\n            }\n            .lds-ellipsis div:nth-child(4) {\n              left: 45px;\n              animation: lds-ellipsis3 0.6s infinite;\n            }\n            @keyframes lds-ellipsis1 {\n              0% {\n                transform: scale(0);\n              }\n              100% {\n                transform: scale(1);\n              }\n            }\n            @keyframes lds-ellipsis3 {\n              0% {\n                transform: scale(1);\n              }\n              100% {\n                transform: scale(0);\n              }\n            }\n            @keyframes lds-ellipsis2 {\n              0% {\n                transform: translate(0, 0);\n              }\n              100% {\n                transform: translate(19px, 0);\n              }\n            }")}}]),n}(Jf);function xm(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Tm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Tm(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Tm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var wm=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mParentContainer",void 0),(0,l.Z)(this,"mLayers",[]),this.mParentContainer=t}return(0,c.Z)(e,[{key:"pushLayer",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++){var a=i[r];this.mLayers.push(a),a.setParentContainer(this.mParentContainer),a.isLayerInitialized()&&!a.isLayerAttached()&&a.attach()}this.sortLayers()}},{key:"removeLayer",value:function(e){var t=this.mLayers.indexOf(e);if(t>=0){var n=o(this.mLayers.splice(t,1),1)[0];n.isLayerAttached()&&n.detach(),n.setParentContainer(void 0)}}},{key:"initLayers",value:function(){var e,t=xm(this.mLayers);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isLayerInitialized()||n.init(),n.isLayerAttached()||n.attach()}}catch(e){t.e(e)}finally{t.f()}}},{key:"destroyLayers",value:function(){var e,t=xm(this.mLayers.splice(0));try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isLayerInitialized()&&n.destroy()}}catch(e){t.e(e)}finally{t.f()}}},{key:"sortLayers",value:function(){if(!this.isLayersSorted()){var e,t=xm(this.mLayers);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isLayerAttached()&&this.mParentContainer.removeChild(n.getLayerContainer())}}catch(e){t.e(e)}finally{t.f()}this.mLayers.sort((function(e,t){return t.getLayerIndex()-e.getLayerIndex()}));var r,i=xm(this.mLayers);try{for(i.s();!(r=i.n()).done;){var a=r.value;a.isLayerAttached()&&this.mParentContainer.appendChild(a.getLayerContainer())}}catch(e){i.e(e)}finally{i.f()}}}},{key:"isLayersSorted",value:function(){for(var e=!0,t=0;t<this.mLayers.length-1;t++)if(this.mLayers[t].getLayerIndex()>this.mLayers[t+1].getLayerIndex()){e=!1;break}return e}}]),e}();function Rm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Zm=function(e){(0,g.Z)(n,e);var t=Rm(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"mContainer",void 0),i.mContainer=r.container,i}return(0,c.Z)(n,[{key:"createContainer",value:function(){return this.mContainer}}]),n}(Jf);function Sm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Cm=function(e){(0,g.Z)(n,e);var t=Sm(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"mHandleViewMouseDownContext",void 0),(0,l.Z)((0,_.Z)(i),"mGlobalStyleElement",void 0),i.mHandleViewMouseDownContext=i.handleViewMouseDown.bind((0,_.Z)(i)),i}return(0,c.Z)(n,[{key:"createContainer",value:function(){if(this.mViewLayerOptions.show360Indicator){this.initializeGlobalStyle();var e=He.createElement("div");return He.setStyle(e,"display","flex"),this.mViewLayerOptions.viewerCanvas.addEventListener("mousedown",this.mHandleViewMouseDownContext,!1),this.mViewLayerOptions.viewerCanvas.addEventListener("touchstart",this.mHandleViewMouseDownContext,!1),He.setAttribute(e,"class","interact-icon-360-container"),He.setHtml(e,'<div class="animation-wrapper">\n              <img class="icon-360"\n                alt=""\n                src="'.concat(Jr.E.assetsUrl,'system/icons/360-arrow.png" />\n              <img class="hand-360 wobble-hor-bottom"\n                alt=""\n                src="').concat(Jr.E.assetsUrl,'system/icons/hand-pointer-icon.png" />\n            </div>')),e}}},{key:"handleViewMouseDown",value:function(){this.destroyContainer()}},{key:"destroyContainer",value:function(){this.mViewLayerOptions.viewerCanvas.removeEventListener("mousedown",this.mHandleViewMouseDownContext,!1),this.mViewLayerOptions.viewerCanvas.removeEventListener("touchstart",this.mHandleViewMouseDownContext,!1),this.mGlobalStyleElement&&(this.mGlobalStyleElement.remove(),delete this.mGlobalStyleElement),Ni((0,M.Z)(n.prototype),"destroyContainer",this).call(this)}},{key:"initializeGlobalStyle",value:function(){this.mGlobalStyleElement=He.createElement("style"),document.getElementsByTagName("head")[0].appendChild(this.mGlobalStyleElement),He.setAttribute(this.mGlobalStyleElement,"type","text/css"),He.setHtml(this.mGlobalStyleElement,".interact-icon-360-container {\n                position: absolute;\n                width: 100px;\n                height: 58px;\n                background: rgba(38, 36, 36, 0.73);\n                display: none;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                box-shadow: 1px 4px 4px 0px #5050505c;\n                color: white;\n                border-radius: 50px !important;\n                overflow: hidden;\n                padding: 0.5rem;\n                opacity: 0.9;\n                pointer-events: none;\n                justify-self: center;\n                align-self: center;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n            }\n\n            .interact-icon-360-container .animation-wrapper {\n              width: 100%;\n              height: 100%;\n              position: relative;\n              display: flex;\n              justify-content: center;\n            }\n\n            .interact-icon-360-container .animation-wrapper img {\n              position: absolute !important;\n              top: 20px !important;\n            }\n\n            .interact-icon-360-container .animation-wrapper .hand-360 {\n                width: auto !important;\n                max-width: auto !important;\n                height: 38px !important;\n                z-index: 2  !important;\n                opacity: 0.95  !important;\n                background-color: transparent !important;\n                border-radius: 0 !important;\n                margin: 0 !important;\n                color: white !important;\n                padding: 0 !important;\n            }\n\n            .interact-icon-360-container .animation-wrapper .wobble-hor-bottom {\n                -webkit-animation: xpv-wobble-hor-bottom 2.8s ease-in-out infinite both;\n                        animation: xpv-wobble-hor-bottom 2.8s ease-in-out infinite both;\n            }\n\n            /* ----------------------------------------------\n             * Generated by Animista on 2019-6-17 13:26:58\n             * w: https://animista.net, t: @cssanimista\n             * ---------------------------------------------- */\n\n            /**\n             * ----------------------------------------\n             * animation wobble-hor-bottom\n             * ----------------------------------------\n             */\n            @-webkit-keyframes xpv-wobble-hor-bottom {\n              0%,\n              100% {\n                -webkit-transform: translateX(0%);\n                        transform: translateX(0%);\n                -webkit-transform-origin: 50% 50%;\n                        transform-origin: 50% 50%;\n              }\n              15% {\n                -webkit-transform: translateX(-30px) rotate(-6deg);\n                        transform: translateX(-30px) rotate(-6deg);\n              }\n              30% {\n                -webkit-transform: translateX(15px) rotate(6deg);\n                        transform: translateX(15px) rotate(6deg);\n              }\n              45% {\n                -webkit-transform: translateX(-15px) rotate(-3.6deg);\n                        transform: translateX(-15px) rotate(-3.6deg);\n              }\n              60% {\n                -webkit-transform: translateX(9px) rotate(2.4deg);\n                        transform: translateX(9px) rotate(2.4deg);\n              }\n              75% {\n                -webkit-transform: translateX(-6px) rotate(-1.2deg);\n                        transform: translateX(-6px) rotate(-1.2deg);\n              }\n            }\n            @keyframes xpv-wobble-hor-bottom {\n              0%,\n              100% {\n                -webkit-transform: translateX(0%);\n                        transform: translateX(0%);\n                -webkit-transform-origin: 50% 50%;\n                        transform-origin: 50% 50%;\n              }\n              15% {\n                -webkit-transform: translateX(-30px) rotate(-6deg);\n                        transform: translateX(-30px) rotate(-6deg);\n              }\n              30% {\n                -webkit-transform: translateX(15px) rotate(6deg);\n                        transform: translateX(15px) rotate(6deg);\n              }\n              45% {\n                -webkit-transform: translateX(-15px) rotate(-3.6deg);\n                        transform: translateX(-15px) rotate(-3.6deg);\n              }\n              60% {\n                -webkit-transform: translateX(9px) rotate(2.4deg);\n                        transform: translateX(9px) rotate(2.4deg);\n              }\n              75% {\n                -webkit-transform: translateX(-6px) rotate(-1.2deg);\n                        transform: translateX(-6px) rotate(-1.2deg);\n              }\n            }\n\n            .interact-icon-360-container .animation-wrapper .icon-360 {\n                height: auto !important;\n                width: 60% !important;\n                top: 0 !important;\n                background-color: transparent !important;\n                border-radius: 0 !important;\n                margin: 0 !important;\n                color: white !important;\n                padding: 0 !important;\n            }")}}]),n}(Jf);function Im(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Em=function(e){(0,g.Z)(n,e);var t=Im(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mEventBrokerSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mOverlayImage",void 0),(0,l.Z)((0,_.Z)(e),"mOverlayImageOpacityTimer",void 0),e}return(0,c.Z)(n,[{key:"createContainer",value:function(){var e=He.createElement("div");return He.setStyle(e,{display:"none",position:"absolute",top:"0",left:"0",width:"100%",height:"100%",flex:"1",margin:"0",padding:"0",userSelect:"none",pointerEvents:"none"}),this.mOverlayImage=He.createElement("img"),He.setStyle(this.mOverlayImage,{width:"100%"}),e}},{key:"init",value:function(){var e=this;Ni((0,M.Z)(n.prototype),"init",this).call(this),this.mEventBrokerSubscriptions.push(P.eventBus().subscribe(Di.getTopicName(Ei.ScreenshotTransitionStart),(function(t){e.screenshotStart(t.getData().image_data,t.getData().image_width,t.getData().image_height)})),P.eventBus().subscribe(Di.getTopicName(Ei.ScreenshotTransitionEnd),(function(){e.screenshotEnd()})))}},{key:"screenshotStart",value:function(e,t,n){void 0!==this.mOverlayImageOpacityTimer&&(window.clearTimeout(this.mOverlayImageOpacityTimer),delete this.mOverlayImageOpacityTimer),He.append(this.mLayerContainer,this.mOverlayImage),this.mOverlayImage.setAttribute("src",e),He.setStyle(this.mOverlayImage,{webkitTransition:"opacity 0s ease-in-out",MozTransition:"opacity 0s ease-in-out",msTransition:"opacity 0s ease-in-out",OTransition:"opacity 0s ease-in-out",transition:"opacity 0s ease-in-out"}),He.setStyle(this.mOverlayImage,"opacity","1"),He.setStyle(this.mOverlayImage,{webkitTransition:"opacity 1s ease-in-out",MozTransition:"opacity 1s ease-in-out",msTransition:"opacity 1s ease-in-out",OTransition:"opacity 1s ease-in-out",transition:"opacity 1s ease-in-out"});var r=void 0===t?"100%":"".concat(t,"px"),i=void 0===n?"auto":"".concat(n,"px");He.setStyle(this.mOverlayImage,{width:r,height:i}),He.setStyle(this.mLayerContainer,"display","block")}},{key:"screenshotEnd",value:function(){var e=this;He.setStyle(this.mOverlayImage,"opacity","0"),this.mOverlayImageOpacityTimer=window.setTimeout((function(){var t;delete e.mOverlayImageOpacityTimer,He.setStyle(e.mLayerContainer,"display","none"),null!==(t=e.mOverlayImage)&&void 0!==t&&t.parentElement&&e.mLayerContainer.removeChild(e.mOverlayImage)}),1e3)}},{key:"destroy",value:function(){this.mEventBrokerSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),Ni((0,M.Z)(n.prototype),"destroy",this).call(this)}}]),n}(Jf);function Am(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Om,Dm,Pm=function(e){(0,g.Z)(n,e);var t=Am(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"createContainer",value:function(){var e=this.mViewLayerOptions.container;return He.setStyle(e,{position:"absolute",top:"1px",left:"1px",zIndex:"1",width:"1px",height:"1px"}),e.setAttribute("id","svg_renderdom"),e}}]),n}(Jf);function Bm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}!function(e){e.TOP="top",e.BOTTOM="bottom",e.LEFT="left",e.RIGHT="right"}(Om||(Om={})),function(e){e.PERCENTAGE="percentage",e.ICON="icon",e.GALLERY="gallery"}(Dm||(Dm={}));var Fm=function(e){(0,g.Z)(n,e);var t=Bm(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,u.Z)(this,n),r=t.call(this,e,i),(0,l.Z)((0,_.Z)(r),"mEventBrokerSubscriptions",[]),(0,l.Z)((0,_.Z)(r),"mProductsLoading",new Map),(0,l.Z)((0,_.Z)(r),"mInitialBuildFinished",!1),(0,l.Z)((0,_.Z)(r),"mBuildReady",!1),(0,l.Z)((0,_.Z)(r),"mRendererBuildBusy",!0),(0,l.Z)((0,_.Z)(r),"mBuildFullyLoaded",!1),r}return(0,c.Z)(n,[{key:"init",value:function(){var e=this;Ni((0,M.Z)(n.prototype),"init",this).call(this),this.mProductsLoading.clear(),this.mEventBrokerSubscriptions.push(P.eventBus().subscribe(Di.getTopicName(Ei.RendererBuildStarted),(function(){e.mRendererBuildBusy=!0,e.checkBuildProcess()})),P.eventBus().subscribe(Di.getTopicName(Ei.RendererBuildFinished),(function(){e.mRendererBuildBusy=!1,e.checkBuildProcess()})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductStartLoading),(function(t){var n=t.getData().catalogue_id;e.mProductsLoading.set(n,!0),e.checkBuildProcess()})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductErrorLoading),(function(t){var n=t.getData().catalogue_id;e.mProductsLoading.set(n,!1),e.checkBuildProcess()})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductFinishedLoading),(function(t){var n=t.getData().catalogue_id;e.mProductsLoading.set(n,!1),e.checkBuildProcess()})),P.eventBus().subscribe(Di.getTopicName(Ei.BuildFailed),(function(){e.mBuildFullyLoaded=!0,e.checkBuildProcess()})),P.eventBus().subscribe(Di.getTopicName(Ei.BuildFullyLoaded),(function(){e.mBuildFullyLoaded=!0,e.checkBuildProcess()})))}},{key:"checkBuildProcess",value:function(){var e=!Array.from(this.mProductsLoading.values()).some((function(e){return!0===e}));!this.mInitialBuildFinished&&e&&!this.mRendererBuildBusy&&this.mBuildFullyLoaded&&(this.mInitialBuildFinished=!0,this.mBuildReady=!0,this.mProductsLoading.clear(),this.updateLoader()),this.mInitialBuildFinished&&this.finishedLoading()}},{key:"updateLoader",value:function(){}},{key:"destroy",value:function(){this.mBuildReady=!1,this.mEventBrokerSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),Ni((0,M.Z)(n.prototype),"destroy",this).call(this)}}]),n}(Jf);function Lm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Nm=function(e){(0,g.Z)(n,e);var t=Lm(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mProgressContainer",void 0),(0,l.Z)((0,_.Z)(e),"mBuildProgress",0),(0,l.Z)((0,_.Z)(e),"mLoadDisplayDelay",void 0),e}return(0,c.Z)(n,[{key:"createContainer",value:function(){var e=He.createElement("div");He.setAttribute(e,"id","xpv__viewer_initial_load_backdrop"),He.setStyle(e,{width:"100%",height:"100%",flex:"1",position:"absolute",zIndex:"4",textAlign:"center",display:"flex",fontSize:"14px",backgroundColor:"rgba(255, 255, 255, 1.0)",alignItems:"center",justifyContent:"center",top:"0",fontFamily:"Arial, sans-serif"});var t=He.createElement("div");return He.setStyle(t,"width","50%"),He.append(e,t),this.mViewLayerOptions.showProgressBar&&(this.mProgressContainer=He.createElement("div"),He.setAttribute(this.mProgressContainer,"id","xpv__viewer_initial_progress_container"),He.setStyle(this.mProgressContainer,{width:"100%","pointer-events":"none","user-select":"none"}),He.append(t,this.mProgressContainer)),e}},{key:"init",value:function(){var e=this;Ni((0,M.Z)(n.prototype),"init",this).call(this),this.mEventBrokerSubscriptions.push(P.eventBus().subscribe(Di.getTopicName(Ei.RendererBuildProgress),(function(t){var n=t.getData();Number.isFinite(n)&&e.buildProgressHandler(n)})))}},{key:"buildProgressHandler",value:function(e){var t=e;t/=Array.from(this.mProductsLoading.values()).filter((function(e){return!0===e})).length+1,this.mBuildProgress=Dt(Math.floor(100*t),0,100),this.updateLoader()}},{key:"updateLoader",value:function(){var e=this;if(this.mBuildReady)return void 0!==this.mLoadDisplayDelay&&(window.clearTimeout(this.mLoadDisplayDelay),delete this.mLoadDisplayDelay),void He.setStyle(this.mLayerContainer,"display","none");"none"!==He.getStyle(this.mLayerContainer,"display")?this.showLoader():void 0===this.mLoadDisplayDelay&&(qe.qL.print("show loader with delay"),this.mLoadDisplayDelay=window.setTimeout((function(){e.showLoader()}),300))}},{key:"showLoader",value:function(){if(He.setStyle(this.mLayerContainer,"display","flex"),this.mProgressContainer)if(this.mBuildReady)He.setHtml(this.mProgressContainer,"");else{var e=Math.max(0,this.mBuildProgress);He.setHtml(this.mProgressContainer,'<div style="margin: auto;width: 100%;height: 4px;color:#fb9526; background-color: #fedfb5;">\n                <div style="height: 100%;width: '.concat(e,'%;background: linear-gradient(to right, #fedfb5, #fb9526); margin-bottom: 15px;"></div>\n                ').concat(e,"%\n            </div>"))}}},{key:"finishedLoading",value:function(){this.mBuildProgress=0,this.mProgressContainer&&(this.mProgressContainer.remove(),delete this.mProgressContainer),this.destroy()}}]),n}(Fm);function jm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var zm=function(e){(0,g.Z)(n,e);var t=jm(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"createContainer",value:function(){var e,t,n,r=He.createElement("div");if(He.setAttribute(r,"id","xpv__viewer_initial_load_backdrop"),null===(e=this.mViewLayerOptions.icon)||void 0===e||!e.source_url)return r;He.setStyle(r,{width:"100%",height:"100%",flex:"1",position:"absolute",zIndex:"4",textAlign:"center",display:"flex",fontSize:"14px",backgroundColor:"rgba(255, 255, 255, 1.0)",alignItems:"center",justifyContent:"center",top:"0",fontFamily:"Arial, sans-serif"});var i=He.createElement("div");He.setStyle(i,"width","20%"),He.append(r,i);var a=He.createElement("div");return He.setHtml(a,'<img\n                src="'.concat(null===(t=this.mViewLayerOptions.icon)||void 0===t?void 0:t.source_url,'"\n                alt="').concat(null===(n=this.mViewLayerOptions.icon)||void 0===n?void 0:n.name,'" style="width: 100%; height: 100%; object-fit: contain;"\n            >')),He.append(i,a),r}},{key:"finishedLoading",value:function(){this.destroy()}}]),n}(Fm);function Um(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Vm=function(e){(0,g.Z)(n,e);var t=Um(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"galleryContainer",void 0),(0,l.Z)((0,_.Z)(e),"thumbnailContainer",void 0),(0,l.Z)((0,_.Z)(e),"mGlobalStyleElement",void 0),e}return(0,c.Z)(n,[{key:"createContainer",value:function(){var e,t=He.createElement("div");if(He.setAttribute(t,"id","xpv__viewer_initial_load_backdrop"),null===(e=this.mViewLayerOptions.gallery)||void 0===e||!e.length)return t;He.setStyle(t,{display:"none",width:"100%",height:"100%",flex:"1",position:"absolute",zIndex:"4",textAlign:"center",fontSize:"14px",backgroundColor:"rgba(255, 255, 255, 1.0)",alignItems:"center",justifyContent:"center",top:"0",fontFamily:"Arial, sans-serif"});var n=He.createElement("div");return n.style.width="80%",n.className="xpv-preview-loading-screen-gallery",He.append(t,n),this.loadScripts(n),t}},{key:"loadScripts",value:function(e){var t=this;__webpack_require__.e(647).then(__webpack_require__.bind(__webpack_require__,1372)).then((function(n){return n.register(),t.initializeGlobalStyle(),t.mountSwiper(e),t.initSwiper()})).catch((function(e){qe.qL.error("Failed to load swiper:",e),t.destroy()}))}},{key:"mountSwiper",value:function(e){this.galleryContainer=He.createElement("swiper-container"),this.galleryContainer.className="xpv-swiper-container-carousel",He.setAttribute(this.galleryContainer,"init","false");var t=this.mViewLayerOptions.gallery.map((function(e){return'\n            <swiper-slide><img src="'.concat(e.source_url,'" alt="').concat(e.name,'"/></swiper-slide>\n        ')})).join("");He.setHtml(this.galleryContainer,t);var n=He.createElement("div");n.className="xpv-container-swiper-thumb";var r=this.mViewLayerOptions.gallery.map((function(e){return'\n            <swiper-slide><img src="'.concat(e.lod2_url,'" alt="').concat(e.name,'"/></swiper-slide>\n        ')})).join("");this.thumbnailContainer=He.createElement("swiper-container"),this.thumbnailContainer.className="xpv-container-swiper-thumb-slides",this.thumbnailContainer.style.width="".concat(this.swiperThumbSlidesWidth(),"px"),He.setAttribute(this.thumbnailContainer,"init","false"),He.setHtml(this.thumbnailContainer,r),He.append(n,this.thumbnailContainer);var i=He.createElement("div");He.setHtml(i,'<div class="xpv-content-img-loading-viewer">\n                <img src="'.concat(Jr.E.assetsUrl,'system/gifs/product-presentation-loading-gallery.gif" alt="Model 3D thumbnail"/>\n            </div>')),He.append(e,this.galleryContainer),He.append(e,n),He.append(n,i)}},{key:"initSwiper",value:function(){var e=this.thumbnailContainer;Object.assign(e,{slidesPerView:this.thumbSlidesPerView(),watchSlidesProgress:!0,slideToClickedSlide:!0,watchSlidesVisibility:!0,slideThumbActiveClass:"xpv-swiper-slide-thumb-active"}),e.initialize();var t=this.galleryContainer;Object.assign(t,{slidesPerView:1,navigation:!0,thumbs:e}),t.initialize(),He.setStyle(this.mLayerContainer,"display","flex")}},{key:"thumbSlidesPerView",value:function(){return Math.min(this.mViewLayerOptions.gallery.length,3)}},{key:"swiperThumbSlidesWidth",value:function(){return Math.min(80*this.mViewLayerOptions.gallery.length,240)}},{key:"finishedLoading",value:function(){this.galleryContainer&&(this.galleryContainer.remove(),delete this.galleryContainer),this.thumbnailContainer&&(this.thumbnailContainer.remove(),delete this.thumbnailContainer),this.mGlobalStyleElement&&(this.mGlobalStyleElement.remove(),delete this.mGlobalStyleElement),this.destroy()}},{key:"initializeGlobalStyle",value:function(){this.mGlobalStyleElement=He.createElement("style"),document.getElementsByTagName("head")[0].appendChild(this.mGlobalStyleElement),He.setAttribute(this.mGlobalStyleElement,"type","text/css"),He.setHtml(this.mGlobalStyleElement,"\n            .xpv-preview-loading-screen-gallery {\n                width: 100%;\n                height: 100%;\n                position: relative;\n            }\n\n            .xpv-preview-loading-screen-gallery img {\n              width: 300px;\n              aspect-ratio: 1;\n              object-fit: contain;\n            }\n\n            .xpv-preview-loading-screen-gallery swiper-container::part(button-prev),\n            .xpv-preview-loading-screen-gallery swiper-container::part(button-next) {\n                --swiper-navigation-size: 25px;\n                color: #fb9526;\n            }\n\n            .xpv-swiper-container-carousel {\n                width: 100%;\n                height: 100%;\n            }\n\n            .xpv-swiper-container-carousel swiper-slide {\n                width: 100%;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n            }\n\n            .xpv-container-swiper-thumb {\n              position: absolute;\n              bottom: 20px;\n              left: 50%;\n              transform: translateX(-50%);\n              gap: 10px;\n              z-index: 2;\n              padding: 10px 30px;\n              border-radius: 50px;\n              box-shadow: 0 3px 10px rgb(0 0 0 / 0.2);\n              display: flex;\n            }\n\n            .xpv-container-swiper-thumb swiper-slide {\n              opacity: 0.4;\n              display: flex;\n              align-items: center;\n            }\n\n            .xpv-container-swiper-thumb .xpv-container-swiper-thumb-slides .xpv-swiper-slide-thumb-active {\n              opacity: 1;\n            }\n\n            .xpv-container-swiper-thumb .xpv-container-swiper-thumb-slides .xpv-swiper-slide-thumb-active img {\n              transform: scale(1);\n              border: 2px solid #fb9526;\n            }\n\n            .xpv-container-swiper-thumb .xpv-container-swiper-thumb-slides img {\n              width: 40px;\n              aspect-ratio: 1;\n              object-fit: contain;\n              border-radius: 50%;\n              border: 2px solid lightgrey;\n              box-sizing: border-box;\n              cursor: pointer;\n              transform: scale(0.8);\n            }\n\n            .xpv-container-swiper-thumb .xpv-content-img-loading-viewer {\n              width: 40px;\n              aspect-ratio: 1;\n              border-radius: 50%;\n              border: 2px solid lightgrey;\n              box-sizing: border-box;\n              background-color: white;\n              display: flex;\n              justify-content: center;\n            }\n\n            .xpv-container-swiper-thumb .xpv-content-img-loading-viewer img {\n              width: 50%;\n              aspect-ratio: 1;\n              object-fit: contain;\n              margin-right: 10px;\n            }")}}]),n}(Fm),Hm=function(){function e(t,n,r,i){(0,u.Z)(this,e),(0,l.Z)(this,"mViewRenderWrapper",void 0),(0,l.Z)(this,"mViewerCanvas",void 0),(0,l.Z)(this,"mLayerManager",void 0),(0,l.Z)(this,"mSubscriptions",[]),(0,l.Z)(this,"mEventBrokerSubscriptions",[]),(0,l.Z)(this,"mViewportRenderer",void 0),(0,l.Z)(this,"mClockLastUpdate",0),(0,l.Z)(this,"mRenderActive",void 0),(0,l.Z)(this,"mViewRenderSize",new D(800,640)),(0,l.Z)(this,"mRenderStream",new Ht),(0,l.Z)(this,"mRenderRepeat",0),(0,l.Z)(this,"mToolbar",void 0),(0,l.Z)(this,"mInteractTimeout",-1),(0,l.Z)(this,"dropzone",void 0),(0,l.Z)(this,"mEngineStopped",!1),(0,l.Z)(this,"mRequestFrameStream",new Ht),(0,l.Z)(this,"viewerOptions",void 0),(0,l.Z)(this,"uiContainer",void 0),this.mViewRenderWrapper=t,this.mViewerCanvas=n,this.viewerOptions=i||{},this.uiContainer=r,this.mRenderActive=!1,this.mToolbar=new Xf(this.mViewRenderWrapper),this.mLayerManager=new wm(this.mViewRenderWrapper),this.mViewportRenderer=new Qf(this)}var n;return(0,c.Z)(e,[{key:"init",value:function(){var e=this;this.mViewportRenderer.addController(new ym),this.mViewportRenderer.addController(new Vp),this.mViewportRenderer.addController(new qp),this.mViewportRenderer.addController(new dm);var t=new pm;this.mViewportRenderer.addController(t),this.isSubProductsRotationAllowed()?(t.DisableRotationAxis(um.X|um.Z),t.EnableRotation()):t.DisableRotation(),this.mViewportRenderer.initialize(),this.mEventBrokerSubscriptions.push(P.eventBus().subscribe(Di.getTopicName(Ei.WindowResized),(function(){return e.windowResizeHandler()})),P.eventBus().subscribe(Di.getTopicName(Ei.RequestFrame),(function(){e.mRenderRepeat=10})),P.eventBus().subscribeAll((function(t,n){return e.onEventSent(t,n)})),P.messenger().listen(Re.TypeRTTI,(function(t){e.dispatchMessageToViewport(t)})),P.messenger().listen(Se.TypeRTTI,(function(t){e.dispatchMessageToViewport(t)})),P.messenger().listen(X.TypeRTTI,(function(t){e.dispatchMessageToViewport(t)}))),this.mSubscriptions.push(this.mRenderStream.subscribe((function(t){e.renderView(t)})),this.mRequestFrameStream.pipe(Hp(16)).subscribe((function(){P.eventBus().dispatch(new Di(Ei.RequestFrame))}))),this._viewInit(),this.mToolbar.init(),this.mLayerManager.initLayers()}},{key:"destroy",value:function(){this.mEngineStopped=!0,this.mRenderActive=!1,this.mToolbar&&(this.mToolbar.dispose(),delete this.mToolbar),this.mLayerManager.destroyLayers(),this.mViewportRenderer.dispose(),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mEventBrokerSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.unregisterInputEvents(),this.dropzone&&(this.dropzone.destroy(),delete this.dropzone)}},{key:"registerInputEvents",value:function(){var e=this;He.on(this.mViewerCanvas,"mousedown",(function(t){return e.handleViewMouseDown(t)})),He.on(this.mViewerCanvas,"mousemove",(function(t){return e.handleViewMouseMove(t)})),He.on(this.mViewerCanvas,"mouseup",(function(t){return e.handleViewMouseUp(t)})),He.on(this.mViewerCanvas,"mouseleave",(function(t){return e.handleMouseLeave(t)})),He.on(this.mViewerCanvas,"click",(function(e){return e.preventDefault()})),He.on(this.mViewerCanvas,"dblclick",(function(t){return e.handleDoubleClick(t)})),He.on(this.mViewerCanvas,"touchstart",(function(t){e.handleViewMouseDown(t)})),He.on(this.mViewerCanvas,"touchmove",(function(t){e.handleViewMouseMove(t)})),He.on(this.mViewerCanvas,"touchend",(function(t){e.handleViewMouseUp(t)})),He.on(this.mViewerCanvas,"wheel",(function(t){t.preventDefault(),e.interactWithViewer(),e.mRequestFrameStream.next()})),He.on(document,"keydown",(function(t){e.mRequestFrameStream.next()})),He.on(document,"keyup",(function(t){e.mRequestFrameStream.next()}))}},{key:"unregisterInputEvents",value:function(){He.off(this.mViewerCanvas,"mousedown"),He.off(this.mViewerCanvas,"mousemove"),He.off(this.mViewerCanvas,"mouseup"),He.off(this.mViewerCanvas,"mouseleave"),He.off(this.mViewerCanvas,"click"),He.off(this.mViewerCanvas,"dblclick"),He.off(this.mViewerCanvas,"touchstart"),He.off(this.mViewerCanvas,"touchmove"),He.off(this.mViewerCanvas,"touchend"),He.off(this.mViewerCanvas,"wheel"),He.off(document,"keydown"),He.off(document,"keyup")}},{key:"_viewInit",value:function(){var e=this;this.dropzone=window.expivi.interact().dropzone({droppable:this.mViewRenderWrapper,ondropped:function(t){if(t){var n=t.originalSource;n&&(n.hasAttribute("data-product")||n.hasAttribute("data-model"))&&e.onItemDropped(t)}}}),this.mViewportRenderer.setViewContainer(this.mViewRenderWrapper),this.mViewportRenderer.dispatchMessage(new Z),P.sceneManager().getActiveCamera().transform.position.copy(new Bi(2,3,0)),this.mClockLastUpdate=window.performance.now(),this.mRenderActive=!0,window.requestAnimationFrame(this.animateView.bind(this)),this.updateViewportSize()}},{key:"getViewportRenderer",value:function(){return this.mViewportRenderer}},{key:"windowResizeHandler",value:function(){!0===this.mRenderActive&&this.updateViewportSize()}},{key:"interactWithViewer",value:function(){var e=this;void 0!==this.mInteractTimeout&&window.clearTimeout(this.mInteractTimeout),this.mViewRenderWrapper.classList.add("interacted"),this.mInteractTimeout=window.setTimeout((function(){e.mViewRenderWrapper.classList.remove("interacted"),delete e.mInteractTimeout}),250)}},{key:"handleViewMouseDown",value:function(e){var t;e.preventDefault(),this.interactWithViewer(),this.mViewerCanvas.focus(),null===(t=this.mViewportRenderer)||void 0===t||t.mouseDown(e),this.mRequestFrameStream.next()}},{key:"handleViewMouseUp",value:function(e){var t;e.preventDefault(),this.interactWithViewer(),null===(t=this.mViewportRenderer)||void 0===t||t.mouseUp(e),this.mRequestFrameStream.next()}},{key:"handleViewMouseMove",value:function(e){var t;e.preventDefault(),this.interactWithViewer(),null===(t=this.mViewportRenderer)||void 0===t||t.mouseMove(e),this.mRequestFrameStream.next()}},{key:"handleMouseLeave",value:function(e){var t;e.preventDefault(),this.interactWithViewer(),null===(t=this.mViewportRenderer)||void 0===t||t.mouseLeave(e),this.mRequestFrameStream.next()}},{key:"handleDoubleClick",value:function(e){var t;e.preventDefault(),this.interactWithViewer(),null===(t=this.mViewportRenderer)||void 0===t||t.mouseDbClick(e),this.mRequestFrameStream.next()}},{key:"onItemDropped",value:function(e){try{var t,n=Number(e.clientX||0),r=Number(e.clientY||0),i=e.originalSource,a=(0,f.fk)(i.dataset.product),o=(0,f.fk)(i.dataset.model);null===(t=this.mViewportRenderer)||void 0===t||t.dropItem({position:new D(n,r),dragData:{model_id:o,product_id:a,target:i,dropzone:e.currentTarget,types:["dragend","dropped"]}})}catch(e){qe.qL.error("onItemDropped error: ",e)}}},{key:"onItemDragStart",value:function(e){try{var t,n=Number(e.clientX||0),r=Number(e.clientY||0),i=e.originalSource;null===(t=this.mViewportRenderer)||void 0===t||t.dragStart({position:new D(n,r),dragData:{target:i,types:["dragstart"]}}),P.messenger().send(new F("start",new D(e.position.x,e.position.y),e.dragData)),this.mRequestFrameStream.next()}catch(e){qe.qL.error("onItemDragStart error: ",e)}}},{key:"onItemDragMove",value:function(e){try{var t,n=Number(e.clientX||0),r=Number(e.clientY||0),i=e.originalSource;null===(t=this.mViewportRenderer)||void 0===t||t.dragMove({position:new D(n,r),dragData:{target:i,types:["dragmove"]}}),this.mRequestFrameStream.next()}catch(e){qe.qL.error("onItemDragMove error: ",e)}}},{key:"onItemDragEnd",value:function(e){try{var t,n=Number(e.clientX||0),r=Number(e.clientY||0),i=e.originalSource;null===(t=this.mViewportRenderer)||void 0===t||t.dragEnd({position:new D(n,r),dragData:{target:i,types:["dragend"]}}),P.messenger().send(new F("leave",new D(e.position.x,e.position.y),e.dragData)),this.mRequestFrameStream.next()}catch(e){qe.qL.error("onItemDragEnd error:",e)}}},{key:"updateViewportSize",value:function(){var e=this,t=this.mViewRenderWrapper.offsetWidth,n=this.mViewRenderWrapper.offsetHeight;P.renderer().getRenderEngine().setSize(t,n),this.mViewportRenderer.resize(t,n),window.setTimeout((function(){e.mViewRenderSize.set(t,n)}),0)}},{key:"dispatchMessageToViewport",value:function(e){qe.qL.print("dispatch message to viewport renderer: ",this.mViewportRenderer,"message: ",e),this.mViewportRenderer&&this.mViewportRenderer.dispatchMessage(e)}},{key:"renderCamera",value:(n=t(r().mark((function t(n,i){var a,o,s=this,u=arguments;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=u.length>2&&void 0!==u[2]?u[2]:"image/jpeg",o=u.length>3?u[3]:void 0,t.abrupt("return",new Promise((function(t){var r=new Bi,u=new Pi,c=P.sceneManager().getActiveCamera();c.transform.getWorldPosition(r),c.transform.getWorldQuaternion(u);var l=!1;switch(n){case Ii.FIRST_POSITION:qe.qL.print("rendering first",n);var h=P.sceneManager().findNodesOfType(ga.TypeRTTI,(function(e){return e.isCameraPartOfScene()}));h.length>0?s.mViewportRenderer.dispatchMessage(new Re(h[0].getSceneObjectId(),!1)):s.mViewportRenderer.dispatchMessage(new z(Ii.FIT_OBJECT_FRONT,i,!1));break;case Ii.FIT_OBJECT_FRONT:case Ii.FIT_OBJECT_BACK:case Ii.FIT_OBJECT_LEFT:case Ii.FIT_OBJECT_RIGHT:case Ii.FIT_OBJECT_TOP:case Ii.FIT_OBJECT_BOTTOM:qe.qL.print("rendering fit",n),s.mViewportRenderer.dispatchMessage(new z(n,i,!1));break;case Ii.CUSTOM_CAMERA_POSITION:var p=new Bi(0,0,0),m=new Li(0,0,0);if(p.copy(r),m.setFromQuaternion(u),o)if(Array.isArray(o.position)?p.fromArray(o.position):o.position&&p.set(Number(o.position.x)||0,Number(o.position.y)||0,Number(o.position.z)||0),o.direction){var d=new Bi;Array.isArray(o.direction)?d.fromArray(o.direction):d.set(Number(o.direction.x)||0,Number(o.direction.y)||0,Number(o.direction.z)||0);var v=(new Fi).lookAt(d,new Bi(0,0,0),new Bi(0,1,0));m.setFromRotationMatrix(v)}else if(o.quaternion){var y=new Pi;Array.isArray(o.quaternion)?y.fromArray(o.quaternion):y.set(Number(o.quaternion.x)||0,Number(o.quaternion.y)||0,Number(o.quaternion.z)||0,isNaN(o.quaternion.w)?1:Number(o.quaternion.w)),m.setFromQuaternion(y)}else if(o.rotation){var g=new Li;Array.isArray(o.rotation)?g.fromArray(o.rotation):g.set(Number(o.rotation.x)||0,Number(o.rotation.y)||0,Number(o.rotation.z)||0,o.rotation.order||"XYZ"),m.copy(g)}qe.qL.print("renderCamera CUSTOM_CAMERA_POSITION",p,m),s.mViewportRenderer.dispatchMessage(new X(p,new Bi(m.x,m.y,m.z),W.PUSH_CONTROLLER,1,!0)),l=!0;break;default:qe.qL.print("rendering default",n);var b=P.sceneManager().getActiveCameraId();f.Ft.isNumeric(b)?s.mViewportRenderer.dispatchMessage(new Re(b,!1)):s.mViewportRenderer.dispatchMessage(new z(Ii.FIT_OBJECT_FRONT,i,!1))}window.setTimeout((function(){s.renderView(1/e.FRAME_RATE_CAP);var n=["image/jpeg","image/png","image/tiff"].find((function(e){return e===a}));void 0===n&&(n="image/jpeg");var i=P.renderer().getRenderEngine().getCanvas().toDataURL(n);if(l){var o=(new Li).setFromQuaternion(u);s.mViewportRenderer.dispatchMessage(new X(r,new Bi(o.x,o.y,o.z),W.POP_CONTROLLER,1,!0))}t(i)}),1)})));case 3:case"end":return t.stop()}}),t)}))),function(e,t){return n.apply(this,arguments)})},{key:"animateView",value:function(e){if(!this.mEngineStopped){window.requestAnimationFrame(this.animateView.bind(this));var t=e/1e3,n=t-this.mClockLastUpdate;this.mClockLastUpdate=t,this.mRenderActive&&(P.sceneManager().fixedUpdate(n),P.physicsSystem()&&(P.physicsSystem().syncTransforms(),P.physicsSystem().step(1/60,20),P.physicsSystem().syncMeshes()),P.sceneManager().update(n),this.mViewportRenderer.update(n),this.mRenderRepeat>0&&(this.mRenderRepeat-=1,this.mRenderStream.next(n)))}}},{key:"renderView",value:function(e){P.renderer().render(e)}},{key:"onEventSent",value:function(e,t){switch(t){case Di.getTopicName(Ei.TransformControlChanged):case Di.getTopicName(Ei.ModelAttributeChanged):case Di.getTopicName(Ei.ObjectChanged):case Di.getTopicName(Ei.ObjectSelected):case Di.getTopicName(Ei.ObjectTargetChanged):case Di.getTopicName(Ei.TransformModeChanged):case Di.getTopicName(Ei.TransformTargetMode):case Di.getTopicName(Ei.WindowResized):case Di.getTopicName(Ei.ActiveViewChanged):P.eventBus().dispatch(new Di(Ei.RequestFrame),void 0,void 0,500)}switch(t){case Di.getTopicName(Ei.SceneGraphAdded):case Di.getTopicName(Ei.SceneGraphRemoved):P.eventBus().dispatch(new Di(Ei.SceneGraphChanged))}}},{key:"isSubProductsRotationAllowed",value:function(){var e=P.settingsManager().getSettings().getCatalogueMeta().allowSubProductRotation;return"boolean"!=typeof e||e}},{key:"createViewLayers",value:function(e){var t=this.resolveInitialLoadingScreen(7,e);this.mLayerManager.pushLayer(t,new _m(6),new Cm(5,{show360Indicator:this.viewerOptions.show360Indicator,viewerCanvas:this.mViewerCanvas}),new tp(3,{toolbar:this.mToolbar}),new Pm(2,{container:this.uiContainer}),new Em(1),new Zm(0,{container:this.mViewerCanvas}))}},{key:"resolveInitialLoadingScreen",value:function(e,t){var n,r=t.getSettings().getProductPresentationSettings();switch((null==r?void 0:r.loading_type)||Dm.PERCENTAGE){case Dm.ICON:n=new zm(e,{icon:null==r?void 0:r.loading_icon});break;case Dm.GALLERY:n=new Vm(e,{gallery:null==r?void 0:r.loading_gallery});break;default:n=new Nm(e,{showProgressBar:this.viewerOptions.showProgress})}return n}}]),e}();function Gm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Hm,"FRAME_RATE_CAP",60);var qm=function(e){(0,g.Z)(n,e);var t=Gm(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e)).mName="PrimitiveEntity",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(Wa);function Wm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(qm,"TypeRTTI",new k.r("PrimitiveEntity",Wa.TypeRTTI));var Ym=function(e){(0,g.Z)(n,e);var t=Wm(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.primitive_line),(0,l.Z)((0,_.Z)(r),"mPointA",Bi.Left()),(0,l.Z)((0,_.Z)(r),"mPointB",Bi.Right()),(0,l.Z)((0,_.Z)(r),"mSpriteOffset",new Bi),(0,l.Z)((0,_.Z)(r),"mLineColor",so.Black()),(0,l.Z)((0,_.Z)(r),"mLabel",{title:"",color:new so("#0b0004"),margin:0,fontSize:32,spriteScale:1}),r.mName="PrimitiveEntityLine",r.setValue("label",{}),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"point_a":return t instanceof Bi?this.mPointA.copy(t):Array.isArray(t)&&this.mPointA.fromArray(t),!0;case"point_b":return t instanceof Bi?this.mPointB.copy(t):Array.isArray(t)&&this.mPointB.fromArray(t),!0;case"point_a_x":return this.mPointA.setX(parseFloat(t)),!0;case"point_a_y":return this.mPointA.setY(parseFloat(t)),!0;case"point_a_z":return this.mPointA.setZ(parseFloat(t)),!0;case"point_b_x":return this.mPointB.setX(parseFloat(t)),!0;case"point_b_y":return this.mPointB.setY(parseFloat(t)),!0;case"point_b_z":return this.mPointB.setZ(parseFloat(t)),!0;case"inv_point_a":return t instanceof Bi&&this.setWorldPosition(t,this.mPointA),!0;case"inv_point_b":return t instanceof Bi&&this.setWorldPosition(t,this.mPointB),!0;case"sprite_offset":return t instanceof Bi?this.mSpriteOffset.copy(t):Array.isArray(t)&&this.mSpriteOffset.fromArray(t),!0;case"inv_sprite_offset":return t instanceof Bi&&this.setOffsetPosition(t),!0;case"line_color":return this.mLineColor.set(t),!0;case"color":return this.mLabel.color.set(t),!0;case"fontSize":return this.mLabel.fontSize=parseInt(t,10),!0;case"spriteScale":return this.mLabel.spriteScale=parseFloat(t),!0;case"title":var i="";try{i=t.toString()}catch(e){}return this.mLabel.title=i,!0;case"label":try{var a=null;(a="string"==typeof t?JSON.parse(t):t).title&&(this.mLabel.title=a.title),a.margin&&(this.mLabel.margin=a.margin),a.color&&this.mLabel.color.set(a.color),a.fontSize&&(this.mLabel.fontSize=a.fontSize),a.spriteScale&&(this.mLabel.spriteScale=a.spriteScale)}catch(e){return!1}return!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"point_a":return this.mPointA;case"point_b":return this.mPointB;case"point_a_x":return this.mPointA.x;case"point_a_y":return this.mPointA.y;case"point_a_z":return this.mPointA.z;case"point_b_x":return this.mPointB.x;case"point_b_y":return this.mPointB.y;case"point_b_z":return this.mPointB.z;case"sprite_offset":return this.mSpriteOffset;case"line_color":return this.mLineColor;case"title":return this.mLabel.title;case"color":return this.mLabel.color;case"fontSize":return this.mLabel.fontSize;case"spriteScale":return this.mLabel.spriteScale;case"label":return this.mLabel}return null}},{key:"setWorldPosition",value:function(e,t){var n=new Fi;n.copy(this.transform.matrixWorld).invert(),e.applyMatrix4(n),t.copy(e)}},{key:"setOffsetPosition",value:function(e){var t=this.getSpritePosition(!1);this.mSpriteOffset.copy(e.sub(t))}},{key:"getSpritePosition",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.mPointA.clone().add(this.mPointB.clone().sub(this.mPointA).normalize().multiplyScalar(.5*this.mPointB.distanceTo(this.mPointA))).add(e?this.mSpriteOffset:new Bi)}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"line"});return t.properties=Object.assign(t.properties,{point_a:this.mPointA.toArray(),point_b:this.mPointB.toArray(),sprite_offset:this.mSpriteOffset.toArray(),line_color:this.mLineColor.getHexString(),label:JSON.stringify({title:this.mLabel.title,color:this.mLabel.color.getHexString(),margin:this.mLabel.margin,fontSize:this.mLabel.fontSize,spriteScale:this.mLabel.spriteScale})}),t}},{key:"pointA",get:function(){return this.mPointA},set:function(e){this.mPointA.copy(e)}},{key:"pointB",get:function(){return this.mPointB},set:function(e){this.mPointB.copy(e)}},{key:"lineColor",get:function(){return this.mLineColor},set:function(e){this.mLineColor.copy(e)}},{key:"spriteOffset",get:function(){return this.mSpriteOffset},set:function(e){this.mSpriteOffset.copy(e)}},{key:"labelText",get:function(){return this.mLabel.title},set:function(e){this.mLabel.title=e}},{key:"labelColor",get:function(){return this.mLabel.color},set:function(e){this.mLabel.color.copy(e)}},{key:"labelFontSize",get:function(){return this.mLabel.fontSize},set:function(e){this.mLabel.fontSize=e}},{key:"labelSpriteScale",get:function(){return this.mLabel.spriteScale},set:function(e){this.mLabel.spriteScale=e}}]),n}(qm);function Km(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Ym,"TypeRTTI",new k.r("PrimitiveEntityLine",qm.TypeRTTI));var Xm=function(e){(0,g.Z)(n,e);var t=Km(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e)).mName="ShaderEntity",r.mLayers.enable(3),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(Wa);function $m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Xm,"TypeRTTI",new k.r("ShaderEntity",Wa.TypeRTTI));var Qm=function(e){(0,g.Z)(n,e);var t=$m(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.effect_fire),r.mName="ShaderEntityFire",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"serialize",value:function(e){return Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"fire"})}}]),n}(Xm);function Jm(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Qm,"TypeRTTI",new k.r("ShaderEntityFire",Xm.TypeRTTI));var ed=function(e){(0,g.Z)(n,e);var t=Jm(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mUpdatable",!1),(0,l.Z)((0,_.Z)(r),"mCommandName",void 0),(0,l.Z)((0,_.Z)(r),"mCommandId",-1),r.mCommandName=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"_setCommandId",value:function(e){this.mCommandId=e}},{key:"getCommandId",value:function(){return this.mCommandId}},{key:"setCommandName",value:function(e){this.mCommandName=e}},{key:"getCommandName",value:function(){return this.mCommandName}},{key:"setUpdatable",value:function(e){this.mUpdatable=e}},{key:"isUpdatable",value:function(){return this.mUpdatable}},{key:"overridesCommand",value:function(e){return this.isTypeOf(e.getType())}},{key:"update",value:function(e){}}]),n}(ze.L);function td(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(ed,"TypeRTTI",new k.r("Command",ze.L.TypeRTTI));var nd=function(e){(0,g.Z)(n,e);var t=td(n);function n(e,r){var i,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return(0,u.Z)(this,n),i=t.call(this,"Add Object"),(0,l.Z)((0,_.Z)(i),"mAddingObject",void 0),(0,l.Z)((0,_.Z)(i),"mParentNode",void 0),(0,l.Z)((0,_.Z)(i),"mPersistant",void 0),(0,l.Z)((0,_.Z)(i),"mSelectAfterCreation",void 0),i.mAddingObject=e,i.mParentNode=r,i.mPersistant=a,i.mSelectAfterCreation=o,i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"execute",value:function(){P.sceneManager().addNode(this.mAddingObject,this.mParentNode,this.mPersistant),this.mSelectAfterCreation&&this.mAddingObject instanceof Ki&&P.sceneManager().select(this.mAddingObject)}},{key:"undo",value:function(){P.sceneManager().deselect(),P.sceneManager().removeNode(this.mAddingObject,this.mPersistant)}}]),n}(ed);function rd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function id(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rd(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}(0,l.Z)(nd,"TypeRTTI",new k.r("AddObjectCommand",ed.TypeRTTI));var ad=function(){function e(){(0,u.Z)(this,e)}var n,i,a;return(0,c.Z)(e,[{key:"resolveProducts",value:(a=t(r().mark((function e(){var t,n,i,a,o,s,u=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>3?u[3]:void 0,n=u.length>4?u[4]:void 0,i=u.length>5?u[5]:void 0,a=id({active:1,limit:u.length>1&&void 0!==u[1]?u[1]:12,cursor:u.length>0&&void 0!==u[0]?u[0]:0,include:(u.length>2&&void 0!==u[2]?u[2]:[]).join(",")},i&&{renderer_type:i}),n&&(a.category=n),t&&(a.sort=t),e.next=11,ei.getInstance().get("catalogue",{params:a});case 11:return o=e.sent,s=o.data,e.abrupt("return",v.getItemsWithRelations(s));case 14:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})},{key:"resolveProduct",value:(i=t(r().mark((function e(t,n){var i,a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={},null!=n&&n.include&&(i.include=n.include),e.next=4,ei.getInstance().get("catalogue/".concat(t),{params:i});case 4:return a=e.sent,o=a.data,e.abrupt("return",v.hydrateResponse(o,!1,5));case 7:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"search",value:(n=t(r().mark((function e(t){var n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ei.getInstance().get("catalogue/search?q=".concat(t));case 2:return n=e.sent,i=n.data,e.abrupt("return",v.getItems(i));case 5:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}],[{key:"getInstance",value:function(){return this.sInstance||(this.sInstance=new e),this.sInstance}}]),e}();(0,l.Z)(ad,"sInstance",void 0);var od=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mLoader",void 0)}var n;return(0,c.Z)(e,[{key:"getSupportedLocales",value:(n=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.sync().pipe(sn(1)).subscribe((function(t){e(t)}),(function(e){n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"resetCache",value:function(){return this.disposeLoader(),this}},{key:"disposeLoader",value:function(){this.mLoader&&(this.mLoader.error("Disposed"),delete this.mLoader)}},{key:"sync",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.mLoader&&!t||(this.mLoader=new ni(1),ei.getInstance().get("".concat(Jr.E.apiUrl,"team/current")).then((function(t){if(!t||200!==t.status)throw new Error("Api responded with status:".concat(t.status));var n=t.data.data.attributes.languages.map((function(e){return e.code}));e.mLoader&&e.mLoader.next(n)}),(function(){e.mLoader&&(e.mLoader.error("Failed resolve locale data"),delete e.mLoader)}))),this.mLoader}}],[{key:"getInstance",value:function(){return this.sInstance||(this.sInstance=new e),this.sInstance}}]),e}();function sd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ud(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sd(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function cd(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ld(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ld(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ld(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(0,l.Z)(od,"sInstance",void 0);var hd=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mCalculatorList",void 0),(0,l.Z)(this,"mPricingData",void 0),(0,l.Z)(this,"mConfigurableNode",void 0),(0,l.Z)(this,"mExcludePriceZero",void 0),this.mCalculatorList=[],this.mExcludePriceZero=!0}var n,i;return(0,c.Z)(e,[{key:"setExcludePriceZero",value:function(e){this.mExcludePriceZero=e}},{key:"get",value:function(){var e=t(r().mark((function e(){var t,n,i,a,o,s,u,c,l;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=ei.getInstance(),n=t.getAcceptLanguage(),i=t.getCountry(),e.next=5,this._getCalculatorList();case 5:a={},o=0,s={},u=cd(this.mCalculatorList),e.prev=9,u.s();case 11:if((c=u.n()).done){e.next=18;break}return l=c.value,e.next=15,this.getBreakDownFromCalculator(l,s,a);case 15:s=e.sent;case 16:e.next=11;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(9),u.e(e.t0);case 23:return e.prev=23,u.f(),e.finish(23);case 26:return o=this.addTotals(a,o),a=Object.assign(a,{total:o}),e.abrupt("return",ud(ud({locale:n,country:i},s),{},{total:a}));case 29:case"end":return e.stop()}}),e,this,[[9,20,23,26]])})));return function(){return e.apply(this,arguments)}}()},{key:"_getCalculatorList",value:(i=t(r().mark((function e(){var t,n,i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=P.sceneManager().getActiveProductNode(),i=n.getComponent("priceManager"),e.next=4,i.requestPriceBreakDown();case 4:a=e.sent,(t=this.mCalculatorList).push.apply(t,s(a.calculators)),this.mConfigurableNode=a.configurableNode,this.mPricingData=a.pricingData;case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"getBreakDownFromCalculator",value:(n=t(r().mark((function e(t,n,i){var a,o,s,u,c;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={totals:{base:0},models:[],catalogue:this.mPricingData.catalogue},o=P.sceneManager().getActiveProductNode(),e.next=4,t.calculate(a,this.mPricingData,o,this.mConfigurableNode);case 4:if((s=e.sent).totals){e.next=7;break}return e.abrupt("return");case 7:return e.prev=7,e.next=10,t.breakDown(o,{excludePriceZero:this.mExcludePriceZero},this.mPricingData,this.mConfigurableNode);case 10:(u=e.sent)&&(n=ud(ud({},n),u)),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(7),qe.qL.warn("Failed to get breakDown of aCalculator:",e.t0);case 17:return c=t.getBreakDownName(),i[c]=s.totals.base,e.abrupt("return",n);case 20:case"end":return e.stop()}}),e,this,[[7,14]])}))),function(e,t,r){return n.apply(this,arguments)})},{key:"addTotals",value:function(e,t){for(var n in e)t+=e[n];return t}}]),e}(),fd=(0,c.Z)((function e(){(0,u.Z)(this,e)}));function pd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var md=function(e){(0,g.Z)(i,e);var n=pd(i);function i(){var e;(0,u.Z)(this,i);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e=n.call.apply(n,[this].concat(r)),(0,l.Z)((0,_.Z)(e),"mCache",new Map),e}return(0,c.Z)(i,[{key:"get",value:function(){var e=t(r().mark((function e(t){var n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mCache.has(t)){e.next=2;break}return e.abrupt("return",this.mCache.get(t));case 2:return e.next=4,ei.getInstance().get("".concat(Jr.E.apiUrl,"attributes/").concat(t,"/gallery"));case 4:if(200===(n=e.sent).status&&n.data){e.next=7;break}throw new Error("Failed to retrieve results");case 7:return i=n.data,this.mCache.set(t,i),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),i}(fd);function dd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var vd=function(e){(0,g.Z)(i,e);var n=dd(i);function i(){var e;(0,u.Z)(this,i);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e=n.call.apply(n,[this].concat(r)),(0,l.Z)((0,_.Z)(e),"mCache",new Map),e}return(0,c.Z)(i,[{key:"get",value:function(){var e=t(r().mark((function e(t){var n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mCache.has(t)){e.next=2;break}return e.abrupt("return",this.mCache.get(t));case 2:return e.next=4,ei.getInstance().get("".concat(Jr.E.apiUrl,"media/").concat(t));case 4:if(200===(n=e.sent).status&&n.data){e.next=7;break}throw new Error("Failed to retrieve results");case 7:return i=n.data.data,this.mCache.set(t,i),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),i}(fd);function yd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var gd=function(e){(0,g.Z)(i,e);var n=yd(i);function i(){var e;(0,u.Z)(this,i);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return e=n.call.apply(n,[this].concat(r)),(0,l.Z)((0,_.Z)(e),"mService",void 0),e}return(0,c.Z)(i,[{key:"setDiagnostic",value:function(e){if("price-breakdown"===e)this.mService=new hd;else qe.qL.error("Unknown diagnostic service.");return this.mService}},{key:"get",value:function(){var e=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.mService){e.next=3;break}throw new Error("Diagnostic service not defined");case 3:return e.abrupt("return",this.mService.get());case 6:e.prev=6,e.t0=e.catch(0),qe.qL.error(e.t0.message);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()}]),i}(fd);function bd(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Md(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Md(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Md(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function kd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var _d=(0,c.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;(0,u.Z)(this,e),(0,l.Z)(this,"id",void 0),(0,l.Z)(this,"action",void 0),(0,l.Z)(this,"priority",void 0),this.id=++e.sId,this.action=t,this.priority=n}));(0,l.Z)(_d,"sId",0);var xd=function(e){(0,g.Z)(a,e);var n,i=kd(a);function a(){var e;return(0,u.Z)(this,a),e=i.call(this),(0,l.Z)((0,_.Z)(e),"mHooks",void 0),e.mHooks=new Map,e}return(0,c.Z)(a,[{key:"hasHook",value:function(e){return this.mHooks.has(e)}},{key:"registerAction",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;if(!t)throw new Error("Unable to register hook.");this.mHooks.has(e)||this.mHooks.set(e,[]);var r=this.mHooks.get(e)||[],i=new _d(t,n);return r.push(i),this.mHooks.set(e,r),i.id}},{key:"unregisterAction",value:function(e){var t=this;this.mHooks.forEach((function(n,r){var i=n.findIndex((function(t){return t.id===e}));i>=0&&t.mHooks.get(r).splice(i,1)}))}},{key:"unregisterHook",value:function(e){this.mHooks.has(e)&&this.mHooks.delete(e)}},{key:"executeHook",value:(n=t(r().mark((function e(t,n){var i,a,o,s,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mHooks.has(t)){e.next=2;break}return e.abrupt("return",n);case 2:(i=this.mHooks.get(t)).sort((function(e,t){return e.priority-t.priority})),a=n,e.prev=5,o=bd(i),e.prev=7,o.s();case 9:if((s=o.n()).done){e.next=16;break}return u=s.value,e.next=13,u.action(a);case 13:a=e.sent;case 14:e.next=9;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(7),o.e(e.t0);case 21:return e.prev=21,o.f(),e.finish(21);case 24:e.next=29;break;case 26:e.prev=26,e.t1=e.catch(5),qe.qL.error("Unable to execute hook (".concat(t,"):"),e.t1);case 29:return e.abrupt("return",a);case 30:case"end":return e.stop()}}),e,this,[[5,26],[7,18,21,24]])}))),function(e,t){return n.apply(this,arguments)})},{key:"get",value:function(e,t){throw new Error("Method not implemented.")}}],[{key:"getInstance",value:function(){return this.sInstance||(this.sInstance=new a),this.sInstance}}]),a}(fd);(0,l.Z)(xd,"sInstance",void 0);var Td=function(){function e(){(0,u.Z)(this,e)}var n;return(0,c.Z)(e,[{key:"resolveCategories",value:(n=t(r().mark((function e(){var t,n,i,a=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={active:1,sort:a.length>3?a[3]:void 0,limit:a.length>1&&void 0!==a[1]?a[1]:12,cursor:a.length>0&&void 0!==a[0]?a[0]:0,include:(a.length>2&&void 0!==a[2]?a[2]:[]).join(",")},e.next=7,ei.getInstance().get("category",{params:t});case 7:return n=e.sent,i=n.data,e.abrupt("return",v.getItems(i));case 10:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})}],[{key:"getInstance",value:function(){return null===this._instance&&(this._instance=new this),this._instance}}]),e}();function wd(e){var t="function"==typeof Map?new Map:void 0;return wd=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return Ma(e,arguments,(0,M.Z)(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),(0,ba.Z)(r,e)},wd(e)}function Rd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Td,"_instance",null);var Zd=function(e){(0,g.Z)(n,e);var t=Rd(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e)).name="ModerationException",r}return(0,c.Z)(n)}(wd(Error));function Sd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Cd=function(e){(0,g.Z)(n,e);var t=Sd(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e),(0,l.Z)((0,_.Z)(i),"messages",void 0),i.name="ValidationException",i.messages=r,i}return(0,c.Z)(n)}(wd(Error));function Id(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ed=function(e){(0,g.Z)(f,e);var n,i,a,o,s,h=Id(f);function f(e){var t;return(0,u.Z)(this,f),t=h.call(this),(0,l.Z)((0,_.Z)(t),"endPoint",void 0),t.endPoint=e,t}return(0,c.Z)(f,[{key:"get",value:function(){var e=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve(void 0));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"upload",value:(s=t(r().mark((function e(t){var n,i,a,o,s,u,c;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t){e.next=3;break}throw new Error("Image source is required");case 3:return e.next=5,this.sendRequest(t);case 5:return n=e.sent,e.next=8,this.setImageDimensions(n);case 8:return e.abrupt("return",e.sent);case 11:if(e.prev=11,e.t0=e.catch(0),"ModerationException"!==(null===e.t0||void 0===e.t0||null===(i=e.t0.response)||void 0===i||null===(a=i.data)||void 0===a?void 0:a.class_name)){e.next=15;break}throw new Zd(e.t0.response.data.message);case 15:if("ValidationException"!==(null===e.t0||void 0===e.t0||null===(o=e.t0.response)||void 0===o||null===(s=o.data)||void 0===s?void 0:s.class_name)){e.next=17;break}throw new Cd(e.t0.response.data.message,e.t0.response.data.messages);case 17:throw new Error((null===e.t0||void 0===e.t0||null===(u=e.t0.response)||void 0===u||null===(c=u.data)||void 0===c?void 0:c.message)||e.t0.message);case 18:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(e){return s.apply(this,arguments)})},{key:"sendRequest",value:(o=t(r().mark((function e(t){var n,i,a,o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={"Content-Type":"multipart/form-data"},o={image:t},e.next=4,ei.getInstance().post(this.endPoint,o,{headers:a});case 4:return s=e.sent,e.abrupt("return",null==s||null===(n=s.data)||void 0===n||null===(i=n.uploaded)||void 0===i?void 0:i.entities[0]);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"setImageDimensions",value:(a=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadImage(t.url);case 2:return n=e.sent,t.width=n.width,t.height=n.height,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"loadImage",value:(i=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){return e(r)},r.onerror=function(){return n(new Error("Failed to load image"))},r.src=t})));case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"removeImage",value:(n=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ei.getInstance().delete("".concat(this.endPoint,"?upload_id=").concat(t));case 3:return e.abrupt("return",!0);case 6:e.prev=6,e.t0=e.catch(0),qe.qL.error("Failed to remove image: ".concat(e.t0));case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e){return n.apply(this,arguments)})}]),f}(fd);function Ad(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Od=function(e){(0,g.Z)(i,e);var n=Ad(i);function i(){return(0,u.Z)(this,i),n.apply(this,arguments)}return(0,c.Z)(i,[{key:"get",value:function(){var e=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.reject("Please use 'getImage' function."));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getImage",value:function(e,t,n){var r,i,a,s,u,c,l=o(P.sceneManager().findNodesOfType(Pc.TypeRTTI,(function(t){return t.getSceneObjectId()===e||t.getObjectUUID()===e})),1)[0];if(!l)throw new Error("Unable to find product node.");var h=l.getComponent("attributeManager");if(!h)throw new Error("Unable to retrieve attribute manager component.");var f=h._getAttributeController(t);if(!f)throw new Error("Unable to find attribute.");if(!f.isDerivedTypeOf(nh.TypeRTTI))throw new Error("Attribute is not compatible with palletization feature. Only svg attributes are supported.");var p=f.getPalletizationContext(n);if(!p)throw new Error("No palletization context available for given object.");return{src:null!==(r=null===(i=p.canvas)||void 0===i?void 0:i.toDataURL())&&void 0!==r?r:"",width:null!==(a=null===(s=p.canvas)||void 0===s?void 0:s.width)&&void 0!==a?a:0,height:null!==(u=null===(c=p.canvas)||void 0===c?void 0:c.height)&&void 0!==u?u:0}}}]),i}(fd),Dd=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mAppViewer",void 0),this.mAppViewer=t}var n,i,a,o,s,p,m,d,y,g,b,M,k,_,x,T,w,R,Z,S,C,I,E,A,O,D,B,F,L,N,j,z,U,V,H,G,q,W,Y,K,X,$,Q,J,ee,te,ne,re,ie;return(0,c.Z)(e,[{key:"init",value:function(){var e=this;window.expivi.getCataloguePresentation=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.Ft.resolveUuidOrId(n),t.abrupt("return",e.getCataloguePresentation(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.getService=function(){var n=t(r().mark((function t(n){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}throw new Error("Invalid service name.");case 2:return t.abrupt("return",e.resolveService(n));case 3:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.managers.resolveMaterialGroups=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.Ft.resolveUuidOrId(n),t.abrupt("return",e.resolveMaterialGroups(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.managers.resolveMaterialGroupManager=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.Ft.resolveUuidOrId(n),t.abrupt("return",e.resolveMaterialGroupManagerByProductId(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.managers.resolveOffsetGroups=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.Ft.resolveUuidOrId(n),t.abrupt("return",e.resolveOffsetGroups(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.managers.resolveMaterials=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.Ft.resolveUuidOrId(n),t.abrupt("return",e.resolveMaterials(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.managers.resolveMaterialManager=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.Ft.resolveUuidOrId(n),t.abrupt("return",e.resolveMaterialManager(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.managers.resolveTextures=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.Ft.resolveUuidOrId(n),t.abrupt("return",e.resolveTextures(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.resolveSvgElementBoundaries=function(){var n=t(r().mark((function t(n,i,a){var o,s,u;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=f.Ft.resolveInt(n),Number.isFinite(o)){t.next=3;break}throw new Error("Invalid attribute id.");case 3:if(s=i){t.next=6;break}throw new Error("Invalid element id.");case 6:return u=f.Ft.resolveUuidOrId(a),t.abrupt("return",e.resolveSvgElementBoundaries(o,s,u));case 8:case"end":return t.stop()}}),t)})));return function(e,t,r){return n.apply(this,arguments)}}(),window.expivi.getAttributeById=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=f.Ft.resolveInt(n),Number.isFinite(i)){t.next=3;break}throw new Error("Invalid attribute id.");case 3:return t.abrupt("return",e.getAttributeById(i));case 4:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.getProductAttributes=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.Ft.resolveUuidOrId(n),t.abrupt("return",e.getProductAttributes(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.getMatgroupOptions=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=f.Ft.resolveInt(n),Number.isFinite(i)){t.next=3;break}throw new Error("Invalid attribute id.");case 3:return t.abrupt("return",e.getMatgroupOptions(i));case 4:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.getColorOptions=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=f.Ft.resolveInt(n),Number.isFinite(i)){t.next=3;break}throw new Error("Invalid attribute id.");case 3:return t.abrupt("return",e.getColorOptions(i));case 4:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.getQuestionOptions=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=f.Ft.resolveInt(n),Number.isFinite(i)){t.next=3;break}throw new Error("Invalid attribute id.");case 3:return t.abrupt("return",e.getQuestionOptions(i));case 4:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.setProductAttribute=function(){var n=t(r().mark((function t(n,i,a){var o,s,u;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=f.Ft.resolveInt(n),s=i,u=f.Ft.resolveUuidOrId(a),Number.isFinite(o)){t.next=5;break}throw new Error("Invalid attribute id.");case 5:return t.abrupt("return",e.setProductAttribute(o,s,u));case 6:case"end":return t.stop()}}),t)})));return function(e,t,r){return n.apply(this,arguments)}}(),window.expivi.setProductAttributeNamed=function(){var n=t(r().mark((function t(n,i,a){var o,s,u;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=String(n),s=i,u=f.Ft.resolveUuidOrId(a),n&&0!==o.length){t.next=5;break}throw new Error("Invalid attribute name.");case 5:return t.abrupt("return",e.setProductAttributeNamed(o,s,u));case 6:case"end":return t.stop()}}),t)})));return function(e,t,r){return n.apply(this,arguments)}}(),window.expivi.setProductAttributeByKey=function(){var n=t(r().mark((function t(n,i,a){var o,s,u;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=String(n),s=i,u=f.Ft.resolveUuidOrId(a),n&&0!==o.length){t.next=5;break}throw new Error("Invalid attribute name.");case 5:return t.abrupt("return",e.setProductAttributeByKey(o,s,u));case 6:case"end":return t.stop()}}),t)})));return function(e,t,r){return n.apply(this,arguments)}}(),window.expivi.resetProductAttribute=function(){var n=t(r().mark((function t(n,i){var a,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=f.Ft.resolveInt(n),o=f.Ft.resolveUuidOrId(i),Number.isFinite(a)){t.next=4;break}throw new Error("Invalid attribute id.");case 4:return t.abrupt("return",e.resetProductAttribute(a,o));case 5:case"end":return t.stop()}}),t)})));return function(e,t){return n.apply(this,arguments)}}(),window.expivi.getActiveMaterial=function(){var n=t(r().mark((function t(n,i){var a,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=f.Ft.resolveInt(n),o=f.Ft.resolveUuidOrId(i),a){t.next=4;break}throw new Error("Invalid material group id.");case 4:return t.abrupt("return",e.getActiveMaterial(a,o));case 5:case"end":return t.stop()}}),t)})));return function(e,t){return n.apply(this,arguments)}}(),window.expivi.setActiveMaterial=function(){var n=t(r().mark((function t(n,i,a){var o,s,u;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=f.Ft.resolveInt(n),s=f.Ft.resolveInt(i),u=f.Ft.resolveUuidOrId(a),o&&s){t.next=5;break}throw new Error("Invalid material group id or reference id.");case 5:return t.abrupt("return",e.setActiveMaterial(o,s,u));case 6:case"end":return t.stop()}}),t)})));return function(e,t,r){return n.apply(this,arguments)}}(),window.expivi.applyActiveMaterial=function(){var n=t(r().mark((function t(n,i,a){var o,s,u;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=f.Ft.resolveInt(n),s=f.Ft.resolveInt(i),u=f.Ft.resolveUuidOrId(a),o&&s){t.next=5;break}throw new Error("Invalid material group id or material id.");case 5:return t.abrupt("return",e.applyActiveMaterial(o,s,u));case 6:case"end":return t.stop()}}),t)})));return function(e,t,r){return n.apply(this,arguments)}}(),window.expivi.getScreenshot=function(){var n=t(r().mark((function t(n,i,a,o,s){var u,c,l,h,p;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=f.Ft.resolveInt(n),c=f.Ft.resolveInt(i),l=a||Ii.ACTIVE_CAMERA,h=String(o),p=s,t.abrupt("return",e.mAppViewer.requestScreenshot(u,c,l,h,p));case 6:case"end":return t.stop()}}),t)})));return function(e,t,r,i,a){return n.apply(this,arguments)}}(),window.expivi.registerPriceCalculator=function(){var n=t(r().mark((function t(n,i){var a,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n,o=f.Ft.resolveUuidOrId(i),a){t.next=4;break}throw new Error("Invalid price calculator");case 4:return t.abrupt("return",e.registerPriceCalculator(a,o));case 5:case"end":return t.stop()}}),t)})));return function(e,t){return n.apply(this,arguments)}}(),window.expivi.getPrice=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.Ft.resolveUuidOrId(n),t.abrupt("return",e.getPrice(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.getAllPrices=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.Ft.resolveUuidOrId(n),t.abrupt("return",e.getAllPrices(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.getSupportedLocales=t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.requestSupportedLocales());case 1:case"end":return t.stop()}}),t)}))),window.expivi.setNodeProperty=function(){var n=t(r().mark((function t(n,i){var a,o,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=String(n),i){t.next=3;break}throw new Error("Invalid node property.");case 3:if(o=String(i.name),s=i.value,n&&0!==a.length){t.next=7;break}throw new Error("Invalid node name.");case 7:return t.abrupt("return",e.setNodeProperty(a,o,s));case 8:case"end":return t.stop()}}),t)})));return function(e,t){return n.apply(this,arguments)}}(),window.expivi.getSceneObj=t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.getSceneObj());case 1:case"end":return t.stop()}}),t)}))),window.expivi.getActiveCamera=t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.getActiveCamera());case 1:case"end":return t.stop()}}),t)}))),window.expivi.changeCameraZoom=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==(i=f.Ft.resolveInt(n))){t.next=3;break}throw new Error("Invalid zoom");case 3:return t.abrupt("return",e.changeCameraZoom(i));case 4:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.saveConfiguration=function(){var n=t(r().mark((function t(n,i,a,o,s){var u,c,l,h,p;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return u=f.Ft.resolveInt(n),c=f.Ft.resolveInt(i),l=a||Ii.ACTIVE_CAMERA,h=String(o),p=s,t.abrupt("return",e.mAppViewer.saveConfiguration(u,c,l,h,p));case 6:case"end":return t.stop()}}),t)})));return function(e,t,r,i,a){return n.apply(this,arguments)}}(),window.expivi.loadConfiguration=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n){t.next=3;break}throw new Error("Invalid configuration.");case 3:return t.abrupt("return",e.mAppViewer.loadConfiguration(i));case 4:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.loadPreset=function(){var n=t(r().mark((function t(n,i){var a,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=f.Ft.resolveUuidOrId(n),o=String(i),i&&0!==o.length){t.next=4;break}throw new Error("Invalid preset id.");case 4:return t.abrupt("return",e.loadPreset(a,o));case 5:case"end":return t.stop()}}),t)})));return function(e,t){return n.apply(this,arguments)}}(),window.expivi.selectProductNode=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.Ft.resolveUuidOrId(n),t.abrupt("return",e.selectProductNode(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.deselect=t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.deselect());case 1:case"end":return t.stop()}}),t)}))),window.expivi.autoRotateYAxis=function(){var n=t(r().mark((function t(n,i,a,o){var s,u,c,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=f.Ft.resolveUuidOrId(n),u=Boolean(i),c=f.Ft.resolveInt(a),l=f.Ft.resolveInt(o),t.abrupt("return",e.autoRotationYAxis(s,u,c,l));case 5:case"end":return t.stop()}}),t)})));return function(e,t,r,i){return n.apply(this,arguments)}}(),window.expivi.deleteNode=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.Ft.resolveUuidOrId(n),t.abrupt("return",e.deleteNode(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.resolveProductNodes=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=Boolean(n),t.abrupt("return",e.resolveProductNodes(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.getCatalogueProducts=function(){var n=t(r().mark((function t(n,i,a,o){var s,u;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=f.Ft.resolveInt(n),u=f.Ft.resolveInt(i),t.abrupt("return",e.getCatalogueProducts(s,u,a,o));case 3:case"end":return t.stop()}}),t)})));return function(e,t,r,i){return n.apply(this,arguments)}}(),window.expivi.getCatalogueProductById=function(){var n=t(r().mark((function t(n,i){var a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=f.Ft.resolveInt(n)){t.next=3;break}throw new Error("Invalid product id.");case 3:return t.abrupt("return",e.getCatalogueProductById(a,i));case 4:case"end":return t.stop()}}),t)})));return function(e,t){return n.apply(this,arguments)}}(),window.expivi.usesCatalogueBrowser=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.Ft.resolveUuidOrId(n),t.abrupt("return",e.usesCatalogueBrowser(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.getCameraTransform=t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.getCameraTransform());case 1:case"end":return t.stop()}}),t)}))),window.expivi.setCameraTransform=function(){var n=t(r().mark((function t(n,i){var a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n){t.next=3;break}throw new Error("Invalid transform.");case 3:return t.abrupt("return",e.setCameraTransform(a,i));case 4:case"end":return t.stop()}}),t)})));return function(e,t){return n.apply(this,arguments)}}(),window.expivi.addProduct=function(){var n=t(r().mark((function t(n,i,a){var o,s,u;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=f.Ft.resolveInt(n),s=i,u=a,o){t.next=5;break}throw new Error("Invalid product id.");case 5:return t.abrupt("return",e.addProduct(o,s,u));case 6:case"end":return t.stop()}}),t)})));return function(e,t,r){return n.apply(this,arguments)}}(),window.expivi.moveProduct=function(){var n=t(r().mark((function t(n,i){var a,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=f.Ft.resolveUuidOrId(n),o=i){t.next=4;break}throw new Error("Invalid transform.");case 4:return t.abrupt("return",e.moveProduct(a,o));case 5:case"end":return t.stop()}}),t)})));return function(e,t){return n.apply(this,arguments)}}(),window.expivi.removeProduct=function(){var n=t(r().mark((function t(n){var i;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.Ft.resolveUuidOrId(n),t.abrupt("return",e.removeProduct(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),window.expivi.getCategories=function(){var e=t(r().mark((function e(t,n,i){var a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=f.Ft.resolveInt(t),o=f.Ft.resolveInt(n),e.abrupt("return",Td.getInstance().resolveCategories(a,o,[],i));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),window.expivi._dispatch=function(){var n=t(r().mark((function t(n,i,a){var o,s,u;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=String(n),s=i,u=f.Ft.resolveUuidOrId(a),n&&0!==o.length){t.next=5;break}throw new Error("Invalid type");case 5:return t.abrupt("return",e.dispatch(o,s,u));case 6:case"end":return t.stop()}}),t)})));return function(e,t,r){return n.apply(this,arguments)}}()}},{key:"resolveService",value:(ie=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=n.mAppViewer.getServices();if(i.has(t))e(i.get(t));else{var a={image_library:function(){return new md},media:function(){return new vd},diagnostic:function(){return new gd},hooks:function(){return xd.getInstance()},image_uploader:function(){return new Ed(n.mAppViewer.mOptions.uploadURL)},palletization:function(){return new Od}}[t]();a?(i.set(t,a),e(a)):r("Unknown service.")}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return ie.apply(this,arguments)})},{key:"resolveMaterialGroups",value:(re=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=n.findProductNode(t);if(!i)return r("product node not found");i.getComponent("materialGroupManager").resolveMaterialGroups().pipe(sn(1)).subscribe((function(t){e(t.getGroups())}),(function(e){r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return re.apply(this,arguments)})},{key:"resolveMaterialGroupManagerByProductId",value:(ne=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.findProductNode(t)){e.next=3;break}throw new Error("Could not find product node");case 3:return e.abrupt("return",this.resolveMaterialGroupManager(n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return ne.apply(this,arguments)})},{key:"resolveOffsetGroups",value:(te=t(r().mark((function e(t){var n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolveConfigurableNode(t);case 2:if(n=e.sent){e.next=5;break}throw new Error("Failed to get configurable node");case 5:return e.next=7,n.resolveSceneOffsetManager();case 7:return i=e.sent,e.abrupt("return",i.getOffsets());case 9:case"end":return e.stop()}}),e,this)}))),function(e){return te.apply(this,arguments)})},{key:"resolveMaterials",value:(ee=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=n.findProductNode(t);if(!i)return r("Could not find product node");var a=i.getValue("product_id");Ko.getInstance().resolveBootstrapData(a).pipe(sn(1)).subscribe((function(t){var n=v.getItems(t.getMaterials()),r={};n.forEach((function(e){r[e.id]=e})),e(r)}),(function(e){r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return ee.apply(this,arguments)})},{key:"resolveMaterialManager",value:(J=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){return n.findProductNode(t)?e(tc.getManager(Qu.MaterialManager)):r("Could not find product node")})));case 1:case"end":return e.stop()}}),e)}))),function(e){return J.apply(this,arguments)})},{key:"resolveTextures",value:(Q=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=n.findProductNode(t);if(!i)return r("Could not find product node");var a=i.getValue("product_id");Ko.getInstance().resolveBootstrapData(a).pipe(sn(1)).subscribe((function(t){var n=v.getItems(t.getMedia()),r={};n.forEach((function(e){r[e.id]=e})),e(r)}),(function(e){r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return Q.apply(this,arguments)})},{key:"resolveSvgElementBoundaries",value:($=t(r().mark((function e(t,n,i){var a,o,s,u,c,l,h,f;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.findProductNode(i)){e.next=3;break}throw new Error("Could not find product node");case 3:if(o=a.getComponent("attributeManager")){e.next=6;break}throw new Error("Cound not find attribute manager");case 6:return e.next=8,o.resolveAttributeManager().toPromise();case 8:if(s=e.sent,u=s.getAttributeController(t)){e.next=12;break}throw new Error("Could not resolve attribute controller");case 12:if(u instanceof nh){e.next=14;break}throw new Error("Attribute controller is not an SVG Canvas attribute controller");case 14:if(c=u.getValue()){e.next=17;break}throw new Error("Could not resolve attribute value");case 17:if("number"==typeof(l=c.print_ready_file_id)){e.next=20;break}throw new Error("Could not resolve print-ready file id");case 20:return e.next=22,u.resolveSvgTextureController(l);case 22:return h=e.sent,e.next=25,h.getBoundaries(n);case 25:if(f=e.sent){e.next=28;break}throw new Error("Could not resolve boundary for element");case 28:return e.abrupt("return",f);case 29:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return $.apply(this,arguments)})},{key:"getAttributeById",value:(X=t(r().mark((function e(t){var n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getProductAttributes();case 2:if(n=e.sent){e.next=5;break}throw new Error("Invalid product for retrieving attributes.");case 5:if(i=n.find((function(e){return e.id===t}))){e.next=8;break}throw new Error("Attribute not found on product.");case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return X.apply(this,arguments)})},{key:"getProductAttributes",value:(K=t(r().mark((function e(t){var n,i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.findProductNode(t)){e.next=3;break}throw new Error("Could not find product node");case 3:return e.next=5,this.resolveAttributeManager(n);case 5:if(i=e.sent,a=i.getAttributes(),!xd.getInstance().hasHook("product-attributes")){e.next=11;break}return e.next=10,xd.getInstance().executeHook("product-attributes",a);case 10:a=e.sent;case 11:return e.abrupt("return",a);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return K.apply(this,arguments)})},{key:"getMatgroupOptions",value:(Y=t(r().mark((function e(t){var n,i,a,o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAttributeById(t);case 2:if((n=e.sent)&&"matgroup"===n.type){e.next=5;break}throw new Error("Material group attribute not found on product.");case 5:if((i=n.attribute_values)&&0!==i.length){e.next=8;break}throw new Error("Material group attribute not found on product.");case 8:if(a=i[0].attribute_value_valuable){e.next=11;break}throw new Error("Material group attribute not found on product.");case 11:if(o=a.material_group){e.next=14;break}throw new Error("Material group attribute not found on product.");case 14:if(s=o.materials){e.next=17;break}throw new Error("Material group attribute not found on product.");case 17:return e.abrupt("return",s);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"getColorOptions",value:(W=t(r().mark((function e(t){var n,i,a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAttributeById(t);case 2:if((n=e.sent)&&"color"===n.type){e.next=5;break}throw new Error("Color attribute not found on product.");case 5:if((i=n.attribute_values)&&0!==i.length){e.next=8;break}throw new Error("Color attribute not found on product.");case 8:if(a=i[0].attribute_value_valuable){e.next=11;break}throw new Error("Color attribute not found on product.");case 11:if(o=a.colors){e.next=14;break}throw new Error("Color attribute not found on product.");case 14:return e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return W.apply(this,arguments)})},{key:"getQuestionOptions",value:(q=t(r().mark((function e(t){var n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAttributeById(t);case 2:if((n=e.sent)&&"question"===n.type){e.next=5;break}throw new Error("Question attribute not found on product.");case 5:if(i=n.attribute_values){e.next=8;break}throw new Error("Question attribute not found on product.");case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"setProductAttribute",value:(G=t(r().mark((function e(t,n,i){var a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.findProductNode(i)){e.next=3;break}throw new Error("Could not find product node");case 3:return e.next=5,this.resolveAttributeManager(a);case 5:return o=e.sent,e.next=8,o.setValue(t,n,{emitEvent:!0,rebuild:!0});case 8:return e.abrupt("return",o.getAttribute(t));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return G.apply(this,arguments)})},{key:"setProductAttributeNamed",value:(H=t(r().mark((function e(t,n,i){var a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.findProductNode(i)){e.next=3;break}throw new Error("Could not find product node");case 3:return e.next=5,this.resolveAttributeManager(a);case 5:return o=e.sent,e.next=8,o.setValueByName(t,n,{emitEvent:!0,rebuild:!0});case 8:return e.abrupt("return",o.getValueByName(t));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return H.apply(this,arguments)})},{key:"setProductAttributeByKey",value:(V=t(r().mark((function e(t,n,i){var a,o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=String(t),t&&0!==a.length){e.next=3;break}throw new Error("Invalid attribute key.");case 3:if(o=this.findProductNode(i)){e.next=6;break}throw new Error("Could not find product node");case 6:return e.next=8,this.resolveAttributeManager(o);case 8:return(s=e.sent).setValueByKey(a,n,{emitEvent:!0,rebuild:!0}),e.abrupt("return",s.getValueByKey(a));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return V.apply(this,arguments)})},{key:"resetProductAttribute",value:(U=t(r().mark((function e(t,n){var i,a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=f.Ft.resolveInt(t),Number.isFinite(i)){e.next=3;break}throw new Error("Invalid attribute id.");case 3:if(a=this.findProductNode(n)){e.next=6;break}throw new Error("Could not find product node");case 6:return e.next=8,this.resolveAttributeManager(a);case 8:return(o=e.sent).resetValue(t),e.abrupt("return",o.getAttribute(t));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return U.apply(this,arguments)})},{key:"getActiveMaterial",value:(z=t(r().mark((function e(t,n){var i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.findProductNode(n)){e.next=3;break}throw new Error("Could not find product node");case 3:return e.next=5,this.resolveMaterialGroupManager(i);case 5:return a=e.sent,e.abrupt("return",a.getActiveRefId(t));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return z.apply(this,arguments)})},{key:"setActiveMaterial",value:(j=t(r().mark((function e(t,n,i){var a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.findProductNode(i)){e.next=3;break}throw new Error("Could not find product node");case 3:return e.next=5,this.resolveMaterialGroupManager(a);case 5:return(o=e.sent).setActiveMaterial(t,n),e.abrupt("return",o.getActiveRefId(t));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return j.apply(this,arguments)})},{key:"applyActiveMaterial",value:(N=t(r().mark((function e(t,n,i){var a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.findProductNode(i)){e.next=3;break}throw new Error("Could not find product node");case 3:return e.next=5,this.resolveMaterialGroupManager(a);case 5:return(o=e.sent).applyActiveMaterial(t,-1,n),e.abrupt("return",o.getActiveRefId(t));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return N.apply(this,arguments)})},{key:"registerPriceCalculator",value:(L=t(r().mark((function e(t,n){var i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.findProductNode(n)){e.next=3;break}throw new Error("Could not find product node");case 3:return e.next=5,this.resolvePriceManager(i);case 5:e.sent.registerPriceCalculator(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return L.apply(this,arguments)})},{key:"getPrice",value:(F=t(r().mark((function e(t){var n,i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.findProductNode(t)){e.next=3;break}throw new Error("Could not find product node");case 3:return e.next=5,this.resolvePriceManager(n);case 5:return i=e.sent,qe.qL.print("calculate price with manager: ",i),e.next=9,i.requestPrice();case 9:return a=e.sent,e.abrupt("return",a.totals.base);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"getAllPrices",value:(B=t(r().mark((function e(t){var n,i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.findProductNode(t)){e.next=3;break}throw new Error("Could not find product node");case 3:return e.next=5,this.resolvePriceManager(n);case 5:return i=e.sent,qe.qL.print("calculate price with manager: ",i),e.next=9,i.requestPrice();case 9:return a=e.sent,e.abrupt("return",a.totals);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"requestSupportedLocales",value:(D=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){od.getInstance().getSupportedLocales().then((function(t){e(t)})).catch((function(e){t(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return D.apply(this,arguments)})},{key:"setNodeProperty",value:(O=t(r().mark((function e(t,n,i){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){try{var a=P.sceneManager().findNodesOfType(Wi.TypeRTTI,(function(e){return e.getValue("name")===t}));a.forEach((function(e){e.setValue(n,i)})),e(a.length)}catch(e){r(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,n){return O.apply(this,arguments)})},{key:"getSceneObj",value:(A=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){t("This API is obsolete.")})));case 1:case"end":return e.stop()}}),e)}))),function(){return A.apply(this,arguments)})},{key:"getActiveCamera",value:(E=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){try{var n=P.sceneManager().findNodesOfType(ga.TypeRTTI);if(0===n.length)return t("No cameras in scene");var r=n[0],i=P.sceneManager().getActiveCameraId();if(i)for(var a=0;a<n.length;a++)if(n[a].getSceneObjectId()===i){r=n[a];break}e(r.serialize(!1))}catch(e){t(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return E.apply(this,arguments)})},{key:"changeCameraZoom",value:(I=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){try{var r=P.sceneManager().getActiveCamera();if(!r)return n("No active camera in scene");var i=r.transform.position.clone().sub(r.target).normalize(),a=r.transform.position.distanceTo(r.target),o=r.getValue("min_zoom")||.001,s=r.getValue("max_zoom"),u=Math.min(s,Math.max(o,a+t));r.transform.position.copy(r.target.clone().addScaledVector(i,u)),r.transform.updateMatrix(),r.markNeedsRenderUpdate(),P.eventBus().dispatch(new Di(Ei.RequestFrame)),e(u)}catch(e){n(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return I.apply(this,arguments)})},{key:"loadPreset",value:(C=t(r().mark((function e(t,n){var i,a,o,s,u=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.findProductNode(t)){e.next=3;break}throw new Error("Could not find product node");case 3:return P.eventBus().dispatch(new Di(Ei.LoadConfigurationStarted)),e.next=6,this.mAppViewer.resolvePreset(n);case 6:if((a=e.sent)&&a.configuration){e.next=10;break}throw P.eventBus().dispatch(new Di(Ei.LoadConfigurationFinished)),new Error("preset not loaded");case 10:if(o=Number(i.getValue("product_id")),s=a.configuration.configured_products.find((function(e){return Number(e.catalogue_id)===o}))){e.next=15;break}throw P.eventBus().dispatch(new Di(Ei.LoadConfigurationFinished)),new Error("preset doesn't container catalogue id");case 15:return s.configuration||(s.configuration={materials:{},attributes:[]}),s.configuration.attributes=s.configuration.attributes.filter((function(e){return!e.excluded_autoload})),P.stateRegistery().dispatch("reconfigure",!0),e.prev=18,e.next=21,(new Et).load(i,s,(function(e){u.mAppViewer.propagateEvent("progress_reconfigure",Math.floor(100*e))}));case 21:P.eventBus().dispatch(new Di(Ei.LoadConfigurationFinished)),e.next=30;break;case 24:throw e.prev=24,e.t0=e.catch(18),qe.qL.error("Could not parse configuration of preset.",e.t0),P.stateRegistery().dispatch("reconfigure",!1),P.eventBus().dispatch(new Di(Ei.LoadConfigurationFinished)),e.t0;case 30:case"end":return e.stop()}}),e,this,[[18,24]])}))),function(e,t){return C.apply(this,arguments)})},{key:"selectProductNode",value:(S=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if(void 0===t)return n.mAppViewer.deselect(),e(void 0);var i=n.findProductNode(t);if(!i)return r("Could not find product node");n.mAppViewer.select(i),e(i)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return S.apply(this,arguments)})},{key:"deselect",value:(Z=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){e(t.mAppViewer.deselect())})));case 1:case"end":return e.stop()}}),e)}))),function(){return Z.apply(this,arguments)})},{key:"autoRotationYAxis",value:(R=t(r().mark((function e(t){var n,i,a,o=this,s=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(s.length>1&&void 0!==s[1])||s[1],i=s.length>2&&void 0!==s[2]?s[2]:1,a=s.length>3&&void 0!==s[3]?s[3]:360,e.abrupt("return",new Promise((function(e,r){var s=o.findProductNode(t);if(!s)return r("Could not find product node");o.mAppViewer.addPlayRotation(s,n,i,a),e(s)})));case 4:case"end":return e.stop()}}),e)}))),function(e){return R.apply(this,arguments)})},{key:"deleteNode",value:(w=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=n.findProductNode(t);if(!i)return r("Could not find product node");var a=P.sceneManager().getRootProductNode();if(i.getSceneObjectId()===a.getSceneObjectId())return r("Unable to delete product node as it is root node.");n.mAppViewer.deselect(),P.sceneManager().removeNode(i),e(i)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return w.apply(this,arguments)})},{key:"resolveProductNodes",value:(T=t(r().mark((function e(){var t,n=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]&&n[0],e.abrupt("return",new Promise((function(e){var n=P.sceneManager().findNodesOfType(Pc.TypeRTTI);if(t)return e(n);var r=[];n.forEach((function(e){var t=e.findParentOfType(Ep.TypeRTTI);t&&!t.isViewVisible()||r.push(e)})),e(r)})));case 2:case"end":return e.stop()}}),e)}))),function(){return T.apply(this,arguments)})},{key:"getCatalogueProducts",value:(x=t(r().mark((function e(t,n,i,a){var o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=null===(o=P.settingsManager())||void 0===o?void 0:o.getSceneSettingsRendererType(),e.abrupt("return",ad.getInstance().resolveProducts(t,n,["categories"],i,a,s));case 2:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return x.apply(this,arguments)})},{key:"getCatalogueProductById",value:(_=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ad.getInstance().resolveProduct(t,n));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return _.apply(this,arguments)})},{key:"getCataloguePresentation",value:(k=t(r().mark((function e(t){var n,i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.findProductNode(t)){e.next=3;break}throw new Error("Could not find product node");case 3:return e.next=5,this.resolveCatalogueSettingsManager(n);case 5:return i=e.sent,e.next=8,i.resolveSettings().toPromise();case 8:return a=e.sent,e.abrupt("return",a.getProductPresentationSettings());case 10:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"usesCatalogueBrowser",value:(M=t(r().mark((function e(t){var n,i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.findProductNode(t)){e.next=3;break}throw new Error("Could not find product node");case 3:return e.next=5,this.resolveCatalogueSettingsManager(n);case 5:return i=e.sent,e.next=8,i.resolveSettings().toPromise();case 8:return a=e.sent,e.abrupt("return",!0===a.getCatalogueMeta().catalogBrowser);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"getCameraTransform",value:(b=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){var n=P.sceneManager().getActiveCamera();if(!n)return t("Active camera not found.");n.updateMatrixLocal(!0),n.updateMatrixWorld(),e(n.transform.clone())})));case 1:case"end":return e.stop()}}),e)}))),function(){return b.apply(this,arguments)})},{key:"setCameraTransform",value:(g=t(r().mark((function e(t,n){var i=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=P.sceneManager().getActiveCamera();if(t.position&&r.transform.position.copy(new Bi(t.position.x,t.position.y,t.position.z)),t.rotation?r.transform.rotation.copy(new Li(t.rotation.x,t.rotation.y,t.rotation.z)):t.quaternion&&r.transform.quaternion.copy(new Pi(t.quaternion.x,t.quaternion.y,t.quaternion.z,t.quaternion.w)),t.scale&&r.transform.scale.copy(new Bi(t.scale.x,t.scale.y,t.scale.z)),n){var a=new Bi(n.x,n.y,n.z),o=i.mAppViewer.getClientViewer().getViewportRenderer().getComponent("controls");o&&o.isTypeName("ViewportControllerOrbitControls")&&o.updateTarget(a)}return r.markNeedsRenderUpdate(),e()})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return g.apply(this,arguments)})},{key:"addProduct",value:(y=t(r().mark((function e(t,n,i){var a,o,s,u,c;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null,!n||!n.presetId){e.next=7;break}return o=String(n.presetId),e.next=5,this.mAppViewer.resolvePreset(o);case 5:(s=e.sent)&&s.configuration&&(a=s.configuration.configured_products[0]);case 7:return i&&a&&(a=Object.assign(a,i)),(u=P.sceneManager().createObject("product",void 0,t,!0,a)).setValue("name","Product id:".concat(t)),(c=null==n?void 0:n.transform)&&(c.position&&u.transform.position.copy(new Bi(c.position.x,c.position.y,c.position.z)),c.rotation?u.transform.rotation.copy(new Li(c.rotation.x,c.rotation.y,c.rotation.z)):c.quaternion&&u.transform.quaternion.copy(new Pi(c.quaternion.x,c.quaternion.y,c.quaternion.z,c.quaternion.w)),c.scale&&u.transform.scale.copy(new Bi(c.scale.x,c.scale.y,c.scale.z))),i&&i.clipping_plane&&u.setValue("clipping_plane",i.clipping_plane),i&&i.place_holder&&u.setValue("place_holder",i.place_holder),P.commandManager().execute(new nd(u)),e.abrupt("return",u.getObjectUUID());case 16:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return y.apply(this,arguments)})},{key:"moveProduct",value:(d=t(r().mark((function e(t,n){var i=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=i.findProductNode(t);if(!r)throw new Error("Could not find product node.");if(n.position){var a=new Bi(Number(n.position.x),Number(n.position.y),Number(n.position.z));r.transform.position.copy(a)}if(n.rotation){var o=new Li(Number(n.rotation.x),Number(n.rotation.y),Number(n.rotation.z));r.transform.rotation.copy(o)}else if(n.quaternion){var s=new Pi(Number(n.quaternion.x),Number(n.quaternion.y),Number(n.quaternion.z),Number(n.quaternion.w));r.transform.quaternion.copy(s)}if(n.scale){var u=new Bi(Number(n.scale.x),Number(n.scale.y),Number(n.scale.z));r.transform.scale.copy(u)}r.transform.updateMatrix(),r.markNeedsRenderUpdate(),e()})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return d.apply(this,arguments)})},{key:"removeProduct",value:(m=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=n.findProductNode(t);if(!i)return r("Could not find product node");var a=P.sceneManager().getRootProductNode();if(i.getSceneObjectId()===a.getSceneObjectId())return r("Unable to delete product node as it is root node.");P.sceneManager().removeNode(i),e()})));case 1:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"dispatch",value:(p=t(r().mark((function e(t,n,i){var a=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var o=a.findProductNode(i);try{switch(t){case"client_ready":h.completePromise(a.mAppViewer.onClientReady()).then((function(){e()}),(function(e){r(e)}));break;case"question_changed":if(!n||Number.isNaN(n.option_id))return r("Invalid payload: ".concat(JSON.stringify(n)));var s=f.Ft.resolveInt(n.option_id),u=Boolean(n.visible),c=o?o.getSceneObjectId():void 0;P.eventBus().dispatch(new Di(Ei.ProductQuestionChanged,{question:s,visible:u,product_scene_id:c})),e();break;case"render_frame":window.setTimeout((function(){P.eventBus().dispatch(new Di(Ei.RequestFrame)),e()}),0);break;case"transformMode":var l=String(n);P.eventBus().dispatch(new Di(Ei.TransformModeChanged,l)),e();break;case"visibility":if(!o)return r("Could not find product node");switch(String(n.type)){case"lines":o.dispatchMessage(new Ve(n.visible,Ym.TypeRTTI));break;case"fire":o.dispatchMessage(new Ve(n.visible,Qm.TypeRTTI))}window.setTimeout((function(){P.eventBus().dispatch(new Di(Ei.RequestFrame)),e()}),0);break;case"drag":switch(String(n.type)){case"start":a.mAppViewer.getClientViewer().onItemDragStart(n.event);break;case"moved":a.mAppViewer.getClientViewer().onItemDragMove(n.event);break;case"end":a.mAppViewer.getClientViewer().onItemDragEnd(n.event)}window.setTimeout((function(){P.eventBus().dispatch(new Di(Ei.RequestFrame)),e()}),0);break;default:r("Unknown dispatch type: ".concat(t))}}catch(e){r(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,n){return p.apply(this,arguments)})},{key:"findProductNode",value:function(e){var t,n=f.Ft.resolveInt(e),r=f.Ft.resolveUuid(e);return void 0===r&&void 0===n?P.sceneManager().getRootProductNode():(P.sceneManager().findNodesOfType(Pc.TypeRTTI).every((function(e){return r&&e.getObjectUUID()===r?(t=e,!1):!(!r&&e.getSceneObjectId()===n)||(t=e,!1)})),t)}},{key:"resolveConfigurableNode",value:(s=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=n.findProductNode(t);if(!i)return r("Failed to get configurable node");i.onConfigurableNodeReady.pipe(sn(1)).subscribe((function(t){e(t)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"resolveAttributeManager",value:(o=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.getComponent("attributeManager").resolveAttributeManager().pipe(sn(1)).subscribe((function(t){e(t)}),(function(e){n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"resolveMaterialGroupManager",value:(a=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){t.getComponent("materialGroupManager").resolveMaterialGroups().pipe(sn(1)).subscribe((function(t){e(t)}),(function(e){n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"resolvePriceManager",value:(i=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){e(t.getComponent("priceManager"))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"resolveCatalogueSettingsManager",value:(n=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){e(t.getComponent("catalogueSettings"))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}]),e}();function Pd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Bd=function(e){(0,g.Z)(n,e);var t=Pd(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"lightTechnique",Ja.rectArea),(0,l.Z)((0,_.Z)(r),"mWidth",10),(0,l.Z)((0,_.Z)(r),"mHeight",10),r.mName="LightEntityRectArea",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"rectAreaLight"});return t.properties=Object.assign(t.properties,{light_width:this.mWidth,light_height:this.mHeight}),t}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"width":case"light_width":return this.mWidth=parseFloat(t),!0;case"height":case"light_height":return this.mHeight=parseFloat(t),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"width":case"light_width":return this.mWidth;case"height":case"light_height":return this.mHeight}return null}},{key:"width",get:function(){return this.mWidth},set:function(e){this.mWidth=e,this.markNeedsRenderUpdate()}},{key:"height",get:function(){return this.mHeight},set:function(e){this.mHeight=e,this.markNeedsRenderUpdate()}}]),n}(Uc);function Fd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Bd,"TypeRTTI",new k.r("LightEntityRectArea",Uc.TypeRTTI));var Ld=function(e){(0,g.Z)(n,e);var t=Fd(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.primitive_sphere),r.mName="PrimitiveEntitySphere",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"serialize",value:function(e){return Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"sphere"})}}]),n}(qm);function Nd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Ld,"TypeRTTI",new k.r("PrimitiveEntitySphere",qm.TypeRTTI));var jd=function(e){(0,g.Z)(n,e);var t=Nd(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.primitive_plane),r.mName="PrimitiveEntityPlane",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"serialize",value:function(e){return Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"plane"})}}]),n}(qm);function zd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(jd,"TypeRTTI",new k.r("PrimitiveEntityPlane",qm.TypeRTTI));var Ud=function(e){(0,g.Z)(n,e);var t=zd(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.primitive_box),r.mName="PrimitiveEntityBox",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"serialize",value:function(e){return Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"box"})}}]),n}(qm);function Vd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Ud,"TypeRTTI",new k.r("PrimitiveEntityBox",qm.TypeRTTI));var Hd=function(e){(0,g.Z)(n,e);var t=Vd(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.effect_water),r.mName="ShaderEntityWater",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"serialize",value:function(e){return Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"water"})}}]),n}(Xm);function Gd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Hd,"TypeRTTI",new k.r("ShaderEntityWater",Xm.TypeRTTI));var qd=function(e){(0,g.Z)(n,e);var t=Gd(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.effect_glare),(0,l.Z)((0,_.Z)(r),"mEdgesRebuild",!1),(0,l.Z)((0,_.Z)(r),"mEdges",4),(0,l.Z)((0,_.Z)(r),"mSize",1),(0,l.Z)((0,_.Z)(r),"mBlur",2),(0,l.Z)((0,_.Z)(r),"mExtension",0),(0,l.Z)((0,_.Z)(r),"mColor",so.White()),(0,l.Z)((0,_.Z)(r),"mFlareColor",so.White()),(0,l.Z)((0,_.Z)(r),"mAlpha",1),(0,l.Z)((0,_.Z)(r),"mAngle",1),r.mName="ShaderEntityGlare",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"edges":return this.mEdges=parseInt(t,10),this.markEdgesRebuild(),!0;case"size":return this.mSize=parseFloat(t),this.markEdgesRebuild(),!0;case"blur":return this.mBlur=parseFloat(t),!0;case"extension":return this.mExtension=parseFloat(t),!0;case"alpha":return this.mAlpha=parseFloat(t),!0;case"angle":return this.mAngle=parseFloat(t),!0;case"color":return t instanceof so?this.mColor.copy(t):this.mColor.set(t),!0;case"flare":case"flareColor":return t instanceof so?this.mFlareColor.copy(t):this.mFlareColor.set(t),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"edges":return this.mEdges;case"size":return this.mSize;case"blur":return this.mBlur;case"extension":return this.mExtension;case"alpha":return this.mAlpha;case"angle":return this.mAngle;case"color":return this.mColor;case"flare":case"flareColor":return this.mFlareColor}return null}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"glare"});return t.properties=Object.assign(t.properties,{edges:this.mEdges,size:this.mSize,blur:this.mBlur,extension:this.mExtension,alpha:this.mAlpha,angle:this.mAngle,color:this.mColor.getHexString(),flareColor:this.mFlareColor.getHexString()}),t}},{key:"edges",get:function(){return this.mEdges},set:function(e){this.mEdges=e,this.markNeedsRenderUpdate()}},{key:"size",get:function(){return this.mSize},set:function(e){this.mSize=e,this.markNeedsRenderUpdate()}},{key:"blur",get:function(){return this.mBlur},set:function(e){this.mBlur=e,this.markNeedsRenderUpdate()}},{key:"extension",get:function(){return this.mExtension},set:function(e){this.mExtension=e,this.markNeedsRenderUpdate()}},{key:"alpha",get:function(){return this.mAlpha},set:function(e){this.mAlpha=e,this.markNeedsRenderUpdate()}},{key:"angle",get:function(){return this.mAngle},set:function(e){this.mAngle=e,this.markNeedsRenderUpdate()}},{key:"color",get:function(){return this.mColor},set:function(e){this.mColor.copy(e),this.markNeedsRenderUpdate()}},{key:"flareColor",get:function(){return this.mFlareColor},set:function(e){this.mFlareColor.copy(e),this.markNeedsRenderUpdate()}},{key:"needsEdgesRebuild",value:function(){return this.mEdgesRebuild}},{key:"setNeedsEdgesRebuild",value:function(e){this.mEdgesRebuild=e,this.markNeedsRenderUpdate()}},{key:"markEdgesRebuild",value:function(){this.setNeedsEdgesRebuild(!0)}}]),n}(Xm);function Wd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(qd,"TypeRTTI",new k.r("ShaderEntityGlare",Xm.TypeRTTI));var Yd=function(e){(0,g.Z)(n,e);var t=Wd(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.effect_flare),r.mName="ShaderEntityFlare",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"serialize",value:function(e){return Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"flare"})}}]),n}(Xm);function Kd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Yd,"TypeRTTI",new k.r("ShaderEntityFlare",Xm.TypeRTTI));var Xd=function(e){(0,g.Z)(n,e);var t=Kd(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.effect_skycube),(0,l.Z)((0,_.Z)(r),"mTextureIds",{}),r.mName="ShaderEntitySkyCube",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"skycube_tex_0":return this.mTextureIds[0]=(0,p.isNullOrUndefined)(t)?null:parseInt(t,10),!0;case"skycube_tex_1":return this.mTextureIds[1]=(0,p.isNullOrUndefined)(t)?null:parseInt(t,10),!0;case"skycube_tex_2":return this.mTextureIds[2]=(0,p.isNullOrUndefined)(t)?null:parseInt(t,10),!0;case"skycube_tex_3":return this.mTextureIds[3]=(0,p.isNullOrUndefined)(t)?null:parseInt(t,10),!0;case"skycube_tex_4":return this.mTextureIds[4]=(0,p.isNullOrUndefined)(t)?null:parseInt(t,10),!0;case"skycube_tex_5":return this.mTextureIds[5]=(0,p.isNullOrUndefined)(t)?null:parseInt(t,10),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"skycube_tex_0":return this.mTextureIds[0];case"skycube_tex_1":return this.mTextureIds[1];case"skycube_tex_2":return this.mTextureIds[2];case"skycube_tex_3":return this.mTextureIds[3];case"skycube_tex_4":return this.mTextureIds[4];case"skycube_tex_5":return this.mTextureIds[5]}return null}},{key:"getTextureIds",value:function(){return this.mTextureIds}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"skycube"});return t.properties=Object.assign(t.properties,{skycube_tex_0:this.mTextureIds[0],skycube_tex_1:this.mTextureIds[1],skycube_tex_2:this.mTextureIds[2],skycube_tex_3:this.mTextureIds[3],skycube_tex_4:this.mTextureIds[4],skycube_tex_5:this.mTextureIds[5]}),t}}]),n}(Xm);function $d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Xd,"TypeRTTI",new k.r("ShaderEntitySkyCube",Xm.TypeRTTI));var Qd=function(e){(0,g.Z)(n,e);var t=$d(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.effect_skyequirect),(0,l.Z)((0,_.Z)(r),"mTextureId",void 0),r.mName="ShaderEntitySkyEquirect",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){return"skycube_tex_0"===e?(this.mTextureId=(0,p.isNullOrUndefined)(t)?null:parseInt(t,10),!0):Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);return null!==t?t:"skycube_tex_0"===e?this.mTextureId:null}},{key:"getTextureId",value:function(){return this.mTextureId}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"skyequirect"});return t.properties=Object.assign(t.properties,{skycube_tex_0:this.mTextureId}),t}}]),n}(Xm);function Jd(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Qd,"TypeRTTI",new k.r("ShaderEntitySkyEquirect",Xm.TypeRTTI));var ev,tv=function(e){(0,g.Z)(n,e);var t=Jd(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mTarget",new Bi(0,0,1)),(0,l.Z)((0,_.Z)(e),"mClippingPlaneUuid",void 0),e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"onDetached",value:function(e){Ni((0,M.Z)(n.prototype),"onDetached",this).call(this,e),this.detachClippingPlaneFromProduct()}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"position_x":case"position_y":case"position_z":case"position":this.updatePlane();break;case"target":return t instanceof Bi?this.mTarget.copy(t):Array.isArray(t)&&t.length>2&&this.mTarget.fromArray(t),this.updatePlane(),!0;case"clip_target_x":case"target_x":return this.mTarget.x=parseFloat(t),this.updatePlane(),!0;case"clip_target_y":case"target_y":return this.mTarget.y=parseFloat(t),this.updatePlane(),!0;case"clip_target_z":case"target_z":return this.mTarget.z=parseFloat(t),this.updatePlane(),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"target":return this.mTarget;case"target_x":return this.mTarget.x;case"target_y":return this.mTarget.y;case"target_z":return this.mTarget.z}return null}},{key:"detachClippingPlaneFromProduct",value:function(){if(this.mClippingPlaneUuid){var e=this.findParentOfType(Pc.TypeRTTI);if(e){var t=e.getComponent("clippingController");t&&(t.removeClippingPlane(this.mClippingPlaneUuid),delete this.mClippingPlaneUuid)}}}},{key:"updatePlane",value:function(){var e=this.findParentOfType(Pc.TypeRTTI);if(e){var t=e.getComponent("clippingController");if(t){var n=new Bi;this.transform.getWorldPosition(n);var r=this.getValue("target"),i=n.clone().sub(r);i.normalize(),this.mClippingPlaneUuid||(this.mClippingPlaneUuid=t.addClippingPlane(new _c)),t.setFromNormalAndCoplanarPoint(this.mClippingPlaneUuid,i,n)}}}},{key:"onBeforeSceneUpdate",value:function(e){Ni((0,M.Z)(n.prototype),"onBeforeSceneUpdate",this).call(this,e),this.updatePlane()}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"global_clipper"});return t.properties=Object.assign(t.properties,{clip_target_x:this.mTarget.x,clip_target_y:this.mTarget.y,clip_target_z:this.mTarget.z}),t}}]),n}(Ki);function nv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(tv,"TypeRTTI",new k.r("ClippingEntity",Ki.TypeRTTI)),function(e){e.RELATIVE="relative",e.FIXED="fixed",e.PROJECTION="projection"}(ev||(ev={}));var rv=function(e){(0,g.Z)(n,e);var t=nv(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"onEdit",void 0),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.draw_ui),(0,l.Z)((0,_.Z)(r),"mPositionType",ev.FIXED),(0,l.Z)((0,_.Z)(r),"mLocked",!1),(0,l.Z)((0,_.Z)(r),"mEditable",!1),r.mName="UIEntity",r.mLayers.enable(2),r.onEdit=new Ht,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"position_type":return t&&(this.mPositionType=t),!0;case"locked":return this.mLocked=(0,f.oA)(t),!0;case"editable":return this.mEditable=(0,f.oA)(t),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"position_type":return this.mPositionType;case"locked":return this.mLocked;case"editable":return this.mEditable}return null}},{key:"serialize",value:function(e){return Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{position_type:this.mPositionType?this.mPositionType:ev.FIXED,locked:this.mLocked})}},{key:"makeEditable",value:function(){this.mEditable=!0,this.markNeedsRenderUpdate()}},{key:"makeUnEditable",value:function(){this.mEditable=!1,this.markNeedsRenderUpdate()}},{key:"editable",get:function(){return this.mEditable}},{key:"locked",get:function(){return this.mLocked},set:function(e){this.mLocked=e,this.markNeedsRenderUpdate()}},{key:"positionType",get:function(){return this.mPositionType},set:function(e){this.mPositionType=e,this.markNeedsRenderUpdate()}}]),n}(Wa);function iv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(rv,"TypeRTTI",new k.r("UiEntity",Wa.TypeRTTI));var av=function(e){(0,g.Z)(n,e);var t=iv(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"mTitle",void 0),(0,l.Z)((0,_.Z)(r),"mMargin",5),(0,l.Z)((0,_.Z)(r),"mColor",new so("#f06")),(0,l.Z)((0,_.Z)(r),"mHoverColor",new so("#ca095e")),(0,l.Z)((0,_.Z)(r),"mFontSize",16),(0,l.Z)((0,_.Z)(r),"mTextColor",new so("000000")),r.mName="UiEntityButton",r.mTitle="Title",r.setValue("options",{}),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"color":return this.mColor.set(t),!0;case"hover":return this.mHoverColor.set(t),!0;case"textColor":return this.mTextColor.set(t),!0;case"fontSize":return this.mFontSize=parseInt(t,10),!0;case"margin":return this.mMargin=parseFloat(t),!0;case"title":return this.mTitle=t,!0;case"ui_options":case"options":try{var i=null;(i="string"==typeof t?JSON.parse(t):t).title&&(this.mTitle=i.title),void 0!==i.margin&&(this.mMargin=i.margin),void 0!==i.color&&this.mColor.set(i.color),void 0!==i.hover&&this.mHoverColor.set(i.hover),void 0!==i.fontSize&&(this.mFontSize=i.fontSize),void 0!==i.textColor&&this.mTextColor.set(i.textColor)}catch(e){return!1}return!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){switch(e){case"title":return this.mTitle;case"margin":return this.mMargin;case"color":return this.mColor;case"hover":return this.mHoverColor;case"textColor":return this.mTextColor;case"fontSize":return this.mFontSize;case"ui_options":case"options":return{title:this.mTitle,margin:this.mMargin,color:this.mColor.getHexString(),hover:this.mHoverColor.getHexString(),fontSize:this.mFontSize,textColor:this.mTextColor.getHexString()}}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}},{key:"serialize",value:function(e){var t={title:this.mTitle,margin:this.mMargin,color:this.mColor.getHexString(),hover:this.mHoverColor.getHexString(),fontSize:this.mFontSize,textColor:this.mTextColor.getHexString()};return Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"uix_button",ui_options:JSON.stringify(t)})}}]),n}(rv);function ov(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(av,"TypeRTTI",new k.r("UiEntityButton",rv.TypeRTTI));var sv=function(e){(0,g.Z)(n,e);var t=ov(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"mImageId",-1),(0,l.Z)((0,_.Z)(r),"mSize",new D(100,100)),r.mName="UiEntityImage",r.setValue("options",{}),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"image":case"image_id":return this.mImageId=(0,f.kE)(t)?parseInt(t,10):-1,!0;case"width":return this.mSize.x=parseFloat(t),!0;case"height":return this.mSize.y=parseFloat(t),!0;case"size":return t&&t instanceof D?this.mSize.copy(t):t instanceof Bi||t instanceof Dp?this.mSize.set(t.x,t.y):Array.isArray(t)&&t.length>1?this.mSize.fromArray(t):t&&!0===t.isVector2&&this.mSize.copy(t),!0;case"ui_options":case"options":try{var i=null;i="string"==typeof t?JSON.parse(t):t,i=Object.assign({image:-1,width:100,height:100},i),this.mImageId=i.image,this.mSize.copy(new D(i.width,i.height))}catch(e){return!1}return!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"image":case"image_id":return this.mImageId;case"size":return this.mSize;case"width":return this.mSize.x;case"height":return this.mSize.y;case"ui_options":case"options":return{image:this.mImageId,width:this.mSize.x,height:this.mSize.y}}return null}},{key:"serialize",value:function(e){var t={image:this.mImageId,width:this.mSize.x,height:this.mSize.y};return Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"uix_image",ui_options:JSON.stringify(t)})}},{key:"imageId",get:function(){return this.mImageId},set:function(e){this.mImageId=e,this.markNeedsRenderUpdate()}}]),n}(rv);function uv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(sv,"TypeRTTI",new k.r("UiEntityImage",rv.TypeRTTI));var cv=function(e){(0,g.Z)(n,e);var t=uv(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e)).mName="UiEntityTag",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"serialize",value:function(e){return Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"uix_tag"})}}]),n}(av);function lv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(cv,"TypeRTTI",new k.r("UiEntityTag",av.TypeRTTI));var hv=function(e){(0,g.Z)(n,e);var t=lv(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"mPanelColor",new so("#f06")),(0,l.Z)((0,_.Z)(r),"mLinkColor",new so("#00f")),(0,l.Z)((0,_.Z)(r),"mLinkHoverColor",new so("#0000a0")),(0,l.Z)((0,_.Z)(r),"mMargin",20),(0,l.Z)((0,_.Z)(r),"mSize",new D(200,200)),(0,l.Z)((0,_.Z)(r),"mHtmlText",""),r.mName="UiEntityText",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"text":case"htmlText":return this.mHtmlText=t,!0;case"panelColor":return this.mPanelColor.set(t),!0;case"linkColor":return this.mLinkColor.set(t),!0;case"linkHover":return this.mLinkHoverColor.set(t),!0;case"margin":return this.mMargin=parseInt(t,10),!0;case"width":return this.mSize.x=parseInt(t,10),!0;case"height":return this.mSize.y=parseInt(t,10),!0;case"size":return t&&t instanceof D?this.mSize.copy(t):t instanceof Bi||t instanceof Dp?this.mSize.set(t.x,t.y):Array.isArray(t)&&t.length>1?this.mSize.fromArray(t):t&&!0===t.isVector2&&this.mSize.copy(t),!0;case"ui_options":case"options":try{var i=null;(i="string"==typeof t?JSON.parse(t):t).text&&(this.mHtmlText=i.text),i.size&&i.size instanceof D?this.mSize.copy(i.size):(void 0!==i.width&&(this.mSize.x=i.width),void 0!==i.height&&(this.mSize.y=i.height)),void 0!==i.margin&&(this.mMargin=i.margin),void 0!==i.panelColor&&this.mPanelColor.set(i.panelColor),void 0!==i.linkColor&&this.mLinkColor.set(i.linkColor),void 0!==i.linkHover&&this.mLinkHoverColor.set(i.linkHover)}catch(e){return qe.qL.error("UiEntityText: Unable to parse options:",e),!1}return!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"htmlText":case"text":return this.mHtmlText;case"panelColor":return this.mPanelColor;case"linkColor":return this.mLinkColor;case"linkHover":return this.mLinkHoverColor;case"margin":return this.mMargin;case"ui_options":case"options":return{text:this.mHtmlText,panelColor:this.mPanelColor.getHexString(),linkColor:this.mLinkColor.getHexString(),linkHover:this.mLinkHoverColor.getHexString(),margin:this.mMargin,width:this.mSize.x,height:this.mSize.y};case"width":return this.mSize.x;case"height":return this.mSize.y;case"size":return this.mSize}return null}},{key:"serialize",value:function(e){var t={text:this.mHtmlText,panelColor:this.mPanelColor.getHexString(),linkColor:this.mLinkColor.getHexString(),linkHover:this.mLinkHoverColor.getHexString(),margin:this.mMargin,width:this.mSize.x,height:this.mSize.y};return Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"uix_text",ui_options:JSON.stringify(t)})}}]),n}(rv);function fv(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return pv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pv(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function pv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(0,l.Z)(hv,"TypeRTTI",new k.r("UiEntityText",rv.TypeRTTI));var mv=function(){function e(){(0,u.Z)(this,e)}var n,i;return(0,c.Z)(e,[{key:"calculate",value:(i=t(r().mark((function e(t,n,i,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){i.getComponent("materialGroupManager").resolveMaterialGroups().subscribe((function(r){qe.qL.print("material price");var i=0;r.getGroups().forEach((function(e){var t=r.getActiveRefModel(e.id);!(0,p.isNullOrUndefined)(t)&&f.Ft.isNumeric(t.price)&&(i+=+t.price)})),qe.qL.print("Calculated material price:",i),t.totals=t.totals||{},t.totals.base=t.totals.base||0,t.totals.base+=i,e({totals:t.totals,models:t.models,catalogue:n.catalogue})}),(function(e){r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"breakDown",value:(n=t(r().mark((function e(t,n){var i,a,o,s,u,c,l,h;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.getComponent("materialGroupManager"),e.next=3,new Promise((function(e,t){i.resolveMaterialGroups().subscribe((function(t){return e(t)}),(function(e){return t(e)}))}));case 3:a=e.sent,o=[],s=a.getGroups(),u=fv(s),e.prev=7,u.s();case 9:if((c=u.n()).done){e.next=19;break}if(l=c.value,h=a.getActiveRefModel(l.id),!(0,p.isNullOrUndefined)(h)&&f.Ft.isNumeric(h.price)){e.next=14;break}return e.abrupt("continue",17);case 14:if(!n.excludePriceZero||0!==h.price){e.next=16;break}return e.abrupt("continue",17);case 16:o.push({id:h.id,price:h.price,name:h.name,material_id:h.material_id,material_name:h.material_name});case 17:e.next=9;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(7),u.e(e.t0);case 24:return e.prev=24,u.f(),e.finish(24);case 27:return e.abrupt("return",{materials:o});case 28:case"end":return e.stop()}}),e,null,[[7,21,24,27]])}))),function(e,t){return n.apply(this,arguments)})},{key:"getBreakDownName",value:function(){return"materials"}}]),e}();function dv(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return vv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vv(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function vv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var yv=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mPricingRulesBreakDown",[])}var n,i,a;return(0,c.Z)(e,[{key:"calculate",value:(a=t(r().mark((function e(t,n,i,a){var o,s,u,c,l,h,f=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.getComponent("attributeManager"),e.next=3,St(o.resolveAttributeManager());case 3:return s=e.sent,u=this.getApplicablePricingGroups(n),e.next=7,this.getModelDescriptor(i,s,a,n);case 7:return c=e.sent,(l=t.totals||{}).base=l.base||0,u.sort((function(e,t){return e.priority-t.priority})),u.forEach((function(e){var t=f.applyPricingRules(e,c,s);Object.keys(t).forEach((function(e){l[e]=l[e]||0,l[e]+=t[e]}))})),h=t.models.concat(c),e.abrupt("return",{totals:l,models:h,catalogue:n.catalogue});case 14:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"mapUnitToRatio",value:function(e){if(e)switch(e.toLowerCase()){case"km":return.001;case"hm":return.01;case"dam":return.1;case"m":return 1;case"dm":return 10;case"cm":return 100;case"mm":return 1e3}return 1}},{key:"applyPricingRules",value:function(e,t,n){var r=this,i=this.getApplicablePricingRules(e,t,n);this.mPricingRulesBreakDown=[],i.sort((function(e,t){return e.priority-t.priority}));var a={};i.forEach((function(e){a[e.priority]=a[e.priority]||[],a[e.priority].push(e)}));var o={base:0};return Object.keys(a).forEach((function(e){var t=Number(e);a[t].forEach((function(e){var t={};f.Ft.isNumeric(e.adjustment)&&(t.base=e.adjustment),Array.isArray(e.pricing_rule_adjustment_fields)&&e.pricing_rule_adjustment_fields.forEach((function(e){e.pivot&&f.Ft.isNumeric(e.pivot.adjustment)&&(t[e.name]=parseFloat(e.pivot.adjustment))}));var i=Object.keys(t),a=0;switch(e.type){case"compound":i.forEach((function(e){o[e]=o[e]||0,o[e]+=t[e],a+=t[e]}));break;case"rate":i.forEach((function(e){o[e]=o[e]||0,o[e]*=t[e],a+=o[e]*t[e]}));break;case"unit":if(null===e.attribute_id||void 0===e.attribute_id)break;var s=n.getAttributeController(e.attribute_id);if(!s)break;var u=s.getValueName();if(!f.Ft.isNumeric(u))break;var c=1;if(s.getAttribute().attribute_values.length>0){var l=s.getAttribute().attribute_values[0].attribute_value_valuable;l&&(c=r.mapUnitToRatio(l.unit))}var h=r.mapUnitToRatio(e.unit),p=parseFloat(u);p*=h/c,i.forEach((function(e){o[e]=o[e]||0,o[e]+=p*t[e],a+=p*t[e]}))}r.mPricingRulesBreakDown.push({id:e.id,sku_pattern:e.sku_pattern,type:e.type,adjustment_price:a,pricing_fields:e.pricing_rule_adjustment_fields})}))})),o}},{key:"getModelDescriptor",value:(i=t(r().mark((function e(t,n,i,a){var o,s,u,c,l,h,p,m;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.getMaterialGroupManager(),s=t.getComponent("articleListManager"),e.next=4,s.getArticles();case 4:return u=e.sent,c=i.getComponent("buildConfigurable"),l=c.getBatches(),h=[],l.forEach((function(e){var t=e.getComponent("materialGroupController");if(t){var n=o.getGroup(t.getMaterialGroupId());n&&n.generate_code&&e.getNodes().forEach((function(e){var n=e.models_id,r=u.find((function(e){return e.modelId===n}));r&&(h.findIndex((function(e){return e.models_id===n&&e.material_group_id===t.getMaterialGroupId()}))>=0||h.push({models_id:n,models_sku:r.sku,models_name:r.name,models_price:r.price,material_group_id:t.getMaterialGroupId(),material_group_sku:o.getActiveGroupSKU(t.getMaterialGroupId())}))}))}})),u.forEach((function(e){h.findIndex((function(t){return t.models_id===e.modelId}))>=0||h.push({models_id:e.modelId,models_sku:e.sku,models_name:e.name,models_price:e.price,material_group_id:-1,material_group_sku:null})})),qe.qL.print("Exporting models: ",h),p=n.getAttributeControllers(),m={},p.forEach((function(e){m[e.getAttribute().id]=e.getValueName()})),h.forEach((function(e){var t="";e.models_sku&&(t+=e.models_sku),e.material_group_sku&&(t+=e.material_group_sku),e.price_sku=(0,f.HH)(t)?t:null})),e.abrupt("return",h);case 16:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"getApplicablePricingGroups",value:function(e){var t=e.price_matrix||[];return t=t.filter((function(t){Array.isArray(t.pricing_classes)||(t.pricing_classes=[]);var n=t.pricing_classes.filter((function(e){return"catalogue"===e.type}));return 0!==n.length&&!n.every((function(t){return e.modifier_classes.findIndex((function(e){return e.id===t.id}))<0}))}))}},{key:"getApplicablePricingRules",value:function(e,t,n){var r=this,i=e.pricing_rules||[],a=new Date,o=a.getMonth(),s=a.getDate(),u=a.getFullYear(),c=new Date(u,o,s);i=(i=i.filter((function(e){var t=null!==e.starts_at&&void 0!==e.starts_at,n=null!==e.ends_at&&void 0!==e.ends_at,r=!t||new Date(e.starts_at.replace(/-/g,"/"))<=c,i=!n||new Date(e.ends_at.replace(/-/g,"/"))>=c;return r&&i}))).filter((function(e){if(null===e.condition_attribute_id||void 0===e.condition_attribute_id)return!0;var t=n.getAttributeController(e.condition_attribute_id);return t?t.compareValue(e.condition_attribute_value):(qe.qL.warn("Could not verify condition."),!1)}));var l=[],h={};t.forEach((function(e){i.forEach((function(t){r.ruleMatchesModel(t,e)&&(h[t.id]=h[t.id]||0,h[t.id]+=1,l.push(t))}))}));var p={};return l=l.filter((function(e){var t=!0;return f.Ft.isNumeric(e.components_limit)&&e.components_limit>1&&(t=h[e.id]>=e.components_limit),t&&e.unique&&(t=!0!==p[e.id],p[e.id]=!0),t}))}},{key:"ruleMatchesModel",value:function(e,t){if(null===t.price_sku||void 0===t.price_sku)return!1;if(null===e.sku_pattern||void 0===e.sku_pattern)return!0;if("*"===e.sku_pattern)return!0;if(e.sku_pattern===t.price_sku)return!0;var n=!1;try{n=new RegExp("^".concat(e.sku_pattern.split("*").join(".*"),"$")).test(t.price_sku)}catch(e){qe.qL.warn("Could not match pattern:",e)}return n}},{key:"breakDown",value:(n=t(r().mark((function e(t,n,i,a){var o,s,u,c,l,h,f,p,m;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.getComponent("attributeManager"),e.next=3,St(o.resolveAttributeManager());case 3:return s=e.sent,u=this.getApplicablePricingGroups(i),e.next=7,this.getModelDescriptor(t,s,a,i);case 7:c=e.sent,l=[],u.sort((function(e,t){return e.priority-t.priority})),h=dv(u),e.prev=11,h.s();case 13:if((f=h.n()).done){e.next=23;break}if(p=f.value,this.applyPricingRules(p,c,s),this.mPricingRulesBreakDown.length){e.next=18;break}return e.abrupt("continue",21);case 18:m=this.mPricingRulesBreakDown,!0===n.excludePriceZero&&(m=this.mPricingRulesBreakDown.filter((function(e){return e.adjustment_price>0}))),m.length&&l.push(m);case 21:e.next=13;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(11),h.e(e.t0);case 28:return e.prev=28,h.f(),e.finish(28);case 31:return e.abrupt("return",{pricing_rules:l});case 32:case"end":return e.stop()}}),e,this,[[11,25,28,31]])}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"getBreakDownName",value:function(){return"pricing_rules"}}]),e}(),gv=(__webpack_require__(391),function(){function e(){(0,u.Z)(this,e)}var n;return(0,c.Z)(e,[{key:"calculate",value:(n=t(r().mark((function e(n,i,a,o){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){var s=i.catalogue,u=i.settings.api_url;if(!(0,p.isString)(u)||0===u.length)return n.totals=n.totals||{},e({totals:n.totals,models:n.models,catalogue:i.catalogue});var c={product:{id:s.id,url_name:s.url_name,name:s.name,active:s.active||!0,price:s.price||0,sku:s.sku||""},attributes:[],materials:[],components:[]},l=a.getComponent("attributeManager"),h=a.getComponent("materialGroupManager"),m=a.getComponent("articleListManager");tl(l.resolveAttributeManager(),h.resolveMaterialGroups()).subscribe(function(){var a=t(r().mark((function t(a){var s,l,h,d,v;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((0,p.isNullOrUndefined)(a)||!Array.isArray(a)||a.length<2)){t.next=2;break}return t.abrupt("return",o());case 2:return s=a[0],l=a[1],h=function(e){return!0===e.visible||!1!==e.visible&&0!==e.visibility},s.getAttributeControllers().forEach((function(e){var t=e.getAttribute(),n=Object.assign({},t);n.visible=h(n),!(0,p.isNullOrUndefined)(n.entity_properties)&&n.entity_properties.length>0&&n.entity_properties.forEach((function(e){!(0,p.isNullOrUndefined)(e.values)&&e.values.length>0&&((0,p.isNullOrUndefined)(e.entity_property_values)||e.entity_property_values.length<=0)&&(e.entity_property_values=e.values)})),c.attributes.push(n)})),l.getGroups().forEach((function(e){var t=l.getActiveRefModel(e.id);if(!(0,p.isNullOrUndefined)(t)){var n=Object.assign({},e);n&&n.materials&&(n.selected_reference_id=t.id),c.materials.push(n)}})),t.next=11,m.getArticles();case 11:t.sent.forEach((function(e){var t={id:e.modelId,type:"configurable",name:e.name,description:e.description,sku:e.sku,price:e.price};c.components.push(t)})),d=ei.getInstance().getAcceptLanguage(),v=ei.uniqueInstance(),(0,p.isNullOrUndefined)(d)||(v.getHttpInstance().defaults.headers.common["Accept-Language"]=d),v.post(u,c,{timeout:1e4}).then((function(t){try{var r=f.Ft.isNumeric(t.data.price)?Number.parseFloat(t.data.price):0;qe.qL.print("Price over API: ",r),n.totals=n.totals||{},n.totals.base+=r,e({totals:n.totals,models:n.models,catalogue:i.catalogue})}catch(e){qe.qL.error("Something went wrong during calculating price over API: ",e),o(e)}})).catch((function(e){qe.qL.error("Something went wrong during retrieving price over API: ",e),o(e)}));case 17:case"end":return t.stop()}}),t)})));return function(e){return a.apply(this,arguments)}}(),(function(e){qe.qL.error("A manager failed to resolve: ",e),o(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"breakDown",value:function(e,t,n,r){}},{key:"getBreakDownName",value:function(){return"price_api"}}]),e}()),bv=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mCache",{})}var n,i,a;return(0,c.Z)(e,[{key:"getPrice",value:(a=t(r().mark((function e(t,n){var i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=y.F.Md5("".concat(t,"/").concat(JSON.stringify(n))),e.abrupt("return",this.resolveCache(i,t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"request",value:(i=t(r().mark((function e(t,n){var i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Jr.E.makeApiRoute("script_engine/catalogue/".concat(t,"/price/get")),e.next=3,ei.getInstance().post(i,n).catch((function(e){return e.response})).then((function(e){return e.data}));case 3:if(!(a=e.sent).error){e.next=6;break}throw a;case 6:return e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"resolveCache",value:(n=t(r().mark((function e(t,n,i){var a,o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Date.now(),!(o=this.mCache[t])){e.next=5;break}return o.timestamp=a,e.abrupt("return",o.value);case 5:return s=this.request(n,i),this.mCache[t]={hash:t,timestamp:a,value:s},e.next=9,s;case 9:return this.clearOldCache(),e.abrupt("return",s);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"clearOldCache",value:function(){var t=this,n=e.MAX_CACHE,r=Object.entries(this.mCache);r.length<=n||r.sort((function(e,t){var n=o(e,2)[1];return o(t,2)[1].timestamp-n.timestamp})).splice(n).forEach((function(e){var n=o(e,1)[0];return delete t.mCache[n]}))}}],[{key:"getInstance",value:function(){return null===this._instance&&(this._instance=new this),this._instance}}]),e}();(0,l.Z)(bv,"MAX_CACHE",100),(0,l.Z)(bv,"_instance",null);var Mv=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mPricingFields",void 0)}var n,i,a,s,h,p,m,d;return(0,c.Z)(e,[{key:"calculate",value:(d=t(r().mark((function e(t,n,i,a){var o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.catalogue.id,e.next=3,this.getPrice(o,i);case 3:return this.mPricingFields=e.sent,qe.qL.print("Price over script engine: ",this.mPricingFields),e.next=7,this.resolveArticles(i);case 7:return s=e.sent,t.totals=t.totals||{},this.applyPricingFields(this.mPricingFields,t.totals),this.applyArticles(s,t),e.abrupt("return",{totals:t.totals,models:t.models,catalogue:n.catalogue});case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return d.apply(this,arguments)})},{key:"resolveArticles",value:(m=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getComponent("articleListManager"),e.abrupt("return",n.getArticles());case 2:case"end":return e.stop()}}),e)}))),function(e){return m.apply(this,arguments)})},{key:"applyPricingFields",value:function(e,t){Object.keys(e).forEach((function(n){f.Ft.isNumeric(e[n])&&(t[n]=t[n]||0,t[n]+=Number.parseFloat(e[n]))}))}},{key:"applyArticles",value:function(e,t){t.models=t.models.concat(e.map((function(e){return{material_group_id:-1,material_group_sku:null,models_id:null,models_name:e.name,models_price:e.price||0,models_sku:e.sku,price_sku:e.sku}})))}},{key:"buildRequestPayload",value:(p=t(r().mark((function e(t){var n,i,a,s,u,c;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.resolveSerializedAttributes(t),this.resolveSerializedMaterials(t),this.resolveSerializedArticles(t),ei.getInstance().getAcceptLanguage()]);case 2:return n=e.sent,i=o(n,4),a=i[0],s=i[1],u=i[2],c=i[3],e.abrupt("return",{attributes:a,materials:s,articles:u,language:c});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"resolveSerializedAttributes",value:(h=t(r().mark((function e(t){var n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getComponent("attributeManager"),e.next=3,n.resolveAttributeManager().toPromise();case 3:return i=e.sent,e.abrupt("return",i.serialize({discard_hidden:!1,include_keys:!0,calculate_approximations:!1}));case 5:case"end":return e.stop()}}),e)}))),function(e){return h.apply(this,arguments)})},{key:"resolveSerializedMaterials",value:(s=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getComponent("materialGroupManager"),e.abrupt("return",n.serialize());case 2:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"resolveSerializedArticles",value:(a=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getComponent("articleListManager"),e.abrupt("return",n.serialize());case 2:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"getPrice",value:(i=t(r().mark((function e(t,n){var i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.buildRequestPayload(n);case 2:return i=e.sent,e.abrupt("return",bv.getInstance().getPrice(t,i));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"breakDown",value:(n=t(r().mark((function e(t,n,i,a){var o,s,u,c;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={totals:{base:0},models:[],catalogue:i.catalogue},e.next=3,this.calculate(o,i,t,a);case 3:return s=e.sent,u={pricingFields:this.mPricingFields},c=Object.assign(s,u),e.abrupt("return",{script_engine:c});case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"getBreakDownName",value:function(){return"script_engine"}}]),e}(),kv=function(){function e(){(0,u.Z)(this,e)}var n,i;return(0,c.Z)(e,[{key:"calculate",value:(i=t(r().mark((function e(t,n,i,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=n.catalogue,i=0;(0,p.isNumber)(r.price)&&(i=+r.price),qe.qL.print("base price"),t.totals=t.totals||{},t.totals.base=t.totals.base||0,t.totals.base+=i,e({totals:t.totals,models:t.models,catalogue:n.catalogue})})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"getBreakDownName",value:function(){return"base"}},{key:"breakDown",value:(n=t(r().mark((function e(t,n,i,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var t=i.catalogue,n=0;(0,p.isNumber)(t.price)&&(n=+t.price),e({base:n})})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r,i){return n.apply(this,arguments)})}]),e}(),_v=function(){function e(){(0,u.Z)(this,e)}var n,i;return(0,c.Z)(e,[{key:"calculate",value:(i=t(r().mark((function e(t,n,i,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){i.getComponent("attributeManager").resolveAttributeManager().subscribe((function(r){var i=r.getAttributeControllers(),a=0;i.forEach((function(e){if("question"===e.getAttributeType()&&e.isVisible()){var t=e.getAttribute();if(!(0,p.isNullOrUndefined)(t.selected_value_id)){var n=t.attribute_values.find((function(e){return e.id==t.selected_value_id}));!(0,p.isNullOrUndefined)(n)&&f.Ft.isNumeric(n.price)&&(a+=parseFloat(n.price))}}})),t.totals=t.totals||{},t.totals.base=t.totals.base||0,t.totals.base+=a,e({totals:t.totals,models:t.models,catalogue:n.catalogue})}),(function(e){r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"breakDown",value:(n=t(r().mark((function e(t,n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){t.getComponent("attributeManager").resolveAttributeManager().subscribe((function(t){var r=t.getAttributeControllers(),i=[];r.forEach((function(e){if("question"===e.getAttributeType()&&e.isVisible()){var t=e.getAttribute();if(!(0,p.isNullOrUndefined)(t.selected_value_id)){var r=t.attribute_values.find((function(e){return e.id==t.selected_value_id}));!(0,p.isNullOrUndefined)(r)&&f.Ft.isNumeric(r.price)&&(!0===n.excludePriceZero&&0===r.price||i.push({attribute_id:t.id,attribute_name:t.name,attribute_key:t.key,attribute_value_id:r.id,attribute_value_name:r.name,attribute_value_key:r.key,attribute_value_price:r.price}))}}})),e({attributes:i})}),(function(e){r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"getBreakDownName",value:function(){return"attributes"}}]),e}();function xv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Tv=function(e){(0,g.Z)(d,e);var n,i,a,o,h,p,m=xv(d);function d(){var e;return(0,u.Z)(this,d),e=m.call(this,"priceManager"),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mPriceDataLoader",null),(0,l.Z)((0,_.Z)(e),"mCustomPriceCalculators",[]),(0,l.Z)((0,_.Z)(e),"mConfigurableNode",null),(0,l.Z)((0,_.Z)(e),"mPricingSettings",null),(0,l.Z)((0,_.Z)(e),"mPriceMatrix",null),(0,l.Z)((0,_.Z)(e),"mCatalogue",null),(0,l.Z)((0,_.Z)(e),"mModifierClasses",void 0),e}return(0,c.Z)(d,[{key:"isAttachable",value:function(e){return e.isDerivedOfTypeName("ProductNode")}},{key:"OnAttached",value:function(){}},{key:"OnDetached",value:function(){this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mPriceDataLoader&&this.mPriceDataLoader.error("Detached"),this.mPriceDataLoader=null}},{key:"_depResolveConfigurableNode",value:function(){var e=this;return this.getParentObject().onConfigurableNodeReady.pipe(Ac(7e3),sn(1),Kt((function(t){e.mConfigurableNode=t})))}},{key:"_depResolveCatalogueSettings",value:function(){return this.getParentObject().getComponent("catalogueSettings").resolveSettings()}},{key:"_depLoadCatalogueClasses",value:(p=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.getParentObject();Ko.getInstance().resolveBootstrapData(r.productId).pipe(sn(1)).subscribe({next:function(n){qe.qL.print("bootstrap got catalogue classes");var r=n.getCatalogueClasses(),i=v.getItems(r);t.mModifierClasses=Array.isArray(i)?i:[],e(t.mModifierClasses)},error:function(e){n(e)}})})));case 1:case"end":return e.stop()}}),e)}))),function(){return p.apply(this,arguments)})},{key:"_depLoadPricingSettings",value:(h=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.getParentObject();Ko.getInstance().resolveBootstrapData(r.productId).pipe(sn(1)).subscribe({next:function(n){t.mPricingSettings=n.getPricingSettings(),e(t.mPricingSettings)},error:function(e){n(e)}})})));case 1:case"end":return e.stop()}}),e)}))),function(){return h.apply(this,arguments)})},{key:"_depLoadPricingMatrix",value:(o=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.getParentObject();Ko.getInstance().resolveBootstrapData(r.productId).pipe(sn(1)).subscribe({next:function(n){var r=n.getPricingGroups();t.mPriceMatrix=v.getItemsWithRelations(r),e(t.mPriceMatrix)},error:function(e){n(e)}})})));case 1:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)})},{key:"_depLoadCatalogue",value:(a=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.getParentObject();Ko.getInstance().resolveBootstrapData(r.productId).pipe(sn(1)).subscribe({next:function(n){t.mCatalogue=n.getCatalogue(),e(t.mCatalogue)},error:function(e){n(e)}})})));case 1:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})},{key:"_resolvePricingData",value:function(){var e=this;return this.mPriceDataLoader||(this.mPriceDataLoader=new ni,tl([this._depResolveConfigurableNode(),this._depLoadCatalogue(),this._depLoadCatalogueClasses(),this._depLoadPricingSettings(),this._depResolveCatalogueSettings(),this._depLoadPricingMatrix()]).pipe(sn(1)).subscribe({next:function(t){qe.qL.print("pricing data finished dependencies"),e.mPriceDataLoader&&e.mPriceDataLoader.next({settings:e.mPricingSettings,catalogue:e.mCatalogue,price_matrix:e.mPriceMatrix,modifier_classes:e.mModifierClasses})},error:function(t){qe.qL.error("Resolving pricing data failed: ",t),e.mPriceDataLoader&&(e.mPriceDataLoader.error("Failed resolve pricing data"),e.mPriceDataLoader=null)}})),this.mPriceDataLoader}},{key:"registerPriceCalculator",value:function(e){this.mCustomPriceCalculators.push(e)}},{key:"getApplicableCalculators",value:function(e){var t=e.price_calculators,n=[];return(t.attribute_pricing||t.pricing_matrix)&&n.push(new kv),t.attribute_pricing&&n.push(new _v,new mv),t.pricing_matrix&&n.push(new yv),t.external_api&&n.push(new gv),t.script_engine&&n.push(new Mv),n.push.apply(n,s(this.mCustomPriceCalculators)),n}},{key:"requestPrice",value:(i=t(r().mark((function e(){var t,n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getParentObject(),e.next=3,St(t.awaitArticlesFinished());case 3:return e.abrupt("return",new Promise((function(e,t){n._resolvePricingData().subscribe({next:function(r){var i=n.getApplicableCalculators(r.settings);n.requestCompoundPrice(i,(function(t){t.totals=t.totals||{},t.totals.base=t.totals.base||0,Object.keys(t.totals).forEach((function(e){f.Ft.isNumeric(t.totals[e])&&(t.totals[e]=parseFloat(parseFloat(t.totals[e]).toFixed(2)))})),e(t)}),(function(e){t(e)}),{totals:{base:0},models:[],catalogue:r.catalogue},r,n.getParentObject(),n.mConfigurableNode)},error:function(e){t(e)}})})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"requestCompoundPrice",value:function(e,t,n,r,i,a,o){var s=this;if(0!==e.length){var u=e.shift();Promise.resolve(u.calculate(r,i,a,o)).then((function(r){s.requestCompoundPrice(e,t,n,r,i,a,o)}),(function(e){n(e)}))}else t(r)}},{key:"requestPriceBreakDown",value:(n=t(r().mark((function e(){var t,n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getParentObject(),e.next=3,St(t.awaitArticlesFinished());case 3:return e.abrupt("return",new Promise((function(e,t){n._resolvePricingData().subscribe({next:function(t){var r=n.getApplicableCalculators(t.settings);e({calculators:r,pricingData:t,parentObject:n.getParentObject(),configurableNode:n.mConfigurableNode})},error:function(e){t(e)}})})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),d}(Xi.H),wv=__webpack_require__(32),Rv=__webpack_require__(251);function Zv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Sv=function(e){(0,g.Z)(n,e);var t=Zv(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"onOffsetManagerSubject",void 0),(0,l.Z)((0,_.Z)(e),"mSceneOffsetManager",void 0),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this,t=this.getProcessManager().getProductNode();this.onOffsetManagerSubject=new Ht,this.mSubscriptions.push(t.onConfigurableNodeReady.subscribe((function(t){t.resolveSceneOffsetManager().then((function(t){if(e.mSubscriptions.length)return e.mSceneOffsetManager||(e.mSceneOffsetManager=t,e.onOffsetManagerSubject.next(t)),t}),(function(){!e.mSceneOffsetManager&&e.onOffsetManagerSubject&&e.onOffsetManagerSubject.error("Failed to get offset manager")}))})))}},{key:"onDestroy",value:function(){this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.onOffsetManagerSubject&&(this.onOffsetManagerSubject.error("Destroyed"),delete this.onOffsetManagerSubject)}},{key:"playRotation",value:function(e,t,n){var r=this.mSceneOffsetManager.getOffsetRotation(e);if(r)if(n<=0)this.mSceneOffsetManager.setOffsetRotation(e,t);else{var i=new Pp(r,r.clone(),t,n,Ap.Linear,0);this.mSceneOffsetManager.setOffsetRotationAnimation(e,i)}else qe.qL.error("Offset rotation id not found:",e)}},{key:"onHandleInPort",value:function(e){var t=this,n=Number(this.getMetadata().value_offset),r=this.getMetadata().value_speed||0,i=this.getMetadata().value_vec_x||0,a=this.getMetadata().value_vec_y||0,o=this.getMetadata().value_vec_z||0;if(!Number.isFinite(n))return[];var s=new Li(Pt(i),Pt(a),Pt(o)),u=(new Pi).setFromEuler(s);return this.mSceneOffsetManager?(this.playRotation(n,u,r),[]):new Promise((function(e,i){t.onOffsetManagerSubject.pipe(di()).subscribe({next:function(){t.playRotation(n,u,r),e([])},error:function(e){i(e)}})}))}}]),n}(Rv.s);function Cv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Iv=function(e){(0,g.Z)(n,e);var t=Cv(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=Number(this.getMetadata().value_camera),n="no"!==this.getMetadata().camera_openview;return Number.isFinite(t)&&P.messenger().send(new Re(t,!0,n)),[]}}]),n}(Rv.s);function Ev(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Av=function(e){(0,g.Z)(n,e);var t=Ev(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=Number(this.getMetadata().value_view);return Number.isFinite(t)&&(qe.qL.print("select view id: ",t),P.messenger().send(new Se(t))),[]}}]),n}(Rv.s);function Ov(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Dv=function(e){(0,g.Z)(a,e);var n,i=Ov(a);function a(){return(0,u.Z)(this,a),i.apply(this,arguments)}return(0,c.Z)(a,[{key:"onHandleInPort",value:function(e){var t=this,n=[],r=this.getMetadata();if(void 0!==r.value_option_list&&null!==r.value_option_list)try{n=JSON.parse(r.value_option_list)}catch(e){qe.qL.print("Failed to parse select option rule:",e)}else void 0!==r.value_option&&null!==r.value_option&&n.push(r.value_option);var i=[];if(n.forEach((function(e){var t=e.split(":");if(2===t.length||3===t.length)try{var n=null;if(3===t.length){var r=t[2].match(/^(\d+)\((.*)\)$/);3===r.length&&(n=r[2])}var a=i.find((function(e){return e.product_uuid===n}));a||(a={product_uuid:n,option_list:[]},i.push(a)),a.option_list.push({question_id:parseInt(t[0],10),option_id:t[1]})}catch(e){qe.qL.error("failed to read select option rule: ",e)}})),i.length>0){var a=[];return i.forEach((function(e){a.push(t.applyAttribute(e.product_uuid,e.option_list))})),new Promise((function(e,t){if(0===a.length)return e([]);jo(a).pipe(sn(1)).subscribe({next:function(t){e([])},error:function(e){t(e)}})}))}return[]}},{key:"applyAttribute",value:(n=t(r().mark((function e(n,i){var a=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){var s,u=null;if(null==n)u=a.getProcessManager().getProductNode();else{var c=P.sceneManager().findNodesOfTypeName("ProductNode",(function(e){return e.getValue("object_uuid")===n}));c.length>0&&(u=c[0])}if(null===u)return o("product with uuid '"+n+"' not found");u.getComponent("attributeManager").resolveAttributeManager().subscribe({next:(s=t(r().mark((function t(n){var a,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=[],i.forEach((function(e){var t=n.getValue(e.question_id);null!=t&&t.attribute_value_id!=e.option_id&&a.push({q:e.question_id,o:e.option_id})})),o=0;case 3:if(!(o<a.length)){t.next=9;break}return t.next=6,n.setValue(a[o].q,a[o].o,{emitEvent:!0,rebuild:o===a.length-1});case 6:o++,t.next=3;break;case 9:e(!0);case 10:case"end":return t.stop()}}),t)}))),function(e){return s.apply(this,arguments)}),error:function(e){o(e)}})})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})}]),a}(Rv.s);function Pv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Bv=function(e){(0,g.Z)(i,e);var n=Pv(i);function i(){return(0,u.Z)(this,i),n.apply(this,arguments)}return(0,c.Z)(i,[{key:"onHandleInPort",value:function(e){var n=this,i=[];if(!(0,p.isNullOrUndefined)(this.getMetadata().select_color_edit_list))try{i=JSON.parse(this.getMetadata().select_color_edit_list)}catch(e){}return i&&i.length>0?new Promise((function(e,a){n.getProcessManager().getProductNode().getComponent("attributeManager").resolveAttributeManager().subscribe(function(){var n=t(r().mark((function t(n){var a,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=[],i.forEach((function(e){var t=e.question_id||null,r=e.color_id||null;if(!(0,p.isNullOrUndefined)(t)&&!(0,p.isNullOrUndefined)(r)){var i=n.getValue(t);(0,p.isNullOrUndefined)(i)||i.attribute_value_id==r||a.push({q:t,o:r})}})),o=0;case 3:if(!(o<a.length)){t.next=9;break}return t.next=6,n.setValue(a[o].q,a[o].o,{emitEvent:!0,rebuild:o===a.length-1});case 6:o++,t.next=3;break;case 9:e([]);case 10:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}(),(function(e){a(e)}))})):[]}}]),i}(Rv.s);function Fv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Lv=function(e){(0,g.Z)(n,e);var t=Fv(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"onMatManagerSubject",null),(0,l.Z)((0,_.Z)(e),"mMaterialGroupManager",null),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this;this.onMatManagerSubject=new Ht;var t=this.getProcessManager().getProductNode().getComponent("materialGroupManager");this.mSubscriptions.push(t.resolveMaterialGroups().subscribe((function(t){null!==e.mSubscriptions&&null===e.mMaterialGroupManager&&(e.mMaterialGroupManager=t,e.onMatManagerSubject.next(t))}),(function(t){null===e.mMaterialGroupManager&&null!==e.onMatManagerSubject&&e.onMatManagerSubject.error("Failed to get material manager")})))}},{key:"onDestroy",value:function(){null!==this.onMatManagerSubject&&this.onMatManagerSubject.error("destroyed"),this.onMatManagerSubject=null,this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"setMaterials",value:function(e){var t=this;e.forEach((function(e){if(e.length>0){var n=e.split(":");2==n.length&&t.mMaterialGroupManager.setActiveMaterial(n[0],n[1])}}))}},{key:"onHandleInPort",value:function(e){var t=this,n=[];if((0,p.isNullOrUndefined)(this.getMetadata().value_matgroup_list))(0,p.isNullOrUndefined)(this.getMetadata().value_matgroup)||n.push(this.getMetadata().value_matgroup);else try{n=JSON.parse(this.getMetadata().value_matgroup_list)}catch(e){}return null===this.mMaterialGroupManager?new Promise((function(e,r){t.onMatManagerSubject.pipe(di()).subscribe((function(){t.setMaterials(n),e([])}),(function(e){r(e)}))})):(this.setMaterials(n),[])}}]),n}(Rv.s);function Nv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var jv=function(e){(0,g.Z)(n,e);var t=Nv(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"onOffsetManagerSubject",void 0),(0,l.Z)((0,_.Z)(e),"mSceneOffsetManager",void 0),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this,t=this.getProcessManager().getProductNode();this.onOffsetManagerSubject=new Ht,this.mSubscriptions.push(t.onConfigurableNodeReady.subscribe((function(t){t.resolveSceneOffsetManager().then((function(t){if(e.mSubscriptions.length)return e.mSceneOffsetManager||(e.mSceneOffsetManager=t,e.onOffsetManagerSubject.next(t)),t}),(function(){!e.mSceneOffsetManager&&e.onOffsetManagerSubject&&e.onOffsetManagerSubject.error("Failed to get offset manager")}))})))}},{key:"onDestroy",value:function(){this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.onOffsetManagerSubject&&(this.onOffsetManagerSubject.error("Destroyed"),delete this.onOffsetManagerSubject)}},{key:"playMovement",value:function(e,t,n,r){var i=this.mSceneOffsetManager.getOffsetVector(e,t);if(i)if(r<=0)this.mSceneOffsetManager.setOffset(e,t,n);else{var a=new Pp(i,i.clone(),n,r,Ap.Linear,0);this.mSceneOffsetManager.setOffsetAnimation(e,t,a)}else qe.qL.error("Offset id not found:",e,t)}},{key:"onHandleInPort",value:function(e){var t=this,n=Number(this.getMetadata().value_offset),r=this.getMetadata().value_speed||0,i=this.getMetadata().value_level||0,a=this.getMetadata().value_vec_x||0,o=this.getMetadata().value_vec_y||0,s=this.getMetadata().value_vec_z||0;if(!Number.isFinite(n))return[];var u=new Bi(a,o,s);return this.mSceneOffsetManager?(this.playMovement(n,i,u,r),[]):new Promise((function(e,a){t.onOffsetManagerSubject.pipe(di()).subscribe({next:function(){t.playMovement(n,i,u,r),e([])},error:function(e){a(e)}})}))}}]),n}(Rv.s);function zv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Uv=function(e){(0,g.Z)(n,e);var t=zv(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"onOffsetManagerSubject",null),(0,l.Z)((0,_.Z)(e),"mSceneOffsetManager",null),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this,t=this.getProcessManager().getProductNode();this.onOffsetManagerSubject=new Ht,this.mSubscriptions.push(t.onConfigurableNodeReady.subscribe((function(t){t.resolveSceneOffsetManager().then((function(t){if(e.mSubscriptions.length)return e.mSceneOffsetManager||(e.mSceneOffsetManager=t,e.onOffsetManagerSubject.next(t)),t}),(function(){!e.mSceneOffsetManager&&e.onOffsetManagerSubject&&e.onOffsetManagerSubject.error("failed to get offset manager")}))})))}},{key:"onDestroy",value:function(){this.onOffsetManagerSubject&&(this.onOffsetManagerSubject.error("destroyed"),this.onOffsetManagerSubject=null),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"onHandleInPort",value:function(e){var t=this,n=Number(this.getMetadata().value_offset);return Number.isFinite(n)?(this.mSceneOffsetManager&&this.mSceneOffsetManager.showOffsetNode(n),new Promise((function(e,r){t.onOffsetManagerSubject.pipe(di()).subscribe({next:function(){t.mSceneOffsetManager.showOffsetNode(n),e([])},error:function(e){r(e)}})}))):[]}}]),n}(Rv.s);function Vv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Hv=function(e){(0,g.Z)(n,e);var t=Vv(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_question;if(!(0,p.isNullOrUndefined)(t)){var n=this.getProcessManager().getProductNode();P.messenger().send(new J(n.getSceneObjectId(),n.getObjectUUID(),t,!0))}return[]}}]),n}(Rv.s);function Gv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var qv=function(e){(0,g.Z)(n,e);var t=Gv(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_selected_color_question,n={};try{n=JSON.parse(this.getMetadata().value_selected_colors)}catch(e){}var r="all";if((0,p.isNullOrUndefined)(this.getMetadata().visibility_condition)||(r=this.getMetadata().visibility_condition),!(0,p.isNullOrUndefined)(t)){var i=this.getProcessManager().getProductNode();return new Promise((function(e,a){i.getComponent("attributeManager").resolveAttributeManager().subscribe((function(i){var a=i.getAttributeController(t),o=a.getAttribute();(0,p.isNullOrUndefined)(o)||o.attribute_values[0].attribute_value_valuable.colors.forEach((function(e){var t=!0;switch(r){case"visible":t=!0!==n[e.color];break;case"hidden":t=!0===n[e.color]}t&&(a.setVisibility(!n[e.color],{color:e.color}),a.broadcastAttributeUpdated())}));e([])}),(function(e){a(e)}))}))}return[]}}]),n}(Rv.s);function Wv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Yv=function(e){(0,g.Z)(n,e);var t=Wv(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"onMatManagerSubject",void 0),(0,l.Z)((0,_.Z)(e),"mMaterialGroupManager",null),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this;this.onMatManagerSubject=new Ht;var t=this.getProcessManager().getProductNode().getComponent("materialGroupManager");this.mSubscriptions.push(t.resolveMaterialGroups().subscribe((function(t){null!==e.mSubscriptions&&null===e.mMaterialGroupManager&&(e.mMaterialGroupManager=t,e.onMatManagerSubject.next(t))}),(function(t){null===e.mMaterialGroupManager&&null!==e.onMatManagerSubject&&e.onMatManagerSubject.error("Failed to get material manager")})))}},{key:"onDestroy",value:function(){(0,p.isNullOrUndefined)(this.onMatManagerSubject)||this.onMatManagerSubject.error("destroyed"),this.onMatManagerSubject=null,this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"onHandleInPort",value:function(e){var t=this;return null!==this.mMaterialGroupManager?(this.runVisibilityCheck(),[]):new Promise((function(e,n){t.onMatManagerSubject.pipe(di()).subscribe((function(){t.runVisibilityCheck(),e([])}),(function(e){n(e)}))}))}},{key:"runVisibilityCheck",value:function(){var e=this,t=this.getMetadata().value_selected_material,n={};try{n=JSON.parse(this.getMetadata().value_selected_matrefs)}catch(e){}var r="all";if((0,p.isNullOrUndefined)(this.getMetadata().visibility_condition)||(r=this.getMetadata().visibility_condition),!(0,p.isNullOrUndefined)(t)){var i=this.mMaterialGroupManager.getGroupReferencesByGroupId(t);(0,p.isNullOrUndefined)(i)||i.forEach((function(i){var a=!0;switch(r){case"visible":a=!0!==n[i.id];break;case"hidden":a=!0===n[i.id]}a&&e.mMaterialGroupManager.setMaterialVisibilityByGroupId(t,i.id,!0!==n[i.id])}))}}}]),n}(Rv.s);function Kv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Xv=function(e){(0,g.Z)(n,e);var t=Kv(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"getVisibilityAttributes",value:function(e){if("question"===e.type)return e.attribute_values.map((function(e){return e.id}));if(["svg_image_selector","svg_element","svg_element_selector"].includes(e.type))try{return e.attribute_values[0].attribute_value_valuable.attributes.map((function(e){return e.key}))}catch(e){qe.qL.print("failed to get svg attribute keys: ",e)}return[]}},{key:"onHandleInPort",value:function(e){var t=this,n=this.getMetadata().value_selected_question,r={};try{r=JSON.parse(this.getMetadata().value_selected_options)}catch(e){qe.qL.error("Failed to parse selected options: ",e)}var i="all";if((0,p.isNullOrUndefined)(this.getMetadata().visibility_condition)||(i=this.getMetadata().visibility_condition),!(0,p.isNullOrUndefined)(n)){var a=this.getProcessManager().getProductNode();return new Promise((function(e,o){a.getComponent("attributeManager").resolveAttributeManager().subscribe((function(o){var s=o.getRawAttributes().find((function(e){return e.id==n}));(0,p.isNullOrUndefined)(s)||t.getVisibilityAttributes(s).forEach((function(e){var t=!0;switch(i){case"visible":t=!0!==r[e];break;case"hidden":t=!0===r[e]}t&&P.messenger().send(new J(a.getSceneObjectId(),a.getObjectUUID(),n,!0!==r[e],e))}));e([])}),(function(e){o(e)}))}))}return[]}}]),n}(Rv.s);function $v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Qv=function(e){(0,g.Z)(n,e);var t=$v(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t={};try{t=JSON.parse(this.getMetadata().value_selected_question)}catch(e){}var n="all";if((0,p.isNullOrUndefined)(this.getMetadata().visibility_condition)||(n=this.getMetadata().visibility_condition),Object.keys(t).length>0){var r=this.getProcessManager().getProductNode();return new Promise((function(e,i){r.getComponent("attributeManager").resolveAttributeManager().subscribe((function(i){i.getRawAttributes().forEach((function(e){var i=!0;switch(n){case"visible":i=!0!==t[e.id];break;case"hidden":i=!0===t[e.id]}i&&P.messenger().send(new J(r.getSceneObjectId(),r.getObjectUUID(),e.id,!0!==t[e.id]))})),e([])}),(function(e){i(e)}))}))}return[]}}]),n}(Rv.s);function Jv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var ey=function(e){(0,g.Z)(n,e);var t=Jv(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_matgroup_id,n="hidden"!==this.getMetadata().price_visibility;return(0,p.isNullOrUndefined)(t)||P.messenger().send(new ae(t,n)),[]}}]),n}(Rv.s);function ty(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var ny=function(e){(0,g.Z)(n,e);var t=ty(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=parseInt(this.getMetadata().value_selected_question,10),n={};try{n=JSON.parse(this.getMetadata().value_selected_options)}catch(e){}var r="all";if((0,p.isNullOrUndefined)(this.getMetadata().option_disabled_condition)||(r=this.getMetadata().option_disabled_condition),!(0,p.isNullOrUndefined)(t)){var i=this.getProcessManager().getProductNode().getComponent("attributeManager");return new Promise((function(e,a){i.resolveAttributeManager().subscribe((function(i){var a=i.getAttributeController(t);if(!(0,p.isNullOrUndefined)(a)){var o=a.getAttribute();(0,p.isNullOrUndefined)(o)||o.attribute_values.forEach((function(e){var t=!0;switch(r){case"enabled":t=!0===n[e.id]&&!0!==e.disabled;break;case"disabled":t=!0!==n[e.id]&&!0===e.disabled}if(t){var i=!0===n[e.id];a.setDisabled(i,{option_id:e.id}),a.broadcastAttributeUpdated()}})),e([])}}),(function(e){a(e)}))}))}return[]}}]),n}(Rv.s),ry=__webpack_require__(3280);function iy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var ay=function(e){(0,g.Z)(n,e);var t=iy(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){return[new ry.q(e.type,e.data,this,"forward")]}}]),n}(Rv.s);function oy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var sy=function(e){(0,g.Z)(n,e);var t=oy(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_node_id;if((0,p.isNullOrUndefined)(t))return[];var n=P.sceneManager().findNodesOfType(Wi.TypeRTTI,(function(e){return e.getSceneObjectId()==t}))[0];if(!(0,p.isNullOrUndefined)(n)){var r=this.getValue(e.data);r=this.fixFloat(r),n.setValue("title",r)}return[]}},{key:"getValue",value:function(e){switch(e.attribute_type){case"operable_numbers_input":case"text_to_image":case"text_input":return e.attribute_value_name}return(0,p.isNullOrUndefined)(e.value)?"":e.value}},{key:"fixFloat",value:function(e){var t=Number(e);return isNaN(t)||t*Math.pow(10,2)%1==0?e:t.toFixed(2)}}]),n}(Rv.s);__webpack_require__(6373);function uy(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return cy(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cy(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function cy(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ly(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var hy=function(e){(0,g.Z)(a,e);var n,i=ly(a);function a(){return(0,u.Z)(this,a),i.apply(this,arguments)}return(0,c.Z)(a,[{key:"onHandleInPort",value:(n=t(r().mark((function e(t){var n,i,a,o,s,u,c,l,h,f,m;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],!(0,p.isNullOrUndefined)(this.getMetadata().value_input_list))try{n=JSON.parse(this.getMetadata().value_input_list)}catch(e){qe.qL.error(e)}return i=t.data.value,a=[],o=this.transformNewValue(i),s=this.getProcessManager().getProductNode(),u=s.getComponent("attributeManager"),e.next=9,St(u.resolveAttributeManager());case 9:c=e.sent,l=uy(n),e.prev=11,l.s();case 13:if((h=l.n()).done){e.next=21;break}return f=h.value,m=Number(f),e.next=18,c.setValue(m,o);case 18:a.push(new ry.q("input",{attribute_id:m,value:o},this,"input_id"));case 19:e.next=13;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(11),l.e(e.t0);case 26:return e.prev=26,l.f(),e.finish(26);case 29:return e.abrupt("return",a);case 30:case"end":return e.stop()}}),e,this,[[11,23,26,29]])}))),function(e){return n.apply(this,arguments)})},{key:"transformNewValue",value:function(e){var t="string"==typeof e||"number"==typeof e?e:"",n=this.getMetadata().value_text||"";if(!n)return"";var r,i=uy(s(n.matchAll(/{value(?:\|(\d+))?}/gi)));try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a[0],u=Math.max(Number(a[1])||0,0);n=f.Ft.isNumeric(t)?n.replace(o,Number(t).toFixed(u)):n.replace(o,String(t))}}catch(e){i.e(e)}finally{i.f()}return n}}]),a}(Rv.s);function fy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var py=function(e){(0,g.Z)(n,e);var t=fy(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=null;try{t=JSON.parse(this.getMetadata().material_reference)}catch(e){}var n=this.getMetadata().material_hex_color;if(!(0,p.isNullOrUndefined)(t)&&f.Ft.isNumeric(t.material_id)&&(0,p.isString)(n)){var r=this.getProcessManager().getProductNode(),i=tc.getManager(Qu.MaterialManager),a=(0,p.isString)(n)&&n.length>0?n.substr(0,7):"";i.setColorOverwrite(t.material_id,a,r.getSceneObjectId())}return[]}}]),n}(Rv.s);function my(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var dy=function(e){(0,g.Z)(n,e);var t=my(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"onMatManagerSubject",void 0),(0,l.Z)((0,_.Z)(e),"mMaterialGroupManager",void 0),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this;this.onMatManagerSubject=new Ht;var t=this.getProcessManager().getProductNode().getComponent("materialGroupManager");this.mSubscriptions.push(t.resolveMaterialGroups().subscribe({next:function(t){e.mMaterialGroupManager||(e.mMaterialGroupManager=t,e.onMatManagerSubject.next(t))},error:function(){!e.mMaterialGroupManager&&e.onMatManagerSubject&&e.onMatManagerSubject.error("Failed to get material manager")}}))}},{key:"onDestroy",value:function(){this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.onMatManagerSubject&&(this.onMatManagerSubject.error("destroyed"),delete this.onMatManagerSubject)}},{key:"onHandleInPort",value:function(){var e=this,t=null,n=null,r=null;try{(t=JSON.parse(this.getMetadata().value_mat_or_matgroup_mat_value||"null"))||(t=JSON.parse(this.getMetadata().material_reference||"null")),n=JSON.parse(this.getMetadata().value_mat_or_matgroup_group_value||"null"),r=JSON.parse(this.getMetadata().material_maps)}catch(e){qe.qL.error(e)}if(!r||!Array.isArray(r))return[];var i=this.getProcessManager().getProductNode();if(t&&f.Ft.isNumeric(t.material_id)){for(var a=tc.getManager(Qu.MaterialManager),o=[],s=0;s<r.length;s++)o.push(a.setMapOverwrite(t.material_id,r[s].type,r[s].textureId,i.getSceneObjectId()));h.resolveArray(o,(function(){qe.qL.print("Texture on material applied using material-map-rule!")}))}if(null!=n){if(!this.mMaterialGroupManager)return new Promise((function(t,a){e.onMatManagerSubject.pipe(di()).subscribe({next:function(){for(var a=[],o=0;o<r.length;o++)a.push(e.mMaterialGroupManager.setMapOverwrite(n,r[o].type,r[o].textureId,i.getSceneObjectId()));h.resolveArray(a,(function(){return qe.qL.print("Texture on material group applied using (promise) material-group-map-rule!"),t([])}))},error:function(e){return a(e)}})}));for(var u=[],c=0;c<r.length;c++)u.push(this.mMaterialGroupManager.setMapOverwrite(n,r[c].type,r[c].textureId,i.getSceneObjectId()));h.resolveArray(u,(function(){qe.qL.print("Texture on material group applied using material-group-map-rule!")}))}return[]}}]),n}(Rv.s);function vy(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return yy(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yy(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function yy(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var by=function(e){(0,g.Z)(a,e);var n,i=gy(a);function a(){return(0,u.Z)(this,a),i.apply(this,arguments)}return(0,c.Z)(a,[{key:"onHandleInPort",value:(n=t(r().mark((function e(t){var n,i,a,o,s,u,c,l,h,m,d,v,y,g,b;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],!(0,p.isNullOrUndefined)(this.getMetadata().value_input_list))try{n=JSON.parse(this.getMetadata().value_input_list)}catch(e){}return i=0,(0,p.isNullOrUndefined)(this.getMetadata().operand_value)||(i=parseInt(this.getMetadata().operand_value,10)),a=[],o=this.getProcessManager().getProductNode(),s=o.getComponent("attributeManager"),e.next=9,St(s.resolveAttributeManager());case 9:u=e.sent,c=t.data?t.data.value:void 0,l=this.getMetadata().value_text,h=this.transformNewValue(l,c),m=f.Ft.isNumeric(h)?Number(h):void 0,d=vy(n),e.prev=15,d.s();case 17:if((v=d.n()).done){e.next=27;break}return y=v.value,g=Number(y),(b={})[i]={value:m},e.next=24,u.setValue(g,b);case 24:a.push(new ry.q("input",{attribute_id:g,value:m},this,"input_id"));case 25:e.next=17;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(15),d.e(e.t0);case 32:return e.prev=32,d.f(),e.finish(32);case 35:return e.abrupt("return",a);case 36:case"end":return e.stop()}}),e,this,[[15,29,32,35]])}))),function(e){return n.apply(this,arguments)})},{key:"transformNewValue",value:function(e,t){var n=null!=t?t:"";if(e){var r,i=vy(s(e.matchAll(/{value(?:\|(\d+))?}/gi)));try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a[0],u=Math.max(Number(a[1])||0,0);e=f.Ft.isNumeric(n)?e.replace(o,Number(n).toFixed(u)):e.replace(o,String(n))}}catch(e){i.e(e)}finally{i.f()}return e}}}]),a}(Rv.s);function My(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var ky=function(e){(0,g.Z)(n,e);var t=My(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=[];if(!(0,p.isNullOrUndefined)(this.getMetadata().value_input_list))try{t=JSON.parse(this.getMetadata().value_input_list)}catch(e){}var n="disabled";(0,p.isNullOrUndefined)(this.getMetadata().minmax_min_change_type)||(n=this.getMetadata().minmax_min_change_type);var r="disabled";(0,p.isNullOrUndefined)(this.getMetadata().minmax_max_change_type)||(r=this.getMetadata().minmax_max_change_type);var i=null;(0,p.isNullOrUndefined)(this.getMetadata().minmax_min_change_value)||(i=this.getMetadata().minmax_min_change_value);var a=null;(0,p.isNullOrUndefined)(this.getMetadata().minmax_max_change_value)||(a=this.getMetadata().minmax_max_change_value);var o=0;return(0,p.isNullOrUndefined)(this.getMetadata().operand_value)||(o=parseInt(this.getMetadata().operand_value,10)),this.getProcessManager().getProductNode().getComponent("attributeManager").resolveAttributeManager().subscribe((function(e){t.forEach((function(t){var s=e.getAttributeController(t);if(!(0,p.isNullOrUndefined)(s)){var u=s.getAttribute(),c=u.attribute_values;if(c.length>0){var l=c[0];switch(u.type){case"text_input":var h=l.attribute_value_valuable;switch(n){case"null":h.min=null;break;case"update":h.min=i}switch(r){case"null":h.max=null;break;case"update":h.max=a}s.broadcastAttributeUpdated();break;case"operable_numbers_input":var f=l.attribute_value_valuable;if(o<f.operands.length){switch(n){case"null":f.operands[o].min_value=null;break;case"update":f.operands[o].min_value=i}switch(r){case"null":f.operands[o].max_value=null;break;case"update":f.operands[o].max_value=a}}s.broadcastAttributeUpdated()}}}}))}),(function(e){})),[]}}]),n}(Rv.s);function _y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var xy=function(e){(0,g.Z)(n,e);var t=_y(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=null;if(null!==this.getMetadata().value_update_attribute_id&&void 0!==this.getMetadata().value_update_attribute_id&&(t=parseInt(this.getMetadata().value_update_attribute_id,10)),null===t)return[];var n=null;null!==this.getMetadata().value_update_attribute_name&&void 0!==this.getMetadata().value_update_attribute_name&&(n=this.getMetadata().value_update_attribute_name);var r=null;if(null!==this.getMetadata().value_update_attribute_valuable&&void 0!==this.getMetadata().value_update_attribute_valuable)try{r=JSON.parse(this.getMetadata().value_update_attribute_valuable)}catch(e){}return this.getProcessManager().getProductNode().getComponent("attributeManager").resolveAttributeManager().subscribe({next:function(e){var i=e.getAttributeController(t);if(i){var a=i.getAttribute();(0,f.HH)(n)&&(a.name=n),r&&(a.attribute_values=a.attribute_values||[],0===a.attribute_values.length&&a.attribute_values.push({attribute_value_valuable:{}}),a.attribute_values[0].attribute_value_valuable=Object.assign(a.attribute_values[0].attribute_value_valuable,r)),i.broadcastAttributeUpdated()}},error:function(){}}),[]}}]),n}(Rv.s);function Ty(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var wy=function(e){(0,g.Z)(n,e);var t=Ty(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=[];if(!(0,p.isNullOrUndefined)(this.getMetadata().value_input_list))try{t=JSON.parse(this.getMetadata().value_input_list)}catch(e){}var n="min";(0,p.isNullOrUndefined)(this.getMetadata().selected_range)||(n=this.getMetadata().selected_range);var r=0;(0,p.isNullOrUndefined)(this.getMetadata().operand_value)||(r=parseInt(this.getMetadata().operand_value,10));var i=null;switch(e.data.attribute_type){case"operable_numbers_input":case"text_to_image":case"text_input":i=e.data.attribute_value_name;break;default:i=e.data.value}return i=f.Ft.isNumeric(i)?parseFloat(i):null,this.getProcessManager().getProductNode().getComponent("attributeManager").resolveAttributeManager().subscribe((function(e){t.forEach((function(t){var a=e.getAttributeController(t);if(!(0,p.isNullOrUndefined)(a)){var o=a.getAttribute(),s=o.attribute_values;if(s.length>0){var u=s[0];switch(o.type){case"text_input":var c=u.attribute_value_valuable;switch(n){case"min":c.min=i;break;case"max":c.max=i}a.broadcastAttributeUpdated();break;case"operable_numbers_input":var l=u.attribute_value_valuable;if(r<l.operands.length)switch(n){case"min":l.operands[r].min_value=i;break;case"max":l.operands[r].max_value=i}a.broadcastAttributeUpdated()}}}}))}),(function(){})),[]}}]),n}(Rv.s);function Ry(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Zy=function(e){(0,g.Z)(n,e);var t=Ry(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t="";if("string"===e.type||"input"===e.type)switch(e.data.attribute_type){case"operable_numbers_input":case"text_to_image":case"text_input":t+=e.data.attribute_value_name;break;default:t+=(0,p.isNullOrUndefined)(e.data.value)?"":e.data.value}return t+=this.getMetadata().value_text,[new ry.q("string",{value:t},this,"text")]}}]),n}(Rv.s),Sy=__webpack_require__(430);function Cy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Iy=function(e){(0,g.Z)(n,e);var t=Cy(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){try{var t=this.getMetadata().value_string||"DEBUG";qe.qL.info("[".concat(t,"]"),e)}catch(e){qe.qL.error("Debug node encountered an error.",e)}return[Object.assign(e,{client:this,outPort:"forward"})]}}]),n}(Rv.s);function Ey(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ay=function(e){(0,g.Z)(n,e);var t=Ey(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"onOffsetManagerSubject",null),(0,l.Z)((0,_.Z)(e),"mSceneOffsetManager",null),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this,t=this.getProcessManager().getProductNode();this.onOffsetManagerSubject=new Ht,this.mSubscriptions.push(t.onConfigurableNodeReady.subscribe((function(t){t.resolveSceneOffsetManager().then((function(t){if(!e.mSubscriptions)return e.mSceneOffsetManager||(e.mSceneOffsetManager=t,e.onOffsetManagerSubject.next(t)),t}),(function(){!e.mSceneOffsetManager&&e.onOffsetManagerSubject&&e.onOffsetManagerSubject.error("failed to get offset manager")}))})))}},{key:"onDestroy",value:function(){this.onOffsetManagerSubject&&(this.onOffsetManagerSubject.error("destroyed"),this.onOffsetManagerSubject=null),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"onHandleInPort",value:function(e){var t=this,n=Number(this.getMetadata().value_offset);return Number.isFinite(n)?null!==this.mSceneOffsetManager?(this.mSceneOffsetManager.hideOffsetNode(n),[]):new Promise((function(e,r){t.onOffsetManagerSubject.pipe(di()).subscribe({next:function(){t.mSceneOffsetManager.hideOffsetNode(n),e([])},error:function(e){r(e)}})})):[]}}]),n}(Rv.s);function Oy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Dy=function(e){(0,g.Z)(n,e);var t=Oy(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_question;if(!(0,p.isNullOrUndefined)(t)){var n=this.getProcessManager().getProductNode();P.messenger().send(new J(n.getSceneObjectId(),n.getObjectUUID(),t,!1))}return[]}}]),n}(Rv.s);function Py(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var By=function(e){(0,g.Z)(n,e);var t=Py(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_text;return P.eventBus().dispatch(new Di(Ei.Warning,{type:"alert",message:t})),[]}}]),n}(Rv.s);function Fy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ly=function(e){(0,g.Z)(n,e);var t=Fy(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_text;return P.eventBus().dispatch(new Di(Ei.Warning,{type:"toast",message:t})),[]}}]),n}(Rv.s);function Ny(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var jy=function(e){(0,g.Z)(n,e);var t=Ny(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_text;return P.eventBus().dispatch(new Di(Ei.Warning,{type:"warning",message:t})),[]}}]),n}(Rv.s);function zy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Uy=function(e){(0,g.Z)(n,e);var t=zy(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this,t=this.getProcessManager().getProductNode().getComponent("materialGroupManager");this.mSubscriptions.push(t.resolveMaterialGroups().subscribe((function(t){e.mSubscriptions.push(t.onMaterialChanged.subscribe((function(t){e.feedInPort(new ry.q("matgroup",t,e,"material"))})))}),(function(e){})))}},{key:"onDestroy",value:function(){this.mSubscriptions.splice(0,this.mSubscriptions.length).forEach((function(e){return e.unsubscribe()}))}},{key:"onHandleInPort",value:function(e){return[e]}}]),n}(Rv.s);function Vy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Hy=function(e){(0,g.Z)(n,e);var t=Vy(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this,t=this.getProcessManager().getProductNode().getComponent("attributeManager");this.mSubscriptions.push(t.resolveAttributeManager().subscribe((function(t){e.mSubscriptions.push(t.onAttributeChanged.subscribe((function(t){e.feedInPort(new ry.q("options",t,e,"options"))})))})))}},{key:"onDestroy",value:function(){this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"onHandleInPort",value:function(e){return[e]}}]),n}(Rv.s);function Gy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var qy=function(e){(0,g.Z)(n,e);var t=Gy(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscription",void 0),(0,l.Z)((0,_.Z)(e),"mProductSceneId",void 0),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this;this.mProductSceneId=this.getProcessManager().getProductNode().getSceneObjectId(),this.mSubscription=P.eventBus().subscribe(Di.getTopicName(Ei.ProductQuestionChanged),(function(t){var n=t.getData();n.visible&&n.product_scene_id==e.mProductSceneId&&e.feedInPort(new ry.q("question_id",n.question,e,"question_id"))}))}},{key:"onDestroy",value:function(){this.mSubscription&&(this.mSubscription.unsubscribe(),delete this.mSubscription)}},{key:"onHandleInPort",value:function(e){return qe.qL.print("question changed process:",e),[e]}}]),n}(Rv.s);function Wy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Yy=function(e){(0,g.Z)(n,e);var t=Wy(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscription",void 0),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this;this.mSubscription=P.eventBus().subscribe(Di.getTopicName(Ei.BuildUpdated),(function(t){qe.qL.print("Scene built"),e.feedInPort(new ry.q("boolean",!0,e,"change"))}))}},{key:"onDestroy",value:function(){this.mSubscription.unsubscribe()}},{key:"onHandleInPort",value:function(e){return[e]}}]),n}(Rv.s);function Ky(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Xy=function(e){(0,g.Z)(n,e);var t=Ky(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscription",void 0),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this;this.mSubscription=this.getProcessManager().onLoadFinished.subscribe((function(t){t&&e.feedInPort(new ry.q("boolean",t,e,"ready"))}))}},{key:"onDestroy",value:function(){this.mSubscription&&(this.mSubscription.unsubscribe(),delete this.mSubscription)}},{key:"onHandleInPort",value:function(e){return[e]}}]),n}(Rv.s);function $y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Qy=function(e){(0,g.Z)(n,e);var t=$y(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscription",void 0),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this;this.mSubscription=P.renderer().getRenderEngine().getUiRenderer().onUiSelected.subscribe((function(t){e.feedInPort(new ry.q("ui",t,e,"click"))}))}},{key:"onDestroy",value:function(){this.mSubscription.unsubscribe()}},{key:"onHandleInPort",value:function(e){return[e]}}]),n}(Rv.s);function Jy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var eg=function(e){(0,g.Z)(n,e);var t=Jy(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscription",void 0),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this,t=this.getProcessManager().getProductNode().getComponent("attributeManager");this.mSubscription=t.onAttributeChanged.subscribe((function(t){var n=t.attribute_type;"text_input"!==n&&"text_to_image"!==n&&"operable_numbers_input"!==n||e.feedInPort(new ry.q("input",t,e,"input_id"))}))}},{key:"onDestroy",value:function(){this.mSubscription.unsubscribe()}},{key:"onHandleInPort",value:function(e){return qe.qL.print("input changed process:",e),[e]}}]),n}(Rv.s);function tg(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ng(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ng(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ng(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var ig=function(e){(0,g.Z)(a,e);var n,i=rg(a);function a(){return(0,u.Z)(this,a),i.apply(this,arguments)}return(0,c.Z)(a,[{key:"onHandleInPort",value:(n=t(r().mark((function e(t){var n,i,a,o,s,u,c,l,h,f,m,d,v,y;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],!(0,p.isNullOrUndefined)(this.getMetadata().value_input_list))try{n=JSON.parse(this.getMetadata().value_input_list)}catch(e){}return i=0,(0,p.isNullOrUndefined)(this.getMetadata().operand_value)||(i=parseInt(this.getMetadata().operand_value,10)),a=[],o=this.getProcessManager().getProductNode(),s=o.getComponent("attributeManager"),e.next=9,St(s.resolveAttributeManager());case 9:u=e.sent,c=tg(n);try{for(c.s();!(l=c.n()).done;)h=l.value,f=Number(h),(m=u.getAttribute(f))&&"operable_numbers_input"===m.type&&Array.isArray(m.attribute_values)&&m.attribute_values.length>0&&(d=m.attribute_values[0].attribute_value_valuable)&&Array.isArray(d.operands)&&i<d.operands.length&&(v=d.operands[i],qe.qL.print("operand value:",v),y={attribute_id:f,value:v.value},a.push(new ry.q("input",y,this,"value")))}catch(e){c.e(e)}finally{c.f()}return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),a}(Rv.s);function ag(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return og(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return og(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function og(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function sg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var ug=function(e){(0,g.Z)(a,e);var n,i=sg(a);function a(){return(0,u.Z)(this,a),i.apply(this,arguments)}return(0,c.Z)(a,[{key:"onHandleInPort",value:(n=t(r().mark((function e(t){var n,i,a,o,s,u,c,l,h,f,m;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],!(0,p.isNullOrUndefined)(this.getMetadata().value_input_list))try{n=JSON.parse(this.getMetadata().value_input_list)}catch(e){}return i=[],a=this.getProcessManager().getProductNode(),o=a.getComponent("attributeManager"),e.next=7,St(o.resolveAttributeManager());case 7:s=e.sent,u=ag(n);try{for(u.s();!(c=u.n()).done;)l=c.value,h=Number(l),f=s.getValueName(h),(0,p.isNullOrUndefined)(f)||(m={attribute_id:h,value:f},i.push(new ry.q("input",m,this,"value")))}catch(e){u.e(e)}finally{u.f()}return e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),a}(Rv.s);function cg(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return lg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lg(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function lg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function hg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var fg=function(e){(0,g.Z)(a,e);var n,i=hg(a);function a(){return(0,u.Z)(this,a),i.apply(this,arguments)}return(0,c.Z)(a,[{key:"onHandleInPort",value:(n=t(r().mark((function e(t){var n,i,a,o,s,u,c,l,h,m,d,v,y,g,b,M;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],!(0,p.isNullOrUndefined)(this.getMetadata().value_input_list))try{n=JSON.parse(this.getMetadata().value_input_list)}catch(e){}return i=0,(0,p.isNullOrUndefined)(this.getMetadata().operand_value)||(i=parseInt(this.getMetadata().operand_value,10)),a=[],o=this.getProcessManager().getProductNode(),s=o.getComponent("attributeManager"),e.next=9,St(s.resolveAttributeManager());case 9:u=e.sent,c=cg(n);try{for(c.s();!(l=c.n()).done;)if(h=l.value,m=Number(h),(d=u.getAttribute(m))&&"operable_numbers_input"===d.type&&Array.isArray(d.attribute_values)&&d.attribute_values.length>0&&(v=d.attribute_values[0].attribute_value_valuable)&&Array.isArray(v.operands)&&i<v.operands.length){for(y=0,g=0;g<=i;g++)b=v.operands[g].value,f.Ft.isNumeric(b)&&(y+=parseFloat(b));qe.qL.print("operand sum:",y),M={attribute_id:m,value:y},a.push(new ry.q("input",M,this,"value"))}}catch(e){c.e(e)}finally{c.f()}return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),a}(Rv.s);function pg(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return mg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mg(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function mg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function dg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var vg=function(e){(0,g.Z)(a,e);var n,i=dg(a);function a(){return(0,u.Z)(this,a),i.apply(this,arguments)}return(0,c.Z)(a,[{key:"onHandleInPort",value:(n=t(r().mark((function e(t){var n,i,a,o,s,u,c,l,h,f,m,d,v,y,g,b,M;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],!(0,p.isNullOrUndefined)(this.getMetadata().value_input_list))try{n=JSON.parse(this.getMetadata().value_input_list)}catch(e){}return i=0,(0,p.isNullOrUndefined)(this.getMetadata().operand_value)||(i=parseInt(this.getMetadata().operand_value,10)),a="min",(0,p.isNullOrUndefined)(this.getMetadata().selected_range)||(a=this.getMetadata().selected_range),o=[],s=this.getProcessManager().getProductNode(),u=s.getComponent("attributeManager"),e.next=11,St(u.resolveAttributeManager());case 11:c=e.sent,l=pg(n),e.prev=13,l.s();case 15:if((h=l.n()).done){e.next=24;break}if(f=h.value,m=Number(f),(d=c.getAttribute(m))&&Array.isArray(d.attribute_values)&&0!==d.attribute_values.length){e.next=21;break}return e.abrupt("return");case 21:"operable_numbers_input"===d.type?(v=d.attribute_values[0].attribute_value_valuable)&&Array.isArray(v.operands)&&i<v.operands.length&&(y=v.operands[i],qe.qL.print("operand minmax:",y),g={attribute_id:m,value:"min"===a?y.min_value:y.max_value},o.push(new ry.q("input",g,this,"value"))):"text_input"===d.type&&(b=d.attribute_values[0].attribute_value_valuable)&&(qe.qL.print("input minmax:",b),M={attribute_id:m,value:"min"===a?b.min:b.max},o.push(new ry.q("input",M,this,"value")));case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),l.e(e.t0);case 29:return e.prev=29,l.f(),e.finish(29);case 32:return e.abrupt("return",o);case 33:case"end":return e.stop()}}),e,this,[[13,26,29,32]])}))),function(e){return n.apply(this,arguments)})}]),a}(Rv.s);__webpack_require__(3161);function yg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var gg=function(e){(0,g.Z)(s,e);var n,i,a,o=yg(s);function s(){return(0,u.Z)(this,s),o.apply(this,arguments)}return(0,c.Z)(s,[{key:"onHandleInPort",value:(a=t(r().mark((function e(t){var n,i,a,o,s,u,c,l,h,f;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=this.getMetadata().selected_text_input,Number.isInteger(n)?(i=[n],a="maximum"):(i=n.selection||[],a=n.calculation||"maximum"),e.next=5,this.getAttributeManager();case 5:for(o=e.sent,s=[],u=0;u<i.length;u++)c=Number(i[u].id),l=Number(i[u].factor),s[u]=this.resolveAttributeWidth(o,c,Number.isNaN(l)?1:l);return e.next=10,Promise.all(s);case 10:h=e.sent.filter((function(e){return void 0!==e})),e.t0=a,e.next="minimum"===e.t0?14:"average"===e.t0?16:19;break;case 14:return f=h.reduce((function(e,t){return Math.min(e,t)})),e.abrupt("break",21);case 16:return f=h.reduce((function(e,t){return e+t})),f/=h.length,e.abrupt("break",21);case 19:return f=h.reduce((function(e,t){return Math.max(e,t)})),e.abrupt("break",21);case 21:return e.abrupt("return",[new ry.q("number",{value:f},this,"value")]);case 24:return e.prev=24,e.t1=e.catch(0),qe.qL.error("Unable to process rule.",e.t1),e.abrupt("return",[]);case 28:case"end":return e.stop()}}),e,this,[[0,24]])}))),function(e){return a.apply(this,arguments)})},{key:"resolveAttributeWidth",value:(i=t(r().mark((function e(t,n){var i,a,o,s,u,c=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=c.length>2&&void 0!==c[2]?c[2]:1,!Number.isNaN(n)){e.next=3;break}return e.abrupt("return",void 0);case 3:return(a=t.getAttributeController(n)).updateValues(),e.next=7,a.dispatchToRenderer();case 7:return o=a.getResourceController(),s=a.resolveValuable(),u=a.getValue(),e.abrupt("return",o.getTextWidth(s,u)*i);case 11:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"getAttributeManager",value:(n=t(r().mark((function e(){var t,n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getProcessManager().getProductNode(),n=t.getComponent("attributeManager"),e.abrupt("return",St(n.resolveAttributeManager()));case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),s}(Rv.s);function bg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Mg=function(e){(0,g.Z)(n,e);var t=bg(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_camera,n=P.sceneManager().getActiveCameraId();return(0,p.isNullOrUndefined)(t)||t!=n?[new ry.q("number",t,this,"no")]:[new ry.q("number",t,this,"yes")]}}]),n}(Rv.s);function kg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var _g=function(e){(0,g.Z)(n,e);var t=kg(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_view,n=P.sceneManager().getActiveView();return(0,p.isNullOrUndefined)(t)||(0,p.isNullOrUndefined)(n)||t!=n.getSceneObjectId()?[new ry.q("number",t,this,"no")]:[new ry.q("number",t,this,"yes")]}}]),n}(Rv.s);function xg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Tg=function(e){(0,g.Z)(n,e);var t=xg(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"onMatManagerSubject",null),(0,l.Z)((0,_.Z)(e),"mMaterialGroupManager",null),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this;this.onMatManagerSubject=new Ht;var t=this.getProcessManager().getProductNode().getComponent("materialGroupManager");this.mSubscriptions.push(t.resolveMaterialGroups().subscribe((function(t){null!==e.mSubscriptions&&null===e.mMaterialGroupManager&&(e.mMaterialGroupManager=t,e.onMatManagerSubject.next(t))}),(function(t){null===e.mMaterialGroupManager&&null!==e.onMatManagerSubject&&e.onMatManagerSubject.error("Failed to get material manager")})))}},{key:"onDestroy",value:function(){null!==this.onMatManagerSubject&&this.onMatManagerSubject.error("destroyed"),this.onMatManagerSubject=null,this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"onHandleInPort",value:function(e){var t=this,n=[];if((0,p.isNullOrUndefined)(this.getMetadata().value_matgroup_list))(0,p.isNullOrUndefined)(this.getMetadata().value_matgroup)||n.push(this.getMetadata().value_matgroup);else try{n=JSON.parse(this.getMetadata().value_matgroup_list)}catch(e){}var r="any";return(0,p.isNullOrUndefined)(this.getMetadata().option_condition)||(r=this.getMetadata().option_condition),null!==this.mMaterialGroupManager?this.decideActiveMaterial(n,r,e.data):new Promise((function(i,a){t.onMatManagerSubject.pipe(di()).subscribe((function(){i(t.decideActiveMaterial(n,r,e.data))}),(function(e){a(e)}))}))}},{key:"decideActiveMaterial",value:function(e,t,n){var r=this,i=0,a=0;e.forEach((function(e){i+=1;var t=e.split(":");2==t.length&&f.Ft.isNumeric(t[0])&&f.Ft.isNumeric(t[1])&&(r.mMaterialGroupManager.getActiveRefId(parseInt(t[0],10))==parseInt(t[1],10)&&(a+=1))}));var o="no";switch(t){case"any":a>0&&(o="yes");break;case"all":a===i&&(o="yes");break;case"none":0===a&&(o="yes")}return[new ry.q("matgroup",n,this,o)]}}]),n}(Rv.s);function wg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Rg=function(e){(0,g.Z)(n,e);var t=wg(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"onOffsetManagerSubject",void 0),(0,l.Z)((0,_.Z)(e),"mSceneOffsetManager",void 0),e}return(0,c.Z)(n,[{key:"onInit",value:function(){var e=this,t=this.getProcessManager().getProductNode();this.onOffsetManagerSubject=new Ht,this.mSubscriptions.push(t.onConfigurableNodeReady.subscribe((function(t){t.resolveSceneOffsetManager().then((function(t){if(e.mSubscriptions.length)return e.mSceneOffsetManager||(e.mSceneOffsetManager=t,e.onOffsetManagerSubject.next(t)),t}),(function(){!e.mSceneOffsetManager&&e.onOffsetManagerSubject&&e.onOffsetManagerSubject.error("failed to get offset manager")}))})))}},{key:"onDestroy",value:function(){this.onOffsetManagerSubject&&(this.onOffsetManagerSubject.error("destroyed"),delete this.onOffsetManagerSubject),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"onHandleInPort",value:function(e){var t=this,n=Number(this.getMetadata().value_offset),r=this.getMetadata().value_level||0,i=this.getMetadata().value_vec_x||0,a=this.getMetadata().value_vec_y||0,o=this.getMetadata().value_vec_z||0;if(!Number.isFinite(n))return[new ry.q(e.type,e.data,this,"no")];var s=new Bi(i,a,o);return this.mSceneOffsetManager?this.decideVectorSame(n,r,s,e.data):new Promise((function(i,a){t.onOffsetManagerSubject.pipe(di()).subscribe({next:function(){i(t.decideVectorSame(n,r,s,e.data))},error:function(e){a(e)}})}))}},{key:"decideVectorSame",value:function(e,t,n,r){var i=this.mSceneOffsetManager.getOffsetVector(e,t),a=i&&n.sub(i).lengthSq()<1;return[new ry.q("offsets",r,this,a?"yes":"no")]}}]),n}(Rv.s);function Zg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Sg=function(e){(0,g.Z)(a,e);var n,i=Zg(a);function a(){return(0,u.Z)(this,a),i.apply(this,arguments)}return(0,c.Z)(a,[{key:"onHandleInPort",value:function(e){var t=this,n=[];if((0,p.isNullOrUndefined)(this.getMetadata().value_option_list))(0,p.isNullOrUndefined)(this.getMetadata().value_option)||n.push(this.getMetadata().value_option);else try{n=JSON.parse(this.getMetadata().value_option_list)}catch(e){}var r=[];n.forEach((function(e){var t=e.split(":");if(2===t.length||3===t.length)try{var n=null;if(3===t.length){var i=t[2].match(/^(\d+)\((.*)\)$/);3===i.length&&(n=i[2])}var a=r.find((function(e){return e.product_uuid===n}));(0,p.isNullOrUndefined)(a)&&(a={product_uuid:n,option_list:[]},r.push(a)),a.option_list.push({question_id:parseInt(t[0],10),option_id:parseInt(t[1],10)})}catch(e){}}));var i="any";(0,p.isNullOrUndefined)(this.getMetadata().option_condition)||(i=this.getMetadata().option_condition);var a=[];return r.forEach((function(e){a.push(t.checkAttributeCondition(e.product_uuid,e.option_list,i))})),new Promise((function(n,r){if(0===a.length)return r("not products");jo(a).pipe(sn(1)).subscribe((function(r){var a=r.length,o=r.filter((function(e){return!0===e})).length,s="no";switch(i){case"any":o>0&&(s="yes");break;case"all":case"none":o===a&&(s="yes")}n([new ry.q(e.type,e.data,t,s)])}),(function(e){r(e)}))}))}},{key:"checkAttributeCondition",value:(n=t(r().mark((function e(t,n,i){var a=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var o=null;if((0,p.isNullOrUndefined)(t))o=a.getProcessManager().getProductNode();else{var s=P.sceneManager().findNodesOfTypeName("ProductNode",(function(e){return e.getValue("object_uuid")===t}));s.length>0&&(o=s[0])}if(null===o)return r("product with uuid '"+t+"' not found");o.getComponent("attributeManager").resolveAttributeManager().subscribe((function(t){var r=0,a=0;n.forEach((function(e){r+=1;var n=t.getValue(e.question_id);(0,p.isNullOrUndefined)(n)||n.attribute_value_id!=e.option_id||(a+=1)}));var o=!1;switch(i){case"any":a>0&&(o=!0);break;case"all":a===r&&(o=!0);break;case"none":0===a&&(o=!0)}e(o)}),(function(e){r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})}]),a}(Rv.s);function Cg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ig=function(e){(0,g.Z)(n,e);var t=Cg(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){try{var t=JSON.parse(this.getMetadata().value_string_list);if(!(0,p.isUndefined)(t)&&t.findIndex((function(t){return t===e.data}))>=0)return[new ry.q("string",e.data,this,"yes")]}catch(e){}return[new ry.q("string",e.data,this,"no")]}}]),n}(Rv.s);function Eg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ag=function(e){(0,g.Z)(n,e);var t=Eg(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=[];if((0,p.isNullOrUndefined)(this.getMetadata().value_matgroup_list))(0,p.isNullOrUndefined)(this.getMetadata().value_matgroup)||t.push(this.getMetadata().value_matgroup);else try{t=JSON.parse(this.getMetadata().value_matgroup_list)}catch(e){}var n="any";(0,p.isNullOrUndefined)(this.getMetadata().option_condition)||(n=this.getMetadata().option_condition);var r=0,i=0;"matgroup"===e.type&&t.forEach((function(t){r+=1;var n=t.split(":");2===n.length&&e.data.id==n[0]&&e.data.ref_id==n[1]&&(i+=1)}));var a="no";switch(n){case"any":i>0&&(a="yes");break;case"all":i===r&&(a="yes");break;case"none":0===i&&(a="yes")}return[new ry.q(e.type,e.data,this,a)]}}]),n}(Rv.s);function Og(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Dg=function(e){(0,g.Z)(o,e);var n,i,a=Og(o);function o(){return(0,u.Z)(this,o),a.apply(this,arguments)}return(0,c.Z)(o,[{key:"onHandleInPort",value:(i=t(r().mark((function e(t){var n,i,a,o,s=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],(0,p.isNullOrUndefined)(this.getMetadata().value_option_list))(0,p.isNullOrUndefined)(this.getMetadata().value_option)||n.push(this.getMetadata().value_option);else try{n=JSON.parse(this.getMetadata().value_option_list)}catch(e){}return i=[],n.forEach((function(e){var t=e.split(":");if(2===t.length||3===t.length)try{var n=null;if(3===t.length){var r=t[2].match(/^(\d+)\((.*)\)$/);3===r.length&&(n=r[2])}var a=i.find((function(e){return e.product_uuid===n}));(0,p.isNullOrUndefined)(a)&&(a={product_uuid:n,option_list:[]},i.push(a)),a.option_list.push({question_id:parseInt(t[0],10),option_id:parseInt(t[1],10)})}catch(e){}})),a="any",(0,p.isNullOrUndefined)(this.getMetadata().option_condition)||(a=this.getMetadata().option_condition),o=[],i.forEach((function(e){o.push(s.checkAttributeSelected(e.product_uuid,e.option_list,a,t))})),e.abrupt("return",new Promise((function(e,n){if(0==o.length)return n("no products");jo(o).pipe(sn(1)).subscribe((function(n){var r=n.length,i=n.filter((function(e){return!0===e})).length,o="no";switch(a){case"any":i>0&&(o="yes");break;case"all":case"none":i===r&&(o="yes")}e([new ry.q(t.type,t.data,s,o)])}),(function(e){n(e)}))})));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"checkAttributeSelected",value:(n=t(r().mark((function e(t,n,i,a){var o=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var s=null;if((0,p.isNullOrUndefined)(t))s=o.getProcessManager().getProductNode();else{var u=P.sceneManager().findNodesOfTypeName("ProductNode",(function(e){return e.getValue("object_uuid")===t}));u.length>0&&(s=u[0])}if(null===s)return r("product with uuid '"+t+"' not found");var c=0,l=0;if("options"===a.type){var h=a.data;qe.qL.print("comparing option condition against event:",h),n.forEach((function(e){c+=1,e.question_id==h.attribute_id&&e.option_id==h.attribute_value_id&&(l+=1)}))}var f=!1;switch(i){case"any":l>0&&(f=!0);break;case"all":l===c&&(f=!0);break;case"none":0===l&&(f=!0)}e(f)})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r,i){return n.apply(this,arguments)})}]),o}(Rv.s);function Pg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Bg=function(e){(0,g.Z)(n,e);var t=Pg(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_question;return(0,p.isNullOrUndefined)(t)||t!=e.data?[new ry.q("question_id",e.data,this,"no")]:[new ry.q("question_id",e.data,this,"yes")]}}]),n}(Rv.s);function Fg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Lg=function(e){(0,g.Z)(n,e);var t=Fg(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=[];if(!(0,p.isNullOrUndefined)(this.getMetadata().value_input_list))try{t=JSON.parse(this.getMetadata().value_input_list)}catch(e){}var n="any";(0,p.isNullOrUndefined)(this.getMetadata().option_condition)||(n=this.getMetadata().option_condition);var r=0,i=0;"input"===e.type&&t.forEach((function(t){r+=1,e.data.attribute_id===Number(t)&&(i+=1)}));var a="no";switch(n){case"any":i>0&&(a="yes");break;case"all":i===r&&(a="yes");break;case"none":0===i&&(a="yes")}return[new ry.q(e.type,e.data,this,a)]}}]),n}(Rv.s);function Ng(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var jg=function(e){(0,g.Z)(n,e);var t=Ng(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=parseFloat(this.getMetadata().compare_value)||0,n=this.getMetadata().compare_function||"=",r=this.getValue(e),i=this.compare(t,n,r)?"yes":"no",a=e.type,o=e.data;return[new ry.q(a,o,this,i)]}},{key:"getValue",value:function(e){var t=e.type,n=e.data;switch(t){case"input":return this.getValueFromInput(n);case"number":return n.value;default:return NaN}}},{key:"getValueFromInput",value:function(e){switch(e.attribute_type){case"operable_numbers_input":case"text_to_image":case"text_input":return parseFloat(e.attribute_value_name);default:return parseFloat(e.value)}}},{key:"compare",value:function(e,t,n){switch(t){case"=":case"==":return e==n;case">":return e>n;case"<":return e<n;case">=":return e>=n;case"<=":return e<=n;case"!=":return e!=n;default:return!1}}}]),n}(Rv.s);function zg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ug=function(e){(0,g.Z)(n,e);var t=zg(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_string;return(0,p.isUndefined)(t)||t!==e.data?[new ry.q("string",e.data,this,"no")]:[new ry.q("string",e.data,this,"yes")]}}]),n}(Rv.s);function Vg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Hg=function(e){(0,g.Z)(n,e);var t=Vg(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_question;return(0,p.isNullOrUndefined)(t)||t!=e.data.attribute_id?[new ry.q("attribute_id",e.data,this,"no")]:[new ry.q("attribute_id",e.data,this,"yes")]}}]),n}(Rv.s);function Gg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var qg=function(e){(0,g.Z)(n,e);var t=Gg(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_string;return(0,p.isNullOrUndefined)(e.data)||e.data.attribute_value_name!=t?[new ry.q(e.type,e.data,this,"no")]:[new ry.q(e.type,e.data,this,"yes")]}}]),n}(Rv.s);function Wg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Yg=function(e){(0,g.Z)(n,e);var t=Wg(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t=[];if(!(0,p.isNullOrUndefined)(this.getMetadata().value_object_list))try{t=JSON.parse(this.getMetadata().value_object_list)}catch(e){}var n="any";(0,p.isNullOrUndefined)(this.getMetadata().option_condition)||(n=this.getMetadata().option_condition);var r=0,i=0;if("ui"===e.type){var a=e.data;t.forEach((function(e){var t=Number(e);r+=1,t===a.getSceneObjectId()&&(i+=1)}))}var o="no";switch(n){case"any":i>0&&(o="yes");break;case"all":i===r&&(o="yes");break;case"none":0===i&&(o="yes")}return[new ry.q(e.type,e.data,this,o)]}}]),n}(Rv.s);function Kg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Xg=function(e){(0,g.Z)(n,e);var t=Kg(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onHandleInPort",value:function(e){var t="no";return!0===P.stateRegistery().get("reconfigure")&&(t="yes"),[new ry.q(e.type,e.data,this,t)]}}]),n}(Rv.s);function $g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Qg=function(e){(0,g.Z)(a,e);var n,i=$g(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mDebounceTimout",void 0),e}return(0,c.Z)(a,[{key:"onHandleInPort",value:(n=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){qe.qL.print("Debounce rule called."),void 0!==n.mDebounceTimout&&(qe.qL.print("Debounced!"),window.clearTimeout(n.mDebounceTimout),delete n.mDebounceTimout);var r=n.getMetadata().value_mstime||0;qe.qL.print("Debounce wait another:",r),n.mDebounceTimout=window.setTimeout((function(){delete n.mDebounceTimout,qe.qL.print("Debounce execute"),e([new ry.q(t.type,t.data,n,"forward")])}),r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}]),a}(Rv.s);function Jg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var eb=function(e){(0,g.Z)(a,e);var n,i=Jg(a);function a(){return(0,u.Z)(this,a),i.apply(this,arguments)}return(0,c.Z)(a,[{key:"onHandleInPort",value:(n=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=n.getMetadata().value_mstime||0;window.setTimeout((function(){e([new ry.q(t.type,t.data,n,"forward")])}),r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}]),a}(Rv.s);function tb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var nb=function(e){(0,g.Z)(n,e);var t=tb(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onInit",value:function(){}},{key:"onDestroy",value:function(){}},{key:"onHandleInPort",value:function(){var e=this.getMetadata();return P.eventBus().dispatch(new Di(Ei.PlaySound,e.sound)),[]}}]),n}(Rv.s);function rb(){window.location.href.startsWith("data:text/html,<script>")&&(window.URL=window.URL||window.webkitURL,window.xpvJail={workers:{},handleJailMessage:function(e,t){var n=t.data,r=n.type,i=n.content;switch(r){case"function-call":window.parent.postMessage({messageId:t.data.messageId,scriptId:e,sandboxId:window.xpvJail.workers[e].sandbox,type:r,content:i},"*");break;case"finished":window.xpvJail.killScript(e),window.xpvJail.workers[e].resolver(i),delete window.xpvJail.workers[e]}},runScriptInJail:function(e,t,n,r,i){var a=this.constructJail(e,i,r,n);return new Promise((function(r,i){try{if(!window.Worker)return void i({cause:"web-workers-not-supported"});var o=new Worker(function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/javascript";try{t=new Blob([e],{type:n})}catch(n){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;var r=new BlobBuilder;r.append(e),t=r.getBlob()}return window.URL.createObjectURL(t)}(a));window.xpvJail.workers[e]={executor:o,resolver:function(e){r(e)},rejector:i,sandbox:t};var s=function(e){var t=e;if(!(e instanceof ErrorEvent)){if("error"!==e.data.type)return;t=e.data.content}console.warn("[jail] Went wrong in jail",n),i(t)};o.addEventListener("error",s),o.addEventListener("message",s),o.addEventListener("message",window.xpvJail.handleJailMessage.bind(null,e))}catch(e){i(e)}}))},killScript:function(e){void 0!==window.xpvJail.workers[e]&&(window.xpvJail.workers[e].executor.onerror=void 0,window.xpvJail.workers[e].executor.onmessage=void 0,window.xpvJail.workers[e].executor.terminate())},constructJail:function(e,t,n,r){var i="<script>/* runs inside the worker */\n                var _app = {\n                    scriptId: '10000000-1000-4000-8000-100000000000',\n                    _flyingMessages: {},\n                    postMessageWithResult(type, content = undefined) {\n                        var uuidv4 = function() {\n                            var crypto = self.crypto || self.msCrypto || false;\n                            if (crypto) {\n                                return ('' + 1e7 + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, function(c) {\n                                    return Number(c) ^ (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (Number(c) / 4)));\n                                }).toString(16);\n                            } else {\n                                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n                                    const r = (Math.random() * 16) | 0, v = c == 'x' ? r : (r & 0x3) | 0x8;\n                                    return v.toString(16);\n                                });\n                            }\n                        };\n                        var id = uuidv4();\n                        while (this._flyingMessages[id] !== undefined) {\n                            id = uuidv4();\n                        }\n                        this._flyingMessages[id] = null; /* ensure no-one else gets this key. */\n                        return new Promise(function(resolve, reject) {\n                            this._flyingMessages[id] = function(msgContent, success = true) {\n                                return success ? resolve(msgContent) : reject(msgContent);\n                            };\n                            self.postMessage({\n                                scriptId: this.scriptId,\n                                messageId: id,\n                                type,\n                                content\n                            });\n                        });\n                    },\n                    postMessage(type, content = undefined) { self.postMessage({ type, content }); },\n                    message(content) { this.postMessage('message', content); },\n                    handleIncomingMessage(message) {\n                        var { id, success, content } = message.data;\n                        var resolver = this._flyingMessages[id];\n                        if (resolver) resolver(content, success || false);\n                    },\n                    ready() { this.postMessage('ready'); },\n                    result(value) { this.postMessage('finished', value); },\n                };\n                self.addEventListener('message', function(msg) {\n                    return _app.handleIncomingMessage(msg);\n                });\n                _app.ready();\n            ";i=i.substr(i.indexOf("<script>")+8);for(var a="_app.scriptId = '".concat(e,"';\n"),o=0;o<t.length;o++){var s=t[o];a+="_app.".concat(s," = function() {\n")+"\tlet args = Array.prototype.slice.call(arguments);\n"+"\treturn this.postMessageWithResult('function-call',{name:'".concat(s,"', arguments: args});")+"};\n"}var u="const _ctx = ".concat(JSON.stringify(n),";");return"".concat(i,";\n").concat(a,";\n").concat(u,";\n").concat(r,";\n                Promise.resolve(run())\n                    .catch(function(error) { return _app.postMessage('error', error); })\n                    .then(function(result) { return _app.result(result); });")}},window.addEventListener("message",(function(e){var t=e.data;switch(t.type){case"run-script":window.xpvJail.runScriptInJail(t.messageId,t.sandboxId,atob(t.content.code),t.content.context,t.content.interactions).then((function(n){var r={messageId:t.messageId,type:"script-finished",content:n};window.parent.postMessage(r,e.origin)}));break;case"kill-script":window.xpvJail.killScript(t.content);break;case"function-result":window.xpvJail.workers[t.scriptId]?window.xpvJail.workers[t.scriptId].executor.postMessage({id:t.messageId,success:!0,content:t.content}):console.warn("[jail] Worker doesn't exist anymore, did you forget to await a function result?")}})),window.parent.postMessage({type:"ready"},"*"))}var ib=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"sandboxId",void 0);var t=e.generateUniqueUuidForObject(e.interactions);e.interactions[t]={},this.sandboxId=t,e.sandbox||(e.ready=new Promise((function(t){return e.flyingMessages.ready=t})),e.sandbox=document.createElement("iframe"),e.sandbox.setAttribute("sandbox","allow-scripts"),e.sandbox.style.display="none",e.sandbox.src="data:text/html,<script>(".concat(rb,")()<\/script>"),window.addEventListener("message",(function(t){t.source===e.sandbox.contentWindow&&e.messageListener(t.data)})),document.body.appendChild(e.sandbox))}var n,i;return(0,c.Z)(e,[{key:"executeScript",value:(i=t(r().mark((function t(n){var i,a,o=arguments;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=o.length>1&&void 0!==o[1]?o[1]:{},a=o.length>2&&void 0!==o[2]?o[2]:200,t.abrupt("return",e.sendResponseExpectingMessage({sandboxId:this.sandboxId,type:"run-script",content:{code:n,context:i,interactions:Object.keys(e.interactions[this.sandboxId]||{})}},a));case 3:case"end":return t.stop()}}),t,this)}))),function(e){return i.apply(this,arguments)})},{key:"registerInteractions",value:function(t){e.interactions[this.sandboxId]=t}}],[{key:"generateUniqueUuidForObject",value:function(e){for(var t=y.F.uuidV4();void 0!==e[t];)qe.qL.warn("Uuid collision detected... generating another one."),t=y.F.uuidV4();return t}},{key:"messageListener",value:function(t){var n;"function-call"!==t.type?("script-finished"===t.type&&void 0!==t.messageId&&(e.flyingMessages[t.messageId](t.content),delete e.flyingMessages[t.messageId]),"ready"===t.type&&(qe.qL.print("[jail] Ready to be used!"),e.flyingMessages.ready(t.content),delete e.flyingMessages.ready)):Promise.resolve((n=e.interactions[t.sandboxId])[t.content.name].apply(n,s(t.content.arguments))).then((function(n){var r={sandboxId:t.sandboxId,scriptId:t.scriptId,messageId:t.messageId,type:"function-result",content:n};e.sendMessage(r)}))}},{key:"sendMessage",value:function(t){e.sandbox.contentWindow.postMessage(t,"*")}},{key:"sendResponseExpectingMessage",value:(n=t(r().mark((function t(n){var i,a,o=arguments;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=o.length>1&&void 0!==o[1]?o[1]:200,a=e.generateUniqueUuidForObject(e.flyingMessages),e.flyingMessages[a]=null,t.next=5,e.ready;case 5:return t.abrupt("return",new Promise((function(t,r){var o=Object.assign(n,{messageId:a}),s=window.setTimeout((function(){r("Script didn't finish in time\n"),e.sendMessage({sandboxId:n.sandboxId,type:"kill-script",content:a}),delete e.flyingMessages[a]}),i);e.flyingMessages[a]=function(e){window.clearTimeout(s),t(e)},e.sandbox.contentWindow.postMessage(o,"*")})));case 6:case"end":return t.stop()}}),t)}))),function(e){return n.apply(this,arguments)})}]),e}();function ab(e,t){return at(t)?nl(e,t,1):nl(e,1)}function ob(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return sb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sb(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function sb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ub(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(ib,"ready",void 0),(0,l.Z)(ib,"sandbox",void 0),(0,l.Z)(ib,"flyingMessages",{}),(0,l.Z)(ib,"interactions",{});var cb=function(e){(0,g.Z)(o,e);var n,i,a=ub(o);function o(){var e;(0,u.Z)(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=a.call.apply(a,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"flow",new Ht),e}return(0,c.Z)(o,[{key:"onInit",value:function(){}},{key:"onDestroy",value:function(){}},{key:"executeInSandbox",value:(i=t(r().mark((function e(t){var n,i,a,o,s,u,c,l,h,f,p;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getMetadata().script||"",i=new ib,e.prev=2,o=this.getProcessManager().getProductNode(),s=o.getComponent("attributeManager"),e.next=7,s.resolveAttributeManager().toPromise();case 7:u=e.sent,c=[],l=u.getAttributeControllers(),h=ob(l);try{for(h.s();!(f=h.n()).done;)p=f.value,c.push(p.getAttribute())}catch(e){h.e(e)}finally{h.f()}return e.next=14,i.executeScript(n,{nodeInput:t.data,attributes:c},3e4);case 14:a=e.sent,e.next=20;break;case 17:e.prev=17,e.t0=e.catch(2),qe.qL.error(e.t0);case 20:return e.abrupt("return",[new ry.q("all",{value:a},this,"output")]);case 21:case"end":return e.stop()}}),e,this,[[2,17]])}))),function(e){return i.apply(this,arguments)})},{key:"onHandleInPort",value:(n=t(r().mark((function e(t){var n,i=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Promise((function(e){i.flow.pipe(ab((function(e){return Co(i.executeInSandbox(e))})),sn(1)).subscribe((function(t){e(t)}))})),this.flow.next(t),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),o}(Rv.s);function lb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var hb=function(e){(0,g.Z)(n,e);var t=lb(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onInit",value:function(){}},{key:"onDestroy",value:function(){}},{key:"onHandleInPort",value:function(e){var t=this,n=this.getMetadata().value_question;if((0,p.isNullOrUndefined)(n))return[];var r=this.getProcessManager().getProductNode().getComponent("attributeManager");return new Promise((function(e,i){r.resolveAttributeManager().subscribe((function(r){var i=r.getValue(n);(0,p.isNullOrUndefined)(i)&&e([]),e([new ry.q("input",{attribute_id:n,value:i.value},t,"value")])}),(function(e){return i(e)}))}))}}]),n}(Rv.s);function fb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fb(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function mb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var db=function(e){(0,g.Z)(n,e);var t=mb(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"onInit",value:function(){}},{key:"onDestroy",value:function(){}},{key:"onHandleInPort",value:function(e){var t=this.getMetadata().value_question,n=this.getMetadata().color;if(!t||!n)return[];var r=this.getProcessManager().getProductNode().getComponent("attributeManager");return new Promise((function(i,a){r.resolveAttributeManager().subscribe((function(r){var a=r.getAttributeController(t);a.setValue(pb(pb({},a.getValue()),{},(0,l.Z)({},n.type,e.data.value))),i([])}),(function(e){return a(e)}))}))}}]),n}(Rv.s);function vb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var yb=function(e){(0,g.Z)(o,e);var n,i,a=vb(o);function o(){return(0,u.Z)(this,o),a.apply(this,arguments)}return(0,c.Z)(o,[{key:"onHandleInPort",value:(i=t(r().mark((function e(t){var n,i,a,o,s,u,c;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=JSON.parse(null!==(n=null===(i=this.getMetadata())||void 0===i?void 0:i.value_selected_palletization_attribute)&&void 0!==n?n:null),u=JSON.parse(null!==(a=null===(o=this.getMetadata())||void 0===o?void 0:o.value_selected_colors)&&void 0!==a?a:null),!s||!u){e.next=8;break}return c=this.getProcessManager().getProductNode(),e.next=7,this.processAttributeColorsBasedOnVisibilityRules(c,s,u);case 7:return e.abrupt("return",e.sent);case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(0);case 12:return e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(e){return i.apply(this,arguments)})},{key:"processAttributeColorsBasedOnVisibilityRules",value:(n=t(r().mark((function e(t,n,i){var a,o,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.getComponent("attributeManager"),e.next=3,St(a.resolveAttributeManager());case 3:return o=e.sent,(s=o.getAttributeController(n)).getAttribute()&&s.setVisibilityPalletizationColors(i),e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})}]),o}(Rv.s),gb=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,null,[{key:"processes",value:function(){var t={};return Object.keys(e).forEach((function(n){var r=e[n];void 0!==r&&("string"==typeof r.name||r.name instanceof String)&&(t[r.name]=r.process)})),t}}]),e}();(0,l.Z)(gb,"CHECKS_ACTION_HIDE_OFFSET",{name:"checks/action/hide-offset",process:Ay}),(0,l.Z)(gb,"ACTIONS_HIDE_QUESTION",{name:"actions/hide/question",process:Dy}),(0,l.Z)(gb,"ACTIONS_MESSAGE_ALERT",{name:"actions/message/alert",process:By}),(0,l.Z)(gb,"ACTIONS_MESSAGE_TOAST",{name:"actions/message/toast",process:Ly}),(0,l.Z)(gb,"ACTIONS_MESSAGE_WARNING",{name:"actions/message/warning",process:jy}),(0,l.Z)(gb,"ACTIONS_ROTATE_OFFSET",{name:"actions/rotate/offset",process:Sv}),(0,l.Z)(gb,"ACTIONS_SELECT_CAMERA",{name:"actions/select/camera",process:Iv}),(0,l.Z)(gb,"ACTIONS_SELECT_VIEW",{name:"actions/select/view",process:Av}),(0,l.Z)(gb,"ACTIONS_SELECT_OPTION",{name:"actions/select/option",process:Dv}),(0,l.Z)(gb,"ACTIONS_SELECT_COLOR",{name:"actions/select/color",process:Bv}),(0,l.Z)(gb,"ACTIONS_SET_MATGROUP",{name:"actions/set/matgroup",process:Lv}),(0,l.Z)(gb,"ACTIONS_SET_OFFSET",{name:"actions/set/offset",process:jv}),(0,l.Z)(gb,"CHECKS_ACTION_SHOW_OFFSET",{name:"checks/action/show-offset",process:Uv}),(0,l.Z)(gb,"ACTIONS_SHOW_QUESTION",{name:"actions/show/question",process:Hv}),(0,l.Z)(gb,"ACTIONS_VISIBILITY_COLOR",{name:"actions/visibility/color",process:qv}),(0,l.Z)(gb,"ACTIONS_VISIBILITY_MATGROUP",{name:"actions/visibility/material",process:Yv}),(0,l.Z)(gb,"ACTIONS_VISIBILITY_OPTIONS",{name:"actions/visibility/option",process:Xv}),(0,l.Z)(gb,"ACTIONS_VISIBILITY_QUESTION",{name:"actions/visibility/question",process:Qv}),(0,l.Z)(gb,"ACTIONS_VISIBILITY_MATPRICE",{name:"actions/visibility/matprice",process:ey}),(0,l.Z)(gb,"ACTIONS_DISABLE_OPTIONS",{name:"actions/visibility/disable-option",process:ny}),(0,l.Z)(gb,"ACTIONS_PLAY_SOUND",{name:"actions/play/sound",process:nb}),(0,l.Z)(gb,"ACTIONS_VISIBILITY_PALLETIZATION_COLORS",{name:"actions/visibility/palletization-colors",process:yb}),(0,l.Z)(gb,"BROADCAST_MATGROUP",{name:"broadcast/matgroup",process:Uy}),(0,l.Z)(gb,"BROADCAST_OPTION",{name:"broadcast/option",process:Hy}),(0,l.Z)(gb,"BROADCAST_QUESTION",{name:"broadcast/question",process:qy}),(0,l.Z)(gb,"BROADCAST_SCENE_BUILT",{name:"broadcast/scene/built",process:Yy}),(0,l.Z)(gb,"BROADCAST_SCENE_INITIALIZED",{name:"broadcast/scene/initialized",process:Xy}),(0,l.Z)(gb,"BROADCAST_UI_CLICKED",{name:"broadcast/ui/clicked",process:Qy}),(0,l.Z)(gb,"BROADCAST_INPUT",{name:"boardcast/input",process:eg}),(0,l.Z)(gb,"BROADCAST_OPERABLE_VALUE",{name:"broadcast/operation",process:ig}),(0,l.Z)(gb,"BROADCAST_VALUE",{name:"broadcast/value",process:hb}),(0,l.Z)(gb,"BROADCAST_VALUE_NAME",{name:"broadcast/value-name",process:ug}),(0,l.Z)(gb,"BROADCAST_OPERABLE_SUM",{name:"sum/operation",process:fg}),(0,l.Z)(gb,"BORADCAST_INPUT_MIN_MAX",{name:"broadcast/minmax",process:vg}),(0,l.Z)(gb,"BROADCAST_TEXT_WIDTH",{name:"broadcast/text-width",process:gg}),(0,l.Z)(gb,"CHECKS_ACTIVE_CAMERA",{name:"checks/active-camera",process:Mg}),(0,l.Z)(gb,"CHECKS_ACTIVE_VIEW",{name:"checks/active-view",process:_g}),(0,l.Z)(gb,"CHECKS_ACTIVE_MATGROUP",{name:"checks/active-matgroup",process:Tg}),(0,l.Z)(gb,"CHECKS_ACTIVE_OFFSET",{name:"checks/active-offset",process:Rg}),(0,l.Z)(gb,"CHECKS_ACTIVE_OPTION",{name:"checks/active-option",process:Sg}),(0,l.Z)(gb,"CHECKS_LIST",{name:"checks/list",process:Ig}),(0,l.Z)(gb,"CHECKS_MAT_REFERENCE",{name:"checks/matref",process:Ag}),(0,l.Z)(gb,"CHECKS_OPTION",{name:"checks/option",process:Dg}),(0,l.Z)(gb,"CHECKS_QUESTION",{name:"checks/question",process:Bg}),(0,l.Z)(gb,"CHECKS_INPUT",{name:"checks/input",process:Lg}),(0,l.Z)(gb,"CHECKS_OPERABLE_VALUE",{name:"checks/operation",process:jg}),(0,l.Z)(gb,"CHECKS_STRING",{name:"checks/string",process:Ug}),(0,l.Z)(gb,"CHECKS_ATTRIBUTE_TRIGGERED",{name:"checks/attribute-triggered",process:Hg}),(0,l.Z)(gb,"CHECKS_ATTRIBUTE_VALUE_NAME",{name:"checks/attribute-value-name",process:qg}),(0,l.Z)(gb,"CHECKS_UI",{name:"checks/ui",process:Yg}),(0,l.Z)(gb,"CHECKS_ACTIVE_RECONFIGURE",{name:"checks/reconfigure",process:Xg}),(0,l.Z)(gb,"ACTIONS_FORWARD",{name:"action/forward",process:ay}),(0,l.Z)(gb,"ACTIONS_SET_LINE_TITLE",{name:"action/set-line-title",process:sy}),(0,l.Z)(gb,"ACTIONS_SET_INPUT",{name:"action/set-input",process:hy}),(0,l.Z)(gb,"ACTIONS_SET_COLOR",{name:"action/set-color",process:py}),(0,l.Z)(gb,"ACTIONS_SET_MAP",{name:"action/set-map",process:dy}),(0,l.Z)(gb,"ACTIONS_SET_GRADIENT_COLOR",{name:"action/set-gradient-color",process:db}),(0,l.Z)(gb,"ACTIONS_SET_OPERABLE",{name:"action/set-operable",process:by}),(0,l.Z)(gb,"ACTIONS_CHANGE_INPUT_MINMAX",{name:"action/change-minmax",process:ky}),(0,l.Z)(gb,"ACTIONS_UPDATE_ATTRIBUTE",{name:"action/update-attribute",process:xy}),(0,l.Z)(gb,"ACTIONS_SET_INPUT_MINMAX",{name:"action/set-minmax",process:wy}),(0,l.Z)(gb,"ACTIONS_SET_TEXT",{name:"action/set-text",process:Zy}),(0,l.Z)(gb,"ACTIONS_ARITHMETIC",{name:"action/arithmetic",process:Sy.$}),(0,l.Z)(gb,"ACTIONS_EXECUTE_SCRIPT",{name:"action/script-execute",process:cb}),(0,l.Z)(gb,"UTIL_DEBUG",{name:"util/debug",process:Iy}),(0,l.Z)(gb,"UTIL_DEBOUNCE",{name:"util/debounce",process:Qg}),(0,l.Z)(gb,"UTIL_TIMEOUT",{name:"util/timeout",process:eb});var bb=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mProcesses",[]),(0,l.Z)(this,"mConnections",[]),(0,l.Z)(this,"mNodeFactories",{}),(0,l.Z)(this,"mProductNode",void 0),(0,l.Z)(this,"mLoadHash",0),(0,l.Z)(this,"onLoadFinished",new Ht),this.mNodeFactories=gb.processes(),this.mProductNode=t}var n;return(0,c.Z)(e,[{key:"load",value:(n=t(r().mark((function e(){var t,n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=++this.mLoadHash,e.abrupt("return",new Promise((function(e,r){Ko.getInstance().resolveBootstrapData(n.mProductNode.productId).pipe(sn(1)).subscribe({next:function(i){if(t!==n.mLoadHash)throw new Error("cancelled");try{i.getRules().forEach((function(e){n.loadGraph(e)})),n.onLoadFinished.next(!0)}catch(e){return n.onLoadFinished.next(!1),r(e)}e(n)},error:function(e){n.onLoadFinished.next(!1),r(e)}})})));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"unload",value:function(){this.mLoadHash+=1,this.mProcesses.splice(0).forEach((function(e){return e.onDestroy()})),this.mConnections.splice(0),this.onLoadFinished.unsubscribe()}},{key:"getProductNode",value:function(){return this.mProductNode}},{key:"loadGraph",value:function(e){var t=this,n=e.processes;Array.isArray(n)&&n.forEach((function(e){var n=e.meta||{};t.addNode(e.pid,e.component,n)}));var r=e.connections;Array.isArray(r)&&r.forEach((function(e){var n=e.meta||{};null!==e.source_data&&void 0!==e.source_data?t.addInitial(e.source_data,e.target_pid,e.target_port,n):t.addEdge(e.source_pid,e.source_port,e.target_pid,e.target_port,n)}))}},{key:"addNode",value:function(e,t,n){var r=this.mNodeFactories[t];if(r){var i=new r(e,this,n);this.mProcesses.push(i),i.onInit()}}},{key:"addEdge",value:function(e,t,n,r,i){var a=this.mProcesses.find((function(t){return t.getPid()===e})),o=this.mProcesses.find((function(e){return e.getPid()===n}));a&&o?(a.attachOutPort(t,o,r),o.attachInPort(r,a,t),this.mConnections.push(new wv.C(a,t,o,r))):qe.qL.error("failed to add edge: ",a,o)}},{key:"addInitial",value:function(e,t,n,r){}}]),e}();function Mb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var kb=function(e){(0,g.Z)(a,e);var n,i=Mb(a);function a(){var e;return(0,u.Z)(this,a),e=i.call(this,"processManager"),(0,l.Z)((0,_.Z)(e),"mProcessManager",void 0),(0,l.Z)((0,_.Z)(e),"mResolvePromise",null),(0,l.Z)((0,_.Z)(e),"mLoaded",!1),e}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"resolveManager",value:(n=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mLoaded){e.next=2;break}return e.abrupt("return",Promise.resolve(this.mProcessManager));case 2:if(qe.qL.print("Initializing process manager for product:",this.mProcessManager.getProductNode().name),!this.mResolvePromise){e.next=5;break}return e.abrupt("return",this.mResolvePromise);case 5:return qe.qL.print("Loading process manager for product:",this.mProcessManager.getProductNode().name),this.mResolvePromise=new Promise((function(e,n){t.mProcessManager.load().then((function(){return t.mResolvePromise=null,t.mLoaded=!0,qe.qL.print("Process manager loaded!"),e(t.mProcessManager)}),(function(e){return t.mResolvePromise=null,qe.qL.error("Process manager failed to load:",e),n(e)}))})),e.abrupt("return",this.mResolvePromise);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"OnAttached",value:function(){this.mProcessManager=new bb(this.getParentObject()),this.registerMessageHandler(pe.TypeRTTI,this.destroyProcessManager.bind(this))}},{key:"OnDetached",value:function(){this.mProcessManager&&(this.mProcessManager.unload(),delete this.mProcessManager),this.unregisterMessageHandler(pe.TypeRTTI)}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(Pc.TypeRTTI)}},{key:"destroyProcessManager",value:function(e){qe.qL.print("Destroying process manager for product:",this.mProcessManager.getProductNode().name),this.mProcessManager&&this.mProcessManager.unload(),this.mLoaded=!1}}]),a}(Xi.H);function _b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(kb,"TypeRTTI",new k.r("ProcessManagerComponent",Xi.H.TypeRTTI));var xb=function(e){(0,g.Z)(n,e);var t=_b(n);function n(){var e;return(0,u.Z)(this,n),e=t.call(this,"catalogueSettings"),(0,l.Z)((0,_.Z)(e),"mProductId",void 0),e}return(0,c.Z)(n,[{key:"OnAttached",value:function(){var e=this.getParentObject();this.mProductId=e.productId}},{key:"resolveSettings",value:function(){var e=this.getParentObject().getValue("product_id");return qe.qL.print("resolve settings for: ",e),vi.getInstance().resolveCatalogueSettings(e)}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(Pc.TypeRTTI)}},{key:"dispose",value:function(){void 0!==this.mProductId&&(vi.getInstance().disposeCatalogue(this.mProductId),delete this.mProductId)}}]),n}(Xi.H),Tb=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mMaterialGroupManager",void 0),this.mMaterialGroupManager=t}var n;return(0,c.Z)(e,[{key:"onMaterialChanged",get:function(){return this.mMaterialGroupManager.onMaterialChanged}},{key:"onMaterialVisibility",get:function(){return this.mMaterialGroupManager.onMaterialVisibility}},{key:"getGroups",value:function(){return this.mMaterialGroupManager._getGroups()}},{key:"getGroup",value:function(e){return this.mMaterialGroupManager._getGroup(e)}},{key:"getGroupByGroupId",value:function(e){return this.mMaterialGroupManager._getGroupByGroupId(e)}},{key:"getGroupReferences",value:function(e){return this.mMaterialGroupManager._getGroupReferences(e)}},{key:"getGroupReferencesByGroupId",value:function(e){return this.mMaterialGroupManager._getGroupReferencesByGroupId(e)}},{key:"getActiveGroupSKU",value:function(e){return this.mMaterialGroupManager._getActiveGroupSKU(e)}},{key:"getActiveGroupName",value:function(e){return this.mMaterialGroupManager._getActiveGroupName(e)}},{key:"getActiveRef",value:function(e){return this.mMaterialGroupManager._getActiveRef(e)}},{key:"getActiveRefId",value:function(e){return this.mMaterialGroupManager._getActiveRefId(e)}},{key:"getActiveRefModel",value:function(e){return this.mMaterialGroupManager._getActiveRefModel(e)}},{key:"getActiveMaterial",value:function(e){return this.mMaterialGroupManager._getActiveMaterial(e)}},{key:"getActiveMaterialByGroupId",value:function(e){return this.mMaterialGroupManager._getActiveMaterialByGroupId(e)}},{key:"setActiveMaterial",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.mMaterialGroupManager._setActiveMaterial(e,t,n)}},{key:"resetActiveMaterial",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.mMaterialGroupManager._resetActiveMaterial(e,t)}},{key:"applyActiveMaterial",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.mMaterialGroupManager._applyActiveMaterial(e,t,n,r)}},{key:"setActiveMaterialByGroupId",value:function(e,t){this.mMaterialGroupManager._setActiveMaterialByGroupId(e,t)}},{key:"setMaterialVisibility",value:function(e,t,n){this.mMaterialGroupManager._setMaterialVisibility(e,t,n)}},{key:"setMaterialVisibilityByGroupId",value:function(e,t,n){this.mMaterialGroupManager._setMaterialVisibilityByGroupId(e,t,n)}},{key:"setColorOverwrite",value:function(e,t,n){this.mMaterialGroupManager._setColorOverwrite(e,t,n)}},{key:"setMapOverwrite",value:(n=t(r().mark((function e(t,n,i,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mMaterialGroupManager._setMapOverwrite(t,n,i,a));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"buildQueryParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.mMaterialGroupManager._buildQueryParams(e)}}]),e}(),wb=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mProductId",void 0),(0,l.Z)(this,"mLoaderService",void 0),(0,l.Z)(this,"mGroups",void 0),(0,l.Z)(this,"mActiveMaterials",{}),(0,l.Z)(this,"mColorOverwrites",{}),(0,l.Z)(this,"mMapOverwrites",{}),(0,l.Z)(this,"onMaterialChanged",new Ht),(0,l.Z)(this,"onMaterialVisibility",new Ht),this.mGroups=[]}var n,i;return(0,c.Z)(e,[{key:"init",value:function(){this.mGroups.splice(0)}},{key:"deinit",value:function(){this.mGroups.splice(0),this.mLoaderService&&(this.mLoaderService.error("product options detached"),delete this.mLoaderService)}},{key:"_setProductId",value:function(e){this.mProductId=e,this.mLoaderService&&(this.mLoaderService.error("product id has changed"),delete this.mLoaderService)}},{key:"_loadMaterialGroups",value:function(){var e=this;return Ko.getInstance().resolveBootstrapData(this.mProductId).pipe(sn(1),Bo((function(t){var n,r=t.getMaterialsByGroup().map((function(e){return e.generate_code=(0,f.oA)(e.generate_code),e}));return(n=e.mGroups).push.apply(n,s(r||[])),r})))}},{key:"_beforeResolve",value:function(){var e=this;Object.keys(this.mColorOverwrites).forEach((function(t){e._applyColorOverwrites(parseInt(t,10))})),Object.keys(this.mMapOverwrites).forEach((function(t){e._applyMapOverwrites(parseInt(t,10)).then((function(){}),(function(){}))}))}},{key:"resolveMaterialGroups",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return void 0===this.mProductId?(qe.qL.warn("trying to load product options with undefined product id"),ci("undefined product id")):(this.mLoaderService&&t&&delete this.mLoaderService,this.mLoaderService||(this.mLoaderService=new ni(1),this._loadMaterialGroups().subscribe((function(){qe.qL.print("Material groups loaded:",e.mGroups),e.mLoaderService&&(e._beforeResolve(),e.mLoaderService.next(new Tb(e)))}),(function(t){e.mLoaderService&&e.mLoaderService.error(t),delete e.mLoaderService}))),this.mLoaderService.pipe(di()))}},{key:"_getGroups",value:function(){return this.mGroups}},{key:"_getGroup",value:function(e){return this.mGroups.find((function(t){return t.id==e}))}},{key:"_getGroupByGroupId",value:function(e){return this.mGroups.find((function(t){return t.group_id==e}))}},{key:"_getGroupReferences",value:function(e){var t=this.mGroups.find((function(t){return t.id==e}));if(!(0,p.isNullOrUndefined)(t))return t.materials}},{key:"_getGroupReferencesByGroupId",value:function(e){var t=this.mGroups.find((function(t){return t.group_id==e}));if(!(0,p.isNullOrUndefined)(t))return t.materials}},{key:"_getActiveGroupSKU",value:function(e){var t=this._getActiveRef(e);return(0,p.isNullOrUndefined)(t)?null:this._getGroupReferences(e).find((function(e){return e.id==t.id})).sku}},{key:"_getActiveGroupName",value:function(e){var t=this._getActiveRef(e);return(0,p.isNullOrUndefined)(t)?null:this._getGroupReferences(e).find((function(e){return e.id==t.id})).material_name}},{key:"_getActiveRef",value:function(e){if(e in this.mActiveMaterials)return this.mActiveMaterials[e];var t=this._getGroupReferences(e);if(!(0,p.isNullOrUndefined)(t)&&t.length>0){var n=t.find((function(e){return 1==e.default_selected}));return(0,p.isNullOrUndefined)(n)&&(n=t[0]),this.mActiveMaterials[e]={id:n.id,mat:n.material_id},this.mActiveMaterials[e]}}},{key:"_getActiveRefId",value:function(e){var t=this._getActiveRef(e);if(!(0,p.isNullOrUndefined)(t))return t.id}},{key:"_getActiveRefModel",value:function(e){var t=this._getActiveRefId(e);if(!(0,p.isNullOrUndefined)(t))return this._getGroupReferences(e).find((function(e){return e.id==t}))}},{key:"_getActiveMaterial",value:function(e){var t=this._getActiveRef(e);if(!(0,p.isNullOrUndefined)(t))return t.mat}},{key:"_getActiveMaterialByGroupId",value:function(e){var t=this.mGroups.find((function(t){return t.group_id===e}));if(!(0,p.isNullOrUndefined)(t))return this._getActiveMaterial(t.id)}},{key:"_setActiveMaterial",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.mGroups.find((function(t){return t.id==e}));if(r&&r.materials){var i=r.materials.find((function(e){return e.id==t}));(0,p.isNullOrUndefined)(i)||this._applyActiveMaterial(r.id,i.id,i.material_id,n)}}},{key:"_resetActiveMaterial",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.mGroups.find((function(t){return t.id==e}));n&&e in this.mActiveMaterials&&(delete this.mActiveMaterials[e],t&&this.onMaterialChanged.next({id:e,group:n.group_id,ref_id:this._getActiveRefId(e),material_id:this.mActiveMaterials[e].mat}))}},{key:"_applyActiveMaterial",value:function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=this.mGroups.find((function(t){return t.id==e}));(0,p.isNullOrUndefined)(i)||(this.mActiveMaterials[e]={id:t,mat:n},r&&this.onMaterialChanged.next({id:e,group:i.group_id,ref_id:t,material_id:this.mActiveMaterials[e].mat}))}},{key:"_applyColorOverwrites",value:function(e,t){var n=this;if(Array.isArray(this.mGroups)){var r=this.mGroups.find((function(t){return t.id==e}));if(r){var i=tc.getManager(Qu.MaterialManager);r.materials.forEach((function(r){i.setColorOverwrite(r.material_id,n.mColorOverwrites[e],t)}))}}}},{key:"_applyMapOverwrites",value:(i=t(r().mark((function e(n,i){var a=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){if(!Array.isArray(a.mGroups))return o("Groups not defined");var s=a.mGroups.find((function(e){return e.id==n}));if(!s)return o("apply map overwrite: Group not found.");var u=tc.getManager(Qu.MaterialManager),c=[];s.materials.forEach((function(e){var o=a.mMapOverwrites[n];Array.isArray(o)&&o.forEach((function(n){c.push(t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",u.setMapOverwrite(e.material_id,n.type,n.textureId,i));case 1:case"end":return t.stop()}}),t)}))))}))})),h.executeInOrder(c,(function(t,n){t.length>0?e(t[0]):o(n.length>0?n[0]:"Nothing to apply")}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return i.apply(this,arguments)})},{key:"_setActiveMaterialByGroupId",value:function(e,t){var n=this.mGroups.find((function(t){return t.group_id==e}));(0,p.isNullOrUndefined)(n)||this._setActiveMaterial(n.id,t)}},{key:"_setMaterialVisibility",value:function(e,t,n){var r=this.mGroups.find((function(t){return t.id==e}));if(!(0,p.isNullOrUndefined)(r)){var i=r.materials;if(!i)return;var a=i.find((function(e){return e.id==t}));(0,p.isNullOrUndefined)(a)||(a.visible=n?1:0,this.onMaterialVisibility.next({id:e,group:r.group_id,ref_id:a.id,visible:n}))}}},{key:"_setMaterialVisibilityByGroupId",value:function(e,t,n){var r=this.mGroups.find((function(t){return t.group_id==e}));r&&this._setMaterialVisibility(r.id,t,n)}},{key:"_setColorOverwrite",value:function(e,t,n){return this.mColorOverwrites[e]=t,this._applyColorOverwrites(e,n)}},{key:"_setMapOverwrite",value:(n=t(r().mark((function e(t,n,i,a){var o=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){if((0,p.isNullOrUndefined)(n))return r("Incorrect type!");(0,p.isNullOrUndefined)(o.mMapOverwrites[t])&&(o.mMapOverwrites[t]=[]);var s=o.mMapOverwrites[t].findIndex((function(e){return e.type===n}));if(((0,p.isNullOrUndefined)(i)||i<0)&&!(0,p.isNullOrUndefined)(o.mMapOverwrites[t][s]))s>=0&&(o.mMapOverwrites[t][s].textureId=null);else try{s>=0?o.mMapOverwrites[t][s].textureId=i:(o.mMapOverwrites[t].push({type:n,textureId:i}),s=o.mMapOverwrites[t].length-1)}catch(e){}o._applyMapOverwrites(t,a).then((function(t){e(t)}),(function(e){r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"_buildQueryParams",value:function(){var e=this,t={};return Object.keys(this.mActiveMaterials).forEach((function(n){var r=Number(n);t[r]="".concat(e.mActiveMaterials[r].id)})),t}}]),e}();function Rb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rb(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Sb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Cb=function(e){(0,g.Z)(a,e);var n,i=Sb(a);function a(){var e;return(0,u.Z)(this,a),e=i.call(this,"materialGroupManager"),(0,l.Z)((0,_.Z)(e),"mMaterialGroupManagerService",void 0),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),e.mMaterialGroupManagerService=new wb,e}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"isAttachable",value:function(e){return e.isDerivedOfTypeName("ProductNode")}},{key:"OnAttached",value:function(){this.mMaterialGroupManagerService.init();var e=this.getParentObject(),t=e.productId;void 0!==t&&this.mMaterialGroupManagerService._setProductId(t),this.registerMessageHandler(Ie.TypeRTTI,this.handleSetValue.bind(this)),this.mSubscriptions.push(this.mMaterialGroupManagerService.onMaterialChanged.subscribe((function(t){P.eventBus().dispatch(new Di(Ei.ProductMaterialChanged,Object.assign({product_uuid:e.getObjectUUID()},t)))})))}},{key:"OnDetached",value:function(){this.mMaterialGroupManagerService.deinit(),this.unregisterMessageHandler(Ie.TypeRTTI),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"handleSetValue",value:function(e){if("product_id"===e.key){var t=(0,f.fk)(e.value);this.mMaterialGroupManagerService._setProductId(t)}}},{key:"resolveMaterialGroups",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.mMaterialGroupManagerService.resolveMaterialGroups(e)}},{key:"serialize",value:(n=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolveMaterialGroups().toPromise();case 2:return t=e.sent,e.abrupt("return",t.getGroups().map((function(e){return{group:e,activeRefModel:t.getActiveRefModel(e.id)}})).filter((function(e){return e.activeRefModel})).map((function(e){var t=e.group,n=e.activeRefModel,r=Zb({},t);return r.materials&&(r.selected_reference_id=n.id),r})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),a}(Xi.H);function Ib(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Cb,"TypeRTTI",new k.r("MaterialGroupManagerComponent",Xi.H.TypeRTTI));var Eb=function(e){(0,g.Z)(n,e);var t=Ib(n);function n(){var e;return(0,u.Z)(this,n),e=t.call(this,"propertyValue"),(0,l.Z)((0,_.Z)(e),"mValues",{}),e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"OnAttached",value:function(){}},{key:"OnDetached",value:function(){}},{key:"isAttachable",value:function(e){return!0}},{key:"setValue",value:function(e,t){this.mValues[e]=t}},{key:"getValue",value:function(e){return this.mValues[e]}},{key:"valueExists",value:function(e){return void 0!==this.mValues[e]}}]),n}(Xi.H);function Ab(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Eb,"TypeRTTI",new k.r("PropertyValueComponent",Xi.H.TypeRTTI));var Ob=function(e){(0,g.Z)(n,e);var t=Ab(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.effect_ao_plane),(0,l.Z)((0,_.Z)(r),"mClipDistance",.05),(0,l.Z)((0,_.Z)(r),"mSamplingRadius",8),(0,l.Z)((0,_.Z)(r),"mPower",.5),(0,l.Z)((0,_.Z)(r),"mWidthFromRenderer",2),(0,l.Z)((0,_.Z)(r),"mHeightFromRenderer",2),(0,l.Z)((0,_.Z)(r),"mSubscriptions",[]),r.mName="ShaderEntityAoPlane",r.mPickable=!1,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"onAttached",value:function(e){var t=this;Ni((0,M.Z)(n.prototype),"onAttached",this).call(this,e),this.mSubscriptions.push(P.eventBus().subscribe(Di.getTopicName(Ei.NodeAdded),(function(){t.markNeedsRenderUpdate()})),P.eventBus().subscribe(Di.getTopicName(Ei.NodeRemoved),(function(){t.markNeedsRenderUpdate()})),P.eventBus().subscribe(Di.getTopicName(Ei.NodeChanged),(function(){t.markNeedsRenderUpdate()})),P.eventBus().subscribe(Di.getTopicName(Ei.ObjectTransformed),(function(){t.markNeedsRenderUpdate()})),P.eventBus().subscribe(Di.getTopicName(Ei.RendererBuildFinished),(function(){t.markNeedsRenderUpdate()})))}},{key:"onDetached",value:function(e){Ni((0,M.Z)(n.prototype),"onDetached",this).call(this,e),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"clip_distance":return this.mClipDistance=parseFloat(t),!0;case"sampling_radius":return this.mSamplingRadius=parseFloat(t),!0;case"power":return this.mPower=parseFloat(t),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"clip_distance":return this.mClipDistance;case"sampling_radius":return this.mSamplingRadius;case"power":return this.mPower;case"width":return this.mWidthFromRenderer;case"height":return this.mHeightFromRenderer}return null}},{key:"serialize",value:function(e){var t=Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"ao_plane"});return t.properties=Object.assign(t.properties,{clip_distance:this.mClipDistance,sampling_radius:this.mSamplingRadius,power:this.mPower}),t}},{key:"clipDistance",get:function(){return this.mClipDistance},set:function(e){this.mClipDistance=e,this.markNeedsRenderUpdate()}},{key:"samplingRadius",get:function(){return this.mSamplingRadius},set:function(e){this.mSamplingRadius=e,this.markNeedsRenderUpdate()}},{key:"power",get:function(){return this.mPower},set:function(e){this.mPower=e,this.markNeedsRenderUpdate()}},{key:"width",set:function(e){this.mWidthFromRenderer=e,P.eventBus().dispatch(new Di(Ei.ModelAttributeChanged,{attribute:"width",model:this}))}},{key:"height",set:function(e){this.mHeightFromRenderer=e,P.eventBus().dispatch(new Di(Ei.ModelAttributeChanged,{attribute:"height",model:this}))}}]),n}(Xm);(0,l.Z)(Ob,"TypeRTTI",new k.r("ShaderEntityAoPlane",Xm.TypeRTTI));var Db=function(){function e(t,n,r,i,a,o){(0,u.Z)(this,e),(0,l.Z)(this,"mSyncHash",void 0),(0,l.Z)(this,"mModelId",void 0),(0,l.Z)(this,"mName",void 0),(0,l.Z)(this,"mDescription",void 0),(0,l.Z)(this,"mSKU",void 0),(0,l.Z)(this,"mPrice",void 0),this.mModelId=t,this.mName=n,this.mDescription=r,this.mSKU=i,this.mPrice=a,this.mSyncHash=o}return(0,c.Z)(e,[{key:"setSyncHash",value:function(e){this.mSyncHash=e}},{key:"getSyncHash",value:function(){return this.mSyncHash}},{key:"isInSyncWithHash",value:function(e){return this.mSyncHash===e}},{key:"modelId",get:function(){return this.mModelId}},{key:"name",get:function(){return this.mName}},{key:"description",get:function(){return this.mDescription}},{key:"sku",get:function(){return this.mSKU}},{key:"price",get:function(){return this.mPrice}},{key:"serialize",value:function(){return{modelId:this.modelId,name:this.name,description:this.description,sku:this.sku,price:this.price}}},{key:"onAttached",value:function(){}},{key:"onDetached",value:function(){}}]),e}();function Pb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Bb=function(e){(0,g.Z)(a,e);var n,i=Pb(a);function a(e){var t;return(0,u.Z)(this,a),t=i.call(this),(0,l.Z)((0,_.Z)(t),"sceneObject",void 0),(0,l.Z)((0,_.Z)(t),"mSyncHash",new xc),(0,l.Z)((0,_.Z)(t),"mObjectModels",{}),t.sceneObject=e,t}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"getObjectModel",value:function(e){return e in this.mObjectModels?this.mObjectModels[e]:null}},{key:"getObjectModels",value:function(){return this.mObjectModels}},{key:"syncObjectModels",value:(n=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.mSyncHash.newHash(),n=this.syncNewModels(t),n=this.detachOutOfSync()||n,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"syncNewModels",value:function(e){var t=this,n=!1;return f.Ft.isArray(e)&&e.forEach((function(e){e.id in t.mObjectModels?t.mObjectModels[e.id].setSyncHash(t.mSyncHash.getHash()):(n=!0,t.mObjectModels[e.id]=new Db(e.id,e.Name,e.Description,e.SKU,e.Price,t.mSyncHash.getHash()),t.mObjectModels[e.id].onAttached())})),n}},{key:"detachOutOfSync",value:function(){var e=this,t=!1,n=new Array;return Object.keys(this.mObjectModels).forEach((function(r){var i=e.mObjectModels[r];i.isInSyncWithHash(e.mSyncHash.getHash())||(t=!0,i.onDetached(),n.push(r))})),n.forEach((function(t){delete e.mObjectModels[t]})),t}}]),a}(x.e);function Fb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Bb,"TypeRTTI",new k.r("ArticleListController",x.e.TypeRTTI));var Lb=function(e){(0,g.Z)(d,e);var n,i,a,s,h,f,p,m=Fb(d);function d(){var e;(0,u.Z)(this,d);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=m.call.apply(m,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mCache",{}),(0,l.Z)((0,_.Z)(e),"mScriptModelHash",0),e}return(0,c.Z)(d,[{key:"getType",value:function(){return d.TypeRTTI}},{key:"getName",value:function(){return"ScriptEngineController"}},{key:"getArticles",value:(p=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.requestSKUs());case 1:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"syncObjectModels",value:(f=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ni((0,M.Z)(d.prototype),"syncObjectModels",this).call(this,t);case 2:return n=e.sent,e.next=5,this.syncScriptModels();case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0=n;case 8:return n=e.t0,e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"syncScriptModels",value:(h=t(r().mark((function e(){var t,n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.requestSKUs();case 3:t=e.sent,e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",!0);case 9:return n=t.reduce((function(e,t){if(!t.sku)return e;for(var n=t.sku.length;n;)e=33*e^t.sku.charCodeAt(--n);return e}),d.MAGIC_HASH)>>>0,i=this.mScriptModelHash!==n,this.mScriptModelHash=n,e.abrupt("return",i);case 13:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return h.apply(this,arguments)})},{key:"getSerializedAttributes",value:(s=t(r().mark((function e(){var t,n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.sceneObject.getComponent("attributeManager"),e.next=3,St(t.resolveAttributeManager());case 3:return n=e.sent,e.abrupt("return",{hash:n.hashConfiguration(),serialized:n.serialize({discard_hidden:!1,include_keys:!0,calculate_approximations:!1})});case 5:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"requestSKUs",value:(a=t(r().mark((function e(){var t,n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSerializedAttributes();case 2:return t=e.sent,n=t.hash,i=t.serialized,e.abrupt("return",this.cache(n,i));case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"requestSKUsFromScriptEngine",value:(i=t(r().mark((function e(t){var n,i,a,o,s,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.sceneObject.getValue("product_id"),i=Jr.E.makeApiRoute("script_engine/catalogue/".concat(n,"/sku/get")),a=this.getObjectModels(),o=Object.keys(a).map((function(e){return a[e]})),s={models:o,attributes:t},e.next=7,ei.getInstance().post(i,s).catch((function(e){return e.response})).then((function(e){return e.data}));case 7:if(!(u=e.sent).error){e.next=10;break}throw u;case 10:return e.abrupt("return",this.buildObjectModels(u));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"cache",value:(n=t(r().mark((function e(t,n){var i,a,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Date.now(),!(a=this.mCache[t])){e.next=5;break}return a.timestamp=i,e.abrupt("return",a.value);case 5:return o=this.requestSKUsFromScriptEngine(n),this.mCache[t]={hash:t,timestamp:i,value:o},e.next=9,o;case 9:return this.clearOldCache(),e.abrupt("return",o);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"clearOldCache",value:function(){var e=this,t=Object.entries(this.mCache);t.length<=d.MAX_CACHE||t.sort((function(e,t){var n=o(e,2)[1];return o(t,2)[1].timestamp-n.timestamp})).splice(d.MAX_CACHE).forEach((function(t){var n=o(t,1)[0];return delete e.mCache[n]}))}},{key:"buildObjectModels",value:function(e){var t=[],n=0;return e.forEach((function(e){for(var r=0;r<e.quantity;r++)t.push(new Db(--n,e.name||"",e.description||"",e.sku,e.price||0,null))})),t}}]),d}(Bb);function Nb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Lb,"TypeRTTI",new k.r("ArticleListScriptEngineController",Bb.TypeRTTI)),(0,l.Z)(Lb,"MAX_CACHE",100),(0,l.Z)(Lb,"MAGIC_HASH",5381);var jb=function(e){(0,g.Z)(a,e);var n,i=Nb(a);function a(){return(0,u.Z)(this,a),i.apply(this,arguments)}return(0,c.Z)(a,[{key:"getType",value:function(){return a.TypeRTTI}},{key:"getName",value:function(){return"objectModelController"}},{key:"getArticles",value:(n=t(r().mark((function e(){var t,n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object.keys(this.mObjectModels).map((function(e){return n.mObjectModels[e]})),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),a}(Bb);function zb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ub(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zb(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Vb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(jb,"TypeRTTI",new k.r("ArticleListObjectModelController",Bb.TypeRTTI));var Hb=function(e){(0,g.Z)(m,e);var n,i,a,o,s,h,f,p=Vb(m);function m(){var e;return(0,u.Z)(this,m),e=p.call(this,"articleListManager"),(0,l.Z)((0,_.Z)(e),"onModelsChanged",new Ht),(0,l.Z)((0,_.Z)(e),"mArticleController",void 0),(0,l.Z)((0,_.Z)(e),"_destroy$$",void 0),e}return(0,c.Z)(m,[{key:"getType",value:function(){return m.TypeRTTI}},{key:"getArticles",value:(f=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolveController();case 2:return t=e.sent,e.abrupt("return",t.getArticles());case 4:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"serialize",value:(h=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getArticles();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){return e.serialize()})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"getController",value:(s=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolveController();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"getObjectModel",value:(o=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolveController();case 2:return n=e.sent,e.abrupt("return",n.getObjectModel(t));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"getObjectModels",value:(a=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolveController();case 2:return t=e.sent,e.abrupt("return",t.getObjectModels());case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"syncObjectModels",value:(i=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resolveController();case 2:return n=e.sent,e.next=5,n.syncObjectModels(t);case 5:if(e.sent){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,e.t0=this.onModelsChanged,e.next=12,n.getArticles();case 12:e.t1=e.sent,e.t2={articles:e.t1},e.t0.next.call(e.t0,e.t2),e.next=20;break;case 17:e.prev=17,e.t3=e.catch(8),this.onModelsChanged.next(Ub({},e.t3));case 20:case"end":return e.stop()}}),e,this,[[8,17]])}))),function(e){return i.apply(this,arguments)})},{key:"resolveController",value:(n=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mArticleController){e.next=6;break}return t=this.getParentObject(),e.next=4,St(this.resolvePricingSettings());case 4:"script_engine"===e.sent.sku_calculator?this.mArticleController=new Lb(t):this.mArticleController=new jb(t);case 6:return e.abrupt("return",this.mArticleController);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"resolvePricingSettings",value:function(){var e=this.getParentObject();return Ko.getInstance().resolveBootstrapData(e.productId).pipe(sn(1),Bo((function(e){return e.getPricingSettings()})),Lp(this._destroy$$))}},{key:"OnAttached",value:function(){this._destroy$$=new Ht}},{key:"OnDetached",value:function(){this._destroy$$.next(),this._destroy$$.complete(),delete this._destroy$$}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(Pc.TypeRTTI)}}]),m}(Xi.H);function Gb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gb(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Wb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Hb,"TypeRTTI",new k.r("ArticleListManagerComponent",Xi.H.TypeRTTI));var Yb=function(e){(0,g.Z)(n,e);var t=Wb(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.effect_reflector),(0,l.Z)((0,_.Z)(r),"mColor",so.White()),(0,l.Z)((0,_.Z)(r),"mOpacity",1),r.mName="ShaderEntityReflector",r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"color":return t instanceof so?this.mColor.copy(t):this.mColor.set(t),!0;case"opacity":return this.mOpacity=parseFloat(t),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){var t=Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e);if(null!==t)return t;switch(e){case"color":return this.mColor;case"opacity":return this.mOpacity;case"width":case"height":return 20}return null}},{key:"serialize",value:function(e){var t=qb(qb({},Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e)),{type:"reflector"});return t.properties=qb(qb({},t.properties),{color:this.color.getHexString(),opacity:this.opacity}),t}},{key:"color",get:function(){return this.mColor},set:function(e){this.mColor.copy(e),this.markNeedsRenderUpdate()}},{key:"opacity",get:function(){return this.mOpacity},set:function(e){this.mOpacity=e,this.markNeedsRenderUpdate()}}]),n}(Xm);function Kb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kb(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Yb,"TypeRTTI",new k.r("ShaderEntityReflector",Xm.TypeRTTI));var Qb=function(e){(0,g.Z)(n,e);var t=$b(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"mHtmlText",""),(0,l.Z)((0,_.Z)(r),"mViewportPosition",Bi.Zero()),(0,l.Z)((0,_.Z)(r),"mViewportRotation",new Li),r.mName="UiEntityAnnotation",r.mTitle="A1",r.mMargin=2,r.mColor.set("#1f1e1e"),r.mHoverColor.set("#343232"),r.mFontSize=10,r.mTextColor.copy(so.White()),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"htmlText":return this.mHtmlText=t,!0;case"viewport":return this.setValue("viewport_position",t.position),this.setValue("viewport_rotation",t.rotation),!0;case"viewport_position":return t instanceof Bi?this.mViewportPosition.copy(t):Array.isArray(t)&&this.mViewportPosition.fromArray(t),!0;case"viewport_rotation":return t instanceof Li?this.mViewportRotation.copy(t):t instanceof Pi?this.mViewportRotation.setFromQuaternion(t):Array.isArray(t)&&this.mViewportRotation.fromArray(t),!0;case"ui_options":case"options":try{var i=null;(i="string"==typeof t?JSON.parse(t):t).title&&(this.mTitle=i.title),void 0!==i.margin&&(this.mMargin=i.margin),void 0!==i.color&&this.mColor.set(i.color),void 0!==i.hover&&this.mHoverColor.set(i.hover),void 0!==i.fontSize&&(this.mFontSize=i.fontSize),void 0!==i.textColor&&this.mTextColor.set(i.textColor),i.htmlText&&(this.mHtmlText=i.htmlText)}catch(e){return!1}return!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){switch(e){case"htmlText":return this.mHtmlText;case"viewport":return{position:this.mViewportPosition,rotation:this.mViewportRotation};case"viewport_position":return this.mViewportPosition;case"viewport_rotation":return this.mViewportRotation;case"ui_options":case"options":return{title:this.mTitle,margin:this.mMargin,color:this.mColor.getHexString(),hover:this.mHoverColor.getHexString(),fontSize:this.mFontSize,textColor:this.mTextColor.getHexString(),htmlText:this.mHtmlText}}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}},{key:"serialize",value:function(e){var t=Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),r={title:this.mTitle,margin:this.mMargin,color:this.mColor.getHexString(),hover:this.mHoverColor.getHexString(),fontSize:this.mFontSize,textColor:this.mTextColor.getHexString(),htmlText:this.mHtmlText};return Xb(Xb({},t),{},{type:"uix_annotation",ui_options:JSON.stringify(r),properties:Xb(Xb({},t.properties),{viewport_position:this.mViewportPosition.toArray(),viewport_rotation:this.mViewportRotation.toArray()})})}}]),n}(av);(0,l.Z)(Qb,"TypeRTTI",new k.r("UiEntityAnnotation",av.TypeRTTI));var Jb=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mFactories",{})}return(0,c.Z)(e,[{key:"registerFactory",value:function(e,t){e in this.mFactories&&qe.qL.warn("Overwriting existing factory: ".concat(e)),this.mFactories[e]=t}},{key:"registerFactories",value:function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=o(n[t],2),i=r[0],a=r[1];this.registerFactory(i,a)}}},{key:"createObject",value:function(e){var t;if(!(e in this.mFactories))return null;for(var n=null,r=this.mFactories[e],i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];var u=(t=[]).concat.apply(t,s(a||[]));return n=Ma(r.factory,s(u)),(r.components||[]).forEach((function(e){n.addComponent(new e)})),n}}]),e}();function eM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var tM=function(e){(0,g.Z)(n,e);var t=eM(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"delta",void 0),r.delta=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function nM(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return rM(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rM(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function rM(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function iM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(tM,"TypeRTTI",new k.r("MessageSceneAfterUpdate",w.TypeRTTI));var aM=function(e){(0,g.Z)(n,e);var t=iM(n);function n(){var e;return(0,u.Z)(this,n),e=t.call(this,"offsetManager"),(0,l.Z)((0,_.Z)(e),"mOffsets",[]),(0,l.Z)((0,_.Z)(e),"mLoadingObserver",null),(0,l.Z)((0,_.Z)(e),"onOffsetChanged",void 0),(0,l.Z)((0,_.Z)(e),"onOffsetVisibility",void 0),(0,l.Z)((0,_.Z)(e),"mEngineProgressObserver",new Np),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mOffsetsNeedsUpdate",!1),(0,l.Z)((0,_.Z)(e),"mBlockOffsetUpdate",!1),(0,l.Z)((0,_.Z)(e),"mOnDetached$",void 0),e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"OnAttached",value:function(){var e=this;this.mOnDetached$=new Ht,this.mOffsets=[],this.onOffsetChanged=new Ht,this.onOffsetVisibility=new Ht,this.mEngineProgressObserver.attach(),this.observeEngineProgress(),this.registerMessageHandler(tM.TypeRTTI,(function(t){return e.update(t)}))}},{key:"OnDetached",value:function(){this.onOffsetChanged.unsubscribe(),this.onOffsetVisibility.unsubscribe(),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.unregisterFromAllMessages(),this.mOffsets=[],this.mEngineProgressObserver.detach(),this.mOnDetached$.next(),this.mOnDetached$.complete()}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(Mc.TypeRTTI)}},{key:"observeEngineProgress",value:function(){var e=this;this.mEngineProgressObserver.onEngineIdle.pipe(Lp(this.mOnDetached$)).subscribe((function(t){e.mBlockOffsetUpdate=!t}))}},{key:"update",value:function(e){if(this.mOffsetsNeedsUpdate&&!this.mBlockOffsetUpdate){var t,n=!0,r=nM(this.mOffsets);try{for(r.s();!(t=r.n()).done;){var i=t.value;this.updateOffsetGroupLevel(i,e.delta)||(n=!1)}}catch(e){r.e(e)}finally{r.f()}this.mOffsetsNeedsUpdate=!n}}},{key:"load",value:function(){var e=this;if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.mLoadingObserver&&delete this.mLoadingObserver,this.mLoadingObserver)return this.mLoadingObserver.pipe(Ho());this.mLoadingObserver=new ni(1);var t=this.getParentObject().findParentOfTypeName("ProductNode").productId;return Ko.getInstance().resolveBootstrapData(t).pipe(sn(1)).subscribe({next:function(t){if(e.mLoadingObserver)try{var n=t.getOffsetGroups();v.getItems(n).forEach((function(t){t.levels={},t.levels[0]=new Bi(t.offset_vec_x,t.offset_vec_y,t.offset_vec_z),t.rotation=new Pi;try{"string"==typeof t.matrix&&(t.matrix=JSON.parse(t.matrix))}catch(e){t.matrix=void 0}e.mOffsets.push({model:t,needs_update:!1,levels:Object.keys(t.levels).map((function(e){return{offset:t.levels[e].clone()}})),rotation:t.rotation.clone()})})),e.mLoadingObserver.next(e)}catch(t){e.mLoadingObserver.error(t)}},error:function(t){e.mLoadingObserver.error(t)}}),this.mLoadingObserver}},{key:"getOffsets",value:function(){return this.mOffsets.map((function(e){return e.model}))}},{key:"getOffset",value:function(e){var t;return null===(t=this.mOffsets.find((function(t){return t.model.id===e})))||void 0===t?void 0:t.model}},{key:"getOffsetByGroup",value:function(e){var t;return null===(t=this.mOffsets.find((function(t){return t.model.offset_id===e})))||void 0===t?void 0:t.model}},{key:"getAbsoluteOffsetMatrix",value:function(e){var t=this.getOffset(e),n=(new Fi).identity();if(!t)return n;var r=new Bi;Object.keys(t.levels).forEach((function(e){r.add(t.levels[e])}));var i=new Bi,a=new Pi,o=new Bi(1,1,1);t.matrix&&(new Fi).set(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5],t.matrix[6],t.matrix[7],t.matrix[8],t.matrix[9],t.matrix[10],t.matrix[11],t.matrix[12],t.matrix[13],t.matrix[14],t.matrix[15]).decompose(i,a,o);return n.multiply((new Fi).makeTranslation(i.x,i.y,i.z)),n.multiply((new Fi).makeRotationFromQuaternion(a.multiply(t.rotation))),n.multiply((new Fi).makeScale(o.x,o.y,o.z)),n.premultiply((new Fi).makeTranslation(r.x,r.y,r.z)),n}},{key:"getOffsetVector",value:function(e,t){var n=this.mOffsets.find((function(t){return t.model.id===e}));if(n)return n.levels[t]||(n.levels[t]={offset:new Bi}),n.levels[t].offset}},{key:"getOffsetRotation",value:function(e){var t=this.getOffset(e);if(t)return t.rotation}},{key:"getOffsetVisibility",value:function(e){var t=this.getOffset(e);return t&&!1!==t.visible}},{key:"getOffsetVectorByGroup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.getOffsetByGroup(e);if(n)return this.getOffsetVector(n.id,t)}},{key:"setOffset",value:function(e,t,n){var r=this.mOffsets.find((function(t){return t.model.id===e}));r&&(r.levels[t]||(r.levels[t]={offset:new Bi}),r.levels[t].animation&&delete r.levels[t].animation,r.levels[t].offset.copy(n),r.needs_update=!0,this.mOffsetsNeedsUpdate=!0)}},{key:"setOffsetAnimation",value:function(e,t,n){var r=this.mOffsets.find((function(t){return t.model.id===e}));r&&(r.levels[t].animation=n,r.needs_update=!0,this.mOffsetsNeedsUpdate=!0)}},{key:"setOffsetRotation",value:function(e,t){var n=this.mOffsets.find((function(t){return t.model.id===e}));n&&(n.rotation_animation&&delete n.rotation_animation,n.rotation.copy(t),n.needs_update=!0,this.mOffsetsNeedsUpdate=!0)}},{key:"setOffsetRotationAnimation",value:function(e,t){var n=this.mOffsets.find((function(t){return t.model.id===e}));n&&(n.rotation_animation=t,n.needs_update=!0,this.mOffsetsNeedsUpdate=!0)}},{key:"hideOffsetNode",value:function(e){this.getOffset(e).visible=!1,this.onOffsetVisibility.next({id:e,visible:!1})}},{key:"showOffsetNode",value:function(e){this.getOffset(e).visible=!0,this.onOffsetVisibility.next({id:e,visible:!0})}},{key:"setOffsetByGroup",value:function(e,t,n){var r=this.getOffsetByGroup(e);r&&this.setOffset(r.id,t,n)}},{key:"updateOffsetGroupLevel",value:function(e,t){if(!e.needs_update)return!0;var n=!0;if(Object.entries(e.levels).forEach((function(r){var i=o(r,2),a=i[0],s=i[1],u=Number(a);if(u in e.model.levels||(e.model.levels[u]=new Bi),s.animation){var c=s.animation;c.isStarted()||c.isFinished()||c.start();var l=c.update(t);e.levels[u].offset.copy(l),e.model.levels[u].copy(l),c.isFinished()?delete s.animation:n=!1}else e.model.levels[u].copy(e.levels[u].offset)})),e.rotation_animation){var r=e.rotation_animation;r.isStarted()||r.isFinished()||r.start();var i=r.update(t);e.rotation.copy(i),e.model.rotation.copy(i),r.isFinished()?delete e.rotation_animation:n=!1}else e.model.rotation.copy(e.rotation);return e.needs_update=!n,this.onOffsetChanged.next({id:e.model.id,matrix:this.getAbsoluteOffsetMatrix(e.model.id)}),n}}]),n}(Xi.H);function oM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(aM,"TypeRTTI",new k.r("SceneOffsetManagerComponent",Xi.H.TypeRTTI));var sM=function(e){(0,g.Z)(n,e);var t=oM(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,"materialGroupController"),(0,l.Z)((0,_.Z)(r),"mMatGroupId",void 0),(0,l.Z)((0,_.Z)(r),"mMaterialId",void 0),(0,l.Z)((0,_.Z)(r),"_destroy$$",void 0),(0,l.Z)((0,_.Z)(r),"mMaterialGroupManager",void 0),(0,l.Z)((0,_.Z)(r),"mSharedKeyOverwrite",{}),r.mMatGroupId=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"OnAttached",value:function(){var e=this;this._destroy$$=new Ht;var t=this.getParentObject().findParentOfType(Pc.TypeRTTI);t.getComponent("materialGroupManager").resolveMaterialGroups().pipe(Lp(this._destroy$$),sn(1)).subscribe((function(n){e.mMaterialGroupManager=n;var r=n.getActiveMaterial(e.mMatGroupId),i=void 0;r in e.mSharedKeyOverwrite&&(i=e.mSharedKeyOverwrite[r]),e.updateMaterial(r,i),e.subscribeToMaterialChanges(t)})),this.registerMessageHandler(G.TypeRTTI,(function(t){e.mSharedKeyOverwrite[t.materialModelId]=t.sharedKey}))}},{key:"OnDetached",value:function(){delete this.mMaterialGroupManager,this._destroy$$.next(),this._destroy$$.complete(),this.unregisterMessageHandler(G.TypeRTTI)}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(rc.TypeRTTI)}},{key:"getMaterialGroupId",value:function(){return this.mMatGroupId}},{key:"subscribeToMaterialChanges",value:function(e){var t=this;this.mMaterialGroupManager.onMaterialChanged.pipe(Lp(this._destroy$$)).subscribe((function(n){if(n.id==t.mMatGroupId){var r=n.material_id,i=e?e.getSceneObjectId():void 0;r in t.mSharedKeyOverwrite&&(i=t.mSharedKeyOverwrite[r]),t.updateMaterial(r,i)}}))}},{key:"updateMaterial",value:function(e,t){f.Ft.isNumeric(e)&&(this.mMaterialId=e,this.getParentObject().setMaterialById(e,t))}}]),n}(Xi.H);function uM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(sM,"TypeRTTI",new k.r("MaterialGroupController",Xi.H.TypeRTTI));var cM=function(e){(0,g.Z)(n,e);var t=uM(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,"offsetGroupController"),(0,l.Z)((0,_.Z)(r),"mOffsetGroupId",void 0),(0,l.Z)((0,_.Z)(r),"_destroy$$",void 0),(0,l.Z)((0,_.Z)(r),"mOffsetManager",void 0),(0,l.Z)((0,_.Z)(r),"mInitialized",!1),r.mOffsetGroupId=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"OnAttached",value:function(){var e=this;this._destroy$$=new Ht,this.initialize(),this.registerMessageHandler(be.TypeRTTI,(function(){e.initialize()}))}},{key:"OnDetached",value:function(){this.unregisterFromAllMessages(),this._destroy$$.next(),this._destroy$$.complete(),this.mOffsetManager&&delete this.mOffsetManager,this.mInitialized=!1}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(Ga.TypeRTTI)}},{key:"initialize",value:function(){var e=this;if(!this.mInitialized){var t=this.getParentObject().findParentOfType(Mc.TypeRTTI);if(t)t.getComponent("offsetManager").load().pipe(sn(1),Lp(this._destroy$$)).subscribe({next:function(t){e.mOffsetManager=t,e.setInitialOffsetPosition(),e.subscribeToTransformations(),e.subscribeToVisibility()},error:function(e){qe.qL.warn("Failed to load offset manager",e)}}),this.mInitialized=!0}}},{key:"setInitialOffsetPosition",value:function(){var e=this.mOffsetManager.getAbsoluteOffsetMatrix(this.mOffsetGroupId);this.setObjectTransformation(e)}},{key:"subscribeToTransformations",value:function(){var e=this;this.mOffsetManager.onOffsetChanged.pipe(Lp(this._destroy$$)).subscribe((function(t){e.mOffsetGroupId===t.id&&(e.setObjectTransformation(t.matrix),P.eventBus().dispatch(new Di(Ei.RequestFrame)))}))}},{key:"setObjectTransformation",value:function(e){var t=new Bi,n=new Pi,r=new Bi(1,1,1);e.decompose(t,n,r);var i=this.getParentObject();i.transform.position.copy(t),i.transform.quaternion.copy(n),i.transform.scale.copy(r)}},{key:"subscribeToVisibility",value:function(){var e=this;this.mOffsetManager.onOffsetVisibility.pipe(Lp(this._destroy$$)).subscribe((function(t){e.mOffsetGroupId===t.id&&(e.getParentObject().visible=t.visible,P.eventBus().dispatch(new Di(Ei.RequestFrame)))}))}}]),n}(Xi.H);function lM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(cM,"TypeRTTI",new k.r("OffsetGroupControllerComponent",Xi.H.TypeRTTI));var hM=function(e){(0,g.Z)(s,e);var n,i,a=lM(s);function s(){var e;return(0,u.Z)(this,s),e=a.call(this,"buildConfigurable"),(0,l.Z)((0,_.Z)(e),"mSyncHashHelper",new xc),(0,l.Z)((0,_.Z)(e),"mSyncCachedHashHelper",new xc),(0,l.Z)((0,_.Z)(e),"_dependenciesReplay$$",void 0),(0,l.Z)((0,_.Z)(e),"_meshUpdate$$",void 0),(0,l.Z)((0,_.Z)(e),"_destroy$$",void 0),(0,l.Z)((0,_.Z)(e),"_loaderIdle$$",void 0),(0,l.Z)((0,_.Z)(e),"mOffsetNodes",{}),(0,l.Z)((0,_.Z)(e),"mBatches",{}),(0,l.Z)((0,_.Z)(e),"mPlaceHolder",void 0),(0,l.Z)((0,_.Z)(e),"mSharedKeyOverwrite",{}),(0,l.Z)((0,_.Z)(e),"mBoundingBox",void 0),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(e),"mSubscriptionBrokers",[]),(0,l.Z)((0,_.Z)(e),"mBatchesLoaded",!1),(0,l.Z)((0,_.Z)(e),"mFirstBuildMeshList",!1),(0,l.Z)((0,_.Z)(e),"mFirstSceneUpdate",!0),(0,l.Z)((0,_.Z)(e),"mLoaderBusy",!1),(0,l.Z)((0,_.Z)(e),"mBatchSyncHash",new xc),(0,l.Z)((0,_.Z)(e),"mBatchSyncHashCached",new xc),e.mBoundingBox=new ji,e.mBatchSyncHash.copy(e.mBatchSyncHashCached),e}return(0,c.Z)(s,[{key:"getType",value:function(){return s.TypeRTTI}},{key:"OnAttached",value:function(){var e=this;this._meshUpdate$$=new Ht,this._destroy$$=new Ht,this._loaderIdle$$=new ni(1),this.registerMessageHandler(Te.TypeRTTI,this.onSceneUpdate.bind(this)),this.registerMessageHandler(G.TypeRTTI,(function(t){e.mSharedKeyOverwrite[t.materialModelId]=t.sharedKey,Object.keys(e.mBatches).forEach((function(n){e.mBatches[n].setMaterialOverwrite(t.materialModelId,t.sharedKey)}))})),this.observeMeshUpdates();var t=this.getParentObject();this.mSubscriptions.push(t.onMeshListUpdate.subscribe((function(){e.mFirstBuildMeshList=!0,e.dispatchUpdateMeshList()}))),this.mSubscriptionBrokers.push(P.eventBus().subscribe(Di.getTopicName(Ei.DrawingTechniqueFailed),(function(){e.dispatchUpdateMeshList()}))),this.mFirstSceneUpdate=!0}},{key:"OnDetached",value:function(){this.unregisterFromAllMessages(),this.mSubscriptionBrokers.splice(0).forEach((function(e){return e.unsubscribe()})),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this._destroy$$.next(),this._destroy$$.complete(),this.mSharedKeyOverwrite={},this.markLoaderIdle(),this._loaderIdle$$.complete()}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(Mc.TypeRTTI)}},{key:"dispatchUpdateMeshList",value:function(){this.mSyncHashHelper.newHash(),this.mBatchSyncHash.newHash(),this._meshUpdate$$.next()}},{key:"markLoaderBusy",value:function(){this.mLoaderBusy=!0,this._loaderIdle$$.next(!this.mLoaderBusy)}},{key:"markLoaderIdle",value:function(){this.mLoaderBusy=!1,this._loaderIdle$$.next(!this.mLoaderBusy)}},{key:"getBatches",value:function(){return Object.entries(this.mBatches).map((function(e){return o(e,2)[1]}))}},{key:"observeMeshUpdates",value:function(){var e=this;this._meshUpdate$$.pipe(Kt((function(){return e.markLoaderBusy()})),Cc((function(t){return e.resolveDependencies()})),Hp(100,void 0,{leading:!0,trailing:!0}),Cc((function(){return e.mSyncHashHelper.isSame(e.mSyncCachedHashHelper)?Io(void 0):Io({}).pipe(Kt((function(){e.mSyncCachedHashHelper.copy(e.mSyncHashHelper),e.addPlaceHolder()})),ab((function(){return Co(e.reconfigureBuild())})),Kt((function(){e.removePlaceHolder()})))})),Lp(this._destroy$$)).subscribe({next:function(){var t=e.syncObjects();e.mBatchSyncHash.copy(e.mBatchSyncHashCached),e.mBatchesLoaded=0===Object.keys(e.mBatches).length&&e.mFirstBuildMeshList,e.broadcastBuildEvent(!1,e.mBatchesLoaded),e.getParentObject().onConfigurableNodeUpdated.next(t),e.markLoaderIdle()},error:function(t){qe.qL.error(t),e.broadcastBuildEvent(!0),e.markLoaderIdle()}})}},{key:"loadDependencies",value:(i=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getParentObject(),e.next=3,t.resolveSceneOffsetManager();case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"resolveDependencies",value:function(){var e=this;return this._dependenciesReplay$$||(this._dependenciesReplay$$=new ni(1),this.loadDependencies().then((function(){e._dependenciesReplay$$.next(),e._dependenciesReplay$$.complete()}),(function(t){e._dependenciesReplay$$.error(t)}))),this._dependenciesReplay$$}},{key:"createPlaceHolder",value:function(e){var t=e.getValue("place_holder");if(t)try{return qe.qL.print("run place holder function"),t()}catch(e){qe.qL.error("failed to run place holder function:",e)}}},{key:"addPlaceHolder",value:function(){if(!this.mPlaceHolder){var e=this.getParentObject(),t=e.findParentOfType(Pc.TypeRTTI);if(t)if(t.findParentOfType(Pc.TypeRTTI)&&e._isFirstBuild()){var n=void 0;if(n)return n;n=this.createPlaceHolder(t)}}}},{key:"removePlaceHolder",value:function(){this.mPlaceHolder&&delete this.mPlaceHolder}},{key:"reconfigureBuild",value:(n=t(r().mark((function e(){var t,n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getParentObject(),qe.qL.print("job: reconfigure options"),t._isFirstBuild()&&t._getPreconfiguredOptions()){e.next=5;break}return qe.qL.print("ConfigurableNode: configuration loaded."),e.abrupt("return");case 5:if(t._setFirstBuild(!1),n=t.findParentOfType(Pc.TypeRTTI)){e.next=9;break}throw new Error("Could not find product node.");case 9:return i=t._getPreconfiguredOptions(),e.next=12,(new Et).load(n,i);case 12:qe.qL.print("ConfigurableNode: configuration loaded.");case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"createBatchNode",value:function(e,t,n,r,i,a,o){var s,u=this;n in this.mSharedKeyOverwrite&&(s=this.mSharedKeyOverwrite[n]);var c=P.sceneManager().createObject("meshBatch",null,e,n,i,t,a,s);for(var l in c.castShadow=!0,c.receiveShadow=!0,this.mSharedKeyOverwrite){var h=Number(l);c.setMaterialOverwrite(h,this.mSharedKeyOverwrite[h])}return o&&c.setParent(o),f.Ft.isNumeric(r)&&c.findParentOfType(Pc.TypeRTTI)&&c.addComponent(new sM(r)),this.mSubscriptionBrokers.push(P.eventBus().subscribe(Hi.getTopicName(),(function(e){u.updateBoundingBox()}),"".concat(c.getSceneObjectId()))),c}},{key:"syncOffsetNodes",value:function(){var e=this,t=!1,n=this.getParentObject(),r=n.getMeshList();return r&&Array.isArray(r)?(r.forEach((function(r){var i=r.offset_groups_set,a=n;i.forEach((function(n,r){var o=i.filter((function(e,t){return t<=r})).join(":");if(o in e.mOffsetNodes)return e.mOffsetNodes[o].setSyncHash(e.mSyncHashHelper.getHash()),void(a=e.mOffsetNodes[o]);var s=P.sceneManager().createObject("node");s.name="OffsetNode:".concat(o),e.mOffsetNodes[o]=s,P.sceneManager().addNode(s,a,!1),s.setSyncHash(e.mSyncHashHelper.getHash()),s.addComponent(new cM(n)),a=s,t=!0}))})),t):t}},{key:"clearOutOfSyncObjects",value:function(e){var t=this,n=!1,r=[];return Object.keys(e).forEach((function(i){var a=e[i],o=a.isDerivedOfTypeName("SceneEntity")&&a;(!a.isInSyncWithHash(t.mSyncHashHelper.getHash())||o&&o.renderObjectLoadState()===qi.Failed)&&(a.destroy(!1,new pe),P.sceneManager().removeNode(a,!1,!1),r.push(i),n=!0)})),r.forEach((function(t){delete e[t]})),n}},{key:"syncMeshes",value:function(){var e=this,t=!1,n=this.getParentObject(),r=n.getMeshList();return r&&Array.isArray(r)?(r.forEach((function(r){var i="".concat(r.batch).concat(r.material_id);if(i in e.mBatches)e.mBatches[i].setSyncHash(e.mSyncHashHelper.getHash());else{var a=r.offset_groups_set,o=a.join(":"),s=0===a.length?n:e.mOffsetNodes[o];e.mBatches[i]=e.createBatchNode(r.batch,r.nodes,r.material_id,r.material_group,r.offset_groups_set,e.mSyncHashHelper.getHash(),s),P.sceneManager().addNode(e.mBatches[i],s,!1),t=!0}})),t):t}},{key:"syncObjects",value:function(){var e=!1;return e=this.syncOffsetNodes()||e,e=this.syncMeshes()||e,e=this.clearOutOfSyncObjects(this.mBatches)||e,e=this.clearOutOfSyncObjects(this.mOffsetNodes)||e,this.updateBoundingBox(),P.eventBus().dispatch(new Di(Ei.RequestFrame)),e}},{key:"onSceneUpdate",value:function(e){var t=this;if(this.updateFirstBuild(),this.setProcessStatus(e),this.mFirstBuildMeshList&&!this.mBatchesLoaded&&this.mBatchSyncHash.isSame(this.mBatchSyncHashCached)){var n=Object.keys(this.mBatches);this.mBatchesLoaded=this.mFirstBuildMeshList&&(0===n.length||!n.some((function(e){return t.mBatches[e].renderObjectLoadState()!==qi.Loaded&&t.mBatches[e].renderObjectLoadState()!==qi.Failed}))),this.mBatchesLoaded&&this.broadcastBuildEvent(!1,!0)}}},{key:"updateFirstBuild",value:function(){this.mFirstSceneUpdate&&(this.mFirstSceneUpdate=!1,this._meshUpdate$$.next())}},{key:"setProcessStatus",value:function(e){e.setProcessStatus(s.TypeRTTI.getTypeName(),this.mLoaderBusy?ke.InProgress:ke.Idle)}},{key:"updateBoundingBox",value:function(){this.mBoundingBox.makeEmpty();var e=this.getParentObject();for(var t in this.mBatches){var n=this.mBatches[t];if(n.visible){var r=n.getBoundingBox(!1).clone();if(!r.isEmpty()){for(var i=new Fi,a=n.getParent();a&&a.getSceneObjectId()!==e.getSceneObjectId();)i.premultiply(a.transform.matrix),a=a.getParent();i.multiply(n.transform.matrix),r.applyMatrix4(i),this.mBoundingBox.union(r)}}}this.getParentObject()._updateBoundingBox(this.mBoundingBox)}},{key:"broadcastBuildEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e||arguments.length>1&&void 0!==arguments[1]&&arguments[1]){var t=this.getParentObject().findParentOfType(Pc.TypeRTTI);if(t){var n=e?Ei.ProductErrorLoading:Ei.ProductFinishedLoading;P.eventBus().dispatch(new Di(n,{catalogue_id:t.productId,scene_object_id:t.getSceneObjectId(),object_uuid:t.getObjectUUID()}))}}}}]),s}(Xi.H);function fM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(hM,"TypeRTTI",new k.r("BuildConfigurableComponent",Xi.H.TypeRTTI));var pM=function(e){(0,g.Z)(n,e);var t=fM(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mClippingPlanes",[]),e}return(0,c.Z)(n,[{key:"getType",value:function(){return Ya.clipping_plane}},{key:"getPlanes",value:function(){return this.mClippingPlanes}},{key:"push",value:function(){var e;(e=this.mClippingPlanes).push.apply(e,arguments)}},{key:"pop",value:function(){return this.mClippingPlanes.pop()}},{key:"shift",value:function(){return this.mClippingPlanes.shift()}},{key:"unshift",value:function(e){this.mClippingPlanes.unshift(e)}},{key:"length",value:function(){return this.mClippingPlanes.length}},{key:"clear",value:function(){return this.mClippingPlanes.splice(0)}}]),n}($a);function mM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var dM=function(e){(0,g.Z)(n,e);var t=mM(n);function n(){var e;return(0,u.Z)(this,n),e=t.call(this,"clippingController"),(0,l.Z)((0,_.Z)(e),"mClippingPlanes",{}),(0,l.Z)((0,_.Z)(e),"mWorldClippingState",new pM),e}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"OnAttached",value:function(){this.registerMessageHandler(Te.TypeRTTI,this.handleSceneUpdate.bind(this))}},{key:"OnDetached",value:function(){this.unregisterFromAllMessages()}},{key:"isAttachable",value:function(e){return e.isDerivedOfTypeName("ProductNode")}},{key:"updateClippingFromComponent",value:function(e){var t;e&&(t=this.mWorldClippingState).push.apply(t,s(e.getClippingPlanes()))}},{key:"updateClippingFromRoot",value:function(e){if(e){var t=e.getComponent("clippingController");this.updateClippingFromComponent(t),this.updateClippingFromRoot(e.getParent())}}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t,n){var r;null===(r=this.mClippingPlanes[e])||void 0===r||r.setFromNormalAndCoplanarPoint(t,n)}},{key:"setClippingPlane",value:function(e,t){var n;null===(n=this.mClippingPlanes[e])||void 0===n||n.copy(t)}},{key:"addClippingPlane",value:function(e){var t=y.F.guid();return this.mClippingPlanes[t]=e.clone(),t}},{key:"removeClippingPlane",value:function(e){delete this.mClippingPlanes[e]}},{key:"getClippingPlane",value:function(e){return this.mClippingPlanes[e]}},{key:"getClippingPlanes",value:function(){return Object.entries(this.mClippingPlanes).map((function(e){var t=o(e,2);t[0];return t[1]}))}},{key:"getWorldClippingState",value:function(){return this.mWorldClippingState}},{key:"handleSceneUpdate",value:function(e){var t;this.mWorldClippingState.clear(),(t=this.mWorldClippingState).push.apply(t,s(this.getClippingPlanes()));var n=this.getParentObject();this.updateClippingFromRoot(n.getParent()),this.mWorldClippingState.length()>0?n.setGlobalState(this.mWorldClippingState):n.removeGlobalState(Ya.clipping_plane)}}]),n}(Xi.H);function vM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(dM,"TypeRTTI",new k.r("ClippingControllerComponent",Xi.H.TypeRTTI));var yM=function(e){(0,g.Z)(n,e);var t=vM(n);function n(){return(0,u.Z)(this,n),t.call(this,"auto-focus")}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"OnAttached",value:function(){}},{key:"OnDetached",value:function(){}},{key:"isAttachable",value:function(e){return e.isDerivedOfTypeName("CameraEntity")}}]),n}(Xi.H);function gM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(yM,"TypeRTTI",new k.r("AutoFocusComponent",Xi.H.TypeRTTI));var bM=function(e){(0,g.Z)(n,e);var t=gM(n);function n(){return(0,u.Z)(this,n),t.call(this,"metricTransformer")}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"OnAttached",value:function(){this.registerMessageHandler(Te.TypeRTTI,this.handleSceneUpdate.bind(this))}},{key:"OnDetached",value:function(){this.unregisterFromAllMessages()}},{key:"isAttachable",value:function(e){if(!e.isDerivedTypeOf(Wi.TypeRTTI))return!1;var t=e;return!!t.getValue("unit")&&f.Ft.isNumeric(t.getValue("world_ratio"))}},{key:"handleSceneUpdate",value:function(){var e=this.getParentObject(),t=e.getValue("unit"),n=e.getValue("world_ratio"),r=1;switch(t.toLowerCase()){case"mm":r=1e3;break;case"cm":r=100;break;case"inch":r=.0254}r*=n,e.transform.matrixCache.scale(new Bi(r,r,r))}}]),n}(Xi.H);function MM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(bM,"TypeRTTI",new k.r("MetricTransformerComponent",Xi.H.TypeRTTI));var kM=function(e){(0,g.Z)(s,e);var n,i,a,o=MM(s);function s(){var e;if((0,u.Z)(this,s),e=o.call(this,"droppable-handler"),(0,l.Z)((0,_.Z)(e),"mParentEntity",void 0),(0,l.Z)((0,_.Z)(e),"mCellPlane",void 0),(0,l.Z)((0,_.Z)(e),"mCellPlaneGeometry",void 0),(0,l.Z)((0,_.Z)(e),"mCellPlaneMaterial",void 0),(0,l.Z)((0,_.Z)(e),"mCellPlaneWidth",void 0),(0,l.Z)((0,_.Z)(e),"mCellPlaneHeight",void 0),(0,l.Z)((0,_.Z)(e),"mPlaneOpacity",0),(0,l.Z)((0,_.Z)(e),"mAnimationHandle",void 0),e.mCellPlaneWidth=1,e.mCellPlaneHeight=1,!s.sDroppableTextureHandle){var t,n=tc.getManager(Qu.TextureManager),r=(new yu).load("".concat(Jr.E.assetsUrl,"system/placeholders/drop-icon.png"),(function(){t.updateSource(r)}),void 0,(function(e){qe.qL.error("Unable to load droppable-cell-plane texture:",e);var t=s.sDroppableTextureHandle;delete s.sDroppableTextureHandle,n.disposeResource(t)}));t=P.renderer().getRenderEngine().createTexture2D("droppable-cell-texture",r,!0,void 0,Ss.ClampToEdge,Ss.ClampToEdge,Zs.Linear,Zs.Linear,Zs.Linear,!1),s.sDroppableTextureHandle=n.makeResourceRaw(t)}return e}return(0,c.Z)(s,[{key:"OnAttached",value:function(){this.mParentEntity=this.getParentObject()}},{key:"OnDetached",value:function(){this.cancelAnimation(),this.disposeCellPlane(),delete this.mParentEntity}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(nm.TypeRTTI)}},{key:"createCellPlane",value:(a=t(r().mark((function e(){var t,n,i,a,o,u,c,l=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.length>0&&void 0!==l[0]?l[0]:1,n=l.length>1&&void 0!==l[1]?l[1]:1,this.mParentEntity){e.next=4;break}return e.abrupt("return");case 4:if(this.mCellPlane&&this.mCellPlaneWidth===t&&this.mCellPlaneHeight===n){e.next=35;break}if(this.disposeCellPlane(),this.mCellPlaneWidth=t,this.mCellPlaneHeight=n,this.mCellPlaneMaterial=P.renderer().getRenderEngine().createMaterialBasic("droppable-cell-plane"),this.mCellPlaneMaterial.setDiffuseColor(new so(2677654)),this.mCellPlaneMaterial.setSide(Es.Double),this.mCellPlaneMaterial.setTransparent(!0),this.mCellPlaneMaterial.setOpacity(0),!s.sDroppableTextureHandle){e.next=20;break}return i=tc.getManager(Qu.TextureManager),a=i.findResourceWithHandle(s.sDroppableTextureHandle),e.next=18,a.resolve();case 18:o=e.sent,this.mCellPlaneMaterial.setDiffuseMap(o);case 20:this.mCellPlaneGeometry=Xp.Create(t,n,1,1),this.mCellPlane=P.sceneManager().createObject("mesh",void 0,this.mCellPlaneGeometry,this.mCellPlaneMaterial),this.mCellPlane.pickable=!1,this.mCellPlane.layers.enable(4),this.mCellPlane.layers.enable(5),this.mCellPlane.name="droppable-cell-plane",this.mCellPlane.castShadow=!1,this.mCellPlane.receiveShadow=!1,u=P.sceneManager().getScene(),c=Bi.One(),u.transform.getWorldScale(c),this.mCellPlane.transform.scale.copy(new Bi(1/(Math.abs(c.x)<1e-5?1:c.x),1/(Math.abs(c.y)<1e-5?1:c.y),1/(Math.abs(c.z)<1e-5?1:c.z))),this.mCellPlane.transform.rotation.copy(new Li(-.5*Math.PI,0,0)),P.sceneManager().addNode(this.mCellPlane,void 0,!1),qe.qL.print("Create cell plane:",t,n);case 35:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"disposeCellPlane",value:function(){this.mCellPlane&&(delete this.mCellPlaneGeometry,delete this.mCellPlaneMaterial,P.sceneManager().removeNode(this.mCellPlane,!1,!0),this.mCellPlane.destroy(),delete this.mCellPlane)}},{key:"getCellPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=this.getCellQuaternion(e),i=new Bi(t,0,n).addScalar(1e-5),a=i.clone().applyQuaternion(r),o=i.clone().multiplyScalar(.5).applyQuaternion(r);return(new Bi).copy(e.point).divide(a).floor().multiply(a).add(o)}},{key:"getCellRotation",value:function(e){return(new Li).setFromQuaternion(this.getCellQuaternion(e))}},{key:"getCellQuaternion",value:function(e){return this.mCellPlane.transform.quaternion.clone().multiply((new Pi).setFromEuler(new Li(.5*Math.PI,0,0)))}},{key:"interceptDragMove",value:(i=t(r().mark((function e(t){var n,i,a,o,s,u=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:1,i=u.length>2&&void 0!==u[2]?u[2]:1,e.next=4,this.createCellPlane(n,i);case 4:return a=this.mParentEntity.getCellSize(),o=this.getCellPosition(t,a.width,a.height),this.mCellPlane.transform.quaternion.copy(t.entity.transform.quaternion),s=t.normal,o.add(s.clone().multiplyScalar(.003)),this.fadeIn(o),e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"fadeIn",value:function(e){this.mCellPlane&&this.mCellPlane.transform.position.distanceToSquared(e)>.001&&(qe.qL.print("Reset cell to position: ",e),this.mPlaneOpacity=.1,this.mCellPlane.transform.position.copy(e),this.cancelAnimation(),this.animateFadeIn())}},{key:"cancelAnimation",value:function(){void 0!==this.mAnimationHandle&&(window.cancelAnimationFrame(this.mAnimationHandle),delete this.mAnimationHandle)}},{key:"animateFadeIn",value:function(){var e=this;this.mPlaneOpacity+=.025,this.mPlaneOpacity=Math.min(1,this.mPlaneOpacity),this.mCellPlaneMaterial.setOpacity(this.mPlaneOpacity),this.mPlaneOpacity>=1?delete this.mAnimationHandle:this.mAnimationHandle=window.requestAnimationFrame((function(){return e.animateFadeIn()}))}},{key:"animateFadeOut",value:function(){var e=this;this.mPlaneOpacity-=.025,this.mPlaneOpacity=Math.max(0,this.mPlaneOpacity),this.mCellPlaneMaterial.setOpacity(this.mPlaneOpacity),this.mPlaneOpacity<=0?delete this.mAnimationHandle:this.mAnimationHandle=window.requestAnimationFrame((function(){return e.animateFadeOut()}))}},{key:"markDragMaterial",value:function(e){return!0}},{key:"resetDragMaterial",value:function(e){qe.qL.print("reset drag material object:",e),this.cancelAnimation(),this.animateFadeOut()}},{key:"acceptDrop",value:(n=t(r().mark((function e(t){var n,i,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.mParentEntity.getCellSize(),this.mCellPlane){e.next=4;break}return e.next=4,this.createCellPlane(n.width,n.height);case 4:return i=this.getCellPosition(t,n.width,n.height),a=this.getCellQuaternion(t),qe.qL.print("Place on intersection:",i,a,t),e.abrupt("return",zi.create(i,a,Bi.One()));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})}]),s}(Xi.H);(0,l.Z)(kM,"sDroppableTextureHandle",void 0);var _M=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,null,[{key:"Create",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new so(4473924),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new so(8947848),i=t/2,a=e/t,o=e/2,s=[],u=[],c=[],l=0,h=-o,f=0;l<=t;l++,h+=a,f+=4){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);var p=l===i?r:n;c.push(p.r,p.g,p.b,1),c.push(p.r,p.g,p.b,1),c.push(p.r,p.g,p.b,1),c.push(p.r,p.g,p.b,1),u.push(f,f+1,f+2,f+3)}var m=P.renderer().getRenderEngine().createBuffer();return m.setIndexData(new Ru(new Uint32Array(u),1)),m.setVertexData(_u.POSITION,new Ru(new Float32Array(s),3)),m.setVertexData(_u.COLOR,new Ru(new Float32Array(c),4)),m}}]),e}();function xM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var TM=function(e){(0,g.Z)(n,e);var t=xM(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new so(4473924),s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new so(8947848);(0,u.Z)(this,n),r=t.call(this,e,_M.Create(i,a,o,s)),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.mesh_line),r.mName="GridEntity",r.mPickable=!0,r.mCastShadow=!1,r.drawMode=ec.LINES;var c=P.renderer().getRenderEngine().createMaterialLine("grid-material");return c.setDiffuseColor(so.White()),r.setMaterial(c),r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(om);function wM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(TM,"TypeRTTI",new k.r("GridEntity",om.TypeRTTI));var RM=function(e){(0,g.Z)(a,e);var n,i=wM(a);function a(){var e;return(0,u.Z)(this,a),e=i.call(this,"catalogueMeta"),(0,l.Z)((0,_.Z)(e),"mCatalogueMeta",void 0),e}return(0,c.Z)(a,[{key:"loadCatalogueMeta",value:(n=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.getParentObject().productId;qe.qL.print("resolve catalogue meta for: ",r),Ko.getInstance().resolveBootstrapData(r).pipe(sn(1)).subscribe((function(n){var r=n.getCatalogue();t.mCatalogueMeta=r||{},e(t.mCatalogueMeta)}),(function(e){n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"getCatalogueMeta",value:function(){return this.mCatalogueMeta}},{key:"OnAttached",value:function(){}},{key:"OnDetached",value:function(){}},{key:"isAttachable",value:function(e){return e.isDerivedTypeOf(Pc.TypeRTTI)}}]),a}(Xi.H);function ZM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var SM=function(e){(0,g.Z)(n,e);var t=ZM(n);function n(){var e;return(0,u.Z)(this,n),(e=t.call(this)).registerFactories({product:{factory:Pc,components:[Cb,Bf,Tv,kb,xb,Eb,Hb,Mm,RM,dM]},configurable:{factory:Mc,components:[aM,hM,bM]},vnode:{factory:Ga},node:{factory:Ga},mesh:{factory:rc},meshBatch:{factory:im},group:{factory:Yp},view:{factory:Ep},spotLight:{factory:Qc},pointLight:{factory:Xc},hemisphereLight:{factory:Yc},directionalLight:{factory:qc},ambientLight:{factory:Hc},rectAreaLight:{factory:Bd},sphere:{factory:Ld},plane:{factory:jd},box:{factory:Ud},line:{factory:Ym},camera_perspective:{factory:jc,components:[]},camera_perspective_fps:{factory:jc,components:[la]},camera_perspective_orbit:{factory:jc,components:[sa]},camera_perspective_turntable:{factory:jc,components:[fa]},camera_auto_focus:{factory:jc,components:[sa,yM]},reference_product:{factory:Lf},water:{factory:Hd},reflector:{factory:Yb},glare:{factory:qd},flare:{factory:Yd},fire:{factory:Qm},skycube:{factory:Xd},skyequirect:{factory:Qd},ao_plane:{factory:Ob},global_clipper:{factory:tv},uix_button:{factory:av},uix_image:{factory:sv},uix_tag:{factory:cv},uix_text:{factory:hv},uix_annotation:{factory:Qb},drop_area:{factory:nm,components:[kM]},grid:{factory:TM}}),e}return(0,c.Z)(n)}(Jb),CM=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mNewNodes",{}),(0,l.Z)(this,"mDeleteNodes",{}),(0,l.Z)(this,"mMovedNodes",{})}return(0,c.Z)(e,[{key:"_createNewNodesIfNotExists",value:function(e){this.mNewNodes[e]=this.mNewNodes[e]||[]}},{key:"_createDeletedNodesIfNotExists",value:function(e){this.mDeleteNodes[e]=this.mDeleteNodes[e]||{}}},{key:"_createMovedNodesIfNotExists",value:function(e){this.mMovedNodes[e]=this.mMovedNodes[e]||{}}},{key:"getNodeNamespace",value:function(e){var t="/",n=[],r=null==e?void 0:e.findParentOfType(Pc.TypeRTTI),i=null==e?void 0:e.findParentOfType(Lf.TypeRTTI);for(!r||i&&null!=e&&e.isDerivedTypeOf(Pc.TypeRTTI)?n.push(e):n.push(r);n.length>0;){var a=n.shift();if(!a)break;if(a.isDerivedTypeOf(Pc.TypeRTTI)){var o=(i=a.findParentOfType(Lf.TypeRTTI))?i.getObjectUUID():a.productId;t="/".concat(o).concat(t)}var s=a.findParentOfType(Pc.TypeRTTI);s&&n.push(s)}return t}},{key:"addNewNode",value:function(e){var t=this.getNodeNamespace(e);this._createNewNodesIfNotExists(t),this._createDeletedNodesIfNotExists(t),this.mNewNodes[t].find((function(t){return t.getObjectId()===e.getObjectId()}))||this.mNewNodes[t].push(e),!0===this.mDeleteNodes[t][e.getSceneObjectId()]&&delete this.mDeleteNodes[t][e.getSceneObjectId()]}},{key:"getNewNodes",value:function(e){return this._createNewNodesIfNotExists(e),this.mNewNodes[e]}},{key:"getDeletedNodes",value:function(e){return this._createDeletedNodesIfNotExists(e),Object.keys(this.mDeleteNodes[e]).map((function(e){return parseInt(e,10)}))}},{key:"isNodeDeleted",value:function(e,t){return this._createDeletedNodesIfNotExists(e),!0===this.mDeleteNodes[e][t]}},{key:"isNodeMoved",value:function(e,t){return this._createMovedNodesIfNotExists(e),this.mMovedNodes[e][t]?this.mMovedNodes[e][t]:null}},{key:"setNodeDeleted",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=(arguments.length>3?arguments[3]:void 0)||this.getNodeNamespace(e);if(this._createNewNodesIfNotExists(r),this._createDeletedNodesIfNotExists(r),t<0){var i=this.mNewNodes[r].findIndex((function(e){return-e.id===t}));i>=0&&this.mNewNodes[r].splice(i,1)}else this.mDeleteNodes[r][t]=n}},{key:"setNodeMoved",value:function(e,t,n){var r=this.getNodeNamespace(e);this._createMovedNodesIfNotExists(r),this.mMovedNodes[r][t]=n}},{key:"resetNodeStates",value:function(){this.mNewNodes={},this.mDeleteNodes={},this.mMovedNodes={}}}]),e}();function IM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var EM,AM=function(e){(0,g.Z)(n,e);var t=IM(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"delta",void 0),r.delta=e,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}}]),n}(w);function OM(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return DM(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return DM(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function DM(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}(0,l.Z)(AM,"TypeRTTI",new k.r("MessageSceneBeforeUpdate",w.TypeRTTI)),function(e){e[e.Started=0]="Started",e[e.Finished=1]="Finished",e[e.Error=2]="Error"}(EM||(EM={}));var PM=function(){function e(t,n){(0,u.Z)(this,e),(0,l.Z)(this,"mSceneFactory",void 0),(0,l.Z)(this,"mPersistPool",void 0),(0,l.Z)(this,"mScene",void 0),(0,l.Z)(this,"mActiveView",void 0),(0,l.Z)(this,"mSelectedEntity",void 0),(0,l.Z)(this,"mSubscriptions",[]),(0,l.Z)(this,"mActiveProductNode",void 0),(0,l.Z)(this,"mProductLoadingEvent",void 0),(0,l.Z)(this,"mProductLoaded",void 0),(0,l.Z)(this,"mOnSceneUpdated",void 0),this.mSceneFactory=t||new SM,this.mPersistPool=n||new CM}return(0,c.Z)(e,[{key:"createObject",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var a=[t].concat(r||[]);return this.mSceneFactory.createObject(e,a)}},{key:"isScene",value:function(e){return this.mScene.getObjectId()===e.getObjectId()}},{key:"getScene",value:function(){return this.mScene}},{key:"getRootProductNode",value:function(){return this.findNodesOfType(Pc.TypeRTTI,(function(e){return e.enabled}))[0]}},{key:"getActiveProductNode",value:function(){return this.mActiveProductNode}},{key:"setActiveProductNode",value:function(e){this.mActiveProductNode=e}},{key:"getActiveCamera",value:function(){var e=this.findNodesOfType(ga.TypeRTTI,(function(e){return e.isCameraActive()}));if(0===e.length){var t=this.createObject("camera_perspective_orbit");t.name="DefaultCamera",t.transform.position.set(0,1,3),t.target.set(0,0,0),t.fov=45,t.near=.01,t.far=1e3,t.setCameraActive(!0),t.setCameraPartOfScene(!1),e.push(t),this.addNode(t),qe.qL.print("SceneManager adding default camera to scene.",t)}return e[0]}},{key:"getDefaultView",value:function(){var e=this.getRootProductNode();if(e)return this.findNodesOfType(Ep.TypeRTTI,(function(t){var n=t.findParentOfType(Pc.TypeRTTI);return!!n&&n.getObjectUUID()===e.getObjectUUID()}),e)[0]}},{key:"setActiveViewId",value:function(e,t){var n=this.findNodesOfType(Pc.TypeRTTI,(function(t){return t.getSceneObjectId()===e}));if(0!==n.length){var r=this.findNodesOfType(Ep.TypeRTTI,(function(e){return e.getViewId()===t}),n[0]);if(0!==r.length)return this.setActiveView(r[0]),r[0]}}},{key:"setActiveView",value:function(e){this.mActiveView=e,qe.qL.print("Make viewnode active:",this.mActiveView),this.findNodesOfType(Ep.TypeRTTI).forEach((function(e){e.enabled=e.isViewVisible()})),P.eventBus().dispatch(new Di(Ei.ActiveViewChanged,this.mActiveView)),this.deselect()}},{key:"findNodesOfType",value:function(e,t,n){return this.findNodesOfTypeName(e.getTypeName(),t,n)}},{key:"findNodesOfTypeName",value:function(e,t,n){var r=new Array,i=new Array;if(!this.mScene)return r;for(i.push(n||this.mScene);i.length>0;){var a=i.shift();a.isDerivedOfTypeName(e)&&(null==t||t(a))&&r.push(a),a.isDerivedTypeOf(Ga.TypeRTTI)&&a.getChildren().forEach((function(e){i.push(e)}))}return r}},{key:"fixedUpdate",value:function(e){this.mScene.fixedUpdate(new ye(e))}},{key:"update",value:function(e){this.mScene.beforeUpdate(new AM(e));var t=new Te(e);this.mScene.update(t),this.mOnSceneUpdated.next(t),this.mScene.afterUpdate(new tM(e))}},{key:"_draw",value:function(e,t){this.mScene.draw(e,t)}},{key:"_afterDraw",value:function(e,t){this.mScene.afterDraw(e,t)}},{key:"createScene",value:function(){var e=this;if(!this.mScene){this.mScene=this.createObject("node",-1),this.mScene.name="Scene",this.mSubscriptions.push(P.eventBus().subscribe(Di.getTopicName(Ei.ObjectSelected),(function(t){var n=t.getData().selection;e.select(n,{},!1)})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductStartLoading),(function(t){e.mProductLoadingEvent.next({name:"start",event:t})})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductFinishedLoading),(function(t){e.mProductLoadingEvent.next({name:"finished",event:t})})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductErrorLoading),(function(t){e.mProductLoadingEvent.next({name:"error",event:t})}))),this.mOnSceneUpdated=new Ht;var t=new Map;this.mProductLoaded=new Ht,this.mProductLoadingEvent=new Ht,this.mProductLoadingEvent.pipe(Kt((function(e){var n=e.event.getData().scene_object_id;switch(e.name){case"start":t.set(n,EM.Started);break;case"finished":t.has(n)&&t.set(n,EM.Finished);break;case"error":t.has(n)&&t.set(n,EM.Error)}})),Lp(this.mProductLoaded)).subscribe((function(){Array.from(t.values()).some((function(e){return e===EM.Started}))||(Array.from(t.values()).some((function(e){return e===EM.Error}))&&P.eventBus().dispatch(new Di(Ei.BuildFailed)),P.eventBus().dispatch(new Di(Ei.BuildFullyLoaded)),e.mProductLoaded.next())}))}}},{key:"destroyScene",value:function(){this.mScene&&(this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mProductLoadingEvent.unsubscribe(),this.mProductLoaded.next(),this.mProductLoaded.complete(),this.mOnSceneUpdated.complete(),this.mScene.destroy(!0,new pe),this.removeNode(this.mScene,!1,!0),delete this.mScene)}},{key:"addNode",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t||this.getScene();r?r._attachChild(e):(e.setParent(r),e.onAttached(r),P.eventBus().dispatch(new Di(Ei.SceneObjectAttached,e))),n&&this.getPersistPool().addNewNode(e),P.eventBus().dispatch(new Di(Ei.SceneGraphAdded,e)),P.eventBus().dispatch(new Di(Ei.NodeAdded,e))}},{key:"removeNode",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=e.getParent();if(a){if(!a.isDerivedTypeOf(Ga.TypeRTTI))throw new Error("Parent '".concat(a.name,"' is not a SceneNode object"));n&&this.deepRemoveNode(e,t&&r,i);var o=this.getPersistPool().getNodeNamespace(e),s=a._detachChild(e);return s?(t&&this.getPersistPool().setNodeDeleted(s,s.getSceneObjectId(),!0,o),i&&s.destroy(),P.eventBus().dispatch(new Di(Ei.SceneGraphRemoved,e)),P.eventBus().dispatch(new Di(Ei.NodeRemoved,s)),s):s}qe.qL.warn("'".concat(e.name,"' is not attached to any parent."))}},{key:"deepRemoveNode",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;e.isDerivedTypeOf(Ga.TypeRTTI)&&e.getChildren().forEach((function(e){t.removeNode(e,n,!0,!0,r)}))}},{key:"moveNode",value:function(e,t){qe.qL.print("Move",e,t);var n=e.getParent();if(n){var r=n._detachChild(e);if(r)return t._attachChild(r),r.getSceneObjectId()>=0&&this.getPersistPool().setNodeMoved(r,r.getSceneObjectId(),t.getSceneObjectId()),P.eventBus().dispatch(new Di(Ei.SceneGraphChanged,e)),P.eventBus().dispatch(new Di(Ei.NodeChanged,r)),r}else qe.qL.warn("product node can not be moved")}},{key:"saveScene",value:function(){var e=this.findNodesOfType(Pc.TypeRTTI);e.splice(1);var t,n=[],r=OM(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=i.serialize(!1,!0);n.push({product_id:parseInt(i.getValue("product_id"),10),scene:a,deletions:this.getPersistPool().getDeletedNodes(this.getPersistPool().getNodeNamespace(i))})}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"resetSaveStates",value:function(){this.getPersistPool().resetNodeStates()}},{key:"select",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return!(!e&&!this.mSelectedEntity||this.mSelectedEntity&&e&&this.mSelectedEntity.getSceneObjectId()===e.getSceneObjectId())&&(this.mSelectedEntity=e,qe.qL.print("SceneManager: selected entity:",this.mSelectedEntity,t,n),n&&P.eventBus().dispatch(new Di(Ei.ObjectSelected,{selection:this.mSelectedEntity,options:t})),!0)}},{key:"deselect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.select(void 0,e,t)}},{key:"getActiveView",value:function(){return this.mActiveView}},{key:"getSelectedEntity",value:function(){return this.mSelectedEntity}},{key:"getActiveCameraId",value:function(){return this.getActiveCamera().getSceneObjectId()}},{key:"getSceneFactory",value:function(){return this.mSceneFactory}},{key:"getPersistPool",value:function(){return this.mPersistPool}},{key:"onSceneUpdated",get:function(){return this.mOnSceneUpdated}},{key:"onSceneIdle",get:function(){return this.mOnSceneUpdated.pipe(Bo((function(e){return!e.isAnyProcessInProgress()})))}}]),e}(),BM=function(){function e(t,n){(0,u.Z)(this,e),(0,l.Z)(this,"mRenderer",void 0),(0,l.Z)(this,"mSceneEntity",void 0),(0,l.Z)(this,"mSyncHash",""),(0,l.Z)(this,"mReady",!1),(0,l.Z)(this,"mAttached",!1),(0,l.Z)(this,"mDisposed",!1),this.mRenderer=n,this.mSceneEntity=t}return(0,c.Z)(e,[{key:"ready",get:function(){return this.mReady}},{key:"attached",get:function(){return this.mAttached}},{key:"disposed",get:function(){return this.mDisposed}},{key:"initialize",value:function(){var e=this;this.mReady=!1,this.mDisposed=!1,this.mSceneEntity.setRenderObjectLoadState(qi.Loading),this.loadResource().then((function(){e.mDisposed||(e.createRenderObject(),e.mReady=!0,e.afterCreateRenderObject(),e.mSceneEntity.setRenderObjectLoadState(qi.Loaded))}),(function(t){qe.qL.warn("failed to load resources: ",t),e.mDisposed=!0,e.mSceneEntity.setRenderObjectLoadState(qi.Failed),P.eventBus().dispatch(new Di(Ei.DrawingTechniqueFailed,{entity:e.mSceneEntity}))}))}},{key:"attach",value:function(){this.mAttached=!0}},{key:"detach",value:function(){this.mAttached=!1}},{key:"setSyncHash",value:function(e){this.mSyncHash=e}},{key:"getSyncHash",value:function(){return this.mSyncHash}},{key:"update",value:function(e){}},{key:"dispose",value:function(){this.mDisposed||(this.destroyRenderObject(),this.mDisposed=!0)}},{key:"afterCreateRenderObject",value:function(){}},{key:"equals",value:function(e){return!!e&&this.mSceneEntity.id===e.id}},{key:"equalsId",value:function(e){return this.mSceneEntity.id===e}},{key:"getSceneEntity",value:function(){return this.mSceneEntity}}]),e}();function FM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var LM=function(e){(0,g.Z)(n,e);var t=FM(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mRenderObject",void 0),(0,l.Z)((0,_.Z)(e),"mMatrix",BABYLON.Matrix.Identity()),(0,l.Z)((0,_.Z)(e),"mShowNormals",!1),(0,l.Z)((0,_.Z)(e),"mNormalHelper",void 0),(0,l.Z)((0,_.Z)(e),"mMatrixNeedsUpdate",!0),(0,l.Z)((0,_.Z)(e),"mBoundingBox",new ji),(0,l.Z)((0,_.Z)(e),"mOriginalAttachState",void 0),(0,l.Z)((0,_.Z)(e),"mSubscriptions",[]),e}return(0,c.Z)(n,[{key:"attach",value:function(){Ni((0,M.Z)(n.prototype),"attach",this).call(this),this.makeVisibleAfterAttach(),this.mSubscriptions.push(this.mSceneEntity.transform.onChange.subscribe(this.onMatrixUpdate.bind(this)))}},{key:"detach",value:function(){Ni((0,M.Z)(n.prototype),"detach",this).call(this),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"getRenderObject",value:function(){return this.mRenderObject}},{key:"getRenderer",value:function(){return this.mRenderer}},{key:"update",value:function(e){Ni((0,M.Z)(n.prototype),"update",this).call(this,e),this.updateTranslation(),this.mSceneEntity.needsBoundingBoxUpdate()&&this.updateBoundingBox(),this.mSceneEntity.needsRenderUpdate()&&(this.onUpdateDirty(),this.mSceneEntity.setNeedsRenderUpdate(!1))}},{key:"onUpdateDirty",value:function(){this.mRenderObject&&this.mRenderObject.setEnabled(this.mSceneEntity.visible)}},{key:"updateTranslation",value:function(){if(!this.mMatrixNeedsUpdate&&!this.mSceneEntity.transform.matrixNeedsUpdate&&!this.mSceneEntity.transform.matrixWorldNeedsUpdate)return!1;var e=this.mSceneEntity.transform.matrixWorld.elements;return this.mMatrix.setRowFromFloats(0,e[0],e[1],e[2],e[3]),this.mMatrix.setRowFromFloats(1,e[4],e[5],e[6],e[7]),this.mMatrix.setRowFromFloats(2,e[8],e[9],e[10],e[11]),this.mMatrix.setRowFromFloats(3,e[12],e[13],e[14],e[15]),this.mRenderer.isRightHandedSystemActive()||this.mMatrix.toggleModelMatrixHandInPlace(),this.mRenderObject instanceof BABYLON.TransformNode&&(this.mRenderObject.freezeWorldMatrix(this.mMatrix),this.mRenderObject instanceof BABYLON.AbstractMesh&&this.mRenderObject._updateBoundingInfo()),this.mNormalHelper&&this.mNormalHelper.freezeWorldMatrix(this.mMatrix),!0}},{key:"updateBoundingBox",value:function(){this.mSceneEntity._updateBoundingBox(this.mBoundingBox)}},{key:"getVisibilityAttachState",value:function(){return this.mRenderObject.isEnabled()}},{key:"setVisibilityAttachState",value:function(e){this.mRenderObject.setEnabled(e)}},{key:"makeInvisibleBeforeAttach",value:function(){this.mOriginalAttachState=this.getVisibilityAttachState(),this.setVisibilityAttachState(!1)}},{key:"makeVisibleAfterAttach",value:function(){void 0!==this.mOriginalAttachState&&this.setVisibilityAttachState(this.mOriginalAttachState)}},{key:"afterCreateRenderObject",value:function(){Ni((0,M.Z)(n.prototype),"afterCreateRenderObject",this).call(this),this.mRenderObject&&(this.mRenderObject.metadata||(this.mRenderObject.metadata={}),this.mRenderObject.metadata.scene_entity_id=this.mSceneEntity.id,this.mShowNormals&&this.mRenderObject instanceof BABYLON.Mesh&&(this.mNormalHelper||(this.mNormalHelper=this.createNormalHelper(this.mRenderObject,.25,BABYLON.Color3.Red()))),this.makeInvisibleBeforeAttach())}},{key:"destroyRenderObject",value:function(){this.mRenderObject&&this.mRenderObject.dispose(),this.mNormalHelper&&(this.mNormalHelper.dispose(),delete this.mNormalHelper)}},{key:"createNormalHelper",value:function(e,t,n){var r=e.getVerticesData(BABYLON.VertexBuffer.NormalKind),i=e.getVerticesData(BABYLON.VertexBuffer.PositionKind);n=n||BABYLON.Color3.White();for(var a=[],o=0;o<r.length;o+=3){var s=BABYLON.Vector3.FromArray(i,o),u=s.add(BABYLON.Vector3.FromArray(r,o).scaleInPlace(t));a.push([s.add(e.position),u.add(e.position)])}var c=BABYLON.MeshBuilder.CreateLineSystem("normalLines",{lines:a},this.getRenderer().getScene());return c.color=n,c}},{key:"onMatrixUpdate",value:function(){this.mMatrixNeedsUpdate=!0}}]),n}(BM),NM=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,u.Z)(this,e),(0,l.Z)(this,"mManager",void 0),(0,l.Z)(this,"mHandle",void 0),(0,l.Z)(this,"mPromise",void 0),(0,l.Z)(this,"mRejectFunc",void 0),(0,l.Z)(this,"mResolveFunc",void 0),(0,l.Z)(this,"mUseResourceCount",void 0),(0,l.Z)(this,"mInProgress",!1),this.mHandle=t,this.mManager=tc.getManager(n),this.mUseResourceCount=r}var n;return(0,c.Z)(e,[{key:"getHandle",value:function(){return this.mHandle}},{key:"load",value:(n=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mPromise){e.next=2;break}return e.abrupt("return",this.mPromise);case 2:return this.mInProgress=!0,this.mPromise=new Promise((function(e,r){n.mResolveFunc=e,n.mRejectFunc=r,n.mManager.resolveResource(n.mHandle,(function(e){n.mInProgress&&(n.mInProgress=!1,n.mResolveFunc(e))}),t,n.mUseResourceCount).catch((function(e){n.mRejectFunc(e)}))})),e.abrupt("return",this.mPromise);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"dispose",value:function(){this.cancel(),this.disposeResource(),this.disposePromise()}},{key:"cancel",value:function(){this.mInProgress&&(this.mInProgress=!1,this.mRejectFunc("cancelled"))}},{key:"disposeResource",value:function(){if(this.mUseResourceCount){var e=this.mManager.findResourceWithHandle(this.mHandle);e&&!e.isLockedForDisposal()&&this.mManager.disposeResource(this.mHandle)}}},{key:"disposePromise",value:function(){this.mPromise&&(delete this.mRejectFunc,delete this.mResolveFunc,delete this.mPromise)}}]),e}();function jM(e){switch(e){case BABYLON.Constants.TEXTURETYPE_BYTE:return _s.Byte;case BABYLON.Constants.TEXTURETYPE_SHORT:return _s.Short;case BABYLON.Constants.TEXTURETYPE_UNSIGNED_SHORT:return _s.UnsignedShort;case BABYLON.Constants.TEXTURETYPE_INT:return _s.Int;case BABYLON.Constants.TEXTURETYPE_UNSIGNED_INTEGER:return _s.UnsignedInt;case BABYLON.Constants.TEXTURETYPE_FLOAT:return _s.Float;case BABYLON.Constants.TEXTURETYPE_HALF_FLOAT:return _s.HalfFloat;case BABYLON.Constants.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4:return _s.UnsignedShort4444;case BABYLON.Constants.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1:return _s.UnsignedShort5551;case BABYLON.Constants.TEXTURETYPE_UNSIGNED_SHORT_5_6_5:return _s.UnsignedShort565;case BABYLON.Constants.TEXTURETYPE_UNSIGNED_INT_24_8:return _s.UnsignedInt248;case BABYLON.Constants.TEXTURETYPE_UNSIGNED_BYTE:case BABYLON.Constants.TEXTURETYPE_UNSIGNED_INT:default:return _s.UnsignedByte}}function zM(e){switch(e){case xs.Alpha:return BABYLON.Constants.TEXTUREFORMAT_ALPHA;case xs.Red:return BABYLON.Constants.TEXTUREFORMAT_RED;case xs.RedInt:return BABYLON.Constants.TEXTUREFORMAT_RED_INTEGER;case xs.RG:return BABYLON.Constants.TEXTUREFORMAT_RG;case xs.RGInt:return BABYLON.Constants.TEXTUREFORMAT_RG_INTEGER;case xs.RGB:return BABYLON.Constants.TEXTUREFORMAT_RGB;case xs.RGBInt:return BABYLON.Constants.TEXTUREFORMAT_RGB_INTEGER;case xs.RGBAInt:return BABYLON.Constants.TEXTUREFORMAT_RGBA_INTEGER;case xs.Luminance:return BABYLON.Constants.TEXTUREFORMAT_LUMINANCE;case xs.LuminanceAlpha:return BABYLON.Constants.TEXTUREFORMAT_LUMINANCE_ALPHA;case xs.Depth:return BABYLON.Constants.TEXTUREFORMAT_DEPTH32_FLOAT;case xs.DepthStencil:return BABYLON.Constants.TEXTUREFORMAT_DEPTH24_STENCIL8;case xs.RGBA:default:return BABYLON.Constants.TEXTUREFORMAT_RGBA}}function UM(e){switch(e){case BABYLON.Constants.TEXTUREFORMAT_ALPHA:return xs.Alpha;case BABYLON.Constants.TEXTUREFORMAT_R:case BABYLON.Constants.TEXTUREFORMAT_RED:return xs.Red;case BABYLON.Constants.TEXTUREFORMAT_R_INTEGER:case BABYLON.Constants.TEXTUREFORMAT_RED_INTEGER:return xs.RedInt;case BABYLON.Constants.TEXTUREFORMAT_RG:return xs.RG;case BABYLON.Constants.TEXTUREFORMAT_RG_INTEGER:return xs.RGInt;case BABYLON.Constants.TEXTUREFORMAT_RGB:return xs.RGB;case BABYLON.Constants.TEXTUREFORMAT_RGB_INTEGER:return xs.RGBInt;case BABYLON.Constants.TEXTUREFORMAT_RGBA_INTEGER:return xs.RGBAInt;case BABYLON.Constants.TEXTUREFORMAT_LUMINANCE:return xs.Luminance;case BABYLON.Constants.TEXTUREFORMAT_LUMINANCE_ALPHA:return xs.LuminanceAlpha;case BABYLON.Constants.TEXTUREFORMAT_DEPTH32_FLOAT:return xs.Depth;case BABYLON.Constants.TEXTUREFORMAT_DEPTH24_STENCIL8:return xs.DepthStencil;case BABYLON.Constants.TEXTUREFORMAT_RGBA:default:return xs.RGBA}}function VM(e,t){switch(e){case ws.Cube:return BABYLON.Constants.TEXTURE_CUBIC_MODE;case ws.Equirectangular:return BABYLON.Constants.TEXTURE_EQUIRECTANGULAR_MODE;case ws.Spherical:return BABYLON.Constants.TEXTURE_SPHERICAL_MODE;case ws.UV:default:return BABYLON.Constants.TEXTURE_EXPLICIT_MODE}}function HM(e){switch(e){case BABYLON.Constants.TEXTURE_CUBIC_MODE:return ws.Cube;case BABYLON.Constants.TEXTURE_EQUIRECTANGULAR_MODE:return ws.Equirectangular;case BABYLON.Constants.TEXTURE_SPHERICAL_MODE:return ws.Spherical;case BABYLON.Constants.TEXTURE_EXPLICIT_MODE:default:return ws.UV}}function GM(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return e===Zs.Nearest?t===Zs.Nearest?r&&n===Zs.Nearest?BABYLON.Texture.NEAREST_NEAREST_MIPNEAREST:r&&n===Zs.Linear?BABYLON.Texture.NEAREST_NEAREST_MIPLINEAR:BABYLON.Texture.NEAREST_NEAREST:r&&n===Zs.Nearest?BABYLON.Texture.NEAREST_LINEAR_MIPNEAREST:r&&n===Zs.Linear?BABYLON.Texture.NEAREST_LINEAR_MIPLINEAR:BABYLON.Texture.NEAREST_LINEAR:t===Zs.Nearest?r&&n===Zs.Nearest?BABYLON.Texture.LINEAR_NEAREST_MIPNEAREST:r&&n===Zs.Linear?BABYLON.Texture.LINEAR_NEAREST_MIPLINEAR:BABYLON.Texture.LINEAR_NEAREST:r&&n===Zs.Nearest?BABYLON.Texture.LINEAR_LINEAR_MIPNEAREST:r&&n===Zs.Linear?BABYLON.Texture.LINEAR_LINEAR_MIPLINEAR:BABYLON.Texture.LINEAR_LINEAR}function qM(e){switch(e){case Ss.Repeat:return BABYLON.Texture.WRAP_ADDRESSMODE;case Ss.MirrorRepeat:return BABYLON.Texture.MIRROR_ADDRESSMODE;case Ss.ClampToEdge:default:return BABYLON.Texture.CLAMP_ADDRESSMODE}}function WM(e){switch(e){case BABYLON.Texture.WRAP_ADDRESSMODE:return Ss.Repeat;case BABYLON.Texture.MIRROR_ADDRESSMODE:return Ss.MirrorRepeat;case BABYLON.Texture.CLAMP_ADDRESSMODE:default:return Ss.ClampToEdge}}function YM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var KM=function(e){(0,g.Z)(n,e);var t=YM(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"texture2d",a=arguments.length>2?arguments[2]:void 0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ws.UV,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Ss.ClampToEdge,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ss.ClampToEdge,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Zs.Linear,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Zs.Linear,m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Zs.Linear,d=arguments.length>10&&void 0!==arguments[10]&&arguments[10],v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:xs.RGBA,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:_s.UnsignedByte,g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:1,b=arguments.length>14&&void 0!==arguments[14]?arguments[14]:Ts.Linear;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mInternalTexture",void 0),(0,l.Z)((0,_.Z)(r),"mOffset",D.Zero()),(0,l.Z)((0,_.Z)(r),"mRepeat",D.One()),(0,l.Z)((0,_.Z)(r),"mCenter",D.Zero()),(0,l.Z)((0,_.Z)(r),"mRotation",0),(0,l.Z)((0,_.Z)(r),"mRenderMode",Rs.Reflect),(0,l.Z)((0,_.Z)(r),"mMagFilter",Zs.Linear),(0,l.Z)((0,_.Z)(r),"mMinFilter",Zs.Linear),(0,l.Z)((0,_.Z)(r),"mMipmapFilter",Zs.Linear),(0,l.Z)((0,_.Z)(r),"mTextureEncoding",Ts.Linear),(0,l.Z)((0,_.Z)(r),"mGenerateMipmap",!1),(0,l.Z)((0,_.Z)(r),"mDirty",!1),(0,l.Z)((0,_.Z)(r),"mMatrix",new kc),r.mInternalTexture=new BABYLON.Texture(null,e,!d,o,GM(f,p,m,d),null,null,a,!1,zM(v),void 0,void 0),r.mInternalTexture.name=i,r.mMagFilter=f,r.mMinFilter=p,r.mMipmapFilter=m,r.mGenerateMipmap=d,r.mInternalTexture.hasAlpha=v===xs.Alpha||v===xs.RGBA||v===xs.LuminanceAlpha,r.setTextureMapping(s),r.setWrapU(c),r.setWrapV(h),r.setTextureDataType(y),r.setAnistropicFilteringLevel(g),r.setTextureEncoding(b),r.setCenter(D.Zero()),r.setRepeat(D.One()),r}return(0,c.Z)(n,[{key:"getOffset",value:function(){return this.mOffset}},{key:"setOffset",value:function(e){this.mOffset.copy(e),this.updateMatrix()}},{key:"getRepeat",value:function(){return this.mRepeat}},{key:"setRepeat",value:function(e){this.mRepeat.copy(e),this.updateMatrix()}},{key:"getCenter",value:function(){return this.mCenter}},{key:"setCenter",value:function(e){this.mCenter.copy(e),this.updateMatrix()}},{key:"getRotation",value:function(){return this.mRotation}},{key:"setRotation",value:function(e){this.mRotation=e,this.updateMatrix()}},{key:"getFlipY",value:function(){return this.mInternalTexture.invertY}},{key:"setFlipY",value:function(e){}},{key:"updateSource",value:function(e){this.mInternalTexture.updateURL(null,e)}},{key:"updateMatrix",value:function(){var e=[];this.mMatrix.setUvTransform(this.mOffset.x,this.mOffset.y,this.mRepeat.x,this.mRepeat.y,this.mRotation,this.mCenter.x,this.mCenter.y).toArray(e);var t=BABYLON.Matrix.Identity();t.setRowFromFloats(0,e[0],e[1],e[2],0),t.setRowFromFloats(1,e[3],e[4],e[5],0),t.setRowFromFloats(2,e[6],e[7],e[8],0),t.setRowFromFloats(3,0,0,0,1),this.mInternalTexture.getTextureMatrix().copyFrom(t)}},{key:"getName",value:function(){return this.mInternalTexture.name}},{key:"setName",value:function(e){this.mInternalTexture.name=e}},{key:"getGenerateMipmap",value:function(){return this.mGenerateMipmap}},{key:"getAnistropicFilteringLevel",value:function(){return this.mInternalTexture.anisotropicFilteringLevel}},{key:"setAnistropicFilteringLevel",value:function(e){this.mInternalTexture.anisotropicFilteringLevel=e}},{key:"getTextureDataType",value:function(){return jM(this.mInternalTexture.textureType)}},{key:"setTextureDataType",value:function(e){}},{key:"getTextureFormat",value:function(){return UM(this.mInternalTexture.textureFormat)}},{key:"setTextureFormat",value:function(e){this.mInternalTexture.hasAlpha=e===xs.Alpha||e===xs.RGBA||e===xs.LuminanceAlpha}},{key:"getTextureEncoding",value:function(){return this.mTextureEncoding}},{key:"setTextureEncoding",value:function(e){this.mInternalTexture.isRGBD=e===Ts.RGBD,this.mInternalTexture.gammaSpace=e===Ts.Gamma}},{key:"getTextureMapping",value:function(){return HM(this.mInternalTexture.coordinatesMode)}},{key:"setTextureMapping",value:function(e){this.mInternalTexture.coordinatesMode=VM(e,this.mRenderMode)}},{key:"getTextureRenderMode",value:function(){return this.mRenderMode}},{key:"setTextureRenderMode",value:function(e){this.mRenderMode=e,this.setTextureMapping(this.getTextureMapping())}},{key:"getMagFilter",value:function(){return this.mMagFilter}},{key:"setMagFilter",value:function(e){this.mMagFilter=e,this.updateTextureFilter()}},{key:"getMinFilter",value:function(){return this.mMinFilter}},{key:"setMinFilter",value:function(e){this.mMinFilter=e,this.updateTextureFilter()}},{key:"getMipmapFilter",value:function(){return this.mMipmapFilter}},{key:"setMipmapFilter",value:function(e){this.mMipmapFilter=e,this.updateTextureFilter()}},{key:"getWrapU",value:function(){return WM(this.mInternalTexture.wrapU)}},{key:"setWrapU",value:function(e){this.mInternalTexture.wrapU=qM(e)}},{key:"getWrapV",value:function(){return WM(this.mInternalTexture.wrapV)}},{key:"setWrapV",value:function(e){this.mInternalTexture.wrapV=qM(e)}},{key:"getLevel",value:function(){return this.mInternalTexture.level}},{key:"setLevel",value:function(e){this.mInternalTexture.level=e}},{key:"getUVChannel",value:function(){return this.mInternalTexture.coordinatesIndex}},{key:"setUVChannel",value:function(e){this.mInternalTexture.coordinatesIndex=e}},{key:"isTexture2D",value:function(){return!0}},{key:"isTexture3D",value:function(){return!1}},{key:"isTextureCube",value:function(){return!1}},{key:"isTextureGrayscale",value:function(){var e=this.getTextureFormat();return e===xs.Red||e===xs.RedInt||e===xs.Depth||e===xs.DepthStencil}},{key:"hasTextureAlpha",value:function(){return this.mInternalTexture.hasAlpha}},{key:"useRGBasAlpha",value:function(e){this.mInternalTexture.getAlphaFromRGB=e}},{key:"getMatrix",value:function(){return this.mMatrix}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e}},{key:"dispose",value:function(){this.mInternalTexture.dispose()}},{key:"updateTextureFilter",value:function(){this.mInternalTexture.updateSamplingMode(GM(this.mMagFilter,this.mMinFilter,this.mMipmapFilter))}},{key:"getInternalTexture",value:function(){return this.mInternalTexture}}]),n}(Gs);function XM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var $M=function(e){(0,g.Z)(n,e);var t=XM(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(As);function QM(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var JM=function(e){(0,g.Z)(n,e);var t=QM(n);function n(e,r,i,a,o,s,c,h,f,p,m,d,v,y,g){var b;return(0,u.Z)(this,n),b=t.call(this),(0,l.Z)((0,_.Z)(b),"mInternalTexture",void 0),(0,l.Z)((0,_.Z)(b),"mOffset",D.Zero()),(0,l.Z)((0,_.Z)(b),"mRepeat",D.One()),(0,l.Z)((0,_.Z)(b),"mCenter",D.Zero()),(0,l.Z)((0,_.Z)(b),"mRotation",0),(0,l.Z)((0,_.Z)(b),"mRenderMode",Rs.Reflect),(0,l.Z)((0,_.Z)(b),"mMagFilter",Zs.Linear),(0,l.Z)((0,_.Z)(b),"mMinFilter",Zs.Linear),(0,l.Z)((0,_.Z)(b),"mMipmapFilter",Zs.Linear),(0,l.Z)((0,_.Z)(b),"mGenerateMipmap",!1),(0,l.Z)((0,_.Z)(b),"mTextureEncoding",Ts.Linear),(0,l.Z)((0,_.Z)(b),"mScale",1),(0,l.Z)((0,_.Z)(b),"mDirty",!1),(0,l.Z)((0,_.Z)(b),"mMatrix",new kc),b.mInternalTexture=new BABYLON.CubeTexture(null,e,void 0,!m,void 0,null,null,zM(d),!1,void 0,!1,void 0,void 0,void 0),b.mInternalTexture.name=r,b.mMagFilter=h,b.mMinFilter=f,b.mMipmapFilter=p,b.mGenerateMipmap=m,b.setTextureMapping(o),b.setWrapU(s),b.setWrapV(c),b.setTextureDataType(v),b.setAnistropicFilteringLevel(y),b.setTextureEncoding(g),b}return(0,c.Z)(n,[{key:"updateMatrix",value:function(){var e=[];this.mMatrix.setUvTransform(this.mOffset.x,this.mOffset.y,this.mRepeat.x,this.mRepeat.y,this.mRotation,this.mCenter.x,this.mCenter.y).toArray(e);var t=BABYLON.Matrix.Identity();t.setRowFromFloats(0,e[0],e[1],e[2],0),t.setRowFromFloats(1,e[3],e[4],e[5],0),t.setRowFromFloats(2,e[6],e[7],e[8],0),t.setRowFromFloats(3,0,0,0,1),this.mInternalTexture.getTextureMatrix().copyFrom(t)}},{key:"getName",value:function(){return this.mInternalTexture.name}},{key:"setName",value:function(e){this.mInternalTexture.name=e}},{key:"getRotation",value:function(){return this.mInternalTexture.rotationY}},{key:"setRotation",value:function(e){this.mInternalTexture.rotationY=e}},{key:"getGenerateMipmap",value:function(){return this.mGenerateMipmap}},{key:"getAnistropicFilteringLevel",value:function(){return this.mInternalTexture.anisotropicFilteringLevel}},{key:"setAnistropicFilteringLevel",value:function(e){this.mInternalTexture.anisotropicFilteringLevel=e}},{key:"getTextureDataType",value:function(){return jM(this.mInternalTexture.textureType)}},{key:"setTextureDataType",value:function(e){}},{key:"getTextureFormat",value:function(){return UM(this.mInternalTexture.textureFormat)}},{key:"setTextureFormat",value:function(e){this.mInternalTexture.hasAlpha=e===xs.Alpha||e===xs.RGBA||e===xs.LuminanceAlpha}},{key:"getTextureEncoding",value:function(){return this.mTextureEncoding}},{key:"setTextureEncoding",value:function(e){this.mInternalTexture.isRGBD=e===Ts.RGBD,this.mInternalTexture.gammaSpace=e===Ts.Gamma}},{key:"getTextureMapping",value:function(){return HM(this.mInternalTexture.coordinatesMode)}},{key:"setTextureMapping",value:function(e){this.mInternalTexture.coordinatesMode=VM(e,this.mRenderMode)}},{key:"getTextureRenderMode",value:function(){return this.mRenderMode}},{key:"setTextureRenderMode",value:function(e){this.mRenderMode=e,this.setTextureMapping(this.getTextureMapping())}},{key:"getMagFilter",value:function(){return this.mMagFilter}},{key:"setMagFilter",value:function(e){this.mMagFilter=e,this.updateTextureFilter()}},{key:"getMinFilter",value:function(){return this.mMinFilter}},{key:"setMinFilter",value:function(e){this.mMinFilter=e,this.updateTextureFilter()}},{key:"getMipmapFilter",value:function(){return this.mMipmapFilter}},{key:"setMipmapFilter",value:function(e){this.mMipmapFilter=e,this.updateTextureFilter()}},{key:"getWrapU",value:function(){return WM(this.mInternalTexture.wrapU)}},{key:"setWrapU",value:function(e){this.mInternalTexture.wrapU=qM(e)}},{key:"getWrapV",value:function(){return WM(this.mInternalTexture.wrapV)}},{key:"setWrapV",value:function(e){this.mInternalTexture.wrapV=qM(e)}},{key:"getLevel",value:function(){return this.mInternalTexture.level}},{key:"setLevel",value:function(e){this.mInternalTexture.level=e}},{key:"getUVChannel",value:function(){return this.mInternalTexture.coordinatesIndex}},{key:"setUVChannel",value:function(e){this.mInternalTexture.coordinatesIndex=e}},{key:"isTexture2D",value:function(){return!1}},{key:"isTexture3D",value:function(){return!1}},{key:"isTextureCube",value:function(){return!0}},{key:"isTextureGrayscale",value:function(){var e=this.getTextureFormat();return e===xs.Red||e===xs.RedInt||e===xs.Depth||e===xs.DepthStencil}},{key:"hasTextureAlpha",value:function(){return this.mInternalTexture.hasAlpha}},{key:"useRGBasAlpha",value:function(e){this.mInternalTexture.getAlphaFromRGB=e}},{key:"getMatrix",value:function(){return this.mMatrix}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e}},{key:"dispose",value:function(){this.mInternalTexture.dispose()}},{key:"updateTextureFilter",value:function(){this.mInternalTexture.updateSamplingMode(GM(this.mMagFilter,this.mMinFilter,this.mMipmapFilter))}},{key:"getInternalTexture",value:function(){return this.mInternalTexture}}]),n}($M);function ek(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var tk=function(e){(0,g.Z)(n,e);var t=ek(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(Gs);function nk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var rk=function(e){(0,g.Z)(n,e);var t=nk(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"texturecanvas",a=arguments.length>2?arguments[2]:void 0,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ws.UV,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Ss.ClampToEdge,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ss.ClampToEdge,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Zs.Linear,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Zs.Linear,m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:Zs.Linear,d=arguments.length>10&&void 0!==arguments[10]&&arguments[10],v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:xs.RGBA,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:_s.UnsignedByte,g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:1,b=arguments.length>14&&void 0!==arguments[14]?arguments[14]:Ts.Linear;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mInternalTexture",void 0),(0,l.Z)((0,_.Z)(r),"mOffset",D.Zero()),(0,l.Z)((0,_.Z)(r),"mRepeat",D.One()),(0,l.Z)((0,_.Z)(r),"mCenter",D.Zero()),(0,l.Z)((0,_.Z)(r),"mRotation",0),(0,l.Z)((0,_.Z)(r),"mRenderMode",Rs.Reflect),(0,l.Z)((0,_.Z)(r),"mMagFilter",Zs.Linear),(0,l.Z)((0,_.Z)(r),"mMinFilter",Zs.Linear),(0,l.Z)((0,_.Z)(r),"mMipmapFilter",Zs.Linear),(0,l.Z)((0,_.Z)(r),"mGenerateMipmap",!1),(0,l.Z)((0,_.Z)(r),"mTextureEncoding",Ts.Linear),(0,l.Z)((0,_.Z)(r),"mDirty",!1),(0,l.Z)((0,_.Z)(r),"mCanvas",void 0),(0,l.Z)((0,_.Z)(r),"mMatrix",new kc),r.mInternalTexture=new BABYLON.DynamicTexture(i,a,e,d,GM(f,p,m,d),zM(v),o),r.mCanvas=a,r.mMagFilter=f,r.mMinFilter=p,r.mMipmapFilter=m,r.mGenerateMipmap=d,r.setTextureMapping(s),r.setWrapU(c),r.setWrapV(h),r.setTextureDataType(y),r.setAnistropicFilteringLevel(g),r.setTextureEncoding(b),r.mInternalTexture.hasAlpha=!0,r.setCenter(D.Zero()),r.setRepeat(D.One()),r}return(0,c.Z)(n,[{key:"getOffset",value:function(){return this.mOffset}},{key:"setOffset",value:function(e){this.mOffset.copy(e),this.updateMatrix()}},{key:"getRepeat",value:function(){return this.mRepeat}},{key:"setRepeat",value:function(e){this.mRepeat.copy(e),this.updateMatrix()}},{key:"getCenter",value:function(){return this.mCenter}},{key:"setCenter",value:function(e){this.mCenter.copy(e),this.updateMatrix()}},{key:"getRotation",value:function(){return this.mRotation}},{key:"setRotation",value:function(e){this.mRotation=e,this.updateMatrix()}},{key:"getFlipY",value:function(){return this.mInternalTexture.invertY}},{key:"setFlipY",value:function(e){}},{key:"updateSource",value:function(e){this.mInternalTexture.updateURL(null,e)}},{key:"getContext",value:function(){return this.mInternalTexture.getContext()}},{key:"getCanvas",value:function(){return this.mCanvas}},{key:"dispose",value:function(){this.mInternalTexture.dispose(),this.mCanvas&&this.mCanvas.remove()}},{key:"updateMatrix",value:function(){var e=[];(new kc).setUvTransform(this.mOffset.x,this.mOffset.y,this.mRepeat.x,this.mRepeat.y,this.mRotation,this.mCenter.x,this.mCenter.y).toArray(e);var t=BABYLON.Matrix.Identity();t.setRowFromFloats(0,e[0],e[1],e[2],0),t.setRowFromFloats(1,e[3],e[4],e[5],0),t.setRowFromFloats(2,e[6],e[7],e[8],0),t.setRowFromFloats(3,0,0,0,1),this.mInternalTexture.getTextureMatrix().copyFrom(t)}},{key:"getName",value:function(){return this.mInternalTexture.name}},{key:"setName",value:function(e){this.mInternalTexture.name=e}},{key:"getGenerateMipmap",value:function(){return this.mGenerateMipmap}},{key:"getAnistropicFilteringLevel",value:function(){return this.mInternalTexture.anisotropicFilteringLevel}},{key:"setAnistropicFilteringLevel",value:function(e){this.mInternalTexture.anisotropicFilteringLevel=e}},{key:"getTextureDataType",value:function(){return jM(this.mInternalTexture.textureType)}},{key:"setTextureDataType",value:function(e){}},{key:"getTextureFormat",value:function(){return UM(this.mInternalTexture.textureFormat)}},{key:"setTextureFormat",value:function(e){this.mInternalTexture.hasAlpha=e===xs.Alpha||e===xs.RGBA||e===xs.LuminanceAlpha}},{key:"getTextureEncoding",value:function(){return this.mTextureEncoding}},{key:"setTextureEncoding",value:function(e){this.mInternalTexture.isRGBD=e===Ts.RGBD,this.mInternalTexture.gammaSpace=e===Ts.Gamma}},{key:"getTextureMapping",value:function(){return HM(this.mInternalTexture.coordinatesMode)}},{key:"setTextureMapping",value:function(e){this.mInternalTexture.coordinatesMode=VM(e,this.mRenderMode)}},{key:"getTextureRenderMode",value:function(){return this.mRenderMode}},{key:"setTextureRenderMode",value:function(e){this.mRenderMode=e,this.setTextureMapping(this.getTextureMapping())}},{key:"getMagFilter",value:function(){return this.mMagFilter}},{key:"setMagFilter",value:function(e){this.mMagFilter=e,this.updateTextureFilter()}},{key:"getMinFilter",value:function(){return this.mMinFilter}},{key:"setMinFilter",value:function(e){this.mMinFilter=e,this.updateTextureFilter()}},{key:"getMipmapFilter",value:function(){return this.mMipmapFilter}},{key:"setMipmapFilter",value:function(e){this.mMipmapFilter=e,this.updateTextureFilter()}},{key:"getWrapU",value:function(){return WM(this.mInternalTexture.wrapU)}},{key:"setWrapU",value:function(e){this.mInternalTexture.wrapU=qM(e)}},{key:"getWrapV",value:function(){return WM(this.mInternalTexture.wrapV)}},{key:"setWrapV",value:function(e){this.mInternalTexture.wrapV=qM(e)}},{key:"getLevel",value:function(){return this.mInternalTexture.level}},{key:"setLevel",value:function(e){this.mInternalTexture.level=e}},{key:"getUVChannel",value:function(){return this.mInternalTexture.coordinatesIndex}},{key:"setUVChannel",value:function(e){this.mInternalTexture.coordinatesIndex=e}},{key:"isTexture2D",value:function(){return!0}},{key:"isTexture3D",value:function(){return!1}},{key:"isTextureCube",value:function(){return!1}},{key:"isTextureGrayscale",value:function(){var e=this.getTextureFormat();return e===xs.Red||e===xs.RedInt||e===xs.Depth||e===xs.DepthStencil}},{key:"hasTextureAlpha",value:function(){return this.mInternalTexture.hasAlpha}},{key:"useRGBasAlpha",value:function(e){this.mInternalTexture.getAlphaFromRGB=e}},{key:"getMatrix",value:function(){return this.mMatrix}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,this.mInternalTexture.update(this.mInternalTexture.invertY)}},{key:"updateTextureFilter",value:function(){this.mInternalTexture.updateSamplingMode(GM(this.mMagFilter,this.mMinFilter,this.mMipmapFilter,this.mGenerateMipmap))}},{key:"getInternalTexture",value:function(){return this.mInternalTexture}}]),n}(tk);function ik(e,t){return e?t?Es.Front:Es.Back:Es.Double}function ak(e){switch(e){case Es.Front:return{cullingEnabled:!0,cullBackFace:!0};case Es.Back:return{cullingEnabled:!0,cullBackFace:!1};case Es.Double:default:return{cullingEnabled:!1,cullBackFace:!0}}}function ok(e){switch(e){case BABYLON.PBRMaterial.PBRMATERIAL_ALPHATEST:case BABYLON.PBRMaterial.PBRMATERIAL_ALPHABLEND:case BABYLON.PBRMaterial.PBRMATERIAL_ALPHATESTANDBLEND:return!0;case BABYLON.PBRMaterial.PBRMATERIAL_OPAQUE:default:return!1}}function sk(e,t){return e?t?BABYLON.PBRMaterial.PBRMATERIAL_ALPHATESTANDBLEND:BABYLON.PBRMaterial.PBRMATERIAL_ALPHATEST:t?BABYLON.PBRMaterial.PBRMATERIAL_ALPHABLEND:BABYLON.PBRMaterial.PBRMATERIAL_OPAQUE}function uk(e){switch(e){case BABYLON.Constants.ALPHA_DISABLE:return{alphaMode:Qo.Disable,preMultipliedAlpha:!1};case BABYLON.Constants.ALPHA_ADD:return{alphaMode:Qo.Add,preMultipliedAlpha:!1};case BABYLON.Constants.ALPHA_SUBTRACT:return{alphaMode:Qo.Subtract,preMultipliedAlpha:!1};case BABYLON.Constants.ALPHA_MULTIPLY:return{alphaMode:Qo.Multiply,preMultipliedAlpha:!1};case BABYLON.Constants.ALPHA_MAXIMIZED:return{alphaMode:Qo.Maximized,preMultipliedAlpha:!1};case BABYLON.Constants.ALPHA_ONEONE:return{alphaMode:Qo.OneOne,preMultipliedAlpha:!1};case BABYLON.Constants.ALPHA_PREMULTIPLIED:case BABYLON.Constants.ALPHA_PREMULTIPLIED_PORTERDUFF:return{alphaMode:Qo.Combine,preMultipliedAlpha:!0};case BABYLON.Constants.ALPHA_INTERPOLATE:return{alphaMode:Qo.Interpolate,preMultipliedAlpha:!1};case BABYLON.Constants.ALPHA_SCREENMODE:return{alphaMode:Qo.ScreenMode,preMultipliedAlpha:!1};case BABYLON.Constants.ALPHA_COMBINE:default:return{alphaMode:Qo.Combine,preMultipliedAlpha:!1}}}function ck(e,t){if(t)return BABYLON.Constants.ALPHA_PREMULTIPLIED;switch(e){case Qo.Disable:return BABYLON.Constants.ALPHA_DISABLE;case Qo.Add:return BABYLON.Constants.ALPHA_ADD;case Qo.Subtract:return BABYLON.Constants.ALPHA_SUBTRACT;case Qo.Multiply:return BABYLON.Constants.ALPHA_MULTIPLY;case Qo.Maximized:return BABYLON.Constants.ALPHA_MAXIMIZED;case Qo.OneOne:return BABYLON.Constants.ALPHA_ONEONE;case Qo.Interpolate:return BABYLON.Constants.ALPHA_INTERPOLATE;case Qo.ScreenMode:return BABYLON.Constants.ALPHA_SCREENMODE;case Qo.Combine:default:return BABYLON.Constants.ALPHA_COMBINE}}function lk(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e?e instanceof KM||e instanceof rk?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?t?BABYLON.Constants.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE:BABYLON.Constants.TEXTURE_EQUIRECTANGULAR_MODE:BABYLON.Constants.TEXTURE_EXPLICIT_MODE:e instanceof JM?t?BABYLON.Constants.TEXTURE_INVCUBIC_MODE:BABYLON.Constants.TEXTURE_CUBIC_MODE:void 0:BABYLON.Constants.TEXTURE_EXPLICIT_MODE}function hk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var fk=function(e){(0,g.Z)(n,e);var t=hk(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(i),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(i),"mAmbientColor",so.Black()),(0,l.Z)((0,_.Z)(i),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(i),"mReflectionColor",so.White()),(0,l.Z)((0,_.Z)(i),"mSpecularColor",so.White()),(0,l.Z)((0,_.Z)(i),"mMetallicReflectanceColor",so.White()),(0,l.Z)((0,_.Z)(i),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(i),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(i),"mNormalMap",void 0),(0,l.Z)((0,_.Z)(i),"mAoMap",void 0),(0,l.Z)((0,_.Z)(i),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(i),"mEmissiveMap",void 0),(0,l.Z)((0,_.Z)(i),"mEnvBrdfMap",void 0),(0,l.Z)((0,_.Z)(i),"mLightMap",void 0),(0,l.Z)((0,_.Z)(i),"mReflectivityMap",void 0),(0,l.Z)((0,_.Z)(i),"mReflectionMap",void 0),(0,l.Z)((0,_.Z)(i),"mReflectanceTexture",void 0),(0,l.Z)((0,_.Z)(i),"mGlossRoughMap",void 0),(0,l.Z)((0,_.Z)(i),"mMetalnessMap",void 0),(0,l.Z)((0,_.Z)(i),"mMetallicReflectanceMap",void 0),(0,l.Z)((0,_.Z)(i),"mBrdfConfiguration",void 0),(0,l.Z)((0,_.Z)(i),"mDetailMapConfiguration",void 0),(0,l.Z)((0,_.Z)(i),"mClearCoatConfiguration",void 0),(0,l.Z)((0,_.Z)(i),"mSheenConfiguration",void 0),(0,l.Z)((0,_.Z)(i),"mAnisotropicConfiguration",void 0),(0,l.Z)((0,_.Z)(i),"mSubSurfaceConfiguration",void 0),(0,l.Z)((0,_.Z)(i),"mIridescenceConfiguration",void 0),(0,l.Z)((0,_.Z)(i),"mNormalScale",D.One()),(0,l.Z)((0,_.Z)(i),"mEnvMapScale",D.One()),(0,l.Z)((0,_.Z)(i),"mLightMapIntensity",1),(0,l.Z)((0,_.Z)(i),"mUseSpecularGlossinessFlow",!1),(0,l.Z)((0,_.Z)(i),"mUseTransmission",!1),(0,l.Z)((0,_.Z)(i),"mMetalness",0),(0,l.Z)((0,_.Z)(i),"mRoughness",0),(0,l.Z)((0,_.Z)(i),"mDirty",!1),(0,l.Z)((0,_.Z)(i),"mAlphaTestEnabled",!1),(0,l.Z)((0,_.Z)(i),"mTransparent",!1),(0,l.Z)((0,_.Z)(i),"mFlatShading",!1),(0,l.Z)((0,_.Z)(i),"mPremultipliedAlpha",!1),(0,l.Z)((0,_.Z)(i),"mUseRealtimeTextureFiltering",!1),(0,l.Z)((0,_.Z)(i),"mRealtimeTextureFilteringQuality",is.Low),i.mInternalMaterial=new BABYLON.PBRMaterial(e,r),i.mInternalMaterial.metadata={},i.setSide(Es.Front),i.mInternalMaterial.useAlphaFromAlbedoTexture=!0,i.mInternalMaterial.useLogarithmicDepth=!1,i.mInternalMaterial.maxSimultaneousLights=12,i.mInternalMaterial.usePhysicalLightFalloff=!1,i.mBrdfConfiguration={useEnergyConservation:!0,useSpecularGlossinessInputEnergyConservation:!0},i.mDetailMapConfiguration={isEnabled:!1,map:null,diffuseBlendLevel:1,roughnessBlendLevel:1,bumpLevel:1,normalBlendMethod:BABYLON.Material.MATERIAL_NORMALBLENDMETHOD_WHITEOUT},i.mClearCoatConfiguration={isEnabled:!1,intensity:1,roughness:0,indexOfRefraction:1.5,map:null,useRoughnessFromMainMap:!0,roughnessMap:null,remapF0OnInterfaceChange:!0,bumpMap:null,isTintEnabled:!1,tintColor:so.White(),tintColorAtDistance:1,tintThickness:1,tintMap:null},i.mSheenConfiguration={isEnabled:!1,linkSheenWithDiffuse:!1,intensity:1,color:so.White(),map:null,useRoughnessFromMainMap:!0,roughness:null,roughnessMap:null,diffuseScaling:!1},i.mAnisotropicConfiguration={isEnabled:!1,intensity:1,direction:new D(1,0),map:null},i.mSubSurfaceConfiguration={isRefractionEnabled:!1,isTranslucencyEnabled:!1,isScatteringEnabled:!1,scatteringDiffusionProfile:null,refractionIntensity:1,translucencyIntensity:1,useDiffuseToTintRefraction:!1,useDiffuseToTintTranslucency:!1,thicknessMap:null,indexOfRefraction:1.5,linkRefractionWithTransparency:!1,volumeIndexOfRefraction:-1,minimumThickness:0,maximumThickness:1,useThicknessAsDepth:!1,tintColor:so.White(),tintColorAtDistance:1,diffusionDistance:so.White(),useMaskFromThicknessMap:!1,translucencyIntensityMap:null},i.mIridescenceConfiguration={isEnabled:!1,intensity:1,minimumThickness:100,maximumThickness:400,indexOfRefraction:1.3,map:null,thicknessMap:null},i}return(0,c.Z)(n,[{key:"getClassName",value:function(){var e;return(null===(e=this.mInternalMaterial)||void 0===e?void 0:e.getClassName())||""}},{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.albedoColor.set(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.albedoTexture=e?e.getInternalTexture():null}},{key:"isUsingAlphaFromDiffuseMap",value:function(){return this.mInternalMaterial.useAlphaFromAlbedoTexture}},{key:"useAlphaFromDiffuseMap",value:function(e){this.mInternalMaterial.useAlphaFromAlbedoTexture=e}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.opacityTexture=e?e.getInternalTexture():null}},{key:"getNormalMap",value:function(){return this.mNormalMap}},{key:"setNormalMap",value:function(e){this.mNormalMap=e,this.mInternalMaterial.bumpTexture=e?e.getInternalTexture():null,this.mInternalMaterial.bumpTexture&&this.setNormalScale(this.mNormalScale)}},{key:"getNormalScale",value:function(){return this.mNormalScale}},{key:"setNormalScale",value:function(e){this.mNormalScale.copy(e),this.mInternalMaterial.bumpTexture&&this.mInternalMaterial.bumpTexture.scale(this.mNormalScale.x)}},{key:"getAmbientColor",value:function(){return this.mAmbientColor}},{key:"setAmbientColor",value:function(e){this.mAmbientColor.copy(e),this.mInternalMaterial.ambientColor.set(this.mAmbientColor.r,this.mAmbientColor.g,this.mAmbientColor.b)}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.ambientTexture=e?e.getInternalTexture():null}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.ambientTextureStrength}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.ambientTextureStrength=e}},{key:"getAoMapImpactOnAnalyticalLights",value:function(){return this.mInternalMaterial.ambientTextureImpactOnAnalyticalLights}},{key:"setAoMapImpactOnAnalyticalLights",value:function(e){this.mInternalMaterial.ambientTextureImpactOnAnalyticalLights=e}},{key:"getDirectLightIntensity",value:function(){return this.mInternalMaterial.directIntensity}},{key:"setDirectLightIntensity",value:function(e){this.mInternalMaterial.directIntensity=e}},{key:"getEmissiveColor",value:function(){return this.mEmissiveColor}},{key:"setEmissiveColor",value:function(e){this.mEmissiveColor.copy(e),this.mInternalMaterial.emissiveColor.set(this.mEmissiveColor.r,this.mEmissiveColor.g,this.mEmissiveColor.b)}},{key:"getEmissiveIntensity",value:function(){return this.mInternalMaterial.emissiveIntensity}},{key:"setEmissiveIntensity",value:function(e){this.mInternalMaterial.emissiveIntensity=e}},{key:"getEmissiveMap",value:function(){return this.mEmissiveMap}},{key:"setEmissiveMap",value:function(e){this.mEmissiveMap=e,this.mInternalMaterial.emissiveTexture=e?e.getInternalTexture():null}},{key:"getEnvironmentIntensity",value:function(){return this.mInternalMaterial.environmentIntensity}},{key:"setEnvironmentIntensity",value:function(e){this.mInternalMaterial.environmentIntensity=e}},{key:"getEnvironmentBrdfMap",value:function(){return this.mEnvBrdfMap}},{key:"setEnvironmentBrdfMap",value:function(e){this.mEnvBrdfMap=e,this.mInternalMaterial.environmentBRDFTexture=e?e.getInternalTexture():null}},{key:"getEnvironmentBrdfMapScale",value:function(){return this.mEnvMapScale}},{key:"setEnvironmentBdrfMapScale",value:function(e){this.mEnvMapScale.copy(e),this.mInternalMaterial.environmentBRDFTexture.scale(this.mEnvMapScale.x)}},{key:"getLightMap",value:function(){return this.mLightMap}},{key:"setLightMap",value:function(e){this.mLightMap=e,this.mInternalMaterial.lightmapTexture=e?e.getInternalTexture():null,this.mInternalMaterial.lightmapTexture&&(this.mInternalMaterial.lightmapTexture.level=this.mLightMapIntensity)}},{key:"getLightMapIntensity",value:function(){return this.mLightMapIntensity}},{key:"setLightMapIntensity",value:function(e){this.mLightMapIntensity=e,this.mInternalMaterial.lightmapTexture&&(this.mInternalMaterial.lightmapTexture.level=this.mLightMapIntensity)}},{key:"getParallaxScaleBias",value:function(){return this.mInternalMaterial.parallaxScaleBias}},{key:"setParallaxScaleBias",value:function(e){this.mInternalMaterial.parallaxScaleBias=e}},{key:"getReflectionColor",value:function(){return this.mReflectionColor}},{key:"setReflectionColor",value:function(e){this.mReflectionColor.copy(e),this.mInternalMaterial.reflectionColor.set(this.mReflectionColor.r,this.mReflectionColor.g,this.mReflectionColor.b)}},{key:"getReflectionMap",value:function(){return this.mReflectionMap}},{key:"setReflectionMap",value:function(e){this.mReflectionMap=e,this.mInternalMaterial.reflectionTexture=e?e.getInternalTexture():null}},{key:"getSpecularColor",value:function(){return this.mSpecularColor}},{key:"setSpecularColor",value:function(e){this.mSpecularColor.copy(e),this.mInternalMaterial.reflectivityColor.set(this.mSpecularColor.r,this.mSpecularColor.g,this.mSpecularColor.b)}},{key:"getSpecularMap",value:function(){return this.mReflectivityMap}},{key:"setSpecularMap",value:function(e){this.mReflectivityMap=e,this.mInternalMaterial.reflectivityTexture=e?e.getInternalTexture():null}},{key:"getSpecularIntensity",value:function(){return this.mInternalMaterial.specularIntensity}},{key:"setSpecularIntensity",value:function(e){this.mInternalMaterial.specularIntensity=e}},{key:"getTwoSidedLighting",value:function(){return this.mInternalMaterial.twoSidedLighting}},{key:"setTwoSidedLighting",value:function(e){this.mInternalMaterial.twoSidedLighting=e}},{key:"getUnlit",value:function(){return this.mInternalMaterial.unlit}},{key:"setUnlit",value:function(e){this.mInternalMaterial.unlit=e}},{key:"getReflectanceMap",value:function(){return this.mReflectanceTexture}},{key:"setReflectanceMap",value:function(e){this.mReflectanceTexture=e,this.mInternalMaterial.reflectanceTexture=e?e.getInternalTexture():null}},{key:"getMicroSurface",value:function(){return this.mInternalMaterial.microSurface}},{key:"setMicroSurface",value:function(e){this.mInternalMaterial.microSurface=e}},{key:"getMicroSurfaceMap",value:function(){return this.mGlossRoughMap}},{key:"setMicroSurfaceMap",value:function(e){this.mGlossRoughMap=e,this.mInternalMaterial.microSurfaceTexture=e?e.getInternalTexture():null}},{key:"getRoughness",value:function(){return this.mInternalMaterial.roughness}},{key:"setRoughness",value:function(e){this.mRoughness=e,this.mUseSpecularGlossinessFlow||(this.mInternalMaterial.roughness=e)}},{key:"getMetalness",value:function(){return this.mInternalMaterial.metallic}},{key:"setMetalness",value:function(e){this.mMetalness=e,this.mUseSpecularGlossinessFlow||(this.mInternalMaterial.metallic=e)}},{key:"getMetalnessF0Factor",value:function(){return this.mInternalMaterial.metallicF0Factor}},{key:"setMetalnessF0Factor",value:function(e){this.mInternalMaterial.metallicF0Factor=e}},{key:"getMetalnessMap",value:function(){return this.mMetalnessMap}},{key:"setMetalnessMap",value:function(e){this.mUseSpecularGlossinessFlow||(this.mMetalnessMap=e,this.mInternalMaterial.metallicTexture=e?e.getInternalTexture():null)}},{key:"getMetallicReflectanceColor",value:function(){return this.mMetallicReflectanceColor}},{key:"setMetallicReflectanceColor",value:function(e){this.mMetallicReflectanceColor.copy(e),this.mInternalMaterial.metallicReflectanceColor.set(this.mMetallicReflectanceColor.r,this.mMetallicReflectanceColor.g,this.mMetallicReflectanceColor.b)}},{key:"getMetallicReflectanceMap",value:function(){return this.mMetallicReflectanceMap}},{key:"setMetallicReflectanceMap",value:function(e){this.mMetallicReflectanceMap=e,this.mInternalMaterial.metallicReflectanceTexture=e?e.getInternalTexture():null}},{key:"isSpecularGlossinessWorkflowEnabled",value:function(){return this.mUseSpecularGlossinessFlow}},{key:"useSpecularGlossinessWorkflow",value:function(e){this.mUseSpecularGlossinessFlow=e,this.mUseSpecularGlossinessFlow?(this.mInternalMaterial.metallic=null,this.mInternalMaterial.roughness=null,this.mInternalMaterial.metallicTexture=null):(this.mInternalMaterial.metallic=this.mMetalness,this.mInternalMaterial.roughness=this.mRoughness,this.mInternalMaterial.metallicTexture=this.mMetalnessMap?this.mMetalnessMap.getInternalTexture():null)}},{key:"isUsingRealtimeTextureFiltering",value:function(){return this.mInternalMaterial.realTimeFiltering}},{key:"useRealtimeTextureFiltering",value:function(e){this.mInternalMaterial.realTimeFiltering=e}},{key:"getRealtimeTextureFilteringQuality",value:function(){return this.mRealtimeTextureFilteringQuality}},{key:"setRealtimeTextureFilteringQuality",value:function(e){switch(this.mRealtimeTextureFilteringQuality=e,this.mRealtimeTextureFilteringQuality){case is.Low:this.mInternalMaterial.realTimeFilteringQuality=BABYLON.Constants.TEXTURE_FILTERING_QUALITY_LOW;break;case is.Medium:this.mInternalMaterial.realTimeFilteringQuality=BABYLON.Constants.TEXTURE_FILTERING_QUALITY_MEDIUM;break;case is.High:this.mInternalMaterial.realTimeFilteringQuality=BABYLON.Constants.TEXTURE_FILTERING_QUALITY_HIGH}}},{key:"getBrdfConfiguration",value:function(){return this.mBrdfConfiguration}},{key:"setBrdfConfiguration",value:function(e){e&&(void 0!==e.useEnergyConservation&&(this.mBrdfConfiguration.useEnergyConservation=e.useEnergyConservation,this.mInternalMaterial.brdf.useEnergyConservation=e.useEnergyConservation),void 0!==e.useSpecularGlossinessInputEnergyConservation&&(this.mBrdfConfiguration.useSpecularGlossinessInputEnergyConservation=e.useSpecularGlossinessInputEnergyConservation,this.mInternalMaterial.brdf.useSpecularGlossinessInputEnergyConservation=e.useSpecularGlossinessInputEnergyConservation))}},{key:"getDetailMapConfiguration",value:function(){return this.mDetailMapConfiguration}},{key:"setDetailMapConfiguration",value:function(e){e&&(void 0!==e.isEnabled&&(this.mDetailMapConfiguration.isEnabled=e.isEnabled,this.mInternalMaterial.detailMap.isEnabled=e.isEnabled),void 0!==e.map&&(this.mDetailMapConfiguration.map=e.map,this.mInternalMaterial.detailMap.texture=e.map?e.map.getInternalTexture():null),void 0!==e.diffuseBlendLevel&&(this.mDetailMapConfiguration.diffuseBlendLevel=e.diffuseBlendLevel,this.mInternalMaterial.detailMap.diffuseBlendLevel=e.diffuseBlendLevel),void 0!==e.roughnessBlendLevel&&(this.mDetailMapConfiguration.roughnessBlendLevel=e.roughnessBlendLevel,this.mInternalMaterial.detailMap.roughnessBlendLevel=e.roughnessBlendLevel),void 0!==e.bumpLevel&&(this.mDetailMapConfiguration.bumpLevel=e.bumpLevel,this.mInternalMaterial.detailMap.bumpLevel=e.bumpLevel),void 0!==e.normalBlendMethod&&(this.mDetailMapConfiguration.normalBlendMethod=e.normalBlendMethod,this.mInternalMaterial.detailMap.normalBlendMethod=e.normalBlendMethod))}},{key:"getClearCoatConfiguration",value:function(){return this.mClearCoatConfiguration}},{key:"setClearCoatConfiguration",value:function(e){e&&(void 0!==e.isEnabled&&(this.mClearCoatConfiguration.isEnabled=e.isEnabled,this.mInternalMaterial.clearCoat.isEnabled=e.isEnabled),void 0!==e.intensity&&(this.mClearCoatConfiguration.intensity=e.intensity,this.mInternalMaterial.clearCoat.intensity=e.intensity),void 0!==e.roughness&&(this.mClearCoatConfiguration.roughness=e.roughness,this.mInternalMaterial.clearCoat.roughness=e.roughness),void 0!==e.indexOfRefraction&&(this.mClearCoatConfiguration.indexOfRefraction=e.indexOfRefraction,this.mInternalMaterial.clearCoat.indexOfRefraction=e.indexOfRefraction),void 0!==e.map&&(this.mClearCoatConfiguration.map=e.map,this.mInternalMaterial.clearCoat.texture=e.map?e.map.getInternalTexture():null),void 0!==e.useRoughnessFromMainMap&&(this.mClearCoatConfiguration.useRoughnessFromMainMap=e.useRoughnessFromMainMap,this.mInternalMaterial.clearCoat.useRoughnessFromMainTexture=e.useRoughnessFromMainMap),void 0!==e.roughnessMap&&(this.mClearCoatConfiguration.roughnessMap=e.roughnessMap,this.mInternalMaterial.clearCoat.textureRoughness=e.roughnessMap?e.roughnessMap.getInternalTexture():null),void 0!==e.remapF0OnInterfaceChange&&(this.mClearCoatConfiguration.remapF0OnInterfaceChange=e.remapF0OnInterfaceChange,this.mInternalMaterial.clearCoat.remapF0OnInterfaceChange=e.remapF0OnInterfaceChange),void 0!==e.bumpMap&&(this.mClearCoatConfiguration.bumpMap=e.bumpMap,this.mInternalMaterial.clearCoat.bumpTexture=e.bumpMap?e.bumpMap.getInternalTexture():null),void 0!==e.isTintEnabled&&(this.mClearCoatConfiguration.isTintEnabled=e.isTintEnabled,this.mInternalMaterial.clearCoat.isTintEnabled=e.isTintEnabled),void 0!==e.tintColor&&(this.mClearCoatConfiguration.tintColor.copy(e.tintColor),this.mInternalMaterial.clearCoat.tintColor.set(e.tintColor.r,e.tintColor.g,e.tintColor.b)),void 0!==e.tintColorAtDistance&&(this.mClearCoatConfiguration.tintColorAtDistance=e.tintColorAtDistance,this.mInternalMaterial.clearCoat.tintColorAtDistance=e.tintColorAtDistance),void 0!==e.tintThickness&&(this.mClearCoatConfiguration.tintThickness=e.tintThickness,this.mInternalMaterial.clearCoat.tintThickness=e.tintThickness),void 0!==e.tintMap&&(this.mClearCoatConfiguration.tintMap=e.tintMap,this.mInternalMaterial.clearCoat.tintTexture=e.tintMap?e.tintMap.getInternalTexture():null))}},{key:"getSheenConfiguration",value:function(){return this.mSheenConfiguration}},{key:"setSheenConfiguration",value:function(e){e&&(void 0!==e.isEnabled&&(this.mSheenConfiguration.isEnabled=e.isEnabled,this.mInternalMaterial.sheen.isEnabled=e.isEnabled),void 0!==e.linkSheenWithDiffuse&&(this.mSheenConfiguration.linkSheenWithDiffuse=e.linkSheenWithDiffuse,this.mInternalMaterial.sheen.linkSheenWithAlbedo=e.linkSheenWithDiffuse),void 0!==e.intensity&&(this.mSheenConfiguration.intensity=e.intensity,this.mInternalMaterial.sheen.intensity=e.intensity),void 0!==e.color&&(this.mSheenConfiguration.color.copy(e.color),this.mInternalMaterial.sheen.color.set(e.color.r,e.color.g,e.color.b)),void 0!==e.map&&(this.mSheenConfiguration.map=e.map,this.mInternalMaterial.sheen.texture=e.map?e.map.getInternalTexture():null),void 0!==e.useRoughnessFromMainMap&&(this.mSheenConfiguration.useRoughnessFromMainMap=e.useRoughnessFromMainMap,this.mInternalMaterial.sheen.useRoughnessFromMainTexture=e.useRoughnessFromMainMap),void 0!==e.roughness&&(this.mSheenConfiguration.roughness=e.roughness,this.mInternalMaterial.sheen.roughness=e.roughness),void 0!==e.roughnessMap&&(this.mSheenConfiguration.roughnessMap=e.roughnessMap,this.mInternalMaterial.sheen.textureRoughness=e.roughnessMap?e.roughnessMap.getInternalTexture():null),void 0!==e.diffuseScaling&&(this.mSheenConfiguration.diffuseScaling=e.diffuseScaling,this.mInternalMaterial.sheen.albedoScaling=e.diffuseScaling))}},{key:"getAnisotropicConfiguration",value:function(){return this.mAnisotropicConfiguration}},{key:"setAnisotropicConfiguration",value:function(e){e&&(void 0!==e.isEnabled&&(this.mAnisotropicConfiguration.isEnabled=e.isEnabled,this.mInternalMaterial.anisotropy.isEnabled=e.isEnabled),void 0!==e.intensity&&(this.mAnisotropicConfiguration.intensity=e.intensity,this.mInternalMaterial.anisotropy.intensity=e.intensity),void 0!==e.direction&&(this.mAnisotropicConfiguration.direction.copy(e.direction),this.mInternalMaterial.anisotropy.direction.set(e.direction.x,e.direction.y)),void 0!==e.map&&(this.mAnisotropicConfiguration.map=e.map,this.mInternalMaterial.anisotropy.texture=e.map?e.map.getInternalTexture():null))}},{key:"getSubSurfaceConfiguration",value:function(){return this.mSubSurfaceConfiguration}},{key:"setSubSurfaceConfiguration",value:function(e){e&&(void 0!==e.isRefractionEnabled&&(this.mSubSurfaceConfiguration.isRefractionEnabled=e.isRefractionEnabled,this.mInternalMaterial.subSurface.isRefractionEnabled=e.isRefractionEnabled,this.setFlags({useTransmission:this.mSubSurfaceConfiguration.isRefractionEnabled})),void 0!==e.isScatteringEnabled&&(this.mSubSurfaceConfiguration.isScatteringEnabled=e.isScatteringEnabled,this.mInternalMaterial.subSurface.isScatteringEnabled=e.isScatteringEnabled),void 0!==e.isTranslucencyEnabled&&(this.mSubSurfaceConfiguration.isTranslucencyEnabled=e.isTranslucencyEnabled,this.mInternalMaterial.subSurface.isTranslucencyEnabled=e.isTranslucencyEnabled),void 0!==e.refractionIntensity&&(this.mSubSurfaceConfiguration.refractionIntensity=e.refractionIntensity,this.mInternalMaterial.subSurface.refractionIntensity=e.refractionIntensity),void 0!==e.translucencyIntensity&&(this.mSubSurfaceConfiguration.translucencyIntensity=e.translucencyIntensity,this.mInternalMaterial.subSurface.translucencyIntensity=e.translucencyIntensity),void 0!==e.useDiffuseToTintRefraction&&(this.mSubSurfaceConfiguration.useDiffuseToTintRefraction=e.useDiffuseToTintRefraction,this.mInternalMaterial.subSurface.useAlbedoToTintRefraction=e.useDiffuseToTintRefraction),void 0!==e.useDiffuseToTintTranslucency&&(this.mSubSurfaceConfiguration.useDiffuseToTintTranslucency=e.useDiffuseToTintTranslucency,this.mInternalMaterial.subSurface.useAlbedoToTintTranslucency=e.useDiffuseToTintTranslucency),void 0!==e.thicknessMap&&(this.mSubSurfaceConfiguration.thicknessMap=e.thicknessMap,this.mInternalMaterial.subSurface.thicknessTexture=e.thicknessMap?e.thicknessMap.getInternalTexture():null),void 0!==e.indexOfRefraction&&(this.mSubSurfaceConfiguration.indexOfRefraction=e.indexOfRefraction,this.mInternalMaterial.subSurface.indexOfRefraction=e.indexOfRefraction),void 0!==e.volumeIndexOfRefraction&&(this.mSubSurfaceConfiguration.volumeIndexOfRefraction=e.volumeIndexOfRefraction,this.mInternalMaterial.subSurface.volumeIndexOfRefraction=e.volumeIndexOfRefraction),void 0!==e.linkRefractionWithTransparency&&(this.mSubSurfaceConfiguration.linkRefractionWithTransparency=e.linkRefractionWithTransparency,this.mInternalMaterial.subSurface.linkRefractionWithTransparency=e.linkRefractionWithTransparency),void 0!==e.minimumThickness&&(this.mSubSurfaceConfiguration.minimumThickness=e.minimumThickness,this.mInternalMaterial.subSurface.minimumThickness=e.minimumThickness),void 0!==e.maximumThickness&&(this.mSubSurfaceConfiguration.maximumThickness=e.maximumThickness,this.mInternalMaterial.subSurface.maximumThickness=e.maximumThickness),void 0!==e.useThicknessAsDepth&&(this.mSubSurfaceConfiguration.useThicknessAsDepth=e.useThicknessAsDepth,this.mInternalMaterial.subSurface.useThicknessAsDepth=e.useThicknessAsDepth),void 0!==e.tintColor&&(this.mSubSurfaceConfiguration.tintColor.copy(e.tintColor),this.mInternalMaterial.subSurface.tintColor.set(e.tintColor.r,e.tintColor.g,e.tintColor.b)),void 0!==e.tintColorAtDistance&&(this.mSubSurfaceConfiguration.tintColorAtDistance=e.tintColorAtDistance,this.mInternalMaterial.subSurface.tintColorAtDistance=e.tintColorAtDistance),void 0!==e.diffusionDistance&&(this.mSubSurfaceConfiguration.diffusionDistance.copy(e.diffusionDistance),this.mInternalMaterial.subSurface.diffusionDistance.set(e.diffusionDistance.r,e.diffusionDistance.g,e.diffusionDistance.b)),void 0!==e.useMaskFromThicknessMap&&(this.mSubSurfaceConfiguration.useMaskFromThicknessMap=e.useMaskFromThicknessMap,this.mInternalMaterial.subSurface.useMaskFromThicknessTexture=e.useMaskFromThicknessMap),void 0!==e.translucencyIntensityMap&&(this.mSubSurfaceConfiguration.translucencyIntensityMap=e.translucencyIntensityMap,this.mInternalMaterial.subSurface.translucencyIntensityTexture=e.translucencyIntensityMap?e.translucencyIntensityMap.getInternalTexture():null))}},{key:"getIridescenceConfiguration",value:function(){return this.mIridescenceConfiguration}},{key:"setIridescenceConfiguration",value:function(e){e&&(void 0!==e.isEnabled&&(this.mIridescenceConfiguration.isEnabled=e.isEnabled,this.mInternalMaterial.iridescence.isEnabled=e.isEnabled),void 0!==e.intensity&&(this.mIridescenceConfiguration.intensity=e.intensity,this.mInternalMaterial.iridescence.intensity=e.intensity),void 0!==e.minimumThickness&&(this.mIridescenceConfiguration.minimumThickness=e.minimumThickness,this.mInternalMaterial.iridescence.minimumThickness=e.minimumThickness),void 0!==e.maximumThickness&&(this.mIridescenceConfiguration.maximumThickness=e.maximumThickness,this.mInternalMaterial.iridescence.maximumThickness=e.maximumThickness),void 0!==e.indexOfRefraction&&(this.mIridescenceConfiguration.indexOfRefraction=e.indexOfRefraction,this.mInternalMaterial.iridescence.indexOfRefraction=e.indexOfRefraction),void 0!==e.map&&(this.mIridescenceConfiguration.map=e.map,this.mInternalMaterial.iridescence.texture=e.map?e.map.getInternalTexture():null),void 0!==e.thicknessMap&&(this.mIridescenceConfiguration.thicknessMap=e.thicknessMap,this.mInternalMaterial.iridescence.thicknessTexture=e.thicknessMap?e.thicknessMap.getInternalTexture():null))}},{key:"getFlags",value:function(){return{useAlphaFresnel:this.mInternalMaterial.useAlphaFresnel,useAlphaFromDiffuseMap:this.mInternalMaterial.useAlphaFromAlbedoTexture,useAmbientInGrayScale:this.mInternalMaterial.useAmbientInGrayScale,useAmbientOcclusionFromMetallicMapRed:this.mInternalMaterial.useAmbientOcclusionFromMetallicTextureRed,useAutoMicroSurfaceFromReflectivityMap:this.mInternalMaterial.useAutoMicroSurfaceFromReflectivityMap,useLightmapAsShadowmap:this.mInternalMaterial.useLightmapAsShadowmap,useLinearAlphaFresnel:this.mInternalMaterial.useLinearAlphaFresnel,useMetalnessFromMetallicMapBlue:this.mInternalMaterial.useMetallnessFromMetallicTextureBlue,useMicroSurfaceFromReflectivityMapAlpha:this.mInternalMaterial.useMicroSurfaceFromReflectivityMapAlpha,useParallax:this.mInternalMaterial.useParallax,useParallaxOcclusion:this.mInternalMaterial.useParallaxOcclusion,useHorizonOcclusion:this.mInternalMaterial.useHorizonOcclusion,useRadianceOcclusion:this.mInternalMaterial.useRadianceOcclusion,useRadianceOverAlpha:this.mInternalMaterial.useRadianceOverAlpha,useRoughnessFromMetallicMapAlpha:this.mInternalMaterial.useRoughnessFromMetallicTextureAlpha,useRoughnessFromMetallicMapGreen:this.mInternalMaterial.useRoughnessFromMetallicTextureGreen,useSpecularAntiAliasing:this.mInternalMaterial.enableSpecularAntiAliasing,useSpecularOverAlpha:this.mInternalMaterial.useSpecularOverAlpha,useOnlyMetallicFromMetallicReflectanceMap:this.mInternalMaterial.useOnlyMetallicFromMetallicReflectanceTexture,usePhysicalLightFalloff:this.mInternalMaterial.usePhysicalLightFalloff,useTransmission:this.mUseTransmission}}},{key:"setFlags",value:function(e){e&&(void 0!==e.useAlphaFresnel&&(this.mInternalMaterial.useAlphaFresnel=e.useAlphaFresnel),void 0!==e.useAlphaFromDiffuseMap&&(this.mInternalMaterial.useAlphaFromAlbedoTexture=e.useAlphaFromDiffuseMap),void 0!==e.useAmbientInGrayScale&&(this.mInternalMaterial.useAmbientInGrayScale=e.useAmbientInGrayScale),void 0!==e.useAmbientOcclusionFromMetallicMapRed&&(this.mInternalMaterial.useAmbientOcclusionFromMetallicTextureRed=e.useAmbientOcclusionFromMetallicMapRed),void 0!==e.useAutoMicroSurfaceFromReflectivityMap&&(this.mInternalMaterial.useAutoMicroSurfaceFromReflectivityMap=e.useAutoMicroSurfaceFromReflectivityMap),void 0!==e.useLightmapAsShadowmap&&(this.mInternalMaterial.useLightmapAsShadowmap=e.useLightmapAsShadowmap),void 0!==e.useLinearAlphaFresnel&&(this.mInternalMaterial.useLinearAlphaFresnel=e.useLinearAlphaFresnel),void 0!==e.useMetalnessFromMetallicMapBlue&&(this.mInternalMaterial.useMetallnessFromMetallicTextureBlue=e.useMetalnessFromMetallicMapBlue),void 0!==e.useMicroSurfaceFromReflectivityMapAlpha&&(this.mInternalMaterial.useMicroSurfaceFromReflectivityMapAlpha=e.useMicroSurfaceFromReflectivityMapAlpha),void 0!==e.useParallax&&(this.mInternalMaterial.useParallax=e.useParallax),void 0!==e.useParallaxOcclusion&&(this.mInternalMaterial.useParallaxOcclusion=e.useParallaxOcclusion),void 0!==e.useHorizonOcclusion&&(this.mInternalMaterial.useHorizonOcclusion=e.useHorizonOcclusion),void 0!==e.useRadianceOcclusion&&(this.mInternalMaterial.useRadianceOcclusion=e.useRadianceOcclusion),void 0!==e.useRadianceOverAlpha&&(this.mInternalMaterial.useRadianceOverAlpha=e.useRadianceOverAlpha),void 0!==e.useRoughnessFromMetallicMapAlpha&&(this.mInternalMaterial.useRoughnessFromMetallicTextureAlpha=e.useRoughnessFromMetallicMapAlpha),void 0!==e.useRoughnessFromMetallicMapGreen&&(this.mInternalMaterial.useRoughnessFromMetallicTextureGreen=e.useRoughnessFromMetallicMapGreen),void 0!==e.useSpecularAntiAliasing&&(this.mInternalMaterial.enableSpecularAntiAliasing=e.useSpecularAntiAliasing),void 0!==e.useSpecularOverAlpha&&(this.mInternalMaterial.useSpecularOverAlpha=e.useSpecularOverAlpha),void 0!==e.useOnlyMetallicFromMetallicReflectanceMap&&(this.mInternalMaterial.useOnlyMetallicFromMetallicReflectanceTexture=e.useOnlyMetallicFromMetallicReflectanceMap),void 0!==e.usePhysicalLightFalloff&&(this.mInternalMaterial.usePhysicalLightFalloff=e.usePhysicalLightFalloff),void 0!==e.useTransmission&&(this.mUseTransmission=e.useTransmission,this.mUseTransmission||(this.mInternalMaterial.refractionTexture=null)))}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fogEnabled}},{key:"setFog",value:function(e){this.mInternalMaterial.fogEnabled=e}},{key:"getDepthTest",value:function(){return!0}},{key:"setDepthTest",value:function(e){}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.disableDepthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.disableDepthWrite=!e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.alpha}},{key:"setOpacity",value:function(e){this.mInternalMaterial.alpha=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaCutOff}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaCutOff=e,(!this.mAlphaTestEnabled&&e>=1e-5||this.mAlphaTestEnabled&&e<1e-5)&&(this.mAlphaTestEnabled=e>=1e-5,this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,this.mTransparent))}},{key:"getTransparent",value:function(){return ok(this.mInternalMaterial.transparencyMode)}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,e)}},{key:"getAlphaMode",value:function(){return uk(this.mInternalMaterial.alphaMode).alphaMode}},{key:"setAlphaMode",value:function(e){this.mInternalMaterial.alphaMode=ck(e,this.mPremultipliedAlpha)}},{key:"getPremultipliedAlpha",value:function(){return this.mPremultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mPremultipliedAlpha=e,this.setAlphaMode(this.mInternalMaterial.alphaMode)}},{key:"getColorWrite",value:function(){return!this.mInternalMaterial.disableColorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.disableColorWrite=!e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return 1}},{key:"setWireframeLineWidth",value:function(e){}},{key:"getFreeze",value:function(){return this.mInternalMaterial.isFrozen}},{key:"setFreeze",value:function(e){e?this.mInternalMaterial.freeze():this.mInternalMaterial.unfreeze()}},{key:"getSide",value:function(){return ik(this.mInternalMaterial.backFaceCulling,this.mInternalMaterial.cullBackFaces)}},{key:"setSide",value:function(e){var t=ak(e);this.mInternalMaterial.backFaceCulling=t.cullingEnabled,t.cullBackFace?this.mInternalMaterial.sideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:this.mInternalMaterial.sideOrientation=BABYLON.Material.ClockWiseSideOrientation,this.mInternalMaterial.cullBackFaces=t.cullBackFace,this.mInternalMaterial.twoSidedLighting=e===Es.Double}},{key:"getFlatShading",value:function(){return this.mFlatShading}},{key:"setFlatShading",value:function(e){this.mFlatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.metadata}},{key:"setMetaData",value:function(e){this.mInternalMaterial.metadata=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,e&&this.mInternalMaterial.markDirty()}},{key:"dispose",value:function(){this.mInternalMaterial.dispose(!1,!1)}},{key:"cloneMaterial",value:function(){return new n(this.getName(),this.mInternalMaterial.getScene()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){var t=this;return this.mDiffuseColor.copy(e.mDiffuseColor),this.mAmbientColor.copy(e.mAmbientColor),this.mEmissiveColor.copy(e.mEmissiveColor),this.mReflectionColor.copy(e.mReflectionColor),this.mSpecularColor.copy(e.mSpecularColor),this.mMetallicReflectanceColor.copy(e.mMetallicReflectanceColor),this.mNormalScale.copy(e.mNormalScale),this.mEnvMapScale.copy(e.mEnvMapScale),this.mLightMapIntensity=e.mLightMapIntensity,this.mUseSpecularGlossinessFlow=e.mUseSpecularGlossinessFlow,this.mUseTransmission=e.mUseTransmission,this.mMetalness=e.mMetalness,this.mRoughness=e.mRoughness,this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mNormalMap=e.mNormalMap,this.mAoMap=e.mAoMap,this.mEnvMap=e.mEnvMap,this.mEmissiveMap=e.mEmissiveMap,this.mEnvBrdfMap=e.mEnvBrdfMap,this.mLightMap=e.mLightMap,this.mReflectivityMap=e.mReflectivityMap,this.mReflectionMap=e.mReflectionMap,this.mGlossRoughMap=e.mGlossRoughMap,this.mMetalnessMap=e.mMetalnessMap,this.mMetallicReflectanceMap=e.mMetallicReflectanceMap,this.mBrdfConfiguration=e.mBrdfConfiguration,this.mDetailMapConfiguration=e.mDetailMapConfiguration,this.mClearCoatConfiguration=e.mClearCoatConfiguration,this.mSheenConfiguration=e.mSheenConfiguration,this.mAnisotropicConfiguration=e.mAnisotropicConfiguration,this.mSubSurfaceConfiguration=e.mSubSurfaceConfiguration,this.mIridescenceConfiguration=e.mIridescenceConfiguration,this.mDirty=e.mDirty,this.mAlphaTestEnabled=e.mAlphaTestEnabled,this.mTransparent=e.mTransparent,this.mFlatShading=e.mFlatShading,this.mPremultipliedAlpha=e.mPremultipliedAlpha,BABYLON.SerializationHelper.Clone((function(){return t}),e),this.mInternalMaterial.id=e.getInternalMaterial().id,this.mInternalMaterial.name=e.getInternalMaterial().name,e.getInternalMaterial().stencil.copyTo(this.mInternalMaterial.stencil),e.getInternalMaterial().brdf.copyTo(this.mInternalMaterial.brdf),e.getInternalMaterial().detailMap.copyTo(this.mInternalMaterial.detailMap),e.getInternalMaterial().clearCoat.copyTo(this.mInternalMaterial.clearCoat),e.getInternalMaterial().sheen.copyTo(this.mInternalMaterial.sheen),e.getInternalMaterial().anisotropy.copyTo(this.mInternalMaterial.anisotropy),e.getInternalMaterial().subSurface.copyTo(this.mInternalMaterial.subSurface),e.getInternalMaterial().iridescence.copyTo(this.mInternalMaterial.iridescence),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(ss);function pk(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])return BABYLON.Constants.MATERIAL_WireFrameFillMode;switch(e){case ec.POINTS:return BABYLON.Constants.MATERIAL_PointFillMode;case ec.LINES:return BABYLON.Constants.MATERIAL_LineListDrawMode;case ec.LINE_LOOP:return BABYLON.Constants.MATERIAL_LineLoopDrawMode;case ec.LINE_STRIP:return BABYLON.Constants.MATERIAL_LineStripDrawMode;default:case ec.TRIANGLES:return BABYLON.Constants.MATERIAL_TriangleFillMode;case ec.TRIANGLE_STRIP:return BABYLON.Constants.MATERIAL_TriangleStripDrawMode;case ec.TRIANGLE_FAN:return BABYLON.Constants.MATERIAL_TriangleFanDrawMode}}function mk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var dk=function(e){(0,g.Z)(h,e);var n,i,a,o,s=mk(h);function h(e,t){var n;return(0,u.Z)(this,h),n=s.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mCastShadow",!1),(0,l.Z)((0,_.Z)(n),"mReceiveShadow",!1),(0,l.Z)((0,_.Z)(n),"mOldGeometryResolver",void 0),(0,l.Z)((0,_.Z)(n),"mGeometryResolver",void 0),(0,l.Z)((0,_.Z)(n),"mOldMaterialResolver",void 0),(0,l.Z)((0,_.Z)(n),"mMaterialResolver",void 0),(0,l.Z)((0,_.Z)(n),"mGeometryHandle",void 0),(0,l.Z)((0,_.Z)(n),"mMaterialHandle",void 0),(0,l.Z)((0,_.Z)(n),"mGeometry",void 0),(0,l.Z)((0,_.Z)(n),"mMaterial",void 0),(0,l.Z)((0,_.Z)(n),"mOnBeforeRenderObserver",void 0),(0,l.Z)((0,_.Z)(n),"mOnAfterRenderObserver",void 0),n}return(0,c.Z)(h,[{key:"getVisibilityAttachState",value:function(){return this.mRenderObject.isVisible}},{key:"setVisibilityAttachState",value:function(e){this.mRenderObject.isVisible=e}},{key:"loadResource",value:(o=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateProperties(),e.next=3,this.loadResources();case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"geometryHasChanged",value:function(){return!this.mGeometryResolver||!this.mGeometryResolver.getHandle().validateHandle(this.mGeometryHandle)}},{key:"materialHasChanged",value:function(){return!this.mMaterialResolver||!this.mMaterialResolver.getHandle().validateHandle(this.mMaterialHandle)}},{key:"loadGeometry",value:(a=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mGeometryResolver||!this.mGeometryResolver.getHandle().validateHandle(this.mGeometryHandle)){e.next=2;break}return e.abrupt("return",this.mGeometryResolver.load());case 2:if(this.mGeometryResolver&&(this.mOldGeometryResolver=this.mGeometryResolver,delete this.mGeometryResolver),this.mGeometryHandle){e.next=5;break}throw new Error("Invalid geometry handle");case 5:return this.mGeometryResolver=new NM(this.mGeometryHandle,Qu.GeometryManager,!0),e.next=8,this.mGeometryResolver.load();case 8:return t=e.sent,this.mOldGeometryResolver&&(this.mOldGeometryResolver.dispose(),delete this.mOldGeometryResolver),e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"loadMaterial",value:(i=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mMaterialResolver||!this.mMaterialResolver.getHandle().validateHandle(this.mMaterialHandle)){e.next=4;break}return e.next=3,this.mMaterialResolver.load();case 3:return e.abrupt("return",e.sent);case 4:if(this.mMaterialResolver&&(this.mOldMaterialResolver=this.mMaterialResolver,delete this.mMaterialResolver),this.mMaterialHandle){e.next=7;break}throw new Error("Invalid material handle");case 7:return this.mMaterialResolver=new NM(this.mMaterialHandle,Qu.MaterialManager,!0),e.next=10,this.mMaterialResolver.load();case 10:return t=e.sent,this.mOldMaterialResolver&&(this.mOldMaterialResolver.dispose(),delete this.mOldMaterialResolver),e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updateGeometryAsync",value:function(){var e=this;this.geometryHasChanged()&&this.loadGeometry().then((function(t){e.mGeometry=t,e.mRenderObject&&(e.mGeometry.getInternalGeometry().applyToMesh(e.mRenderObject),e.mRenderer.markShadowMapUpdate(),P.eventBus().dispatch(new Di(Ei.RequestFrame)))}),(function(e){qe.qL.warn("Failed to load geometry:",e)}))}},{key:"updateMaterialAsync",value:function(){var e=this;this.materialHasChanged()?(this.mMaterial&&this.mMaterial instanceof fk&&this.hasMaterialTransmission(this.mMaterial)&&this.getRenderer().disposeTransmission(this.mMaterial.getUniqueId(),this.mSceneEntity.getSceneObjectId()),this.loadMaterial().then((function(t){e.mMaterial=t,e.updateTransmission(),e.mRenderObject&&(e.mRenderObject.material=e.mMaterial?e.mMaterial.getInternalMaterial():null,e.mRenderObject.material&&(e.mRenderObject.material.fillMode=pk(e.mSceneEntity.drawMode)),e.mRenderer.markShadowMapUpdate(),P.eventBus().dispatch(new Di(Ei.RequestFrame)))}),(function(e){qe.qL.warn("Failed to load material:",e)}))):this.updateTransmission()}},{key:"loadResources",value:(n=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.loadGeometry(),this.loadMaterial()]);case 2:t=e.sent,this.mGeometry=t[0],this.mMaterial=t[1],this.updateTransmission(),P.eventBus().dispatch(new Di(Ei.RequestFrame));case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;if(this.mCastShadow=e.castShadow,this.mReceiveShadow=e.receiveShadow,this.mGeometryHandle=e.getGeometry(),this.mMaterialHandle=e.getMaterial(),this.mRenderObject){this.mRenderObject.renderingGroupId=e.renderOrder;var t=this.mMaterial.getMetaData()||{};void 0!==t.renderOrder&&(this.mRenderObject.renderingGroupId=Number(t.renderOrder)+1)}}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(h.prototype),"onUpdateDirty",this).call(this),this.mRenderObject.isVisible=this.mSceneEntity.getVisibility(),this.updateProperties(),this.updateGeometryAsync(),this.updateMaterialAsync(),this.updateShadow(),P.eventBus().dispatch(new Di(Ei.RequestFrame))}},{key:"updateTranslation",value:function(){Ni((0,M.Z)(h.prototype),"updateTranslation",this).call(this)&&(this.mReceiveShadow||this.mCastShadow)&&this.mRenderer.markShadowMapUpdate()}},{key:"updateShadow",value:function(){this.mRenderObject.receiveShadows=this.mReceiveShadow,this.mRenderObject.metadata||(this.mRenderObject.metadata={}),this.mRenderObject.metadata.cast_shadow=this.mCastShadow}},{key:"updateTransmission",value:function(){this.mMaterial&&this.mMaterial instanceof fk&&this.hasMaterialTransmission(this.mMaterial)?this.getRenderer().initiateTransmission(this.mMaterial.getUniqueId(),this.mSceneEntity.getSceneObjectId()):this.getRenderer().disposeTransmission(this.mMaterial.getUniqueId(),this.mSceneEntity.getSceneObjectId())}},{key:"updateBoundingBox",value:function(){var e=this.mRenderObject.getBoundingInfo(),t=[],n=[];e.boundingBox.minimum.toArray(t),e.boundingBox.maximum.toArray(n);var r=(new Bi).fromArray(t),i=(new Bi).fromArray(n);this.mBoundingBox.copy(new ji(r,i)),Ni((0,M.Z)(h.prototype),"updateBoundingBox",this).call(this)}},{key:"createRenderObject",value:function(){var e=this;if(!this.mMaterial||!this.mGeometry)throw new Error("Mesh: Invalid resources.");var t=new BABYLON.Mesh(this.mSceneEntity.name,this.getRenderer().getScene());t.isVisible=this.mSceneEntity.getVisibility(),t.renderingGroupId=this.mSceneEntity.renderOrder,this.mRenderer.isRightHandedSystemActive()||this.mGeometry.getInternalGeometry().toLeftHanded(),this.mGeometry.getInternalGeometry().applyToMesh(t),t.material=this.mMaterial.getInternalMaterial(),t.material.backFaceCulling=this.mMaterial.getSide()!==Es.Double,t.useVertexColors=this.mGeometry.hasColors(),t.hasVertexAlpha=this.mGeometry.hasAlpha(),t.material&&(t.material.fillMode=pk(this.mSceneEntity.drawMode,this.mMaterial.getWireframe()));var n=this.mMaterial.getMetaData()||{};void 0!==n.renderOrder&&(t.renderingGroupId=Number(n.renderOrder)+1),t.receiveShadows=this.mReceiveShadow,this.mOnBeforeRenderObserver=t.onBeforeRenderObservable.add((function(){e.getRenderer().onBeforeMeshRender(t,e.mSceneEntity)})),this.mOnAfterRenderObserver=t.onAfterRenderObservable.add((function(){e.getRenderer().onAfterMeshRender(t,e.mSceneEntity)})),this.mRenderObject=t}},{key:"destroyRenderObject",value:function(){var e=this.mRenderObject;if(this.mGeometry&&this.mGeometry.getInternalGeometry().releaseForMesh(e,!1),delete this.mGeometry,delete this.mMaterial,e&&(e.onBeforeRenderObservable.remove(this.mOnBeforeRenderObserver),e.onAfterRenderObservable.remove(this.mOnAfterRenderObserver)),this.mMaterialResolver)try{this.mMaterialResolver.dispose(),delete this.mMaterialResolver}catch(e){qe.qL.warn("Failed to dispose resource",e)}if(this.mOldMaterialResolver)try{this.mOldMaterialResolver.dispose(),delete this.mOldMaterialResolver}catch(e){qe.qL.warn("Failed to dispose resource",e)}if(this.mGeometryResolver)try{this.mGeometryResolver.dispose(),delete this.mGeometryResolver}catch(e){qe.qL.warn("Failed to dispose resource",e)}if(this.mOldGeometryResolver)try{this.mOldGeometryResolver.dispose(),delete this.mOldGeometryResolver}catch(e){qe.qL.warn("Failed to dispose resource",e)}Ni((0,M.Z)(h.prototype),"destroyRenderObject",this).call(this)}},{key:"hasMaterialTransmission",value:function(e){return e.getFlags().useTransmission}}]),h}(LM);function vk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var yk=function(e){(0,g.Z)(h,e);var n,i,a,o,s=vk(h);function h(e,t){var n;return(0,u.Z)(this,h),n=s.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mCastShadow",!1),(0,l.Z)((0,_.Z)(n),"mReceiveShadow",!1),(0,l.Z)((0,_.Z)(n),"mGeometryResolver",void 0),(0,l.Z)((0,_.Z)(n),"mMaterialResolver",void 0),(0,l.Z)((0,_.Z)(n),"mGeometryHandle",void 0),(0,l.Z)((0,_.Z)(n),"mMaterialHandle",void 0),(0,l.Z)((0,_.Z)(n),"mGeometry",void 0),(0,l.Z)((0,_.Z)(n),"mMaterial",void 0),(0,l.Z)((0,_.Z)(n),"mOnBeforeRenderObserver",void 0),(0,l.Z)((0,_.Z)(n),"mOnAfterRenderObserver",void 0),n}return(0,c.Z)(h,[{key:"getVisibilityAttachState",value:function(){return this.mRenderObject.isVisible}},{key:"setVisibilityAttachState",value:function(e){this.mRenderObject.isVisible=e}},{key:"loadResource",value:(o=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateProperties(),e.next=3,this.loadResources();case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"geometryHasChanged",value:function(){return!this.mGeometryResolver||!this.mGeometryResolver.getHandle().validateHandle(this.mGeometryHandle)}},{key:"materialHasChanged",value:function(){return!this.mMaterialResolver||!this.mMaterialResolver.getHandle().validateHandle(this.mMaterialHandle)}},{key:"loadGeometry",value:(a=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mGeometryResolver||!this.mGeometryResolver.getHandle().validateHandle(this.mGeometryHandle)){e.next=2;break}return e.abrupt("return",this.mGeometryResolver.load());case 2:if(this.mGeometryResolver&&(this.mGeometryResolver.dispose(),delete this.mGeometryResolver),this.mGeometryHandle){e.next=5;break}throw new Error("Invalid geometry handle");case 5:return this.mGeometryResolver=new NM(this.mGeometryHandle,Qu.GeometryManager),e.abrupt("return",this.mGeometryResolver.load());case 7:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"loadMaterial",value:(i=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mMaterialResolver||!this.mMaterialResolver.getHandle().validateHandle(this.mMaterialHandle)){e.next=2;break}return e.abrupt("return",this.mMaterialResolver.load());case 2:if(this.mMaterialResolver&&(this.mMaterialResolver.dispose(),delete this.mMaterialResolver),this.mMaterialHandle){e.next=5;break}throw new Error("Invalid material handle");case 5:return this.mMaterialResolver=new NM(this.mMaterialHandle,Qu.MaterialManager),e.abrupt("return",this.mMaterialResolver.load());case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updateGeometryAsync",value:function(){var e=this;this.geometryHasChanged()&&this.loadGeometry().then((function(t){e.mGeometry=t,e.mRenderObject&&e.mGeometry.getInternalGeometry().applyToMesh(e.mRenderObject)}),(function(e){qe.qL.warn("Failed to load geometry:",e)}))}},{key:"updateMaterialAsync",value:function(){var e=this;this.materialHasChanged()&&this.loadMaterial().then((function(t){(e.mMaterial=t,e.mRenderObject)&&(e.mRenderObject.material.backFaceCulling=e.mMaterial.getSide()!==Es.Double,e.mRenderObject.material&&(e.mRenderObject.material.fillMode=pk(e.mSceneEntity.drawMode)))}),(function(e){qe.qL.warn("Failed to load material:",e)}))}},{key:"loadResources",value:(n=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.loadGeometry(),this.loadMaterial()]);case 2:t=e.sent,this.mGeometry=t[0],this.mMaterial=t[1];case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mCastShadow=e.castShadow,this.mReceiveShadow=e.receiveShadow,this.mGeometryHandle=e.getGeometry(),this.mMaterialHandle=e.getMaterial(),this.mRenderObject&&(this.mRenderObject.renderingGroupId=e.renderOrder)}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(h.prototype),"onUpdateDirty",this).call(this),this.mRenderObject.isVisible=this.mSceneEntity.getVisibility(),this.updateProperties(),this.updateGeometryAsync(),this.updateMaterialAsync(),this.updateShadow()}},{key:"updateShadow",value:function(){this.mRenderObject.receiveShadows=this.mReceiveShadow,this.mRenderObject.metadata||(this.mRenderObject.metadata={}),this.mRenderObject.metadata.cast_shadow=this.mCastShadow}},{key:"updateBoundingBox",value:function(){var e=this.mRenderObject.getBoundingInfo(),t=[],n=[];e.boundingBox.minimum.toArray(t),e.boundingBox.maximum.toArray(n);var r=(new Bi).fromArray(t),i=(new Bi).fromArray(n);this.mBoundingBox.copy(new ji(r,i)),Ni((0,M.Z)(h.prototype),"updateBoundingBox",this).call(this)}},{key:"createRenderObject",value:function(){var e,t=this;if(!this.mMaterial||!this.mGeometry)throw new Error("Mesh: Invalid resources.");var n=this.mGeometry.hasColors(),r=this.mGeometry.hasAlpha(),i=new BABYLON.LinesMesh(this.mSceneEntity.name,this.getRenderer().getScene(),void 0,void 0,void 0,n,r,this.mMaterial?this.mMaterial.getInternalMaterial():null);i.isVisible=this.mSceneEntity.getVisibility(),i.renderingGroupId=this.mSceneEntity.renderOrder,this.mRenderer.isRightHandedSystemActive()||this.mGeometry.getInternalGeometry().toLeftHanded(),this.mGeometry.getInternalGeometry().applyToMesh(i),i.material.backFaceCulling=(null===(e=this.mMaterial)||void 0===e?void 0:e.getSide())!==Es.Double,i.useVertexColors=n,i.hasVertexAlpha=r,i.material&&(i.material.fillMode=pk(this.mSceneEntity.drawMode,!1)),i.receiveShadows=this.mReceiveShadow,this.mOnBeforeRenderObserver=i.onBeforeRenderObservable.add((function(){t.getRenderer().onBeforeMeshRender(i,t.mSceneEntity)})),this.mOnAfterRenderObserver=i.onAfterRenderObservable.add((function(){t.getRenderer().onAfterMeshRender(i,t.mSceneEntity)})),this.mRenderObject=i}},{key:"destroyRenderObject",value:function(){var e=this.mRenderObject;this.mGeometry&&this.mGeometry.getInternalGeometry().releaseForMesh(e,!1),delete this.mGeometry,delete this.mMaterial,e.onBeforeRenderObservable.remove(this.mOnBeforeRenderObserver),e.onAfterRenderObservable.remove(this.mOnAfterRenderObserver),this.mMaterialResolver&&this.mMaterialResolver.dispose(),this.mGeometryResolver&&this.mGeometryResolver.dispose(),Ni((0,M.Z)(h.prototype),"destroyRenderObject",this).call(this)}}]),h}(LM);function gk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var bk=function(e){(0,g.Z)(n,e);var t=gk(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"mCellWidth",1),(0,l.Z)((0,_.Z)(i),"mCellHeight",1),i}return(0,c.Z)(n,[{key:"updateProperties",value:function(){Ni((0,M.Z)(n.prototype),"updateProperties",this).call(this);var e=this.mSceneEntity;this.mCellWidth=e.getValue("cell_width"),this.mCellHeight=e.getValue("cell_height")}}]),n}(dk);function Mk(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return kk(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kk(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function kk(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var xk=function(e){(0,g.Z)(a,e);var n,i=_k(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mPower",.5),(0,l.Z)((0,_.Z)(e),"mClipDistance",.05),(0,l.Z)((0,_.Z)(e),"mSamplingRadius",8),(0,l.Z)((0,_.Z)(e),"mPlane",void 0),(0,l.Z)((0,_.Z)(e),"mDepthCamera",void 0),(0,l.Z)((0,_.Z)(e),"mRT1",void 0),(0,l.Z)((0,_.Z)(e),"mRT2",void 0),(0,l.Z)((0,_.Z)(e),"mDepthShaderMaterial",void 0),(0,l.Z)((0,_.Z)(e),"mAoPlaneEffect",void 0),(0,l.Z)((0,_.Z)(e),"mBlurEffect",void 0),(0,l.Z)((0,_.Z)(e),"mEffectRenderer",void 0),(0,l.Z)((0,_.Z)(e),"mPlaneMaterial",void 0),(0,l.Z)((0,_.Z)(e),"AOPlaneRTSize",256),(0,l.Z)((0,_.Z)(e),"mRebuildAO",!0),(0,l.Z)((0,_.Z)(e),"mDepthVertexShader","\n        attribute vec3 position;\n        attribute vec2 uv;\n\n        uniform mat4 worldView;\n        uniform mat4 worldViewProjection;\n        uniform mat4 projection;\n        uniform float zCorrection;\n\n        varying float vDepth;\n        varying vec2 vUv;\n        varying vec3 vModelPosition;\n\n        void main() {\n            vec4 worldPosition = worldView * vec4( position, 1.0 );\n            vModelPosition = worldPosition.xyz;\n            vDepth = worldPosition.z * zCorrection;\n            vUv = uv;\n            gl_Position = projection * worldPosition;\n        }\n    "),(0,l.Z)((0,_.Z)(e),"mAoBlurVertex","\n        precision highp float;\n        attribute vec2 position;\n\n        varying vec2 vUv;\n        varying vec3 vModelPosition;\n        const vec2 madd = vec2(0.5, 0.5);\n\n        void main(void) {\n            vUv = (position * madd + madd);\n            vModelPosition = vec3(position, 0.0);\n            gl_Position = vec4(position, 0.0, 1.0);\n        }\n    "),(0,l.Z)((0,_.Z)(e),"mDepthFragmentShader","\n        uniform float far;\n\n        varying float vDepth;\n\n        const float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\n        const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\n        const float ShiftRight8 = 1. / 256.;\n\n        vec4 packDepthToRGBA(const in float v) {\n            vec4 r = vec4( fract( v * PackFactors ), v );\n            r.yzw -= r.xyz * ShiftRight8; // tidy overflow\n            return r * PackUpscale;\n        }\n\n        void main() {\n            gl_FragColor = packDepthToRGBA(vDepth / far); // save depth in part-components space.\n        }\n    "),(0,l.Z)((0,_.Z)(e),"mBlurFragmentShader","\n        uniform vec2 iResolution;\n        uniform vec2 direction;\n        uniform sampler2D tDiffuse;\n\n        varying vec2 vUv;\n\n        vec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n            vec4 color = vec4(0.0);\n            vec2 off1 = vec2(1.411764705882353) * direction;\n            vec2 off2 = vec2(3.2941176470588234) * direction;\n            vec2 off3 = vec2(5.176470588235294) * direction;\n            color += texture2D(image, uv) * 0.1964825501511404;\n            color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n            color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n            color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n            color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n            color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n            color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n            return color;\n        }\n\n        void main() {\n            gl_FragColor = blur13(tDiffuse, vUv, iResolution.xy, direction);\n        }\n    "),(0,l.Z)((0,_.Z)(e),"mAoFragmentShader","\n        uniform sampler2D Sample0;\t// View space position data\n        uniform vec2 TexelSize;\n        uniform float SamplingRadius;\n        uniform float Power;\n        uniform float CameraFar;\n        uniform float CameraNear;\n        uniform vec2 RightTop;\n\n        varying vec3 vModelPosition;\n        varying vec2 vUv;\n\n        const float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)]\n        const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\n        const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\n        float unpackRGBAToDepth( const in vec4 v ) {\n            return dot( v, UnpackFactors );\n        }\n\n        vec3 reconstructPosition(vec2 uv) {\n            vec2 ndc = uv*2.0 - vec2(1.0, 1.0);\n            vec4 sampleDepth = texture2D(Sample0, uv);\n            float modelDepth = unpackRGBAToDepth(sampleDepth);\n            vec2 pnear = ndc * RightTop;\n            float pz = -modelDepth*CameraFar;\n            return vec3(-pz*pnear.x / CameraNear, -pz*pnear.y / CameraNear, pz);\n        }\n\n        float SamplePixels(vec3 srcPosition, vec2 uv) {\n            vec3 dstPosition = reconstructPosition(uv);\n\n            vec3 positionVec = dstPosition - srcPosition;\n            float dist = length(positionVec);\n            float intensity = dist*dist*dist*dist;\n            intensity = exp(intensity*-Power);\n\n            return min(-dstPosition.z, intensity);\n        }\n\n        void main() {\n            float kernelRadius = SamplingRadius;\n\n            // Sample neighbouring pixels\n            vec2 kernel[4];\n            kernel[0] = vec2(0.0, 1.0);\t // top\n            kernel[1] = vec2(1.0, 0.0);\t // right\n            kernel[2] = vec2(0.0, -1.0); // bottom\n            kernel[3] = vec2(-1.0, 0.0); // left\n\n            const float Sin45 = 0.707107;\t// 45 degrees = sin(PI / 4)\n\n            float occlusion = 0.0;\n            for (int i = 0; i < 4; ++i)\n            {\n                vec2 k1 = kernel[i];\n                vec2 k2 = vec2(k1.x * Sin45 - k1.y * Sin45, k1.x * Sin45 + k1.y * Sin45);\n                k1 *= TexelSize;\n                k2 *= TexelSize;\n                occlusion += SamplePixels(vModelPosition, vUv + k1 * kernelRadius);\n                occlusion += SamplePixels(vModelPosition, vUv + k2 * kernelRadius * 0.75);\n                occlusion += SamplePixels(vModelPosition, vUv + k1 * kernelRadius * 0.5);\n                occlusion += SamplePixels(vModelPosition, vUv + k2 * kernelRadius * 0.25);\n            }\n\n            // Average and clamp ambient occlusion\n            occlusion /= 16.0;\n            occlusion = clamp(occlusion, 0.0, 1.0);\n\n            gl_FragColor = vec4(0.0, 0.0, 0.0, exp(occlusion)-1.0);\n        }\n    "),e}return(0,c.Z)(a,[{key:"isDirty",get:function(){return this.mRebuildAO},set:function(e){this.mRebuildAO=e}},{key:"getVisibilityAttachState",value:function(){return this.mRenderObject.isVisible}},{key:"setVisibilityAttachState",value:function(e){this.mRenderObject.isVisible=e}},{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties(),this.isDirty=!0;case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mClipDistance=e.clipDistance,this.mSamplingRadius=e.samplingRadius,this.mPower=e.power,this.mRenderObject&&(this.mRenderObject.renderingGroupId=e.renderOrder)}},{key:"calculatePower",value:function(){return 1/Math.exp(9*(1-(1-this.mPower)))}},{key:"updatePlaneGeometry",value:function(e,t,n){this.mPlane.scaling.x=t*(this.mRenderer.isRightHandedSystemActive()?1:-1),this.mPlane.scaling.y=n*(this.mRenderer.isRightHandedSystemActive()?-1:1),this.mPlane.position=e,this.mPlane.rotation.x=.5*Math.PI*(this.mRenderer.isRightHandedSystemActive()?-1:1);var r=this.mSceneEntity;r.width=t,r.height=n}},{key:"fitCameraToObject",value:function(){var e=this.getRenderer().getSceneBoundingBox();e.isEmpty()&&e.set(new Bi(0,0,0),new Bi(0,0,0));var t=this.getRenderer().getEngine(),n=new Bi;e.getCenter(n);var r=new Bi;e.getSize(r);var i=r.x>r.z?r.x:r.z;if(!(i<=0)){var o=i/2/Math.tan(45*Math.PI/360);this.mDepthCamera.position.set(n.x,n.y-(o+r.y),n.z),this.mDepthCamera.maxZ=Math.abs(this.mDepthCamera.position.y-e.min.y)*(1+this.mClipDistance),this.mDepthCamera.fov=Pt(45);var s=t.getRenderWidth()/t.getRenderHeight();this.mDepthCamera.viewport.height=s,this.mDepthCamera.setTarget(new BABYLON.Vector3(n.x,n.y,n.z)),this.mDepthCamera.rotation.y=Math.PI,this.mDepthCamera.computeWorldMatrix();var u=2*Math.tan(Math.PI/180*45/2)*this.mDepthCamera.maxZ,c=new BABYLON.Vector3(n.x,e.min.y-a.POSITION_EPSILON,n.z),l=u*((BABYLON.Vector3.Distance(this.mDepthCamera.position,c)-this.mDepthCamera.minZ)/(this.mDepthCamera.maxZ-this.mDepthCamera.minZ));this.updatePlaneGeometry(c,l,l)}}},{key:"renderPlaneDepth",value:function(){this.mDepthShaderMaterial.setFloat("far",this.mDepthCamera.maxZ),this.mDepthShaderMaterial.setFloat("zCorrection",this.mRenderer.isRightHandedSystemActive()?-1:1);var e,t=this.mRT1.renderList,n=Mk(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.metadata._savedMaterial=r.material,r.material=this.mDepthShaderMaterial}}catch(e){n.e(e)}finally{n.f()}this.mRT1.render(!1,!1);var i,a=Mk(t);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.material=o.metadata._savedMaterial}}catch(e){a.e(e)}finally{a.f()}}},{key:"renderAO",value:function(){this.mEffectRenderer.render(this.mAoPlaneEffect,this.mRT2)}},{key:"renderBlur",value:function(){var e=this;this.mBlurEffect.onApplyObservable.clear(),this.mBlurEffect.onApplyObservable.add((function(){e.mBlurEffect.effect.setFloat2("iResolution",e.AOPlaneRTSize,e.AOPlaneRTSize),e.mBlurEffect.effect.setFloat2("direction",1,0),e.mBlurEffect.effect.setTexture("tDiffuse",e.mRT2)})),this.mEffectRenderer.render(this.mBlurEffect,this.mRT1),this.mBlurEffect.onApplyObservable.clear(),this.mBlurEffect.onApplyObservable.add((function(){e.mBlurEffect.effect.setFloat2("iResolution",e.AOPlaneRTSize,e.AOPlaneRTSize),e.mBlurEffect.effect.setFloat2("direction",0,1),e.mBlurEffect.effect.setTexture("tDiffuse",e.mRT1)})),this.mEffectRenderer.render(this.mBlurEffect,this.mRT2)}},{key:"createRenderTarget",value:function(e){var t=new BABYLON.RenderTargetTexture(e,this.AOPlaneRTSize,this.getRenderer().getScene(),!0,!0,BABYLON.Constants.TEXTURETYPE_UNSIGNED_BYTE,!1,BABYLON.Texture.LINEAR_LINEAR_MIPLINEAR,!0,!1,!1,BABYLON.Constants.TEXTUREFORMAT_RGBA);return t.hasAlpha=!0,t}},{key:"createDepthShader",value:function(){this.mDepthShaderMaterial=new BABYLON.ShaderMaterial("ao-plane-depth-material",this.getRenderer().getScene(),{vertexSource:this.mDepthVertexShader,fragmentSource:this.mDepthFragmentShader},{attributes:["position","normal","uv"],uniforms:["world","worldView","worldViewProjection","view","projection","far","zCorrection"],defines:[],needAlphaBlending:!0,needAlphaTesting:!0}),this.mDepthShaderMaterial.backFaceCulling=!1}},{key:"createAOEffect",value:function(){var e=this;this.mAoPlaneEffect=new BABYLON.EffectWrapper({name:"ao-plane-effect-wrapper",engine:this.getRenderer().getEngine(),vertexShader:this.mAoBlurVertex,fragmentShader:this.mAoFragmentShader,attributeNames:["position"],samplerNames:["Sample0"],uniformNames:["TexelSize","SamplingRadius","Power","CameraFar","CameraNear","RightTop"]}),this.mAoPlaneEffect.onApplyObservable.add((function(){var t=e.mDepthCamera.maxZ,n=e.mDepthCamera.minZ,r=e.mDepthCamera.fov,i=e.getRenderer().getEngine().getAspectRatio(e.mDepthCamera),a=Math.tan(r/2)*n,o=a*i,s=new BABYLON.Vector2(o,a);e.mAoPlaneEffect.effect.setFloat2("TexelSize",1/e.AOPlaneRTSize,1/e.AOPlaneRTSize),e.mAoPlaneEffect.effect.setFloat("SamplingRadius",e.mSamplingRadius),e.mAoPlaneEffect.effect.setFloat("Power",e.calculatePower()),e.mAoPlaneEffect.effect.setFloat("CameraFar",t),e.mAoPlaneEffect.effect.setFloat("CameraNear",n),e.mAoPlaneEffect.effect.setFloat2("RightTop",s.x,s.y),e.mAoPlaneEffect.effect.setTexture("Sample0",e.mRT1)}))}},{key:"createBlurEffect",value:function(){this.mBlurEffect=new BABYLON.EffectWrapper({name:"ao-plane-blur-effect-wrapper",engine:this.getRenderer().getEngine(),vertexShader:this.mAoBlurVertex,fragmentShader:this.mBlurFragmentShader,attributeNames:["position","normal","uv"],samplerNames:["tDiffuse"],uniformNames:["worldViewProjection","iResolution","direction"]})}},{key:"createRenderObject",value:function(){var e=this,t=this.getRenderer().getEngine(),n=this.getRenderer().getScene();this.mDepthCamera=new BABYLON.FreeCamera("ao_plane_camera",new BABYLON.Vector3(0,0,-10),n,!1),this.mDepthCamera.ignoreParentScaling=!0,this.mDepthCamera.minZ=.01,this.mDepthCamera.maxZ=1e4,this.mDepthCamera.fov=Pt(45),this.mRT1=this.createRenderTarget("ao-plane-RT1"),this.mRT2=this.createRenderTarget("ao-plane-RT2"),this.mRT1.activeCamera=this.mDepthCamera,this.mRT1.clearColor=new BABYLON.Color4(0,0,0,0),this.mRT2.clearColor=new BABYLON.Color4(0,0,0,0),this.mRT1.ignoreCameraViewport=!0,this.mRT2.ignoreCameraViewport=!0,this.mEffectRenderer=new BABYLON.EffectRenderer(t,{positions:this.mRenderer.isRightHandedSystemActive()?[1,-1,-1,-1,-1,1,1,1]:[1,1,-1,1,-1,-1,1,-1]}),this.createDepthShader(),this.createAOEffect(),this.createBlurEffect(),this.mPlaneMaterial=new BABYLON.StandardMaterial("ao-plane-material",n),this.mPlaneMaterial.transparencyMode=BABYLON.StandardMaterial.MATERIAL_ALPHABLEND,this.mPlaneMaterial.sideOrientation=BABYLON.Constants.MATERIAL_CounterClockWiseSideOrientation,this.mPlaneMaterial.backFaceCulling=!0,this.mPlaneMaterial.diffuseTexture=this.mRT2,this.mPlaneMaterial.useAlphaFromDiffuseTexture=!0,this.mPlaneMaterial.specularColor=BABYLON.Color3.Black(),this.mPlane=BABYLON.MeshBuilder.CreatePlane("ao-plane-mesh",{size:1},n),this.mPlane.renderingGroupId=this.mSceneEntity.renderOrder,this.mPlane.material=this.mPlaneMaterial,this.mPlane.isPickable=!1,this.mRenderObject=this.mPlane,this.getRenderer().getScene().executeWhenReady((function(){e.isDirty=!0}))}},{key:"updateTranslation",value:function(){return!1}},{key:"checksumRenderList",value:function(e){var t,n=e.map((function(e){return e.worldMatrixFromCache.m})).join(""),r=0;if(0===n.length)return r;for(t=0;t<n.length;t++)r=(r<<5)-r+n.charCodeAt(t),r|=0;return r}},{key:"updateRenderList",value:function(){var e,t=this,n=this.getRenderer().getScene().meshes.filter((function(e){var n,r=null===(n=t.getRenderer().getEntityFromObject(e))||void 0===n?void 0:n.layers;return e.id!==t.mPlane.id&&r&&!r.isEnabled(1)&&!r.isEnabled(2)&&!r.isEnabled(7)})),r=this.checksumRenderList(n);(null===(e=this.mRT1.metadata)||void 0===e?void 0:e.checksum)!==r&&(this.mRT1.metadata=this.mRT1.metadata||{},this.mRT1.metadata.checksum=r,this.mRT1.renderList=n,this.isDirty=!0)}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.isDirty=!0}},{key:"update",value:function(e){Ni((0,M.Z)(a.prototype),"update",this).call(this,e),this.updateRenderList(),this.isDirty&&(this.fitCameraToObject(),this.renderPlaneDepth(),this.renderAO(),this.renderBlur(),this.isDirty=!1)}},{key:"disposeProperty",value:function(e){e&&e.dispose()}},{key:"dispose",value:function(){this.disposeProperty(this.mRT1),this.disposeProperty(this.mRT2),this.disposeProperty(this.mPlaneMaterial),this.disposeProperty(this.mDepthShaderMaterial),this.disposeProperty(this.mPlane),this.disposeProperty(this.mEffectRenderer),this.disposeProperty(this.mDepthCamera),this.disposeProperty(this.mAoPlaneEffect),this.disposeProperty(this.mBlurEffect),Ni((0,M.Z)(a.prototype),"dispose",this).call(this)}}]),a}(LM);function Tk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(xk,"POSITION_EPSILON",.001);var wk=function(e){(0,g.Z)(o,e);var n,i,a=Tk(o);function o(){var e;(0,u.Z)(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=a.call.apply(a,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mFireMesh",void 0),(0,l.Z)((0,_.Z)(e),"mFireMaterial",void 0),(0,l.Z)((0,_.Z)(e),"mPosition",new BABYLON.Vector3),(0,l.Z)((0,_.Z)(e),"mScale",new BABYLON.Vector3),(0,l.Z)((0,_.Z)(e),"mRotation",new BABYLON.Quaternion),e}return(0,c.Z)(o,[{key:"getVisibilityAttachState",value:function(){return this.mRenderObject.isVisible}},{key:"setVisibilityAttachState",value:function(e){this.mRenderObject.isVisible=e}},{key:"loadResource",value:(i=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.loadTextures();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),qe.qL.warn("Failed to load fire textures:",e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return i.apply(this,arguments)})},{key:"loadTextures",value:(n=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){if(++o.sTextures.revision>1)return e();var n=t.getRenderer().getScene();o.sTextures.textures=[new BABYLON.Texture("".concat(Jr.E.assetsUrl,"system/textures/fire-diffuse.png"),n),new BABYLON.Texture("".concat(Jr.E.assetsUrl,"system/textures/fire-distortion.png"),n),new BABYLON.Texture("".concat(Jr.E.assetsUrl,"system/textures/fire-candleopacity.png"),n)],BABYLON.Texture.WhenAllReady(o.sTextures.textures,(function(){e()}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"disposeTextures",value:function(){--o.sTextures.revision>0||(o.sTextures.revision=0,o.sTextures.textures.splice(0).forEach((function(e){e.dispose()})))}},{key:"updateTranslation",value:function(){if(!this.mMatrixNeedsUpdate&&!this.mSceneEntity.transform.matrixNeedsUpdate&&!this.mSceneEntity.transform.matrixWorldNeedsUpdate)return!1;var e=this.mSceneEntity.transform.matrixWorld.elements;return this.mMatrix.setRowFromFloats(0,e[0],e[1],e[2],e[3]),this.mMatrix.setRowFromFloats(1,e[4],e[5],e[6],e[7]),this.mMatrix.setRowFromFloats(2,e[8],e[9],e[10],e[11]),this.mMatrix.setRowFromFloats(3,e[12],e[13],e[14],e[15]),this.mRenderer.isRightHandedSystemActive()||this.mMatrix.toggleModelMatrixHandInPlace(),this.mMatrix.decompose(this.mScale,this.mRotation,this.mPosition),this.mRenderObject.position.copyFrom(this.mPosition),this.mRenderObject.scaling.copyFrom(this.mScale),this.mRenderObject._updateBoundingInfo(),!0}},{key:"createRenderObject",value:function(){this.mFireMaterial=new BABYLON.FireMaterial("fire-material",this.getRenderer().getScene()),this.mFireMaterial.diffuseTexture=o.sTextures.textures[0],this.mFireMaterial.distortionTexture=o.sTextures.textures[1],this.mFireMaterial.opacityTexture=o.sTextures.textures[2],this.mRenderer.isRightHandedSystemActive()&&(this.mFireMaterial.sideOrientation=BABYLON.Constants.MATERIAL_CounterClockWiseSideOrientation),this.mFireMaterial.speed=5,this.mFireMesh=BABYLON.MeshBuilder.CreatePlane("fire-mesh",{size:3},this.getRenderer().getScene()),this.mFireMesh.renderingGroupId=this.mSceneEntity.renderOrder,this.mFireMesh.billboardMode=BABYLON.Mesh.BILLBOARDMODE_Y,this.mFireMesh.material=this.mFireMaterial,this.mRenderObject=this.mFireMesh}},{key:"dispose",value:function(){this.mFireMaterial&&(this.mFireMaterial.diffuseTexture=null,this.mFireMaterial.distortionTexture=null,this.mFireMaterial.opacityTexture=null,this.mFireMaterial.dispose(),this.disposeTextures()),Ni((0,M.Z)(o.prototype),"dispose",this).call(this)}}]),o}(LM);function Rk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(wk,"sTextures",{revision:0,textures:[]});var Zk=function(e){(0,g.Z)(a,e);var n,i=Rk(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mColor",BABYLON.Color3.White()),(0,l.Z)((0,_.Z)(e),"mOpacity",1),(0,l.Z)((0,_.Z)(e),"mReflector",void 0),(0,l.Z)((0,_.Z)(e),"mReflectorMaterial",void 0),(0,l.Z)((0,_.Z)(e),"mMirrorTexture",void 0),e}return(0,c.Z)(a,[{key:"getVisibilityAttachState",value:function(){return this.mRenderObject.isVisible}},{key:"setVisibilityAttachState",value:function(e){this.mRenderObject.isVisible=e}},{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mColor.set(e.color.r,e.color.g,e.color.b),this.mOpacity=e.opacity,this.mRenderObject&&(this.mRenderObject.renderingGroupId=e.renderOrder,this.mReflector.renderingGroupId=e.renderOrder)}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.mReflectorMaterial.diffuseColor.set(this.mColor.r,this.mColor.g,this.mColor.b),this.mMirrorTexture.clearColor.set(this.mColor.r,this.mColor.g,this.mColor.b,0),this.mReflectorMaterial.alpha=this.mOpacity}},{key:"update",value:function(e){Ni((0,M.Z)(a.prototype),"update",this).call(this,e),this.updateRenderlist()}},{key:"updateTranslation",value:function(){var e=this.mMatrixNeedsUpdate||this.mSceneEntity.transform.matrixNeedsUpdate||this.mSceneEntity.transform.matrixWorldNeedsUpdate;return Ni((0,M.Z)(a.prototype),"updateTranslation",this).call(this),!!e&&(this.mMirrorTexture.mirrorPlane=this.generateMirrorPlane(),!0)}},{key:"generateMirrorPlane",value:function(){if(this.mRenderObject){var e=this.mRenderObject.getWorldMatrix(),t=BABYLON.Vector3.Zero();t=BABYLON.Vector3.TransformCoordinates(t,e);var n=new BABYLON.Vector3(0,0,1);return n=BABYLON.Vector3.TransformNormal(n,e),BABYLON.Plane.FromPositionAndNormal(t,n)}}},{key:"updateRenderlist",value:function(){var e=this;this.mRenderObject&&this.getRenderer().getScene().meshes&&this.mMirrorTexture&&(this.mMirrorTexture.renderList=this.getRenderer().getScene().meshes.filter((function(t){var n,r=null===(n=e.getRenderer().getEntityFromObject(t))||void 0===n?void 0:n.layers;return!(t.id===e.mReflector.id||r&&(r.isEnabled(1)||r.isEnabled(2)||r.isEnabled(7)))})))}},{key:"createRenderObject",value:function(){var e=new BABYLON.Mesh("reflector-group",this.getRenderer().getScene());e.renderingGroupId=this.mSceneEntity.renderOrder,this.mMirrorTexture=new BABYLON.MirrorTexture("reflector-mirror-texture",1024,this.getRenderer().getScene(),!0,void 0,BABYLON.Texture.TRILINEAR_SAMPLINGMODE),this.mMirrorTexture.mirrorPlane=this.generateMirrorPlane(),this.mMirrorTexture.level=1,this.mMirrorTexture.hasAlpha=!0,this.mMirrorTexture.blurKernel=0,this.mMirrorTexture.adaptiveBlurKernel=0,this.mMirrorTexture.clearColor=new BABYLON.Color4(this.mColor.r,this.mColor.g,this.mColor.b,0),this.mReflectorMaterial=new BABYLON.StandardMaterial("reflector-material",this.getRenderer().getScene()),this.mReflectorMaterial.diffuseColor=new BABYLON.Color3(this.mColor.r,this.mColor.g,this.mColor.b),this.mReflectorMaterial.reflectionTexture=this.mMirrorTexture,this.mReflectorMaterial.useAlphaFromDiffuseTexture=!0,this.mReflectorMaterial.alpha=this.mOpacity,this.mReflectorMaterial.transparencyMode=BABYLON.StandardMaterial.MATERIAL_ALPHABLEND,this.mRenderer.isRightHandedSystemActive()&&(this.mReflectorMaterial.sideOrientation=BABYLON.Constants.MATERIAL_CounterClockWiseSideOrientation),this.mReflector=BABYLON.MeshBuilder.CreatePlane("reflector-mesh",{width:20,height:20},this.getRenderer().getScene()),this.mReflector.renderingGroupId=this.mSceneEntity.renderOrder,this.mReflector.material=this.mReflectorMaterial,this.mReflector.parent=e,this.mReflector.metadata={scene_entity_id:this.mSceneEntity.id},this.updateRenderlist(),this.mRenderObject=e}}]),a}(LM);function Sk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ck=function(e){(0,g.Z)(o,e);var n,i,a=Sk(o);function o(){var e;(0,u.Z)(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=a.call.apply(a,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mEquirectMaterial",void 0),(0,l.Z)((0,_.Z)(e),"mTextureId",void 0),(0,l.Z)((0,_.Z)(e),"mHandle",void 0),(0,l.Z)((0,_.Z)(e),"mActiveLoader",void 0),(0,l.Z)((0,_.Z)(e),"mActiveTexture",void 0),e}return(0,c.Z)(o,[{key:"getVisibilityAttachState",value:function(){return this.mRenderObject.isVisible}},{key:"setVisibilityAttachState",value:function(e){this.mRenderObject.isVisible=e}},{key:"loadResource",value:(i=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateProperties(),e.abrupt("return",this.updateTexture());case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mTextureId=e.getTextureId(),this.mRenderObject&&(this.mRenderObject.renderingGroupId=e.renderOrder)}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(o.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.updateTexture().then((function(){}),(function(){}))}},{key:"updateHandle",value:function(){if(this.mHandle&&this.mHandle.id===this.mTextureId)return!1;var e=tc.getManager(Qu.TextureManager);return this.mHandle&&(e.disposeResource(this.mHandle.handle),delete this.mHandle),!!this.mTextureId&&(this.mHandle={id:this.mTextureId,handle:e.makeResource(this.mTextureId)},!0)}},{key:"updateTexture",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.updateHandle()){e.next=2;break}return e.abrupt("return");case 2:if(!this.mActiveLoader||!this.mActiveLoader.getHandle().validateHandle(this.mHandle.handle)){e.next=4;break}return e.abrupt("return");case 4:return this.mActiveLoader&&(this.mActiveLoader.dispose(),delete this.mActiveLoader),this.mActiveLoader=new NM(this.mHandle.handle,Qu.TextureManager),e.next=8,this.mActiveLoader.load();case 8:this.mActiveTexture=e.sent,this.mActiveTexture.getInternalTexture().coordinatesMode=BABYLON.Texture.EQUIRECTANGULAR_MODE,this.applyTextures();case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"applyTextures",value:function(){this.mEquirectMaterial&&(this.mEquirectMaterial.reflectionTexture=this.mActiveTexture.getInternalTexture())}},{key:"createRenderObject",value:function(){var e=this.getRenderer().getScene(),t=BABYLON.MeshBuilder.CreateBox("hdrSkyBox",{size:1e3},e);t.renderingGroupId=this.mSceneEntity.renderOrder,this.mEquirectMaterial=new BABYLON.PBRMaterial("skyBox",e),this.mEquirectMaterial.backFaceCulling=!1,this.mEquirectMaterial.microSurface=1,this.mEquirectMaterial.disableLighting=!0,this.applyTextures(),t.material=this.mEquirectMaterial,t.infiniteDistance=!0,this.mRenderObject=t}},{key:"dispose",value:function(){Ni((0,M.Z)(o.prototype),"dispose",this).call(this);var e=tc.getManager(Qu.TextureManager);this.mHandle&&e.disposeResource(this.mHandle.handle),this.mActiveLoader&&this.mActiveLoader.dispose()}}]),o}(LM);function Ik(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ek=function(e){(0,g.Z)(o,e);var n,i,a=Ik(o);function o(){var e;(0,u.Z)(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=a.call.apply(a,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mReceiveShadow",!1),(0,l.Z)((0,_.Z)(e),"mMaterials",[]),(0,l.Z)((0,_.Z)(e),"mFakeLight",void 0),(0,l.Z)((0,_.Z)(e),"mWaterMesh",void 0),(0,l.Z)((0,_.Z)(e),"mWaterMaterial",void 0),e}return(0,c.Z)(o,[{key:"getVisibilityAttachState",value:function(){return this.mRenderObject.isVisible}},{key:"setVisibilityAttachState",value:function(e){this.mRenderObject.isVisible=e}},{key:"loadResource",value:(i=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateProperties(),e.prev=1,e.next=4,this.loadTextures();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),qe.qL.warn("Failed to load water textures:",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return i.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mReceiveShadow=e.receiveShadow,this.mRenderObject&&(this.mRenderObject.renderingGroupId=e.renderOrder)}},{key:"loadTextures",value:(n=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){if(++o.sTextures.revision>1)return e();var n=t.getRenderer().getScene();o.sTextures.textures=[new BABYLON.Texture("".concat(Jr.E.assetsUrl,"system/textures/waternormals.jpg"),n)],BABYLON.Texture.WhenAllReady(o.sTextures.textures,(function(){e()}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"disposeTextures",value:function(){--o.sTextures.revision>0||(o.sTextures.revision=0,o.sTextures.textures.splice(0).forEach((function(e){e.dispose()})))}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(o.prototype),"onUpdateDirty",this).call(this),this.updateRenderList()}},{key:"updateRenderList",value:function(){var e=this;if(this.mWaterMaterial){var t=this.getRenderer().getScene().meshes.filter((function(t){var n,r=null===(n=e.getRenderer().getEntityFromObject(t))||void 0===n?void 0:n.layers;return!r||!r.isEnabled(1)&&!r.isEnabled(2)&&!r.isEnabled(7)}));this.mWaterMaterial.reflectionTexture.renderList=t,this.mWaterMaterial.refractionTexture.renderList=t}}},{key:"createRenderObject",value:function(){var e=this.getRenderer().getScene(),t=new BABYLON.Mesh("water-group",e);t.renderingGroupId=this.mSceneEntity.renderOrder,t.isVisible=!0,t.metadata={scene_entity_id:this.mSceneEntity.id},this.mWaterMaterial=new BABYLON.WaterMaterial("water-material",e,new BABYLON.Vector2(1024,1024)),this.mWaterMaterial.backFaceCulling=!0,this.mWaterMaterial.bumpTexture=o.sTextures.textures[0],this.mWaterMaterial.windForce=-5,this.mWaterMaterial.waveHeight=.01,this.mWaterMaterial.bumpHeight=.5,this.mWaterMaterial.waveLength=.25,this.mWaterMaterial.colorBlendFactor=.05,this.mWaterMaterial.colorBlendFactor2=.05,this.mWaterMaterial.waterColor=new BABYLON.Color3(.1,.1,.6),this.mWaterMaterial.waterColor2=new BABYLON.Color3(.5,.5,.9),this.mWaterMaterial.windDirection=new BABYLON.Vector2(1,1),this.mWaterMaterial.specularColor=new BABYLON.Color3(0,0,0),this.mWaterMaterial.specularPower=64,this.mWaterMaterial.maxSimultaneousLights=12,this.mWaterMaterial.bumpAffectsReflection=!0,this.mWaterMaterial.fresnelSeparate=!1,this.mMaterials.push(this.mWaterMaterial),this.mWaterMaterial.reflectionTexture.clearColor=new BABYLON.Color4(.831,.945,.976),this.mWaterMaterial.refractionTexture.clearColor=new BABYLON.Color4(.831,.945,.976),this.mWaterMesh=BABYLON.MeshBuilder.CreateGround("water-mesh",{width:20,height:20,subdivisions:32,updatable:!1},e),this.mWaterMesh.renderingGroupId=this.mSceneEntity.renderOrder,this.mWaterMesh.isVisible=!0,this.mWaterMesh.material=this.mWaterMaterial,this.mWaterMesh.receiveShadows=this.mReceiveShadow,this.mWaterMesh.metadata={scene_entity_id:this.mSceneEntity.id},this.mWaterMesh.parent=t,this.mWaterMesh.render(this.mWaterMesh.subMeshes[0],!0,void 0),this.mFakeLight=new BABYLON.HemisphericLight("fake-water-light",new BABYLON.Vector3(0,-1,0),e),this.mFakeLight.diffuse.set(0,0,0),this.mFakeLight.groundColor.set(0,0,0),this.mFakeLight.specular.set(0,0,0),this.mFakeLight.intensity=0,this.mFakeLight.parent=t,this.mRenderObject=t,this.updateRenderList()}},{key:"disposeMaterials",value:function(){this.mMaterials.splice(0).forEach((function(e){e.dispose()})),delete this.mWaterMaterial}},{key:"dispose",value:function(){Ni((0,M.Z)(o.prototype),"dispose",this).call(this),this.disposeMaterials(),this.disposeTextures(),this.mFakeLight.dispose(),delete this.mWaterMesh}}]),o}(LM);function Ak(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Ek,"sTextures",{revision:0,textures:[]});var Ok=function(e){(0,g.Z)(a,e);var n,i=Ak(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mReceiveShadow",!1),(0,l.Z)((0,_.Z)(e),"mCastShadow",!1),(0,l.Z)((0,_.Z)(e),"mPointA",Bi.Left()),(0,l.Z)((0,_.Z)(e),"mPointB",Bi.Right()),(0,l.Z)((0,_.Z)(e),"mSpriteOffset",Bi.One()),(0,l.Z)((0,_.Z)(e),"mMarkerA",void 0),(0,l.Z)((0,_.Z)(e),"mMarkerB",void 0),(0,l.Z)((0,_.Z)(e),"mMarkerMaterial",void 0),(0,l.Z)((0,_.Z)(e),"mLineOptions",void 0),(0,l.Z)((0,_.Z)(e),"mLineMaterial",void 0),(0,l.Z)((0,_.Z)(e),"mLineMesh",void 0),(0,l.Z)((0,_.Z)(e),"mLineColor",so.Black()),(0,l.Z)((0,_.Z)(e),"mLabel",{title:"",color:so.Black(),fontSize:16,spriteScale:1}),(0,l.Z)((0,_.Z)(e),"mTextPlane",void 0),(0,l.Z)((0,_.Z)(e),"mTextGui",void 0),(0,l.Z)((0,_.Z)(e),"mTextTexture",void 0),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mCastShadow=e.castShadow,this.mReceiveShadow=e.receiveShadow,this.mPointA.copy(e.pointA),this.mPointB.copy(e.pointB),this.mRenderer.isRightHandedSystemActive()||(this.mPointA.toggleCoordSystem(),this.mPointB.toggleCoordSystem()),this.mSpriteOffset.copy(e.spriteOffset),this.mLineColor.copy(e.lineColor),this.mLabel.title=e.labelText,this.mLabel.color.copy(e.labelColor),this.mLabel.fontSize=e.labelFontSize,this.mLabel.spriteScale=e.labelSpriteScale}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.mMarkerA.receiveShadows=!1,this.mLineMesh.receiveShadows=!1,this.mMarkerA.metadata.cast_shadow=this.mCastShadow,this.mMarkerB.metadata.cast_shadow=this.mCastShadow,this.mLineMesh.metadata.cast_shadow=this.mCastShadow,this.mTextGui.text=this.mLabel.title,this.mTextGui.color=this.mLabel.color.getHexString();var e=this.getTextPosition();this.mTextPlane.position=new BABYLON.Vector3(e.x,e.y,e.z),this.updateLine(),this.computeTextTextureDimensions()}},{key:"getTextPosition",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.mPointA.clone().add(this.mPointB.clone().sub(this.mPointA).normalize().multiplyScalar(.5*this.mPointB.distanceTo(this.mPointA))).add(e?this.mSpriteOffset:new Bi)}},{key:"makeTextNode",value:function(e){this.mTextPlane=BABYLON.MeshBuilder.CreatePlane("primitive-line-text-plane",{size:1},this.getRenderer().getScene()),this.mTextPlane.renderingGroupId=this.mSceneEntity.renderOrder;var t=this.getTextPosition();this.mTextPlane.position=new BABYLON.Vector3(t.x,t.y,t.z),this.mTextPlane.parent=e,this.mTextTexture=BABYLON.GUI.AdvancedDynamicTexture.CreateForMesh(this.mTextPlane),this.mTextGui=new BABYLON.GUI.TextBlock("primitive-line-text-block"),this.mTextGui.text=this.mLabel.title,this.mTextGui.color=this.mLabel.color.getHexString(),this.mTextGui.fontSize=this.mLabel.fontSize,this.mTextGui.resizeToFit=!1,this.mTextGui.textHorizontalAlignment=BABYLON.GUI.TextBlock.HORIZONTAL_ALIGNMENT_CENTER,this.mTextGui.textVerticalAlignment=BABYLON.GUI.TextBlock.VERTICAL_ALIGNMENT_CENTER,this.mTextTexture.addControl(this.mTextGui),this.computeTextTextureDimensions()}},{key:"updateLine",value:function(){this.mMarkerA&&this.mMarkerB&&this.mLineMesh&&(this.mMarkerA.position.set(this.mPointA.x,this.mPointA.y,this.mPointA.z),this.mMarkerB.position.set(this.mPointB.x,this.mPointB.y,this.mPointB.z),this.mLineOptions.points=[new BABYLON.Vector3(this.mPointA.x,this.mPointA.y,this.mPointA.z),new BABYLON.Vector3(this.mPointB.x,this.mPointB.y,this.mPointB.z)],this.mLineOptions.colors=[new BABYLON.Color4(this.mLineColor.r,this.mLineColor.g,this.mLineColor.b,1),new BABYLON.Color4(this.mLineColor.r,this.mLineColor.g,this.mLineColor.b,1)],this.mLineOptions.instance=this.mLineMesh,BABYLON.LinesBuilder.CreateLines("$__xpv_line",this.mLineOptions,this.getRenderer().getScene()))}},{key:"computeTextTextureDimensions",value:function(){var e=this.mLabel.fontSize||16,t=[this.mLabel.title],n=0,r=.15,i=0;n*=e,r*=e,i*=e;var a,o=t.length,u=e+r,c=n+i/2,l=(o?((a=document.createElement("canvas").getContext("2d")).font="Arial, Helvetica, sans-serif",Math.max.apply(Math,s(t.map((function(e){return a.measureText(e).width}))))):0)+2*c,h=(o?e+u*(o-1):0)+2*c,f=l/h;this.mTextTexture.idealWidth=l*this.mLabel.spriteScale,this.mTextTexture.idealHeight=h,this.mTextPlane.scaling.set(f*this.mLabel.spriteScale*.3333,f*this.mLabel.spriteScale*.3333,f*this.mLabel.spriteScale*.3333)}},{key:"createLineMesh",value:function(e){this.mLineOptions={points:[new BABYLON.Vector3(this.mPointA.x,this.mPointA.y,this.mPointA.z),new BABYLON.Vector3(this.mPointB.x,this.mPointB.y,this.mPointB.z)],colors:[new BABYLON.Color4(this.mLineColor.r,this.mLineColor.g,this.mLineColor.b,1),new BABYLON.Color4(this.mLineColor.r,this.mLineColor.g,this.mLineColor.b,1)],updatable:!0},this.mLineMaterial=new BABYLON.StandardMaterial("lineMaterial",this.getRenderer().getScene()),this.mLineMaterial.diffuseColor.set(this.mLineColor.r,this.mLineColor.g,this.mLineColor.b),this.mLineMaterial.maxSimultaneousLights=12,this.mLineMaterial.backFaceCulling=!1,this.mLineMesh=BABYLON.MeshBuilder.CreateLines("$__xpv_line",this.mLineOptions,this.getRenderer().getScene()),this.mLineMesh.renderingGroupId=this.mSceneEntity.renderOrder,this.mLineMesh.metadata={},this.mLineMesh.material=this.mLineMaterial,this.mLineMesh.parent=e}},{key:"createMarkers",value:function(e){this.mMarkerMaterial=new BABYLON.StandardMaterial("markerMaterial",this.getRenderer().getScene()),this.mMarkerMaterial.maxSimultaneousLights=12,this.mMarkerMaterial.diffuseColor.set(this.mLineColor.r,this.mLineColor.g,this.mLineColor.b),this.mMarkerA=BABYLON.MeshBuilder.CreateSphere("$__xpv_line_marker_a",{segments:32,diameter:.006,updatable:!1,sideOrientation:BABYLON.Mesh.FRONTSIDE},this.getRenderer().getScene()),this.mMarkerA.renderingGroupId=this.mSceneEntity.renderOrder,this.mMarkerA.metadata={},this.mMarkerA.material=this.mMarkerMaterial,this.mMarkerA.position.set(this.mPointA.x,this.mPointA.y,this.mPointA.z),this.mMarkerA.parent=e,this.mMarkerB=this.mMarkerA.createInstance("$__xpv_line_marker_b"),this.mMarkerB.renderingGroupId=this.mSceneEntity.renderOrder,this.mMarkerB.metadata={},this.mMarkerB.position.set(this.mPointB.x,this.mPointB.y,this.mPointB.z),this.mMarkerB.parent=e}},{key:"createRenderObject",value:function(){var e=new BABYLON.TransformNode("line_group",this.getRenderer().getScene());this.createMarkers(e),this.createLineMesh(e),this.makeTextNode(e),this.mRenderObject=e}},{key:"update",value:function(e){Ni((0,M.Z)(a.prototype),"update",this).call(this,e);var t=this.mRenderer.getActiveCamera();this.mTextPlane.rotationQuaternion=t.absoluteRotation}},{key:"dispose",value:function(){this.mMarkerA.dispose(),this.mMarkerB.dispose(),this.mLineMesh.dispose(),this.mLineMaterial.dispose(),this.mMarkerMaterial.dispose(),this.mTextPlane.dispose(),this.mTextGui.dispose(),this.mTextTexture.dispose(),Ni((0,M.Z)(a.prototype),"dispose",this).call(this)}},{key:"updateBoundingBox",value:function(){var e=this.mMarkerA.getBoundingInfo().boundingBox,t=this.mMarkerB.getBoundingInfo().boundingBox,n=new ji;n.union(new ji(new Bi(e.minimum.x,e.minimum.y,e.minimum.z),new Bi(e.maximum.x,e.maximum.y,e.maximum.z))),n.union(new ji(new Bi(t.minimum.x,t.minimum.y,t.minimum.z),new Bi(t.maximum.x,t.maximum.y,t.maximum.z))),this.mBoundingBox.copy(n),Ni((0,M.Z)(a.prototype),"updateBoundingBox",this).call(this)}}]),a}(LM);function Dk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Pk=function(e){(0,g.Z)(a,e);var n,i=Dk(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mCastShadow",!1),(0,l.Z)((0,_.Z)(e),"mReceiveShadow",!1),(0,l.Z)((0,_.Z)(e),"mOnBeforeRenderObserver",void 0),(0,l.Z)((0,_.Z)(e),"mOnAfterRenderObserver",void 0),e}return(0,c.Z)(a,[{key:"getVisibilityAttachState",value:function(){return this.mRenderObject.isVisible}},{key:"setVisibilityAttachState",value:function(e){this.mRenderObject.isVisible=e}},{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mCastShadow=e.getValue("cast_shadow"),this.mReceiveShadow=e.getValue("receive_shadow"),this.mRenderObject&&(this.mRenderObject.renderingGroupId=e.renderOrder)}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.mRenderObject.receiveShadows=this.mReceiveShadow,this.mRenderObject.metadata||(this.mRenderObject.metadata={}),this.mRenderObject.metadata.cast_shadow=this.mCastShadow}},{key:"createRenderObject",value:function(){var e=this,t=this.getRenderer().getScene(),n=BABYLON.MeshBuilder.CreateBox("box",{size:1,updatable:!1,sideOrientation:BABYLON.Mesh.FRONTSIDE},t);n.renderingGroupId=this.mSceneEntity.renderOrder,this.mRenderer.isRightHandedSystemActive()&&n.toLeftHanded();var r=new BABYLON.SimpleMaterial("primitive-box-mat",t);r.diffuseColor=BABYLON.Color3.FromHexString("#F3F3F3"),r.maxSimultaneousLights=12,n.material=r,this.mOnBeforeRenderObserver=n.onBeforeRenderObservable.add((function(){e.getRenderer().onBeforeMeshRender(n,e.mSceneEntity)})),this.mOnAfterRenderObserver=n.onAfterRenderObservable.add((function(){e.getRenderer().onAfterMeshRender(n,e.mSceneEntity)})),this.mRenderObject=n}},{key:"updateBoundingBox",value:function(){var e=this.mRenderObject.getBoundingInfo(),t=[],n=[];e.boundingBox.minimum.toArray(t),e.boundingBox.maximum.toArray(n);var r=(new Bi).fromArray(t),i=(new Bi).fromArray(n);this.mBoundingBox.copy(new ji(r,i)),Ni((0,M.Z)(a.prototype),"updateBoundingBox",this).call(this)}},{key:"destroyRenderObject",value:function(){var e=this.mRenderObject;e&&(e.onBeforeRenderObservable.remove(this.mOnBeforeRenderObserver),e.onAfterRenderObservable.remove(this.mOnAfterRenderObserver)),Ni((0,M.Z)(a.prototype),"destroyRenderObject",this).call(this)}}]),a}(LM);function Bk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Fk=function(e){(0,g.Z)(a,e);var n,i=Bk(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mCastShadow",!1),(0,l.Z)((0,_.Z)(e),"mReceiveShadow",!1),(0,l.Z)((0,_.Z)(e),"mOnBeforeRenderObserver",void 0),(0,l.Z)((0,_.Z)(e),"mOnAfterRenderObserver",void 0),e}return(0,c.Z)(a,[{key:"getVisibilityAttachState",value:function(){return this.mRenderObject.isVisible}},{key:"setVisibilityAttachState",value:function(e){this.mRenderObject.isVisible=e}},{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mCastShadow=e.castShadow,this.mReceiveShadow=e.receiveShadow,this.mRenderObject&&(this.mRenderObject.renderingGroupId=e.renderOrder)}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.mRenderObject.receiveShadows=!1,this.mRenderObject.metadata||(this.mRenderObject.metadata={}),this.mRenderObject.metadata.cast_shadow=this.mCastShadow}},{key:"createRenderObject",value:function(){var e=this,t=this.getRenderer().getScene(),n=BABYLON.MeshBuilder.CreatePlane("plane",{size:2,updatable:!1,sideOrientation:BABYLON.Mesh.FRONTSIDE},t);n.renderingGroupId=this.mSceneEntity.renderOrder,this.mRenderer.isRightHandedSystemActive()&&n.toLeftHanded();var r=new BABYLON.SimpleMaterial("primitive-plane-mat",t);r.diffuseColor=BABYLON.Color3.FromHexString("#F3F3F3"),r.maxSimultaneousLights=12,n.material=r,this.mOnBeforeRenderObserver=n.onBeforeRenderObservable.add((function(){e.getRenderer().onBeforeMeshRender(n,e.mSceneEntity)})),this.mOnAfterRenderObserver=n.onAfterRenderObservable.add((function(){e.getRenderer().onAfterMeshRender(n,e.mSceneEntity)})),this.mRenderObject=n}},{key:"updateBoundingBox",value:function(){var e=this.mRenderObject.getBoundingInfo(),t=[],n=[];e.boundingBox.minimum.toArray(t),e.boundingBox.maximum.toArray(n);var r=(new Bi).fromArray(t),i=(new Bi).fromArray(n);this.mBoundingBox.copy(new ji(r,i)),Ni((0,M.Z)(a.prototype),"updateBoundingBox",this).call(this)}},{key:"destroyRenderObject",value:function(){var e=this.mRenderObject;e&&(e.onBeforeRenderObservable.remove(this.mOnBeforeRenderObserver),e.onAfterRenderObservable.remove(this.mOnAfterRenderObserver)),Ni((0,M.Z)(a.prototype),"destroyRenderObject",this).call(this)}}]),a}(LM);function Lk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Nk=function(e){(0,g.Z)(a,e);var n,i=Lk(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mCastShadow",!1),(0,l.Z)((0,_.Z)(e),"mReceiveShadow",!1),(0,l.Z)((0,_.Z)(e),"mOnBeforeRenderObserver",void 0),(0,l.Z)((0,_.Z)(e),"mOnAfterRenderObserver",void 0),e}return(0,c.Z)(a,[{key:"getVisibilityAttachState",value:function(){return this.mRenderObject.isVisible}},{key:"setVisibilityAttachState",value:function(e){this.mRenderObject.isVisible=e}},{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mCastShadow=e.castShadow,this.mReceiveShadow=e.receiveShadow,this.mRenderObject&&(this.mRenderObject.renderingGroupId=e.renderOrder)}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.mRenderObject.receiveShadows=!1,this.mRenderObject.metadata||(this.mRenderObject.metadata={}),this.mRenderObject.metadata.cast_shadow=this.mCastShadow}},{key:"createRenderObject",value:function(){var e=this,t=this.getRenderer().getScene(),n=BABYLON.MeshBuilder.CreateSphere("sphere",{segments:64,diameter:1,updatable:!1,sideOrientation:BABYLON.Mesh.FRONTSIDE},t);n.renderingGroupId=this.mSceneEntity.renderOrder,this.mRenderer.isRightHandedSystemActive()&&n.toLeftHanded();var r=new BABYLON.SimpleMaterial("primitive-sphere-mat",t);r.diffuseColor=BABYLON.Color3.FromHexString("#F3F3F3"),r.maxSimultaneousLights=12,n.material=r,this.mOnBeforeRenderObserver=n.onBeforeRenderObservable.add((function(){e.getRenderer().onBeforeMeshRender(n,e.mSceneEntity)})),this.mOnAfterRenderObserver=n.onAfterRenderObservable.add((function(){e.getRenderer().onAfterMeshRender(n,e.mSceneEntity)})),this.mRenderObject=n}},{key:"updateBoundingBox",value:function(){var e=this.mRenderObject.getBoundingInfo(),t=[],n=[];e.boundingBox.minimum.toArray(t),e.boundingBox.maximum.toArray(n);var r=(new Bi).fromArray(t),i=(new Bi).fromArray(n);this.mBoundingBox.copy(new ji(r,i)),Ni((0,M.Z)(a.prototype),"updateBoundingBox",this).call(this)}},{key:"destroyRenderObject",value:function(){var e=this.mRenderObject;e&&(e.onBeforeRenderObservable.remove(this.mOnBeforeRenderObserver),e.onAfterRenderObservable.remove(this.mOnAfterRenderObserver)),Ni((0,M.Z)(a.prototype),"destroyRenderObject",this).call(this)}}]),a}(LM);function jk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var zk=function(e){(0,g.Z)(a,e);var n,i=jk(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mColor",so.White()),(0,l.Z)((0,_.Z)(e),"mIntensity",1),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mColor.copy(e.color),this.mIntensity=e.intensity}},{key:"applyProperties",value:function(){this.mRenderObject&&(this.mRenderObject.diffuse.set(this.mColor.r,this.mColor.g,this.mColor.b),this.mRenderObject.groundColor.set(this.mColor.r,this.mColor.g,this.mColor.b),this.mRenderObject.intensity=this.mIntensity,this.mRenderObject.falloffType=BABYLON.Light.FALLOFF_DEFAULT,this.mRenderObject.intensityMode=BABYLON.Light.INTENSITYMODE_AUTOMATIC,this.mRenderObject.lightmapMode=BABYLON.Light.LIGHTMAP_DEFAULT)}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.applyProperties()}},{key:"createRenderObject",value:function(){var e=new BABYLON.HemisphericLight("AmbientLight",new BABYLON.Vector3(0,1,0),this.getRenderer().getScene());this.mRenderObject=e,this.applyProperties()}}]),a}(LM);function Uk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Vk=function(e){(0,g.Z)(a,e);var n,i=Uk(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mCastShadow",!1),(0,l.Z)((0,_.Z)(e),"mShadowGenerator",void 0),(0,l.Z)((0,_.Z)(e),"mShadowBias",0),(0,l.Z)((0,_.Z)(e),"mShadowCameraNear",1e-4),(0,l.Z)((0,_.Z)(e),"mShadowCameraFar",1e3),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){this.mCastShadow=this.mSceneEntity.getValue("cast_shadow"),this.mShadowBias=this.mSceneEntity.getValue("shadow_bias"),this.mShadowCameraNear=this.mSceneEntity.getValue("shadow_camera_near"),this.mShadowCameraFar=this.mSceneEntity.getValue("shadow_camera_far")}},{key:"update",value:function(e){Ni((0,M.Z)(a.prototype),"update",this).call(this,e),this.updateShadowMap()}},{key:"applyProperties",value:function(){this.mShadowGenerator&&(this.mShadowGenerator.bias=this.mShadowBias,this.mRenderObject&&(this.mRenderObject.shadowMinZ=this.mShadowCameraNear,this.mRenderObject.shadowMaxZ=this.mShadowCameraFar))}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.applyProperties()}},{key:"updateShadowMap",value:function(){var e=this;if(this.mCastShadow){if(this.mCastShadow&&!this.mShadowGenerator&&this.createShadowGenerator(this.mRenderObject),this.mShadowGenerator){var t=y.F.uuidV4();this.getRenderer().getScene().meshes.forEach((function(n){n.metadata&&(n.metadata.shadow_render_loop_id=t,e.mShadowGenerator.getShadowMap().renderList.find((function(e){return e.uniqueId===n.uniqueId}))?n.metadata.cast_shadow||(e.resetRefreshCounter(),e.mShadowGenerator.removeShadowCaster(n,!0)):n.metadata.cast_shadow&&(e.resetRefreshCounter(),e.mShadowGenerator.addShadowCaster(n,!0)))})),this.mShadowGenerator.getShadowMap().renderList.forEach((function(n){n.metadata.shadow_render_loop_id!==t&&(e.resetRefreshCounter(),e.mShadowGenerator.removeShadowCaster(n,!0))}))}}else this.destroyShadowGenerator()}},{key:"resetRefreshCounter",value:function(){this.mShadowGenerator&&this.mShadowGenerator.getShadowMap().resetRefreshCounter()}},{key:"createShadowGenerator",value:function(e){this.mCastShadow&&!this.mShadowGenerator&&(this.mShadowGenerator=this.getRenderer().createShadowGenerator(1024,e))}},{key:"destroyShadowGenerator",value:function(){this.mShadowGenerator&&(this.getRenderer().disposeShadowGenerator(this.mShadowGenerator),delete this.mShadowGenerator)}},{key:"createRenderObject",value:function(){this.mRenderObject?this.createShadowGenerator(this.mRenderObject):qe.qL.error("Shadow draw technique created before mRenderObject is set.")}},{key:"destroyRenderObject",value:function(){this.destroyShadowGenerator(),Ni((0,M.Z)(a.prototype),"destroyRenderObject",this).call(this)}}]),a}(LM);function Hk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Gk=function(e){(0,g.Z)(a,e);var n,i=Hk(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mColor",so.White()),(0,l.Z)((0,_.Z)(e),"mTarget",Bi.Zero()),(0,l.Z)((0,_.Z)(e),"mIntensity",1),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ni((0,M.Z)(a.prototype),"loadResource",this).call(this);case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){Ni((0,M.Z)(a.prototype),"updateProperties",this).call(this);var e=this.mSceneEntity;this.mColor.copy(e.color),this.mTarget.copy(e.target),this.mIntensity=e.intensity}},{key:"applyProperties",value:function(){if(Ni((0,M.Z)(a.prototype),"applyProperties",this).call(this),this.mRenderObject){var e=this.mSceneEntity.transform.position.clone(),t=this.mTarget.clone();this.mRenderer.isRightHandedSystemActive()||(e.toggleCoordSystem(),t.toggleCoordSystem()),this.mRenderObject.position.set(e.x,e.y,e.z),this.mRenderObject.intensity=this.mIntensity,this.mRenderObject.diffuse.set(this.mColor.r,this.mColor.g,this.mColor.b),this.mRenderObject.setDirectionToTarget(new BABYLON.Vector3(t.x,t.y,t.z)),this.mRenderObject.autoCalcShadowZBounds=!0,this.mRenderObject.autoUpdateExtends=!0,this.mRenderObject.falloffType=BABYLON.Light.FALLOFF_DEFAULT,this.mRenderObject.intensityMode=BABYLON.Light.INTENSITYMODE_AUTOMATIC,this.mRenderObject.lightmapMode=BABYLON.Light.LIGHTMAP_DEFAULT}}},{key:"createRenderObject",value:function(){var e=new BABYLON.DirectionalLight("DirectionalLight",new BABYLON.Vector3(0,0,0),this.getRenderer().getScene());this.mRenderObject=e,Ni((0,M.Z)(a.prototype),"createRenderObject",this).call(this),this.applyProperties()}}]),a}(Vk);function qk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Wk=function(e){(0,g.Z)(a,e);var n,i=qk(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mColor",so.White()),(0,l.Z)((0,_.Z)(e),"mGroundColor",so.White()),(0,l.Z)((0,_.Z)(e),"mIntensity",1),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mColor.copy(e.color),this.mGroundColor.copy(e.groundColor),this.mIntensity=e.intensity}},{key:"applyProperties",value:function(){this.mRenderObject&&(this.mRenderObject.diffuse.set(this.mColor.r,this.mColor.g,this.mColor.b),this.mRenderObject.groundColor.set(this.mGroundColor.r,this.mGroundColor.g,this.mGroundColor.b),this.mRenderObject.specular.set(0,0,0),this.mRenderObject.intensity=this.mIntensity,this.mRenderObject.direction.set(0,1,0),this.mRenderObject.falloffType=BABYLON.Light.FALLOFF_DEFAULT,this.mRenderObject.intensityMode=BABYLON.Light.INTENSITYMODE_AUTOMATIC,this.mRenderObject.lightmapMode=BABYLON.Light.LIGHTMAP_DEFAULT)}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.applyProperties()}},{key:"createRenderObject",value:function(){var e=new BABYLON.HemisphericLight("HemisphereLight",new BABYLON.Vector3(0,0,0),this.getRenderer().getScene());this.mRenderObject=e,this.applyProperties()}}]),a}(LM);function Yk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Kk=function(e){(0,g.Z)(a,e);var n,i=Yk(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mColor",so.White()),(0,l.Z)((0,_.Z)(e),"mDistance",0),(0,l.Z)((0,_.Z)(e),"mDecay",1),(0,l.Z)((0,_.Z)(e),"mIntensity",1),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ni((0,M.Z)(a.prototype),"loadResource",this).call(this);case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){Ni((0,M.Z)(a.prototype),"updateProperties",this).call(this);var e=this.mSceneEntity;this.mColor.copy(e.color),this.mDistance=e.distance,this.mDecay=e.decay,this.mIntensity=e.intensity}},{key:"applyProperties",value:function(){if(Ni((0,M.Z)(a.prototype),"applyProperties",this).call(this),this.mRenderObject){var e=this.mSceneEntity.transform.position.clone();this.mRenderer.isRightHandedSystemActive()||e.toggleCoordSystem(),this.mRenderObject.position.set(e.x,e.y,e.z),this.mRenderObject.intensity=this.mIntensity,this.mRenderObject.diffuse.set(this.mColor.r,this.mColor.g,this.mColor.b),this.mRenderObject.range=this.mDistance<=0?1/0:this.mDistance,this.mRenderObject.falloffType=BABYLON.Light.FALLOFF_DEFAULT,this.mRenderObject.intensityMode=BABYLON.Light.INTENSITYMODE_AUTOMATIC,this.mRenderObject.lightmapMode=BABYLON.Light.LIGHTMAP_DEFAULT}}},{key:"createRenderObject",value:function(){var e=new BABYLON.PointLight("PointLight",new BABYLON.Vector3(1,10,1),this.getRenderer().getScene());this.mRenderObject=e,Ni((0,M.Z)(a.prototype),"createRenderObject",this).call(this),this.applyProperties()}}]),a}(Vk);function Xk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var $k=function(e){(0,g.Z)(a,e);var n,i=Xk(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mColor",so.White()),(0,l.Z)((0,_.Z)(e),"mTarget",Bi.Zero()),(0,l.Z)((0,_.Z)(e),"mDistance",0),(0,l.Z)((0,_.Z)(e),"mAngle",.1*Math.PI),(0,l.Z)((0,_.Z)(e),"mPenumbra",0),(0,l.Z)((0,_.Z)(e),"mDecay",1),(0,l.Z)((0,_.Z)(e),"mIntensity",1),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ni((0,M.Z)(a.prototype),"loadResource",this).call(this);case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){Ni((0,M.Z)(a.prototype),"updateProperties",this).call(this);var e=this.mSceneEntity;this.mColor.copy(e.color),this.mTarget.copy(e.target),this.mDistance=e.distance,this.mDecay=e.decay,this.mAngle=e.angle,this.mPenumbra=e.penumbra,this.mIntensity=e.intensity}},{key:"applyProperties",value:function(){if(Ni((0,M.Z)(a.prototype),"applyProperties",this).call(this),this.mRenderObject){var e=this.mSceneEntity.transform.position.clone();this.mRenderer.isRightHandedSystemActive()||e.toggleCoordSystem(),this.mRenderObject.position.set(e.x,e.y,e.z),this.mRenderObject.intensity=this.mIntensity,this.mRenderObject.diffuse.set(this.mColor.r,this.mColor.g,this.mColor.b),this.mRenderObject.range=this.mDistance<=0?Number.MAX_VALUE:this.mDistance,this.mRenderObject.angle=2*this.mAngle,this.mRenderObject.setDirectionToTarget(new BABYLON.Vector3(this.mTarget.x,this.mTarget.y,this.mTarget.z)),this.mRenderObject.falloffType=BABYLON.Light.FALLOFF_DEFAULT,this.mRenderObject.intensityMode=BABYLON.Light.INTENSITYMODE_AUTOMATIC,this.mRenderObject.lightmapMode=BABYLON.Light.LIGHTMAP_DEFAULT}}},{key:"createRenderObject",value:function(){var e=new BABYLON.SpotLight("SpotLight",new BABYLON.Vector3(0,0,0),new BABYLON.Vector3(0,-1,0),this.mAngle,0,this.getRenderer().getScene());this.mRenderObject=e,Ni((0,M.Z)(a.prototype),"createRenderObject",this).call(this),this.applyProperties()}}]),a}(Vk);function Qk(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Jk=function(e){(0,g.Z)(n,e);var t=Qk(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"onEdit",new Ht),(0,l.Z)((0,_.Z)(i),"userData",{}),(0,l.Z)((0,_.Z)(i),"uiRenderer",void 0),(0,l.Z)((0,_.Z)(i),"domElement",void 0),(0,l.Z)((0,_.Z)(i),"mPositionType",ev.FIXED),(0,l.Z)((0,_.Z)(i),"mPosition",new Bi),(0,l.Z)((0,_.Z)(i),"mLocked",!1),(0,l.Z)((0,_.Z)(i),"mEditting",!1),(0,l.Z)((0,_.Z)(i),"mVisible",!0),(0,l.Z)((0,_.Z)(i),"mSceneObject",void 0),(0,l.Z)((0,_.Z)(i),"mSubscriptions",[]),i.uiRenderer=r,i.mSceneObject=e,i.domElement=document.createElement("div"),i.domElement.style.position="absolute",i.domElement.style.top="0px",i.domElement.style.left="0px",i.domElement.addEventListener("click",(function(){i.uiRenderer.onUiSelected.next(i.getSceneObject())}),!1),i.mSubscriptions.push(i.onEdit.subscribe((function(e){i.getSceneObject().onEdit.next(e)}))),i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"dispose",value:function(){this.domElement.parentNode&&this.domElement.parentNode.removeChild(this.domElement),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()}))}},{key:"getSceneObject",value:function(){return this.mSceneObject}},{key:"isObjectUI",get:function(){return!0}},{key:"update",value:function(e){var t=this.uiRenderer.getSize();if("projection"===this.mPositionType){var n=this.mPosition.clone(),r=e.transform.matrixWorld.clone().invert(),i=n.project(r,e.getProjectionMatrix());i.x=(i.x+1)/2*t.width,i.y=-(i.y-1)/2*t.height,i.x=i.x>t.width?t.width:i.x<0?0:i.x,i.y=i.y>t.height?t.height:i.y<0?0:i.y,this.domElement.style.left="".concat(i.x,"px"),this.domElement.style.top="".concat(i.y,"px")}}},{key:"setValue",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.proxySetValue(e,t,n);return r&&this.updateElement(),r}},{key:"getValue",value:function(e){return this.proxyGetValue(e)}},{key:"proxyGetValue",value:function(e){switch(e){case"position_type":return this.positionType;case"position":return this.position;case"locked":return this.locked}}},{key:"proxySetValue",value:function(e,t,n){switch(e){case"position_type":return this.positionType=t,!0;case"position":return this.position=t,!0;case"locked":return this.locked=t,!0}return!1}},{key:"position",get:function(){return this.mPosition},set:function(e){var t=e.toArray();this.mPosition.x=t[0],this.mPosition.y=t[1],t.length>2&&(this.mPosition.z=t[2]),this.domElement.style.top="".concat(this.mPosition.y,"px"),this.domElement.style.left="".concat(this.mPosition.x,"px")}},{key:"positionType",get:function(){return this.mPositionType},set:function(e){this.mPositionType=e}},{key:"element",get:function(){return this.domElement}},{key:"locked",get:function(){return this.mLocked},set:function(e){var t=this.mLocked;this.mLocked=e,t&&!e?this.makeEditable():!t&&e&&this.makeUnEditable()}},{key:"add",value:function(e){this.element.appendChild(e)}},{key:"remove",value:function(e){this.element.removeChild(e)}},{key:"hasParent",value:function(){return!!this.domElement.parentNode}},{key:"makeEditable",value:function(){var e=this;if(!this.hasParent())return!1;if(this.mEditting=!0,this.locked)return!1;if("undefined"!=typeof $){var t=$(this.domElement);void 0===t.draggable("instance")&&t.draggable({start:function(t,n){e.mPositionType!==ev.PROJECTION&&e.onEdit.next({type:"drag",event:"start",data:n.position})},stop:function(t,n){e.mPositionType!==ev.PROJECTION&&e.onEdit.next({type:"drag",event:"stop",data:n.position})},drag:function(t,n){e.mPositionType!==ev.PROJECTION&&e.onEdit.next({type:"drag",event:"update",data:n.position})}})}var n=this.domElement.querySelector("#highlight_selected");return n||((n=document.createElement("div")).id="highlight_selected",n.style.width="100%",n.style.height="100%",n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.border="2px solid yellow",this.domElement.appendChild(n)),!0}},{key:"makeUnEditable",value:function(){if(this.mEditting=!1,this.hasParent()){if("undefined"!=typeof $){var e=$(this.domElement);void 0!==e.draggable("instance")&&e.draggable("destroy")}var t=this.domElement.querySelector("#highlight_selected");t&&t.remove()}}},{key:"visible",get:function(){return this.mVisible},set:function(e){this.mVisible=e,!this.mVisible&&this.mEditting&&this.makeUnEditable(),this.domElement.style.display=this.mVisible?"inline-block":"none"}}]),n}(ze.L);function e_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Jk,"TypeRTTI",new k.r("UixObject",ze.L.TypeRTTI));var t_=function(e){(0,g.Z)(n,e);var t=e_(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"onEvents",new Ht),(0,l.Z)((0,_.Z)(i),"mTextElement",void 0),(0,l.Z)((0,_.Z)(i),"mTagElement",void 0),(0,l.Z)((0,_.Z)(i),"mOverlayElement",void 0),(0,l.Z)((0,_.Z)(i),"mTitle","A1"),(0,l.Z)((0,_.Z)(i),"mColor",new so("#1f1e1e")),(0,l.Z)((0,_.Z)(i),"mHoverColor",new so("#343232")),(0,l.Z)((0,_.Z)(i),"mTextColor",so.White()),(0,l.Z)((0,_.Z)(i),"mMargin",2),(0,l.Z)((0,_.Z)(i),"mFontSize",10),(0,l.Z)((0,_.Z)(i),"mHtmlText",""),(0,l.Z)((0,_.Z)(i),"mPositionIteration",0),(0,l.Z)((0,_.Z)(i),"mVisibilityHandle",void 0),(0,l.Z)((0,_.Z)(i),"mPresenting",!1),(0,l.Z)((0,_.Z)(i),"mTagVisibilityOwners",{}),(0,l.Z)((0,_.Z)(i),"OVERLAY_TIMEOUT",300),a.title&&(i.mTitle=a.title),a.margin&&(i.mMargin=a.margin),a.color&&i.mColor.set(a.color),a.hover&&i.mHoverColor.set(a.hover),a.fontSize&&(i.mFontSize=a.fontSize),a.textColor&&i.mTextColor.set(a.textColor),a.htmlText&&(i.mHtmlText=a.htmlText),i._createTag(),i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(e){case"title":return this.mTitle=t,!0;case"color":return this.mColor.set(t),!0;case"hover":return this.mHoverColor.set(t),!0;case"textColor":return this.mTextColor.set(t),!0;case"fontSize":return this.mFontSize=parseInt(t,10),!0;case"margin":return this.mMargin=t,!0;case"htmlText":return this.setHtmlText(t),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){switch(e){case"title":return this.mTitle;case"color":return this.mColor.getHexString();case"hover":return this.mHoverColor.getHexString();case"textColor":return this.mTextColor.getHexString();case"fontSize":return this.mFontSize;case"margin":return this.mMargin;case"htmlText":return this.mHtmlText}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}},{key:"update",value:function(e){if(this.mPresenting||Ni((0,M.Z)(n.prototype),"update",this).call(this,e),"projection"===this.mPositionType){var t=this.mPosition.clone(),r=e.transform.matrixWorld.clone().invert(),i=t.project(r,e.getProjectionMatrix());this.updateScale(e,this.mPosition),this.hideOutOfScreen(e,i),this.updateOverlay()}}},{key:"updateScale",value:function(e,t){var n=new Bi;e.transform.getWorldPosition(n);var r=t.distanceTo(n);r=Math.max(r,.001),r=Math.pow(r,1.25);var i=e.far-e.near,a=Math.min(Math.max(i/r,.25),1);this.mTagElement.style.transform="scale(".concat(a,")")}},{key:"hideOutOfScreen",value:function(e,t){var n=this.uiRenderer.getSize(),r=t.clone();r.x=(r.x+1)/2*n.width,r.y=-(r.y-1)/2*n.height,this.mTagElement.style.visibility=r.x>n.width||r.x<0||r.y>n.height||r.y<0?"hidden":"visible"}},{key:"updateOverlay",value:function(){this.mOverlayElement&&(this.mOverlayElement.style.transform="translate(-".concat(this.domElement.style.left,"px, -").concat(this.domElement.style.top,")"))}},{key:"fadeInOut",value:function(){var e=this;window.clearTimeout(this.mVisibilityHandle),this.mVisibilityHandle=window.setTimeout((function(){e.showTag("movement"),e.mPositionIteration=0,delete e.mVisibilityHandle}),100)}},{key:"hideWhenInMovement",value:function(){this.isInSceneEditor()||(this.mPositionIteration++>50&&this.hideTag("movement"),this.fadeInOut())}},{key:"showTag",value:function(e){delete this.mTagVisibilityOwners[e],0===Object.keys(this.mTagVisibilityOwners).length&&(this.mTagElement.style.display="flex")}},{key:"hideTag",value:function(e){this.mTagVisibilityOwners[e]=!0,this.mTagElement.style.display="none"}},{key:"setHtmlText",value:function(e){this.mHtmlText=e,this.mOverlayElement&&(this.mOverlayElement.querySelector(".xpv-annotation-html").innerHTML=this.mHtmlText)}},{key:"_createTag",value:function(){var e=this;this.mTextElement=document.createElement("div"),this.mTextElement.setAttribute("data-ui-type","annotation-tag-title"),this.mTextElement.textContent=this.mTitle,this.mTextElement.style.cssText="\n            font-size: ".concat(this.mFontSize,"px;\n            position: absolute;\n            top: 0px;\n            left: 0px;\n            visibility: hidden;\n            display: block;\n            transform-origin: top left;\n        "),document.body.appendChild(this.mTextElement);var t=this.mTextElement.offsetHeight+1,n=this.mTextElement.offsetWidth+1+t+this.mMargin,r="".concat(n,"px");document.body.removeChild(this.mTextElement),this.mTextElement.style.position="relative",this.mTextElement.style.visibility="",this.mTextElement.style.display="",this.mTagElement=document.createElement("div"),this.mTagElement.setAttribute("data-ui-type","annotation-tag"),this.mTagElement.setAttribute("data-annotation-uuid",this.mSceneObject.uuid),this.mTagElement.style.cssText="\n            position: relative;\n            top: 0px;\n            left: 0px;\n            width: ".concat(r,";\n            height: ").concat(r,";\n            background-color: ").concat(this.mColor.getHexString(),";\n            color: ").concat(this.mTextColor.getHexString(),";\n            border-radius: 50%;\n            border: 3px solid white;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            transform-origin: left top;\n            -ms-user-select: none;\n            -moz-user-select: none;\n            -webkit-user-select: none;\n            user-select: none;\n        "),this.mTagElement.appendChild(this.mTextElement),this.mTagElement.addEventListener("mouseover",(function(){e.mTagElement.style.backgroundColor=e.mHoverColor.getHexString()})),this.mTagElement.addEventListener("mouseout",(function(){e.mTagElement.style.backgroundColor=e.mColor.getHexString()})),this.mTagElement.addEventListener("click",(function(){qe.qL.print("Annotation '".concat(e.mTitle,"' clicked!"),e.getObjectId()),e.showOverlay(),e.onEvents.next({name:"click",data:e.getObjectId()})})),this.domElement.appendChild(this.mTagElement)}},{key:"showOverlay",value:function(){var e=this;this.mPresenting||this.mEditting||this.isInSceneEditor()||(this.mPresenting=!0,this.hideTag("overlay"),window.setTimeout((function(){e.createTextOverlay()}),this.OVERLAY_TIMEOUT))}},{key:"hideOverlay",value:function(){this.mPresenting=!1,this.showTag("overlay"),this.mOverlayElement.parentNode.removeChild(this.mOverlayElement),delete this.mOverlayElement}},{key:"isInSceneEditor",value:function(){return P.stateRegistery().get(Ci.SCENE_EDITOR)}},{key:"createTextOverlay",value:function(){var e=this;this.mOverlayElement=document.createElement("div"),this.mOverlayElement.setAttribute("data-ui-type","annotation-text-overlay");var t=this.uiRenderer.getSize();this.mOverlayElement.style.cssText="\n            top: 0;\n            left: 0;\n            position: absolute;\n            width: ".concat(t.width,"px;\n            height: ").concat(t.height,"px;\n            background: linear-gradient(0deg, rgba(255, 255, 255, 0.44) 0%, rgba(199, 209, 225, 0.55) 40%, rgba(15, 35, 39, 0.64) 100%);\n            display: block;\n            padding: 1rem;\n            overflow-y: auto;\n            color: #ffffff;\n            font-size: 2rem;\n            transform: translate(-").concat(this.domElement.style.left,", -").concat(this.domElement.style.top,");\n            z-index: 2;\n        ");var n=document.createElement("div");n.classList.add("xpv-annotation-html"),n.style.cssText="\n            border-left: 2px solid white;\n            padding: 0.5rem;\n        ",n.innerHTML=this.mHtmlText,this.mOverlayElement.appendChild(n);var r=document.createElement("div");r.style.cssText="\n            margin: 1rem 0;\n            font-weight: bold;\n            font-size: large;\n            cursor: pointer;\n            display: inline-block;\n        ",r.innerHTML='\n            Back\n            <br/>\n            <span style="font-size: 32px;line-height: 18px;margin-left: -1px;">\n                &#129044;\n            </span>\n        ',r.onclick=function(){e.hideOverlay(),e.onEvents.next({name:"back",data:e.getObjectId()})},this.mOverlayElement.appendChild(r),this.domElement.appendChild(this.mOverlayElement)}},{key:"updateElement",value:function(){if(this.mTextElement&&this.mTagElement){this.mTextElement.style.fontSize="".concat(this.mFontSize,"px"),this.mTextElement.textContent=this.mTitle;var e=this.mTextElement.clientHeight+1,t=this.mTextElement.clientWidth+1+e+this.mMargin,n="".concat(t,"px");this.mTagElement.style.backgroundColor=this.mColor.getHexString(),this.mTagElement.style.color=this.mTextColor.getHexString(),this.mTagElement.style.width=n,this.mTagElement.style.height=n}}}]),n}(Jk);function n_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(t_,"TypeRTTI",new k.r("AnnotationUixObject",Jk.TypeRTTI));var r_=function(e){(0,g.Z)(n,e);var t=n_(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mRenderObject",void 0),(0,l.Z)((0,_.Z)(e),"mEditable",!1),(0,l.Z)((0,_.Z)(e),"mLocked",!1),e}return(0,c.Z)(n,[{key:"ready",get:function(){return this.mReady}},{key:"attached",get:function(){return this.mAttached}},{key:"attach",value:function(){if(!this.mRenderObject)throw new Error("Trying to attach undefined object to scene");var e=this.mRenderer.getUiRenderer(),t=this.mRenderObject;e.add(t.element),this.mAttached=!0}},{key:"detach",value:function(){if(this.mAttached){var e=this.mRenderer.getUiRenderer(),t=this.mRenderObject;e.remove(t.element),this.mAttached=!1}}},{key:"getRenderObject",value:function(){return this.mRenderObject}},{key:"update",value:function(){if(this.mRenderObject){this.mSceneEntity.needsRenderUpdate()&&(this.mSceneEntity.setNeedsRenderUpdate(!1),this.onUpdateDirty());var e=P.sceneManager().getActiveCamera();this.mRenderObject.update(e)}}},{key:"onUpdateDirty",value:function(){if(this.mRenderObject){this.mRenderObject.visible=this.mSceneEntity.getVisibility();var e=this.mSceneEntity.editable;e!==this.mEditable&&(this.mEditable=e,this.onEditable(this.mEditable));var t=this.mSceneEntity.locked;t!==this.mLocked&&(this.mLocked=t,this.onLocked(this.mLocked))}}},{key:"destroyRenderObject",value:function(){}},{key:"onEditable",value:function(e){e?this.mRenderObject.makeEditable():this.mRenderObject.makeUnEditable()}},{key:"onLocked",value:function(e){this.mRenderObject.locked=e}},{key:"getSceneEntity",value:function(){return this.mSceneEntity}}]),n}(BM);function i_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var a_=function(e){(0,g.Z)(a,e);var n,i=i_(a);function a(e,t){var n;return(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mPositionType",ev.FIXED),(0,l.Z)((0,_.Z)(n),"mPosition",new Bi),(0,l.Z)((0,_.Z)(n),"mOptions",{}),(0,l.Z)((0,_.Z)(n),"mViewportPosition",new Bi),(0,l.Z)((0,_.Z)(n),"mViewportRotation",new Li),(0,l.Z)((0,_.Z)(n),"mSubscriptions",[]),(0,l.Z)((0,_.Z)(n),"mPreviousCamera",void 0),n.mPreviousCamera=new zi,n}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mPositionType=e.getValue("position_type"),this.mOptions=e.getValue("options"),this.mPosition.copy(e.getValue("position")),this.mViewportPosition.copy(e.getValue("viewport_position")),this.mViewportRotation.copy(e.getValue("viewport_rotation"))}},{key:"applyProperties",value:function(){if(this.mRenderObject){this.mRenderObject.positionType=this.mPositionType,this.mRenderObject.position=this.mPosition.clone();for(var e=0,t=Object.entries(this.mOptions);e<t.length;e++){var n=o(t[e],2),r=n[0],i=n[1];this.mRenderObject.setValue(r,i)}}}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.applyProperties()}},{key:"createRenderObject",value:function(){var e=this.mRenderer.getUiRenderer(),t=new t_(this.mSceneEntity,e,this.mOptions);t.locked=this.mLocked,this.mSubscriptions.push(t.onEvents.subscribe(this.uiEvent.bind(this))),this.mRenderObject=t,this.applyProperties()}},{key:"uiEvent",value:function(e){switch(e.name){case"click":this.moveToViewport();break;case"back":this.returnToPreviousCamera()}}},{key:"moveToViewport",value:function(){var e=P.sceneManager().getActiveCamera();this.mPreviousCamera.position.copy(e.transform.position),this.mPreviousCamera.quaternion.copy(e.transform.quaternion),P.messenger().send(new X(this.mViewportPosition.clone(),new Bi(this.mViewportRotation.x,this.mViewportRotation.y,this.mViewportRotation.z),W.PUSH_CONTROLLER))}},{key:"returnToPreviousCamera",value:function(){P.messenger().send(new X(this.mPreviousCamera.position,new Bi(this.mPreviousCamera.rotation.x,this.mPreviousCamera.rotation.y,this.mPreviousCamera.rotation.z),W.POP_CONTROLLER))}}]),a}(r_);function o_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var s_=function(e){(0,g.Z)(n,e);var t=o_(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"onEvents",new Ht),(0,l.Z)((0,_.Z)(i),"mBtnElment",void 0),(0,l.Z)((0,_.Z)(i),"mTitle",""),(0,l.Z)((0,_.Z)(i),"mColor",new so("#f06")),(0,l.Z)((0,_.Z)(i),"mHoverColor",new so("#ca095e")),(0,l.Z)((0,_.Z)(i),"mTextColor",so.Black()),(0,l.Z)((0,_.Z)(i),"mMargin",5),(0,l.Z)((0,_.Z)(i),"mFontSize",16),a.title&&(i.mTitle=a.title),a.margin&&(i.mMargin=a.margin),a.color&&i.mColor.set(a.color),a.hover&&i.mHoverColor.set(a.hover),a.fontSize&&(i.mFontSize=a.fontSize),a.textColor&&i.mTextColor.set(a.textColor),i.createButton(),i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(e){case"title":return this.mTitle=t,!0;case"color":return this.mColor.set(t),!0;case"hover":return this.mHoverColor.set(t),!0;case"textColor":return this.mTextColor.set(t),!0;case"fontSize":return this.mFontSize=parseInt(t,10),!0;case"margin":return this.mMargin=t,!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){switch(e){case"title":return this.mTitle;case"color":return this.mColor.getHexString();case"hover":return this.mHoverColor.getHexString();case"textColor":return this.mTextColor.getHexString();case"fontSize":return this.mFontSize;case"margin":return this.mMargin}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}},{key:"createButton",value:function(){this.mBtnElment=document.createElement("button"),this.mBtnElment.setAttribute("data-ui-type","button"),this.mBtnElment.type="button",this.mBtnElment.style.position="relative",this.mBtnElment.style.top="0px",this.mBtnElment.style.left="0px",this.mBtnElment.style.fontSize="".concat(this.mFontSize,"px"),this.mBtnElment.style.padding="".concat(this.mMargin,"px"),this.mBtnElment.style.backgroundColor=this.mColor.getHexString(),this.mBtnElment.style.color=this.mTextColor.getHexString(),this.mBtnElment.innerText=this.mTitle,this.mBtnElment.addEventListener("mouseover",this.onButtonMouseOver.bind(this)),this.mBtnElment.addEventListener("mouseout",this.onButtonMouseOut.bind(this)),this.mBtnElment.addEventListener("click",this.onButtonClick.bind(this)),this.domElement.appendChild(this.mBtnElment)}},{key:"onButtonMouseOver",value:function(){this.mBtnElment.style.backgroundColor=this.mHoverColor.getHexString()}},{key:"onButtonMouseOut",value:function(){this.mBtnElment.style.backgroundColor=this.mColor.getHexString()}},{key:"onButtonClick",value:function(){this.onEvents.next({name:"click",data:this.getObjectId()})}},{key:"updateElement",value:function(){this.mBtnElment&&(this.mBtnElment.style.fontSize="".concat(this.mFontSize,"px"),this.mBtnElment.style.padding="".concat(this.mMargin,"px"),this.mBtnElment.innerText=this.mTitle,this.mBtnElment.style.backgroundColor=this.mColor.getHexString(),this.mBtnElment.style.color=this.mTextColor.getHexString())}}]),n}(Jk);function u_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(s_,"TypeRTTI",new k.r("ButtonUixObject",Jk.TypeRTTI));var c_=function(e){(0,g.Z)(a,e);var n,i=u_(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mPositionType",ev.FIXED),(0,l.Z)((0,_.Z)(e),"mPosition",new Bi),(0,l.Z)((0,_.Z)(e),"mOptions",{}),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){this.mPositionType=this.mSceneEntity.getValue("position_type"),this.mPosition.copy(this.mSceneEntity.getValue("position")),this.mOptions=this.mSceneEntity.getValue("options")}},{key:"applyProperties",value:function(){if(this.mRenderObject){this.mRenderObject.positionType=this.mPositionType,this.mRenderObject.position=this.mPosition.clone();for(var e=0,t=Object.entries(this.mOptions);e<t.length;e++){var n=o(t[e],2),r=n[0],i=n[1];this.mRenderObject.setValue(r,i)}}}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.applyProperties()}},{key:"createRenderObject",value:function(){var e=this.mRenderer.getUiRenderer(),t=new s_(this.mSceneEntity,e,this.mOptions);t.positionType=this.mPositionType,t.locked=this.mLocked,this.mRenderObject=t,this.applyProperties()}}]),a}(r_);function l_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var h_=function(e){(0,g.Z)(n,e);var t=l_(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return(0,u.Z)(this,n),a=t.call(this,e,r),(0,l.Z)((0,_.Z)(a),"onEvents",new Ht),(0,l.Z)((0,_.Z)(a),"mImagePath",void 0),(0,l.Z)((0,_.Z)(a),"mImage",void 0),(0,l.Z)((0,_.Z)(a),"mSize",new D),a.mImagePath=i,o.width&&(a.mSize.x=o.width),o.height&&(a.mSize.y=o.height),a.createImage(),a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"dispose",value:function(){this.mImage&&this.mImage.removeEventListener("click",this.onImageClick.bind(this)),Ni((0,M.Z)(n.prototype),"dispose",this).call(this)}},{key:"proxySetValue",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(e){case"image_path":case"imagePath":return this.setImagePath(t),!0;case"size":return this.setImageSize(t.x,t.y),!0;case"width":return this.setImageSize(t,this.mSize.y),!0;case"height":return this.setImageSize(this.mSize.x,t),!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){switch(e){case"image_path":case"imagePath":return this.mImagePath;case"size":return this.mSize;case"width":return this.mSize.x;case"height":return this.mSize.y}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}},{key:"setImagePath",value:function(e){this.mImagePath!==e&&(this.mImagePath=e,this.mImage&&(this.mImage.src=e||this.imagePlaceholderPath))}},{key:"setImageSize",value:function(e,t){if(this.mSize.set(e,t),this.mImage&&(this.mImage.style.width="".concat(e,"px"),this.mImage.style.height="".concat(t,"px"),this.mEditting)){var n=$(this.mImage).resizable("instance");n&&n.element&&(n.element.width(e),n.element.height(t))}}},{key:"createImage",value:function(){this.mImage=document.createElement("img"),this.mImage.setAttribute("data-ui-type","image"),this.mImage.src=this.mImagePath||this.imagePlaceholderPath,this.mImage.style.position="relative",this.mImage.style.top="0px",this.mImage.style.left="0px",this.mSize.x*this.mSize.y>0&&this.setImageSize(this.mSize.x,this.mSize.y),this.mImage.addEventListener("click",this.onImageClick.bind(this)),this.domElement.appendChild(this.mImage)}},{key:"onImageClick",value:function(){this.onEvents.next({name:"click",data:this.getObjectId()})}},{key:"makeEditable",value:function(){var e=this;return!!Ni((0,M.Z)(n.prototype),"makeEditable",this).call(this)&&(this.mEditting&&!$(this.mImage).resizable("instance")&&$(this.mImage).resizable({start:function(t,n){e.onEdit.next({type:"resize",event:"start",data:n.size})},stop:function(t,n){e.onEdit.next({type:"resize",event:"stop",data:n.size})},resize:function(t,n){e.onEdit.next({type:"resize",event:"update",data:n.size})}}),!0)}},{key:"makeUnEditable",value:function(){this.mEditting&&$(this.mImage).resizable("instance")&&$(this.mImage).resizable("destroy"),Ni((0,M.Z)(n.prototype),"makeUnEditable",this).call(this)}},{key:"updateElement",value:function(){}},{key:"imagePlaceholderPath",get:function(){return"".concat(Jr.E.assetsUrl,"system/placeholders/no-image.jpg")}}]),n}(Jk);function f_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(h_,"TypeRTTI",new k.r("ImageUixObject",Jk.TypeRTTI));var p_=function(e){(0,g.Z)(s,e);var n,i,a=f_(s);function s(){var e;(0,u.Z)(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=a.call.apply(a,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mPositionType",ev.FIXED),(0,l.Z)((0,_.Z)(e),"mPosition",new Bi),(0,l.Z)((0,_.Z)(e),"mOptions",{}),(0,l.Z)((0,_.Z)(e),"mImageId",-1),(0,l.Z)((0,_.Z)(e),"mImagePath",void 0),(0,l.Z)((0,_.Z)(e),"mActiveImageId",-1),(0,l.Z)((0,_.Z)(e),"mSize",new D(100,100)),e}return(0,c.Z)(s,[{key:"loadResource",value:(i=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateProperties(),e.prev=1,e.next=4,this.updateImage();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),qe.qL.error("Failed to load image:",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return i.apply(this,arguments)})},{key:"updateProperties",value:function(){this.mPositionType=this.mSceneEntity.getValue("position_type"),this.mPosition=this.mSceneEntity.getValue("position"),this.mOptions=this.mSceneEntity.getValue("options"),this.mImageId=this.mSceneEntity.getValue("image_id"),this.mSize.copy(this.mSceneEntity.getValue("size"))}},{key:"applyProperties",value:function(){if(this.mRenderObject){this.mRenderObject.positionType=this.mPositionType,this.mRenderObject.locked=this.mLocked,this.mRenderObject.position=this.mPosition.clone(),this.mRenderObject.setValue("size",this.mSize),this.mRenderObject.setValue("image_path",this.mImagePath);for(var e=0,t=Object.entries(this.mOptions);e<t.length;e++){var n=o(t[e],2),r=n[0],i=n[1];this.mRenderObject.setValue(r,i)}}}},{key:"updateImage",value:(n=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mActiveImageId!==this.mImageId){e.next=2;break}return e.abrupt("return");case 2:if(-1!==this.mImageId){e.next=6;break}return this.mActiveImageId=-1,this.mImagePath="",e.abrupt("return");case 6:return this.mActiveImageId=this.mImageId,e.next=9,$s.getInstance().resolveModel(this.mActiveImageId);case 9:t=e.sent,this.mImagePath=t.source_url;case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onUpdateDirty",value:function(){var e=this;Ni((0,M.Z)(s.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.applyProperties(),this.updateImage().then((function(){e.mRenderObject.setValue("image_path",e.mImagePath)}),(function(e){qe.qL.error("Failed to load image:",e)}))}},{key:"createRenderObject",value:function(){var e=this.mRenderer.getUiRenderer(),t=new h_(this.mSceneEntity,e,this.mImagePath,this.mOptions);this.mRenderObject=t,this.applyProperties()}}]),s}(r_);function m_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var d_=function(e){(0,g.Z)(n,e);var t=m_(n);function n(e,r){var i,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"onEvents",new Ht),(0,l.Z)((0,_.Z)(i),"mTextElement",void 0),(0,l.Z)((0,_.Z)(i),"mTagElement",void 0),(0,l.Z)((0,_.Z)(i),"mTitle",""),(0,l.Z)((0,_.Z)(i),"mColor",new so("#f06")),(0,l.Z)((0,_.Z)(i),"mTextColor",so.Black()),(0,l.Z)((0,_.Z)(i),"mHover",new so("#ca095e")),(0,l.Z)((0,_.Z)(i),"mMargin",0),(0,l.Z)((0,_.Z)(i),"mFontSize",16),i.mTitle=a.title||"Title",i.mMargin=a.margin||0,a.color&&i.mColor.set(a.color),a.hover&&i.mHover.set(a.hover),i.mFontSize=a.fontSize||16,a.textColor&&i.mTextColor.set(a.textColor),i._createTag(),i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxySetValue",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(e){case"title":return this.mTitle=t,!0;case"color":return this.mColor.set(t),!0;case"hover":return this.mHover.set(t),!0;case"textColor":return this.mTextColor.set(t),!0;case"fontSize":return this.mFontSize=parseInt(t,10),!0;case"margin":return this.mMargin=t,!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){switch(e){case"title":return this.mTitle;case"color":return this.mColor.getHexString();case"hover":return this.mHover.getHexString();case"textColor":return this.mTextColor.getHexString();case"fontSize":return this.mFontSize;case"margin":return this.mMargin}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}},{key:"_createTag",value:function(){this.mTextElement=document.createElement("div"),this.mTextElement.setAttribute("data-ui-type","tag-title"),this.mTextElement.innerText=this.mTitle,this.mTextElement.style.fontSize="".concat(this.mFontSize,"px"),this.mTextElement.style.position="absolute",this.mTextElement.style.top="0px",this.mTextElement.style.left="0px",this.mTextElement.style.visibility="hidden",this.mTextElement.style.display="block",document.body.appendChild(this.mTextElement);var e=this.mTextElement.offsetHeight+1,t=this.mTextElement.offsetWidth+1+e+this.mMargin,n="".concat(t,"px");document.body.removeChild(this.mTextElement),this.mTextElement.style.position="relative",this.mTextElement.style.visibility="",this.mTextElement.style.display="",this.mTagElement=document.createElement("div"),this.mTagElement.setAttribute("data-ui-type","tag"),this.mTagElement.style.position="relative",this.mTagElement.style.top="0px",this.mTagElement.style.left="0px",this.mTagElement.style.width=n,this.mTagElement.style.height=n,this.mTagElement.style.backgroundColor=this.mColor.getHexString(),this.mTagElement.style.borderRadius="50%",this.mTagElement.style.display="flex",this.mTagElement.style.justifyContent="center",this.mTagElement.style.alignItems="center",this.mTagElement.appendChild(this.mTextElement),this.mTagElement.addEventListener("mouseover",this.onTagMouseOver.bind(this)),this.mTagElement.addEventListener("mouseout",this.onTagMouseOut.bind(this)),this.mTagElement.addEventListener("click",this.onTagClick.bind(this)),this.domElement.appendChild(this.mTagElement)}},{key:"onTagClick",value:function(){this.onEvents.next({name:"click",data:this.getObjectId()})}},{key:"onTagMouseOver",value:function(){this.mTagElement.style.backgroundColor=this.mHover.getHexString()}},{key:"onTagMouseOut",value:function(){this.mTagElement.style.backgroundColor=this.mColor.getHexString()}},{key:"updateElement",value:function(){if(this.mTextElement&&this.mTagElement){this.mTextElement.style.fontSize="".concat(this.mFontSize,"px"),this.mTextElement.innerText=this.mTitle;var e=this.mTextElement.clientHeight+1,t=this.mTextElement.clientWidth+1+e+this.mMargin,n="".concat(t,"px");this.mTagElement.style.backgroundColor=this.mColor.getHexString(),this.mTagElement.style.color=this.mTextColor.getHexString(),this.mTagElement.style.width=n,this.mTagElement.style.height=n}}}]),n}(Jk);function v_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(d_,"TypeRTTI",new k.r("TagUixObject",Jk.TypeRTTI));var y_=function(e){(0,g.Z)(a,e);var n,i=v_(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mPositionType",ev.FIXED),(0,l.Z)((0,_.Z)(e),"mPosition",new Bi),(0,l.Z)((0,_.Z)(e),"mOptions",{}),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){this.mPositionType=this.mSceneEntity.getValue("position_type"),this.mPosition.copy(this.mSceneEntity.getValue("position")),this.mOptions=this.mSceneEntity.getValue("options")}},{key:"applyProperties",value:function(){this.mRenderObject.positionType=this.mPositionType,this.mRenderObject.position=this.mPosition.clone(),this.mRenderObject.locked=this.mLocked;for(var e=0,t=Object.entries(this.mOptions);e<t.length;e++){var n=o(t[e],2),r=n[0],i=n[1];this.mRenderObject.setValue(r,i)}}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.applyProperties()}},{key:"createRenderObject",value:function(){var e=this.mRenderer.getUiRenderer(),t=new d_(this.mSceneEntity,e,this.mOptions);this.mRenderObject=t,this.applyProperties()}}]),a}(r_);function g_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var b_=function(e){(0,g.Z)(n,e);var t=g_(n);function n(e,r,i){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return(0,u.Z)(this,n),a=t.call(this,e,r),(0,l.Z)((0,_.Z)(a),"onEvents",new Ht),(0,l.Z)((0,_.Z)(a),"mHtmlText",void 0),(0,l.Z)((0,_.Z)(a),"mPanelColor",new so("#f06")),(0,l.Z)((0,_.Z)(a),"mMargin",20),(0,l.Z)((0,_.Z)(a),"mPanelElement",void 0),(0,l.Z)((0,_.Z)(a),"mTextElement",void 0),(0,l.Z)((0,_.Z)(a),"mSize",void 0),a.mHtmlText=i||o.text||"",o.panelColor&&a.mPanelColor.set(o.panelColor),a.mMargin=o.margin||20,a.mSize=new D(o.width||150,o.height||200),a._createText(),a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"_createText",value:function(){var e=this._buildPanel();this.domElement.appendChild(e)}},{key:"proxySetValue",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(e){case"htmlText":case"text":return this.mHtmlText=t,!0;case"panelColor":return this.mPanelColor.set(t),!0;case"margin":return this.mMargin=t,!0;case"size":return this.mSize.set(t.x,t.y),!0;case"width":return this.mSize.x=t,!0;case"height":return this.mSize.y=t,!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"proxyGetValue",value:function(e){switch(e){case"htmlText":case"text":return this.mHtmlText;case"panelColor":return this.mPanelColor.getHexString();case"margin":return this.mMargin;case"size":return this.mSize;case"width":return this.mSize.x;case"height":return this.mSize.y}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}},{key:"_buildPanel",value:function(){return this.mPanelElement=document.createElement("div"),this.mPanelElement.style.backgroundColor=this.mPanelColor.getHexString(),this.mPanelElement.setAttribute("data-ui-type","text-panel"),this.mPanelElement.style.padding="".concat(this.mMargin,"px"),this.mPanelElement.style.position="relative",this.mPanelElement.style.top="0px",this.mPanelElement.style.left="0px",this.mPanelElement.style.width="".concat(this.mSize.x,"px"),this.mPanelElement.style.height="".concat(this.mSize.y,"px"),this.mTextElement=document.createElement("div"),this.mTextElement.setAttribute("data-ui-type","text-content"),this.mTextElement.style.width="100%",this.mTextElement.style.height="100%",this.mTextElement.style.overflow="auto",this.mTextElement.innerHTML=this.mHtmlText,this.mPanelElement.appendChild(this.mTextElement),this.mPanelElement}},{key:"makeEditable",value:function(){var e=this;return!!Ni((0,M.Z)(n.prototype),"makeEditable",this).call(this)&&(this.mEditting&&!$(this.mPanelElement).resizable("instance")&&$(this.mPanelElement).resizable({start:function(t,n){e.onEdit.next({type:"resize",event:"start",data:n.size})},stop:function(t,n){e.onEdit.next({type:"resize",event:"stop",data:n.size})},resize:function(t,n){e.onEdit.next({type:"resize",event:"update",data:n.size})}}),!0)}},{key:"makeUnEditable",value:function(){this.mEditting&&$(this.mPanelElement).resizable("instance")&&$(this.mPanelElement).resizable("destroy"),Ni((0,M.Z)(n.prototype),"makeUnEditable",this).call(this)}},{key:"updateElement",value:function(){this.mPanelElement&&(this.mTextElement.innerHTML=this.mHtmlText,this.mPanelElement.style.padding="".concat(this.mMargin,"px"),this.mPanelElement.style.backgroundColor=this.mPanelColor.getHexString(),this.mPanelElement.style.width="".concat(this.mSize.x,"px"),this.mPanelElement.style.height="".concat(this.mSize.y,"px"))}}]),n}(Jk);function M_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(b_,"TypeRTTI",new k.r("TextUixObject",Jk.TypeRTTI));var k_=function(e){(0,g.Z)(a,e);var n,i=M_(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mPositionType",ev.FIXED),(0,l.Z)((0,_.Z)(e),"mPosition",new Bi),(0,l.Z)((0,_.Z)(e),"mOptions",{}),(0,l.Z)((0,_.Z)(e),"mHtmlText",void 0),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.mPositionType=this.mSceneEntity.getValue("position_type"),this.mOptions=this.mSceneEntity.getValue("options"),this.mHtmlText=this.mSceneEntity.getValue("htmlText");case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){this.mPositionType=this.mSceneEntity.getValue("position_type"),this.mPosition.copy(this.mSceneEntity.getValue("position")),this.mOptions=this.mSceneEntity.getValue("options"),this.mHtmlText=this.mSceneEntity.getValue("htmlText")}},{key:"applyProperties",value:function(){this.mRenderObject.positionType=this.mPositionType,this.mRenderObject.position=this.mPosition.clone(),this.mRenderObject.locked=this.mLocked;for(var e=0,t=Object.entries(this.mOptions);e<t.length;e++){var n=o(t[e],2),r=n[0],i=n[1];this.mRenderObject.setValue(r,i)}}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.applyProperties()}},{key:"createRenderObject",value:function(){var e=this.mRenderer.getUiRenderer(),t=new b_(this.mSceneEntity,e,this.mHtmlText,this.mOptions);this.mRenderObject=t,this.applyProperties()}}]),a}(r_),__=(0,c.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Bi.Zero(),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Bi.Zero(),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;(0,u.Z)(this,e),(0,l.Z)(this,"direction",new Bi),(0,l.Z)(this,"origin",new Bi),(0,l.Z)(this,"length",void 0),this.direction.copy(t),this.origin.copy(n),this.length=r})),x_=(0,c.Z)((function e(){(0,u.Z)(this,e),(0,l.Z)(this,"distance",1/0),(0,l.Z)(this,"point",Bi.Zero()),(0,l.Z)(this,"entity",void 0),(0,l.Z)(this,"uv",D.Zero()),(0,l.Z)(this,"uv2",D.Zero()),(0,l.Z)(this,"faceNormal",Bi.Up()),(0,l.Z)(this,"normal",Bi.Up())}));function T_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var w_=function(e){(0,g.Z)(n,e);var t=T_(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mInternalGeometry",void 0),(0,l.Z)((0,_.Z)(i),"mHasVertexAlpha",!1),i.mInternalGeometry=new BABYLON.Geometry(y.F.guid(),e,r),i}return(0,c.Z)(n,[{key:"setVertexData",value:function(e,t){var n=this.resolveAttributeKind(e);this.mInternalGeometry.setVerticesData(n,t.getData()),e===_u.COLOR&&(this.mHasVertexAlpha=t.getItemSize()>3)}},{key:"setIndexData",value:function(e){this.mInternalGeometry.setIndices(e.getData())}},{key:"hasPositions",value:function(){return this.mInternalGeometry.isVerticesDataPresent(this.resolveAttributeKind(_u.POSITION))}},{key:"hasNormals",value:function(){return this.mInternalGeometry.isVerticesDataPresent(this.resolveAttributeKind(_u.NORMAL))}},{key:"hasTangents",value:function(){return this.mInternalGeometry.isVerticesDataPresent(this.resolveAttributeKind(_u.TANGENT))}},{key:"hasUV",value:function(){return this.mInternalGeometry.isVerticesDataPresent(this.resolveAttributeKind(_u.UV))}},{key:"hasUV2",value:function(){return this.mInternalGeometry.isVerticesDataPresent(this.resolveAttributeKind(_u.UV2))}},{key:"hasColors",value:function(){return this.mInternalGeometry.isVerticesDataPresent(this.resolveAttributeKind(_u.COLOR))}},{key:"hasAlpha",value:function(){return this.mHasVertexAlpha}},{key:"dispose",value:function(){this.mInternalGeometry.dispose()}},{key:"resolveAttributeKind",value:function(e){var t;switch(e){case _u.NORMAL:t=BABYLON.VertexBuffer.NormalKind;break;case _u.TANGENT:t=BABYLON.VertexBuffer.TangentKind;break;case _u.UV:t=BABYLON.VertexBuffer.UVKind;break;case _u.UV2:t=BABYLON.VertexBuffer.UV2Kind;break;case _u.COLOR:t=BABYLON.VertexBuffer.ColorKind;break;default:case _u.POSITION:t=BABYLON.VertexBuffer.PositionKind}return t}},{key:"getInternalGeometry",value:function(){return this.mInternalGeometry}}]),n}(wu),R_=(0,c.Z)((function e(t,n){(0,u.Z)(this,e),(0,l.Z)(this,"mCamera",void 0),(0,l.Z)(this,"mRenderer",void 0),this.mCamera=t,this.mRenderer=n}));function Z_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var S_,C_,I_,E_=function(e){(0,g.Z)(n,e);var t=Z_(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"mEnabled",!0),(0,l.Z)((0,_.Z)(i),"mPosition",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mTarget",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mLockUpHemisphere",!1),(0,l.Z)((0,_.Z)(i),"mMinAzimuthAngle",null),(0,l.Z)((0,_.Z)(i),"mMaxAzimuthAngle",null),(0,l.Z)((0,_.Z)(i),"mMinPolarAngle",0),(0,l.Z)((0,_.Z)(i),"mMaxPolarAngle",Math.PI),(0,l.Z)((0,_.Z)(i),"mRotateEnabled",!0),(0,l.Z)((0,_.Z)(i),"mRotationSpeed",1),(0,l.Z)((0,_.Z)(i),"mPanEnabled",!0),(0,l.Z)((0,_.Z)(i),"mPanSpeed",1),(0,l.Z)((0,_.Z)(i),"mZoomEnabled",!0),(0,l.Z)((0,_.Z)(i),"mMinZoom",1),(0,l.Z)((0,_.Z)(i),"mMaxZoom",1e3),(0,l.Z)((0,_.Z)(i),"mZoomSpeed",1),(0,l.Z)((0,_.Z)(i),"mDampingEnabled",!0),(0,l.Z)((0,_.Z)(i),"mDampFactor",.1),(0,l.Z)((0,_.Z)(i),"mAutoRotateEnabled",!1),(0,l.Z)((0,_.Z)(i),"mAutoRotateSpeed",2),(0,l.Z)((0,_.Z)(i),"mKeysEnabled",!0),(0,l.Z)((0,_.Z)(i),"mPreviousPosition",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mPreviousTarget",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mPreviousRadius",0),i}return(0,c.Z)(n,[{key:"loadCameraControls",value:function(){var e=this.mCamera.getSceneEntity(),t=e.getComponent("orbit-camera-controls");this.mEnabled=t.enabled,this.mPosition.copy(e.transform.position),this.mTarget.copy(e.target),this.mPanEnabled=t.panEnabled,this.mPanSpeed=t.panSpeed,this.mRotateEnabled=t.rotateEnabled,this.mRotationSpeed=t.rotateSpeed,this.mZoomEnabled=t.zoomEnabled,this.mMinZoom=t.zoomMin,this.mMaxZoom=t.zoomMax,this.mZoomSpeed=t.zoomSpeed,this.mLockUpHemisphere=t.isUpHemisphereLocked,this.mMinAzimuthAngle=t.azimuthAngleMin,this.mMaxAzimuthAngle=t.azimuthAngleMax,this.mMinPolarAngle=t.polarAngleMin,this.mMaxPolarAngle=t.polarAngleMax,this.mDampingEnabled=t.dampingEnabled,this.mDampFactor=t.dampingFactor,this.mAutoRotateEnabled=t.autoRotateEnabled,this.mAutoRotateSpeed=t.autoRotateSpeed,this.mKeysEnabled=t.keyboardEnabled}},{key:"createCameraControls",value:function(){var e=this.mCamera.getCamera(),t=this.mPosition.clone(),n=this.mTarget.clone(),r=t.distanceTo(this.mTarget);if(this.mRenderer.isRightHandedSystemActive()||(t.toggleCoordSystem(),n.toggleCoordSystem()),e||(e=new BABYLON.ArcRotateCamera(this.mCamera.getCameraName(),0,0,r,new BABYLON.Vector3(n.x,n.y,n.z),this.mRenderer.getScene()),this.mCamera.setCamera(e)),e.position||(e.position=new BABYLON.Vector3),e.position.set(t.x,t.y,t.z),e.radius=r,e.setTarget(new BABYLON.Vector3(n.x,n.y,n.z)),e.rebuildAnglesAndRadius(),e.setEnabled(this.mEnabled),e.inputs.clear(),e.inputs.addPointers(),e.inputs.addMouseWheel(),this.mKeysEnabled&&e.inputs.addKeyboard(),e.checkCollisions=!1,e.ignoreParentScaling=!0,e.speed=2,this.mZoomEnabled)e.lowerRadiusLimit=this.mMinZoom,e.upperRadiusLimit=this.mMaxZoom;else{e.lowerRadiusLimit=r+1.2,e.upperRadiusLimit=r+1.2}if(e.wheelPrecision=1/Math.max(this.mZoomSpeed,pl.EPS)*3,e.wheelDeltaPercentage=0,this.mPanEnabled){e.panningAxis=BABYLON.Vector3.One();var i=1/Math.max(this.mPanSpeed,pl.EPS)*75;e.panningSensibility=i}else e.panningAxis=BABYLON.Vector3.Zero(),e.panningSensibility=1/0;if(this.mRotateEnabled){var a=1/Math.max(this.mRotationSpeed,pl.EPS)*250;e.angularSensibilityX=a,e.angularSensibilityY=a}else e.angularSensibilityX=1/0,e.angularSensibilityY=1/0;if(this.mDampingEnabled){var o=Math.min(this.mDampFactor+.5,.999);e.inertia=o,e.panningInertia=o}else e.inertia=0,e.panningInertia=0;e.lowerAlphaLimit=this.mMinAzimuthAngle,e.upperAlphaLimit=this.mMaxAzimuthAngle,e.lowerBetaLimit=this.mMinPolarAngle+.001,this.mLockUpHemisphere?e.upperBetaLimit=Math.PI/2-.001:e.upperBetaLimit=this.mMaxPolarAngle-.001,e.useAutoRotationBehavior=this.mAutoRotateEnabled,e.useAutoRotationBehavior&&(e.autoRotationBehavior.zoomStopsAnimation=!1,e.autoRotationBehavior.idleRotationWaitTime=0,e.autoRotationBehavior.idleRotationSpinupTime=1,e.autoRotationBehavior.idleRotationSpeed=this.mAutoRotateSpeed),this.mPreviousPosition.set(e.position.x,e.position.y,e.position.z),this.mPreviousTarget.set(e.target.x,e.target.y,e.target.z),this.mPreviousRadius=e.radius,this.mCamera.attachCamera()}},{key:"update",value:function(e){var t=this.mCamera.getSceneEntity(),n=this.mCamera.getCamera(),r=!1,i=!1,a=!1,o=this.mCamera.getCamera().radius;Math.abs(this.mPreviousRadius-o)>pl.EPS&&(this.mPreviousRadius=o,r=!0),this.didPan()&&(t.target.set(n.target.x,n.target.y,n.target.z),this.mPreviousTarget.copy(t.target),i=!0),this.didRotate()&&(t.transform.position.set(n.position.x,n.position.y,n.position.z),t.transform.quaternion.set(n.absoluteRotation.x,n.absoluteRotation.y,n.absoluteRotation.z,n.absoluteRotation.w),this.mPreviousPosition.copy(t.transform.position),i||r||(a=!0)),r&&this.onControlsZoom(),(i||a)&&this.onControlsChange()}},{key:"onUpdateDirty",value:function(){var e=this.mCamera.getSceneEntity();this.loadCameraControls(),this.createCameraControls(),e.getComponent("orbit-camera-controls").setNeedsRenderUpdate(!1)}},{key:"destroyCameraControls",value:function(){}},{key:"onAttached",value:function(){}},{key:"onDetached",value:function(){}},{key:"onControlsChange",value:function(){P.eventBus().dispatch(new ta)}},{key:"onControlsZoom",value:function(){P.eventBus().dispatch(new aa)}},{key:"getComponentName",value:function(){return"orbit-camera-controls"}},{key:"didPan",value:function(){var e=this.mCamera.getCamera(),t=this.mPreviousTarget.x-e.target.x,n=this.mPreviousTarget.y-e.target.y,r=this.mPreviousTarget.z-e.target.z;return t*t+n*n+r*r>pl.EPS}},{key:"didRotate",value:function(){var e=this.mCamera.getCamera(),t=this.mPreviousPosition.x-e.position.x,n=this.mPreviousPosition.y-e.position.y,r=this.mPreviousPosition.z-e.position.z;return t*t+n*n+r*r>pl.EPS}}]),n}(R_),A_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,u.Z)(this,e),(0,l.Z)(this,"radius",1),(0,l.Z)(this,"phi",0),(0,l.Z)(this,"theta",0),this.radius=t,this.phi=n,this.theta=r,this}return(0,c.Z)(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"makeSafe",value:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Dt(t/this.radius,-1,1))),this}},{key:"clone",value:function(){return(new e).copy(this)}}]),e}();!function(e){e[e.NONE=-1]="NONE",e[e.ROTATE=0]="ROTATE",e[e.DOLLY=1]="DOLLY",e[e.TOUCH_ROTATE=2]="TOUCH_ROTATE",e[e.TOUCH_DOLLY_ROTATE=3]="TOUCH_DOLLY_ROTATE"}(S_||(S_={})),function(e){e[e.LEFT=0]="LEFT",e[e.MIDDLE=1]="MIDDLE",e[e.RIGHT=2]="RIGHT",e[e.ROTATE=0]="ROTATE",e[e.DOLLY=1]="DOLLY"}(C_||(C_={})),function(e){e[e.ROTATE=0]="ROTATE",e[e.DOLLY_ROTATE=1]="DOLLY_ROTATE"}(I_||(I_={}));var O_=function(){function e(t,n,r,i){(0,u.Z)(this,e),(0,l.Z)(this,"mCamera",void 0),(0,l.Z)(this,"mObject",void 0),(0,l.Z)(this,"mAxis",Bi.Up()),(0,l.Z)(this,"mDomElement",void 0),(0,l.Z)(this,"enabled",!0),(0,l.Z)(this,"minDistance",0),(0,l.Z)(this,"maxDistance",1/0),(0,l.Z)(this,"minZoom",0),(0,l.Z)(this,"maxZoom",1/0),(0,l.Z)(this,"minPolarAngle",0),(0,l.Z)(this,"maxPolarAngle",Math.PI),(0,l.Z)(this,"minAzimuthAngle",-1/0),(0,l.Z)(this,"maxAzimuthAngle",1/0),(0,l.Z)(this,"enableDamping",!1),(0,l.Z)(this,"dampingFactor",.05),(0,l.Z)(this,"enableZoom",!0),(0,l.Z)(this,"zoomSpeed",1),(0,l.Z)(this,"enableRotate",!0),(0,l.Z)(this,"rotateSpeed",1),(0,l.Z)(this,"autoRotate",!1),(0,l.Z)(this,"autoRotateSpeed",2),(0,l.Z)(this,"mouseButtons",{LEFT:C_.ROTATE,MIDDLE:C_.DOLLY,RIGHT:C_.ROTATE}),(0,l.Z)(this,"touches",{ONE:I_.ROTATE,TWO:I_.DOLLY_ROTATE}),(0,l.Z)(this,"position0",new Bi),(0,l.Z)(this,"quaternion0",new Pi),(0,l.Z)(this,"zoom0",1),(0,l.Z)(this,"lastPosition",new Bi),(0,l.Z)(this,"lastQuaternion",new Pi),(0,l.Z)(this,"startRotation",new Pi),(0,l.Z)(this,"changeEvent",{type:"change"}),(0,l.Z)(this,"startEvent",{type:"start"}),(0,l.Z)(this,"endEvent",{type:"end"}),(0,l.Z)(this,"zoomEvent",{type:"zoom"}),(0,l.Z)(this,"state",S_.NONE),(0,l.Z)(this,"mSpherical",new A_),(0,l.Z)(this,"mSphericalDelta",new A_),(0,l.Z)(this,"scale",1),(0,l.Z)(this,"zoomChanged",!1),(0,l.Z)(this,"rotateStart",new D),(0,l.Z)(this,"rotateEnd",new D),(0,l.Z)(this,"rotateDelta",new D),(0,l.Z)(this,"dollyStart",new D),(0,l.Z)(this,"dollyEnd",new D),(0,l.Z)(this,"dollyDelta",new D),(0,l.Z)(this,"_listeners",{}),this.mCamera=t,this.mObject=n,this.mAxis.copy(r),this.mDomElement=i,this.position0.copy(this.mObject.transform.position),this.quaternion0.copy(this.mObject.transform.quaternion),this.startRotation.copy(this.mObject.transform.quaternion),this.mObject?(this.mSpherical.radius=this.mCamera.transform.position.distanceTo(this.mObject.transform.position),this.mSpherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.mSpherical.radius))):this.mSpherical.radius=1,this.mDomElement.addEventListener("contextmenu",this.onContextMenu.bind(this),!1),this.mDomElement.addEventListener("mousedown",this.onMouseDown.bind(this),!1),this.mDomElement.addEventListener("wheel",this.onMouseWheel.bind(this),!1),this.mDomElement.addEventListener("touchstart",this.onTouchStart.bind(this),!1),this.mDomElement.addEventListener("touchend",this.onTouchEnd.bind(this),!1),this.mDomElement.addEventListener("touchmove",this.onTouchMove.bind(this),!1),-1===this.mDomElement.tabIndex&&(this.mDomElement.tabIndex=0),this.update()}return(0,c.Z)(e,[{key:"getPolarAngle",value:function(){return this.mSpherical.phi}},{key:"getAzimuthalAngle",value:function(){return this.mSpherical.theta}},{key:"getRadius",value:function(){return this.mSpherical.radius}},{key:"saveState",value:function(){this.quaternion0.copy(this.mObject.transform.quaternion)}},{key:"reset",value:function(){this.mObject.transform.quaternion.copy(this.quaternion0),this.mCamera.updateProjectionMatrix(),this.dispatchEvent({type:this.changeEvent.type,state:"reset"}),this.update(),this.state=S_.NONE}},{key:"update",value:function(){this.autoRotate&&this.state===S_.NONE&&this.rotateLeft(this.getAutoRotationAngle()),this.enableDamping?(this.mSpherical.theta+=this.mSphericalDelta.theta*this.dampingFactor,this.mSpherical.phi+=this.mSphericalDelta.phi*this.dampingFactor):(this.mSpherical.theta+=this.mSphericalDelta.theta,this.mSpherical.phi+=this.mSphericalDelta.phi),this.mSpherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.mSpherical.theta)),this.mSpherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.mSpherical.phi)),this.minPolarAngle!==-1/0&&this.maxPolarAngle!==1/0&&this.mSpherical.makeSafe(),this.mSpherical.radius*=this.scale,this.mSpherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.mSpherical.radius));var e=this.mAxis.y>0?this.mSpherical.theta:this.mSpherical.phi,t=(new Pi).setFromAxisAngle(this.mAxis,-e);return this.mObject.transform.quaternion.copy(this.startRotation.clone().multiply(t)),!0===this.enableDamping?(this.mSphericalDelta.theta*=1-this.dampingFactor,this.mSphericalDelta.phi*=1-this.dampingFactor):this.mSphericalDelta.set(0,0,0),this.scale=1,!!(this.zoomChanged||this.lastPosition.distanceToSquared(this.mObject.transform.position)>pl.EPS||8*(1-this.lastQuaternion.dot(this.mObject.transform.quaternion))>pl.EPS)&&(this.dispatchEvent({type:this.changeEvent.type,state:"any"}),this.lastPosition.copy(this.mObject.transform.position),this.lastQuaternion.copy(this.mObject.transform.quaternion),this.zoomChanged=!1,!0)}},{key:"dispose",value:function(){this.mDomElement.removeEventListener("contextmenu",this.onContextMenu.bind(this),!1),this.mDomElement.removeEventListener("mousedown",this.onMouseDown.bind(this),!1),this.mDomElement.removeEventListener("wheel",this.onMouseWheel.bind(this),!1),this.mDomElement.removeEventListener("touchstart",this.onTouchStart.bind(this),!1),this.mDomElement.removeEventListener("touchend",this.onTouchEnd.bind(this),!1),this.mDomElement.removeEventListener("touchmove",this.onTouchMove.bind(this),!1),document.removeEventListener("mousemove",this.onMouseMove.bind(this),!1),document.removeEventListener("mouseup",this.onMouseUp.bind(this),!1)}},{key:"getAutoRotationAngle",value:function(){return 2*Math.PI/60/60*this.autoRotateSpeed}},{key:"getZoomScale",value:function(){return Math.pow(.95,this.zoomSpeed)}},{key:"rotateLeft",value:function(e){this.mSphericalDelta.theta-=e}},{key:"rotateUp",value:function(e){this.mSphericalDelta.phi-=e}},{key:"dollyOut",value:function(e){this.mCamera instanceof jc?(this.scale/=e,this.dispatchEvent({type:this.zoomEvent.type,state:"zoom-out"})):this.mCamera instanceof ga||(qe.qL.warn("WARNING: TurntableControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}},{key:"dollyIn",value:function(e){this.mCamera instanceof jc?(this.scale*=e,this.dispatchEvent({type:this.zoomEvent.type,state:"zoom-in"})):this.mCamera instanceof ga||(qe.qL.warn("WARNING: TurntableControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}},{key:"handleMouseDownRotate",value:function(e){this.rotateStart.set(e.clientX,e.clientY)}},{key:"handleMouseDownDolly",value:function(e){this.dollyStart.set(e.clientX,e.clientY)}},{key:"handleMouseMoveRotate",value:function(e){this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.mDomElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.mDomElement.clientHeight),this.rotateStart.copy(this.rotateEnd),this.update()}},{key:"handleMouseMoveDolly",value:function(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}},{key:"handleMouseUp",value:function(e){}},{key:"handleMouseWheel",value:function(e){e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update()}},{key:"handleTouchStartRotate",value:function(e){if(1===e.touches.length)this.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);this.rotateStart.set(t,n)}}},{key:"handleTouchStartDolly",value:function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);this.dollyStart.set(0,r)}},{key:"handleTouchStartDollyRotate",value:function(e){this.enableZoom&&this.handleTouchStartDolly(e),this.enableRotate&&this.handleTouchStartRotate(e)}},{key:"handleTouchMoveRotate",value:function(e){if(1===e.touches.length)this.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);this.rotateEnd.set(t,n)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.mDomElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.mDomElement.clientHeight),this.rotateStart.copy(this.rotateEnd)}},{key:"handleTouchMoveDolly",value:function(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);this.dollyEnd.set(0,r),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}},{key:"handleTouchMoveDollyRotate",value:function(e){this.enableZoom&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}},{key:"handleTouchEnd",value:function(e){}},{key:"onMouseDown",value:function(e){if(!1!==this.enabled){var t;switch(e.preventDefault(),this.mDomElement.focus?this.mDomElement.focus():window.focus(),e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case C_.DOLLY:if(!1===this.enableZoom)return;this.handleMouseDownDolly(e),this.state=S_.DOLLY;break;case C_.ROTATE:if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this.state=S_.ROTATE;break;default:this.state=S_.NONE}if(this.state!==S_.NONE)switch(document.addEventListener("mousemove",this.onMouseMove.bind(this),!1),document.addEventListener("mouseup",this.onMouseUp.bind(this),!1),this.state){case S_.ROTATE:this.dispatchEvent({type:this.startEvent.type,state:"rotate"});break;case S_.DOLLY:this.dispatchEvent({type:this.startEvent.type,state:"zoom"});break;default:this.dispatchEvent({type:this.startEvent.type,state:"any"})}}}},{key:"onMouseMove",value:function(e){if(!1!==this.enabled)switch(e.preventDefault(),this.state){case S_.ROTATE:if(!1===this.enableRotate)return;this.handleMouseMoveRotate(e);break;case S_.DOLLY:if(!1===this.enableZoom)return;this.handleMouseMoveDolly(e)}}},{key:"onMouseUp",value:function(e){if(!1!==this.enabled){switch(this.handleMouseUp(e),document.removeEventListener("mousemove",this.onMouseMove.bind(this),!1),document.removeEventListener("mouseup",this.onMouseUp.bind(this),!1),this.state){case S_.ROTATE:this.dispatchEvent({type:this.endEvent.type,state:"rotate"});break;case S_.DOLLY:this.dispatchEvent({type:this.endEvent.type,state:"zoom"});break;default:this.dispatchEvent({type:this.endEvent.type,state:"any"})}this.state=S_.NONE}}},{key:"onMouseWheel",value:function(e){!1===this.enabled||!1===this.enableZoom||this.state!==S_.NONE&&this.state!==S_.ROTATE||(e.preventDefault(),e.stopPropagation(),this.dispatchEvent({type:this.startEvent.type,state:"zoom"}),this.handleMouseWheel(e),this.dispatchEvent({type:this.endEvent.type,state:"zoom"}))}},{key:"onTouchStart",value:function(e){if(!1!==this.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(this.touches.ONE===I_.ROTATE){if(!1===this.enableRotate)return;this.handleTouchStartRotate(e),this.state=S_.TOUCH_ROTATE}else this.state=S_.NONE;break;case 2:if(this.touches.TWO===I_.DOLLY_ROTATE){if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchStartDollyRotate(e),this.state=S_.TOUCH_DOLLY_ROTATE}else this.state=S_.NONE;break;default:this.state=S_.NONE}if(this.state!==S_.NONE)if(this.state===S_.TOUCH_ROTATE)this.dispatchEvent({type:this.startEvent.type,state:"rotate"});else this.dispatchEvent({type:this.startEvent.type,state:"any"})}}},{key:"onTouchMove",value:function(e){if(!1!==this.enabled)switch(e.preventDefault(),e.stopPropagation(),this.state){case S_.TOUCH_ROTATE:if(!1===this.enableRotate)return;this.handleTouchMoveRotate(e),this.update();break;case S_.TOUCH_DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchMoveDollyRotate(e),this.update();break;default:this.state=S_.NONE}}},{key:"onTouchEnd",value:function(e){if(!1!==this.enabled){if(this.handleTouchEnd(e),this.state===S_.TOUCH_ROTATE)this.dispatchEvent({type:this.endEvent.type,state:"rotate"});else this.dispatchEvent({type:this.endEvent.type,state:"any"});this.state=S_.NONE}}},{key:"onContextMenu",value:function(e){!1!==this.enabled&&e.preventDefault()}},{key:"addEventListener",value:function(e,t){void 0===this._listeners[e]&&(this._listeners[e]=[]),-1===this._listeners[e].indexOf(t)&&this._listeners[e].push(t)}},{key:"hasEventListener",value:function(e,t){return void 0!==this._listeners[e]&&-1!==this._listeners[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},{key:"dispatchEvent",value:function(e){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e);e.target=null}}}]),e}();function D_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var P_=function(e){(0,g.Z)(n,e);var t=D_(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"mControls",void 0),(0,l.Z)((0,_.Z)(i),"mEnabled",!0),(0,l.Z)((0,_.Z)(i),"mActiveEntity",void 0),(0,l.Z)((0,_.Z)(i),"mPosition",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mTarget",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mZoomEnabled",void 0),(0,l.Z)((0,_.Z)(i),"mMinZoom",void 0),(0,l.Z)((0,_.Z)(i),"mMaxZoom",void 0),(0,l.Z)((0,_.Z)(i),"mDirection",void 0),(0,l.Z)((0,_.Z)(i),"mMinPolar",void 0),(0,l.Z)((0,_.Z)(i),"mMaxPolar",void 0),(0,l.Z)((0,_.Z)(i),"mMinAzimuth",void 0),(0,l.Z)((0,_.Z)(i),"mMaxAzimuth",void 0),(0,l.Z)((0,_.Z)(i),"mDampEnabled",void 0),(0,l.Z)((0,_.Z)(i),"mDampFactor",void 0),(0,l.Z)((0,_.Z)(i),"mAutoRotate",void 0),(0,l.Z)((0,_.Z)(i),"mRotationSpeed",void 0),i}return(0,c.Z)(n,[{key:"loadCameraControls",value:function(){var e=this.mCamera.getSceneEntity(),t=e.getComponent("turntable-camera-controls");this.mEnabled=t.enabled,this.mPosition.copy(e.transform.position),this.mTarget.copy(e.target),this.mZoomEnabled=t.zoomEnabled,this.mMinZoom=t.zoomMin,this.mMaxZoom=t.zoomMax,this.mDirection=t.direction,this.mMinPolar=t.polarAngleMin,this.mMaxPolar=t.polarAngleMax,this.mMinAzimuth=t.azimuthAngleMin,this.mMaxAzimuth=t.azimuthAngleMax,this.mDampEnabled=t.dampingEnabled,this.mDampFactor=t.dampingFactor,this.mAutoRotate=!1,this.mRotationSpeed=t.rotationSpeed,this.mActiveEntity=t.getValue("active_object")}},{key:"createCameraControls",value:function(){var e=this.mCamera.getCamera(),t=this.mPosition.clone(),n=this.mTarget.clone();if(this.mRenderer.isRightHandedSystemActive()||(t.toggleCoordSystem(),n.toggleCoordSystem()),e||(e=new BABYLON.UniversalCamera(this.mCamera.getCameraName(),new BABYLON.Vector3(t.x,t.y,t.z),this.mRenderer.getScene()),this.mCamera.setCamera(e)),e.position||(e.position=new BABYLON.Vector3),e.position.set(t.x,t.y,t.z),e.setEnabled(this.mEnabled),e.setTarget(new BABYLON.Vector3(n.x,n.y,n.z)),e.inputs.clear(),!this.mControls){var r=this.mDirection===ca.Theta?Bi.AxisY():Bi.AxisX();this.mControls=new O_(this.mCamera.getSceneEntity(),this.mActiveEntity,r,this.mRenderer.getCanvas())}this.mControls.enabled=this.mEnabled&&!!this.mActiveEntity,this.mControls.rotateSpeed=this.mRotationSpeed,this.mControls.autoRotate=this.mAutoRotate,this.mControls.enableDamping=this.mDampEnabled,Number.isFinite(this.mDampFactor)&&(this.mControls.dampingFactor=this.mDampFactor);var i=new Bi,a=new A_;i.applyQuaternion((new Pi).setFromUnitVectors(new Bi(e.upVector.x,e.upVector.y,e.upVector.z),new Bi(0,1,0))),a.setFromVector3(i),a.makeSafe(),this.mDirection===ca.Phi?(this.mControls.minPolarAngle=this.mMinPolar,this.mControls.maxPolarAngle=this.mMaxPolar,this.mControls.minAzimuthAngle=a.theta,this.mControls.maxAzimuthAngle=a.theta):(this.mControls.minAzimuthAngle=this.mMinAzimuth,this.mControls.maxAzimuthAngle=this.mMaxAzimuth,this.mControls.minPolarAngle=a.phi,this.mControls.maxPolarAngle=a.phi),this.mControls.enableZoom=this.mZoomEnabled,this.mControls.minDistance=this.mMinZoom,this.mControls.maxDistance=this.mMaxZoom,this.mCamera.attachCamera()}},{key:"update",value:function(e){this.mControls&&this.mControls.update()}},{key:"onUpdateDirty",value:function(){var e=this.mCamera.getSceneEntity();this.loadCameraControls(),this.createCameraControls(),e.getComponent("turntable-camera-controls").setNeedsRenderUpdate(!1)}},{key:"destroyCameraControls",value:function(){this.mControls.dispose(),this.mControls=void 0}},{key:"onAttached",value:function(){this.mControls&&(this.mControls.addEventListener("change",this.onControlsChange.bind(this)),this.mControls.addEventListener("zoom",this.onZoom.bind(this)))}},{key:"onDetached",value:function(){this.mControls&&(this.mControls.removeEventListener("change",this.onControlsChange.bind(this)),this.mControls.removeEventListener("zoom",this.onZoom.bind(this)))}},{key:"onZoom",value:function(){if(this.mControls){var e=this.mCamera.getSceneEntity(),t=e.transform.position.clone().sub(this.mActiveEntity.transform.position).normalize(),n=this.mControls.getRadius(),r=this.mActiveEntity.transform.position.clone().addScaledVector(t,n);e.transform.position.copy(r),e.markNeedsRenderUpdate(),this.onControlsZoom()}}},{key:"onControlsChange",value:function(){P.eventBus().dispatch(new ta)}},{key:"onControlsZoom",value:function(){P.eventBus().dispatch(new aa)}},{key:"getComponentName",value:function(){return"turntable-camera-controls"}}]),n}(R_);function B_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var F_=function(e){(0,g.Z)(n,e);var t=B_(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"mEnabled",!0),(0,l.Z)((0,_.Z)(i),"mPosition",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mTarget",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mMovementSpeed",void 0),(0,l.Z)((0,_.Z)(i),"mConstrainVertical",void 0),(0,l.Z)((0,_.Z)(i),"mKeysEnabled",void 0),(0,l.Z)((0,_.Z)(i),"mLookSpeed",void 0),(0,l.Z)((0,_.Z)(i),"mPreviousPosition",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mPreviousQuaternion",Pi.identity()),(0,l.Z)((0,_.Z)(i),"mPreviousTarget",Bi.Zero()),i}return(0,c.Z)(n,[{key:"loadCameraControls",value:function(){var e=this.mCamera.getSceneEntity(),t=e.getComponent("fps-camera-controls");this.mEnabled=t.enabled,this.mPosition.copy(e.transform.position),this.mTarget.copy(e.target),this.mMovementSpeed=t.movementSpeed,this.mConstrainVertical=t.constrainVertical,this.mKeysEnabled=t.keyboardEnabled,this.mLookSpeed=t.lookSpeed}},{key:"createCameraControls",value:function(){var e=this.mCamera.getCamera(),t=this.mPosition.clone(),n=this.mTarget.clone();this.mRenderer.isRightHandedSystemActive()||(t.toggleCoordSystem(),n.toggleCoordSystem()),e||(e=new BABYLON.UniversalCamera(this.mCamera.getCameraName(),new BABYLON.Vector3(t.x,t.y,t.z),this.mRenderer.getScene()),this.mCamera.setCamera(e)),e.position=new BABYLON.Vector3(t.x,t.y,t.z),e.setTarget(new BABYLON.Vector3(n.x,n.y,n.z)),e.setEnabled(this.mEnabled),e.inputs.clear(),e.inputs.addMouse(!0),e.inputs.addMouseWheel(),this.mKeysEnabled&&(e.inputs.addKeyboard(),e.keysUp.push(38,87),e.keysLeft.push(37,65),e.keysDown.push(40,83),e.keysRight.push(39,68)),e.inertia=0,e.checkCollisions=!1,e.applyGravity=!1,e.noRotationConstraint=!0,e.invertRotation=!1,e.speed=.05*this.mMovementSpeed,e.angularSensibility=.1/this.mLookSpeed*3750,this.mPreviousPosition.set(e.position.x,e.position.y,e.position.z),this.mPreviousTarget.set(e.target.x,e.target.y,e.target.z),this.mPreviousQuaternion.set(e.absoluteRotation.x,e.absoluteRotation.y,e.absoluteRotation.z,e.absoluteRotation.w),this.mCamera.attachCamera()}},{key:"update",value:function(e){var t=this.mCamera.getSceneEntity(),n=this.mCamera.getCamera(),r=!1,i=!1;this.didPan()&&(t.transform.position.set(n.position.x,n.position.y,n.position.z),this.mPreviousPosition.copy(t.transform.position),r=!0),this.didRotate()&&(t.target.set(n.target.x,n.target.y,n.target.z),t.transform.quaternion.set(n.absoluteRotation.x,n.absoluteRotation.y,n.absoluteRotation.z,n.absoluteRotation.w),this.mPreviousTarget.copy(t.target),r||(i=!0)),(r||i)&&this.onControlsChange()}},{key:"onUpdateDirty",value:function(){var e=this.mCamera.getSceneEntity();this.loadCameraControls(),this.createCameraControls(),e.getComponent("fps-camera-controls").setNeedsRenderUpdate(!1)}},{key:"destroyCameraControls",value:function(){}},{key:"onAttached",value:function(){}},{key:"onDetached",value:function(){}},{key:"onControlsChange",value:function(){P.eventBus().dispatch(new ta)}},{key:"getComponentName",value:function(){return"fps-camera-controls"}},{key:"didPan",value:function(){var e=this.mCamera.getCamera(),t=this.mPreviousPosition.x-e.position.x,n=this.mPreviousPosition.y-e.position.y,r=this.mPreviousPosition.z-e.position.z;return t*t+n*n+r*r>pl.EPS}},{key:"didRotate",value:function(){var e=this.mCamera.getCamera(),t=this.mPreviousTarget.x-e.target.x,n=this.mPreviousTarget.y-e.target.y,r=this.mPreviousTarget.z-e.target.z;return t*t+n*n+r*r>pl.EPS}}]),n}(R_);function L_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var N_=function(e){(0,g.Z)(n,e);var t=L_(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"mEnabled",!0),(0,l.Z)((0,_.Z)(i),"mPosition",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mTarget",Bi.Zero()),i}return(0,c.Z)(n,[{key:"loadCameraControls",value:function(){var e=this.mCamera.getSceneEntity();this.mPosition.copy(e.transform.position),this.mTarget.copy(e.target)}},{key:"createCameraControls",value:function(){var e=this.mCamera.getCamera(),t=this.mPosition.clone(),n=this.mTarget.clone();this.mRenderer.isRightHandedSystemActive()||(t.toggleCoordSystem(),n.toggleCoordSystem()),e||(e=new BABYLON.UniversalCamera(this.mCamera.getCameraName(),new BABYLON.Vector3(t.x,t.y,t.z),this.mRenderer.getScene()),this.mCamera.setCamera(e)),e.position=new BABYLON.Vector3(t.x,t.y,t.z),e.setTarget(new BABYLON.Vector3(n.x,n.y,n.z)),e.setEnabled(this.mEnabled),e.inputs.clear(),this.mCamera.attachCamera()}},{key:"update",value:function(e){}},{key:"onUpdateDirty",value:function(){this.loadCameraControls(),this.createCameraControls()}},{key:"destroyCameraControls",value:function(){}},{key:"onAttached",value:function(){}},{key:"onDetached",value:function(){}},{key:"getComponentName",value:function(){return"no-camera-controls"}}]),n}(R_);function j_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var z_=function(e){(0,g.Z)(a,e);var n,i=j_(a);function a(e,t){var n;return(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mNear",.1),(0,l.Z)((0,_.Z)(n),"mFar",1e3),(0,l.Z)((0,_.Z)(n),"mFov",45),(0,l.Z)((0,_.Z)(n),"mAspectRatio",1),(0,l.Z)((0,_.Z)(n),"mCameraName","Camera Perspective"),(0,l.Z)((0,_.Z)(n),"mControls",void 0),n}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.loadResourceFromEntity();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadResourceFromEntity",value:function(){var e=this.mSceneEntity;this.mCameraName=e.name,this.mFov=e.fov,this.mAspectRatio=e.getValue("aspect_ratio")||1,this.mNear=e.near,this.mFar=e.far;var t=e.getComponents(Ji.TypeRTTI),n=t.length>0?t[0]:void 0,r=null==n?void 0:n.getComponentName();if(!this.mControls||this.mControls.getComponentName()===r)switch(r){case"fps-camera-controls":this.mControls=new F_(this,this.getRenderer());break;case"turntable-camera-controls":this.mControls=new P_(this,this.getRenderer());break;case"orbit-camera-controls":this.mControls=new E_(this,this.getRenderer());break;default:this.mControls=new N_(this,this.getRenderer())}this.mControls.loadCameraControls()}},{key:"createRenderObject",value:function(){var e,t=this.mSceneEntity;null===(e=this.mControls)||void 0===e||e.createCameraControls();var n=this.mRenderObject;n.name=this.mCameraName,n.mode=BABYLON.Camera.PERSPECTIVE_CAMERA,n.fovMode=BABYLON.Camera.FOVMODE_VERTICAL_FIXED,t.needsProjectionMatrixUpdate()&&(n.minZ=this.mNear,n.maxZ=this.mFar,n.fov=Pt(this.mFov),t.setProjectionMatrixUpdate(!1)),n.attachControl(this.getRenderer().getCanvas(),!0)}},{key:"destroyRenderObject",value:function(){var e;null===(e=this.mControls)||void 0===e||e.destroyCameraControls(),Ni((0,M.Z)(a.prototype),"destroyRenderObject",this).call(this)}},{key:"onUpdateDirty",value:function(){var e;Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.loadResourceFromEntity(),this.createRenderObject(),null===(e=this.mControls)||void 0===e||e.onUpdateDirty()}},{key:"update",value:function(e){var t;null===(t=this.mControls)||void 0===t||t.update(e),Ni((0,M.Z)(a.prototype),"update",this).call(this,e)}},{key:"updateTranslation",value:function(){return!1}},{key:"attach",value:function(){var e;Ni((0,M.Z)(a.prototype),"attach",this).call(this),null===(e=this.mControls)||void 0===e||e.onAttached(),this.mRenderer.setCameraActive(this)}},{key:"detach",value:function(){var e;Ni((0,M.Z)(a.prototype),"detach",this).call(this),null===(e=this.mControls)||void 0===e||e.onDetached()}},{key:"getSceneEntity",value:function(){return this.mSceneEntity}},{key:"isOrthographic",value:function(){return!1}},{key:"isPerspective",value:function(){return!0}},{key:"getCamera",value:function(){return this.mRenderObject}},{key:"setCamera",value:function(e){this.mRenderObject=e}},{key:"getCameraName",value:function(){return this.mCameraName}},{key:"attachCamera",value:function(){this.mRenderObject.attachControl(this.getRenderer().getCanvas(),!0)}},{key:"detachCamera",value:function(){this.mRenderObject.detachControl()}}]),a}(LM);function U_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var V_=function(e){(0,g.Z)(n,e);var t=U_(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(i),"mEnvMapScale",D.One()),(0,l.Z)((0,_.Z)(i),"mFresnelDiffuseColor",so.Black()),(0,l.Z)((0,_.Z)(i),"mNormalMapScale",D.One()),(0,l.Z)((0,_.Z)(i),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(i),"mSpecularColor",new so(.04,.067,.067)),(0,l.Z)((0,_.Z)(i),"mShininess",30),(0,l.Z)((0,_.Z)(i),"mLightMapIntensity",1),(0,l.Z)((0,_.Z)(i),"mBumpMapLevel",1),(0,l.Z)((0,_.Z)(i),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(i),"mEnvMapCombineOp",Jo.Multiply),(0,l.Z)((0,_.Z)(i),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(i),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(i),"mAoMap",void 0),(0,l.Z)((0,_.Z)(i),"mBumpMap",void 0),(0,l.Z)((0,_.Z)(i),"mNormalMap",void 0),(0,l.Z)((0,_.Z)(i),"mLightMap",void 0),(0,l.Z)((0,_.Z)(i),"mEmissiveMap",void 0),(0,l.Z)((0,_.Z)(i),"mSpecularMap",void 0),(0,l.Z)((0,_.Z)(i),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(i),"mDirty",!1),(0,l.Z)((0,_.Z)(i),"mAlphaTestEnabled",!1),(0,l.Z)((0,_.Z)(i),"mTransparent",!1),(0,l.Z)((0,_.Z)(i),"mFlatShading",!1),(0,l.Z)((0,_.Z)(i),"mPremultipliedAlpha",!1),i.mInternalMaterial=new BABYLON.PBRMaterial(e,r),i.mInternalMaterial.metadata={},i.setSide(Es.Front),i.mInternalMaterial.useAlphaFromAlbedoTexture=!0,i.mInternalMaterial.useLogarithmicDepth=!1,i.mInternalMaterial.maxSimultaneousLights=12,i.mInternalMaterial.usePhysicalLightFalloff=!1,i}return(0,c.Z)(n,[{key:"getEnvMapScale",value:function(){return this.mEnvMapScale}},{key:"setEnvMapScale",value:function(e){this.mEnvMapScale.copy(e),this.mEnvMap&&this.mEnvMap.getInternalTexture().scale(this.mEnvMapScale.x)}},{key:"isFresnelDiffuseEnabled",value:function(){return!0}},{key:"setFresnelDiffuseEnabled",value:function(e){}},{key:"getFresnelDiffuseBias",value:function(){return.01}},{key:"setFresnelDiffuseBias",value:function(e){}},{key:"getFresnelDiffuseScale",value:function(){return 1}},{key:"setFresnelDiffuseScale",value:function(e){}},{key:"getFresnelDiffusePower",value:function(){return 1}},{key:"setFresnelDiffusePower",value:function(e){}},{key:"getFresnelDiffuseColor",value:function(){return this.mFresnelDiffuseColor}},{key:"setFresnelDiffuseColor",value:function(e){}},{key:"isFresnelEnvMapEnabled",value:function(){return!0}},{key:"setFresnelEnvMapEnabled",value:function(e){}},{key:"getFresnelEnvMapBias",value:function(){return.01}},{key:"setFresnelEnvMapBias",value:function(e){}},{key:"getFresnelEnvMapScale",value:function(){return 1}},{key:"setFresnelEnvMapScale",value:function(e){}},{key:"getFresnelEnvMapPower",value:function(){return 1}},{key:"setFresnelEnvMapPower",value:function(e){}},{key:"getBumpMap",value:function(){return this.mBumpMap}},{key:"setBumpMap",value:function(e){this.mBumpMap=e,this.mInternalMaterial.bumpTexture=e?e.getInternalTexture():null,this.mInternalMaterial.bumpTexture&&(this.mInternalMaterial.bumpTexture.level=this.mBumpMapLevel,this.mInternalMaterial.bumpTexture.coordinatesMode=lk(e))}},{key:"getBumpScale",value:function(){return this.mBumpMapLevel}},{key:"setBumpScale",value:function(e){this.mBumpMapLevel=e,this.mInternalMaterial.bumpTexture&&(this.mInternalMaterial.bumpTexture.level=this.mBumpMapLevel)}},{key:"getNormalMap",value:function(){return this.mNormalMap}},{key:"setNormalMap",value:function(e){this.mNormalMap=e,this.mInternalMaterial.bumpTexture=e?e.getInternalTexture():null,this.mInternalMaterial.bumpTexture&&(this.setNormalScale(this.mNormalMapScale),this.mInternalMaterial.bumpTexture.coordinatesMode=lk(e))}},{key:"getNormalScale",value:function(){return this.mNormalMapScale}},{key:"setNormalScale",value:function(e){this.mNormalMapScale.copy(e),this.mInternalMaterial.bumpTexture&&this.mInternalMaterial.bumpTexture.scale(this.mNormalMapScale.x)}},{key:"getDisplacementMap",value:function(){}},{key:"setDisplacementMap",value:function(e){}},{key:"getDisplacementScale",value:function(){return 1}},{key:"setDisplacementScale",value:function(e){}},{key:"getDisplacementBias",value:function(){return.01}},{key:"setDisplacementBias",value:function(e){}},{key:"getSpecular",value:function(){return this.mSpecularColor}},{key:"setSpecular",value:function(e){this.mSpecularColor.copy(e),this.mInternalMaterial.reflectivityColor.set(this.mSpecularColor.r,this.mSpecularColor.g,this.mSpecularColor.b)}},{key:"getLightMap",value:function(){return this.mLightMap}},{key:"setLightMap",value:function(e){this.mLightMap=e,this.mInternalMaterial.lightmapTexture=e?e.getInternalTexture():null,this.mInternalMaterial.lightmapTexture&&(this.mInternalMaterial.lightmapTexture.level=this.mLightMapIntensity,this.mInternalMaterial.lightmapTexture.coordinatesMode=lk(e))}},{key:"getLightMapIntensity",value:function(){return this.mLightMapIntensity}},{key:"setLightMapIntensity",value:function(e){this.mLightMapIntensity=e,this.mInternalMaterial.lightmapTexture&&(this.mInternalMaterial.lightmapTexture.level=this.mLightMapIntensity)}},{key:"getEnvMapIntensity",value:function(){return this.mInternalMaterial.environmentIntensity}},{key:"setEnvMapIntensity",value:function(e){this.mInternalMaterial.environmentIntensity=e}},{key:"getEmissiveColor",value:function(){return this.mEmissiveColor}},{key:"setEmissiveColor",value:function(e){this.mEmissiveColor.copy(e),this.mInternalMaterial.emissiveColor.set(this.mEmissiveColor.r,this.mEmissiveColor.g,this.mEmissiveColor.b)}},{key:"getEmissiveMap",value:function(){return this.mEmissiveMap}},{key:"setEmissiveMap",value:function(e){this.mEmissiveMap=e,this.mInternalMaterial.emissiveTexture=e?e.getInternalTexture():null,this.mInternalMaterial.emissiveTexture&&(this.mInternalMaterial.emissiveTexture.coordinatesMode=lk(e))}},{key:"getEmissiveIntensity",value:function(){return this.mInternalMaterial.emissiveIntensity}},{key:"setEmissiveIntensity",value:function(e){this.mInternalMaterial.emissiveIntensity=e}},{key:"getShininess",value:function(){return this.mShininess}},{key:"setShininess",value:function(e){this.mShininess=e,this.mInternalMaterial.specularIntensity=this.mShininess/100}},{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.albedoColor.set(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.albedoTexture=e?e.getInternalTexture():null,this.mInternalMaterial.albedoTexture&&(this.mInternalMaterial.albedoTexture.coordinatesMode=lk(e))}},{key:"useAlphaFromDiffuseMap",value:function(e){this.mInternalMaterial.useAlphaFromAlbedoTexture=e}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.opacityTexture=e?e.getInternalTexture():null,this.mInternalMaterial.opacityTexture&&(this.mInternalMaterial.opacityTexture.coordinatesMode=lk(e))}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.ambientTexture=e?e.getInternalTexture():null,this.mInternalMaterial.ambientTexture&&(this.mInternalMaterial.ambientTexture.coordinatesMode=lk(e))}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.ambientTextureStrength}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.ambientTextureStrength=e}},{key:"getSpecularMap",value:function(){return this.mSpecularMap}},{key:"setSpecularMap",value:function(e){this.mSpecularMap=e,this.mInternalMaterial.reflectivityTexture=e?e.getInternalTexture():null,this.mInternalMaterial.reflectivityTexture&&(this.mInternalMaterial.reflectivityTexture.coordinatesMode=lk(e))}},{key:"getEnvMap",value:function(){return this.mEnvMap}},{key:"setEnvMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.reflectionTexture=e?e.getInternalTexture():null,this.mInternalMaterial.reflectionTexture&&(this.mInternalMaterial.reflectionTexture.coordinatesMode=lk(e,!0)),e&&this.setEnvMapScale(this.mEnvMapScale)}},{key:"getEnvMapCombine",value:function(){return this.mEnvMapCombineOp}},{key:"setEnvMapCombine",value:function(e){this.mEnvMapCombineOp=e}},{key:"getReflectivity",value:function(){return this.mInternalMaterial.reflectionColor.r}},{key:"setReflectivity",value:function(e){this.mInternalMaterial.reflectionColor.set(e,e,e)}},{key:"getIOR",value:function(){return this.mInternalMaterial.indexOfRefraction}},{key:"setIOR",value:function(e){this.mInternalMaterial.indexOfRefraction=e}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fogEnabled}},{key:"setFog",value:function(e){this.mInternalMaterial.fogEnabled=e}},{key:"getDepthTest",value:function(){return!0}},{key:"setDepthTest",value:function(e){}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.disableDepthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.disableDepthWrite=!e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.alpha}},{key:"setOpacity",value:function(e){this.mInternalMaterial.alpha=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaCutOff}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaCutOff=e,(!this.mAlphaTestEnabled&&e>=1e-5||this.mAlphaTestEnabled&&e<1e-5)&&(this.mAlphaTestEnabled=e>=1e-5,this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,this.mTransparent))}},{key:"getTransparent",value:function(){return ok(this.mInternalMaterial.transparencyMode)}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,e)}},{key:"getAlphaMode",value:function(){return uk(this.mInternalMaterial.alphaMode).alphaMode}},{key:"setAlphaMode",value:function(e){this.mInternalMaterial.alphaMode=ck(e,this.mPremultipliedAlpha)}},{key:"getPremultipliedAlpha",value:function(){return this.mPremultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mPremultipliedAlpha=e,this.setAlphaMode(this.mInternalMaterial.alphaMode)}},{key:"getColorWrite",value:function(){return!this.mInternalMaterial.disableColorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.disableColorWrite=!e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return 1}},{key:"setWireframeLineWidth",value:function(e){}},{key:"getFreeze",value:function(){return this.mInternalMaterial.isFrozen}},{key:"setFreeze",value:function(e){e?this.mInternalMaterial.freeze():this.mInternalMaterial.unfreeze()}},{key:"getSide",value:function(){return ik(this.mInternalMaterial.backFaceCulling,!1)}},{key:"setSide",value:function(e){var t=ak(e);this.mInternalMaterial.backFaceCulling=t.cullingEnabled,t.cullBackFace?this.mInternalMaterial.sideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:this.mInternalMaterial.sideOrientation=BABYLON.Material.ClockWiseSideOrientation,this.mInternalMaterial.twoSidedLighting=e===Es.Double}},{key:"getFlatShading",value:function(){return this.mFlatShading}},{key:"setFlatShading",value:function(e){this.mFlatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.metadata}},{key:"setMetaData",value:function(e){this.mInternalMaterial.metadata=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,e&&this.mInternalMaterial.markDirty()}},{key:"dispose",value:function(){this.mInternalMaterial.dispose(!1,!1)}},{key:"cloneMaterial",value:function(){return new n(this.getName(),this.mInternalMaterial.getScene()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){var t=this;return this.mFresnelDiffuseColor.copy(e.mFresnelDiffuseColor),this.mEnvMapScale.copy(e.mEnvMapScale),this.mNormalMapScale.copy(e.mNormalMapScale),this.mEmissiveColor.copy(e.mEmissiveColor),this.mSpecularColor.copy(e.mSpecularColor),this.mShininess=e.mShininess,this.mLightMapIntensity=e.mLightMapIntensity,this.mBumpMapLevel=e.mBumpMapLevel,this.mDiffuseColor.copy(e.mDiffuseColor),this.mEnvMapScale.copy(e.mEnvMapScale),this.mEnvMapCombineOp=e.mEnvMapCombineOp,this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mBumpMap=e.mBumpMap,this.mNormalMap=e.mNormalMap,this.mLightMap=e.mLightMap,this.mEmissiveMap=e.mEmissiveMap,this.mSpecularMap=e.mSpecularMap,this.mEnvMap=e.mEnvMap,this.mDirty=e.mDirty,this.mAlphaTestEnabled=e.mAlphaTestEnabled,this.mTransparent=e.mTransparent,this.mFlatShading=e.mFlatShading,this.mPremultipliedAlpha=e.mPremultipliedAlpha,BABYLON.SerializationHelper.Clone((function(){return t}),e),this.mInternalMaterial.id=e.getInternalMaterial().name,this.mInternalMaterial.name=e.getInternalMaterial().name,e.getInternalMaterial().clearCoat.copyTo(this.mInternalMaterial.clearCoat),e.getInternalMaterial().anisotropy.copyTo(this.mInternalMaterial.anisotropy),e.getInternalMaterial().brdf.copyTo(this.mInternalMaterial.brdf),e.getInternalMaterial().sheen.copyTo(this.mInternalMaterial.sheen),e.getInternalMaterial().subSurface.copyTo(this.mInternalMaterial.subSurface),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(hs);function H_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var G_=function(e){(0,g.Z)(n,e);var t=H_(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(i),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(i),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(i),"mNormalMapScale",D.One()),(0,l.Z)((0,_.Z)(i),"mBumpMapLevel",1),(0,l.Z)((0,_.Z)(i),"mLightMapIntensity",1),(0,l.Z)((0,_.Z)(i),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(i),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(i),"mAoMap",void 0),(0,l.Z)((0,_.Z)(i),"mBumpMap",void 0),(0,l.Z)((0,_.Z)(i),"mNormalMap",void 0),(0,l.Z)((0,_.Z)(i),"mLightMap",void 0),(0,l.Z)((0,_.Z)(i),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(i),"mEmissiveMap",void 0),(0,l.Z)((0,_.Z)(i),"mRoughnessMap",void 0),(0,l.Z)((0,_.Z)(i),"mMetalnessMap",void 0),(0,l.Z)((0,_.Z)(i),"mSpecularMap",void 0),(0,l.Z)((0,_.Z)(i),"mDirty",!1),(0,l.Z)((0,_.Z)(i),"mAlphaTestEnabled",!1),(0,l.Z)((0,_.Z)(i),"mTransparent",!1),(0,l.Z)((0,_.Z)(i),"mFlatShading",!1),(0,l.Z)((0,_.Z)(i),"mPremultipliedAlpha",!1),i.mInternalMaterial=new BABYLON.PBRMaterial(e,r),i.mInternalMaterial.metadata={},i.setSide(Es.Front),i.mInternalMaterial.useAlphaFromAlbedoTexture=!0,i.mInternalMaterial.useLogarithmicDepth=!1,i.mInternalMaterial.maxSimultaneousLights=12,i.mInternalMaterial.usePhysicalLightFalloff=!1,i}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.albedoColor.set(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.albedoTexture=e?e.getInternalTexture():null,this.mInternalMaterial.albedoTexture&&(this.mInternalMaterial.albedoTexture.coordinatesMode=lk(e))}},{key:"useAlphaFromDiffuseMap",value:function(e){this.mInternalMaterial.useAlphaFromAlbedoTexture=e}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.opacityTexture=e?e.getInternalTexture():null,this.mInternalMaterial.opacityTexture&&(this.mInternalMaterial.opacityTexture.coordinatesMode=lk(e))}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.ambientTexture=e?e.getInternalTexture():null,this.mInternalMaterial.ambientTexture&&(this.mInternalMaterial.ambientTexture.coordinatesMode=lk(e))}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.ambientTextureStrength}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.ambientTextureStrength=e}},{key:"getSpecularMap",value:function(){return this.mSpecularMap}},{key:"setSpecularMap",value:function(e){this.mSpecularMap=e,this.mInternalMaterial.reflectivityTexture=e?e.getInternalTexture():null,this.mInternalMaterial.reflectivityTexture&&(this.mInternalMaterial.reflectivityTexture.coordinatesMode=lk(e))}},{key:"getEnvMap",value:function(){return this.mEnvMap}},{key:"setEnvMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.reflectionTexture=e?e.getInternalTexture():null,this.mInternalMaterial.reflectionTexture&&(this.mInternalMaterial.reflectionTexture.coordinatesMode=lk(e,!0))}},{key:"getReflectivity",value:function(){return this.mInternalMaterial.reflectionColor.r}},{key:"setReflectivity",value:function(e){this.mInternalMaterial.reflectionColor.set(e,e,e)}},{key:"getIOR",value:function(){return this.mInternalMaterial.indexOfRefraction}},{key:"setIOR",value:function(e){this.mInternalMaterial.indexOfRefraction=e}},{key:"getBumpMap",value:function(){return this.mBumpMap}},{key:"setBumpMap",value:function(e){this.mBumpMap=e,this.mInternalMaterial.bumpTexture=e?e.getInternalTexture():null,this.mInternalMaterial.bumpTexture&&(this.mInternalMaterial.bumpTexture.level=this.mBumpMapLevel,this.mInternalMaterial.bumpTexture.coordinatesMode=lk(e))}},{key:"getBumpScale",value:function(){return this.mBumpMapLevel}},{key:"setBumpScale",value:function(e){this.mBumpMapLevel=e,this.mInternalMaterial.bumpTexture&&(this.mInternalMaterial.bumpTexture.level=this.mBumpMapLevel)}},{key:"getDisplacementMap",value:function(){}},{key:"setDisplacementMap",value:function(e){}},{key:"getDisplacementScale",value:function(){return 1}},{key:"setDisplacementScale",value:function(e){}},{key:"getDisplacementBias",value:function(){return.01}},{key:"setDisplacementBias",value:function(e){}},{key:"getEmissiveColor",value:function(){return this.mEmissiveColor}},{key:"setEmissiveColor",value:function(e){this.mEmissiveColor.copy(e),this.mInternalMaterial.emissiveColor.set(this.mEmissiveColor.r,this.mEmissiveColor.g,this.mEmissiveColor.b)}},{key:"getEmissiveMap",value:function(){return this.mEmissiveMap}},{key:"setEmissiveMap",value:function(e){this.mEmissiveMap=e,this.mInternalMaterial.emissiveTexture=e?e.getInternalTexture():null,this.mInternalMaterial.emissiveTexture&&(this.mInternalMaterial.emissiveTexture.coordinatesMode=lk(e))}},{key:"getEmissiveIntensity",value:function(){return this.mInternalMaterial.emissiveIntensity}},{key:"setEmissiveIntensity",value:function(e){this.mInternalMaterial.emissiveIntensity=e}},{key:"getEnvMapIntensity",value:function(){return this.mInternalMaterial.environmentIntensity}},{key:"setEnvMapIntensity",value:function(e){this.mInternalMaterial.environmentIntensity=e}},{key:"getLightMap",value:function(){return this.mLightMap}},{key:"setLightMap",value:function(e){this.mLightMap=e,this.mInternalMaterial.lightmapTexture=e?e.getInternalTexture():null,this.mInternalMaterial.lightmapTexture&&(this.mInternalMaterial.lightmapTexture.level=this.mLightMapIntensity,this.mInternalMaterial.lightmapTexture.coordinatesMode=lk(e))}},{key:"getLightMapIntensity",value:function(){return this.mLightMapIntensity}},{key:"setLightMapIntensity",value:function(e){this.mLightMapIntensity=e,this.mInternalMaterial.lightmapTexture&&(this.mInternalMaterial.lightmapTexture.level=this.mLightMapIntensity)}},{key:"getMetalness",value:function(){return this.mInternalMaterial.metallic}},{key:"setMetalness",value:function(e){this.mInternalMaterial.metallic=e}},{key:"getMetalnessMap",value:function(){return this.mMetalnessMap}},{key:"setMetalnessMap",value:function(e){this.mMetalnessMap=e,this.mInternalMaterial.metallicTexture=e?e.getInternalTexture():null}},{key:"getNormalMap",value:function(){return this.mNormalMap}},{key:"setNormalMap",value:function(e){this.mNormalMap=e,this.mInternalMaterial.bumpTexture=e?e.getInternalTexture():null,this.mInternalMaterial.bumpTexture&&(this.setNormalScale(this.mNormalMapScale),this.mInternalMaterial.bumpTexture.coordinatesMode=lk(e))}},{key:"getNormalScale",value:function(){return this.mNormalMapScale}},{key:"setNormalScale",value:function(e){this.mNormalMapScale.copy(e),this.mInternalMaterial.bumpTexture&&this.mInternalMaterial.bumpTexture.scale(this.mNormalMapScale.x)}},{key:"getRoughness",value:function(){return this.mInternalMaterial.microSurface}},{key:"setRoughness",value:function(e){this.mInternalMaterial.microSurface=e}},{key:"getRoughnessMap",value:function(){return this.mRoughnessMap}},{key:"setRoughnessMap",value:function(e){this.mRoughnessMap=e,this.mInternalMaterial.microSurfaceTexture=e?e.getInternalTexture():null,this.mInternalMaterial.microSurfaceTexture&&(this.mInternalMaterial.microSurfaceTexture.coordinatesMode=lk(e))}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fogEnabled}},{key:"setFog",value:function(e){this.mInternalMaterial.fogEnabled=e}},{key:"getDepthTest",value:function(){return!0}},{key:"setDepthTest",value:function(e){}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.disableDepthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.disableDepthWrite=!e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.alpha}},{key:"setOpacity",value:function(e){this.mInternalMaterial.alpha=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaCutOff}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaCutOff=e,(!this.mAlphaTestEnabled&&e>=1e-5||this.mAlphaTestEnabled&&e<1e-5)&&(this.mAlphaTestEnabled=e>=1e-5,this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,this.mTransparent))}},{key:"getTransparent",value:function(){return ok(this.mInternalMaterial.transparencyMode)}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,e)}},{key:"getAlphaMode",value:function(){return uk(this.mInternalMaterial.alphaMode).alphaMode}},{key:"setAlphaMode",value:function(e){this.mInternalMaterial.alphaMode=ck(e,this.mPremultipliedAlpha)}},{key:"getPremultipliedAlpha",value:function(){return this.mPremultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mPremultipliedAlpha=e,this.setAlphaMode(this.mInternalMaterial.alphaMode)}},{key:"getColorWrite",value:function(){return!this.mInternalMaterial.disableColorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.disableColorWrite=!e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return 1}},{key:"setWireframeLineWidth",value:function(e){}},{key:"getFreeze",value:function(){return this.mInternalMaterial.isFrozen}},{key:"setFreeze",value:function(e){e?this.mInternalMaterial.freeze():this.mInternalMaterial.unfreeze()}},{key:"getSide",value:function(){return ik(this.mInternalMaterial.backFaceCulling,!1)}},{key:"setSide",value:function(e){var t=ak(e);this.mInternalMaterial.backFaceCulling=t.cullingEnabled,t.cullBackFace?this.mInternalMaterial.sideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:this.mInternalMaterial.sideOrientation=BABYLON.Material.ClockWiseSideOrientation,this.mInternalMaterial.twoSidedLighting=e===Es.Double}},{key:"getFlatShading",value:function(){return this.mFlatShading}},{key:"setFlatShading",value:function(e){this.mFlatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.metadata}},{key:"setMetaData",value:function(e){this.mInternalMaterial.metadata=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,e&&this.mInternalMaterial.markDirty()}},{key:"dispose",value:function(){this.mInternalMaterial.dispose(!1,!1)}},{key:"cloneMaterial",value:function(){return new n(this.getName(),this.mInternalMaterial.getScene()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){var t=this;return this.mDiffuseColor.copy(e.mDiffuseColor),this.mEmissiveColor.copy(e.mEmissiveColor),this.mNormalMapScale.copy(e.mNormalMapScale),this.mBumpMapLevel=e.mBumpMapLevel,this.mLightMapIntensity=e.mLightMapIntensity,this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mBumpMap=e.mBumpMap,this.mNormalMap=e.mNormalMap,this.mLightMap=e.mLightMap,this.mEnvMap=e.mEnvMap,this.mEmissiveMap=e.mEmissiveMap,this.mRoughnessMap=e.mRoughnessMap,this.mMetalnessMap=e.mMetalnessMap,this.mSpecularMap=e.mSpecularMap,this.mDirty=e.mDirty,this.mAlphaTestEnabled=e.mAlphaTestEnabled,this.mTransparent=e.mTransparent,this.mFlatShading=e.mFlatShading,this.mPremultipliedAlpha=e.mPremultipliedAlpha,BABYLON.SerializationHelper.Clone((function(){return t}),e),this.mInternalMaterial.id=e.getInternalMaterial().name,this.mInternalMaterial.name=e.getInternalMaterial().name,e.getInternalMaterial().clearCoat.copyTo(this.mInternalMaterial.clearCoat),e.getInternalMaterial().anisotropy.copyTo(this.mInternalMaterial.anisotropy),e.getInternalMaterial().brdf.copyTo(this.mInternalMaterial.brdf),e.getInternalMaterial().sheen.copyTo(this.mInternalMaterial.sheen),e.getInternalMaterial().subSurface.copyTo(this.mInternalMaterial.subSurface),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(ps);function q_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var W_=function(e){(0,g.Z)(n,e);var t=q_(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(i),"mFresnelDiffuseColor",so.Black()),(0,l.Z)((0,_.Z)(i),"mSpecularColor",new so(.04,.067,.067)),(0,l.Z)((0,_.Z)(i),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(i),"mEnvMapScale",D.One()),(0,l.Z)((0,_.Z)(i),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(i),"mNormalMapScale",D.One()),(0,l.Z)((0,_.Z)(i),"mBumpMapLevel",1),(0,l.Z)((0,_.Z)(i),"mLightMapIntensity",1),(0,l.Z)((0,_.Z)(i),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(i),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(i),"mAoMap",void 0),(0,l.Z)((0,_.Z)(i),"mBumpMap",void 0),(0,l.Z)((0,_.Z)(i),"mNormalMap",void 0),(0,l.Z)((0,_.Z)(i),"mLightMap",void 0),(0,l.Z)((0,_.Z)(i),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(i),"mEmissiveMap",void 0),(0,l.Z)((0,_.Z)(i),"mRoughnessMap",void 0),(0,l.Z)((0,_.Z)(i),"mMetalnessMap",void 0),(0,l.Z)((0,_.Z)(i),"mSpecularMap",void 0),(0,l.Z)((0,_.Z)(i),"mGlossinessMap",void 0),(0,l.Z)((0,_.Z)(i),"mDirty",!1),(0,l.Z)((0,_.Z)(i),"mAlphaTestEnabled",!1),(0,l.Z)((0,_.Z)(i),"mTransparent",!1),(0,l.Z)((0,_.Z)(i),"mFlatShading",!1),(0,l.Z)((0,_.Z)(i),"mPremultipliedAlpha",!1),i.mInternalMaterial=new BABYLON.PBRMaterial(e,r),i.mInternalMaterial.metadata={},i.setSide(Es.Front),i.mInternalMaterial.useAlphaFromAlbedoTexture=!0,i.mInternalMaterial.useLogarithmicDepth=!1,i.mInternalMaterial.maxSimultaneousLights=12,i.mInternalMaterial.usePhysicalLightFalloff=!1,i}return(0,c.Z)(n,[{key:"getEnvMapScale",value:function(){return this.mEnvMapScale}},{key:"setEnvMapScale",value:function(e){this.mEnvMapScale.copy(e),this.mEnvMap&&this.mEnvMap.getInternalTexture().scale(this.mEnvMapScale.x)}},{key:"isSpecularGlossinessEnabled",value:function(){return!0}},{key:"setSpecularGlossinessEnabled",value:function(e){}},{key:"getSpecular",value:function(){return this.mSpecularColor}},{key:"setSpecular",value:function(e){this.mSpecularColor.copy(e)}},{key:"getGlossiness",value:function(){return 1-this.mInternalMaterial.microSurface}},{key:"setGlossiness",value:function(e){this.mInternalMaterial.microSurface=1-e}},{key:"getGlossinessMap",value:function(){return this.mGlossinessMap}},{key:"setGlossinessMap",value:function(e){this.mGlossinessMap=e,this.mInternalMaterial.microSurfaceTexture=e?e.getInternalTexture():null}},{key:"isFresnelDiffuseEnabled",value:function(){return!0}},{key:"setFresnelDiffuseEnabled",value:function(e){}},{key:"getFresnelDiffuseBias",value:function(){return.01}},{key:"setFresnelDiffuseBias",value:function(e){}},{key:"getFresnelDiffuseScale",value:function(){return 1}},{key:"setFresnelDiffuseScale",value:function(e){}},{key:"getFresnelDiffusePower",value:function(){return 1}},{key:"setFresnelDiffusePower",value:function(e){}},{key:"getFresnelDiffuseColor",value:function(){return this.mFresnelDiffuseColor}},{key:"setFresnelDiffuseColor",value:function(e){}},{key:"isFresnelEnvMapEnabled",value:function(){return!0}},{key:"setFresnelEnvMapEnabled",value:function(e){}},{key:"getFresnelEnvMapBias",value:function(){return.01}},{key:"setFresnelEnvMapBias",value:function(e){}},{key:"getFresnelEnvMapScale",value:function(){return 1}},{key:"setFresnelEnvMapScale",value:function(e){}},{key:"getFresnelEnvMapPower",value:function(){return 1}},{key:"setFresnelEnvMapPower",value:function(e){}},{key:"getClearCoat",value:function(){return this.mInternalMaterial.clearCoat.intensity}},{key:"setClearCoat",value:function(e){this.mInternalMaterial.clearCoat.isEnabled=!0,this.mInternalMaterial.clearCoat.intensity=e}},{key:"getClearCoatRoughness",value:function(){return this.mInternalMaterial.clearCoat.roughness}},{key:"setClearCoatRoughness",value:function(e){this.mInternalMaterial.clearCoat.isEnabled=!0,this.mInternalMaterial.clearCoat.roughness=e}},{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.albedoColor.set(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.albedoTexture=e?e.getInternalTexture():null,this.mInternalMaterial.albedoTexture&&(this.mInternalMaterial.albedoTexture.coordinatesMode=lk(e))}},{key:"useAlphaFromDiffuseMap",value:function(e){this.mInternalMaterial.useAlphaFromAlbedoTexture=e}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.opacityTexture=e?e.getInternalTexture():null,this.mInternalMaterial.opacityTexture&&(this.mInternalMaterial.opacityTexture.coordinatesMode=lk(e))}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.ambientTexture=e?e.getInternalTexture():null,this.mInternalMaterial.ambientTexture&&(this.mInternalMaterial.ambientTexture.coordinatesMode=lk(e))}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.ambientTextureStrength}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.ambientTextureStrength=e}},{key:"getSpecularMap",value:function(){return this.mSpecularMap}},{key:"setSpecularMap",value:function(e){this.mSpecularMap=e,this.mInternalMaterial.reflectivityTexture=e?e.getInternalTexture():null,this.mInternalMaterial.reflectivityTexture&&(this.mInternalMaterial.reflectivityTexture.coordinatesMode=lk(e))}},{key:"getEnvMap",value:function(){return this.mEnvMap}},{key:"setEnvMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.reflectionTexture=e?e.getInternalTexture():null,this.mInternalMaterial.reflectionTexture&&(this.mInternalMaterial.reflectionTexture.coordinatesMode=lk(e,!0)),e&&this.setEnvMapScale(this.mEnvMapScale)}},{key:"getReflectivity",value:function(){return this.mInternalMaterial.reflectionColor.r}},{key:"setReflectivity",value:function(e){this.mInternalMaterial.reflectionColor.set(e,e,e)}},{key:"getIOR",value:function(){return this.mInternalMaterial.indexOfRefraction}},{key:"setIOR",value:function(e){this.mInternalMaterial.indexOfRefraction=e}},{key:"getBumpMap",value:function(){return this.mBumpMap}},{key:"setBumpMap",value:function(e){this.mBumpMap=e,this.mInternalMaterial.bumpTexture=e?e.getInternalTexture():null,this.mInternalMaterial.bumpTexture&&(this.mInternalMaterial.bumpTexture.level=this.mBumpMapLevel,this.mInternalMaterial.bumpTexture.coordinatesMode=lk(e))}},{key:"getBumpScale",value:function(){return this.mBumpMapLevel}},{key:"setBumpScale",value:function(e){this.mBumpMapLevel=e,this.mInternalMaterial.bumpTexture&&(this.mInternalMaterial.bumpTexture.level=this.mBumpMapLevel)}},{key:"getDisplacementMap",value:function(){}},{key:"setDisplacementMap",value:function(e){}},{key:"getDisplacementScale",value:function(){return 1}},{key:"setDisplacementScale",value:function(e){}},{key:"getDisplacementBias",value:function(){return.01}},{key:"setDisplacementBias",value:function(e){}},{key:"getEmissiveColor",value:function(){return this.mEmissiveColor}},{key:"setEmissiveColor",value:function(e){this.mEmissiveColor.copy(e),this.mInternalMaterial.emissiveColor.set(this.mEmissiveColor.r,this.mEmissiveColor.g,this.mEmissiveColor.b)}},{key:"getEmissiveMap",value:function(){return this.mEmissiveMap}},{key:"setEmissiveMap",value:function(e){this.mEmissiveMap=e,this.mInternalMaterial.emissiveTexture=e?e.getInternalTexture():null,this.mInternalMaterial.emissiveTexture&&(this.mInternalMaterial.emissiveTexture.coordinatesMode=lk(e))}},{key:"getEmissiveIntensity",value:function(){return this.mInternalMaterial.emissiveIntensity}},{key:"setEmissiveIntensity",value:function(e){this.mInternalMaterial.emissiveIntensity=e}},{key:"getEnvMapIntensity",value:function(){return this.mInternalMaterial.environmentIntensity}},{key:"setEnvMapIntensity",value:function(e){this.mInternalMaterial.environmentIntensity=e}},{key:"getLightMap",value:function(){return this.mLightMap}},{key:"setLightMap",value:function(e){this.mLightMap=e,this.mInternalMaterial.lightmapTexture=e?e.getInternalTexture():null,this.mInternalMaterial.lightmapTexture&&(this.mInternalMaterial.lightmapTexture.level=this.mLightMapIntensity,this.mInternalMaterial.lightmapTexture.coordinatesMode=lk(e))}},{key:"getLightMapIntensity",value:function(){return this.mLightMapIntensity}},{key:"setLightMapIntensity",value:function(e){this.mLightMapIntensity=e,this.mInternalMaterial.lightmapTexture&&(this.mInternalMaterial.lightmapTexture.level=this.mLightMapIntensity)}},{key:"getMetalness",value:function(){return this.mInternalMaterial.metallic}},{key:"setMetalness",value:function(e){this.mInternalMaterial.metallic=e}},{key:"getMetalnessMap",value:function(){return this.mMetalnessMap}},{key:"setMetalnessMap",value:function(e){this.mMetalnessMap=e,this.mInternalMaterial.metallicTexture=e?e.getInternalTexture():null}},{key:"getNormalMap",value:function(){return this.mNormalMap}},{key:"setNormalMap",value:function(e){this.mNormalMap=e,this.mInternalMaterial.bumpTexture=e?e.getInternalTexture():null,this.mInternalMaterial.bumpTexture&&(this.setNormalScale(this.mNormalMapScale),this.mInternalMaterial.bumpTexture.coordinatesMode=lk(e))}},{key:"getNormalScale",value:function(){return this.mNormalMapScale}},{key:"setNormalScale",value:function(e){this.mNormalMapScale.copy(e),this.mInternalMaterial.bumpTexture&&this.mInternalMaterial.bumpTexture.scale(this.mNormalMapScale.x)}},{key:"getRoughness",value:function(){return this.mInternalMaterial.microSurface}},{key:"setRoughness",value:function(e){this.mInternalMaterial.microSurface=e}},{key:"getRoughnessMap",value:function(){return this.mRoughnessMap}},{key:"setRoughnessMap",value:function(e){this.mRoughnessMap=e,this.mInternalMaterial.microSurfaceTexture=e?e.getInternalTexture():null,this.mInternalMaterial.microSurfaceTexture&&(this.mInternalMaterial.microSurfaceTexture.coordinatesMode=lk(e))}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fogEnabled}},{key:"setFog",value:function(e){this.mInternalMaterial.fogEnabled=e}},{key:"getDepthTest",value:function(){return!0}},{key:"setDepthTest",value:function(e){}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.disableDepthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.disableDepthWrite=!e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.alpha}},{key:"setOpacity",value:function(e){this.mInternalMaterial.alpha=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaCutOff}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaCutOff=e,(!this.mAlphaTestEnabled&&e>=1e-5||this.mAlphaTestEnabled&&e<1e-5)&&(this.mAlphaTestEnabled=e>=1e-5,this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,this.mTransparent))}},{key:"getTransparent",value:function(){return ok(this.mInternalMaterial.transparencyMode)}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,e)}},{key:"getAlphaMode",value:function(){return uk(this.mInternalMaterial.alphaMode).alphaMode}},{key:"setAlphaMode",value:function(e){this.mInternalMaterial.alphaMode=ck(e,this.mPremultipliedAlpha)}},{key:"getPremultipliedAlpha",value:function(){return this.mPremultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mPremultipliedAlpha=e,this.setAlphaMode(this.mInternalMaterial.alphaMode)}},{key:"getColorWrite",value:function(){return!this.mInternalMaterial.disableColorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.disableColorWrite=!e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return 1}},{key:"setWireframeLineWidth",value:function(e){}},{key:"getFreeze",value:function(){return this.mInternalMaterial.isFrozen}},{key:"setFreeze",value:function(e){e?this.mInternalMaterial.freeze():this.mInternalMaterial.unfreeze()}},{key:"getSide",value:function(){return ik(this.mInternalMaterial.backFaceCulling,!1)}},{key:"setSide",value:function(e){var t=ak(e);this.mInternalMaterial.backFaceCulling=t.cullingEnabled,t.cullBackFace?this.mInternalMaterial.sideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:this.mInternalMaterial.sideOrientation=BABYLON.Material.ClockWiseSideOrientation,this.mInternalMaterial.twoSidedLighting=e===Es.Double}},{key:"getFlatShading",value:function(){return this.mFlatShading}},{key:"setFlatShading",value:function(e){this.mFlatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.metadata}},{key:"setMetaData",value:function(e){this.mInternalMaterial.metadata=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,e&&this.mInternalMaterial.markDirty()}},{key:"dispose",value:function(){this.mInternalMaterial.dispose(!1,!1)}},{key:"cloneMaterial",value:function(){return new n(this.getName(),this.mInternalMaterial.getScene()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){var t=this;return this.mEnvMapScale.copy(e.mEnvMapScale),this.mFresnelDiffuseColor.copy(e.mFresnelDiffuseColor),this.mSpecularColor.copy(e.mSpecularColor),this.mDiffuseColor.copy(e.mDiffuseColor),this.mEmissiveColor.copy(e.mEmissiveColor),this.mEnvMapScale.copy(e.mEnvMapScale),this.mNormalMapScale.copy(e.mNormalMapScale),this.mBumpMapLevel=e.mBumpMapLevel,this.mLightMapIntensity=e.mLightMapIntensity,this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mBumpMap=e.mBumpMap,this.mNormalMap=e.mNormalMap,this.mLightMap=e.mLightMap,this.mEnvMap=e.mEnvMap,this.mEmissiveMap=e.mEmissiveMap,this.mRoughnessMap=e.mRoughnessMap,this.mMetalnessMap=e.mMetalnessMap,this.mSpecularMap=e.mSpecularMap,this.mGlossinessMap=e.mGlossinessMap,this.mDirty=e.mDirty,this.mAlphaTestEnabled=e.mAlphaTestEnabled,this.mTransparent=e.mTransparent,this.mFlatShading=e.mFlatShading,this.mPremultipliedAlpha=e.mPremultipliedAlpha,BABYLON.SerializationHelper.Clone((function(){return t}),e),this.mInternalMaterial.id=e.getInternalMaterial().name,this.mInternalMaterial.name=e.getInternalMaterial().name,e.getInternalMaterial().clearCoat.copyTo(this.mInternalMaterial.clearCoat),e.getInternalMaterial().anisotropy.copyTo(this.mInternalMaterial.anisotropy),e.getInternalMaterial().brdf.copyTo(this.mInternalMaterial.brdf),e.getInternalMaterial().sheen.copyTo(this.mInternalMaterial.sheen),e.getInternalMaterial().subSurface.copyTo(this.mInternalMaterial.subSurface),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(ys);function Y_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var K_=function(e){(0,g.Z)(n,e);var t=Y_(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(i),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(i),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(i),"mNormalMapScale",D.One()),(0,l.Z)((0,_.Z)(i),"mBumpMapLevel",1),(0,l.Z)((0,_.Z)(i),"mLightMapIntensity",1),(0,l.Z)((0,_.Z)(i),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(i),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(i),"mAoMap",void 0),(0,l.Z)((0,_.Z)(i),"mBumpMap",void 0),(0,l.Z)((0,_.Z)(i),"mNormalMap",void 0),(0,l.Z)((0,_.Z)(i),"mLightMap",void 0),(0,l.Z)((0,_.Z)(i),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(i),"mEmissiveMap",void 0),(0,l.Z)((0,_.Z)(i),"mRoughnessMap",void 0),(0,l.Z)((0,_.Z)(i),"mMetalnessMap",void 0),(0,l.Z)((0,_.Z)(i),"mSpecularMap",void 0),(0,l.Z)((0,_.Z)(i),"mDirty",!1),(0,l.Z)((0,_.Z)(i),"mAlphaTestEnabled",!1),(0,l.Z)((0,_.Z)(i),"mTransparent",!1),(0,l.Z)((0,_.Z)(i),"mFlatShading",!1),(0,l.Z)((0,_.Z)(i),"mPremultipliedAlpha",!1),i.mInternalMaterial=new BABYLON.PBRMaterial(e,r),i.mInternalMaterial.metadata={},i.setSide(Es.Front),i.mInternalMaterial.useAlphaFromAlbedoTexture=!0,i.mInternalMaterial.useLogarithmicDepth=!1,i.mInternalMaterial.maxSimultaneousLights=12,i.mInternalMaterial.usePhysicalLightFalloff=!1,i}return(0,c.Z)(n,[{key:"getClearCoat",value:function(){return this.mInternalMaterial.clearCoat.intensity}},{key:"setClearCoat",value:function(e){this.mInternalMaterial.clearCoat.isEnabled=!0,this.mInternalMaterial.clearCoat.intensity=e}},{key:"getClearCoatRoughness",value:function(){return this.mInternalMaterial.clearCoat.roughness}},{key:"setClearCoatRoughness",value:function(e){this.mInternalMaterial.clearCoat.isEnabled=!0,this.mInternalMaterial.clearCoat.roughness=e}},{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.albedoColor.set(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.albedoTexture=e?e.getInternalTexture():null,this.mInternalMaterial.albedoTexture&&(this.mInternalMaterial.albedoTexture.coordinatesMode=lk(e))}},{key:"useAlphaFromDiffuseMap",value:function(e){this.mInternalMaterial.useAlphaFromAlbedoTexture=e}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.opacityTexture=e?e.getInternalTexture():null,this.mInternalMaterial.opacityTexture&&(this.mInternalMaterial.opacityTexture.coordinatesMode=lk(e))}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.ambientTexture=e?e.getInternalTexture():null,this.mInternalMaterial.ambientTexture&&(this.mInternalMaterial.ambientTexture.coordinatesMode=lk(e))}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.ambientTextureStrength}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.ambientTextureStrength=e}},{key:"getSpecularMap",value:function(){return this.mSpecularMap}},{key:"setSpecularMap",value:function(e){this.mSpecularMap=e,this.mInternalMaterial.reflectivityTexture=e?e.getInternalTexture():null,this.mInternalMaterial.reflectivityTexture&&(this.mInternalMaterial.reflectivityTexture.coordinatesMode=lk(e))}},{key:"getEnvMap",value:function(){return this.mEnvMap}},{key:"setEnvMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.reflectionTexture=e?e.getInternalTexture():null,this.mInternalMaterial.reflectionTexture&&(this.mInternalMaterial.reflectionTexture.coordinatesMode=lk(e,!0))}},{key:"getReflectivity",value:function(){return this.mInternalMaterial.reflectionColor.r}},{key:"setReflectivity",value:function(e){this.mInternalMaterial.reflectionColor.set(e,e,e)}},{key:"getIOR",value:function(){return this.mInternalMaterial.indexOfRefraction}},{key:"setIOR",value:function(e){this.mInternalMaterial.indexOfRefraction=e}},{key:"getBumpMap",value:function(){return this.mBumpMap}},{key:"setBumpMap",value:function(e){this.mBumpMap=e,this.mInternalMaterial.bumpTexture=e?e.getInternalTexture():null,this.mInternalMaterial.bumpTexture&&(this.mInternalMaterial.bumpTexture.level=this.mBumpMapLevel,this.mInternalMaterial.bumpTexture.coordinatesMode=lk(e))}},{key:"getBumpScale",value:function(){return this.mBumpMapLevel}},{key:"setBumpScale",value:function(e){this.mBumpMapLevel=e,this.mInternalMaterial.bumpTexture&&(this.mInternalMaterial.bumpTexture.level=this.mBumpMapLevel)}},{key:"getDisplacementMap",value:function(){}},{key:"setDisplacementMap",value:function(e){}},{key:"getDisplacementScale",value:function(){return 1}},{key:"setDisplacementScale",value:function(e){}},{key:"getDisplacementBias",value:function(){return.01}},{key:"setDisplacementBias",value:function(e){}},{key:"getEmissiveColor",value:function(){return this.mEmissiveColor}},{key:"setEmissiveColor",value:function(e){this.mEmissiveColor.copy(e),this.mInternalMaterial.emissiveColor.set(this.mEmissiveColor.r,this.mEmissiveColor.g,this.mEmissiveColor.b)}},{key:"getEmissiveMap",value:function(){return this.mEmissiveMap}},{key:"setEmissiveMap",value:function(e){this.mEmissiveMap=e,this.mInternalMaterial.emissiveTexture=e?e.getInternalTexture():null,this.mInternalMaterial.emissiveTexture&&(this.mInternalMaterial.emissiveTexture.coordinatesMode=lk(e))}},{key:"getEmissiveIntensity",value:function(){return this.mInternalMaterial.emissiveIntensity}},{key:"setEmissiveIntensity",value:function(e){this.mInternalMaterial.emissiveIntensity=e}},{key:"getEnvMapIntensity",value:function(){return this.mInternalMaterial.environmentIntensity}},{key:"setEnvMapIntensity",value:function(e){this.mInternalMaterial.environmentIntensity=e}},{key:"getLightMap",value:function(){return this.mLightMap}},{key:"setLightMap",value:function(e){this.mLightMap=e,this.mInternalMaterial.lightmapTexture=e?e.getInternalTexture():null,this.mInternalMaterial.lightmapTexture&&(this.mInternalMaterial.lightmapTexture.level=this.mLightMapIntensity,this.mInternalMaterial.lightmapTexture.coordinatesMode=lk(e))}},{key:"getLightMapIntensity",value:function(){return this.mLightMapIntensity}},{key:"setLightMapIntensity",value:function(e){this.mLightMapIntensity=e,this.mInternalMaterial.lightmapTexture&&(this.mInternalMaterial.lightmapTexture.level=this.mLightMapIntensity)}},{key:"getMetalness",value:function(){return this.mInternalMaterial.metallic}},{key:"setMetalness",value:function(e){this.mInternalMaterial.metallic=e}},{key:"getMetalnessMap",value:function(){return this.mMetalnessMap}},{key:"setMetalnessMap",value:function(e){this.mMetalnessMap=e,this.mInternalMaterial.metallicTexture=e?e.getInternalTexture():null}},{key:"getNormalMap",value:function(){return this.mNormalMap}},{key:"setNormalMap",value:function(e){this.mNormalMap=e,this.mInternalMaterial.bumpTexture=e?e.getInternalTexture():null,this.mInternalMaterial.bumpTexture&&(this.setNormalScale(this.mNormalMapScale),this.mInternalMaterial.bumpTexture.coordinatesMode=lk(e))}},{key:"getNormalScale",value:function(){return this.mNormalMapScale}},{key:"setNormalScale",value:function(e){this.mNormalMapScale.copy(e),this.mInternalMaterial.bumpTexture&&this.mInternalMaterial.bumpTexture.scale(this.mNormalMapScale.x)}},{key:"getRoughness",value:function(){return this.mInternalMaterial.microSurface}},{key:"setRoughness",value:function(e){this.mInternalMaterial.microSurface=e}},{key:"getRoughnessMap",value:function(){return this.mRoughnessMap}},{key:"setRoughnessMap",value:function(e){this.mRoughnessMap=e,this.mInternalMaterial.microSurfaceTexture=e?e.getInternalTexture():null,this.mInternalMaterial.microSurfaceTexture&&(this.mInternalMaterial.microSurfaceTexture.coordinatesMode=lk(e))}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fogEnabled}},{key:"setFog",value:function(e){this.mInternalMaterial.fogEnabled=e}},{key:"getDepthTest",value:function(){return!0}},{key:"setDepthTest",value:function(e){}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.disableDepthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.disableDepthWrite=!e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.alpha}},{key:"setOpacity",value:function(e){this.mInternalMaterial.alpha=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaCutOff}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaCutOff=e,(!this.mAlphaTestEnabled&&e>=1e-5||this.mAlphaTestEnabled&&e<1e-5)&&(this.mAlphaTestEnabled=e>=1e-5,this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,this.mTransparent))}},{key:"getTransparent",value:function(){return ok(this.mInternalMaterial.transparencyMode)}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,e)}},{key:"getAlphaMode",value:function(){return uk(this.mInternalMaterial.alphaMode).alphaMode}},{key:"setAlphaMode",value:function(e){this.mInternalMaterial.alphaMode=ck(e,this.mPremultipliedAlpha)}},{key:"getPremultipliedAlpha",value:function(){return this.mPremultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mPremultipliedAlpha=e,this.setAlphaMode(this.mInternalMaterial.alphaMode)}},{key:"getColorWrite",value:function(){return!this.mInternalMaterial.disableColorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.disableColorWrite=!e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return 1}},{key:"setWireframeLineWidth",value:function(e){}},{key:"getFreeze",value:function(){return this.mInternalMaterial.isFrozen}},{key:"setFreeze",value:function(e){e?this.mInternalMaterial.freeze():this.mInternalMaterial.unfreeze()}},{key:"getSide",value:function(){return ik(this.mInternalMaterial.backFaceCulling,!1)}},{key:"setSide",value:function(e){var t=ak(e);this.mInternalMaterial.backFaceCulling=t.cullingEnabled,t.cullBackFace?this.mInternalMaterial.sideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:this.mInternalMaterial.sideOrientation=BABYLON.Material.ClockWiseSideOrientation,this.mInternalMaterial.twoSidedLighting=e===Es.Double}},{key:"getFlatShading",value:function(){return this.mFlatShading}},{key:"setFlatShading",value:function(e){this.mFlatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.metadata}},{key:"setMetaData",value:function(e){this.mInternalMaterial.metadata=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,e&&this.mInternalMaterial.markDirty()}},{key:"dispose",value:function(){this.mInternalMaterial.dispose(!1,!1)}},{key:"cloneMaterial",value:function(){return new n(this.getName(),this.mInternalMaterial.getScene()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){var t=this;return this.mDiffuseColor.copy(e.mDiffuseColor),this.mEmissiveColor.copy(e.mEmissiveColor),this.mNormalMapScale.copy(e.mNormalMapScale),this.mBumpMapLevel=e.mBumpMapLevel,this.mLightMapIntensity=e.mLightMapIntensity,this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mBumpMap=e.mBumpMap,this.mNormalMap=e.mNormalMap,this.mLightMap=e.mLightMap,this.mEnvMap=e.mEnvMap,this.mEmissiveMap=e.mEmissiveMap,this.mRoughnessMap=e.mRoughnessMap,this.mMetalnessMap=e.mMetalnessMap,this.mSpecularMap=e.mSpecularMap,this.mDirty=e.mDirty,this.mAlphaTestEnabled=e.mAlphaTestEnabled,this.mTransparent=e.mTransparent,this.mFlatShading=e.mFlatShading,this.mPremultipliedAlpha=e.mPremultipliedAlpha,BABYLON.SerializationHelper.Clone((function(){return t}),e),this.mInternalMaterial.id=e.getInternalMaterial().name,this.mInternalMaterial.name=e.getInternalMaterial().name,e.getInternalMaterial().clearCoat.copyTo(this.mInternalMaterial.clearCoat),e.getInternalMaterial().anisotropy.copyTo(this.mInternalMaterial.anisotropy),e.getInternalMaterial().brdf.copyTo(this.mInternalMaterial.brdf),e.getInternalMaterial().sheen.copyTo(this.mInternalMaterial.sheen),e.getInternalMaterial().subSurface.copyTo(this.mInternalMaterial.subSurface),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(ds);function X_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var $_=function(e){(0,g.Z)(n,e);var t=X_(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(i),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(i),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(i),"mDirty",!1),(0,l.Z)((0,_.Z)(i),"mAlphaTestEnabled",!1),(0,l.Z)((0,_.Z)(i),"mAlphaCutOff",0),(0,l.Z)((0,_.Z)(i),"mTransparent",!1),(0,l.Z)((0,_.Z)(i),"mFlatShading",!1),(0,l.Z)((0,_.Z)(i),"mPremultipliedAlpha",!1),i.mInternalMaterial=new BABYLON.StandardMaterial(e,r),i.mInternalMaterial.metadata={},i.setSide(Es.Front),i.mInternalMaterial.maxSimultaneousLights=12,i.mInternalMaterial.useAlphaFromDiffuseTexture=!0,i.mInternalMaterial.disableLighting=!0,i.mInternalMaterial.specularColor=BABYLON.Color3.Black(),i.mInternalMaterial.emissiveColor=BABYLON.Color3.White(),i}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.emissiveColor.set(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.diffuseTexture=e?e.getInternalTexture():null}},{key:"needAlphaTesting",value:function(){return this.mInternalMaterial.needAlphaTesting()}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fogEnabled}},{key:"setFog",value:function(e){this.mInternalMaterial.fogEnabled=e}},{key:"getDepthTest",value:function(){return!0}},{key:"setDepthTest",value:function(e){}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.disableDepthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.disableDepthWrite=!e,this.mInternalMaterial.depthFunction=e?0:BABYLON.Engine.ALWAYS}},{key:"getOpacity",value:function(){return this.mInternalMaterial.alpha}},{key:"setOpacity",value:function(e){this.mInternalMaterial.alpha=e}},{key:"getAlphaTest",value:function(){return this.mAlphaCutOff}},{key:"setAlphaTest",value:function(e){this.mAlphaCutOff=e,(!this.mAlphaTestEnabled&&e>=1e-5||this.mAlphaTestEnabled&&e<1e-5)&&(this.mAlphaTestEnabled=e>=1e-5,this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,this.mTransparent))}},{key:"getTransparent",value:function(){return ok(this.mInternalMaterial.transparencyMode)}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,e)}},{key:"getAlphaMode",value:function(){return uk(this.mInternalMaterial.alphaMode).alphaMode}},{key:"setAlphaMode",value:function(e){this.mInternalMaterial.alphaMode=ck(e,this.mPremultipliedAlpha)}},{key:"getPremultipliedAlpha",value:function(){return this.mPremultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mPremultipliedAlpha=e,this.setAlphaMode(this.mInternalMaterial.alphaMode)}},{key:"getColorWrite",value:function(){return!this.mInternalMaterial.disableColorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.disableColorWrite=!e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return 1}},{key:"setWireframeLineWidth",value:function(e){}},{key:"getFreeze",value:function(){return this.mInternalMaterial.isFrozen}},{key:"setFreeze",value:function(e){e?this.mInternalMaterial.freeze():this.mInternalMaterial.unfreeze()}},{key:"getSide",value:function(){return ik(this.mInternalMaterial.backFaceCulling,!1)}},{key:"setSide",value:function(e){var t=ak(e);this.mInternalMaterial.backFaceCulling=t.cullingEnabled,t.cullBackFace?this.mInternalMaterial.sideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:this.mInternalMaterial.sideOrientation=BABYLON.Material.ClockWiseSideOrientation}},{key:"getFlatShading",value:function(){return this.mFlatShading}},{key:"setFlatShading",value:function(e){this.mFlatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.metadata}},{key:"setMetaData",value:function(e){this.mInternalMaterial.metadata=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,e&&this.mInternalMaterial.markDirty()}},{key:"dispose",value:function(){this.mInternalMaterial.dispose(!1)}},{key:"cloneMaterial",value:function(){return new n(this.getName(),this.mInternalMaterial.getScene()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){var t=this;return this.mDiffuseColor.copy(e.mDiffuseColor),this.mDiffuseMap=e.mDiffuseMap,this.mDirty=e.mDirty,this.mAlphaTestEnabled=e.mAlphaTestEnabled,this.mAlphaCutOff=e.mAlphaCutOff,this.mTransparent=e.mTransparent,this.mFlatShading=e.mFlatShading,this.mPremultipliedAlpha=e.mPremultipliedAlpha,BABYLON.SerializationHelper.Clone((function(){return t}),e),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(Ms);function Q_(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var J_=function(e){(0,g.Z)(n,e);var t=Q_(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(i),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(i),"mEnvMapScale",D.One()),(0,l.Z)((0,_.Z)(i),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(i),"mLightMapIntensity",1),(0,l.Z)((0,_.Z)(i),"mEnvMapCombineOp",Jo.Multiply),(0,l.Z)((0,_.Z)(i),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(i),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(i),"mAoMap",void 0),(0,l.Z)((0,_.Z)(i),"mSpecularMap",void 0),(0,l.Z)((0,_.Z)(i),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(i),"mLightMap",void 0),(0,l.Z)((0,_.Z)(i),"mEmissiveMap",void 0),(0,l.Z)((0,_.Z)(i),"mDirty",!1),(0,l.Z)((0,_.Z)(i),"mAlphaTestEnabled",!1),(0,l.Z)((0,_.Z)(i),"mTransparent",!1),(0,l.Z)((0,_.Z)(i),"mFlatShading",!1),(0,l.Z)((0,_.Z)(i),"mPremultipliedAlpha",!1),i.mInternalMaterial=new BABYLON.PBRMaterial(e,r),i.mInternalMaterial.metadata={},i.setSide(Es.Front),i.mInternalMaterial.useAlphaFromAlbedoTexture=!0,i.mInternalMaterial.useLogarithmicDepth=!1,i.mInternalMaterial.maxSimultaneousLights=12,i.mInternalMaterial.usePhysicalLightFalloff=!1,i.mInternalMaterial.unlit=!0,i}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.albedoColor.set(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.albedoTexture=e?e.getInternalTexture():null,this.mInternalMaterial.albedoTexture&&(this.mInternalMaterial.albedoTexture.coordinatesMode=lk(e))}},{key:"useAlphaFromDiffuseMap",value:function(e){this.mInternalMaterial.useAlphaFromAlbedoTexture=e}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.opacityTexture=e?e.getInternalTexture():null}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.ambientTexture=e?e.getInternalTexture():null,this.mInternalMaterial.ambientTexture&&(this.mInternalMaterial.ambientTexture.coordinatesMode=lk(e))}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.ambientTextureStrength}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.ambientTextureStrength=e}},{key:"getSpecularMap",value:function(){return this.mSpecularMap}},{key:"setSpecularMap",value:function(e){this.mSpecularMap=e,this.mInternalMaterial.reflectivityTexture=e?e.getInternalTexture():null,this.mInternalMaterial.reflectivityTexture&&(this.mInternalMaterial.reflectivityTexture.coordinatesMode=lk(e))}},{key:"getEnvMap",value:function(){return this.mEnvMap}},{key:"setEnvMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.reflectionTexture=e?e.getInternalTexture():null,this.mInternalMaterial.reflectionTexture&&(this.mInternalMaterial.reflectionTexture.coordinatesMode=lk(e,!0))}},{key:"getEnvMapCombine",value:function(){return this.mEnvMapCombineOp}},{key:"setEnvMapCombine",value:function(e){this.mEnvMapCombineOp=e}},{key:"getReflectivity",value:function(){return this.mInternalMaterial.reflectionColor.r}},{key:"setReflectivity",value:function(e){this.mInternalMaterial.reflectionColor.set(e,e,e)}},{key:"getIOR",value:function(){return this.mInternalMaterial.indexOfRefraction}},{key:"setIOR",value:function(e){this.mInternalMaterial.indexOfRefraction=e}},{key:"getLightMap",value:function(){return this.mLightMap}},{key:"setLightMap",value:function(e){this.mLightMap=e,this.mInternalMaterial.lightmapTexture=e?e.getInternalTexture():null,this.mInternalMaterial.lightmapTexture&&(this.mInternalMaterial.lightmapTexture.level=this.mLightMapIntensity,this.mInternalMaterial.lightmapTexture.coordinatesMode=lk(e))}},{key:"getLightMapIntensity",value:function(){return this.mLightMapIntensity}},{key:"setLightMapIntensity",value:function(e){this.mLightMapIntensity=e,this.mInternalMaterial.lightmapTexture&&(this.mInternalMaterial.lightmapTexture.level=this.mLightMapIntensity)}},{key:"getEnvMapIntensity",value:function(){return this.mInternalMaterial.environmentIntensity}},{key:"setEnvMapIntensity",value:function(e){this.mInternalMaterial.environmentIntensity=e}},{key:"getEmissiveColor",value:function(){return this.mEmissiveColor}},{key:"setEmissiveColor",value:function(e){this.mEmissiveColor.copy(e),this.mInternalMaterial.emissiveColor.set(this.mEmissiveColor.r,this.mEmissiveColor.g,this.mEmissiveColor.b)}},{key:"getEmissiveMap",value:function(){return this.mEmissiveMap}},{key:"setEmissiveMap",value:function(e){this.mEmissiveMap=e,this.mInternalMaterial.emissiveTexture=e?e.getInternalTexture():null,this.mInternalMaterial.emissiveTexture&&(this.mInternalMaterial.emissiveTexture.coordinatesMode=lk(e))}},{key:"getEmissiveIntensity",value:function(){return this.mInternalMaterial.emissiveIntensity}},{key:"setEmissiveIntensity",value:function(e){this.mInternalMaterial.emissiveIntensity=e}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fogEnabled}},{key:"setFog",value:function(e){this.mInternalMaterial.fogEnabled=e}},{key:"getDepthTest",value:function(){return!0}},{key:"setDepthTest",value:function(e){}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.disableDepthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.disableDepthWrite=!e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.alpha}},{key:"setOpacity",value:function(e){this.mInternalMaterial.alpha=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaCutOff}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaCutOff=e,(!this.mAlphaTestEnabled&&e>=1e-5||this.mAlphaTestEnabled&&e<1e-5)&&(this.mAlphaTestEnabled=e>=1e-5,this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,this.mTransparent))}},{key:"getTransparent",value:function(){return ok(this.mInternalMaterial.transparencyMode)}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,e)}},{key:"getAlphaMode",value:function(){return uk(this.mInternalMaterial.alphaMode).alphaMode}},{key:"setAlphaMode",value:function(e){this.mInternalMaterial.alphaMode=ck(e,this.mPremultipliedAlpha)}},{key:"getPremultipliedAlpha",value:function(){return this.mPremultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mPremultipliedAlpha=e,this.setAlphaMode(this.mInternalMaterial.alphaMode)}},{key:"getColorWrite",value:function(){return!this.mInternalMaterial.disableColorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.disableColorWrite=!e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return 1}},{key:"setWireframeLineWidth",value:function(e){}},{key:"getFreeze",value:function(){return this.mInternalMaterial.isFrozen}},{key:"setFreeze",value:function(e){e?this.mInternalMaterial.freeze():this.mInternalMaterial.unfreeze()}},{key:"getSide",value:function(){return ik(this.mInternalMaterial.backFaceCulling,!1)}},{key:"setSide",value:function(e){var t=ak(e);this.mInternalMaterial.backFaceCulling=t.cullingEnabled,t.cullBackFace?this.mInternalMaterial.sideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:this.mInternalMaterial.sideOrientation=BABYLON.Material.ClockWiseSideOrientation,this.mInternalMaterial.twoSidedLighting=e===Es.Double}},{key:"getFlatShading",value:function(){return this.mFlatShading}},{key:"setFlatShading",value:function(e){this.mFlatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.metadata}},{key:"setMetaData",value:function(e){this.mInternalMaterial.metadata=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,e&&this.mInternalMaterial.markDirty()}},{key:"dispose",value:function(){this.mInternalMaterial.dispose(!1,!1)}},{key:"cloneMaterial",value:function(){return new n(this.getName(),this.mInternalMaterial.getScene()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){var t=this;return this.mDiffuseColor.copy(e.mDiffuseColor),this.mEmissiveColor.copy(e.mEmissiveColor),this.mEnvMapScale.copy(e.mEnvMapScale),this.mLightMapIntensity=e.mLightMapIntensity,this.mEnvMapCombineOp=e.mEnvMapCombineOp,this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mSpecularMap=e.mSpecularMap,this.mEnvMap=e.mEnvMap,this.mLightMap=e.mLightMap,this.mEmissiveMap=e.mEmissiveMap,this.mDirty=e.mDirty,this.mAlphaTestEnabled=e.mAlphaTestEnabled,this.mTransparent=e.mTransparent,this.mFlatShading=e.mFlatShading,this.mPremultipliedAlpha=e.mPremultipliedAlpha,BABYLON.SerializationHelper.Clone((function(){return t}),e),this.mInternalMaterial.id=e.getInternalMaterial().name,this.mInternalMaterial.name=e.getInternalMaterial().name,e.getInternalMaterial().clearCoat.copyTo(this.mInternalMaterial.clearCoat),e.getInternalMaterial().anisotropy.copyTo(this.mInternalMaterial.anisotropy),e.getInternalMaterial().brdf.copyTo(this.mInternalMaterial.brdf),e.getInternalMaterial().sheen.copyTo(this.mInternalMaterial.sheen),e.getInternalMaterial().subSurface.copyTo(this.mInternalMaterial.subSurface),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(Cs);function ex(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var tx=function(e){(0,g.Z)(n,e);var t=ex(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(i),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(i),"mEnvMapCombineOp",Jo.Multiply),(0,l.Z)((0,_.Z)(i),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(i),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(i),"mAoMap",void 0),(0,l.Z)((0,_.Z)(i),"mSpecularMap",void 0),(0,l.Z)((0,_.Z)(i),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(i),"mDirty",!1),(0,l.Z)((0,_.Z)(i),"mAlphaTestEnabled",!1),(0,l.Z)((0,_.Z)(i),"mTransparent",!1),(0,l.Z)((0,_.Z)(i),"mFlatShading",!1),(0,l.Z)((0,_.Z)(i),"mPremultipliedAlpha",!1),i.mInternalMaterial=new BABYLON.PBRMaterial(e,r),i.mInternalMaterial.metadata={},i.setSide(Es.Front),i.mInternalMaterial.useAlphaFromAlbedoTexture=!0,i.mInternalMaterial.useLogarithmicDepth=!1,i.mInternalMaterial.maxSimultaneousLights=12,i.mInternalMaterial.usePhysicalLightFalloff=!1,i.mInternalMaterial.unlit=!0,i}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.albedoColor.set(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.albedoTexture=e?e.getInternalTexture():null,this.mInternalMaterial.albedoTexture&&(this.mInternalMaterial.albedoTexture.coordinatesMode=lk(e))}},{key:"useAlphaFromDiffuseMap",value:function(e){this.mInternalMaterial.useAlphaFromAlbedoTexture=e}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.opacityTexture=e?e.getInternalTexture():null,this.mInternalMaterial.opacityTexture&&(this.mInternalMaterial.opacityTexture.coordinatesMode=lk(e))}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.ambientTexture=e?e.getInternalTexture():null,this.mInternalMaterial.ambientTexture&&(this.mInternalMaterial.ambientTexture.coordinatesMode=lk(e))}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.ambientTextureStrength}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.ambientTextureStrength=e}},{key:"getSpecularMap",value:function(){return this.mSpecularMap}},{key:"setSpecularMap",value:function(e){this.mSpecularMap=e,this.mInternalMaterial.reflectivityTexture=e?e.getInternalTexture():null,this.mInternalMaterial.reflectivityTexture&&(this.mInternalMaterial.reflectivityTexture.coordinatesMode=lk(e))}},{key:"getEnvMap",value:function(){return this.mEnvMap}},{key:"setEnvMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.reflectionTexture=e?e.getInternalTexture():null,this.mInternalMaterial.reflectionTexture&&(this.mInternalMaterial.reflectionTexture.coordinatesMode=lk(e,!0))}},{key:"getEnvMapCombine",value:function(){return this.mEnvMapCombineOp}},{key:"setEnvMapCombine",value:function(e){this.mEnvMapCombineOp=e}},{key:"getReflectivity",value:function(){return this.mInternalMaterial.reflectionColor.r}},{key:"setReflectivity",value:function(e){this.mInternalMaterial.reflectionColor.set(e,e,e)}},{key:"getIOR",value:function(){return this.mInternalMaterial.indexOfRefraction}},{key:"setIOR",value:function(e){this.mInternalMaterial.indexOfRefraction=e}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fogEnabled}},{key:"setFog",value:function(e){this.mInternalMaterial.fogEnabled=e}},{key:"getDepthTest",value:function(){return!0}},{key:"setDepthTest",value:function(e){}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.disableDepthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.disableDepthWrite=!e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.alpha}},{key:"setOpacity",value:function(e){this.mInternalMaterial.alpha=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaCutOff}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaCutOff=e,(!this.mAlphaTestEnabled&&e>=1e-5||this.mAlphaTestEnabled&&e<1e-5)&&(this.mAlphaTestEnabled=e>=1e-5,this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,this.mTransparent))}},{key:"getTransparent",value:function(){return ok(this.mInternalMaterial.transparencyMode)}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,e)}},{key:"getAlphaMode",value:function(){return uk(this.mInternalMaterial.alphaMode).alphaMode}},{key:"setAlphaMode",value:function(e){this.mInternalMaterial.alphaMode=ck(e,this.mPremultipliedAlpha)}},{key:"getPremultipliedAlpha",value:function(){return this.mPremultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mPremultipliedAlpha=e,this.setAlphaMode(this.mInternalMaterial.alphaMode)}},{key:"getColorWrite",value:function(){return!this.mInternalMaterial.disableColorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.disableColorWrite=!e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return 1}},{key:"setWireframeLineWidth",value:function(e){}},{key:"getFreeze",value:function(){return this.mInternalMaterial.isFrozen}},{key:"setFreeze",value:function(e){e?this.mInternalMaterial.freeze():this.mInternalMaterial.unfreeze()}},{key:"getSide",value:function(){return ik(this.mInternalMaterial.backFaceCulling,!1)}},{key:"setSide",value:function(e){var t=ak(e);this.mInternalMaterial.backFaceCulling=t.cullingEnabled,t.cullBackFace?this.mInternalMaterial.sideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:this.mInternalMaterial.sideOrientation=BABYLON.Material.ClockWiseSideOrientation,this.mInternalMaterial.twoSidedLighting=e===Es.Double}},{key:"getFlatShading",value:function(){return this.mFlatShading}},{key:"setFlatShading",value:function(e){this.mFlatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.metadata}},{key:"setMetaData",value:function(e){this.mInternalMaterial.metadata=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,e&&this.mInternalMaterial.markDirty()}},{key:"dispose",value:function(){this.mInternalMaterial.dispose(!1,!1)}},{key:"cloneMaterial",value:function(){return new n(this.getName(),this.mInternalMaterial.getScene()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){var t=this;return this.mDiffuseColor.copy(e.mDiffuseColor),this.mEnvMapCombineOp=e.mEnvMapCombineOp,this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mSpecularMap=e.mSpecularMap,this.mEnvMap=e.mEnvMap,this.mDirty=e.mDirty,this.mAlphaTestEnabled=e.mAlphaTestEnabled,this.mTransparent=e.mTransparent,this.mFlatShading=e.mFlatShading,this.mPremultipliedAlpha=e.mPremultipliedAlpha,BABYLON.SerializationHelper.Clone((function(){return t}),e),this.mInternalMaterial.id=e.getInternalMaterial().name,this.mInternalMaterial.name=e.getInternalMaterial().name,e.getInternalMaterial().clearCoat.copyTo(this.mInternalMaterial.clearCoat),e.getInternalMaterial().anisotropy.copyTo(this.mInternalMaterial.anisotropy),e.getInternalMaterial().brdf.copyTo(this.mInternalMaterial.brdf),e.getInternalMaterial().sheen.copyTo(this.mInternalMaterial.sheen),e.getInternalMaterial().subSurface.copyTo(this.mInternalMaterial.subSurface),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(as);function nx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var rx=function(e){(0,g.Z)(n,e);var t=nx(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(i),"mNormalMapScale",D.One()),(0,l.Z)((0,_.Z)(i),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(i),"mSpecularColor",new so(.04,.067,.067)),(0,l.Z)((0,_.Z)(i),"mShininess",30),(0,l.Z)((0,_.Z)(i),"mLightMapIntensity",1),(0,l.Z)((0,_.Z)(i),"mBumpMapLevel",1),(0,l.Z)((0,_.Z)(i),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(i),"mEnvMapCombineOp",Jo.Multiply),(0,l.Z)((0,_.Z)(i),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(i),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(i),"mAoMap",void 0),(0,l.Z)((0,_.Z)(i),"mBumpMap",void 0),(0,l.Z)((0,_.Z)(i),"mNormalMap",void 0),(0,l.Z)((0,_.Z)(i),"mLightMap",void 0),(0,l.Z)((0,_.Z)(i),"mEmissiveMap",void 0),(0,l.Z)((0,_.Z)(i),"mSpecularMap",void 0),(0,l.Z)((0,_.Z)(i),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(i),"mDirty",!1),(0,l.Z)((0,_.Z)(i),"mAlphaTestEnabled",!1),(0,l.Z)((0,_.Z)(i),"mTransparent",!1),(0,l.Z)((0,_.Z)(i),"mFlatShading",!1),(0,l.Z)((0,_.Z)(i),"mPremultipliedAlpha",!1),i.mInternalMaterial=new BABYLON.PBRMaterial(e,r),i.mInternalMaterial.metadata={},i.setSide(Es.Front),i.mInternalMaterial.useAlphaFromAlbedoTexture=!0,i.mInternalMaterial.useLogarithmicDepth=!1,i.mInternalMaterial.maxSimultaneousLights=12,i.mInternalMaterial.usePhysicalLightFalloff=!1,i}return(0,c.Z)(n,[{key:"getBumpMap",value:function(){return this.mBumpMap}},{key:"setBumpMap",value:function(e){this.mBumpMap=e,this.mInternalMaterial.bumpTexture=e?e.getInternalTexture():null,this.mInternalMaterial.bumpTexture&&(this.mInternalMaterial.bumpTexture.level=this.mBumpMapLevel,this.mInternalMaterial.bumpTexture.coordinatesMode=lk(e))}},{key:"getBumpScale",value:function(){return this.mBumpMapLevel}},{key:"setBumpScale",value:function(e){this.mBumpMapLevel=e,this.mInternalMaterial.bumpTexture&&(this.mInternalMaterial.bumpTexture.level=this.mBumpMapLevel)}},{key:"getNormalMap",value:function(){return this.mNormalMap}},{key:"setNormalMap",value:function(e){this.mNormalMap=e,this.mInternalMaterial.bumpTexture=e?e.getInternalTexture():null,this.mInternalMaterial.bumpTexture&&(this.setNormalScale(this.mNormalMapScale),this.mInternalMaterial.bumpTexture.coordinatesMode=lk(e))}},{key:"getNormalScale",value:function(){return this.mNormalMapScale}},{key:"setNormalScale",value:function(e){this.mNormalMapScale.copy(e),this.mInternalMaterial.bumpTexture&&this.mInternalMaterial.bumpTexture.scale(this.mNormalMapScale.x)}},{key:"getDisplacementMap",value:function(){}},{key:"setDisplacementMap",value:function(e){}},{key:"getDisplacementScale",value:function(){return 1}},{key:"setDisplacementScale",value:function(e){}},{key:"getDisplacementBias",value:function(){return.01}},{key:"setDisplacementBias",value:function(e){}},{key:"getSpecular",value:function(){return this.mSpecularColor}},{key:"setSpecular",value:function(e){this.mSpecularColor.copy(e),this.mInternalMaterial.reflectivityColor.set(this.mSpecularColor.r,this.mSpecularColor.g,this.mSpecularColor.b)}},{key:"getLightMap",value:function(){return this.mLightMap}},{key:"setLightMap",value:function(e){this.mLightMap=e,this.mInternalMaterial.lightmapTexture=e?e.getInternalTexture():null,this.mInternalMaterial.lightmapTexture&&(this.mInternalMaterial.lightmapTexture.level=this.mLightMapIntensity,this.mInternalMaterial.lightmapTexture.coordinatesMode=lk(e))}},{key:"getLightMapIntensity",value:function(){return this.mLightMapIntensity}},{key:"setLightMapIntensity",value:function(e){this.mLightMapIntensity=e,this.mInternalMaterial.lightmapTexture&&(this.mInternalMaterial.lightmapTexture.level=this.mLightMapIntensity)}},{key:"getEnvMapIntensity",value:function(){return this.mInternalMaterial.environmentIntensity}},{key:"setEnvMapIntensity",value:function(e){this.mInternalMaterial.environmentIntensity=e}},{key:"getEmissiveColor",value:function(){return this.mEmissiveColor}},{key:"setEmissiveColor",value:function(e){this.mEmissiveColor.copy(e),this.mInternalMaterial.emissiveColor.set(this.mEmissiveColor.r,this.mEmissiveColor.g,this.mEmissiveColor.b)}},{key:"getEmissiveMap",value:function(){return this.mEmissiveMap}},{key:"setEmissiveMap",value:function(e){this.mEmissiveMap=e,this.mInternalMaterial.emissiveTexture=e?e.getInternalTexture():null,this.mInternalMaterial.emissiveTexture&&(this.mInternalMaterial.emissiveTexture.coordinatesMode=lk(e))}},{key:"getEmissiveIntensity",value:function(){return this.mInternalMaterial.emissiveIntensity}},{key:"setEmissiveIntensity",value:function(e){this.mInternalMaterial.emissiveIntensity=e}},{key:"getShininess",value:function(){return this.mShininess}},{key:"setShininess",value:function(e){this.mShininess=e,this.mInternalMaterial.specularIntensity=this.mShininess/100}},{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.albedoColor.set(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.albedoTexture=e?e.getInternalTexture():null,this.mInternalMaterial.albedoTexture&&(this.mInternalMaterial.albedoTexture.coordinatesMode=lk(e))}},{key:"useAlphaFromDiffuseMap",value:function(e){this.mInternalMaterial.useAlphaFromAlbedoTexture=e}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.opacityTexture=e?e.getInternalTexture():null,this.mInternalMaterial.opacityTexture&&(this.mInternalMaterial.opacityTexture.coordinatesMode=lk(e))}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.ambientTexture=e?e.getInternalTexture():null,this.mInternalMaterial.ambientTexture&&(this.mInternalMaterial.ambientTexture.coordinatesMode=lk(e))}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.ambientTextureStrength}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.ambientTextureStrength=e}},{key:"getSpecularMap",value:function(){return this.mSpecularMap}},{key:"setSpecularMap",value:function(e){this.mSpecularMap=e,this.mInternalMaterial.reflectivityTexture=e?e.getInternalTexture():null,this.mInternalMaterial.reflectivityTexture&&(this.mInternalMaterial.reflectivityTexture.coordinatesMode=lk(e))}},{key:"getEnvMap",value:function(){return this.mEnvMap}},{key:"setEnvMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.reflectionTexture=e?e.getInternalTexture():null,this.mInternalMaterial.reflectionTexture&&(this.mInternalMaterial.reflectionTexture.coordinatesMode=lk(e,!0))}},{key:"getEnvMapCombine",value:function(){return this.mEnvMapCombineOp}},{key:"setEnvMapCombine",value:function(e){this.mEnvMapCombineOp=e}},{key:"getReflectivity",value:function(){return this.mInternalMaterial.reflectionColor.r}},{key:"setReflectivity",value:function(e){this.mInternalMaterial.reflectionColor.set(e,e,e)}},{key:"getIOR",value:function(){return this.mInternalMaterial.indexOfRefraction}},{key:"setIOR",value:function(e){this.mInternalMaterial.indexOfRefraction=e}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fogEnabled}},{key:"setFog",value:function(e){this.mInternalMaterial.fogEnabled=e}},{key:"getDepthTest",value:function(){return!0}},{key:"setDepthTest",value:function(e){}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.disableDepthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.disableDepthWrite=!e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.alpha}},{key:"setOpacity",value:function(e){this.mInternalMaterial.alpha=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaCutOff}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaCutOff=e,(!this.mAlphaTestEnabled&&e>=1e-5||this.mAlphaTestEnabled&&e<1e-5)&&(this.mAlphaTestEnabled=e>=1e-5,this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,this.mTransparent))}},{key:"getTransparent",value:function(){return ok(this.mInternalMaterial.transparencyMode)}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,e)}},{key:"getAlphaMode",value:function(){return uk(this.mInternalMaterial.alphaMode).alphaMode}},{key:"setAlphaMode",value:function(e){this.mInternalMaterial.alphaMode=ck(e,this.mPremultipliedAlpha)}},{key:"getPremultipliedAlpha",value:function(){return this.mPremultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mPremultipliedAlpha=e,this.setAlphaMode(this.mInternalMaterial.alphaMode)}},{key:"getColorWrite",value:function(){return!this.mInternalMaterial.disableColorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.disableColorWrite=!e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return 1}},{key:"setWireframeLineWidth",value:function(e){}},{key:"getFreeze",value:function(){return this.mInternalMaterial.isFrozen}},{key:"setFreeze",value:function(e){e?this.mInternalMaterial.freeze():this.mInternalMaterial.unfreeze()}},{key:"getSide",value:function(){return ik(this.mInternalMaterial.backFaceCulling,!1)}},{key:"setSide",value:function(e){var t=ak(e);this.mInternalMaterial.backFaceCulling=t.cullingEnabled,t.cullBackFace?this.mInternalMaterial.sideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:this.mInternalMaterial.sideOrientation=BABYLON.Material.ClockWiseSideOrientation,this.mInternalMaterial.twoSidedLighting=e===Es.Double}},{key:"getFlatShading",value:function(){return this.mFlatShading}},{key:"setFlatShading",value:function(e){this.mFlatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.metadata}},{key:"setMetaData",value:function(e){this.mInternalMaterial.metadata=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,e&&this.mInternalMaterial.markDirty()}},{key:"dispose",value:function(){this.mInternalMaterial.dispose(!1,!1)}},{key:"cloneMaterial",value:function(){return new n(this.getName(),this.mInternalMaterial.getScene()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){var t=this;return this.mNormalMapScale.copy(e.mNormalMapScale),this.mEmissiveColor.copy(e.mEmissiveColor),this.mSpecularColor.copy(e.mSpecularColor),this.mShininess=e.mShininess,this.mLightMapIntensity=e.mLightMapIntensity,this.mBumpMapLevel=e.mBumpMapLevel,this.mDiffuseColor.copy(e.mDiffuseColor),this.mEnvMapCombineOp=e.mEnvMapCombineOp,this.mDirty=e.mDirty,this.mAlphaTestEnabled=e.mAlphaTestEnabled,this.mTransparent=e.mTransparent,this.mFlatShading=e.mFlatShading,this.mPremultipliedAlpha=e.mPremultipliedAlpha,this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mBumpMap=e.mBumpMap,this.mNormalMap=e.mNormalMap,this.mLightMap=e.mLightMap,this.mEmissiveMap=e.mEmissiveMap,this.mSpecularMap=e.mSpecularMap,this.mEnvMap=e.mEnvMap,BABYLON.SerializationHelper.Clone((function(){return t}),e),this.mInternalMaterial.id=e.getInternalMaterial().name,this.mInternalMaterial.name=e.getInternalMaterial().name,e.getInternalMaterial().clearCoat.copyTo(this.mInternalMaterial.clearCoat),e.getInternalMaterial().anisotropy.copyTo(this.mInternalMaterial.anisotropy),e.getInternalMaterial().brdf.copyTo(this.mInternalMaterial.brdf),e.getInternalMaterial().sheen.copyTo(this.mInternalMaterial.sheen),e.getInternalMaterial().subSurface.copyTo(this.mInternalMaterial.subSurface),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(cs);function ix(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var ax=function(e){(0,g.Z)(n,e);var t=ix(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(i),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(i),"mDirty",!1),(0,l.Z)((0,_.Z)(i),"mAlphaTestEnabled",!1),(0,l.Z)((0,_.Z)(i),"mTransparent",!1),(0,l.Z)((0,_.Z)(i),"mFlatShading",!1),(0,l.Z)((0,_.Z)(i),"mPremultipliedAlpha",!1),i.mInternalMaterial=new BABYLON.StandardMaterial(e,r),i.mInternalMaterial.metadata={},i.setSide(Es.Front),i.mInternalMaterial.useAlphaFromDiffuseTexture=!0,i.mInternalMaterial.useLogarithmicDepth=!1,i.mInternalMaterial.maxSimultaneousLights=12,i.mInternalMaterial.disableLighting=!1,i.mInternalMaterial.specularColor=BABYLON.Color3.Black(),i.mInternalMaterial.emissiveColor=BABYLON.Color3.White(),i.mInternalMaterial.diffuseColor=BABYLON.Color3.White(),i}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.emissiveColor.set(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fogEnabled}},{key:"setFog",value:function(e){this.mInternalMaterial.fogEnabled=e}},{key:"getDepthTest",value:function(){return!0}},{key:"setDepthTest",value:function(e){}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.disableDepthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.disableDepthWrite=!e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.alpha}},{key:"setOpacity",value:function(e){this.mInternalMaterial.alpha=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaCutOff}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaCutOff=e,(!this.mAlphaTestEnabled&&e>=1e-5||this.mAlphaTestEnabled&&e<1e-5)&&(this.mAlphaTestEnabled=e>=1e-5,this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,this.mTransparent))}},{key:"getTransparent",value:function(){return ok(this.mInternalMaterial.transparencyMode)}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparencyMode=sk(this.mAlphaTestEnabled,e)}},{key:"getAlphaMode",value:function(){return uk(this.mInternalMaterial.alphaMode).alphaMode}},{key:"setAlphaMode",value:function(e){this.mInternalMaterial.alphaMode=ck(e,this.mPremultipliedAlpha)}},{key:"getPremultipliedAlpha",value:function(){return this.mPremultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mPremultipliedAlpha=e,this.setAlphaMode(this.mInternalMaterial.alphaMode)}},{key:"getColorWrite",value:function(){return!this.mInternalMaterial.disableColorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.disableColorWrite=!e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return 1}},{key:"setWireframeLineWidth",value:function(e){}},{key:"getFreeze",value:function(){return this.mInternalMaterial.isFrozen}},{key:"setFreeze",value:function(e){e?this.mInternalMaterial.freeze():this.mInternalMaterial.unfreeze()}},{key:"getSide",value:function(){return ik(this.mInternalMaterial.backFaceCulling,!1)}},{key:"setSide",value:function(e){var t=ak(e);this.mInternalMaterial.backFaceCulling=t.cullingEnabled,t.cullBackFace?this.mInternalMaterial.sideOrientation=BABYLON.Material.CounterClockWiseSideOrientation:this.mInternalMaterial.sideOrientation=BABYLON.Material.ClockWiseSideOrientation,this.mInternalMaterial.twoSidedLighting=e===Es.Double}},{key:"getFlatShading",value:function(){return this.mFlatShading}},{key:"setFlatShading",value:function(e){this.mFlatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.metadata}},{key:"setMetaData",value:function(e){this.mInternalMaterial.metadata=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,e&&this.mInternalMaterial.markDirty()}},{key:"dispose",value:function(){this.mInternalMaterial.dispose(!1,!1)}},{key:"cloneMaterial",value:function(){return new n(this.getName(),this.mInternalMaterial.getScene()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){var t=this;return this.mDiffuseColor.copy(e.mDiffuseColor),this.mDirty=e.mDirty,this.mAlphaTestEnabled=e.mAlphaTestEnabled,this.mTransparent=e.mTransparent,this.mFlatShading=e.mFlatShading,this.mPremultipliedAlpha=e.mPremultipliedAlpha,BABYLON.SerializationHelper.Clone((function(){return t}),e),this.mInternalMaterial.id=e.getInternalMaterial().name,this.mInternalMaterial.name=e.getInternalMaterial().name,this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(Ds),ox=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mMediaId",void 0),(0,l.Z)(this,"mDisposed",!1),(0,l.Z)(this,"mLayer",void 0),this.mMediaId=t}return(0,c.Z)(e,[{key:"enable",value:function(e){var t=this;$s.getInstance().resolveModel(this.mMediaId).then((function(n){t.mDisposed||(t.mLayer=new BABYLON.Layer("background-layer",n.source_url,e,!0,new BABYLON.Color4(1,1,1,1)))}),(function(e){qe.qL.error("Failed to enable layer:",e)}))}},{key:"disable",value:function(){this.mDisposed=!0,this.mLayer&&(this.mLayer.dispose(),delete this.mLayer)}}]),e}(),sx=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mMediaId",void 0),(0,l.Z)(this,"mDisposed",!1),(0,l.Z)(this,"mSkybox",void 0),(0,l.Z)(this,"mMaterial",void 0),(0,l.Z)(this,"mTexture",void 0),this.mMediaId=t}return(0,c.Z)(e,[{key:"enable",value:function(e){var t=this;$s.getInstance().resolveModel(this.mMediaId).then((function(n){t.mDisposed||(t.mTexture=new BABYLON.EquiRectangularCubeTexture(n.source_url,e,1024),t.mSkybox=BABYLON.MeshBuilder.CreateBox("background-equirect-mesh",{size:1e3,updatable:!1},e),t.mSkybox.renderingGroupId=0,t.mSkybox.infiniteDistance=!0,t.mSkybox.isPickable=!1,t.mSkybox.isVisible=!0,t.mSkybox.visibility=1,t.mSkybox.alwaysSelectAsActiveMesh=!0,t.mSkybox.forceRenderingWhenOccluded=!0,t.mSkybox.isOccluded=!1,t.mSkybox.occlusionType=BABYLON.Mesh.OCCLUSION_TYPE_NONE,t.mSkybox.ignoreCameraMaxZ=!0,t.mMaterial=new BABYLON.PBRMaterial("background-equirect-material",e),t.mMaterial.cullBackFaces=!1,t.mMaterial.backFaceCulling=!1,t.mMaterial.reflectionTexture=t.mTexture,t.mMaterial.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,t.mMaterial.microSurface=1,t.mMaterial.specularIntensity=0,t.mMaterial.disableLighting=!1,t.mSkybox.material=t.mMaterial)}),(function(e){qe.qL.warn("failed to enable layer: ",e)}))}},{key:"disable",value:function(){this.mDisposed=!0,this.mSkybox&&(this.mSkybox.dispose(),delete this.mSkybox),this.mMaterial&&(this.mMaterial.dispose(),delete this.mMaterial),this.mTexture&&(this.mTexture.dispose(),delete this.mTexture)}}]),e}(),ux=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mMediaIds",void 0),(0,l.Z)(this,"mDisposed",!1),(0,l.Z)(this,"mSkybox",void 0),(0,l.Z)(this,"mMaterial",void 0),(0,l.Z)(this,"mTexture",void 0),this.mMediaIds=t}var n;return(0,c.Z)(e,[{key:"loadMediaModels",value:(n=t(r().mark((function e(){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mMediaIds.map(function(){var e=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$s.getInstance().resolveModel(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",Promise.all(n));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"enable",value:function(e){var t=this;this.loadMediaModels().then((function(n){if(!t.mDisposed){var r=n.map((function(e){return e.source_url}));t.mTexture=BABYLON.CubeTexture.CreateFromImages([r[0],r[2],r[4],r[1],r[3],r[5]],e,!1),t.mTexture.name="background-skybox-texture",t.mTexture.sphericalPolynomial=new BABYLON.SphericalPolynomial,t.mSkybox=BABYLON.MeshBuilder.CreateBox("background-skybox-mesh",{size:1e3,updatable:!1,sideOrientation:BABYLON.Mesh.BACKSIDE},e),t.mSkybox.renderingGroupId=0,t.mSkybox.infiniteDistance=!0,t.mSkybox.isPickable=!1,t.mSkybox.isVisible=!0,t.mSkybox.visibility=1,t.mSkybox.alwaysSelectAsActiveMesh=!0,t.mSkybox.forceRenderingWhenOccluded=!0,t.mSkybox.isOccluded=!1,t.mSkybox.occlusionType=BABYLON.Mesh.OCCLUSION_TYPE_NONE,t.mSkybox.ignoreCameraMaxZ=!0,t.mMaterial=new BABYLON.PBRMaterial("background-skybox-material",e),t.mMaterial.cullBackFaces=!1,t.mMaterial.backFaceCulling=!1,t.mMaterial.reflectionTexture=t.mTexture,t.mMaterial.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,t.mMaterial.reflectionTexture.sphericalPolynomial=new BABYLON.SphericalPolynomial,t.mMaterial.microSurface=1,t.mMaterial.specularIntensity=0,t.mMaterial.disableLighting=!1,t.mSkybox.material=t.mMaterial}}),(function(e){qe.qL.error("failed to enable layer:",e)}))}},{key:"disable",value:function(){this.mDisposed=!0,this.mSkybox&&(this.mSkybox.dispose(),delete this.mSkybox),this.mMaterial&&(this.mMaterial.dispose(),delete this.mMaterial),this.mTexture&&(this.mTexture.dispose(),delete this.mTexture)}}]),e}(),cx=function(){function e(t,n,r){(0,u.Z)(this,e),(0,l.Z)(this,"mDisposed",!1),(0,l.Z)(this,"mSkybox",void 0),(0,l.Z)(this,"mMaterial",void 0),(0,l.Z)(this,"mTexture",void 0),(0,l.Z)(this,"mScale",void 0),(0,l.Z)(this,"mBlur",void 0),this.mTexture=t.clone(),this.mScale=n,this.mBlur=r}return(0,c.Z)(e,[{key:"enable",value:function(e){!this.mDisposed&&this.mTexture&&(this.mSkybox=BABYLON.MeshBuilder.CreateBox("background-env-mesh",{size:this.mScale,updatable:!1},e),this.mSkybox.renderingGroupId=0,this.mSkybox.infiniteDistance=!0,this.mSkybox.isPickable=!1,this.mSkybox.isVisible=!0,this.mSkybox.visibility=1,this.mSkybox.alwaysSelectAsActiveMesh=!0,this.mSkybox.forceRenderingWhenOccluded=!0,this.mSkybox.isOccluded=!1,this.mSkybox.occlusionType=BABYLON.Mesh.OCCLUSION_TYPE_NONE,this.mSkybox.ignoreCameraMaxZ=!0,this.mMaterial=new BABYLON.PBRMaterial("background-env-material",e),this.mMaterial.backFaceCulling=!1,this.mMaterial.reflectionTexture=this.mTexture,this.mMaterial.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,this.mMaterial.microSurface=1-this.mBlur,this.mMaterial.twoSidedLighting=!0,this.mMaterial.specularIntensity=0,this.mMaterial.disableLighting=!1,this.mSkybox.material=this.mMaterial)}},{key:"disable",value:function(){this.mDisposed=!0,this.mSkybox&&(this.mSkybox.dispose(),delete this.mSkybox),this.mMaterial&&(this.mMaterial.dispose(),delete this.mMaterial),this.mTexture&&(this.mTexture.dispose(),delete this.mTexture)}}]),e}();function lx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lx(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var fx,px,mx,dx=function(){function e(t,n){var r=this;(0,u.Z)(this,e),(0,l.Z)(this,"_scene",void 0),(0,l.Z)(this,"_options",void 0),(0,l.Z)(this,"_opaqueRenderTarget",null),(0,l.Z)(this,"_opaqueMeshesCache",[]),(0,l.Z)(this,"_transparentMeshesCache",[]),(0,l.Z)(this,"_materialObservers",{}),(0,l.Z)(this,"onErrorObservable",void 0),this._options=hx(hx({},e._getDefaultOptions()),t),this._scene=n,this._scene._transmissionHelper=this,this.onErrorObservable=new BABYLON.Observable,this._scene.onDisposeObservable.addOnce((function(){r.dispose()})),this._parseScene(),this._setupRenderTargets()}return(0,c.Z)(e,[{key:"updateOptions",value:function(e){var t=this;if(Object.keys(e).filter((function(n){return t._options[n]!==e[n]})).length){var n=hx(hx({},this._options),e),r=this._options;this._options=n,n.renderSize===r.renderSize&&n.renderTargetTextureType===r.renderTargetTextureType&&n.generateMipmaps===r.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=n.samples,this._opaqueRenderTarget.lodGenerationScale=n.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=n.lodGenerationOffset):this._setupRenderTargets()}}},{key:"getOpaqueTarget",value:function(){return this._opaqueRenderTarget}},{key:"shouldRenderAsTransmission",value:function(e){return!!e&&!!(e instanceof BABYLON.PBRMaterial&&e.subSurface.isRefractionEnabled)}},{key:"_addMesh",value:function(e){var t=this;this._materialObservers[e.uniqueId]=e.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),BABYLON.Tools.SetImmediate((function(){t.shouldRenderAsTransmission(e.material)?(e.material.refractionTexture=t._opaqueRenderTarget,t._transparentMeshesCache.push(e)):t._opaqueMeshesCache.push(e)}))}},{key:"_removeMesh",value:function(e){e.onMaterialChangedObservable.remove(this._materialObservers[e.uniqueId]),delete this._materialObservers[e.uniqueId];var t=this._transparentMeshesCache.indexOf(e);-1!==t&&this._transparentMeshesCache.splice(t,1),-1!==(t=this._opaqueMeshesCache.indexOf(e))&&this._opaqueMeshesCache.splice(t,1)}},{key:"_parseScene",value:function(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}},{key:"_onMeshMaterialChanged",value:function(e){var t=this._transparentMeshesCache.indexOf(e),n=this._opaqueMeshesCache.indexOf(e);this.shouldRenderAsTransmission(e.material)?(e.material instanceof BABYLON.PBRMaterial&&(e.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==n?(this._opaqueMeshesCache.splice(n,1),this._transparentMeshesCache.push(e)):-1===t&&this._transparentMeshesCache.push(e)):-1!==t?(this._transparentMeshesCache.splice(t,1),this._opaqueMeshesCache.push(e)):-1===n&&this._opaqueMeshesCache.push(e)}},{key:"_setupRenderTargets",value:function(){var e,t,n,r,i=this;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new BABYLON.RenderTargetTexture("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=null!==(e=null===(t=this._options.clearColor)||void 0===t?void 0:t.clone())&&void 0!==e?e:this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.onBeforeBindObservable.add((function(e){r=i._scene.environmentIntensity,i._scene.environmentIntensity=1,n=i._scene.imageProcessingConfiguration.applyByPostProcess,i._options.clearColor?e.clearColor.copyFrom(i._options.clearColor):i._scene.clearColor.toLinearSpaceToRef(e.clearColor),i._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((function(){i._scene.environmentIntensity=r,i._scene.imageProcessingConfiguration._applyByPostProcess=n})),this._transparentMeshesCache.forEach((function(e){i.shouldRenderAsTransmission(e.material)&&(e.material.refractionTexture=i._opaqueRenderTarget)}))}},{key:"dispose",value:function(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}],[{key:"_getDefaultOptions",value:function(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:BABYLON.Constants.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}}]),e}();function vx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}!function(e){e[e.OBJECT=0]="OBJECT",e[e.TARGET=1]="TARGET",e[e.PROPERTY=2]="PROPERTY"}(fx||(fx={})),function(e){e[e.TRANSLATE=0]="TRANSLATE",e[e.ROTATE=1]="ROTATE",e[e.SCALE=2]="SCALE"}(px||(px={})),function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD"}(mx||(mx={}));var yx=function(e){(0,g.Z)(n,e);var t=vx(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,_.Z)(r),"renderTechnique",eo.transform_controls_gizmo),(0,l.Z)((0,_.Z)(r),"mTargetMode",void 0),(0,l.Z)((0,_.Z)(r),"mMode",void 0),(0,l.Z)((0,_.Z)(r),"mSpace",void 0),(0,l.Z)((0,_.Z)(r),"mSize",void 0),(0,l.Z)((0,_.Z)(r),"mObject",void 0),(0,l.Z)((0,_.Z)(r),"mResetFlag",void 0),(0,l.Z)((0,_.Z)(r),"mObjectProperty",void 0),r.mName="TransformControlsGizmoEntity",r.mMode=px.TRANSLATE,r.mSpace=mx.WORLD,r.mTargetMode=fx.OBJECT,r.mSize=1,r.mResetFlag=!1,r}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"proxyGetValue",value:function(e){switch(e){case"mode":return this.mMode;case"target_mode":return this.mTargetMode;case"space":return this.mSpace;case"size":return this.mSize;case"reset":return this.mResetFlag}return Ni((0,M.Z)(n.prototype),"proxyGetValue",this).call(this,e)}},{key:"proxySetValue",value:function(e,t,r){switch(e){case"mode":return this.mMode=t,!0;case"space":return this.mSpace=t,!0;case"target_mode":return this.mTargetMode=t,!0;case"size":return this.mSize=parseFloat(t),!0;case"reset":return this.mResetFlag=!!t,!0}return Ni((0,M.Z)(n.prototype),"proxySetValue",this).call(this,e,t,r)}},{key:"serialize",value:function(e){return Object.assign(Ni((0,M.Z)(n.prototype),"serialize",this).call(this,e),{type:"transform_controls_gizmo"})}},{key:"mode",get:function(){return this.mMode},set:function(e){this.mMode=e,this.markNeedsRenderUpdate()}},{key:"targetMode",get:function(){return this.mTargetMode},set:function(e){this.mTargetMode=e,this.markNeedsRenderUpdate()}},{key:"objectProperty",get:function(){return this.mObjectProperty},set:function(e){this.mObjectProperty=e,this.markNeedsRenderUpdate()}},{key:"space",get:function(){return this.mSpace},set:function(e){this.mSpace=e,this.markNeedsRenderUpdate()}},{key:"size",get:function(){return this.mSize},set:function(e){this.mSize=e,this.markNeedsRenderUpdate()}},{key:"object",get:function(){return this.mObject},set:function(e){this.mObject=e,this.markNeedsRenderUpdate()}},{key:"setNeedsRenderUpdate",value:function(e){Ni((0,M.Z)(n.prototype),"setNeedsRenderUpdate",this).call(this,e),this.resetRenderFlags()}},{key:"resetRenderFlags",value:function(){this.mResetFlag=!1}}]),n}(Wa);function gx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(yx,"TypeRTTI",new k.r("TransformControlsGizmoEntity",Wa.TypeRTTI));var bx,Mx=function(e){(0,g.Z)(n,e);var t=gx(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,n.getTopicName(e)),(0,l.Z)((0,_.Z)(i),"mType",void 0),(0,l.Z)((0,_.Z)(i),"mData",void 0),i.mType=e,i.mData=r,i}return(0,c.Z)(n,[{key:"getType",value:function(){return this.mType}},{key:"getData",value:function(){return this.mData}}],[{key:"getTopicName",value:function(e){return"TransformControlsGizmoUpdateType.".concat(e)}}]),n}(Zi);function kx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}!function(e){e[e.ObjectChange=0]="ObjectChange",e[e.MouseDown=1]="MouseDown",e[e.MouseUp=2]="MouseUp"}(bx||(bx={}));var _x=function(e){(0,g.Z)(a,e);var n,i=kx(a);function a(e,t){var n;return(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mControls",void 0),(0,l.Z)((0,_.Z)(n),"mEnabled",void 0),(0,l.Z)((0,_.Z)(n),"mObject",void 0),(0,l.Z)((0,_.Z)(n),"mMode",void 0),(0,l.Z)((0,_.Z)(n),"mTargetMode",void 0),(0,l.Z)((0,_.Z)(n),"mSpace",void 0),(0,l.Z)((0,_.Z)(n),"mSize",1),(0,l.Z)((0,_.Z)(n),"mObjectProperty",""),(0,l.Z)((0,_.Z)(n),"mTransformParentObject",void 0),(0,l.Z)((0,_.Z)(n),"mTransformObject",void 0),(0,l.Z)((0,_.Z)(n),"mPreviousPosition",Bi.Zero()),(0,l.Z)((0,_.Z)(n),"mPreviousQuaternion",Pi.identity()),(0,l.Z)((0,_.Z)(n),"mPreviousScale",Bi.One()),(0,l.Z)((0,_.Z)(n),"mTranslateObservers",void 0),(0,l.Z)((0,_.Z)(n),"mRotateObservers",void 0),(0,l.Z)((0,_.Z)(n),"mScaleObservers",void 0),n.mTranslateObservers={mouseDown:void 0,mouseUp:void 0},n.mRotateObservers={mouseDown:void 0,mouseUp:void 0},n.mScaleObservers={mouseDown:void 0,mouseUp:void 0},n}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mEnabled=e.enabled,this.mMode=e.mode,this.mTargetMode=e.targetMode,this.mSpace=e.space,this.mSize=e.size,this.mObjectProperty=e.objectProperty;var t=e.object;t!==this.mObject&&(this.mObject=t)}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.createRenderObject()}},{key:"createRenderObject",value:function(){var e=this;if(!this.mControls){var t=this.getRenderer().getScene();this.mControls=new BABYLON.GizmoManager(t,1),this.mTransformParentObject=new BABYLON.TransformNode("gizmo-manager-object-parent",t),this.mTransformParentObject.rotationQuaternion=BABYLON.Quaternion.Identity(),this.mTransformObject=new BABYLON.TransformNode("gizmo-manager-object",t),this.mTransformObject.setParent(this.mTransformParentObject),this.mTransformObject.rotationQuaternion=BABYLON.Quaternion.Identity()}if(this.mEnabled?(this.mMode===px.TRANSLATE?(this.mControls.positionGizmoEnabled=!0,this.mTranslateObservers.mouseDown||(this.mTranslateObservers.mouseDown=this.mControls.gizmos.positionGizmo.onDragStartObservable.add((function(){e.onMouseDown()}))),this.mTranslateObservers.mouseUp||(this.mTranslateObservers.mouseUp=this.mControls.gizmos.positionGizmo.onDragEndObservable.add((function(){e.onMouseUp()}))),this.mControls.gizmos.positionGizmo.planarGizmoEnabled=!0,this.mControls.gizmos.positionGizmo.scaleRatio=this.mSize,this.mControls.gizmos.positionGizmo.updateGizmoPositionToMatchAttachedMesh=!0,this.mControls.gizmos.positionGizmo.updateGizmoRotationToMatchAttachedMesh=this.mSpace===mx.LOCAL):this.mControls.positionGizmoEnabled=!1,this.mMode===px.ROTATE?(this.mControls.rotationGizmoEnabled=!0,this.mRotateObservers.mouseDown||(this.mRotateObservers.mouseDown=this.mControls.gizmos.rotationGizmo.onDragStartObservable.add((function(){e.onMouseDown()}))),this.mRotateObservers.mouseUp||(this.mRotateObservers.mouseUp=this.mControls.gizmos.rotationGizmo.onDragEndObservable.add((function(){e.onMouseUp()}))),this.mControls.gizmos.rotationGizmo.scaleRatio=this.mSize,this.mControls.gizmos.rotationGizmo.updateGizmoPositionToMatchAttachedMesh=!0,this.mControls.gizmos.rotationGizmo.updateGizmoRotationToMatchAttachedMesh=!1):this.mControls.rotationGizmoEnabled=!1,this.mMode===px.SCALE?(this.mControls.scaleGizmoEnabled=!0,this.mScaleObservers.mouseDown||(this.mScaleObservers.mouseDown=this.mControls.gizmos.scaleGizmo.onDragStartObservable.add((function(){e.onMouseDown()}))),this.mScaleObservers.mouseUp||(this.mScaleObservers.mouseUp=this.mControls.gizmos.scaleGizmo.onDragEndObservable.add((function(){e.onMouseUp()}))),this.mControls.gizmos.scaleGizmo.sensitivity=5,this.mControls.gizmos.scaleGizmo.scaleRatio=this.mSize,this.mControls.gizmos.scaleGizmo.updateGizmoPositionToMatchAttachedMesh=!0):this.mControls.scaleGizmoEnabled=!1,this.mControls.boundingBoxGizmoEnabled=!1):(this.mControls.positionGizmoEnabled=!1,this.mControls.rotationGizmoEnabled=!1,this.mControls.scaleGizmoEnabled=!1),this.mControls.usePointerToAttachGizmos=!1,this.mObject?(this.updateTransformNodeFromEntity(this.mObject),this.mControls.attachToNode(this.mTransformObject)):this.mControls.attachToNode(null),this.mObject)if(this.mTargetMode===fx.OBJECT)this.mPreviousPosition.copy(this.mObject.transform.position),this.mPreviousQuaternion.copy(this.mObject.transform.quaternion),this.mPreviousScale.copy(this.mObject.transform.scale);else if(this.mTargetMode===fx.TARGET){var n=this.mObject.getValue("target");this.mPreviousPosition.copy(n),this.mPreviousQuaternion.set(0,0,0,1),this.mPreviousScale.set(1,1,1)}else if(this.mTargetMode===fx.PROPERTY){var r=this.mObject.getValue(this.mObjectProperty);this.mPreviousPosition.copy(r)}this.mRenderObject=null}},{key:"destroyRenderObject",value:function(){this.mRenderObject&&(this.mControls.gizmos.positionGizmo&&(this.mTranslateObservers.mouseDown&&(this.mControls.gizmos.positionGizmo.onDragStartObservable.remove(this.mTranslateObservers.mouseDown),delete this.mTranslateObservers.mouseDown),this.mTranslateObservers.mouseUp&&(this.mControls.gizmos.positionGizmo.onDragEndObservable.remove(this.mTranslateObservers.mouseUp),delete this.mTranslateObservers.mouseUp)),this.mControls.gizmos.rotationGizmo&&(this.mRotateObservers.mouseDown&&(this.mControls.gizmos.rotationGizmo.onDragStartObservable.remove(this.mRotateObservers.mouseDown),delete this.mRotateObservers.mouseDown),this.mRotateObservers.mouseUp&&(this.mControls.gizmos.rotationGizmo.onDragEndObservable.remove(this.mRotateObservers.mouseUp),delete this.mRotateObservers.mouseUp)),this.mControls.gizmos.scaleGizmo&&(this.mScaleObservers.mouseDown&&(this.mControls.gizmos.scaleGizmo.onDragStartObservable.remove(this.mScaleObservers.mouseDown),delete this.mScaleObservers.mouseDown),this.mScaleObservers.mouseUp&&(this.mControls.gizmos.scaleGizmo.onDragEndObservable.remove(this.mScaleObservers.mouseUp),delete this.mScaleObservers.mouseUp)),this.mTransformObject.dispose(),this.mControls.dispose(),delete this.mControls),Ni((0,M.Z)(a.prototype),"destroyRenderObject",this).call(this)}},{key:"update",value:function(e){Ni((0,M.Z)(a.prototype),"update",this).call(this,e);var t=!1,n=!1,r=!1;if(this.mObject){if(this.mMode===px.TRANSLATE&&this.didPan(this.mTransformObject.position)){if(this.mTargetMode===fx.OBJECT)this.mObject.transform.position.set(this.mTransformObject.position.x,this.mTransformObject.position.y,this.mTransformObject.position.z),this.mPreviousPosition.copy(this.mObject.transform.position);else if(this.mTargetMode===fx.TARGET){var i=new Bi(this.mTransformObject.position.x,this.mTransformObject.position.y,this.mTransformObject.position.z);this.mObject.setValue("target",i),this.mPreviousPosition.copy(i)}else if(this.mTargetMode===fx.PROPERTY){var o=new Bi(this.mTransformObject.position.x,this.mTransformObject.position.y,this.mTransformObject.position.z);this.mObject.setValue(this.mObjectProperty,o),this.mPreviousPosition.copy(o)}t=!0}this.mMode===px.ROTATE&&this.didRotate(this.mTransformObject.rotationQuaternion)&&(this.mTargetMode===fx.OBJECT&&(this.mObject.transform.quaternion.set(this.mTransformObject.rotationQuaternion.x,this.mTransformObject.rotationQuaternion.y,this.mTransformObject.rotationQuaternion.z,this.mTransformObject.rotationQuaternion.w),this.mPreviousQuaternion.copy(this.mObject.transform.quaternion)),n=!0),this.mMode===px.SCALE&&this.didScale(this.mTransformObject.scaling)&&(this.mTargetMode===fx.OBJECT&&(this.mObject.transform.scale.set(this.mTransformObject.scaling.x,this.mTransformObject.scaling.y,this.mTransformObject.scaling.z),this.mPreviousScale.copy(this.mObject.transform.scale)),r=!0),(t||n||r)&&this.onObjectChange()}}},{key:"onObjectChange",value:function(){P.eventBus().dispatch(new Mx(bx.ObjectChange,this.mObject))}},{key:"onMouseDown",value:function(){P.eventBus().dispatch(new Mx(bx.MouseDown))}},{key:"onMouseUp",value:function(){P.eventBus().dispatch(new Mx(bx.MouseUp))}},{key:"updateTransformNodeFromEntity",value:function(e){var t=e instanceof Wi?e.getParent():void 0;if(t){var n=Bi.Zero();t.transform.getWorldPosition(n),this.mTransformParentObject.position.set(n.x,n.y,n.z);var r=Pi.identity();t.transform.getWorldQuaternion(r),this.mTransformParentObject.rotationQuaternion.set(r.x,r.y,r.z,r.w);var i=Bi.Zero();t.transform.getWorldScale(i),this.mTransformParentObject.scaling.set(i.x,i.y,i.z)}else this.mTransformParentObject.position.set(0,0,0),this.mTransformParentObject.rotationQuaternion.set(0,0,0,1),this.mTransformParentObject.scaling.set(1,1,1);if(this.mTargetMode===fx.OBJECT)this.mTransformObject.position.set(e.transform.position.x,e.transform.position.y,e.transform.position.z),this.mTransformObject.rotationQuaternion.set(e.transform.quaternion.x,e.transform.quaternion.y,e.transform.quaternion.z,e.transform.quaternion.w),this.mTransformObject.scaling.set(e.transform.scale.x,e.transform.scale.y,e.transform.scale.z);else if(this.mTargetMode===fx.TARGET){var a=this.mObject.getValue("target");this.mTransformObject.position.set(a.x,a.y,a.z),this.mTransformObject.rotationQuaternion.set(0,0,0,1),this.mTransformObject.scaling.set(1,1,1)}else if(this.mTargetMode===fx.PROPERTY){var o=this.mObject.getValue(this.mObjectProperty);this.mTransformObject.position.set(o.x,o.y,o.z),this.mTransformObject.rotationQuaternion.set(0,0,0,1),this.mTransformObject.scaling.set(1,1,1)}}},{key:"didPan",value:function(e){var t=this.mPreviousPosition.x-e.x,n=this.mPreviousPosition.y-e.y,r=this.mPreviousPosition.z-e.z;return t*t+n*n+r*r>pl.EPS}},{key:"didRotate",value:function(e){var t=this.mPreviousQuaternion.x-e.x,n=this.mPreviousQuaternion.y-e.y,r=this.mPreviousQuaternion.z-e.z,i=this.mPreviousQuaternion.w-e.w;return t*t+n*n+r*r+i*i>pl.EPS}},{key:"didScale",value:function(e){var t=this.mPreviousScale.x-e.x,n=this.mPreviousScale.y-e.y,r=this.mPreviousScale.z-e.z;return t*t+n*n+r*r>pl.EPS}}]),a}(LM);function xx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Tx=function(e){(0,g.Z)(o,e);var n,i,a=xx(o);function o(){var e;(0,u.Z)(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=a.call.apply(a,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mFlareMesh",void 0),(0,l.Z)((0,_.Z)(e),"mFlareMaterial",void 0),(0,l.Z)((0,_.Z)(e),"mReceiveShadow",void 0),e}return(0,c.Z)(o,[{key:"loadResource",value:(i=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateProperties(),e.prev=1,e.next=4,this.loadTextures();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),qe.qL.warn("Failed to load water textures:",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return i.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mReceiveShadow=e.receiveShadow,this.mRenderObject&&(this.mRenderObject.renderingGroupId=e.renderOrder,this.mFlareMesh.renderingGroupId=e.renderOrder)}},{key:"loadTextures",value:(n=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){if(++o.sTextures.revision>1)return e();var n=t.getRenderer().getScene();o.sTextures.textures=[new BABYLON.Texture("".concat(Jr.E.assetsUrl,"system/textures/flare-strip.png"),n)],o.sTextures.textures[0].hasAlpha=!0,BABYLON.Texture.WhenAllReady(o.sTextures.textures,(function(){e()}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"disposeTextures",value:function(){--o.sTextures.revision>0||(o.sTextures.revision=0,o.sTextures.textures.splice(0).forEach((function(e){e.dispose()})))}},{key:"createRenderObject",value:function(){var e=new BABYLON.Mesh("flare-group",this.getRenderer().getScene());e.renderingGroupId=this.mSceneEntity.renderOrder,this.mFlareMaterial=new BABYLON.StandardMaterial("flare-material",this.getRenderer().getScene()),this.mFlareMaterial.diffuseColor=new BABYLON.Color3(1,1,1),this.mFlareMaterial.diffuseTexture=o.sTextures.textures[0],this.mFlareMaterial.transparencyMode=BABYLON.StandardMaterial.MATERIAL_ALPHABLEND,this.mFlareMaterial.alpha=.9,this.mFlareMaterial.useAlphaFromDiffuseTexture=!0,this.mFlareMaterial.backFaceCulling=!0,this.mFlareMaterial.sideOrientation=BABYLON.StandardMaterial.CounterClockWiseSideOrientation,this.mFlareMesh=BABYLON.MeshBuilder.CreatePlane("flare-mesh",{size:1},this.getRenderer().getScene()),this.mFlareMesh.renderingGroupId=this.mSceneEntity.renderOrder,this.mFlareMesh.scaling=new BABYLON.Vector3(4,1,1),this.mFlareMesh.material=this.mFlareMaterial,this.mFlareMesh.parent=e,this.mFlareMesh.metadata={scene_entity_id:this.mSceneEntity.id},this.mRenderObject=e}},{key:"dispose",value:function(){this.mFlareMesh&&(this.mFlareMesh.dispose(),delete this.mFlareMesh),this.mFlareMaterial&&(this.mFlareMaterial.diffuseTexture=null,this.mFlareMaterial.dispose(),delete this.mFlareMaterial,this.disposeTextures()),Ni((0,M.Z)(o.prototype),"dispose",this).call(this)}}]),o}(LM);function wx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Tx,"sTextures",{revision:0,textures:[]});var Rx=function(e){(0,g.Z)(o,e);var n,i,a=wx(o);function o(){var e;(0,u.Z)(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=a.call.apply(a,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mGlareMesh",void 0),(0,l.Z)((0,_.Z)(e),"mGlareMaterial",void 0),(0,l.Z)((0,_.Z)(e),"mGlowLayer",void 0),(0,l.Z)((0,_.Z)(e),"mReceiveShadow",void 0),(0,l.Z)((0,_.Z)(e),"mEdges",4),(0,l.Z)((0,_.Z)(e),"mSize",1),(0,l.Z)((0,_.Z)(e),"mBlur",2),(0,l.Z)((0,_.Z)(e),"mExtension",0),(0,l.Z)((0,_.Z)(e),"mColor",so.White()),(0,l.Z)((0,_.Z)(e),"mFlareColor",so.White()),(0,l.Z)((0,_.Z)(e),"mAlpha",1),(0,l.Z)((0,_.Z)(e),"mAngle",1),e}return(0,c.Z)(o,[{key:"loadResource",value:(i=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateProperties(),e.prev=1,e.next=4,this.loadTextures();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),qe.qL.warn("Failed to load water textures:",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return i.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mReceiveShadow=e.receiveShadow,this.mEdges=e.edges,this.mSize=e.size,this.mBlur=e.blur,this.mExtension=e.extension,this.mColor.copy(e.color),this.mFlareColor.copy(e.flareColor),this.mAlpha=e.alpha,this.mAngle=e.angle,this.mRenderObject&&(this.mRenderObject.renderingGroupId=e.renderOrder,this.mGlareMesh.renderingGroupId=e.renderOrder)}},{key:"loadTextures",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){if(++o.sTextures.revision>1)return e();o.sTextures.textures=[],BABYLON.Texture.WhenAllReady(o.sTextures.textures,(function(){e()}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"disposeTextures",value:function(){--o.sTextures.revision>0||(o.sTextures.revision=0,o.sTextures.textures.splice(0).forEach((function(e){e.dispose()})))}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(o.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.mGlareMaterial.emissiveColor.set(this.mColor.r,this.mColor.g,this.mColor.b);var e=this.mSize*(.5*this.mEdges);this.mGlareMesh.scaling.set(e,e,e)}},{key:"createRenderObject",value:function(){var e=new BABYLON.Mesh("glare-group",this.getRenderer().getScene());e.renderingGroupId=this.mSceneEntity.renderOrder,this.mGlareMaterial=new BABYLON.StandardMaterial("glare-material",this.getRenderer().getScene()),this.mGlareMaterial.diffuseColor=new BABYLON.Color3(1,1,1),this.mGlareMaterial.transparencyMode=BABYLON.StandardMaterial.MATERIAL_ALPHABLEND,this.mGlareMaterial.alpha=this.mAlpha,this.mGlareMaterial.emissiveColor=new BABYLON.Color3(this.mColor.r,this.mColor.g,this.mColor.b),this.mGlareMesh=BABYLON.MeshBuilder.CreateSphere("glare-mesh",{segments:32,diameter:1},this.getRenderer().getScene()),this.mGlareMesh.renderingGroupId=this.mSceneEntity.renderOrder;var t=this.mSize*(.5*this.mEdges);this.mGlareMesh.scaling=new BABYLON.Vector3(t,t,t),this.mGlareMesh.material=this.mGlareMaterial,this.mGlareMesh.parent=e,this.mGlareMesh.metadata={scene_entity_id:this.mSceneEntity.id},this.mGlowLayer=new BABYLON.GlowLayer("glare-glow-layer",this.getRenderer().getScene(),{mainTextureFixedSize:256,blurKernelSize:64}),this.mGlowLayer.intensity=10,this.mGlowLayer.addIncludedOnlyMesh(this.mGlareMesh),this.mRenderObject=e}},{key:"dispose",value:function(){this.mGlowLayer&&(this.mGlowLayer.dispose(),delete this.mGlowLayer),this.mGlareMesh&&(this.mGlareMesh.dispose(),delete this.mGlareMesh),this.mGlareMaterial&&(this.mGlareMaterial.dispose(),delete this.mGlareMaterial,this.disposeTextures()),Ni((0,M.Z)(o.prototype),"dispose",this).call(this)}}]),o}(LM);function Zx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Sx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zx(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Cx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Rx,"sTextures",{revision:0,textures:[]});var Ix=function(e){(0,g.Z)(a,e);var n,i=Cx(a);function a(e,t,n){var r;return(0,u.Z)(this,a),r=i.call(this,t,n),(0,l.Z)((0,_.Z)(r),"mEngine",void 0),(0,l.Z)((0,_.Z)(r),"mScene",void 0),(0,l.Z)((0,_.Z)(r),"mSceneDefaultBgMesh",void 0),(0,l.Z)((0,_.Z)(r),"mSceneDefaultBgTexture",void 0),(0,l.Z)((0,_.Z)(r),"mSceneDefaultBgMaterial",void 0),(0,l.Z)((0,_.Z)(r),"mDefaultCamera",void 0),(0,l.Z)((0,_.Z)(r),"mCamera",void 0),(0,l.Z)((0,_.Z)(r),"mSyncHashHelper",new xc),(0,l.Z)((0,_.Z)(r),"mClippingCache",{}),(0,l.Z)((0,_.Z)(r),"mCanvas",void 0),(0,l.Z)((0,_.Z)(r),"mTransmissionHelper",void 0),(0,l.Z)((0,_.Z)(r),"mTransmissionReferenceCounter",{}),(0,l.Z)((0,_.Z)(r),"mSceneBackgroundStatePresent",!1),(0,l.Z)((0,_.Z)(r),"mShadowGenerators",[]),(0,l.Z)((0,_.Z)(r),"mShadowGeneratorsRequireUpdate",!1),r.mCanvas=e,r.mCanvas.style.outline="none",r.init(),r.mDefaultCamera=new BABYLON.ArcRotateCamera("camera",0,Math.PI/2.5,8,new BABYLON.Vector3(0,0,0),r.mScene),r.mDefaultCamera.minZ=.1,r.mDefaultCamera.maxZ=1e3,r.mDefaultCamera.lowerRadiusLimit=.1,r.mDefaultCamera.upperRadiusLimit=1/0,r.mDefaultCamera.attachControl(r.mCanvas,!0),r.mDefaultCamera.wheelPrecision=5,r}return(0,c.Z)(a,[{key:"init",value:function(){this.initEngine(),this.initScene()}},{key:"getScene",value:function(){return this.mScene}},{key:"getEngine",value:function(){return this.mEngine}},{key:"getActiveCamera",value:function(){return this.mCamera?this.mCamera.getRenderObject():this.mDefaultCamera}},{key:"initScene",value:function(){var e=this;this.mScene=new BABYLON.Scene(this.mEngine),this.mScene.preventDefaultOnPointerUp=!1,this.mScene.preventDefaultOnPointerDown=!1,this.mScene.useRightHandedSystem=!0,this.mScene.autoClear=!1;var t=["".concat(Jr.E.assetsUrl,"system/textures/cube-grayblue-side.png"),"".concat(Jr.E.assetsUrl,"system/textures/cube-grayblue-top.png"),"".concat(Jr.E.assetsUrl,"system/textures/cube-grayblue-side.png"),"".concat(Jr.E.assetsUrl,"system/textures/cube-grayblue-side.png"),"".concat(Jr.E.assetsUrl,"system/textures/cube-grayblue-bottom.png"),"".concat(Jr.E.assetsUrl,"system/textures/cube-grayblue-side.png")];this.mSceneDefaultBgTexture=BABYLON.CubeTexture.CreateFromImages(t,this.mScene,!1),this.mSceneDefaultBgTexture.onLoadObservable.addOnce((function(){e.mSceneBackgroundStatePresent||(e.mSceneDefaultBgMesh=BABYLON.MeshBuilder.CreateBox("scene-default-background-mesh",{size:1e3,updatable:!1,sideOrientation:BABYLON.Mesh.BACKSIDE},e.mScene),e.mSceneDefaultBgMesh.renderingGroupId=1,e.mSceneDefaultBgMesh.infiniteDistance=!0,e.mSceneDefaultBgMesh.isPickable=!1,e.mSceneDefaultBgMesh.isVisible=!0,e.mSceneDefaultBgMesh.visibility=1,e.mSceneDefaultBgMesh.alwaysSelectAsActiveMesh=!0,e.mSceneDefaultBgMesh.forceRenderingWhenOccluded=!0,e.mSceneDefaultBgMesh.isOccluded=!1,e.mSceneDefaultBgMesh.occlusionType=BABYLON.Mesh.OCCLUSION_TYPE_NONE,e.mSceneDefaultBgMesh.ignoreCameraMaxZ=!0,e.mSceneDefaultBgMaterial=new BABYLON.PBRMaterial("scene-default-background-material",e.mScene),e.mSceneDefaultBgMaterial.backFaceCulling=!0,e.mSceneDefaultBgMaterial.reflectionTexture=e.mSceneDefaultBgTexture,e.mSceneDefaultBgMaterial.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,e.mSceneDefaultBgMaterial.reflectionTexture.sphericalPolynomial=new BABYLON.SphericalPolynomial,e.mSceneDefaultBgMaterial.microSurface=1,e.mSceneDefaultBgMaterial.specularIntensity=0,e.mSceneDefaultBgMaterial.disableLighting=!1,e.mSceneDefaultBgMesh.material=e.mSceneDefaultBgMaterial)})),this.mScene.environmentIntensity=1;var n=this.getDeviceSceneSettings().clear_color,r=n>>24,i=n>>16&255,a=n>>8&255,o=255&n;r=(r/=127)>1?1:r,this.mScene.clearColor=new BABYLON.Color4(i/255,a/255,o/255,r),this.mScene.useOrderIndependentTransparency=!1}},{key:"initEngine",value:function(){BABYLON.RenderingManager.MAX_RENDERINGGROUPS=no.MAX_RENDERINGGROUPS+2;var e=this.getDeviceSceneSettings();this.mEngine=new BABYLON.Engine(this.mCanvas,e.anti_aliasing,{alpha:e.alpha,audioEngine:!1,autoEnableWebVR:!1},!1)}},{key:"setShadowProperties",value:function(e,t){switch(e.transparencyShadow=!0,e.enableSoftTransparentShadow=!0,e.getShadowMap().refreshRate=BABYLON.RenderTargetTexture.REFRESHRATE_RENDER_ONCE,t.shadow){case"1":e.usePercentageCloserFiltering=!1;break;case"2":e.usePercentageCloserFiltering=!0,e.filteringQuality=BABYLON.ShadowGenerator.QUALITY_MEDIUM;break;case"3":e.usePercentageCloserFiltering=!0,e.filteringQuality=BABYLON.ShadowGenerator.QUALITY_HIGH}}},{key:"createShadowGenerator",value:function(e,t){var n=this.getDeviceSceneSettings();if("0"!=n.shadow){var r=new BABYLON.ShadowGenerator(e,t);return this.setShadowProperties(r,n),this.mShadowGenerators.push(r),r}}},{key:"disposeShadowGenerator",value:function(e){e.dispose(),this.mShadowGenerators=this.mShadowGenerators.filter((function(t){return t.id!==e.id}))}},{key:"markShadowMapUpdate",value:function(){this.mShadowGeneratorsRequireUpdate=!0}},{key:"clear",value:function(e,t,n){this.mEngine.clear(this.mScene.clearColor,e,t,n)}},{key:"beforeRender",value:function(e){this.mSyncHashHelper.newHash(),(e.lightsNeedRenderUpdate()||e.drawablesNeedRenderUpdate())&&this.markShadowMapUpdate()}},{key:"afterRender",value:function(e){this.renderCacheReady(!0)&&this.clearOutOfSync(),this.mShadowGeneratorsRequireUpdate&&(this.mShadowGeneratorsRequireUpdate=!1,this.mShadowGenerators.forEach((function(e){return e.getShadowMap().resetRefreshCounter()}))),this.mEngine.beginFrame(),this.mScene.render(),this.mEngine.endFrame()}},{key:"clipPlaneKey",value:function(e){return"clipPlane".concat(0===e?"":e+1)}},{key:"onBeforeMeshRender",value:function(e,t){var n,r=this,i=null===(n=this.mClippingCache)||void 0===n?void 0:n[t.getObjectId()];null==i||i.forEach((function(e,t){t>5||(r.getScene()[r.clipPlaneKey(t)]=e)}))}},{key:"onAfterMeshRender",value:function(e,t){for(var n=this.getScene(),r=0;r<=6;r++)delete n[this.clipPlaneKey(r)]}},{key:"raycast",value:function(e){var t=this,n=e.origin.clone(),r=e.direction.clone();this.isRightHandedSystemActive()||(n.toggleCoordSystem(),r.toggleCoordSystem());var i=new BABYLON.Ray(new BABYLON.Vector3(n.x,n.y,n.z),new BABYLON.Vector3(r.x,r.y,r.z),e.length);return this.mScene.multiPickWithRay(i,null).filter((function(e){return!!e.pickedPoint})).map((function(e){if(e.hit){var n=e.getNormal(!1,!0),r=e.getNormal(!0,!0),i=e.getTextureCoordinates(),a=t.getEntityFromObject(e.pickedMesh),o=n?new Bi(n.x,n.y,n.z):Bi.Up(),s=r?new Bi(r.x,r.y,r.z):Bi.Up(),u=i?new D(i.x,i.y):D.Zero(),c=u.clone(),l=new Bi(e.pickedPoint.x,e.pickedPoint.y,e.pickedPoint.z);t.isRightHandedSystemActive()||(l.toggleCoordSystem(),n&&o.toggleCoordSystem(),r&&s.toggleCoordSystem());var h=new x_;return h.distance=e.distance,h.point.copy(l),h.normal.copy(s),h.faceNormal.copy(o),h.uv.copy(u),h.uv2.copy(c),h.entity=a,h}})).filter((function(e){return e&&(!e.entity||!e.entity.layers.isEnabled(4))})).sort((function(e,t){return e.distance-t.distance}))}},{key:"raycastIntersects",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.origin.clone(),a=e.direction.clone();this.isRightHandedSystemActive()||(i.toggleCoordSystem(),a.toggleCoordSystem());var o=new BABYLON.Ray(new BABYLON.Vector3(i.x,i.y,i.z),new BABYLON.Vector3(a.x,a.y,a.z),e.length),s=t.map((function(e){var t=n.getObjectFromEntity(e);return t instanceof BABYLON.AbstractMesh?t:void 0})).filter((function(e){return e}));return o.intersectsMeshes(s,r).map((function(e){if(e.hit){var t=e.getNormal(!1,!0),r=e.getNormal(!0,!0),i=e.getTextureCoordinates(),a=n.getEntityFromObject(e.pickedMesh),o=t?new Bi(t.x,t.y,t.z):Bi.Up(),s=r?new Bi(r.x,r.y,r.z):Bi.Up(),u=i?new D(i.x,i.y):D.Zero(),c=u.clone(),l=new Bi(e.pickedPoint.x,e.pickedPoint.y,e.pickedPoint.z);n.isRightHandedSystemActive()||(l.toggleCoordSystem(),t&&o.toggleCoordSystem(),r&&s.toggleCoordSystem());var h=new x_;return h.distance=e.distance,h.point.copy(l),h.normal.copy(s),h.faceNormal.copy(o),h.uv.copy(u),h.uv2.copy(c),h.entity=a,h}})).filter((function(e){return e&&(!e.entity||!e.entity.layers.isEnabled(4))})).sort((function(e,t){return e.distance-t.distance}))}},{key:"getForwardRayFromCamera",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=new __;n.length=t;var r=this.getTechniqueFromEntity(e);if(!(r&&r instanceof z_))return n;var i=r.getCamera().getForwardRay(t);return n.origin.set(i.origin.x,i.origin.y,i.origin.z),n.direction.set(i.direction.x,i.direction.y,i.direction.z),this.isRightHandedSystemActive()||(n.origin.toggleCoordSystem(),n.direction.toggleCoordSystem()),n}},{key:"getForwardRayFromScreenCoords",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,i=new __;i.length=r;var a=this.getTechniqueFromEntity(e);if(!(a&&a instanceof z_))return i;var o=this.mScene.createPickingRay(t,n,BABYLON.Matrix.Identity(),a.getCamera(),!1);return i.direction.set(o.direction.x,o.direction.y,o.direction.z),i.origin.set(o.origin.x,o.origin.y,o.origin.z),this.isRightHandedSystemActive()||(i.direction.toggleCoordSystem(),i.origin.toggleCoordSystem()),i}},{key:"createTexture2D",value:function(e,t,n,r,i,a,o,s,u,c,l,h,f,p){return new KM(this.mScene,e,t,n,r,i,a,o,s,u,c,l,h,f,p)}},{key:"createTextureCanvas",value:function(e,t,n,r,i,a,o,s,u,c,l,h,f,p){return new rk(this.mScene,e,t,n,r,i,a,o,s,u,c,l,h,f,p)}},{key:"createBuffer",value:function(){return new w_(this.mScene)}},{key:"createMaterialLambert",value:function(e){return new J_(e,this.mScene)}},{key:"createMaterialBasic",value:function(e){return new tx(e,this.mScene)}},{key:"createMaterialPhong",value:function(e){return new rx(e,this.mScene)}},{key:"createMaterialPhongExt",value:function(e){return new V_(e,this.mScene)}},{key:"createMaterialStandard",value:function(e){return new G_(e,this.mScene)}},{key:"createMaterialPhysical",value:function(e){return new K_(e,this.mScene)}},{key:"createMaterialPhysicalExt",value:function(e){return new W_(e,this.mScene)}},{key:"createMaterialLine",value:function(e){return new ax(e,this.mScene)}},{key:"createMaterialSimple",value:function(e){return new $_(e,this.mScene)}},{key:"createMaterialPBR",value:function(e){return new fk(e,this.mScene)}},{key:"enablePerspectiveCamera",value:function(e,t){this.createOrUpdate(e,z_)}},{key:"enableAmbientLight",value:function(e,t){this.createOrUpdate(e,zk)}},{key:"enableDirectionalLight",value:function(e,t){this.createOrUpdate(e,Gk)}},{key:"enableHemisphericLight",value:function(e,t){this.createOrUpdate(e,Wk)}},{key:"enablePointLight",value:function(e,t){this.createOrUpdate(e,Kk)}},{key:"enableSpotLight",value:function(e,t){this.createOrUpdate(e,$k)}},{key:"enableRectAreaLight",value:function(e,t){}},{key:"drawEffectAoPlane",value:function(e,t){this.createOrUpdate(e,xk)}},{key:"drawEffectFire",value:function(e,t){this.createOrUpdate(e,wk)}},{key:"drawEffectFlare",value:function(e,t){this.createOrUpdate(e,Tx)}},{key:"drawEffectGlare",value:function(e,t){this.createOrUpdate(e,Rx)}},{key:"drawEffectReflector",value:function(e,t){this.createOrUpdate(e,Zk)}},{key:"drawEffectSkyCube",value:function(e,t){}},{key:"drawEffectSkyEquirect",value:function(e,t){this.createOrUpdate(e,Ck)}},{key:"drawEffectWater",value:function(e,t){this.createOrUpdate(e,Ek)}},{key:"drawGridArea",value:function(e,t){this.createOrUpdate(e,bk)}},{key:"drawPrimitiveLine",value:function(e,t){this.createOrUpdate(e,Ok)}},{key:"drawPrimitiveBox",value:function(e,t){this.createOrUpdate(e,Pk)}},{key:"drawPrimitivePlane",value:function(e,t){this.createOrUpdate(e,Fk)}},{key:"drawPrimitiveSphere",value:function(e,t){this.createOrUpdate(e,Nk)}},{key:"drawUI",value:function(e,t){switch(e.getType().getTypeName()){case"UiEntityAnnotation":this.createOrUpdate(e,a_);break;case"UiEntityButton":this.createOrUpdate(e,c_);break;case"UiEntityImage":this.createOrUpdate(e,p_);break;case"UiEntityTag":this.createOrUpdate(e,y_);break;case"UiEntityText":this.createOrUpdate(e,k_);break;default:qe.qL.warn("Unknown ui entity to renderer: ",e.getType().getTypeName())}}},{key:"drawMesh",value:function(e,t){this.createOrUpdate(e,dk)}},{key:"drawMeshLine",value:function(e,t){this.createOrUpdate(e,yk)}},{key:"pushGlobalStates",value:function(){}},{key:"popGlobalStates",value:function(){}},{key:"enableClippingPlane",value:function(e,t,n){var r=this,i=e,a=this.mClippingCache[t.getObjectId()]||[],o=i.getPlanes();o.forEach((function(e,t){var n=new BABYLON.Vector3(e.normal.x,e.normal.y,e.normal.z),i=e.constant;if(r.isRightHandedSystemActive()&&(n.negateInPlace(),i*=-1),t<a.length)return a[t].normal.set(n.x,n.y,n.z),void(a[t].d=i);a.push(new BABYLON.Plane(n.x,n.y,n.z,i))})),o.length<a.length&&a.splice(o.length),this.mClippingCache[t.getObjectId()]=a}},{key:"drawTransformControlsGizmo",value:function(e,t){this.createOrUpdate(e,_x)}},{key:"enableSceneBackground",value:function(e,t){switch(this.mSceneBackgroundStatePresent=!0,this.mSceneDefaultBgMesh&&this.mScene.removeMesh(this.mSceneDefaultBgMesh),e.getBackgroundType()){case ap.transparent:return this.enableSceneBackgroundTransparent(e,t);case ap.color:return this.enableSceneBackgroundColor(e,t);case ap.image:return this.enableSceneBackgroundImage(e,t);case ap.equirect:return this.enableSceneBackgroundEquirect(e,t);case ap.skybox:return this.enableSceneBackgroundSkybox(e,t);case ap.environment:return this.enableSceneBackgroundEnvironment(e,t);default:return void qe.qL.error("Unknown scene background state:",e)}}},{key:"enableEnvironment",value:function(e,t){var n=this,r=this.mScene.environmentTexture,i=e.getEnvironment()?BABYLON.CubeTexture.CreateFromPrefilteredData(e.getEnvironment().environment,this.mScene):void 0;return this.mScene.environmentTexture=i,{state:e,restore:function(){n.mScene.environmentTexture&&n.mScene.environmentTexture.dispose(),n.mScene.environmentTexture=r}}}},{key:"enableEnvironmentIntensity",value:function(e){var t=this,n=this.mScene.environmentIntensity;return this.mScene.environmentIntensity=e.getIntensity(),{state:e,restore:function(){t.mScene.environmentIntensity=n}}}},{key:"enableSceneBackgroundTransparent",value:function(e,t){var n=this,r=this.mScene.clearColor;return this.mScene.clearColor=new BABYLON.Color4(0,0,0,0),{state:e,restore:function(){n.mScene.clearColor=r}}}},{key:"enableSceneBackgroundColor",value:function(e,t){var n=this,r=e.getColor(),i=this.mScene.clearColor;return this.mScene.clearColor=new BABYLON.Color4(r.r,r.g,r.b,1),{state:e,restore:function(){n.mScene.clearColor=i}}}},{key:"enableSceneBackgroundImage",value:function(e,t){var n=e.getMediaId(),r=new ox(n);return r.enable(this.mScene),{state:e,restore:function(){r.disable()}}}},{key:"enableSceneBackgroundEquirect",value:function(e,t){var n=e.getMediaId(),r=new sx(n);return r.enable(this.mScene),{state:e,restore:function(){r.disable()}}}},{key:"enableSceneBackgroundSkybox",value:function(e,t){var n=e.getMediaIds(),r=new ux(n);return r.enable(this.mScene),{state:e,restore:function(){r.disable()}}}},{key:"enableSceneBackgroundEnvironment",value:function(e,t){var n=this.mScene.environmentTexture;if(n){var r=new cx(n,e.getScale(),e.getBlur());return r.enable(this.mScene),{state:e,restore:function(){r.disable()}}}}},{key:"disableDefaultBackground",value:function(){this.mSceneDefaultBgMesh&&this.mScene.removeMesh(this.mSceneDefaultBgMesh),this.mSceneBackgroundStatePresent=!0}},{key:"dispose",value:function(){for(var e=0,t=Object.entries(this.mRenderCache);e<t.length;e++){o(t[e],2)[1].dispose()}this.mRenderCache={},this.mTransmissionHelper&&(this.mTransmissionHelper.dispose(),delete this.mTransmissionHelper),this.mSceneDefaultBgMesh&&(this.mSceneDefaultBgMesh.dispose(!0,!1),delete this.mSceneDefaultBgMesh),this.mSceneDefaultBgTexture&&(this.mSceneDefaultBgTexture.dispose(),delete this.mSceneDefaultBgTexture),this.mSceneDefaultBgMaterial&&(this.mSceneDefaultBgMaterial.dispose(!0,!1),delete this.mSceneDefaultBgMaterial),this.mSceneBackgroundStatePresent=!1,this.mEngine.dispose(),this.mUiRenderer.dispose(),this.mSyncHashHelper.newHash()}},{key:"createOrUpdate",value:function(e,t){var n=this.mRenderCache[e.getObjectId()];n||(this.mRenderCache[e.getObjectId()]=n=new t(e,this),n.initialize()),n.disposed||(n.setSyncHash(this.mSyncHashHelper.getHash()),n.ready&&this.renderCacheReady()&&(n.attached||(n.attach(),this.markShadowMapUpdate()),n.update(this.mDeltaTime)))}},{key:"clearOutOfSync",value:function(){for(var e=0,t=Object.keys(this.mRenderCache);e<t.length;e++){var n=t[e],r=this.mRenderCache[n];r.getSyncHash()!==this.mSyncHashHelper.getHash()&&(r.detach(),r.dispose(),delete this.mRenderCache[n],delete this.mClippingCache[n],this.markShadowMapUpdate())}}},{key:"getObjectFromEntity",value:function(e){var t=this.getTechniqueFromEntity(e);return t instanceof LM?t.getRenderObject():void 0}},{key:"getEntityFromObject",value:function(e){if(e&&e.metadata)for(var t=e.metadata.scene_entity_id,n=0,r=Object.entries(this.mRenderCache);n<r.length;n++){var i=o(r[n],2)[1];if(i.equalsId(t))return i.getSceneEntity()}}},{key:"getTechniqueFromEntity",value:function(e){for(var t=0,n=Object.entries(this.mRenderCache);t<n.length;t++){var r=o(n[t],2)[1];if(r.equals(e))return r}}},{key:"setSize",value:function(e,t){this.mEngine.setSize(e,t),this.mUiRenderer.resize(e,t),this.mScene.render()}},{key:"setPixelRatio",value:function(e){}},{key:"getCanvas",value:function(){return this.mCanvas}},{key:"getSceneBoundingBox",value:function(){for(var e=new ji,t=0,n=Object.entries(this.mRenderCache);t<n.length;t++){var r=o(n[t],2)[1];if(r.getSceneEntity().visible&&(!(r.getSceneEntity().layers.isEnabled(1)||r.getSceneEntity().layers.isEnabled(2)||r.getSceneEntity().layers.isEnabled(3)||r.getSceneEntity().layers.isEnabled(5)||r.getSceneEntity().layers.isEnabled(7))&&r instanceof LM)){var i=r.getRenderObject();if(i instanceof BABYLON.AbstractMesh){var a=i.getHierarchyBoundingVectors(!0),s=new ji(new Bi(a.min.x,a.min.y,a.min.z),new Bi(a.max.x,a.max.y,a.max.z));s.applyMatrix4(r.getSceneEntity().transform.matrixWorld),e.union(s)}}}return new ji(new Bi(e.min.x,e.min.y,e.min.z),new Bi(e.max.x,e.max.y,e.max.z))}},{key:"setCameraActive",value:function(e){this.mCamera=e,this.mScene.activeCamera=e.getRenderObject(),this.mScene.activeCameras[0]=e.getRenderObject()}},{key:"isRightHandedSystemActive",value:function(){return this.mScene.useRightHandedSystem}},{key:"initiateTransmission",value:function(e,t){var n="".concat(e,"-").concat(t);n in this.mTransmissionReferenceCounter||(this.mTransmissionReferenceCounter[n]=1),this.mTransmissionHelper||(qe.qL.print("Transmission Helper initiated!"),this.mTransmissionHelper=new dx({renderSize:Ti()?512:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:BABYLON.Constants.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0},this.mScene))}},{key:"disposeTransmission",value:function(e,t){if(this.mTransmissionHelper){var n="".concat(e,"-").concat(t);n in this.mTransmissionReferenceCounter&&delete this.mTransmissionReferenceCounter[n],0===Object.keys(this.mTransmissionReferenceCounter).length&&(qe.qL.print("Transmission Helper disposed!"),this.mTransmissionHelper.dispose(),delete this.mTransmissionHelper)}}},{key:"getInternalScene",value:function(){return this.mScene}},{key:"getInternalRenderer",value:function(){return this.mEngine}}],[{key:"loadScripts",value:(n=t(r().mark((function e(){var t,n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,__webpack_require__.e(796).then(__webpack_require__.t.bind(__webpack_require__,5385,23));case 2:return t=e.sent,e.next=5,Promise.all([__webpack_require__.e(796),__webpack_require__.e(323)]).then(__webpack_require__.t.bind(__webpack_require__,3689,23));case 5:return n=e.sent,e.next=8,Promise.all([__webpack_require__.e(796),__webpack_require__.e(803)]).then(__webpack_require__.t.bind(__webpack_require__,8809,23));case 8:i=e.sent,window.BABYLON=Sx(Sx(Sx({},t),n),i);case 10:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})}]),a}(no);function Ex(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ax=function(e){(0,g.Z)(n,e);var t=Ex(n);function n(){var e;(0,u.Z)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return e=t.call.apply(t,[this].concat(i)),(0,l.Z)((0,_.Z)(e),"mRenderObject",void 0),(0,l.Z)((0,_.Z)(e),"mMatrix",new THREE.Matrix4),(0,l.Z)((0,_.Z)(e),"mBoundingBox",new ji),e}return(0,c.Z)(n,[{key:"attach",value:function(){if(!this.mRenderObject)throw new Error("Trying to attach undefined object to scene");Ni((0,M.Z)(n.prototype),"attach",this).call(this),this.mRenderer.getScene().add(this.mRenderObject),this.onAttached()}},{key:"detach",value:function(){this.mAttached&&(this.mRenderer.getScene().remove(this.mRenderObject),this.onDetached(),Ni((0,M.Z)(n.prototype),"detach",this).call(this))}},{key:"getRenderObject",value:function(){return this.mRenderObject}},{key:"getRenderer",value:function(){return this.mRenderer}},{key:"update",value:function(e){Ni((0,M.Z)(n.prototype),"update",this).call(this,e),this.updateTranslation(),this.mSceneEntity.needsBoundingBoxUpdate()&&this.mRenderObject&&this.updateBoundingBox(),this.mSceneEntity.needsRenderUpdate()&&(this.onUpdateDirty(),this.mSceneEntity.setNeedsRenderUpdate(!1))}},{key:"onUpdateDirty",value:function(){this.mRenderObject&&(this.mRenderObject.visible=this.mSceneEntity.getVisibility())}},{key:"updateTranslation",value:function(){if(!this.mSceneEntity.transform.matrixNeedsUpdate&&!this.mSceneEntity.transform.matrixWorldNeedsUpdate)return!1;this.mRenderObject.matrixAutoUpdate=!1;var e=this.mSceneEntity.transform.matrixWorld.clone();this.mRenderer.isRightHandedSystemActive()||e.toggleCoordSystem();var t=e.elements;return this.mMatrix.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this.mRenderObject.matrix.copy(this.mMatrix),this.mRenderObject.matrixWorldNeedsUpdate=!0,!0}},{key:"updateBoundingBox",value:function(){this.mSceneEntity._updateBoundingBox(this.mBoundingBox)}},{key:"afterCreateRenderObject",value:function(){Ni((0,M.Z)(n.prototype),"afterCreateRenderObject",this).call(this),this.mRenderObject.userData||(this.mRenderObject.userData={}),this.mRenderObject.userData.scene_entity_id=this.mSceneEntity.id}},{key:"destroyRenderObject",value:function(){}},{key:"onAttached",value:function(){}},{key:"onDetached",value:function(){}}]),n}(BM);function Ox(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Dx=function(e){(0,g.Z)(h,e);var n,i,a,o,s=Ox(h);function h(e,t){var n;return(0,u.Z)(this,h),n=s.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mCastShadow",!1),(0,l.Z)((0,_.Z)(n),"mReceiveShadow",!1),(0,l.Z)((0,_.Z)(n),"mOldGeometryResolver",void 0),(0,l.Z)((0,_.Z)(n),"mGeometryResolver",void 0),(0,l.Z)((0,_.Z)(n),"mOldMaterialResolver",void 0),(0,l.Z)((0,_.Z)(n),"mMaterialResolver",void 0),(0,l.Z)((0,_.Z)(n),"mGeometryHandle",void 0),(0,l.Z)((0,_.Z)(n),"mMaterialHandle",void 0),(0,l.Z)((0,_.Z)(n),"mGeometry",void 0),(0,l.Z)((0,_.Z)(n),"mMaterial",void 0),n}return(0,c.Z)(h,[{key:"loadResource",value:(o=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateProperties(),e.next=3,this.loadResources();case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"geometryHasChanged",value:function(){return!this.mGeometryResolver||!this.mGeometryResolver.getHandle().validateHandle(this.mGeometryHandle)}},{key:"materialHasChanged",value:function(){return!this.mMaterialResolver||!this.mMaterialResolver.getHandle().validateHandle(this.mMaterialHandle)}},{key:"loadGeometry",value:(a=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mGeometryResolver||!this.mGeometryResolver.getHandle().validateHandle(this.mGeometryHandle)){e.next=4;break}return e.next=3,this.mGeometryResolver.load(this.onGeometryProgress.bind(this));case 3:return e.abrupt("return",e.sent);case 4:if(this.mGeometryResolver&&(this.mOldGeometryResolver=this.mGeometryResolver,delete this.mGeometryResolver),this.mGeometryHandle){e.next=7;break}throw new Error("Invalid geometry handle");case 7:return this.mGeometryResolver=new NM(this.mGeometryHandle,Qu.GeometryManager,!0),e.next=10,this.mGeometryResolver.load(this.onGeometryProgress.bind(this));case 10:return t=e.sent,this.mOldGeometryResolver&&(this.mOldGeometryResolver.dispose(),delete this.mOldGeometryResolver),e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"loadMaterial",value:(i=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mMaterialResolver||!this.mMaterialResolver.getHandle().validateHandle(this.mMaterialHandle)){e.next=4;break}return e.next=3,this.mMaterialResolver.load();case 3:return e.abrupt("return",e.sent);case 4:if(this.mMaterialResolver&&(this.mOldMaterialResolver=this.mMaterialResolver,delete this.mMaterialResolver),this.mMaterialHandle){e.next=7;break}throw new Error("Invalid material handle");case 7:return this.mMaterialResolver=new NM(this.mMaterialHandle,Qu.MaterialManager,!0),e.next=10,this.mMaterialResolver.load();case 10:return t=e.sent,this.mOldMaterialResolver&&(this.mOldMaterialResolver.dispose(),delete this.mOldMaterialResolver),e.abrupt("return",t);case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updateGeometryAsync",value:function(){var e=this;this.geometryHasChanged()&&this.loadGeometry().then((function(t){e.mGeometry=t,e.mRenderObject&&(e.mRenderObject.geometry=e.mGeometry.getInternalGeometry(),e.mRenderer.markShadowMapUpdate(),P.eventBus().dispatch(new Di(Ei.RequestFrame)))}),(function(e){qe.qL.warn("Failed to load geometry:",e)}))}},{key:"updateMaterialAsync",value:function(){var e=this;this.materialHasChanged()&&this.loadMaterial().then((function(t){e.mMaterial=t,e.mRenderObject&&(e.mRenderObject.material=e.mMaterial?e.mMaterial.getInternalMaterial():null,e.mRenderer.markShadowMapUpdate(),P.eventBus().dispatch(new Di(Ei.RequestFrame)))}),(function(e){qe.qL.warn("Failed to load material:",e)}))}},{key:"loadResources",value:(n=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.loadGeometry(),this.loadMaterial()]);case 2:t=e.sent,this.mGeometry=t[0],this.mMaterial=t[1],P.eventBus().dispatch(new Di(Ei.RequestFrame));case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;if(this.mCastShadow=e.castShadow,this.mReceiveShadow=e.receiveShadow,this.mGeometryHandle=e.getGeometry(),this.mMaterialHandle=e.getMaterial(),this.mRenderObject){this.mRenderObject.renderOrder=e.renderOrder,this.updateShadowProperties(this.mRenderObject);var t=this.mMaterial.getMetaData()||{};void 0!==t.renderOrder&&(this.mRenderObject.renderOrder=t.renderOrder)}}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(h.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.updateGeometryAsync(),this.updateMaterialAsync(),P.eventBus().dispatch(new Di(Ei.RequestFrame))}},{key:"updateTranslation",value:function(){Ni((0,M.Z)(h.prototype),"updateTranslation",this).call(this)&&(this.mReceiveShadow||this.mCastShadow)&&this.mRenderer.markShadowMapUpdate()}},{key:"onGeometryProgress",value:function(e){}},{key:"updateShadowProperties",value:function(e){if(this.mMaterial){var t=this.mMaterial.getOpacity();e.receiveShadow=this.mReceiveShadow&&t>.5,e.castShadow=this.mCastShadow&&t>.99}}},{key:"createRenderObject",value:function(){var e=this,t=new THREE.Mesh(this.mGeometry.getInternalGeometry(),this.mMaterial.getInternalMaterial());t.name=this.mSceneEntity.name,t.visible=this.mSceneEntity.getVisibility(),t.renderOrder=this.mSceneEntity.renderOrder,t.castShadow=this.mCastShadow,t.receiveShadow=this.mReceiveShadow,t.material.vertexColors=this.mGeometry.hasColors()?THREE.VertexColors:THREE.NoColors;var n=this.mMaterial.getMetaData()||{};void 0!==n.renderOrder&&(t.renderOrder=n.renderOrder),this.updateShadowProperties(t),t.onBeforeRender=function(n,r,i,a,o){e.getRenderer().onBeforeMeshRender(t,e.mSceneEntity,n,r,i,a,o)},t.onAfterRender=function(n,r,i,a,o){e.getRenderer().onAfterMeshRender(t,e.mSceneEntity,n,r,i,a,o)},this.mRenderObject=t}},{key:"updateBoundingBox",value:function(){this.mGeometry.getInternalGeometry().boundingBox||this.mGeometry.getInternalGeometry().computeBoundingBox();var e=(new Bi).fromArray(this.mGeometry.getInternalGeometry().boundingBox.min.toArray()),t=(new Bi).fromArray(this.mGeometry.getInternalGeometry().boundingBox.max.toArray());this.mBoundingBox.copy(new ji(e,t)),Ni((0,M.Z)(h.prototype),"updateBoundingBox",this).call(this)}},{key:"destroyRenderObject",value:function(){if(this.mRenderObject&&(delete this.mRenderObject.onBeforeRender,delete this.mRenderObject.onAfterRender),this.mMaterialResolver)try{this.mMaterialResolver.dispose(),delete this.mMaterialResolver}catch(e){qe.qL.warn("Failed to dispose resource",e)}if(this.mOldMaterialResolver)try{this.mOldMaterialResolver.dispose(),delete this.mOldMaterialResolver}catch(e){qe.qL.warn("Failed to dispose resource",e)}if(this.mGeometryResolver)try{this.mGeometryResolver.dispose(),delete this.mGeometryResolver}catch(e){qe.qL.warn("Failed to dispose resource",e)}if(this.mOldGeometryResolver)try{this.mOldGeometryResolver.dispose(),delete this.mOldGeometryResolver}catch(e){qe.qL.warn("Failed to dispose resource",e)}Ni((0,M.Z)(h.prototype),"destroyRenderObject",this).call(this)}}]),h}(Ax);function Px(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Bx=function(e){(0,g.Z)(a,e);var n,i=Px(a);function a(e,t){return(0,u.Z)(this,a),i.call(this,e,t)}return(0,c.Z)(a,[{key:"loadGeometry",value:(n=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ni((0,M.Z)(a.prototype),"loadGeometry",this).call(this);case 2:return(t=e.sent)&&t.getInternalGeometry().setIndex(null),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"createRenderObject",value:function(){var e=this;this.mGeometry&&this.mGeometry.getInternalGeometry().setIndex(null);var t=new THREE.LineSegments(this.mGeometry.getInternalGeometry(),this.mMaterial.getInternalMaterial());t.material.vertexColors=this.mGeometry.hasColors()?THREE.VertexColors:THREE.NoColors,t.computeLineDistances(),t.name=this.mSceneEntity.name,t.visible=this.mSceneEntity.getVisibility(),t.castShadow=this.mCastShadow,t.receiveShadow=this.mReceiveShadow,t.onBeforeRender=function(n,r,i,a,o){e.getRenderer().onBeforeMeshRender(t,e.mSceneEntity,n,r,i,a,o)},t.onAfterRender=function(n,r,i,a,o){e.getRenderer().onAfterMeshRender(t,e.mSceneEntity,n,r,i,a,o)},this.mRenderObject=t}}]),a}(Dx);function Fx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Lx=function(e){(0,g.Z)(n,e);var t=Fx(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"mCellWidth",1),(0,l.Z)((0,_.Z)(i),"mCellHeight",1),i}return(0,c.Z)(n,[{key:"updateProperties",value:function(){Ni((0,M.Z)(n.prototype),"updateProperties",this).call(this);var e=this.mSceneEntity;this.mCellWidth=e.getValue("cell_width"),this.mCellHeight=e.getValue("cell_height")}}]),n}(Dx);function Nx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nx(Object(n),!0).forEach((function(t){(0,l.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zx(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Ux(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ux(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Ux(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Vx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Hx=function(e){(0,g.Z)(a,e);var n,i=Vx(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mPersCamera",void 0),(0,l.Z)((0,_.Z)(e),"mOrthoCamera",void 0),(0,l.Z)((0,_.Z)(e),"mScreenScene",void 0),(0,l.Z)((0,_.Z)(e),"mBlurShader",void 0),(0,l.Z)((0,_.Z)(e),"mAOPlaneShader",void 0),(0,l.Z)((0,_.Z)(e),"mDepthShaderMaterial",void 0),(0,l.Z)((0,_.Z)(e),"mRT1",void 0),(0,l.Z)((0,_.Z)(e),"mRT2",void 0),(0,l.Z)((0,_.Z)(e),"mPlane",void 0),(0,l.Z)((0,_.Z)(e),"mPlaneSize",void 0),(0,l.Z)((0,_.Z)(e),"mPlaneMaterial",void 0),(0,l.Z)((0,_.Z)(e),"mScreenQuad",void 0),(0,l.Z)((0,_.Z)(e),"AOPlaneRTSize",256),(0,l.Z)((0,_.Z)(e),"mClipDistance",.05),(0,l.Z)((0,_.Z)(e),"mSamplingRadius",8),(0,l.Z)((0,_.Z)(e),"mPower",.5),(0,l.Z)((0,_.Z)(e),"mRebuildAO",!0),(0,l.Z)((0,_.Z)(e),"mVertexShader","\n        precision highp float;\n\n        varying float vDepth;\n        varying vec2 vUv;\n        varying vec3 vModelPosition;\n\n        void main() {\n            vec4 modelPosition = modelViewMatrix * vec4( position, 1.0 );\n            vModelPosition = modelPosition.xyz;\n            vDepth =  -modelPosition.z;\n            vUv = uv;\n            gl_Position = projectionMatrix * modelPosition;\n        }\n    "),(0,l.Z)((0,_.Z)(e),"mFragmentDepthShader","\n        #ifdef HIGHP_SUPPORTED\n            precision highp float;\n        #endif\n\n        #include <packing>\n        uniform float far;\n\n        varying float vDepth;\n\n        void main (){\n            gl_FragColor = packDepthToRGBA(vDepth/far); // Save depth in part-components space.\n        }\n    "),(0,l.Z)((0,_.Z)(e),"mFragmentBlurShader","\n        #ifdef HIGHP_SUPPORTED\n            precision highp float;\n        #endif\n\n        uniform vec2 iResolution;\n        uniform vec2 direction;\n        uniform sampler2D tDiffuse;\n\n        varying vec2 vUv;\n\n        vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n            vec4 color = vec4(0.0);\n            vec2 off1 = vec2(1.3846153846) * direction;\n            vec2 off2 = vec2(3.2307692308) * direction;\n            color += texture2D(image, uv) * 0.2270270270;\n            color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n            color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n            color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n            color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n            return color;\n        }\n\n        void main() {\n            gl_FragColor = blur9(tDiffuse, vUv, iResolution.xy, direction);\n        }\n    "),(0,l.Z)((0,_.Z)(e),"mFragmentAO","\n        #ifdef HIGHP_SUPPORTED\n            precision highp float;\n        #endif\n\n        uniform sampler2D Sample0; // View space position data\n        uniform vec2 TexelSize;\n        uniform float SamplingRadius;\n        uniform float Power;\n        uniform float CameraFar;\n        uniform float CameraNear;\n        uniform vec2 RightTop;\n\n        varying vec3 vModelPosition;\n        varying vec2 vUv;\n\n        #include <packing>\n\n        vec3 reconstructPosition(vec2 uv){\n            vec2 ndc = uv*2.0 - vec2(1.0, 1.0);\n            vec4 sampleDepth = texture2D(Sample0, uv);\n            float modelDepth = unpackRGBAToDepth(sampleDepth);\n            vec2 pnear = ndc * RightTop;\n            float pz = -modelDepth*CameraFar;\n            return vec3(-pz*pnear.x / CameraNear, -pz*pnear.y / CameraNear, pz);\n        }\n\n        float SamplePixels (vec3 srcPosition, vec2 uv)\n        {\n            vec3 dstPosition = reconstructPosition(uv);\n\n            vec3 positionVec = dstPosition - srcPosition;\n            float dist = length(positionVec);\n            float intensity = dist*dist*dist*dist;\n            intensity = intensity*Power;\n            intensity = exp(-(intensity));\n\n            return min(-dstPosition.z, intensity);\n        }\n\n        void main ()\n        {\n            float kernelRadius = SamplingRadius;\n\n            // Sample neighbouring pixels\n            vec2 kernel[4];\n            kernel[0] = vec2(0.0, 1.0); // top\n            kernel[1] = vec2(1.0, 0.0); // right\n            kernel[2] = vec2(0.0, -1.0); // bottom\n            kernel[3] = vec2(-1.0, 0.0); // left\n\n            const float Sin45 = 0.707107; // 45 degrees = sin(PI / 4)\n\n            float occlusion = 0.0;\n            for (int i = 0; i < 4; ++i)\n            {\n                vec2 k1 = kernel[i];\n                vec2 k2 = vec2(k1.x * Sin45 - k1.y * Sin45, k1.x * Sin45 + k1.y * Sin45);\n                k1 *= TexelSize;\n                k2 *= TexelSize;\n                occlusion += SamplePixels(vModelPosition, vUv + k1 * kernelRadius);\n                occlusion += SamplePixels(vModelPosition, vUv + k2 * kernelRadius * 0.75);\n                occlusion += SamplePixels(vModelPosition, vUv + k1 * kernelRadius * 0.5);\n                occlusion += SamplePixels(vModelPosition, vUv + k2 * kernelRadius * 0.25);\n            }\n\n            // Average and clamp ambient occlusion.\n            occlusion /= 16.0;\n            occlusion = clamp(occlusion, 0.0, 1.0);\n\n            gl_FragColor = vec4(0.0, 0.0, 0.0, exp(occlusion) - 1.0);\n        }\n    "),e}return(0,c.Z)(a,[{key:"isDirty",get:function(){return this.mRebuildAO},set:function(e){this.mRebuildAO=e}},{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties(),this.isDirty=!0;case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.isDirty=!0}},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mClipDistance=e.clipDistance,this.mSamplingRadius=e.samplingRadius,this.mPower=e.power}},{key:"calculatePower",value:function(){return 1/Math.exp(9*(1-(1-this.mPower)))}},{key:"fitCameraToObject",value:function(){var e=this.getRenderer().getSceneBoundingBox();e.isEmpty()&&e.set(new Bi(0,0,0),new Bi(0,0,0));var t=new Bi;e.getCenter(t);var n=new THREE.Vector3(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),r=n.x>n.z?n.x:n.z;if(!(r<=0)){var i=r/2/Math.tan(45*Math.PI/360);this.mPersCamera.position.set(t.x,t.y-(i+n.y),t.z),this.mPersCamera.far=Math.abs(this.mPersCamera.position.y-e.min.y)*(1+this.mClipDistance),this.mPersCamera.fov=45,this.mPersCamera.lookAt(new THREE.Vector3(t.x,t.y,t.z)),this.mPersCamera.updateProjectionMatrix();var o=2*Math.tan(Math.PI/180*45/2)*this.mPersCamera.near,s=2*Math.tan(Math.PI/180*45/2)*this.mPersCamera.far,u=new THREE.Vector3(t.x,e.min.y-a.POSITION_EPSILON,t.z),c=(s-o)*((this.mPersCamera.position.distanceTo(u)-this.mPersCamera.near)/(this.mPersCamera.far-this.mPersCamera.near));this.updatePlaneGeometry(u,c)}}},{key:"updatePlaneGeometry",value:function(e,t){if(this.mPlaneSize!==t){this.mPlane.geometry&&this.mPlane.geometry.dispose(),this.mPlaneSize=t,this.mPlane.geometry=new THREE.PlaneGeometry(t,t,1,1);var n=this.mSceneEntity;n.width=t,n.height=t}this.mPlane.position.copy(e),this.mPlane.rotation.set(1.57,0,0)}},{key:"renderPlaneDepth",value:function(e,t,n){this.mPlane.visible=!1,this.fitCameraToObject(),this.mDepthShaderMaterial.uniforms.far.value=this.mPersCamera.far,this.mDepthShaderMaterial.needsUpdate=!0;var r=t.overrideMaterial,i=t.background,a=e.getRenderTarget();t.overrideMaterial=this.mDepthShaderMaterial,t.background=null;var o=e.getClearColor(),s=e.getClearAlpha();e.setRenderTarget(this.mRT1),e.setClearColor(0,0),e.clear(),e.render(t,this.mPersCamera),this.mPlane.visible=!0,t.overrideMaterial=r,t.background=i,e.setRenderTarget(a),e.setClearColor(o,s)}},{key:"renderAO",value:function(e,t,n){var r=this.mPersCamera.far,i=this.mPersCamera.near,a=Pt(this.mPersCamera.fov),o=this.mPersCamera.aspect,s=Math.tan(a/2)*i,u=s*o,c=new THREE.Vector2(u,s);this.mAOPlaneShader.uniforms.RightTop.value.copy(c),this.mAOPlaneShader.uniforms.SamplingRadius.value=this.mSamplingRadius,this.mAOPlaneShader.uniforms.Power.value=this.calculatePower(),this.mAOPlaneShader.uniforms.CameraFar.value=r,this.mAOPlaneShader.uniforms.CameraNear.value=i,this.mAOPlaneShader.uniforms.Sample0.value=this.mRT1.texture,this.mAOPlaneShader.uniforms.TexelSize.value.copy(new THREE.Vector2(1/this.AOPlaneRTSize,1/this.AOPlaneRTSize)),this.mAOPlaneShader.needsUpdate=!0,this.mScreenQuad.material=this.mAOPlaneShader;var l=e.getRenderTarget(),h=e.getClearColor(),f=e.getClearAlpha();e.setRenderTarget(this.mRT2),e.setClearColor(0,0),e.clear(),e.render(this.mScreenScene,this.mOrthoCamera),e.setRenderTarget(l),e.setClearColor(h,f)}},{key:"renderBlur",value:function(e,t,n){this.mBlurShader.uniforms.direction.value.set(1,0),this.mBlurShader.uniforms.tDiffuse.value=this.mRT2.texture,this.mBlurShader.needsUpdate=!0,this.mScreenQuad.material=this.mBlurShader;var r=e.getRenderTarget(),i=e.getClearColor(),a=e.getClearAlpha();e.setRenderTarget(this.mRT1),e.setClearColor(0,0),e.clear(),e.render(this.mScreenScene,this.mOrthoCamera),this.mBlurShader.uniforms.direction.value.set(0,1),this.mBlurShader.uniforms.tDiffuse.value=this.mRT1.texture,this.mBlurShader.needsUpdate=!0,e.setRenderTarget(this.mRT2),e.clear(),e.render(this.mScreenScene,this.mOrthoCamera),e.setRenderTarget(r),e.setClearColor(i,a)}},{key:"updateTranslation",value:function(){return!1}},{key:"onBeforeRender",value:function(e,t,n){var r=this;if(this.isDirty){t.layers.enable(3);!function e(t,n){if(n(t),t.children&&t.children.length>0){var r,i=zx(t.children);try{for(i.s();!(r=i.n()).done;){e(r.value,n)}}catch(e){i.e(e)}finally{i.f()}}}(t,(function(e){if(t!==e){var n=r.getRenderer().getEntityFromObject(e);n?n.layers.isEnabled(1)||n.layers.isEnabled(2)||n.layers.isEnabled(3)||n.layers.isEnabled(7)||n.layers.isEnabled(8)?e.layers.disable(3):e.layers.enable(3):e.layers.disable(3)}})),this.renderPlaneDepth(e,t,n),this.renderAO(e,t,n),this.renderBlur(e,t,n),this.mPlaneMaterial.map=this.mRT2.texture,this.mPlaneMaterial.needsUpdate=!0}}},{key:"onAfterRender",value:function(e,t,n){this.isDirty&&(this.isDirty=!1)}},{key:"createRenderObject",value:function(){var e={},t=this.mRenderer.getRenderer().getContext();t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0&&(e={HIGHP_SUPPORTED:!0}),this.mRT1=new THREE.WebGLRenderTarget(this.AOPlaneRTSize,this.AOPlaneRTSize,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.mRT2=new THREE.WebGLRenderTarget(this.AOPlaneRTSize,this.AOPlaneRTSize,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat}),this.mDepthShaderMaterial=new THREE.ShaderMaterial({uniforms:{far:{value:2}},defines:jx({},e),vertexShader:this.mVertexShader,fragmentShader:this.mFragmentDepthShader}),this.mDepthShaderMaterial.side=THREE.DoubleSide,this.mPersCamera=new THREE.PerspectiveCamera(45,1,.01,1e4),this.mOrthoCamera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.mScreenScene=new THREE.Scene,this.mPersCamera.layers.set(3),this.mBlurShader=new THREE.ShaderMaterial({uniforms:{iResolution:{value:new THREE.Vector2(this.AOPlaneRTSize,this.AOPlaneRTSize)},direction:{value:new THREE.Vector2(1,0)},tDiffuse:{value:null}},defines:jx({},e),vertexShader:this.mVertexShader,fragmentShader:this.mFragmentBlurShader}),this.mAOPlaneShader=new THREE.ShaderMaterial({uniforms:{TexelSize:{value:new THREE.Vector2(1/this.AOPlaneRTSize,1/this.AOPlaneRTSize)},RightTop:{value:new THREE.Vector2(1,1)},SamplingRadius:{value:this.mSamplingRadius},Power:{value:this.calculatePower()},CameraFar:{value:1e3},CameraNear:{value:.01},Sample0:{value:null}},defines:jx({},e),vertexShader:this.mVertexShader,fragmentShader:this.mFragmentAO}),this.mScreenQuad=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2)),this.mScreenQuad.frustumCulled=!1,this.mScreenScene.add(this.mScreenQuad),this.mPlaneMaterial=new THREE.MeshBasicMaterial({color:16777215,side:THREE.BackSide}),this.mPlaneMaterial.transparent=!0,this.mPlaneMaterial.depthWrite=!1,this.mPlane=new THREE.Mesh,this.mPlane.name="ao-plane-mesh",this.mPlane.onBeforeRender=this.onBeforeRender.bind(this),this.mPlane.onAfterRender=this.onAfterRender.bind(this),this.mPlane.material=this.mPlaneMaterial;var n=this.getRenderer().getSceneBoundingBox();n.isEmpty()&&n.set(new Bi(0,0,0),new Bi(0,0,0));var r=new Bi;n.getCenter(r),r.setY(n.min.y-a.POSITION_EPSILON),this.updatePlaneGeometry(new THREE.Vector3(r.x,r.y,r.z),10);var i=new THREE.Group;i.name="ao-plane-group",i.add(this.mPlane),this.mRenderObject=i}},{key:"disposeProperty",value:function(e){e&&e.dispose()}},{key:"dispose",value:function(){var e;this.disposeProperty(this.mRT1),this.disposeProperty(this.mRT2),this.disposeProperty(this.mPlaneMaterial),this.disposeProperty(this.mBlurShader),this.disposeProperty(this.mAOPlaneShader),this.disposeProperty(this.mDepthShaderMaterial),this.disposeProperty(this.mPlaneMaterial),this.mScreenQuad&&this.disposeProperty(this.mScreenQuad.geometry),this.mPlane&&this.disposeProperty(this.mPlane.geometry),(e=this.mScreenScene).remove.apply(e,s(this.mScreenScene.children)),Ni((0,M.Z)(a.prototype),"dispose",this).call(this)}}]),a}(Ax);function Gx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(Hx,"POSITION_EPSILON",.001);var qx=function(e){(0,g.Z)(a,e);var n,i=Gx(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mFireMesh",null),(0,l.Z)((0,_.Z)(e),"mCameraHeight",null),(0,l.Z)((0,_.Z)(e),"mCameraFOV",null),(0,l.Z)((0,_.Z)(e),"mClock",null),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"update",value:function(e){Ni((0,M.Z)(a.prototype),"update",this).call(this,e);var t=this.mRenderer.getRenderer(),n=this.mRenderer.getActiveCamera(),r=new THREE.Vector2;t.getSize(r),this.mCameraHeight==r.y&&this.mCameraFOV==n.fov||(this.mCameraHeight=r.y,this.mCameraFOV=n.fov,this.mFireMesh.material.setPerspective(this.mCameraFOV,this.mCameraHeight)),this.mFireMesh.material.update(this.mClock.getDelta())}},{key:"createRenderObject",value:function(){var e=new particleFire.Geometry(.5,3,300),t=new particleFire.Material({color:16720384});this.mFireMesh=new THREE.Points(e,t),this.mClock=new THREE.Clock,this.mRenderObject=this.mFireMesh}},{key:"dispose",value:function(){null!==this.mFireMesh&&(this.mFireMesh.material.dispose(),this.mFireMesh=null),this.mCameraHeight=null,this.mCameraFOV=null,this.mClock=null,Ni((0,M.Z)(a.prototype),"dispose",this).call(this)}}]),a}(Ax);function Wx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Yx=function(e){(0,g.Z)(a,e);var n,i=Wx(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mFlareTexture",void 0),(0,l.Z)((0,_.Z)(e),"mMaterial",void 0),(0,l.Z)((0,_.Z)(e),"mFlareGeometry",void 0),(0,l.Z)((0,_.Z)(e),"mFlarePlane",null),(0,l.Z)((0,_.Z)(e),"mRayCaster",new THREE.Raycaster),(0,l.Z)((0,_.Z)(e),"mAlpha",1),(0,l.Z)((0,_.Z)(e),"mAngle",1),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){(new THREE.TextureLoader).load("".concat(Jr.E.assetsUrl,"system/textures/flare-strip.png"),(function(n){t.mFlareTexture=n,e()}),(function(e){}),(function(e){qe.qL.error("Failed to load water normal texture: ",e),n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"update",value:function(e){Ni((0,M.Z)(a.prototype),"update",this).call(this,e);var t=this.mRenderer.getActiveCamera(),n=this.mRenderer.getScene();this.updateFlare(t,n)}},{key:"updateFlare",value:function(e,t){var n=this.mFlarePlane.matrixWorld.clone(),r=new THREE.Vector3,i=new THREE.Vector3,a=new THREE.Quaternion;n.decompose(i,a,r);var o=new THREE.Vector3;o.applyMatrix4(n);var s=new THREE.Vector3(0,0,1);s.applyQuaternion(a).normalize();var u=e.position.clone(),c=u.clone().sub(o).clone().normalize(),l=s.dot(c),h=l<0?0:l;h=(h=this.mAngle-Math.pow(-.59*(1-Math.exp(1-h)),4)-(1-this.mAlpha))<0?0:h;var f=o.clone().sub(u);if(this.mRayCaster.set(u.clone(),f.clone().normalize()),this.mRayCaster.far=f.length()-1e-4,this.mRayCaster.intersectObjects(t.children,!0).length>0)this.mMaterial.opacity=0;else{var p=new THREE.Vector3(0,1,0);(new THREE.Matrix4).lookAt(o,u.clone(),p),this.mMaterial.opacity=h,this.mFlareGeometry.verticesNeedUpdate=!0,this.mFlareGeometry.computeFaceNormals()}}},{key:"createRenderObject",value:function(){this.mMaterial=new THREE.MeshBasicMaterial({map:this.mFlareTexture,side:THREE.DoubleSide,blending:THREE.AdditiveBlending,depthTest:!1,depthFunc:THREE.LessDepth,depthWrite:!1,transparent:!0,color:16777215,opacity:.9}),this.mMaterial.needsUpdate=!0,this.mFlareGeometry=new THREE.PlaneGeometry(4,1,8),this.mFlarePlane=new THREE.Mesh(this.mFlareGeometry,this.mMaterial),this.mFlarePlane.castShadow=!1,this.mFlarePlane.receiveShadow=!1,this.mRenderObject=this.mFlarePlane}},{key:"dispose",value:function(){this.mFlareTexture&&(this.mFlareTexture.dispose(),delete this.mFlareTexture),this.mMaterial&&(this.mMaterial.dispose(),delete this.mMaterial),delete this.mFlareGeometry,delete this.mFlarePlane,Ni((0,M.Z)(a.prototype),"dispose",this).call(this)}}]),a}(Ax);function Kx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Xx=function(e){(0,g.Z)(a,e);var n,i=Kx(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mPoints",new Array),(0,l.Z)((0,_.Z)(e),"mMesh",void 0),(0,l.Z)((0,_.Z)(e),"mHasVertices",!1),(0,l.Z)((0,_.Z)(e),"mVertices",void 0),(0,l.Z)((0,_.Z)(e),"mColors",void 0),(0,l.Z)((0,_.Z)(e),"mBuffer",void 0),(0,l.Z)((0,_.Z)(e),"mEdgesRebuild",!1),(0,l.Z)((0,_.Z)(e),"mEdges",4),(0,l.Z)((0,_.Z)(e),"mSize",1),(0,l.Z)((0,_.Z)(e),"mBlur",2),(0,l.Z)((0,_.Z)(e),"mExtension",0),(0,l.Z)((0,_.Z)(e),"mColor",new THREE.Color),(0,l.Z)((0,_.Z)(e),"mFlare",new THREE.Color),(0,l.Z)((0,_.Z)(e),"mAlpha",1),(0,l.Z)((0,_.Z)(e),"mAngle",1),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mEdges=e.getValue("edges"),this.mSize=e.getValue("size"),this.mBlur=e.getValue("blur"),this.mExtension=e.getValue("extension"),this.mAlpha=e.getValue("alpha"),this.mAngle=e.getValue("angle"),this.mColor=e.getValue("color"),this.mFlare=e.getValue("flare")}},{key:"update",value:function(e){Ni((0,M.Z)(a.prototype),"update",this).call(this,e),this.mEdgesRebuild&&this._buildEdges(this.mEdges,!0);var t=this.mRenderer.getActiveCamera();this._updateGlare(t)}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.mEdgesRebuild=!0}},{key:"createRenderObject",value:function(){this.mMesh=new THREE.Mesh(new THREE.BufferGeometry,this._createMaterial()),this._buildEdges(this.mEdges,!0),this.mRenderObject=this.mMesh}},{key:"_buildEdges",value:function(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]||this.mEdges!==e){this.mEdges=e,this.mPoints.splice(0,this.mPoints.length);for(var t=360/this.mEdges*.0174533,n=0;n<this.mEdges;n++){var r=new THREE.Matrix4;r.makeRotationZ(t*-n);var i=new THREE.Vector3(0,this.mSize,0);i.applyMatrix4(r),this.mPoints.push({v:new THREE.Vector3(i.x,0,i.y)})}this.mHasVertices=!1,this.mEdgesRebuild=!1}}},{key:"_updateGlare",value:function(e){for(var t=this.mMesh.matrixWorld.clone(),n=(new THREE.Matrix4).getInverse(t),r=e.projectionMatrix.clone().multiply(e.matrixWorldInverse.clone()),i=(new THREE.Matrix4).getInverse(r.clone()),a=0;a<this.mPoints.length;a++){var o=this.mPoints[a].v.clone();o.applyMatrix4(t);var s=o.clone(),u=new THREE.Vector4(s.x,s.y,s.z,1).applyMatrix4(r);u.multiplyScalar(1/u.w),this.mPoints[a].wp0=o,this.mPoints[a].sp=new THREE.Vector3(u.x,u.y,u.z)}for(var c=this.mBlur,l=0;l<this.mPoints.length;l++){var h=(l+1)%this.mPoints.length,f=this.mPoints[l].sp.clone(),p=this.mPoints[h].sp.clone(),m=f.clone().sub(p),d=new THREE.Vector3(-m.y,m.x,0);d.normalize(),f.addScaledVector(d,40),p.addScaledVector(d,40);var v=f.clone().applyMatrix4(i),y=p.clone().applyMatrix4(i);v.applyMatrix4(n),y.applyMatrix4(n);var g=v.sub(this.mPoints[l].v).normalize(),b=y.sub(this.mPoints[h].v).normalize();this.mPoints[l].wp1=this.mPoints[l].v.clone().addScaledVector(g,c),this.mPoints[l].wp2=this.mPoints[h].v.clone().addScaledVector(b,c)}var M=[],k=[],_=[],x=new THREE.Vector3,T=new THREE.Vector3,w=new THREE.Quaternion;t.decompose(x,w,T);var R=new THREE.Vector3;R.applyMatrix4(t);var Z=new THREE.Vector3(0,1,0);Z.applyQuaternion(w).normalize();var S=e.position.clone().clone().sub(R).clone().normalize(),C=Z.dot(S),I=C<0?0:C;I=this.mAngle-Math.pow(-.59*(1-Math.exp(1-I)),4)-(1-this.mAlpha),I=Math.max(0,I);for(var E=this.mColor,A=this.mFlare,O=0;O<this.mPoints.length;O++){var D=(O+1)%this.mPoints.length;M.push(this.mPoints[O].v.x,this.mPoints[O].v.y,this.mPoints[O].v.z),k.push(E.r,E.g,E.b,I),M.push(this.mPoints[O].wp1.x,this.mPoints[O].wp1.y,this.mPoints[O].wp1.z),k.push(A.r,A.g,A.b,0),M.push(this.mPoints[O].wp2.x,this.mPoints[O].wp2.y,this.mPoints[O].wp2.z),k.push(A.r,A.g,A.b,0),M.push(this.mPoints[D].v.x,this.mPoints[D].v.y,this.mPoints[D].v.z),k.push(E.r,E.g,E.b,I);var P=this.mPoints[O].wp2.clone().addScaledVector(this.mPoints[D].wp1.clone().sub(this.mPoints[O].wp2),.5).sub(this.mPoints[D].v).normalize(),B=this.mPoints[D].v.clone().addScaledVector(P,c+this.mExtension);M.push(this.mPoints[D].v.x,this.mPoints[D].v.y,this.mPoints[D].v.z),k.push(E.r,E.g,E.b,I),M.push(this.mPoints[O].wp2.x,this.mPoints[O].wp2.y,this.mPoints[O].wp2.z),k.push(A.r,A.g,A.b,0),M.push(B.x,B.y,B.z),k.push(A.r,A.g,A.b,0),M.push(this.mPoints[D].wp1.x,this.mPoints[D].wp1.y,this.mPoints[D].wp1.z),k.push(A.r,A.g,A.b,0)}for(var F=this.mPoints[0].v.clone(),L=1;L<this.mPoints.length;L++)F.add(this.mPoints[L].v);F.multiplyScalar(1/this.mPoints.length);for(var N=0;N<this.mPoints.length;N++){var j=N,z=(N+1)%this.mPoints.length;M.push(F.x,F.y,F.z),k.push(E.r,E.g,E.b,I),M.push(this.mPoints[j].v.x,this.mPoints[j].v.y,this.mPoints[j].v.z),k.push(E.r,E.g,E.b,I),M.push(this.mPoints[z].v.x,this.mPoints[z].v.y,this.mPoints[z].v.z),k.push(E.r,E.g,E.b,I),M.push(F.x,F.y,F.z),k.push(E.r,E.g,E.b,I)}for(var U=M.length/3,V=!1,H=0;H<U;)V?(_.push(H,H-1,H-3),H+=1):(_.push(H,(H+2)%U,(H+1)%U),H+=3),V=!V;if(this.mHasVertices){for(var G=0;G<this.mVertices.length;G++)this.mVertices[G]=M[G];for(var q=0;q<this.mColors.length;q++)this.mColors[q]=k[q];this.mBuffer.getAttribute("position").needsUpdate=!0,this.mBuffer.getAttribute("customColor").needsUpdate=!0}else{this.mVertices=new Float32Array(M),this.mColors=new Float32Array(k);var W=new Uint32Array(_);this.mBuffer=new THREE.BufferGeometry,this.mBuffer.setIndex(new THREE.BufferAttribute(W,1)),this.mBuffer.addAttribute("position",new THREE.BufferAttribute(this.mVertices,3)),this.mBuffer.addAttribute("customColor",new THREE.BufferAttribute(this.mColors,4)),this.mMesh.geometry.dispose(),this.mMesh.geometry=this.mBuffer,this.mHasVertices=!0}}},{key:"_createMaterial",value:function(){return new THREE.ShaderMaterial({vertexShader:"\n            attribute vec4 customColor;\n            varying vec4 vColor;\n            void main() {\n                vColor = customColor;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n            }\n        ",fragmentShader:"\n            varying vec4 vColor;\n            void main() {\n                vec4 nlColor = vColor;\n                nlColor.a = pow(((1.0-exp(nlColor.a))*-1.0),2.0);\n                gl_FragColor = nlColor;\n            }\n        ",blending:THREE.CustomBlending,blendEquation:THREE.AddEquation,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.DstAlphaFactor,depthTest:!0,depthFunc:THREE.LessDepth,depthWrite:!1,transparent:!0,lights:!1,side:THREE.DoubleSide,wireframe:!1})}},{key:"dispose",value:function(){this.mMesh.material.dispose(),this.mBuffer&&(this.mBuffer.dispose(),delete this.mBuffer),delete this.mVertices,delete this.mMesh,delete this.mColor,this.mHasVertices=!1,Ni((0,M.Z)(a.prototype),"dispose",this).call(this)}}]),a}(Ax);function $x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Qx=function(e){(0,g.Z)(a,e);var n,i=$x(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mColor",new THREE.Color),(0,l.Z)((0,_.Z)(e),"mOpacity",1),(0,l.Z)((0,_.Z)(e),"mReflector",void 0),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mColor.setRGB(e.color.r,e.color.g,e.color.b),this.mOpacity=e.opacity}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.updateUniforms()}},{key:"updateUniforms",value:function(){this.mReflector&&(this.mReflector.material.uniforms.color.value=this.mColor,this.mReflector.material.uniforms.opacity.value=this.mOpacity,this.mReflector.material.needsUpdate=!0)}},{key:"createRenderObject",value:function(){var e=new THREE.PlaneBufferGeometry(20,20);this.mReflector=new THREE.Reflector(e,{clipBias:.003,textureWidth:1024,textureHeight:1024,color:this.mColor,opacity:this.mOpacity,recursion:1}),this.mReflector.rotation.x=.5*-Math.PI,qe.qL.print("reflector created: ",this.mReflector),this.mRenderObject=this.mReflector}},{key:"dispose",value:function(){this.mReflector.geometry.dispose(),this.mReflector.material&&this.mReflector.material.dispose(),delete this.mReflector,Ni((0,M.Z)(a.prototype),"dispose",this).call(this)}}]),a}(Ax);function Jx(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var eT=function(e){(0,g.Z)(s,e);var n,i,a=Jx(s);function s(){var e;(0,u.Z)(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=a.call.apply(a,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mTextureCube",null),(0,l.Z)((0,_.Z)(e),"mCubeMaterial",null),(0,l.Z)((0,_.Z)(e),"mTextures",void 0),(0,l.Z)((0,_.Z)(e),"mHandles",{}),(0,l.Z)((0,_.Z)(e),"mActiveLoaders",{}),(0,l.Z)((0,_.Z)(e),"mActiveTextures",{}),e}return(0,c.Z)(s,[{key:"loadResource",value:(i=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateProperties(),e.abrupt("return",this.updateTextures());case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mTextures=e.getTextureIds()}},{key:"updateHandles",value:function(){for(var e=!1,t=0,n=Object.entries(this.mTextures);t<n.length;t++){var r=o(n[t],2),i=r[0],a=r[1];if(!this.mHandles[i]||this.mHandles[i].id!==a){e=!0;var s=tc.getManager(Qu.TextureManager);this.mHandles[i]&&s.disposeResource(this.mHandles[i].handle),this.mHandles[i]={id:a,handle:s.makeResource(a)}}}return e}},{key:"updateTextures",value:(n=t(r().mark((function e(){var t,n,i,a,s,u=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.updateHandles()){e.next=2;break}return e.abrupt("return");case 2:t=[],n=[],i=r().mark((function e(){var i,c,l,h;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o(s[a],2),c=i[0],l=i[1],t.push(c),!u.mActiveLoaders[c]||!u.mActiveLoaders[c].getHandle().validateHandle(l.handle)){e.next=4;break}return e.abrupt("return","continue");case 4:u.mActiveLoaders[c]&&(u.mActiveLoaders[c].dispose(),delete u.mActiveLoaders[c]),u.mActiveLoaders[c]=new NM(l.handle,Qu.TextureManager),(h=u.mActiveLoaders[c].load()).then((function(e){u.mActiveTextures[c]=e})),n.push(h);case 9:case"end":return e.stop()}}),e)})),a=0,s=Object.entries(this.mHandles);case 6:if(!(a<s.length)){e.next=14;break}return e.delegateYield(i(),"t0",8);case 8:if("continue"!==e.t0){e.next=11;break}return e.abrupt("continue",11);case 11:a++,e.next=6;break;case 14:return Object.keys(this.mActiveLoaders).filter((function(e){return!t.includes(e)})).forEach((function(e){u.mActiveLoaders[e].dispose(),delete u.mActiveLoaders})),e.next=18,Promise.all(n);case 18:this.applyTextures();case 19:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"applyTextures",value:function(){if(this.mTextureCube){for(var e=0,t=Object.entries(this.mActiveTextures);e<t.length;e++){var n=o(t[e],2),r=n[0],i=n[1];this.mTextureCube.images[r]=i}this.mTextureCube.needsUpdate=!0}}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(s.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.updateTextures().then((function(){}),(function(){}))}},{key:"createRenderObject",value:function(){this.mTextureCube=new THREE.CubeTexture,this.applyTextures();var e=THREE.ShaderLib.cube;this.mCubeMaterial=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:e.uniforms,depthWrite:!1,side:THREE.BackSide}),this.mCubeMaterial.uniforms.tCube.value=this.mTextureCube;var t=new THREE.Mesh(new THREE.BoxGeometry(500,500,500),this.mCubeMaterial);this.mRenderObject=t}},{key:"dispose",value:function(){var e=this;null!==this.mCubeMaterial&&(this.mCubeMaterial.dispose(),this.mCubeMaterial=null),null!==this.mTextureCube&&(this.mTextureCube.dispose(),this.mTextureCube=null);var t=tc.getManager(Qu.TextureManager);Object.keys(this.mHandles).forEach((function(n){t.disposeResource(e.mHandles[n])})),this.mHandles={},Object.keys(this.mActiveLoaders).forEach((function(t){e.mActiveLoaders[t].dispose()})),this.mActiveLoaders={},this.mActiveTextures={},Ni((0,M.Z)(s.prototype),"dispose",this).call(this)}}]),s}(Ax);function tT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var nT=function(e){(0,g.Z)(o,e);var n,i,a=tT(o);function o(){var e;(0,u.Z)(this,o);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=a.call.apply(a,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mEquirectMaterial",null),(0,l.Z)((0,_.Z)(e),"mTextureId",void 0),(0,l.Z)((0,_.Z)(e),"mHandle",void 0),(0,l.Z)((0,_.Z)(e),"mActiveLoader",void 0),(0,l.Z)((0,_.Z)(e),"mActiveTexture",void 0),e}return(0,c.Z)(o,[{key:"loadResource",value:(i=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateProperties(),e.abrupt("return",this.updateTexture());case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mTextureId=e.getTextureId()}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(o.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.updateTexture().then((function(){}),(function(){}))}},{key:"updateHandle",value:function(){if(this.mHandle&&this.mHandle.id===this.mTextureId)return!1;var e=tc.getManager(Qu.TextureManager);return this.mHandle&&e.disposeResource(this.mHandle.handle),!!this.mTextureId&&(this.mHandle={id:this.mTextureId,handle:e.makeResource(this.mTextureId)},!0)}},{key:"updateTexture",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.updateHandle()){e.next=2;break}return e.abrupt("return");case 2:if(!this.mActiveLoader||!this.mActiveLoader.getHandle().validateHandle(this.mHandle.handle)){e.next=4;break}return e.abrupt("return");case 4:return this.mActiveLoader&&(this.mActiveLoader.dispose(),delete this.mActiveLoader),this.mActiveLoader=new NM(this.mHandle.handle,Qu.TextureManager),e.next=8,this.mActiveLoader.load();case 8:this.mActiveTexture=e.sent,this.applyTextures();case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"applyTextures",value:function(){this.mEquirectMaterial&&(this.mEquirectMaterial.uniforms.tEquirect.value=this.mActiveTexture)}},{key:"createRenderObject",value:function(){var e=THREE.ShaderLib.equirect;this.mEquirectMaterial=new THREE.ShaderMaterial({fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:e.uniforms,depthWrite:!1,side:THREE.BackSide}),this.mEquirectMaterial.uniforms.tEquirect.value=this.mActiveTexture;var t=new THREE.Mesh(new THREE.BoxGeometry(500,500,500),this.mEquirectMaterial);this.mRenderObject=t}},{key:"dispose",value:function(){null!==this.mEquirectMaterial&&(this.mEquirectMaterial.dispose(),this.mEquirectMaterial=null);var e=tc.getManager(Qu.TextureManager);this.mHandle&&e.disposeResource(this.mHandle.handle),this.mActiveLoader&&this.mActiveLoader.dispose(),Ni((0,M.Z)(o.prototype),"dispose",this).call(this)}}]),o}(Ax);function rT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var iT=function(e){(0,g.Z)(s,e);var n,i,a,o=rT(s);function s(){var e;(0,u.Z)(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mWaterNormal1",void 0),(0,l.Z)((0,_.Z)(e),"mWaterNormal2",void 0),(0,l.Z)((0,_.Z)(e),"mReceiveShadow",!1),e}return(0,c.Z)(s,[{key:"loadResource",value:(a=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateProperties(),e.prev=1,e.next=4,this.loadWaterTextures();case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),qe.qL.warn("Failed to load water textures:",e.t0);case 9:case"end":return e.stop()}}),e,this,[[1,6]])}))),function(){return a.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mReceiveShadow=e.receiveShadow}},{key:"loadWaterTextures",value:(i=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.loadTexture("".concat(Jr.E.assetsUrl,"system/textures/Water_1_M_Normal.jpg")),this.loadTexture("".concat(Jr.E.assetsUrl,"system/textures/Water_2_M_Normal.jpg"))]);case 2:t=e.sent,this.mWaterNormal1=t[0],this.mWaterNormal2=t[1];case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"loadTexture",value:(n=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){(new THREE.TextureLoader).load(t,(function(t){e(t)}),(function(e){}),(function(e){qe.qL.error("Failed to load water normal texture: ",e),n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(s.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.mRenderObject.receiveShadow=this.mReceiveShadow}},{key:"createRenderObject",value:function(){var e=new THREE.PlaneBufferGeometry(20,20),t=new THREE.Water(e,{color:"#ffffff",scale:1,flowDirection:new THREE.Vector2(1,1),textureWidth:1024,textureHeight:1024,normalMap0:this.mWaterNormal1,normalMap1:this.mWaterNormal2});t.receiveShadow=this.mReceiveShadow,qe.qL.print("water created: ",t),this.mRenderObject=t}},{key:"dispose",value:function(){this.mWaterNormal1&&(this.mWaterNormal1.dispose(),delete this.mWaterNormal1),this.mWaterNormal2&&(this.mWaterNormal2.dispose(),delete this.mWaterNormal2),Ni((0,M.Z)(s.prototype),"dispose",this).call(this)}},{key:"updateTranslation",value:function(){var e=Ni((0,M.Z)(s.prototype),"updateTranslation",this).call(this);return this.mRenderObject.matrix.multiply((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(-.5*Math.PI,0,0))),e}}]),s}(Ax);function aT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var oT=function(e){(0,g.Z)(n,e);var t=aT(n);function n(e,r,i){var a;return(0,u.Z)(this,n),a=t.call(this,"set-model-position"),(0,l.Z)((0,_.Z)(a),"mObject",void 0),(0,l.Z)((0,_.Z)(a),"mNewPosition",new Bi),(0,l.Z)((0,_.Z)(a),"mOldPosition",new Bi),a.mObject=e,r?a.mNewPosition.copy(r):a.mOldPosition.copy(a.mObject.transform.position),i?a.mOldPosition.copy(i):a.mOldPosition.copy(a.mObject.transform.position),a.setUpdatable(!0),a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getNewPosition",value:function(){return this.mNewPosition}},{key:"execute",value:function(){this.mObject.transform.position.copy(this.mNewPosition),this.mObject.updateMatrixLocal(),this.mObject.updateMatrixWorld(),this.mObject.markNeedsRenderUpdate(),P.eventBus().dispatch(new Di(Ei.ObjectChanged,{name:"position",object:this.mObject})),P.eventBus().dispatch(new Di(Ei.ObjectTransformed,{object:this.mObject}))}},{key:"undo",value:function(){this.mObject.transform.position.copy(this.mOldPosition),this.mObject.updateMatrixLocal(),this.mObject.updateMatrixWorld(),this.mObject.markNeedsRenderUpdate(),P.eventBus().dispatch(new Di(Ei.ObjectChanged,{name:"position",object:this.mObject})),P.eventBus().dispatch(new Di(Ei.ObjectTransformed,{object:this.mObject}))}},{key:"overridesCommand",value:function(e){return Ni((0,M.Z)(n.prototype),"overridesCommand",this).call(this,e)}},{key:"update",value:function(e){this.mNewPosition.copy(e.getNewPosition())}}]),n}(ed);function sT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(oT,"TypeRTTI",new k.r("SetPositionCommand",ed.TypeRTTI));var uT=function(e){(0,g.Z)(n,e);var t=sT(n);function n(e,r,i){var a;return(0,u.Z)(this,n),a=t.call(this,"set-model-rotation"),(0,l.Z)((0,_.Z)(a),"mObject",void 0),(0,l.Z)((0,_.Z)(a),"mNewRotation",new Li),(0,l.Z)((0,_.Z)(a),"mOldRotation",new Li),a.mObject=e,r?a.mNewRotation.copy(r):a.mNewRotation.copy(a.mObject.transform.rotation),i?a.mOldRotation.copy(i):a.mOldRotation.copy(a.mObject.transform.rotation),a.setUpdatable(!0),a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getNewRotation",value:function(){return this.mNewRotation}},{key:"execute",value:function(){this.mObject.transform.rotation.copy(this.mNewRotation),this.mObject.updateMatrixLocal(),this.mObject.updateMatrixWorld(),this.mObject.markNeedsRenderUpdate(),P.eventBus().dispatch(new Di(Ei.ObjectChanged,{name:"rotation",object:this.mObject})),P.eventBus().dispatch(new Di(Ei.ObjectTransformed,{object:this.mObject}))}},{key:"undo",value:function(){this.mObject.transform.rotation.copy(this.mOldRotation),this.mObject.updateMatrixLocal(),this.mObject.updateMatrixWorld(),this.mObject.markNeedsRenderUpdate(),P.eventBus().dispatch(new Di(Ei.ObjectChanged,{name:"rotation",object:this.mObject})),P.eventBus().dispatch(new Di(Ei.ObjectTransformed,{object:this.mObject}))}},{key:"overridesCommand",value:function(e){return Ni((0,M.Z)(n.prototype),"overridesCommand",this).call(this,e)}},{key:"update",value:function(e){this.mNewRotation.copy(e.getNewRotation())}}]),n}(ed);function cT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(uT,"TypeRTTI",new k.r("SetRotationCommand",ed.TypeRTTI));var lT=function(e){(0,g.Z)(n,e);var t=cT(n);function n(e,r,i){var a;return(0,u.Z)(this,n),a=t.call(this,"set-model-scale"),(0,l.Z)((0,_.Z)(a),"mObject",void 0),(0,l.Z)((0,_.Z)(a),"mNewScale",Bi.One()),(0,l.Z)((0,_.Z)(a),"mOldScale",Bi.One()),a.mObject=e,r?a.mNewScale.copy(r):a.mNewScale.copy(a.mObject.transform.scale),i?a.mOldScale.copy(i):a.mOldScale.copy(a.mObject.transform.scale),a.setUpdatable(!0),a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getNewScale",value:function(){return this.mNewScale}},{key:"execute",value:function(){this.mObject.transform.scale.copy(this.mNewScale),this.mObject.updateMatrixLocal(),this.mObject.updateMatrixWorld(),this.mObject.markNeedsRenderUpdate(),P.eventBus().dispatch(new Di(Ei.ObjectChanged,{name:"scale",object:this.mObject})),P.eventBus().dispatch(new Di(Ei.ObjectTransformed,{object:this.mObject}))}},{key:"undo",value:function(){this.mObject.transform.scale.copy(this.mOldScale),this.mObject.updateMatrixLocal(),this.mObject.updateMatrixWorld(),this.mObject.markNeedsRenderUpdate(),P.eventBus().dispatch(new Di(Ei.ObjectChanged,{name:"scale",object:this.mObject})),P.eventBus().dispatch(new Di(Ei.ObjectTransformed,{object:this.mObject}))}},{key:"overridesCommand",value:function(e){return Ni((0,M.Z)(n.prototype),"overridesCommand",this).call(this,e)}},{key:"update",value:function(e){this.mNewScale.copy(e.getNewScale())}}]),n}(ed);function hT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(lT,"TypeRTTI",new k.r("SetScaleCommand",ed.TypeRTTI));var fT=function(e){(0,g.Z)(n,e);var t=hT(n);function n(e,r,i){var a;return(0,u.Z)(this,n),a=t.call(this,"set-model-quaternion"),(0,l.Z)((0,_.Z)(a),"mObject",void 0),(0,l.Z)((0,_.Z)(a),"mNewRotation",new Pi),(0,l.Z)((0,_.Z)(a),"mOldRotation",new Pi),a.mObject=e,r?a.mNewRotation.copy(r):a.mNewRotation.copy(a.mObject.transform.quaternion),i?a.mOldRotation.copy(i):a.mOldRotation.copy(a.mObject.transform.quaternion),a.setUpdatable(!0),a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getNewRotation",value:function(){return this.mNewRotation}},{key:"execute",value:function(){this.mObject.transform.quaternion.copy(this.mNewRotation),this.mObject.updateMatrixLocal(),this.mObject.updateMatrixWorld(),this.mObject.markNeedsRenderUpdate(),P.eventBus().dispatch(new Di(Ei.ObjectChanged,{name:"quaternion",object:this.mObject})),P.eventBus().dispatch(new Di(Ei.ObjectTransformed,{object:this.mObject}))}},{key:"undo",value:function(){this.mObject.transform.quaternion.copy(this.mOldRotation),this.mObject.updateMatrixLocal(),this.mObject.updateMatrixWorld(),this.mObject.markNeedsRenderUpdate(),P.eventBus().dispatch(new Di(Ei.ObjectChanged,{name:"quaternion",object:this.mObject})),P.eventBus().dispatch(new Di(Ei.ObjectTransformed,{object:this.mObject}))}},{key:"overridesCommand",value:function(e){return Ni((0,M.Z)(n.prototype),"overridesCommand",this).call(this,e)}},{key:"update",value:function(e){this.mNewRotation.copy(e.getNewRotation())}}]),n}(ed);(0,l.Z)(fT,"TypeRTTI",new k.r("SetQuaternionCommand",ed.TypeRTTI));var pT=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,[{key:"transformObject",value:function(e){return e}},{key:"setPosition",value:function(e,t,n){P.commandManager().execute(new oT(e,t,n))}},{key:"setRotation",value:function(e,t,n){P.commandManager().execute(new uT(e,t,n))}},{key:"setQuaternion",value:function(e,t,n){P.commandManager().execute(new fT(e,t,n))}},{key:"setScale",value:function(e,t,n){P.commandManager().execute(new lT(e,t,n))}}]),e}();function mT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var dT=function(e){(0,g.Z)(n,e);var t=mT(n);function n(e,r,i){var a;return(0,u.Z)(this,n),a=t.call(this,"Set model value"),(0,l.Z)((0,_.Z)(a),"mObject",void 0),(0,l.Z)((0,_.Z)(a),"mAttribute",void 0),(0,l.Z)((0,_.Z)(a),"mPrevValue",void 0),(0,l.Z)((0,_.Z)(a),"mValue",void 0),a.mObject=e,a.mAttribute=r,a.mPrevValue=a.mObject.getValue(a.mAttribute),a.mValue=i,a.setUpdatable(!0),a}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getAttribute",value:function(){return this.mAttribute}},{key:"getValue",value:function(){return this.mValue}},{key:"execute",value:function(){this.mObject.setValue(this.mAttribute,this.mValue),P.eventBus().dispatch(new Di(Ei.ModelAttributeChanged,{attribute:this.mAttribute,model:this.mObject})),this.isTransformAttribute(this.mAttribute)&&P.eventBus().dispatch(new Di(Ei.ObjectTransformed,{object:this.mObject}))}},{key:"undo",value:function(){this.mObject.setValue(this.mAttribute,this.mPrevValue),P.eventBus().dispatch(new Di(Ei.ModelAttributeChanged,{attribute:this.mAttribute,model:this.mObject})),this.isTransformAttribute(this.mAttribute)&&P.eventBus().dispatch(new Di(Ei.ObjectTransformed,{object:this.mObject}))}},{key:"overridesCommand",value:function(e){return Ni((0,M.Z)(n.prototype),"overridesCommand",this).call(this,e)&&this.mAttribute===e.getAttribute()}},{key:"update",value:function(e){this.mValue=e.getValue()}},{key:"isTransformAttribute",value:function(e){return["position","position_x","position_y","position_z","rotation","rotation_x","rotation_y","rotation_z","quaternion","quaternion_x","quaternion_y","quaternion_z","quaternion_w","scale","scale_x","scale_y","scale_z","transform"].includes(e)}}]),n}(ed);function vT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}(0,l.Z)(dT,"TypeRTTI",new k.r("SetModelValueCommand",ed.TypeRTTI));var yT=function(e){(0,g.Z)(n,e);var t=vT(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mAttribute",void 0),r.mAttribute=e,r}return(0,c.Z)(n,[{key:"transformObject",value:function(e){return e}},{key:"setPosition",value:function(e,t,n){P.commandManager().execute(new dT(e,this.mAttribute,t)),P.eventBus().dispatch(new Di(Ei.ObjectChanged,{name:"position",object:e})),window.setTimeout((function(){P.eventBus().dispatch(new Di(Ei.RequestFrame))}),300)}},{key:"setRotation",value:function(e,t,n){}},{key:"setScale",value:function(e,t,n){}}]),n}(pT);function gT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var bT=function(e){(0,g.Z)(a,e);var n,i=gT(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mReceiveShadow",!1),(0,l.Z)((0,_.Z)(e),"mCastShadow",!1),(0,l.Z)((0,_.Z)(e),"mPointA",new THREE.Vector3),(0,l.Z)((0,_.Z)(e),"mPointB",new THREE.Vector3),(0,l.Z)((0,_.Z)(e),"mSpriteOffset",new THREE.Vector3),(0,l.Z)((0,_.Z)(e),"mMarkerA",null),(0,l.Z)((0,_.Z)(e),"mMarkerB",null),(0,l.Z)((0,_.Z)(e),"mMarkerMaterial",null),(0,l.Z)((0,_.Z)(e),"mLineMaterial",null),(0,l.Z)((0,_.Z)(e),"mLineMesh",null),(0,l.Z)((0,_.Z)(e),"mLineGeometry",null),(0,l.Z)((0,_.Z)(e),"mLineColor",new THREE.Color),(0,l.Z)((0,_.Z)(e),"mMeshLine",null),(0,l.Z)((0,_.Z)(e),"mResolution",new THREE.Vector2),(0,l.Z)((0,_.Z)(e),"mLabel",{title:"",color:new THREE.Color(0,0,0),fontSize:16,spriteScale:1}),(0,l.Z)((0,_.Z)(e),"mSpriteNode",null),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mCastShadow=e.castShadow,this.mReceiveShadow=e.receiveShadow;var t=e.pointA.clone(),n=e.pointB.clone();this.mRenderer.isRightHandedSystemActive()||(t.z*=-1,n.z*=-1),this.mPointA.set(t.x,t.y,t.z),this.mPointB.set(n.x,n.y,n.z),this.mSpriteOffset.set(e.spriteOffset.x,e.spriteOffset.y,e.spriteOffset.z),this.mLineColor.setRGB(e.lineColor.r,e.lineColor.g,e.lineColor.b),this.mLabel.title=e.labelText,this.mLabel.color.setRGB(e.labelColor.r,e.labelColor.g,e.labelColor.b),this.mLabel.fontSize=e.labelFontSize,this.mLabel.spriteScale=e.labelSpriteScale}},{key:"updateLine",value:function(){if(this.mLineMesh&&this.mMeshLine){qe.qL.print("update point a: ",this.mPointA),qe.qL.print("update point b: ",this.mPointB),this.mLineGeometry.vertices[0].copy(this.mPointA),this.mLineGeometry.vertices[1].copy(this.mPointB),this.mMeshLine.setGeometry(this.mLineGeometry,(function(){return 1}));var e=this.mMeshLine.geometry;this.mLineMesh.geometry.dispose(),this.mLineMesh.geometry=e,this.mLineMesh.geometry.computeBoundingSphere(),this.mLineMesh.updateMatrix(),this.mMarkerA.position.copy(this.mPointA),this.mMarkerB.position.copy(this.mPointB),this.mLineMaterial&&(this.mLineMaterial.color=this.mLineColor,this.mLineMaterial.needsUpdate=!0),this.mMarkerMaterial&&(this.mMarkerMaterial.color=this.mLineColor,this.mMarkerMaterial.needsUpdate=!0),this.mSpriteNode&&this.mSpriteNode.position.copy(this.getSpritePosition())}}},{key:"updateText",value:function(){if(this.mLineMesh)if("string"==typeof this.mLabel.title&&this.mLabel.title.length>0){if(this.mSpriteNode){var e=this.mSpriteNode.material,t=e.map;t.text=this.mLabel.title,t.fontSize=this.mLabel.fontSize,e.color=this.mLabel.color,t&&t.redraw();var n=1;e.map&&e.map.image&&f.Ft.isNumeric(e.map.image.height)&&(n=e.map.image.width/e.map.image.height),this.mSpriteNode.scale.setX(n).setY(1).multiplyScalar(.05*this.mLabel.spriteScale),this.mSpriteNode.updateMatrixWorld(!1)}else this.mSpriteNode=this.makeSpriteNode(),this.mLineMesh.parent&&this.mLineMesh.parent.add(this.mSpriteNode);this.mSpriteNode.position.copy(this.getSpritePosition())}else if(this.mSpriteNode){var r=this.mSpriteNode.material;r&&r.map&&r.map.dispose(),this.mSpriteNode.material.dispose(),this.mSpriteNode.parent.remove(this.mSpriteNode),this.mSpriteNode=null}}},{key:"update",value:function(e){Ni((0,M.Z)(a.prototype),"update",this).call(this,e);var t=this.mRenderer.getRenderer(),n=this.mRenderer.getActiveCamera();this.updateMaterial(t,n)}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.updateLine(),this.updateText()}},{key:"updateMaterial",value:function(e,t){var n=new THREE.Vector2;if(e.getSize(n),n.distanceTo(this.mResolution)>.001){this.mResolution.copy(n),this.mLineMaterial.uniforms.resolution.value.copy(this.mResolution);var r=t;this.mLineMaterial.uniforms.near.value=r.near,this.mLineMaterial.uniforms.far.value=r.far,this.mLineMaterial.needsUpdate=!0}}},{key:"getSpritePosition",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.mPointA.clone().add(this.mPointB.clone().sub(this.mPointA).normalize().multiplyScalar(.5*this.mPointB.distanceTo(this.mPointA))).add(e?this.mSpriteOffset:new THREE.Vector3)}},{key:"makeSpriteNode",value:function(){var e=new THREE.TextTexture({align:"center",fillStyle:"#ffffff",fontFamily:"Arial, Helvetica, sans-serif",fontSize:this.mLabel.fontSize,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",lineGap:.15,padding:.25,strokeStyle:"#ffffff",strokeWidth:0,text:this.mLabel.title}),t=new THREE.SpriteMaterial({map:e,color:this.mLabel.color,transparent:!0,depthTest:!0}),n=new THREE.Sprite(t);e.redraw();var r=1;return e.image&&f.Ft.isNumeric(e.image.height)&&(r=e.image.width/e.image.height),n.scale.setX(r).multiplyScalar(.05*this.mLabel.spriteScale),n.userData||(n.userData={}),n.userData.scene_entity_id=this.mSceneEntity.id,n.userData.transforms=new yT("inv_sprite_offset"),n}},{key:"createRenderObject",value:function(){var e=new THREE.Group;e.userData={},e.userData.scene_entity_id=this.mSceneEntity.id,this.mMarkerMaterial=new THREE.MeshBasicMaterial({color:this.mLineColor,depthTest:!0,depthWrite:!0}),this.mMarkerA=new THREE.Mesh(new THREE.SphereGeometry(.006,32,32),this.mMarkerMaterial),this.mMarkerA.name="$__xpv_line_marker_a",this.mMarkerA.userData={},this.mMarkerA.position.copy(this.mPointA),this.mMarkerB=this.mMarkerA.clone(),this.mMarkerB.name="$__xpv_line_marker_b",this.mMarkerB.userData={},this.mMarkerB.position.copy(this.mPointB),this.mMarkerA.userData.scene_entity_id=this.mSceneEntity.id,this.mMarkerB.userData.scene_entity_id=this.mSceneEntity.id,this.mMarkerA.userData.transforms=new yT("point_a"),this.mMarkerB.userData.transforms=new yT("point_b"),e.add(this.mMarkerA),e.add(this.mMarkerB),this.mLineGeometry=new THREE.Geometry,this.mLineGeometry.vertices.push(this.mPointA),this.mLineGeometry.vertices.push(this.mPointB),this.mMeshLine=new MeshLine,this.mMeshLine.setGeometry(this.mLineGeometry,(function(){return 1})),this.mLineMaterial=new MeshLineMaterial({color:this.mLineColor,sizeAttenuation:1,lineWidth:.005,transparent:!0,depthWrite:!0,side:THREE.DoubleSide}),this.mLineMesh=new THREE.Mesh(this.mMeshLine.geometry,this.mLineMaterial),this.mLineMesh.name="$__xpv_line",this.mLineMesh.userData={},this.mLineMesh.userData.scene_entity_id=this.mSceneEntity.id,e.add(this.mLineMesh),"string"==typeof this.mLabel.title&&this.mLabel.title.length>0&&(this.mSpriteNode=this.makeSpriteNode(),this.mSpriteNode.position.copy(this.getSpritePosition()),e.add(this.mSpriteNode)),e.castShadow=this.mCastShadow,e.receiveShadow=this.mReceiveShadow,this.mRenderObject=e}},{key:"dispose",value:function(){this.mMarkerA.geometry.dispose(),this.mMarkerB.geometry.dispose(),this.mLineGeometry.dispose(),this.mLineMesh.geometry.dispose(),this.mLineMaterial.dispose(),this.mMarkerMaterial.dispose(),null!==this.mSpriteNode&&this.mSpriteNode.material.dispose(),delete this.mMarkerA.userData.transforms,delete this.mMarkerA.userData.transforms,this.mMarkerA=this.mMarkerB=this.mLineMesh=this.mMeshLine=this.mLineGeometry=this.mSpriteNode=null,Ni((0,M.Z)(a.prototype),"dispose",this).call(this)}},{key:"updateBoundingBox",value:function(){this.mMarkerA.geometry.boundingBox||this.mMarkerA.geometry.computeBoundingBox(),this.mMarkerB.geometry.boundingBox||this.mMarkerB.geometry.computeBoundingBox();var e=new THREE.Box3;e.union(this.mMarkerA.geometry.boundingBox),e.union(this.mMarkerB.geometry.boundingBox);var t=(new Bi).fromArray(e.min.toArray()),n=(new Bi).fromArray(e.max.toArray());this.mBoundingBox.copy(new ji(t,n)),Ni((0,M.Z)(a.prototype),"updateBoundingBox",this).call(this)}}]),a}(Ax);function MT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var kT=function(e){(0,g.Z)(a,e);var n,i=MT(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mCastShadow",!1),(0,l.Z)((0,_.Z)(e),"mReceiveShadow",!1),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mCastShadow=e.castShadow,this.mReceiveShadow=e.receiveShadow}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.mRenderObject.receiveShadow=this.mReceiveShadow,this.mRenderObject.castShadow=this.mCastShadow}},{key:"createRenderObject",value:function(){var e=this,t=new THREE.BoxBufferGeometry(1,1,1),n=new THREE.MeshPhongMaterial;n.color=new THREE.Color(15987699);var r=new THREE.Mesh(t,n);r.name="Box",r.castShadow=this.mCastShadow,r.receiveShadow=this.mReceiveShadow,r.onBeforeRender=function(t,n,i,a,o){e.getRenderer().onBeforeMeshRender(r,e.mSceneEntity,t,n,i,a,o)},r.onAfterRender=function(t,n,i,a,o){e.getRenderer().onAfterMeshRender(r,e.mSceneEntity,t,n,i,a,o)},this.mRenderObject=r}},{key:"destroyRenderObject",value:function(){if(this.mRenderObject){delete this.mRenderObject.onBeforeRender,delete this.mRenderObject.onAfterRender;var e=this.mRenderObject;e.geometry.dispose(),e.material.dispose()}Ni((0,M.Z)(a.prototype),"destroyRenderObject",this).call(this)}},{key:"updateBoundingBox",value:function(){var e=this.mRenderObject;e.geometry.boundingBox||e.geometry.computeBoundingBox();var t=(new Bi).fromArray(e.geometry.boundingBox.min.toArray()),n=(new Bi).fromArray(e.geometry.boundingBox.max.toArray());this.mBoundingBox.copy(new ji(t,n)),Ni((0,M.Z)(a.prototype),"updateBoundingBox",this).call(this)}}]),a}(Ax);function _T(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var xT=function(e){(0,g.Z)(a,e);var n,i=_T(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mCastShadow",!1),(0,l.Z)((0,_.Z)(e),"mReceiveShadow",!1),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mCastShadow=e.castShadow,this.mReceiveShadow=e.receiveShadow}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.mRenderObject.receiveShadow=this.mReceiveShadow,this.mRenderObject.castShadow=this.mCastShadow}},{key:"createRenderObject",value:function(){var e=this,t=new THREE.PlaneBufferGeometry(2,2),n=new THREE.MeshPhongMaterial;n.color=new THREE.Color(15987699);var r=new THREE.Mesh(t,n);r.name="Plane",r.castShadow=this.mCastShadow,r.receiveShadow=this.mReceiveShadow,r.onBeforeRender=function(t,n,i,a,o){e.getRenderer().onBeforeMeshRender(r,e.mSceneEntity,t,n,i,a,o)},r.onAfterRender=function(t,n,i,a,o){e.getRenderer().onAfterMeshRender(r,e.mSceneEntity,t,n,i,a,o)},this.mRenderObject=r}},{key:"destroyRenderObject",value:function(){if(this.mRenderObject){delete this.mRenderObject.onBeforeRender,delete this.mRenderObject.onAfterRender;var e=this.mRenderObject;e.geometry.dispose(),e.material.dispose()}Ni((0,M.Z)(a.prototype),"destroyRenderObject",this).call(this)}},{key:"updateBoundingBox",value:function(){var e=this.mRenderObject;e.geometry.boundingBox||e.geometry.computeBoundingBox();var t=(new Bi).fromArray(e.geometry.boundingBox.min.toArray()),n=(new Bi).fromArray(e.geometry.boundingBox.max.toArray());this.mBoundingBox.copy(new ji(t,n)),Ni((0,M.Z)(a.prototype),"updateBoundingBox",this).call(this)}}]),a}(Ax);function TT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var wT=function(e){(0,g.Z)(a,e);var n,i=TT(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mCastShadow",!1),(0,l.Z)((0,_.Z)(e),"mReceiveShadow",!1),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mCastShadow=e.castShadow,this.mReceiveShadow=e.receiveShadow}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.mRenderObject.receiveShadow=this.mReceiveShadow,this.mRenderObject.castShadow=this.mCastShadow}},{key:"createRenderObject",value:function(){var e=this,t=new THREE.SphereBufferGeometry(.5,64,64),n=new THREE.MeshPhongMaterial;n.color=new THREE.Color(15987699);var r=new THREE.Mesh(t,n);r.name="Sphere",r.castShadow=this.mCastShadow,r.receiveShadow=this.mReceiveShadow,r.onBeforeRender=function(t,n,i,a,o){e.getRenderer().onBeforeMeshRender(r,e.mSceneEntity,t,n,i,a,o)},r.onAfterRender=function(t,n,i,a,o){e.getRenderer().onAfterMeshRender(r,e.mSceneEntity,t,n,i,a,o)},this.mRenderObject=r}},{key:"destroyRenderObject",value:function(){if(this.mRenderObject){delete this.mRenderObject.onBeforeRender,delete this.mRenderObject.onAfterRender;var e=this.mRenderObject;e.geometry.dispose(),e.material.dispose()}Ni((0,M.Z)(a.prototype),"destroyRenderObject",this).call(this)}},{key:"updateBoundingBox",value:function(){var e=this.mRenderObject;e.geometry.boundingBox||e.geometry.computeBoundingBox();var t=(new Bi).fromArray(e.geometry.boundingBox.min.toArray()),n=(new Bi).fromArray(e.geometry.boundingBox.max.toArray());this.mBoundingBox.copy(new ji(t,n)),Ni((0,M.Z)(a.prototype),"updateBoundingBox",this).call(this)}}]),a}(Ax);function RT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var ZT=function(e){(0,g.Z)(a,e);var n,i=RT(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mColor",so.White()),(0,l.Z)((0,_.Z)(e),"mIntensity",1),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mColor.copy(e.color),this.mIntensity=e.intensity}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties();var e=this.mRenderObject;e.intensity=this.mIntensity,e.color.setRGB(this.mColor.r,this.mColor.g,this.mColor.b)}},{key:"createRenderObject",value:function(){var e=new THREE.AmbientLight(new THREE.Color(this.mColor.r,this.mColor.g,this.mColor.b),this.mIntensity);e.name="Ambient Light",this.mRenderObject=e}}]),a}(Ax);function ST(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var CT=function(e){(0,g.Z)(a,e);var n,i=ST(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mCastShadow",!1),(0,l.Z)((0,_.Z)(e),"mColor",so.White()),(0,l.Z)((0,_.Z)(e),"mTarget",Bi.Zero()),(0,l.Z)((0,_.Z)(e),"mIntensity",1),(0,l.Z)((0,_.Z)(e),"mShadowBias",0),(0,l.Z)((0,_.Z)(e),"mShadowCameraNear",.1),(0,l.Z)((0,_.Z)(e),"mShadowCameraFar",500),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mCastShadow=e.castShadow,this.mColor.copy(e.color),this.mTarget.copy(e.target),this.mIntensity=e.intensity,this.mShadowBias=e.shadowBias,this.mShadowCameraNear=e.shadowCameraNear,this.mShadowCameraFar=e.shadowCameraFar}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties();var e=this.mRenderObject;e.castShadow=this.mCastShadow,e.target.position.set(this.mTarget.x,this.mTarget.y,this.mTarget.z),e.target.updateMatrixWorld(!1),e.color.setRGB(this.mColor.r,this.mColor.g,this.mColor.b),e.intensity=this.mIntensity,this.mCastShadow&&(e.shadow.bias=this.mShadowBias,e.shadow.camera.near=this.mShadowCameraNear,e.shadow.camera.far=this.mShadowCameraFar)}},{key:"createRenderObject",value:function(){var e=new THREE.Object3D;e.position.set(this.mTarget.x,this.mTarget.y,this.mTarget.z),e.updateMatrixWorld(!0);var t=new THREE.DirectionalLight(new THREE.Color(this.mColor.r,this.mColor.g,this.mColor.b),this.mIntensity);t.name="Directional Light",t.target=e,t.castShadow=this.mCastShadow,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,t.shadow.bias=this.mShadowBias,t.shadow.camera.near=this.mShadowCameraNear,t.shadow.camera.far=this.mShadowCameraFar,this.mRenderObject=t}}]),a}(Ax);function IT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var ET=function(e){(0,g.Z)(a,e);var n,i=IT(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mColor",so.White()),(0,l.Z)((0,_.Z)(e),"mGroundColor",so.White()),(0,l.Z)((0,_.Z)(e),"mIntensity",1),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mColor.copy(e.color),this.mGroundColor.copy(e.groundColor),this.mIntensity=e.intensity}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties();var e=this.mRenderObject;e.intensity=this.mIntensity,e.color.setRGB(this.mColor.r,this.mColor.g,this.mColor.b),e.groundColor.setRGB(this.mGroundColor.r,this.mGroundColor.g,this.mGroundColor.b)}},{key:"createRenderObject",value:function(){var e=new THREE.HemisphereLight(new THREE.Color(this.mColor.r,this.mColor.g,this.mColor.b),new THREE.Color(this.mGroundColor.r,this.mGroundColor.g,this.mGroundColor.b),this.mIntensity);e.name="Hemisphere Light",this.mRenderObject=e}}]),a}(Ax);function AT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var OT=function(e){(0,g.Z)(a,e);var n,i=AT(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mCastShadow",!1),(0,l.Z)((0,_.Z)(e),"mColor",new so),(0,l.Z)((0,_.Z)(e),"mDistance",0),(0,l.Z)((0,_.Z)(e),"mDecay",1),(0,l.Z)((0,_.Z)(e),"mIntensity",1),(0,l.Z)((0,_.Z)(e),"mShadowBias",0),(0,l.Z)((0,_.Z)(e),"mShadowCameraNear",.1),(0,l.Z)((0,_.Z)(e),"mShadowCameraFar",500),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mCastShadow=e.castShadow,this.mColor.copy(e.color),this.mDistance=e.distance,this.mDecay=e.decay,this.mIntensity=e.intensity,this.mShadowBias=e.shadowBias,this.mShadowCameraNear=e.shadowCameraNear,this.mShadowCameraFar=e.shadowCameraFar}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties();var e=this.mRenderObject;e.castShadow=this.mCastShadow,e.color.setRGB(this.mColor.r,this.mColor.g,this.mColor.b),e.intensity=this.mIntensity,e.distance=this.mDistance,e.decay=this.mDecay,this.mCastShadow&&(e.shadow.bias=this.mShadowBias,e.shadow.camera.near=this.mShadowCameraNear,e.shadow.camera.far=this.mShadowCameraFar)}},{key:"createRenderObject",value:function(){var e=new THREE.PointLight(new THREE.Color(this.mColor.r,this.mColor.g,this.mColor.b),this.mIntensity,this.mDistance,this.mDecay);e.name="Point Light",e.castShadow=this.mCastShadow,e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,e.shadow.bias=this.mShadowBias,e.shadow.camera.near=this.mShadowCameraNear,e.shadow.camera.far=this.mShadowCameraFar,this.mRenderObject=e}}]),a}(Ax);function DT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var PT=function(e){(0,g.Z)(a,e);var n,i=DT(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mCastShadow",!1),(0,l.Z)((0,_.Z)(e),"mColor",so.White()),(0,l.Z)((0,_.Z)(e),"mTarget",Bi.Zero()),(0,l.Z)((0,_.Z)(e),"mDistance",0),(0,l.Z)((0,_.Z)(e),"mAngle",.1*Math.PI),(0,l.Z)((0,_.Z)(e),"mPenumbra",0),(0,l.Z)((0,_.Z)(e),"mDecay",1),(0,l.Z)((0,_.Z)(e),"mIntensity",1),(0,l.Z)((0,_.Z)(e),"mShadowBias",0),(0,l.Z)((0,_.Z)(e),"mShadowCameraNear",.1),(0,l.Z)((0,_.Z)(e),"mShadowCameraFar",500),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mCastShadow=e.castShadow,this.mColor.copy(e.color),this.mTarget.copy(e.target),this.mDistance=e.distance,this.mDecay=e.decay,this.mAngle=e.angle,this.mPenumbra=e.penumbra,this.mIntensity=e.intensity,this.mShadowBias=e.shadowBias,this.mShadowCameraNear=e.shadowCameraNear,this.mShadowCameraFar=e.shadowCameraFar}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties();var e=this.mRenderObject;e.castShadow=this.mCastShadow,e.target.position.set(this.mTarget.x,this.mTarget.y,this.mTarget.z),e.target.updateMatrixWorld(!1),e.color.setRGB(this.mColor.r,this.mColor.g,this.mColor.b),e.intensity=this.mIntensity,e.distance=this.mDistance,e.angle=this.mAngle,e.penumbra=this.mPenumbra,e.decay=this.mDecay,this.mCastShadow&&(e.shadow.bias=this.mShadowBias,e.shadow.camera.near=this.mShadowCameraNear,e.shadow.camera.far=this.mShadowCameraFar)}},{key:"createRenderObject",value:function(){var e=new THREE.Object3D;e.position.set(this.mTarget.x,this.mTarget.y,this.mTarget.z),e.updateMatrixWorld(!0);var t=new THREE.SpotLight(new THREE.Color(this.mColor.r,this.mColor.g,this.mColor.b),this.mIntensity,this.mDistance,this.mAngle,this.mPenumbra,this.mDecay);t.name="Spot Light",t.target=e,t.castShadow=this.mCastShadow,t.shadow.mapSize.width=1024,t.shadow.mapSize.height=1024,t.shadow.bias=this.mShadowBias,t.shadow.camera.near=this.mShadowCameraNear,t.shadow.camera.far=this.mShadowCameraFar,this.mRenderObject=t}}]),a}(Ax);function BT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var FT=function(e){(0,g.Z)(a,e);var n,i=BT(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mColor",so.White()),(0,l.Z)((0,_.Z)(e),"mWidth",10),(0,l.Z)((0,_.Z)(e),"mHeight",10),(0,l.Z)((0,_.Z)(e),"mIntensity",1),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mColor.copy(e.color),this.mWidth=e.width,this.mHeight=e.height,this.mIntensity=e.intensity}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties();var e=this.mRenderObject;e.color.setRGB(this.mColor.r,this.mColor.g,this.mColor.b),e.intensity=this.mIntensity,e.width=this.mWidth,e.height=this.mHeight}},{key:"createRenderObject",value:function(){var e=new THREE.RectAreaLight(new THREE.Color(this.mColor.r,this.mColor.g,this.mColor.b),this.mIntensity,this.mWidth,this.mHeight);e.name="Rect Area Light",this.mRenderObject=e}}]),a}(Ax),LT=(0,c.Z)((function e(t,n){(0,u.Z)(this,e),(0,l.Z)(this,"mCamera",void 0),(0,l.Z)(this,"mRenderer",void 0),this.mCamera=t,this.mRenderer=n}));function NT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var jT=function(e){(0,g.Z)(n,e);var t=NT(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"mControls",void 0),(0,l.Z)((0,_.Z)(i),"mEnabled",!0),(0,l.Z)((0,_.Z)(i),"mTarget",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mMovementSpeed",void 0),(0,l.Z)((0,_.Z)(i),"mConstrainVertical",void 0),(0,l.Z)((0,_.Z)(i),"mKeysEnabled",void 0),(0,l.Z)((0,_.Z)(i),"mLookSpeed",void 0),(0,l.Z)((0,_.Z)(i),"mPreviousPosition",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mPreviousQuaternion",Pi.identity()),i}return(0,c.Z)(n,[{key:"loadCameraControls",value:function(){var e=this.mCamera.getSceneEntity(),t=e.getComponent("fps-camera-controls");this.mEnabled=t.enabled,this.mTarget.copy(e.target),this.mMovementSpeed=t.movementSpeed,this.mConstrainVertical=t.constrainVertical,this.mKeysEnabled=t.keyboardEnabled,this.mLookSpeed=t.lookSpeed}},{key:"createCameraControls",value:function(){var e=this.mCamera.getCamera();this.mControls||(this.mControls=new THREE.ExpiviFirstPersonControls(e,this.mRenderer.getCanvas())),this.mControls.enabled=this.mEnabled,this.mControls.target||(this.mControls.target=new THREE.Vector3),this.mControls.target.set(this.mTarget.x,this.mTarget.y,this.mTarget.z),this.mControls.movementSpeed=this.mMovementSpeed,this.mControls.lookVertical=!this.mConstrainVertical,this.mControls.lookSpeed=this.mLookSpeed,this.mControls.enableKeys=this.mKeysEnabled,this.mPreviousPosition.set(e.position.x,e.position.y,e.position.z),this.mPreviousQuaternion.set(e.quaternion.x,e.quaternion.y,e.quaternion.z,e.quaternion.w)}},{key:"destroyCameraControls",value:function(){this.mControls.dispose(),this.mControls=void 0}},{key:"update",value:function(e){if(this.mControls){this.mControls.update(e);var t=this.mCamera.getSceneEntity(),n=this.mCamera.getCamera(),r=!1,i=!1;this.didPan()&&(t.transform.position.set(n.position.x,n.position.y,n.position.z),this.mPreviousPosition.copy(t.transform.position),r=!0),this.didRotate()&&(t.transform.quaternion.set(n.quaternion.x,n.quaternion.y,n.quaternion.z,n.quaternion.w),this.mPreviousQuaternion.copy(t.transform.quaternion),r||(i=!0)),(r||i)&&this.onControlsChange()}}},{key:"onUpdateDirty",value:function(){var e=this.mCamera.getSceneEntity();this.loadCameraControls(),this.createCameraControls();var t=e.getComponent("fps-camera-controls");t.getValue("fps_controls.resize_update")&&this.mControls.handleResize(),t.getValue("fps_controls.reset_state")&&this.mControls.reset(),t.setNeedsRenderUpdate(!1)}},{key:"onAttached",value:function(){}},{key:"onDetached",value:function(){}},{key:"onControlsChange",value:function(){P.eventBus().dispatch(new ta)}},{key:"getComponentName",value:function(){return"fps-camera-controls"}},{key:"didPan",value:function(){var e=this.mCamera.getCamera(),t=this.mPreviousPosition.x-e.position.x,n=this.mPreviousPosition.y-e.position.y,r=this.mPreviousPosition.z-e.position.z;return t*t+n*n+r*r>pl.EPS}},{key:"didRotate",value:function(){var e=this.mCamera.getCamera(),t=this.mPreviousQuaternion.x-e.quaternion.x,n=this.mPreviousQuaternion.y-e.quaternion.y,r=this.mPreviousQuaternion.z-e.quaternion.z,i=this.mPreviousQuaternion.w-e.quaternion.w;return t*t+n*n+r*r+i*i>pl.EPS}}]),n}(LT);function zT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var UT=function(e){(0,g.Z)(n,e);var t=zT(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"mControls",void 0),(0,l.Z)((0,_.Z)(i),"mEnabled",!0),(0,l.Z)((0,_.Z)(i),"mTarget",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mLockUpHemisphere",!1),(0,l.Z)((0,_.Z)(i),"mMinAzimuthAngle",-1/0),(0,l.Z)((0,_.Z)(i),"mMaxAzimuthAngle",1/0),(0,l.Z)((0,_.Z)(i),"mMinPolarAngle",0),(0,l.Z)((0,_.Z)(i),"mMaxPolarAngle",Math.PI),(0,l.Z)((0,_.Z)(i),"mRotateEnabled",!0),(0,l.Z)((0,_.Z)(i),"mRotationSpeed",1),(0,l.Z)((0,_.Z)(i),"mPanEnabled",!0),(0,l.Z)((0,_.Z)(i),"mPanSpeed",1),(0,l.Z)((0,_.Z)(i),"mZoomEnabled",!0),(0,l.Z)((0,_.Z)(i),"mZoomSpeed",1),(0,l.Z)((0,_.Z)(i),"mMinZoom",0),(0,l.Z)((0,_.Z)(i),"mMaxZoom",1/0),(0,l.Z)((0,_.Z)(i),"mDampingEnabled",!0),(0,l.Z)((0,_.Z)(i),"mDampFactor",.1),(0,l.Z)((0,_.Z)(i),"mAutoRotate",!1),(0,l.Z)((0,_.Z)(i),"mAutoRotateSpeed",2),(0,l.Z)((0,_.Z)(i),"mKeysDisabled",!1),(0,l.Z)((0,_.Z)(i),"mPreviousPosition",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mPreviousTarget",Bi.Zero()),(0,l.Z)((0,_.Z)(i),"mPreviousRadius",0),i}return(0,c.Z)(n,[{key:"loadCameraControls",value:function(){var e=this.mCamera.getSceneEntity(),t=e.getComponent("orbit-camera-controls");this.mEnabled=t.enabled,this.mTarget.copy(e.target),this.mPanEnabled=t.panEnabled,this.mPanSpeed=t.panSpeed,this.mRotateEnabled=t.rotateEnabled,this.mRotationSpeed=t.rotateSpeed,this.mZoomEnabled=t.zoomEnabled,this.mZoomSpeed=t.zoomSpeed,this.mMinZoom=t.zoomMin,this.mMaxZoom=t.zoomMax,this.mLockUpHemisphere=t.isUpHemisphereLocked,this.mMinAzimuthAngle=t.azimuthAngleMin,this.mMaxAzimuthAngle=t.azimuthAngleMax,this.mMinPolarAngle=t.polarAngleMin,this.mMaxPolarAngle=t.polarAngleMax,this.mDampingEnabled=t.dampingEnabled,this.mDampFactor=t.dampingFactor,this.mAutoRotate=t.autoRotateEnabled,this.mAutoRotateSpeed=t.autoRotateSpeed,this.mKeysDisabled=t.keyboardEnabled}},{key:"createCameraControls",value:function(){var e=this.mCamera.getCamera();this.mControls||(this.mControls=new THREE.ExpiviOrbitControls(e,this.mRenderer.getCanvas())),this.mControls.enabled=this.mEnabled,this.mControls.target||(this.mControls.target=new THREE.Vector3),this.mControls.target.set(this.mTarget.x,this.mTarget.y,this.mTarget.z),this.mControls.enableZoom=this.mZoomEnabled,this.mControls.zoomSpeed=this.mZoomSpeed,this.mCamera.isPerspective()?(this.mControls.minDistance=this.mMinZoom,this.mControls.maxDistance=this.mMaxZoom):(this.mControls.minZoom=this.mMinZoom,this.mControls.maxZoom=this.mMaxZoom),this.mControls.enablePan=this.mPanEnabled,this.mControls.panSpeed=this.mPanSpeed,this.mControls.enableRotate=this.mRotateEnabled,this.mControls.rotateSpeed=this.mRotationSpeed,this.mControls.enableDamping=this.mDampingEnabled,this.mControls.dampingFactor=this.mDampFactor,this.mControls.screenSpacePanning=!0,this.mControls.minAzimuthAngle=void 0!==this.mMinAzimuthAngle&&null!==this.mMinAzimuthAngle?this.mMinAzimuthAngle:-1/0,this.mControls.maxAzimuthAngle=void 0!==this.mMaxAzimuthAngle&&null!==this.mMaxAzimuthAngle?this.mMaxAzimuthAngle:1/0,this.mControls.minPolarAngle=void 0!==this.mMinPolarAngle&&null!==this.mMinPolarAngle?this.mMinPolarAngle:0,this.mLockUpHemisphere?this.mControls.maxPolarAngle=Math.PI/2:this.mControls.maxPolarAngle=void 0!==this.mMaxPolarAngle&&null!==this.mMaxPolarAngle?this.mMaxPolarAngle:Math.PI,this.mControls.autoRotate=this.mAutoRotate,this.mControls.autoRotateSpeed=this.mAutoRotateSpeed,this.mControls.enableKeys=!this.mKeysDisabled,this.mControls.blockDefaultTouch=!0!==P.stateRegistery().get(Ci.UNBLOCK_DEFAULT_TOUCH),this.mPreviousPosition.set(e.position.x,e.position.y,e.position.z),this.mPreviousTarget.set(this.mControls.target.x,this.mControls.target.y,this.mControls.target.z),this.mPreviousRadius=e.position.distanceTo(this.mControls.target)}},{key:"update",value:function(e){if(this.mControls&&(this.mControls.update(),this.mEnabled)){var t=this.mCamera.getSceneEntity(),n=this.mCamera.getCamera(),r=!1,i=!1,a=!1,o=this.mCamera.getCamera().position.distanceTo(this.mControls.target);Math.abs(this.mPreviousRadius-o)>pl.EPS&&(this.mPreviousRadius=o,a=!0),this.didPan()&&(t.target.set(this.mControls.target.x,this.mControls.target.y,this.mControls.target.z),this.mPreviousTarget.copy(t.target),a||(r=!0)),this.didRotate()&&(t.transform.position.set(n.position.x,n.position.y,n.position.z),t.transform.quaternion.set(n.quaternion.x,n.quaternion.y,n.quaternion.z,n.quaternion.w),this.mPreviousPosition.copy(t.transform.position),r||a||(i=!0)),a&&this.onControlsZoom(),(r||i)&&this.onControlsChange()}}},{key:"onUpdateDirty",value:function(){var e=this.mCamera.getSceneEntity();this.loadCameraControls(),this.createCameraControls();var t=e.getComponent("orbit-camera-controls");t.getValue("orbit_controls.save_state")&&this.mControls.saveState(),t.getValue("orbit_controls.reset_state")&&(this.mControls.position0=this.mCamera.getCamera().position.clone(),this.mControls.target0=this.mControls.target.clone(),this.mControls.reset()),t.getValue("orbit_controls.reset_state_mouse")&&this.mControls.resetMouseState(),t.setNeedsRenderUpdate(!1)}},{key:"destroyCameraControls",value:function(){this.mControls&&(this.mControls.dispose(),delete this.mControls)}},{key:"onAttached",value:function(){}},{key:"onDetached",value:function(){}},{key:"onControlsChange",value:function(){P.eventBus().dispatch(new ta)}},{key:"onControlsZoom",value:function(){P.eventBus().dispatch(new aa)}},{key:"getComponentName",value:function(){return"orbit-camera-controls"}},{key:"didPan",value:function(){var e=this.mPreviousTarget.x-this.mControls.target.x,t=this.mPreviousTarget.y-this.mControls.target.y,n=this.mPreviousTarget.z-this.mControls.target.z;return e*e+t*t+n*n>pl.EPS}},{key:"didRotate",value:function(){var e=this.mCamera.getCamera(),t=this.mPreviousPosition.x-e.position.x,n=this.mPreviousPosition.y-e.position.y,r=this.mPreviousPosition.z-e.position.z;return t*t+n*n+r*r>pl.EPS}}]),n}(LT);function VT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var HT=function(e){(0,g.Z)(n,e);var t=VT(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"mControls",void 0),(0,l.Z)((0,_.Z)(i),"mEnabled",!0),(0,l.Z)((0,_.Z)(i),"mActiveEntity",void 0),(0,l.Z)((0,_.Z)(i),"mZoomEnabled",void 0),(0,l.Z)((0,_.Z)(i),"mMinZoom",void 0),(0,l.Z)((0,_.Z)(i),"mMaxZoom",void 0),(0,l.Z)((0,_.Z)(i),"mDirection",void 0),(0,l.Z)((0,_.Z)(i),"mMinPolar",void 0),(0,l.Z)((0,_.Z)(i),"mMaxPolar",void 0),(0,l.Z)((0,_.Z)(i),"mMinAzimuth",void 0),(0,l.Z)((0,_.Z)(i),"mMaxAzimuth",void 0),(0,l.Z)((0,_.Z)(i),"mDampEnabled",void 0),(0,l.Z)((0,_.Z)(i),"mDampFactor",void 0),(0,l.Z)((0,_.Z)(i),"mAutoRotate",void 0),(0,l.Z)((0,_.Z)(i),"mRotationSpeed",void 0),i}return(0,c.Z)(n,[{key:"loadCameraControls",value:function(){var e=this.mCamera.getSceneEntity().getComponent("turntable-camera-controls");this.mEnabled=e.enabled,this.mZoomEnabled=e.zoomEnabled,this.mMinZoom=e.zoomMin,this.mMaxZoom=e.zoomMax,this.mDirection=e.direction,this.mMinPolar=e.polarAngleMin,this.mMaxPolar=e.polarAngleMax,this.mMinAzimuth=e.azimuthAngleMin,this.mMaxAzimuth=e.azimuthAngleMax,this.mDampEnabled=e.dampingEnabled,this.mDampFactor=e.dampingFactor,this.mAutoRotate=!1,this.mRotationSpeed=e.rotationSpeed,this.mActiveEntity=e.getValue("active_object")}},{key:"createCameraControls",value:function(){var e=this.mCamera.getCamera();if(!this.mControls){var t=this.mDirection===ca.Theta?Bi.AxisY():Bi.AxisX();this.mControls=new O_(this.mCamera.getSceneEntity(),this.mActiveEntity,t,this.mRenderer.getCanvas())}this.mControls.enabled=this.mEnabled&&!!this.mActiveEntity,this.mControls.rotateSpeed=this.mRotationSpeed,this.mControls.autoRotate=this.mAutoRotate,this.mControls.enableDamping=this.mDampEnabled,Number.isFinite(this.mDampFactor)&&(this.mControls.dampingFactor=this.mDampFactor);var n=new Bi,r=new A_;n.applyQuaternion((new Pi).setFromUnitVectors(new Bi(e.up.x,e.up.y,e.up.z),new Bi(0,1,0))),r.setFromVector3(n),r.makeSafe(),this.mDirection===ca.Phi?(this.mControls.minPolarAngle=this.mMinPolar,this.mControls.maxPolarAngle=this.mMaxPolar,this.mControls.minAzimuthAngle=r.theta,this.mControls.maxAzimuthAngle=r.theta):(this.mControls.minAzimuthAngle=this.mMinAzimuth,this.mControls.maxAzimuthAngle=this.mMaxAzimuth,this.mControls.minPolarAngle=r.phi,this.mControls.maxPolarAngle=r.phi),this.mControls.enableZoom=this.mZoomEnabled,this.mControls.minDistance=this.mMinZoom,this.mControls.maxDistance=this.mMaxZoom}},{key:"destroyCameraControls",value:function(){this.mControls.dispose(),this.mControls=void 0}},{key:"update",value:function(e){this.mControls&&this.mControls.update()}},{key:"onUpdateDirty",value:function(){var e=this.mCamera.getSceneEntity();this.loadCameraControls(),this.createCameraControls();var t=e.getComponent("turntable-camera-controls");t.getValue("turntable_controls.save_state")&&this.mControls.saveState(),t.getValue("turntable_controls.reset_state")&&this.mControls.reset(),t.setNeedsRenderUpdate(!1)}},{key:"onAttached",value:function(){this.mControls&&(this.mControls.addEventListener("change",this.onControlsChange.bind(this)),this.mControls.addEventListener("zoom",this.onZoom.bind(this)))}},{key:"onDetached",value:function(){this.mControls&&(this.mControls.removeEventListener("change",this.onControlsChange.bind(this)),this.mControls.removeEventListener("zoom",this.onZoom.bind(this)))}},{key:"onZoom",value:function(){if(this.mControls){var e=this.mCamera.getSceneEntity(),t=e.transform.position.clone().sub(this.mActiveEntity.transform.position).normalize(),n=this.mControls.getRadius(),r=this.mActiveEntity.transform.position.clone().addScaledVector(t,n);e.transform.position.copy(r),e.markNeedsRenderUpdate(),this.onControlsZoom()}}},{key:"onControlsChange",value:function(){P.eventBus().dispatch(new ta)}},{key:"onControlsZoom",value:function(){P.eventBus().dispatch(new aa)}},{key:"getComponentName",value:function(){return"turntable-camera-controls"}}]),n}(LT);function GT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var qT=function(e){(0,g.Z)(n,e);var t=GT(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this,e,r),(0,l.Z)((0,_.Z)(i),"mEnabled",!0),i}return(0,c.Z)(n,[{key:"loadCameraControls",value:function(){}},{key:"createCameraControls",value:function(){}},{key:"update",value:function(e){}},{key:"onUpdateDirty",value:function(){this.loadCameraControls(),this.createCameraControls()}},{key:"destroyCameraControls",value:function(){}},{key:"onAttached",value:function(){}},{key:"onDetached",value:function(){}},{key:"getComponentName",value:function(){return"orbit-camera-controls"}}]),n}(LT);function WT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var YT=function(e){(0,g.Z)(a,e);var n,i=WT(a);function a(e,t){var n;return(0,u.Z)(this,a),n=i.call(this,e,t),(0,l.Z)((0,_.Z)(n),"mCameraName","Camera Perspective"),(0,l.Z)((0,_.Z)(n),"mPosition",Bi.Zero()),(0,l.Z)((0,_.Z)(n),"mTarget",Bi.Zero()),(0,l.Z)((0,_.Z)(n),"mNear",.1),(0,l.Z)((0,_.Z)(n),"mFar",1e3),(0,l.Z)((0,_.Z)(n),"mFov",45),(0,l.Z)((0,_.Z)(n),"mAspectRatio",1),(0,l.Z)((0,_.Z)(n),"mControls",void 0),n}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.loadResourceFromEntity();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadResourceFromEntity",value:function(){var e=this.mSceneEntity;this.mCameraName=e.name,this.mPosition.copy(e.transform.position),this.mTarget.copy(e.target),this.mFov=e.fov,this.mAspectRatio=e.getValue("aspect_ratio")||1,this.mNear=e.near,this.mFar=e.far;var t=e.getComponents(Ji.TypeRTTI),n=t.length>0?t[0]:void 0,r=n?n.getComponentName():null;if(!this.mControls||this.mControls.getComponentName()!==r)switch(this.mControls&&(this.mControls.onDetached(),this.mControls.destroyCameraControls(),delete this.mControls),r){case"fps-camera-controls":this.mControls=new jT(this,this.getRenderer());break;case"turntable-camera-controls":this.mControls=new HT(this,this.getRenderer());break;case"orbit-camera-controls":this.mControls=new UT(this,this.getRenderer());break;default:this.mControls=new qT(this,this.getRenderer())}this.mControls.loadCameraControls()}},{key:"createRenderObject",value:function(){var e,t=this.mSceneEntity;this.mRenderObject||(this.mRenderObject=new THREE.PerspectiveCamera(this.mFov,this.mAspectRatio,this.mNear,this.mFar));var n=this.mRenderObject;t.needsProjectionMatrixUpdate()&&(n.fov=this.mFov,n.near=this.mNear,n.far=this.mFar,n.updateProjectionMatrix(),t.setProjectionMatrixUpdate(!1)),n.name=this.mCameraName;var r=this.mPosition.clone(),i=this.mTarget.clone();this.mRenderer.isRightHandedSystemActive()||(r.toggleCoordSystem(),i.toggleCoordSystem()),n.position.set(r.x,r.y,r.z),n.lookAt(i.x,i.y,i.z),null===(e=this.mControls)||void 0===e||e.createCameraControls()}},{key:"destroyRenderObject",value:function(){var e;null===(e=this.mControls)||void 0===e||e.destroyCameraControls(),Ni((0,M.Z)(a.prototype),"destroyRenderObject",this).call(this)}},{key:"attach",value:function(){var e;Ni((0,M.Z)(a.prototype),"attach",this).call(this),null===(e=this.mControls)||void 0===e||e.onAttached(),this.mRenderer.setCameraActive(this)}},{key:"detach",value:function(){var e;Ni((0,M.Z)(a.prototype),"detach",this).call(this),null===(e=this.mControls)||void 0===e||e.onDetached()}},{key:"onUpdateDirty",value:function(){var e;Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.loadResourceFromEntity(),this.createRenderObject(),null===(e=this.mControls)||void 0===e||e.onUpdateDirty()}},{key:"update",value:function(e){var t;null===(t=this.mControls)||void 0===t||t.update(e),Ni((0,M.Z)(a.prototype),"update",this).call(this,e)}},{key:"updateTranslation",value:function(){return!1}},{key:"setSize",value:function(e,t){if(this.mRenderObject){var n=this.mRenderObject;n.aspect=e/t,n.updateProjectionMatrix()}}},{key:"getSceneEntity",value:function(){return this.mSceneEntity}},{key:"isOrthographic",value:function(){return!1}},{key:"isPerspective",value:function(){return!0}},{key:"getCamera",value:function(){return this.mRenderObject}}]),a}(Ax);__webpack_require__(2481);function KT(e){switch(e){case _s.Byte:return THREE.ByteType;case _s.Short:return THREE.ShortType;case _s.UnsignedShort:return THREE.UnsignedShortType;case _s.Int:return THREE.IntType;case _s.UnsignedInt:return THREE.UnsignedIntType;case _s.Float:return THREE.FloatType;case _s.HalfFloat:return THREE.HalfFloatType;case _s.UnsignedShort4444:return THREE.UnsignedShort4444Type;case _s.UnsignedShort5551:return THREE.UnsignedShort5551Type;case _s.UnsignedShort565:return THREE.UnsignedShort565Type;case _s.UnsignedInt248:return THREE.UnsignedInt248Type;case _s.UnsignedByte:default:return THREE.UnsignedByteType}}function XT(e){switch(e){case THREE.ByteType:return _s.Byte;case THREE.ShortType:return _s.Short;case THREE.UnsignedShortType:return _s.UnsignedShort;case THREE.IntType:return _s.Int;case THREE.UnsignedIntType:return _s.UnsignedInt;case THREE.FloatType:return _s.Float;case THREE.HalfFloatType:return _s.HalfFloat;case THREE.UnsignedShort4444Type:return _s.UnsignedShort4444;case THREE.UnsignedShort5551Type:return _s.UnsignedShort5551;case THREE.UnsignedShort565Type:return _s.UnsignedShort565;case THREE.UnsignedInt248Type:return _s.UnsignedInt248;case THREE.UnsignedByteType:default:return _s.UnsignedByte}}function $T(e){switch(e){case xs.Alpha:return THREE.AlphaFormat;case xs.Red:case xs.RedInt:return 1028;case xs.RG:case xs.RGInt:return 1030;case xs.RGB:case xs.RGBInt:return THREE.RGBFormat;case xs.RGBAInt:return THREE.RGBAFormat;case xs.Luminance:return THREE.LuminanceFormat;case xs.LuminanceAlpha:return THREE.LuminanceAlphaFormat;case xs.Depth:return THREE.DepthFormat;case xs.DepthStencil:return THREE.DepthStencilFormat;case xs.RGBA:default:return THREE.RGBAFormat}}function QT(e){switch(e){case THREE.AlphaFormat:return xs.Alpha;case 1028:return xs.Red;case 1029:return xs.RedInt;case 1030:return xs.RG;case 1031:return xs.RGInt;case THREE.RGBFormat:return xs.RGB;case 1032:return xs.RGBInt;case 1033:return xs.RGBAInt;case THREE.LuminanceFormat:return xs.Luminance;case THREE.LuminanceAlphaFormat:return xs.LuminanceAlpha;case THREE.DepthFormat:return xs.Depth;case THREE.DepthStencilFormat:return xs.DepthStencil;case THREE.RGBAFormat:case THREE.RGBEFormat:default:return xs.RGBA}}function JT(e){switch(e){case Ts.sRGB:return THREE.sRGBEncoding;case Ts.Gamma:return THREE.GammaEncoding;case Ts.RGBE:return THREE.RGBEEncoding;case Ts.LogLuv:return THREE.LogLuvEncoding;case Ts.RGBM7:return THREE.RGBM7Encoding;case Ts.RGBM16:return THREE.RGBM16Encoding;case Ts.RGBD:return THREE.RGBDEncoding;case Ts.BasicDepthPacking:return 3200;case Ts.RGBADepthPacking:return 3201;case Ts.Linear:default:return THREE.LinearEncoding}}function ew(e){switch(e){case THREE.sRGBEncoding:return Ts.sRGB;case THREE.GammaEncoding:return Ts.Gamma;case THREE.RGBEEncoding:return Ts.RGBE;case THREE.LogLuvEncoding:return Ts.LogLuv;case THREE.RGBM7Encoding:return Ts.RGBM7;case THREE.RGBM16Encoding:return Ts.RGBM16;case THREE.RGBDEncoding:return Ts.RGBD;case THREE.BasicDepthPacking:return Ts.BasicDepthPacking;case THREE.RGBADepthPacking:return Ts.RGBADepthPacking;case THREE.LinearEncoding:default:return Ts.Linear}}function tw(e,t){switch(e){case ws.Cube:return t===Rs.Refract||t===Rs.ReflectRefract?THREE.CubeRefractionMapping:THREE.CubeReflectionMapping;case ws.Equirectangular:return t===Rs.Refract||t===Rs.ReflectRefract?THREE.EquirectangularRefractionMapping:THREE.EquirectangularReflectionMapping;case ws.Spherical:return THREE.SphericalReflectionMapping;case ws.UV:default:return THREE.UVMapping}}function nw(e){switch(e){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:return ws.Cube;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:return ws.Equirectangular;case THREE.SphericalReflectionMapping:return ws.Spherical;case THREE.UVMapping:default:return ws.UV}}function rw(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=e===Zs.Nearest?THREE.NearestFilter:THREE.LinearFilter;THREE.LinearFilter;return{magFilter:i,minFilter:t===Zs.Nearest?r&&n===Zs.Nearest?THREE.NearestMipMapNearestFilter:r&&n===Zs.Linear?THREE.NearestMipMapLinearFilter:THREE.NearestFilter:r&&n===Zs.Nearest?THREE.LinearMipMapNearestFilter:r&&n===Zs.Linear?THREE.LinearMipMapLinearFilter:THREE.LinearFilter}}function iw(e){switch(e){case Ss.Repeat:return THREE.RepeatWrapping;case Ss.MirrorRepeat:return THREE.MirroredRepeatWrapping;case Ss.ClampToEdge:default:return THREE.ClampToEdgeWrapping}}function aw(e){switch(e){case THREE.RepeatWrapping:return Ss.Repeat;case THREE.MirroredRepeatWrapping:return Ss.MirrorRepeat;case THREE.ClampToEdgeWrapping:default:return Ss.ClampToEdge}}function ow(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var sw=function(e){(0,g.Z)(n,e);var t=ow(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"texture2d",i=arguments.length>1?arguments[1]:void 0,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ws.UV,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ss.ClampToEdge,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Ss.ClampToEdge,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Zs.Linear,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Zs.Linear,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Zs.Linear,m=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:xs.RGBA,v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:_s.UnsignedByte,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:Ts.Linear;return(0,u.Z)(this,n),e=t.call(this),(0,l.Z)((0,_.Z)(e),"mInternalTexture",void 0),(0,l.Z)((0,_.Z)(e),"mOffset",D.Zero()),(0,l.Z)((0,_.Z)(e),"mRepeat",D.One()),(0,l.Z)((0,_.Z)(e),"mCenter",D.Zero()),(0,l.Z)((0,_.Z)(e),"mLevel",1),(0,l.Z)((0,_.Z)(e),"mRenderMode",Rs.Reflect),(0,l.Z)((0,_.Z)(e),"mMagFilter",Zs.Linear),(0,l.Z)((0,_.Z)(e),"mMinFilter",Zs.Linear),(0,l.Z)((0,_.Z)(e),"mMipmapFilter",Zs.Linear),(0,l.Z)((0,_.Z)(e),"mGenerateMipmap",!1),(0,l.Z)((0,_.Z)(e),"mDirty",!1),(0,l.Z)((0,_.Z)(e),"mUvChannel",0),(0,l.Z)((0,_.Z)(e),"mMatrix",new kc),e.mInternalTexture=new THREE.Texture(i,tw(o,Rs.Reflect),iw(s),iw(c),rw(h,f,p,m).magFilter,rw(h,f,p,m).minFilter,$T(d),KT(v),y,JT(g)),e.mInternalTexture.name=r,e.mMagFilter=h,e.mMinFilter=f,e.mMipmapFilter=p,e.mGenerateMipmap=m,e.mInternalTexture.generateMipmaps=e.mGenerateMipmap,e.setFlipY(a),e.setCenter(D.Zero()),e.setRepeat(D.One()),e}return(0,c.Z)(n,[{key:"getOffset",value:function(){return this.mOffset}},{key:"setOffset",value:function(e){this.mOffset.copy(e),this.mInternalTexture.offset.set(this.mOffset.x,this.mOffset.y)}},{key:"getRepeat",value:function(){return this.mRepeat}},{key:"setRepeat",value:function(e){this.mRepeat.copy(e),this.mInternalTexture.repeat.set(this.mRepeat.x,this.mRepeat.y)}},{key:"getCenter",value:function(){return this.mCenter}},{key:"setCenter",value:function(e){this.mCenter.copy(e),this.mInternalTexture.center.set(this.mCenter.x,this.mCenter.y)}},{key:"getRotation",value:function(){return this.mInternalTexture.rotation}},{key:"setRotation",value:function(e){this.mInternalTexture.rotation=e}},{key:"getFlipY",value:function(){return this.mInternalTexture.flipY}},{key:"setFlipY",value:function(e){this.mInternalTexture.flipY=e}},{key:"updateSource",value:function(e){this.mInternalTexture.image=e,this.mInternalTexture.needsUpdate=!0}},{key:"updateMatrix",value:function(){this.mMatrix.setUvTransform(this.mOffset.x,this.mOffset.y,this.mRepeat.x,this.mRepeat.y,this.mInternalTexture.rotation,this.mCenter.x,this.mCenter.y),this.mInternalTexture.matrix.fromArray(this.mMatrix.elements,0)}},{key:"getName",value:function(){return this.mInternalTexture.name}},{key:"setName",value:function(e){this.mInternalTexture.name=e}},{key:"getGenerateMipmap",value:function(){return this.mGenerateMipmap}},{key:"getAnistropicFilteringLevel",value:function(){return this.mInternalTexture.anisotropy}},{key:"setAnistropicFilteringLevel",value:function(e){this.mInternalTexture.anisotropy=e}},{key:"getTextureDataType",value:function(){return XT(this.mInternalTexture.type)}},{key:"setTextureDataType",value:function(e){this.mInternalTexture.type=KT(e)}},{key:"getTextureFormat",value:function(){return QT(this.mInternalTexture.format)}},{key:"setTextureFormat",value:function(e){this.mInternalTexture.format=$T(e)}},{key:"getTextureEncoding",value:function(){return ew(this.mInternalTexture.encoding)}},{key:"setTextureEncoding",value:function(e){this.mInternalTexture.encoding=JT(e)}},{key:"getTextureMapping",value:function(){return nw(this.mInternalTexture.mapping)}},{key:"setTextureMapping",value:function(e){this.mInternalTexture.mapping=tw(e,this.mRenderMode)}},{key:"getTextureRenderMode",value:function(){return this.mRenderMode}},{key:"setTextureRenderMode",value:function(e){this.mRenderMode=e,this.setTextureMapping(this.getTextureMapping())}},{key:"getMagFilter",value:function(){return this.mMagFilter}},{key:"setMagFilter",value:function(e){this.mMagFilter=e,this.updateTextureFilter()}},{key:"getMinFilter",value:function(){return this.mMinFilter}},{key:"setMinFilter",value:function(e){this.mMinFilter=e,this.updateTextureFilter()}},{key:"getMipmapFilter",value:function(){return this.mMipmapFilter}},{key:"setMipmapFilter",value:function(e){this.mMipmapFilter=e,this.updateTextureFilter()}},{key:"getWrapU",value:function(){return aw(this.mInternalTexture.wrapS)}},{key:"setWrapU",value:function(e){this.mInternalTexture.wrapS=iw(e)}},{key:"getWrapV",value:function(){return aw(this.mInternalTexture.wrapT)}},{key:"setWrapV",value:function(e){this.mInternalTexture.wrapT=iw(e)}},{key:"getLevel",value:function(){return this.mLevel}},{key:"setLevel",value:function(e){this.mLevel=e}},{key:"getUVChannel",value:function(){return this.mUvChannel}},{key:"setUVChannel",value:function(e){this.mUvChannel=e}},{key:"isTexture2D",value:function(){return!0}},{key:"isTexture3D",value:function(){return!1}},{key:"isTextureCube",value:function(){return!1}},{key:"isTextureGrayscale",value:function(){var e=this.getTextureFormat();return e===xs.Red||e===xs.RedInt||e===xs.Depth||e===xs.DepthStencil}},{key:"hasTextureAlpha",value:function(){var e=this.getTextureFormat();return e===xs.Alpha||e===xs.RGBA||e===xs.LuminanceAlpha||e===xs.RGBAInt}},{key:"useRGBasAlpha",value:function(e){}},{key:"getMatrix",value:function(){return this.mMatrix}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,this.mInternalTexture.needsUpdate=e}},{key:"dispose",value:function(){this.mInternalTexture.dispose()}},{key:"updateTextureFilter",value:function(){var e=rw(this.mMagFilter,this.mMinFilter,this.mMipmapFilter);this.mInternalTexture.magFilter=e.magFilter,this.mInternalTexture.minFilter=e.minFilter}},{key:"getInternalTexture",value:function(){return this.mInternalTexture}}]),n}(Gs);function uw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var cw=function(e){(0,g.Z)(n,e);var t=uw(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"texturecanvas",i=arguments.length>1?arguments[1]:void 0,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ws.UV,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ss.ClampToEdge,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Ss.ClampToEdge,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Zs.Linear,f=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Zs.Linear,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Zs.Linear,m=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:xs.RGBA,v=arguments.length>11&&void 0!==arguments[11]?arguments[11]:_s.UnsignedByte,y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:Ts.Linear;return(0,u.Z)(this,n),e=t.call(this),(0,l.Z)((0,_.Z)(e),"mInternalTexture",void 0),(0,l.Z)((0,_.Z)(e),"mCanvas",void 0),(0,l.Z)((0,_.Z)(e),"mOffset",D.Zero()),(0,l.Z)((0,_.Z)(e),"mRepeat",D.One()),(0,l.Z)((0,_.Z)(e),"mCenter",D.Zero()),(0,l.Z)((0,_.Z)(e),"mLevel",1),(0,l.Z)((0,_.Z)(e),"mRenderMode",Rs.Reflect),(0,l.Z)((0,_.Z)(e),"mMagFilter",Zs.Linear),(0,l.Z)((0,_.Z)(e),"mMinFilter",Zs.Linear),(0,l.Z)((0,_.Z)(e),"mMipmapFilter",Zs.Linear),(0,l.Z)((0,_.Z)(e),"mGenerateMipmap",!1),(0,l.Z)((0,_.Z)(e),"mDirty",!1),(0,l.Z)((0,_.Z)(e),"mUvChannel",0),(0,l.Z)((0,_.Z)(e),"mMatrix",new kc),e.mInternalTexture=new THREE.Texture(i,tw(o,Rs.Reflect),iw(s),iw(c),rw(h,f,p,m).magFilter,rw(h,f,p,m).minFilter,$T(d),KT(v),y,JT(g)),e.mCanvas=i,e.mInternalTexture.name=r,e.mMagFilter=h,e.mMinFilter=f,e.mMipmapFilter=p,e.mGenerateMipmap=m,e.mInternalTexture.generateMipmaps=e.mGenerateMipmap,e.setFlipY(a),e.setCenter(D.Zero()),e.setRepeat(D.One()),e}return(0,c.Z)(n,[{key:"getOffset",value:function(){return this.mOffset}},{key:"setOffset",value:function(e){this.mOffset.copy(e),this.mInternalTexture.offset.set(this.mOffset.x,this.mOffset.y)}},{key:"getRepeat",value:function(){return this.mRepeat}},{key:"setRepeat",value:function(e){this.mRepeat.copy(e),this.mInternalTexture.repeat.set(this.mRepeat.x,this.mRepeat.y)}},{key:"getCenter",value:function(){return this.mCenter}},{key:"setCenter",value:function(e){this.mCenter.copy(e),this.mInternalTexture.center.set(this.mCenter.x,this.mCenter.y)}},{key:"getRotation",value:function(){return this.mInternalTexture.rotation}},{key:"setRotation",value:function(e){this.mInternalTexture.rotation=e}},{key:"getFlipY",value:function(){return this.mInternalTexture.flipY}},{key:"setFlipY",value:function(e){this.mInternalTexture.flipY=e}},{key:"updateSource",value:function(e){this.mInternalTexture.image=e,this.mInternalTexture.needsUpdate=!0}},{key:"updateMatrix",value:function(){this.mMatrix.setUvTransform(this.mOffset.x,this.mOffset.y,this.mRepeat.x,this.mRepeat.y,this.mInternalTexture.rotation,this.mCenter.x,this.mCenter.y),this.mInternalTexture.matrix.fromArray(this.mMatrix.elements,0)}},{key:"getName",value:function(){return this.mInternalTexture.name}},{key:"setName",value:function(e){this.mInternalTexture.name=e}},{key:"getGenerateMipmap",value:function(){return this.mGenerateMipmap}},{key:"getAnistropicFilteringLevel",value:function(){return this.mInternalTexture.anisotropy}},{key:"setAnistropicFilteringLevel",value:function(e){this.mInternalTexture.anisotropy=e}},{key:"getTextureDataType",value:function(){return XT(this.mInternalTexture.type)}},{key:"setTextureDataType",value:function(e){this.mInternalTexture.type=KT(e)}},{key:"getTextureFormat",value:function(){return QT(this.mInternalTexture.format)}},{key:"setTextureFormat",value:function(e){this.mInternalTexture.format=$T(e)}},{key:"getTextureEncoding",value:function(){return ew(this.mInternalTexture.encoding)}},{key:"setTextureEncoding",value:function(e){this.mInternalTexture.encoding=JT(e)}},{key:"getTextureMapping",value:function(){return nw(this.mInternalTexture.mapping)}},{key:"setTextureMapping",value:function(e){this.mInternalTexture.mapping=tw(e,this.mRenderMode)}},{key:"getTextureRenderMode",value:function(){return this.mRenderMode}},{key:"setTextureRenderMode",value:function(e){this.mRenderMode=e,this.setTextureMapping(this.getTextureMapping())}},{key:"getMagFilter",value:function(){return this.mMagFilter}},{key:"setMagFilter",value:function(e){this.mMagFilter=e,this.updateTextureFilter()}},{key:"getMinFilter",value:function(){return this.mMinFilter}},{key:"setMinFilter",value:function(e){this.mMinFilter=e,this.updateTextureFilter()}},{key:"getMipmapFilter",value:function(){return this.mMipmapFilter}},{key:"setMipmapFilter",value:function(e){this.mMipmapFilter=e,this.updateTextureFilter()}},{key:"getWrapU",value:function(){return aw(this.mInternalTexture.wrapS)}},{key:"setWrapU",value:function(e){this.mInternalTexture.wrapS=iw(e)}},{key:"getWrapV",value:function(){return aw(this.mInternalTexture.wrapT)}},{key:"setWrapV",value:function(e){this.mInternalTexture.wrapT=iw(e)}},{key:"getLevel",value:function(){return this.mLevel}},{key:"setLevel",value:function(e){this.mLevel=e}},{key:"getUVChannel",value:function(){return this.mUvChannel}},{key:"setUVChannel",value:function(e){this.mUvChannel=e}},{key:"isTexture2D",value:function(){return!0}},{key:"isTexture3D",value:function(){return!1}},{key:"isTextureCube",value:function(){return!1}},{key:"isTextureGrayscale",value:function(){var e=this.getTextureFormat();return e===xs.Red||e===xs.RedInt||e===xs.Depth||e===xs.DepthStencil}},{key:"hasTextureAlpha",value:function(){var e=this.getTextureFormat();return e===xs.Alpha||e===xs.RGBA||e===xs.LuminanceAlpha||e===xs.RGBAInt}},{key:"useRGBasAlpha",value:function(e){}},{key:"getMatrix",value:function(){return this.mMatrix}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,this.mInternalTexture.needsUpdate=e}},{key:"updateTextureFilter",value:function(){var e=rw(this.mMagFilter,this.mMinFilter,this.mMipmapFilter);this.mInternalTexture.magFilter=e.magFilter,this.mInternalTexture.minFilter=e.minFilter}},{key:"getContext",value:function(){return this.mCanvas.getContext("2d")}},{key:"getCanvas",value:function(){return this.mCanvas}},{key:"dispose",value:function(){this.mInternalTexture.dispose(),this.mCanvas&&this.mCanvas.remove()}},{key:"getInternalTexture",value:function(){return this.mInternalTexture}}]),n}(tk);function lw(e){switch(e){case THREE.BackSide:return Es.Back;case THREE.DoubleSide:return Es.Double;case THREE.FrontSide:default:return Es.Front}}function hw(e){switch(e){case Es.Back:return THREE.BackSide;case Es.Double:return THREE.DoubleSide;case Es.Front:default:return THREE.FrontSide}}function fw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:THREE.SrcAlphaFactor,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:THREE.OneMinusSrcAlphaFactor,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:THREE.OneFactor,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:THREE.OneFactor;if(e===THREE.CustomBlending)return t===THREE.SrcAlphaFactor&&n===THREE.OneFactor&&r===THREE.ZeroFactor&&i===THREE.OneFactor?Qo.Add:t===THREE.ZeroFactor&&n===THREE.OneMinusSrcColorFactor&&r===THREE.OneFactor&&i===THREE.OneFactor?Qo.Subtract:t===THREE.DstColorFactor&&n===THREE.ZeroFactor&&r===THREE.OneFactor&&i===THREE.OneFactor?Qo.Multiply:t===THREE.SrcAlphaSaturateFactor&&n===THREE.OneMinusSrcColorFactor&&r===THREE.OneFactor&&i===THREE.OneFactor?Qo.Maximized:t===THREE.OneFactor&&n===THREE.OneFactor&&r===THREE.OneFactor&&i===THREE.OneFactor?Qo.OneOne:t===THREE.OneFactor&&n===THREE.OneMinusSrcColorFactor&&r===THREE.OneFactor&&i===THREE.OneMinusSrcAlphaFactor?Qo.ScreenMode:Qo.Combine;switch(e){case THREE.NoBlending:return Qo.Disable;case THREE.AdditiveBlending:return Qo.Add;case THREE.SubtractiveBlending:return Qo.Subtract;case THREE.MultiplyBlending:return Qo.Multiply;case THREE.NormalBlending:default:return Qo.Combine}}function pw(e){switch(e){case Qo.Disable:return{blending:THREE.NoBlending,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneMinusSrcAlphaFactor,blendSrcAlpha:THREE.OneFactor,blendDstAlpha:THREE.OneFactor};case Qo.Add:return{blending:THREE.AdditiveBlending,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneFactor,blendSrcAlpha:THREE.ZeroFactor,blendDstAlpha:THREE.OneFactor};case Qo.Subtract:return{blending:THREE.SubtractiveBlending,blendSrc:THREE.ZeroFactor,blendDst:THREE.OneMinusSrcColorFactor,blendSrcAlpha:THREE.OneFactor,blendDstAlpha:THREE.OneFactor};case Qo.Multiply:return{blending:THREE.MultiplyBlending,blendSrc:THREE.DstColorFactor,blendDst:THREE.ZeroFactor,blendSrcAlpha:THREE.OneFactor,blendDstAlpha:THREE.OneFactor};case Qo.Maximized:return{blending:THREE.CustomBlending,blendSrc:THREE.SrcAlphaSaturateFactor,blendDst:THREE.OneMinusSrcColorFactor,blendSrcAlpha:THREE.OneFactor,blendDstAlpha:THREE.OneFactor};case Qo.OneOne:return{blending:THREE.CustomBlending,blendSrc:THREE.OneFactor,blendDst:THREE.OneFactor,blendSrcAlpha:THREE.OneFactor,blendDstAlpha:THREE.OneFactor};case Qo.ScreenMode:return{blending:THREE.CustomBlending,blendSrc:THREE.OneFactor,blendDst:THREE.OneMinusSrcColorFactor,blendSrcAlpha:THREE.OneFactor,blendDstAlpha:THREE.OneMinusSrcAlphaFactor};case Qo.Interpolate:case Qo.Combine:default:return{blending:THREE.NormalBlending,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneMinusSrcAlphaFactor,blendSrcAlpha:THREE.OneFactor,blendDstAlpha:THREE.OneFactor}}}function mw(e){switch(e){case THREE.MixOperation:return Jo.Mix;case THREE.AddOperation:return Jo.Add;case THREE.MultiplyOperation:default:return Jo.Multiply}}function dw(e){switch(e){case Jo.Mix:return THREE.MixOperation;case Jo.Add:return THREE.AddOperation;case Jo.Multiply:default:return THREE.MultiplyOperation}}function vw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var yw=function(e){(0,g.Z)(n,e);var t=vw(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(r),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(r),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(r),"mEnvMapIntensity",1),(0,l.Z)((0,_.Z)(r),"mEnvMapScale",D.One()),(0,l.Z)((0,_.Z)(r),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(r),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(r),"mAoMap",void 0),(0,l.Z)((0,_.Z)(r),"mSpecularMap",void 0),(0,l.Z)((0,_.Z)(r),"mLightMap",void 0),(0,l.Z)((0,_.Z)(r),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(r),"mEmissiveMap",void 0),(0,l.Z)((0,_.Z)(r),"mFreeze",!1),(0,l.Z)((0,_.Z)(r),"mDirty",!1),r.mInternalMaterial=new THREE.MeshLambertMaterial({name:e}),r.mInternalMaterial.userData={},r}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.color.setRGB(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.map=e?e.getInternalTexture():null}},{key:"useAlphaFromDiffuseMap",value:function(e){}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.alphaMap=e?e.getInternalTexture():null}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.aoMap=e?e.getInternalTexture():null}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.aoMapIntensity}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.aoMapIntensity=e}},{key:"getReflectivity",value:function(){return this.mInternalMaterial.reflectivity}},{key:"setReflectivity",value:function(e){this.mInternalMaterial.reflectivity=e}},{key:"getSpecularMap",value:function(){return this.mSpecularMap}},{key:"setSpecularMap",value:function(e){this.mSpecularMap=e,this.mInternalMaterial.specularMap=e?e.getInternalTexture():null}},{key:"getLightMap",value:function(){return this.mLightMap}},{key:"setLightMap",value:function(e){this.mLightMap=e,this.mInternalMaterial.lightMap=e?e.getInternalTexture():null}},{key:"getLightMapIntensity",value:function(){return this.mInternalMaterial.lightMapIntensity}},{key:"setLightMapIntensity",value:function(e){this.mInternalMaterial.lightMapIntensity=e}},{key:"getEnvMap",value:function(){return this.mEnvMap}},{key:"setEnvMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.envMap=e?e.getInternalTexture():null}},{key:"getEnvMapCombine",value:function(){return mw(this.mInternalMaterial.combine)}},{key:"setEnvMapCombine",value:function(e){this.mInternalMaterial.combine=dw(e)}},{key:"getEnvMapIntensity",value:function(){return this.mEnvMapIntensity}},{key:"setEnvMapIntensity",value:function(e){this.mEnvMapIntensity=e}},{key:"getEnvMapScale",value:function(){return this.mEnvMapScale}},{key:"setEnvMapScale",value:function(e){this.mEnvMapScale.copy(e),this.mInternalMaterial.envMapScale=this.mEnvMapScale.x}},{key:"getEmissiveColor",value:function(){return this.mEmissiveColor}},{key:"setEmissiveColor",value:function(e){this.mEmissiveColor.copy(e),this.mInternalMaterial.emissive.setRGB(this.mEmissiveColor.r,this.mEmissiveColor.g,this.mEmissiveColor.b)}},{key:"getEmissiveMap",value:function(){return this.mEmissiveMap}},{key:"setEmissiveMap",value:function(e){this.mEmissiveMap=e,this.mInternalMaterial.emissiveMap=e?e.getInternalTexture():null}},{key:"getEmissiveIntensity",value:function(){return this.mInternalMaterial.emissiveIntensity}},{key:"setEmissiveIntensity",value:function(e){this.mInternalMaterial.emissiveIntensity=e}},{key:"getIOR",value:function(){return this.mInternalMaterial.refractionRatio}},{key:"setIOR",value:function(e){this.mInternalMaterial.refractionRatio=e}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fog}},{key:"setFog",value:function(e){this.mInternalMaterial.fog=e}},{key:"getDepthTest",value:function(){return this.mInternalMaterial.depthTest}},{key:"setDepthTest",value:function(e){this.mInternalMaterial.depthTest=e}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.depthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.depthWrite=e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.opacity}},{key:"setOpacity",value:function(e){this.mInternalMaterial.opacity=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaTest}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaTest=e}},{key:"getTransparent",value:function(){return this.mInternalMaterial.transparent}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparent=e}},{key:"getAlphaMode",value:function(){return fw(this.mInternalMaterial.blending,this.mInternalMaterial.blendSrc,this.mInternalMaterial.blendDst,this.mInternalMaterial.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha)}},{key:"setAlphaMode",value:function(e){var t=pw(e);this.mInternalMaterial.blending=t.blending,this.mInternalMaterial.blendSrc=t.blendSrc,this.mInternalMaterial.blendDst=t.blendDst,this.mInternalMaterial.blendSrcAlpha=t.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha=t.blendDstAlpha}},{key:"getPremultipliedAlpha",value:function(){return this.mInternalMaterial.premultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mInternalMaterial.premultipliedAlpha=e}},{key:"getColorWrite",value:function(){return this.mInternalMaterial.colorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.colorWrite=e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return this.mInternalMaterial.wireframeLinewidth}},{key:"setWireframeLineWidth",value:function(e){this.mInternalMaterial.wireframeLinewidth=e}},{key:"getFreeze",value:function(){return this.mFreeze}},{key:"setFreeze",value:function(e){this.mFreeze=e}},{key:"getSide",value:function(){return lw(this.mInternalMaterial.side)}},{key:"setSide",value:function(e){this.mInternalMaterial.side=hw(e)}},{key:"getFlatShading",value:function(){return this.mInternalMaterial.flatShading}},{key:"setFlatShading",value:function(e){this.mInternalMaterial.flatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.userData}},{key:"setMetaData",value:function(e){this.mInternalMaterial.userData=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,this.mInternalMaterial.needsUpdate=e}},{key:"dispose",value:function(){this.mInternalMaterial.dispose()}},{key:"cloneMaterial",value:function(){return new n(this.getName()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){return this.mDiffuseColor.copy(e.mDiffuseColor),this.mEmissiveColor.copy(e.mEmissiveColor),this.mEnvMapIntensity=e.mEnvMapIntensity,this.mEnvMapScale.copy(e.mEnvMapScale),this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mSpecularMap=e.mSpecularMap,this.mLightMap=e.mLightMap,this.mEnvMap=e.mEnvMap,this.mEmissiveMap=e.mEmissiveMap,this.mFreeze=e.mFreeze,this.mDirty=e.mDirty,this.mInternalMaterial.copy(e.getInternalMaterial()),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(Cs);function gw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var bw=function(e){(0,g.Z)(n,e);var t=gw(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(r),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(r),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(r),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(r),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(r),"mAoMap",void 0),(0,l.Z)((0,_.Z)(r),"mSpecularMap",void 0),(0,l.Z)((0,_.Z)(r),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(r),"mFreeze",!1),(0,l.Z)((0,_.Z)(r),"mDirty",!1),r.mInternalMaterial=new THREE.MeshBasicMaterial({name:e}),r.mInternalMaterial.userData={},r}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.color.setRGB(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.map=e?e.getInternalTexture():null}},{key:"useAlphaFromDiffuseMap",value:function(e){}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.alphaMap=e?e.getInternalTexture():null}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.aoMap=e?e.getInternalTexture():null}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.aoMapIntensity}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.aoMapIntensity=e}},{key:"getReflectivity",value:function(){return this.mInternalMaterial.reflectivity}},{key:"setReflectivity",value:function(e){this.mInternalMaterial.reflectivity=e}},{key:"getSpecularMap",value:function(){return this.mSpecularMap}},{key:"setSpecularMap",value:function(e){this.mSpecularMap=e,this.mInternalMaterial.specularMap=e?e.getInternalTexture():null}},{key:"getEnvMapCombine",value:function(){return mw(this.mInternalMaterial.combine)}},{key:"setEnvMapCombine",value:function(e){this.mInternalMaterial.combine=dw(e)}},{key:"getEnvMap",value:function(){return this.mEnvMap}},{key:"setEnvMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.envMap=e?e.getInternalTexture():null}},{key:"getIOR",value:function(){return this.mInternalMaterial.refractionRatio}},{key:"setIOR",value:function(e){this.mInternalMaterial.refractionRatio=e}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fog}},{key:"setFog",value:function(e){this.mInternalMaterial.fog=e}},{key:"getDepthTest",value:function(){return this.mInternalMaterial.depthTest}},{key:"setDepthTest",value:function(e){this.mInternalMaterial.depthTest=e}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.depthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.depthWrite=e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.opacity}},{key:"setOpacity",value:function(e){this.mInternalMaterial.opacity=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaTest}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaTest=e}},{key:"getTransparent",value:function(){return this.mInternalMaterial.transparent}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparent=e}},{key:"getAlphaMode",value:function(){return fw(this.mInternalMaterial.blending,this.mInternalMaterial.blendSrc,this.mInternalMaterial.blendDst,this.mInternalMaterial.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha)}},{key:"setAlphaMode",value:function(e){var t=pw(e);this.mInternalMaterial.blending=t.blending,this.mInternalMaterial.blendSrc=t.blendSrc,this.mInternalMaterial.blendDst=t.blendDst,this.mInternalMaterial.blendSrcAlpha=t.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha=t.blendDstAlpha}},{key:"getPremultipliedAlpha",value:function(){return this.mInternalMaterial.premultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mInternalMaterial.premultipliedAlpha=e}},{key:"getColorWrite",value:function(){return this.mInternalMaterial.colorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.colorWrite=e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return this.mInternalMaterial.wireframeLinewidth}},{key:"setWireframeLineWidth",value:function(e){this.mInternalMaterial.wireframeLinewidth=e}},{key:"getFreeze",value:function(){return this.mFreeze}},{key:"setFreeze",value:function(e){this.mFreeze=e}},{key:"getSide",value:function(){return lw(this.mInternalMaterial.side)}},{key:"setSide",value:function(e){this.mInternalMaterial.side=hw(e)}},{key:"getFlatShading",value:function(){return this.mInternalMaterial.flatShading}},{key:"setFlatShading",value:function(e){this.mInternalMaterial.flatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.userData}},{key:"setMetaData",value:function(e){this.mInternalMaterial.userData=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,this.mInternalMaterial.needsUpdate=e}},{key:"dispose",value:function(){this.mInternalMaterial.dispose()}},{key:"cloneMaterial",value:function(){return new n(this.getName()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){return this.mDiffuseColor.copy(e.mDiffuseColor),this.mEmissiveColor.copy(e.mEmissiveColor),this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mSpecularMap=e.mSpecularMap,this.mEnvMap=e.mEnvMap,this.mFreeze=e.mFreeze,this.mDirty=e.mDirty,this.mInternalMaterial.copy(e.getInternalMaterial()),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(as);function Mw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var kw=function(e){(0,g.Z)(n,e);var t=Mw(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(r),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(r),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(r),"mSpecularColor",new so(.04,.067,.067)),(0,l.Z)((0,_.Z)(r),"mEnvMapIntensity",1),(0,l.Z)((0,_.Z)(r),"mNormalScale",D.One()),(0,l.Z)((0,_.Z)(r),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(r),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(r),"mAoMap",void 0),(0,l.Z)((0,_.Z)(r),"mBumpMap",void 0),(0,l.Z)((0,_.Z)(r),"mNormalMap",void 0),(0,l.Z)((0,_.Z)(r),"mDisplacementMap",void 0),(0,l.Z)((0,_.Z)(r),"mSpecularMap",void 0),(0,l.Z)((0,_.Z)(r),"mLightMap",void 0),(0,l.Z)((0,_.Z)(r),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(r),"mEmissiveMap",void 0),(0,l.Z)((0,_.Z)(r),"mFreeze",!1),(0,l.Z)((0,_.Z)(r),"mDirty",!1),r.mInternalMaterial=new THREE.MeshPhongMaterial({name:e}),r.mInternalMaterial.userData={},r}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.color.setRGB(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.map=e?e.getInternalTexture():null}},{key:"useAlphaFromDiffuseMap",value:function(e){}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.alphaMap=e?e.getInternalTexture():null}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.aoMap=e?e.getInternalTexture():null}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.aoMapIntensity}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.aoMapIntensity=e}},{key:"getBumpMap",value:function(){return this.mBumpMap}},{key:"setBumpMap",value:function(e){this.mBumpMap=e,this.mInternalMaterial.bumpMap=e?e.getInternalTexture():null}},{key:"getBumpScale",value:function(){return this.mInternalMaterial.bumpScale}},{key:"setBumpScale",value:function(e){this.mInternalMaterial.bumpScale=e}},{key:"getNormalMap",value:function(){return this.mNormalMap}},{key:"setNormalMap",value:function(e){this.mNormalMap=e,this.mInternalMaterial.normalMap=e?e.getInternalTexture():null}},{key:"getNormalScale",value:function(){return this.mNormalScale}},{key:"setNormalScale",value:function(e){this.mNormalScale.copy(e),this.mInternalMaterial.normalScale.set(this.mNormalScale.x,this.mNormalScale.y)}},{key:"getDisplacementMap",value:function(){return this.mDisplacementMap}},{key:"setDisplacementMap",value:function(e){this.mDisplacementMap=e,this.mInternalMaterial.displacementMap=e?e.getInternalTexture():null}},{key:"getDisplacementScale",value:function(){return this.mInternalMaterial.displacementScale}},{key:"setDisplacementScale",value:function(e){this.mInternalMaterial.displacementScale=e}},{key:"getDisplacementBias",value:function(){return this.mInternalMaterial.displacementBias}},{key:"setDisplacementBias",value:function(e){this.mInternalMaterial.displacementBias=e}},{key:"getReflectivity",value:function(){return this.mInternalMaterial.reflectivity}},{key:"setReflectivity",value:function(e){this.mInternalMaterial.reflectivity=e}},{key:"getSpecular",value:function(){return this.mSpecularColor}},{key:"setSpecular",value:function(e){this.mSpecularColor.copy(e),this.mInternalMaterial.specular.setRGB(this.mSpecularColor.r,this.mSpecularColor.g,this.mSpecularColor.b)}},{key:"getSpecularMap",value:function(){return this.mSpecularMap}},{key:"setSpecularMap",value:function(e){this.mSpecularMap=e,this.mInternalMaterial.specularMap=e?e.getInternalTexture():null}},{key:"getLightMap",value:function(){return this.mLightMap}},{key:"setLightMap",value:function(e){this.mLightMap=e,this.mInternalMaterial.lightMap=e?e.getInternalTexture():null}},{key:"getLightMapIntensity",value:function(){return this.mInternalMaterial.lightMapIntensity}},{key:"setLightMapIntensity",value:function(e){this.mInternalMaterial.lightMapIntensity=e}},{key:"getEnvMap",value:function(){return this.mEnvMap}},{key:"setEnvMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.envMap=e?e.getInternalTexture():null}},{key:"getEnvMapCombine",value:function(){return mw(this.mInternalMaterial.combine)}},{key:"setEnvMapCombine",value:function(e){this.mInternalMaterial.combine=dw(e)}},{key:"getEnvMapIntensity",value:function(){return this.mEnvMapIntensity}},{key:"setEnvMapIntensity",value:function(e){this.mEnvMapIntensity=e}},{key:"getEmissiveColor",value:function(){return this.mEmissiveColor}},{key:"setEmissiveColor",value:function(e){this.mEmissiveColor.copy(e),this.mInternalMaterial.emissive.setRGB(this.mEmissiveColor.r,this.mEmissiveColor.g,this.mEmissiveColor.b)}},{key:"getEmissiveMap",value:function(){return this.mEmissiveMap}},{key:"setEmissiveMap",value:function(e){this.mEmissiveMap=e,this.mInternalMaterial.emissiveMap=e?e.getInternalTexture():null}},{key:"getEmissiveIntensity",value:function(){return this.mInternalMaterial.emissiveIntensity}},{key:"setEmissiveIntensity",value:function(e){this.mInternalMaterial.emissiveIntensity=e}},{key:"getShininess",value:function(){return this.mInternalMaterial.shininess}},{key:"setShininess",value:function(e){this.mInternalMaterial.shininess=e}},{key:"getIOR",value:function(){return this.mInternalMaterial.refractionRatio}},{key:"setIOR",value:function(e){this.mInternalMaterial.refractionRatio=e}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fog}},{key:"setFog",value:function(e){this.mInternalMaterial.fog=e}},{key:"getDepthTest",value:function(){return this.mInternalMaterial.depthTest}},{key:"setDepthTest",value:function(e){this.mInternalMaterial.depthTest=e}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.depthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.depthWrite=e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.opacity}},{key:"setOpacity",value:function(e){this.mInternalMaterial.opacity=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaTest}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaTest=e}},{key:"getTransparent",value:function(){return this.mInternalMaterial.transparent}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparent=e}},{key:"getAlphaMode",value:function(){return fw(this.mInternalMaterial.blending,this.mInternalMaterial.blendSrc,this.mInternalMaterial.blendDst,this.mInternalMaterial.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha)}},{key:"setAlphaMode",value:function(e){var t=pw(e);this.mInternalMaterial.blending=t.blending,this.mInternalMaterial.blendSrc=t.blendSrc,this.mInternalMaterial.blendDst=t.blendDst,this.mInternalMaterial.blendSrcAlpha=t.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha=t.blendDstAlpha}},{key:"getPremultipliedAlpha",value:function(){return this.mInternalMaterial.premultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mInternalMaterial.premultipliedAlpha=e}},{key:"getColorWrite",value:function(){return this.mInternalMaterial.colorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.colorWrite=e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return this.mInternalMaterial.wireframeLinewidth}},{key:"setWireframeLineWidth",value:function(e){this.mInternalMaterial.wireframeLinewidth=e}},{key:"getFreeze",value:function(){return this.mFreeze}},{key:"setFreeze",value:function(e){this.mFreeze=e}},{key:"getSide",value:function(){return lw(this.mInternalMaterial.side)}},{key:"setSide",value:function(e){this.mInternalMaterial.side=hw(e)}},{key:"getFlatShading",value:function(){return this.mInternalMaterial.flatShading}},{key:"setFlatShading",value:function(e){this.mInternalMaterial.flatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.userData}},{key:"setMetaData",value:function(e){this.mInternalMaterial.userData=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,this.mInternalMaterial.needsUpdate=e}},{key:"dispose",value:function(){this.mInternalMaterial.dispose()}},{key:"cloneMaterial",value:function(){return new n(this.getName()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){return this.mDiffuseColor.copy(e.mDiffuseColor),this.mEmissiveColor.copy(e.mEmissiveColor),this.mSpecularColor.copy(e.mSpecularColor),this.mEnvMapIntensity=e.mEnvMapIntensity,this.mNormalScale.copy(e.mNormalScale),this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mBumpMap=e.mBumpMap,this.mNormalMap=e.mNormalMap,this.mDisplacementMap=e.mDisplacementMap,this.mSpecularMap=e.mSpecularMap,this.mLightMap=e.mLightMap,this.mEnvMap=e.mEnvMap,this.mEmissiveMap=e.mEmissiveMap,this.mFreeze=e.mFreeze,this.mDirty=e.mDirty,this.mInternalMaterial.copy(e.getInternalMaterial()),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(cs);function _w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var xw=function(e){(0,g.Z)(n,e);var t=_w(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(r),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(r),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(r),"mSpecularColor",new so(.04,.067,.067)),(0,l.Z)((0,_.Z)(r),"mFresnelDiffuseColor",so.Black()),(0,l.Z)((0,_.Z)(r),"mEnvMapIntensity",1),(0,l.Z)((0,_.Z)(r),"mEnvMapScale",D.One()),(0,l.Z)((0,_.Z)(r),"mNormalScale",D.One()),(0,l.Z)((0,_.Z)(r),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(r),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(r),"mAoMap",void 0),(0,l.Z)((0,_.Z)(r),"mBumpMap",void 0),(0,l.Z)((0,_.Z)(r),"mNormalMap",void 0),(0,l.Z)((0,_.Z)(r),"mDisplacementMap",void 0),(0,l.Z)((0,_.Z)(r),"mSpecularMap",void 0),(0,l.Z)((0,_.Z)(r),"mLightMap",void 0),(0,l.Z)((0,_.Z)(r),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(r),"mEmissiveMap",void 0),(0,l.Z)((0,_.Z)(r),"mFreeze",!1),(0,l.Z)((0,_.Z)(r),"mDirty",!1),r.mInternalMaterial=new THREE.MeshPhongMaterialExt({name:e}),r.mInternalMaterial.userData={},r}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.color.setRGB(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.map=e?e.getInternalTexture():null}},{key:"useAlphaFromDiffuseMap",value:function(e){}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.alphaMap=e?e.getInternalTexture():null}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.aoMap=e?e.getInternalTexture():null}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.aoMapIntensity}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.aoMapIntensity=e}},{key:"getBumpMap",value:function(){return this.mBumpMap}},{key:"setBumpMap",value:function(e){this.mBumpMap=e,this.mInternalMaterial.bumpMap=e?e.getInternalTexture():null}},{key:"getBumpScale",value:function(){return this.mInternalMaterial.bumpScale}},{key:"setBumpScale",value:function(e){this.mInternalMaterial.bumpScale=e}},{key:"getNormalMap",value:function(){return this.mNormalMap}},{key:"setNormalMap",value:function(e){this.mNormalMap=e,this.mInternalMaterial.normalMap=e?e.getInternalTexture():null}},{key:"getNormalScale",value:function(){return this.mNormalScale}},{key:"setNormalScale",value:function(e){this.mNormalScale.copy(e),this.mInternalMaterial.normalScale.set(this.mNormalScale.x,this.mNormalScale.y)}},{key:"getDisplacementMap",value:function(){return this.mDisplacementMap}},{key:"setDisplacementMap",value:function(e){this.mDisplacementMap=e,this.mInternalMaterial.displacementMap=e?e.getInternalTexture():null}},{key:"getDisplacementScale",value:function(){return this.mInternalMaterial.displacementScale}},{key:"setDisplacementScale",value:function(e){this.mInternalMaterial.displacementScale=e}},{key:"getDisplacementBias",value:function(){return this.mInternalMaterial.displacementBias}},{key:"setDisplacementBias",value:function(e){this.mInternalMaterial.displacementBias=e}},{key:"getReflectivity",value:function(){return this.mInternalMaterial.reflectivity}},{key:"setReflectivity",value:function(e){this.mInternalMaterial.reflectivity=e}},{key:"getSpecular",value:function(){return this.mSpecularColor}},{key:"setSpecular",value:function(e){this.mSpecularColor.copy(e),this.mInternalMaterial.specular.setRGB(this.mSpecularColor.r,this.mSpecularColor.g,this.mSpecularColor.b)}},{key:"getSpecularMap",value:function(){return this.mSpecularMap}},{key:"setSpecularMap",value:function(e){this.mSpecularMap=e,this.mInternalMaterial.specularMap=e?e.getInternalTexture():null}},{key:"getLightMap",value:function(){return this.mLightMap}},{key:"setLightMap",value:function(e){this.mLightMap=e,this.mInternalMaterial.lightMap=e?e.getInternalTexture():null}},{key:"getLightMapIntensity",value:function(){return this.mInternalMaterial.lightMapIntensity}},{key:"setLightMapIntensity",value:function(e){this.mInternalMaterial.lightMapIntensity=e}},{key:"getEnvMap",value:function(){return this.mEnvMap}},{key:"setEnvMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.envMap=e?e.getInternalTexture():null}},{key:"getEnvMapCombine",value:function(){return mw(this.mInternalMaterial.combine)}},{key:"setEnvMapCombine",value:function(e){this.mInternalMaterial.combine=dw(e)}},{key:"getEnvMapIntensity",value:function(){return this.mEnvMapIntensity}},{key:"setEnvMapIntensity",value:function(e){this.mEnvMapIntensity=e}},{key:"getEmissiveColor",value:function(){return this.mEmissiveColor}},{key:"setEmissiveColor",value:function(e){this.mEmissiveColor.copy(e),this.mInternalMaterial.emissive.setRGB(this.mEmissiveColor.r,this.mEmissiveColor.g,this.mEmissiveColor.b)}},{key:"getEmissiveMap",value:function(){return this.mEmissiveMap}},{key:"setEmissiveMap",value:function(e){this.mEmissiveMap=e,this.mInternalMaterial.emissiveMap=e?e.getInternalTexture():null}},{key:"getEmissiveIntensity",value:function(){return this.mInternalMaterial.emissiveIntensity}},{key:"setEmissiveIntensity",value:function(e){this.mInternalMaterial.emissiveIntensity=e}},{key:"getShininess",value:function(){return this.mInternalMaterial.shininess}},{key:"setShininess",value:function(e){this.mInternalMaterial.shininess=e}},{key:"getIOR",value:function(){return this.mInternalMaterial.refractionRatio}},{key:"setIOR",value:function(e){this.mInternalMaterial.refractionRatio=e}},{key:"getEnvMapScale",value:function(){return this.mEnvMapScale}},{key:"setEnvMapScale",value:function(e){this.mEnvMapScale.copy(e),this.mInternalMaterial.envMapScale=this.mEnvMapScale.x}},{key:"isFresnelDiffuseEnabled",value:function(){return this.mInternalMaterial.enableFresnelDiff}},{key:"setFresnelDiffuseEnabled",value:function(e){this.mInternalMaterial.enableFresnelDiff=e}},{key:"getFresnelDiffuseBias",value:function(){return this.mInternalMaterial.fresnelDiffBias}},{key:"setFresnelDiffuseBias",value:function(e){this.mInternalMaterial.fresnelDiffBias=e}},{key:"getFresnelDiffuseScale",value:function(){return this.mInternalMaterial.fresnelDiffScale}},{key:"setFresnelDiffuseScale",value:function(e){this.mInternalMaterial.fresnelDiffScale=e}},{key:"getFresnelDiffusePower",value:function(){return this.mInternalMaterial.fresnelDiffPower}},{key:"setFresnelDiffusePower",value:function(e){this.mInternalMaterial.fresnelDiffPower=e}},{key:"getFresnelDiffuseColor",value:function(){return this.mFresnelDiffuseColor}},{key:"setFresnelDiffuseColor",value:function(e){this.mFresnelDiffuseColor.copy(e),this.mInternalMaterial.fresnelDiffColorLeft=new THREE.Color(this.mFresnelDiffuseColor.r,this.mFresnelDiffuseColor.g,this.mFresnelDiffuseColor.b)}},{key:"isFresnelEnvMapEnabled",value:function(){return this.mInternalMaterial.enableFresnelEnv}},{key:"setFresnelEnvMapEnabled",value:function(e){this.mInternalMaterial.enableFresnelEnv=e}},{key:"getFresnelEnvMapBias",value:function(){return this.mInternalMaterial.fresnelEnvBias}},{key:"setFresnelEnvMapBias",value:function(e){this.mInternalMaterial.fresnelEnvBias=e}},{key:"getFresnelEnvMapScale",value:function(){return this.mInternalMaterial.fresnelEnvScale}},{key:"setFresnelEnvMapScale",value:function(e){this.mInternalMaterial.fresnelEnvScale=e}},{key:"getFresnelEnvMapPower",value:function(){return this.mInternalMaterial.fresnelEnvPower}},{key:"setFresnelEnvMapPower",value:function(e){this.mInternalMaterial.fresnelEnvPower=e}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fog}},{key:"setFog",value:function(e){this.mInternalMaterial.fog=e}},{key:"getDepthTest",value:function(){return this.mInternalMaterial.depthTest}},{key:"setDepthTest",value:function(e){this.mInternalMaterial.depthTest=e}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.depthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.depthWrite=e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.opacity}},{key:"setOpacity",value:function(e){this.mInternalMaterial.opacity=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaTest}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaTest=e}},{key:"getTransparent",value:function(){return this.mInternalMaterial.transparent}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparent=e}},{key:"getAlphaMode",value:function(){return fw(this.mInternalMaterial.blending,this.mInternalMaterial.blendSrc,this.mInternalMaterial.blendDst,this.mInternalMaterial.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha)}},{key:"setAlphaMode",value:function(e){var t=pw(e);this.mInternalMaterial.blending=t.blending,this.mInternalMaterial.blendSrc=t.blendSrc,this.mInternalMaterial.blendDst=t.blendDst,this.mInternalMaterial.blendSrcAlpha=t.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha=t.blendDstAlpha}},{key:"getPremultipliedAlpha",value:function(){return this.mInternalMaterial.premultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mInternalMaterial.premultipliedAlpha=e}},{key:"getColorWrite",value:function(){return this.mInternalMaterial.colorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.colorWrite=e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return this.mInternalMaterial.wireframeLinewidth}},{key:"setWireframeLineWidth",value:function(e){this.mInternalMaterial.wireframeLinewidth=e}},{key:"getFreeze",value:function(){return this.mFreeze}},{key:"setFreeze",value:function(e){this.mFreeze=e}},{key:"getSide",value:function(){return lw(this.mInternalMaterial.side)}},{key:"setSide",value:function(e){this.mInternalMaterial.side=hw(e)}},{key:"getFlatShading",value:function(){return this.mInternalMaterial.flatShading}},{key:"setFlatShading",value:function(e){this.mInternalMaterial.flatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.userData}},{key:"setMetaData",value:function(e){this.mInternalMaterial.userData=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,this.mInternalMaterial.needsUpdate=e}},{key:"dispose",value:function(){this.mInternalMaterial.dispose()}},{key:"cloneMaterial",value:function(){return new n(this.getName()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){return this.mDiffuseColor.copy(e.mDiffuseColor),this.mEmissiveColor.copy(e.mEmissiveColor),this.mSpecularColor.copy(e.mSpecularColor),this.mFresnelDiffuseColor.copy(e.mFresnelDiffuseColor),this.mEnvMapIntensity=e.mEnvMapIntensity,this.mEnvMapScale.copy(e.mEnvMapScale),this.mNormalScale.copy(e.mNormalScale),this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mBumpMap=e.mBumpMap,this.mNormalMap=e.mNormalMap,this.mDisplacementMap=e.mDisplacementMap,this.mSpecularMap=e.mSpecularMap,this.mLightMap=e.mLightMap,this.mEnvMap=e.mEnvMap,this.mEmissiveMap=e.mEmissiveMap,this.mFreeze=e.mFreeze,this.mDirty=e.mDirty,this.mInternalMaterial.copy(e.getInternalMaterial()),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(hs);function Tw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var ww=function(e){(0,g.Z)(n,e);var t=Tw(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(r),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(r),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(r),"mNormalScale",D.One()),(0,l.Z)((0,_.Z)(r),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(r),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(r),"mAoMap",void 0),(0,l.Z)((0,_.Z)(r),"mBumpMap",void 0),(0,l.Z)((0,_.Z)(r),"mNormalMap",void 0),(0,l.Z)((0,_.Z)(r),"mDisplacementMap",void 0),(0,l.Z)((0,_.Z)(r),"mLightMap",void 0),(0,l.Z)((0,_.Z)(r),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(r),"mEmissiveMap",void 0),(0,l.Z)((0,_.Z)(r),"mRoughnessMap",void 0),(0,l.Z)((0,_.Z)(r),"mMetalnessMap",void 0),(0,l.Z)((0,_.Z)(r),"mFreeze",!1),(0,l.Z)((0,_.Z)(r),"mDirty",!1),r.mInternalMaterial=new THREE.MeshStandardMaterial({name:e}),r.mInternalMaterial.userData={},r}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.color.setRGB(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.map=e?e.getInternalTexture():null}},{key:"useAlphaFromDiffuseMap",value:function(e){}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.alphaMap=e?e.getInternalTexture():null}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.aoMap=e?e.getInternalTexture():null}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.aoMapIntensity}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.aoMapIntensity=e}},{key:"getBumpMap",value:function(){return this.mBumpMap}},{key:"setBumpMap",value:function(e){this.mBumpMap=e,this.mInternalMaterial.bumpMap=e?e.getInternalTexture():null}},{key:"getBumpScale",value:function(){return this.mInternalMaterial.bumpScale}},{key:"setBumpScale",value:function(e){this.mInternalMaterial.bumpScale=e}},{key:"getNormalMap",value:function(){return this.mNormalMap}},{key:"setNormalMap",value:function(e){this.mNormalMap=e,this.mInternalMaterial.normalMap=e?e.getInternalTexture():null}},{key:"getNormalScale",value:function(){return this.mNormalScale}},{key:"setNormalScale",value:function(e){this.mNormalScale.copy(e),this.mInternalMaterial.normalScale.set(this.mNormalScale.x,this.mNormalScale.y)}},{key:"getDisplacementMap",value:function(){return this.mDisplacementMap}},{key:"setDisplacementMap",value:function(e){this.mDisplacementMap=e,this.mInternalMaterial.displacementMap=e?e.getInternalTexture():null}},{key:"getDisplacementScale",value:function(){return this.mInternalMaterial.displacementScale}},{key:"setDisplacementScale",value:function(e){this.mInternalMaterial.displacementScale=e}},{key:"getDisplacementBias",value:function(){return this.mInternalMaterial.displacementBias}},{key:"setDisplacementBias",value:function(e){this.mInternalMaterial.displacementBias=e}},{key:"getLightMap",value:function(){return this.mLightMap}},{key:"setLightMap",value:function(e){this.mLightMap=e,this.mInternalMaterial.lightMap=e?e.getInternalTexture():null}},{key:"getLightMapIntensity",value:function(){return this.mInternalMaterial.lightMapIntensity}},{key:"setLightMapIntensity",value:function(e){this.mInternalMaterial.lightMapIntensity=e}},{key:"getEnvMap",value:function(){return this.mEnvMap}},{key:"setEnvMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.envMap=e?e.getInternalTexture():null}},{key:"getEnvMapIntensity",value:function(){return this.mInternalMaterial.envMapIntensity}},{key:"setEnvMapIntensity",value:function(e){this.mInternalMaterial.envMapIntensity=e}},{key:"getEmissiveColor",value:function(){return this.mEmissiveColor}},{key:"setEmissiveColor",value:function(e){this.mEmissiveColor.copy(e),this.mInternalMaterial.emissive.setRGB(this.mEmissiveColor.r,this.mEmissiveColor.g,this.mEmissiveColor.b)}},{key:"getEmissiveMap",value:function(){return this.mEmissiveMap}},{key:"setEmissiveMap",value:function(e){this.mEmissiveMap=e,this.mInternalMaterial.emissiveMap=e?e.getInternalTexture():null}},{key:"getEmissiveIntensity",value:function(){return this.mInternalMaterial.emissiveIntensity}},{key:"setEmissiveIntensity",value:function(e){this.mInternalMaterial.emissiveIntensity=e}},{key:"getIOR",value:function(){return this.mInternalMaterial.refractionRatio}},{key:"setIOR",value:function(e){this.mInternalMaterial.refractionRatio=e}},{key:"getMetalness",value:function(){return this.mInternalMaterial.metalness}},{key:"setMetalness",value:function(e){this.mInternalMaterial.metalness=e}},{key:"getMetalnessMap",value:function(){return this.mMetalnessMap}},{key:"setMetalnessMap",value:function(e){this.mMetalnessMap=e,this.mInternalMaterial.metalnessMap=e?e.getInternalTexture():null}},{key:"getRoughness",value:function(){return this.mInternalMaterial.roughness}},{key:"setRoughness",value:function(e){this.mInternalMaterial.roughness=e}},{key:"getRoughnessMap",value:function(){return this.mRoughnessMap}},{key:"setRoughnessMap",value:function(e){this.mRoughnessMap=e,this.mInternalMaterial.roughnessMap=e?e.getInternalTexture():null}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fog}},{key:"setFog",value:function(e){this.mInternalMaterial.fog=e}},{key:"getDepthTest",value:function(){return this.mInternalMaterial.depthTest}},{key:"setDepthTest",value:function(e){this.mInternalMaterial.depthTest=e}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.depthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.depthWrite=e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.opacity}},{key:"setOpacity",value:function(e){this.mInternalMaterial.opacity=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaTest}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaTest=e}},{key:"getTransparent",value:function(){return this.mInternalMaterial.transparent}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparent=e}},{key:"getAlphaMode",value:function(){return fw(this.mInternalMaterial.blending,this.mInternalMaterial.blendSrc,this.mInternalMaterial.blendDst,this.mInternalMaterial.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha)}},{key:"setAlphaMode",value:function(e){var t=pw(e);this.mInternalMaterial.blending=t.blending,this.mInternalMaterial.blendSrc=t.blendSrc,this.mInternalMaterial.blendDst=t.blendDst,this.mInternalMaterial.blendSrcAlpha=t.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha=t.blendDstAlpha}},{key:"getPremultipliedAlpha",value:function(){return this.mInternalMaterial.premultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mInternalMaterial.premultipliedAlpha=e}},{key:"getColorWrite",value:function(){return this.mInternalMaterial.colorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.colorWrite=e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return this.mInternalMaterial.wireframeLinewidth}},{key:"setWireframeLineWidth",value:function(e){this.mInternalMaterial.wireframeLinewidth=e}},{key:"getFreeze",value:function(){return this.mFreeze}},{key:"setFreeze",value:function(e){this.mFreeze=e}},{key:"getSide",value:function(){return lw(this.mInternalMaterial.side)}},{key:"setSide",value:function(e){this.mInternalMaterial.side=hw(e)}},{key:"getFlatShading",value:function(){return this.mInternalMaterial.flatShading}},{key:"setFlatShading",value:function(e){this.mInternalMaterial.flatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.userData}},{key:"setMetaData",value:function(e){this.mInternalMaterial.userData=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,this.mInternalMaterial.needsUpdate=e}},{key:"dispose",value:function(){this.mInternalMaterial.dispose()}},{key:"cloneMaterial",value:function(){return new n(this.getName()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){return this.mDiffuseColor.copy(e.mDiffuseColor),this.mEmissiveColor.copy(e.mEmissiveColor),this.mNormalScale.copy(e.mNormalScale),this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mBumpMap=e.mBumpMap,this.mNormalMap=e.mNormalMap,this.mDisplacementMap=e.mDisplacementMap,this.mLightMap=e.mLightMap,this.mEnvMap=e.mEnvMap,this.mEmissiveMap=e.mEmissiveMap,this.mRoughnessMap=e.mRoughnessMap,this.mMetalnessMap=e.mMetalnessMap,this.mFreeze=e.mFreeze,this.mDirty=e.mDirty,this.mInternalMaterial.copy(e.getInternalMaterial()),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(ps);function Rw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Zw=function(e){(0,g.Z)(n,e);var t=Rw(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(r),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(r),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(r),"mEnvMapScale",D.One()),(0,l.Z)((0,_.Z)(r),"mNormalScale",D.One()),(0,l.Z)((0,_.Z)(r),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(r),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(r),"mAoMap",void 0),(0,l.Z)((0,_.Z)(r),"mBumpMap",void 0),(0,l.Z)((0,_.Z)(r),"mNormalMap",void 0),(0,l.Z)((0,_.Z)(r),"mDisplacementMap",void 0),(0,l.Z)((0,_.Z)(r),"mLightMap",void 0),(0,l.Z)((0,_.Z)(r),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(r),"mEmissiveMap",void 0),(0,l.Z)((0,_.Z)(r),"mRoughnessMap",void 0),(0,l.Z)((0,_.Z)(r),"mMetalnessMap",void 0),(0,l.Z)((0,_.Z)(r),"mFreeze",!1),(0,l.Z)((0,_.Z)(r),"mDirty",!1),r.mInternalMaterial=new THREE.MeshPhysicalMaterial({name:e}),r.mInternalMaterial.userData={},r}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.color.setRGB(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.map=e?e.getInternalTexture():null}},{key:"useAlphaFromDiffuseMap",value:function(e){}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.alphaMap=e?e.getInternalTexture():null}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.aoMap=e?e.getInternalTexture():null}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.aoMapIntensity}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.aoMapIntensity=e}},{key:"getBumpMap",value:function(){return this.mBumpMap}},{key:"setBumpMap",value:function(e){this.mBumpMap=e,this.mInternalMaterial.bumpMap=e?e.getInternalTexture():null}},{key:"getBumpScale",value:function(){return this.mInternalMaterial.bumpScale}},{key:"setBumpScale",value:function(e){this.mInternalMaterial.bumpScale=e}},{key:"getNormalMap",value:function(){return this.mNormalMap}},{key:"setNormalMap",value:function(e){this.mNormalMap=e,this.mInternalMaterial.normalMap=e?e.getInternalTexture():null}},{key:"getNormalScale",value:function(){return this.mNormalScale}},{key:"setNormalScale",value:function(e){this.mNormalScale.copy(e),this.mInternalMaterial.normalScale.set(this.mNormalScale.x,this.mNormalScale.y)}},{key:"getDisplacementMap",value:function(){return this.mDisplacementMap}},{key:"setDisplacementMap",value:function(e){this.mDisplacementMap=e,this.mInternalMaterial.displacementMap=e?e.getInternalTexture():null}},{key:"getDisplacementScale",value:function(){return this.mInternalMaterial.displacementScale}},{key:"setDisplacementScale",value:function(e){this.mInternalMaterial.displacementScale=e}},{key:"getDisplacementBias",value:function(){return this.mInternalMaterial.displacementBias}},{key:"setDisplacementBias",value:function(e){this.mInternalMaterial.displacementBias=e}},{key:"getReflectivity",value:function(){return this.mInternalMaterial.reflectivity}},{key:"setReflectivity",value:function(e){this.mInternalMaterial.reflectivity=e}},{key:"getLightMap",value:function(){return this.mLightMap}},{key:"setLightMap",value:function(e){this.mLightMap=e,this.mInternalMaterial.lightMap=e?e.getInternalTexture():null}},{key:"getLightMapIntensity",value:function(){return this.mInternalMaterial.lightMapIntensity}},{key:"setLightMapIntensity",value:function(e){this.mInternalMaterial.lightMapIntensity=e}},{key:"getEnvMap",value:function(){return this.mEnvMap}},{key:"setEnvMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.envMap=e?e.getInternalTexture():null}},{key:"getEnvMapIntensity",value:function(){return this.mInternalMaterial.envMapIntensity}},{key:"setEnvMapIntensity",value:function(e){this.mInternalMaterial.envMapIntensity=e}},{key:"getEmissiveColor",value:function(){return this.mEmissiveColor}},{key:"setEmissiveColor",value:function(e){this.mEmissiveColor.copy(e),this.mInternalMaterial.emissive.setRGB(this.mEmissiveColor.r,this.mEmissiveColor.g,this.mEmissiveColor.b)}},{key:"getEmissiveMap",value:function(){return this.mEmissiveMap}},{key:"setEmissiveMap",value:function(e){this.mEmissiveMap=e,this.mInternalMaterial.emissiveMap=e?e.getInternalTexture():null}},{key:"getEmissiveIntensity",value:function(){return this.mInternalMaterial.emissiveIntensity}},{key:"setEmissiveIntensity",value:function(e){this.mInternalMaterial.emissiveIntensity=e}},{key:"getClearCoat",value:function(){return this.mInternalMaterial.clearCoat}},{key:"setClearCoat",value:function(e){this.mInternalMaterial.clearCoat=e}},{key:"getClearCoatRoughness",value:function(){return this.mInternalMaterial.clearCoatRoughness}},{key:"setClearCoatRoughness",value:function(e){this.mInternalMaterial.clearCoatRoughness=e}},{key:"getMetalness",value:function(){return this.mInternalMaterial.metalness}},{key:"setMetalness",value:function(e){this.mInternalMaterial.metalness=e}},{key:"getMetalnessMap",value:function(){return this.mMetalnessMap}},{key:"setMetalnessMap",value:function(e){this.mMetalnessMap=e,this.mInternalMaterial.metalnessMap=e?e.getInternalTexture():null}},{key:"getIOR",value:function(){return this.mInternalMaterial.refractionRatio}},{key:"setIOR",value:function(e){this.mInternalMaterial.refractionRatio=e}},{key:"getRoughness",value:function(){return this.mInternalMaterial.roughness}},{key:"setRoughness",value:function(e){this.mInternalMaterial.roughness=e}},{key:"getRoughnessMap",value:function(){return this.mRoughnessMap}},{key:"setRoughnessMap",value:function(e){this.mRoughnessMap=e,this.mInternalMaterial.roughnessMap=e?e.getInternalTexture():null}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fog}},{key:"setFog",value:function(e){this.mInternalMaterial.fog=e}},{key:"getDepthTest",value:function(){return this.mInternalMaterial.depthTest}},{key:"setDepthTest",value:function(e){this.mInternalMaterial.depthTest=e}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.depthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.depthWrite=e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.opacity}},{key:"setOpacity",value:function(e){this.mInternalMaterial.opacity=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaTest}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaTest=e}},{key:"getTransparent",value:function(){return this.mInternalMaterial.transparent}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparent=e}},{key:"getAlphaMode",value:function(){return fw(this.mInternalMaterial.blending,this.mInternalMaterial.blendSrc,this.mInternalMaterial.blendDst,this.mInternalMaterial.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha)}},{key:"setAlphaMode",value:function(e){var t=pw(e);this.mInternalMaterial.blending=t.blending,this.mInternalMaterial.blendSrc=t.blendSrc,this.mInternalMaterial.blendDst=t.blendDst,this.mInternalMaterial.blendSrcAlpha=t.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha=t.blendDstAlpha}},{key:"getPremultipliedAlpha",value:function(){return this.mInternalMaterial.premultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mInternalMaterial.premultipliedAlpha=e}},{key:"getColorWrite",value:function(){return this.mInternalMaterial.colorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.colorWrite=e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return this.mInternalMaterial.wireframeLinewidth}},{key:"setWireframeLineWidth",value:function(e){this.mInternalMaterial.wireframeLinewidth=e}},{key:"getFreeze",value:function(){return this.mFreeze}},{key:"setFreeze",value:function(e){this.mFreeze=e}},{key:"getSide",value:function(){return lw(this.mInternalMaterial.side)}},{key:"setSide",value:function(e){this.mInternalMaterial.side=hw(e)}},{key:"getFlatShading",value:function(){return this.mInternalMaterial.flatShading}},{key:"setFlatShading",value:function(e){this.mInternalMaterial.flatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.userData}},{key:"setMetaData",value:function(e){this.mInternalMaterial.userData=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,this.mInternalMaterial.needsUpdate=e}},{key:"dispose",value:function(){this.mInternalMaterial.dispose()}},{key:"cloneMaterial",value:function(){return new n(this.getName()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){return this.mDiffuseColor.copy(e.mDiffuseColor),this.mEmissiveColor.copy(e.mEmissiveColor),this.mEnvMapScale.copy(e.mEnvMapScale),this.mNormalScale.copy(e.mNormalScale),this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mBumpMap=e.mBumpMap,this.mNormalMap=e.mNormalMap,this.mDisplacementMap=e.mDisplacementMap,this.mLightMap=e.mLightMap,this.mEnvMap=e.mEnvMap,this.mEmissiveMap=e.mEmissiveMap,this.mRoughnessMap=e.mRoughnessMap,this.mMetalnessMap=e.mMetalnessMap,this.mFreeze=e.mFreeze,this.mDirty=e.mDirty,this.mInternalMaterial.copy(e.getInternalMaterial()),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(ds);function Sw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Cw=function(e){(0,g.Z)(n,e);var t=Sw(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(r),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(r),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(r),"mSpecularColor",new so(.04,.067,.067)),(0,l.Z)((0,_.Z)(r),"mFresnelDiffuseColor",so.Black()),(0,l.Z)((0,_.Z)(r),"mEnvMapScale",D.One()),(0,l.Z)((0,_.Z)(r),"mNormalScale",D.One()),(0,l.Z)((0,_.Z)(r),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(r),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(r),"mAoMap",void 0),(0,l.Z)((0,_.Z)(r),"mBumpMap",void 0),(0,l.Z)((0,_.Z)(r),"mNormalMap",void 0),(0,l.Z)((0,_.Z)(r),"mDisplacementMap",void 0),(0,l.Z)((0,_.Z)(r),"mLightMap",void 0),(0,l.Z)((0,_.Z)(r),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(r),"mEmissiveMap",void 0),(0,l.Z)((0,_.Z)(r),"mRoughnessMap",void 0),(0,l.Z)((0,_.Z)(r),"mMetalnessMap",void 0),(0,l.Z)((0,_.Z)(r),"mSpecularMap",void 0),(0,l.Z)((0,_.Z)(r),"mGlossinessMap",void 0),(0,l.Z)((0,_.Z)(r),"mFreeze",!1),(0,l.Z)((0,_.Z)(r),"mDirty",!1),r.mInternalMaterial=new THREE.MeshPhysicalMaterialExt({name:e}),r.mInternalMaterial.userData={},r}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.color.setRGB(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.map=e?e.getInternalTexture():null}},{key:"useAlphaFromDiffuseMap",value:function(e){}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.alphaMap=e?e.getInternalTexture():null}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.aoMap=e?e.getInternalTexture():null}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.aoMapIntensity}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.aoMapIntensity=e}},{key:"getBumpMap",value:function(){return this.mBumpMap}},{key:"setBumpMap",value:function(e){this.mBumpMap=e,this.mInternalMaterial.bumpMap=e?e.getInternalTexture():null}},{key:"getBumpScale",value:function(){return this.mInternalMaterial.bumpScale}},{key:"setBumpScale",value:function(e){this.mInternalMaterial.bumpScale=e}},{key:"getNormalMap",value:function(){return this.mNormalMap}},{key:"setNormalMap",value:function(e){this.mNormalMap=e,this.mInternalMaterial.normalMap=e?e.getInternalTexture():null}},{key:"getNormalScale",value:function(){return this.mNormalScale}},{key:"setNormalScale",value:function(e){this.mNormalScale.copy(e),this.mInternalMaterial.normalScale.set(this.mNormalScale.x,this.mNormalScale.y)}},{key:"getDisplacementMap",value:function(){return this.mDisplacementMap}},{key:"setDisplacementMap",value:function(e){this.mDisplacementMap=e,this.mInternalMaterial.displacementMap=e?e.getInternalTexture():null}},{key:"getDisplacementScale",value:function(){return this.mInternalMaterial.displacementScale}},{key:"setDisplacementScale",value:function(e){this.mInternalMaterial.displacementScale=e}},{key:"getDisplacementBias",value:function(){return this.mInternalMaterial.displacementBias}},{key:"setDisplacementBias",value:function(e){this.mInternalMaterial.displacementBias=e}},{key:"getReflectivity",value:function(){return this.mInternalMaterial.reflectivity}},{key:"setReflectivity",value:function(e){this.mInternalMaterial.reflectivity=e}},{key:"getLightMap",value:function(){return this.mLightMap}},{key:"setLightMap",value:function(e){this.mLightMap=e,this.mInternalMaterial.lightMap=e?e.getInternalTexture():null}},{key:"getLightMapIntensity",value:function(){return this.mInternalMaterial.lightMapIntensity}},{key:"setLightMapIntensity",value:function(e){this.mInternalMaterial.lightMapIntensity=e}},{key:"getEnvMap",value:function(){return this.mEnvMap}},{key:"setEnvMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.envMap=e?e.getInternalTexture():null}},{key:"getEnvMapIntensity",value:function(){return this.mInternalMaterial.envMapIntensity}},{key:"setEnvMapIntensity",value:function(e){this.mInternalMaterial.envMapIntensity=e}},{key:"getEmissiveColor",value:function(){return this.mEmissiveColor}},{key:"setEmissiveColor",value:function(e){this.mEmissiveColor.copy(e),this.mInternalMaterial.emissive=new THREE.Color(this.mEmissiveColor.r,this.mEmissiveColor.g,this.mEmissiveColor.b)}},{key:"getEmissiveMap",value:function(){return this.mEmissiveMap}},{key:"setEmissiveMap",value:function(e){this.mEmissiveMap=e,this.mInternalMaterial.emissiveMap=e?e.getInternalTexture():null}},{key:"getEmissiveIntensity",value:function(){return this.mInternalMaterial.emissiveIntensity}},{key:"setEmissiveIntensity",value:function(e){this.mInternalMaterial.emissiveIntensity=e}},{key:"getClearCoat",value:function(){return this.mInternalMaterial.clearCoat}},{key:"setClearCoat",value:function(e){this.mInternalMaterial.clearCoat=e}},{key:"getClearCoatRoughness",value:function(){return this.mInternalMaterial.clearCoatRoughness}},{key:"setClearCoatRoughness",value:function(e){this.mInternalMaterial.clearCoatRoughness=e}},{key:"getMetalness",value:function(){return this.mInternalMaterial.metalness}},{key:"setMetalness",value:function(e){this.mInternalMaterial.metalness=e}},{key:"getMetalnessMap",value:function(){return this.mMetalnessMap}},{key:"setMetalnessMap",value:function(e){this.mMetalnessMap=e,this.mInternalMaterial.metalnessMap=e?e.getInternalTexture():null}},{key:"getIOR",value:function(){return this.mInternalMaterial.refractionRatio}},{key:"setIOR",value:function(e){this.mInternalMaterial.refractionRatio=e}},{key:"getRoughness",value:function(){return this.mInternalMaterial.roughness}},{key:"setRoughness",value:function(e){this.mInternalMaterial.roughness=e}},{key:"getRoughnessMap",value:function(){return this.mRoughnessMap}},{key:"setRoughnessMap",value:function(e){this.mRoughnessMap=e,this.mInternalMaterial.roughnessMap=e?e.getInternalTexture():null}},{key:"getEnvMapScale",value:function(){return this.mEnvMapScale}},{key:"setEnvMapScale",value:function(e){this.mEnvMapScale.copy(e),this.mInternalMaterial.envMapScale=this.mEnvMapScale.x}},{key:"isSpecularGlossinessEnabled",value:function(){return this.mInternalMaterial.enableSpecularGlossiness}},{key:"setSpecularGlossinessEnabled",value:function(e){this.mInternalMaterial.enableSpecularGlossiness=e}},{key:"getSpecular",value:function(){return this.mSpecularColor}},{key:"setSpecular",value:function(e){this.mSpecularColor.copy(e),this.mInternalMaterial.specular.setRGB(this.mSpecularColor.r,this.mSpecularColor.g,this.mSpecularColor.b)}},{key:"getSpecularMap",value:function(){return this.mSpecularMap}},{key:"setSpecularMap",value:function(e){this.mSpecularMap=e,this.mInternalMaterial.specularMap=e?e.getInternalTexture():null}},{key:"getGlossiness",value:function(){return this.mInternalMaterial.glossiness}},{key:"setGlossiness",value:function(e){this.mInternalMaterial.glossiness=e}},{key:"getGlossinessMap",value:function(){return this.mGlossinessMap}},{key:"setGlossinessMap",value:function(e){this.mGlossinessMap=e,this.mInternalMaterial.glossinessMap=e?e.getInternalTexture():null}},{key:"isFresnelDiffuseEnabled",value:function(){return this.mInternalMaterial.enableFresnelDiff}},{key:"setFresnelDiffuseEnabled",value:function(e){this.mInternalMaterial.enableFresnelDiff=e}},{key:"getFresnelDiffuseBias",value:function(){return this.mInternalMaterial.fresnelDiffBias}},{key:"setFresnelDiffuseBias",value:function(e){this.mInternalMaterial.fresnelDiffBias=e}},{key:"getFresnelDiffuseScale",value:function(){return this.mInternalMaterial.fresnelDiffScale}},{key:"setFresnelDiffuseScale",value:function(e){this.mInternalMaterial.fresnelDiffScale=e}},{key:"getFresnelDiffusePower",value:function(){return this.mInternalMaterial.fresnelDiffPower}},{key:"setFresnelDiffusePower",value:function(e){this.mInternalMaterial.fresnelDiffPower=e}},{key:"getFresnelDiffuseColor",value:function(){return this.mFresnelDiffuseColor}},{key:"setFresnelDiffuseColor",value:function(e){this.mFresnelDiffuseColor.copy(e),this.mInternalMaterial.fresnelDiffColorLeft=new THREE.Color(this.mFresnelDiffuseColor.r,this.mFresnelDiffuseColor.g,this.mFresnelDiffuseColor.b)}},{key:"isFresnelEnvMapEnabled",value:function(){return this.mInternalMaterial.enableFresnelEnv}},{key:"setFresnelEnvMapEnabled",value:function(e){this.mInternalMaterial.enableFresnelEnv=e}},{key:"getFresnelEnvMapBias",value:function(){return this.mInternalMaterial.fresnelEnvBias}},{key:"setFresnelEnvMapBias",value:function(e){this.mInternalMaterial.fresnelEnvBias=e}},{key:"getFresnelEnvMapScale",value:function(){return this.mInternalMaterial.fresnelEnvScale}},{key:"setFresnelEnvMapScale",value:function(e){this.mInternalMaterial.fresnelEnvScale=e}},{key:"getFresnelEnvMapPower",value:function(){return this.mInternalMaterial.fresnelEnvPower}},{key:"setFresnelEnvMapPower",value:function(e){this.mInternalMaterial.fresnelEnvPower=e}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fog}},{key:"setFog",value:function(e){this.mInternalMaterial.fog=e}},{key:"getDepthTest",value:function(){return this.mInternalMaterial.depthTest}},{key:"setDepthTest",value:function(e){this.mInternalMaterial.depthTest=e}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.depthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.depthWrite=e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.opacity}},{key:"setOpacity",value:function(e){this.mInternalMaterial.opacity=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaTest}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaTest=e}},{key:"getTransparent",value:function(){return this.mInternalMaterial.transparent}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparent=e}},{key:"getAlphaMode",value:function(){return fw(this.mInternalMaterial.blending,this.mInternalMaterial.blendSrc,this.mInternalMaterial.blendDst,this.mInternalMaterial.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha)}},{key:"setAlphaMode",value:function(e){var t=pw(e);this.mInternalMaterial.blending=t.blending,this.mInternalMaterial.blendSrc=t.blendSrc,this.mInternalMaterial.blendDst=t.blendDst,this.mInternalMaterial.blendSrcAlpha=t.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha=t.blendDstAlpha}},{key:"getPremultipliedAlpha",value:function(){return this.mInternalMaterial.premultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mInternalMaterial.premultipliedAlpha=e}},{key:"getColorWrite",value:function(){return this.mInternalMaterial.colorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.colorWrite=e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return this.mInternalMaterial.wireframeLinewidth}},{key:"setWireframeLineWidth",value:function(e){this.mInternalMaterial.wireframeLinewidth=e}},{key:"getFreeze",value:function(){return this.mFreeze}},{key:"setFreeze",value:function(e){this.mFreeze=e}},{key:"getSide",value:function(){return lw(this.mInternalMaterial.side)}},{key:"setSide",value:function(e){this.mInternalMaterial.side=hw(e)}},{key:"getFlatShading",value:function(){return this.mInternalMaterial.flatShading}},{key:"setFlatShading",value:function(e){this.mInternalMaterial.flatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.userData}},{key:"setMetaData",value:function(e){this.mInternalMaterial.userData=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,this.mInternalMaterial.needsUpdate=e}},{key:"dispose",value:function(){this.mInternalMaterial.dispose()}},{key:"cloneMaterial",value:function(){return new n(this.getName()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){return this.mDiffuseColor.copy(e.mDiffuseColor),this.mEmissiveColor.copy(e.mEmissiveColor),this.mSpecularColor.copy(e.mSpecularColor),this.mFresnelDiffuseColor.copy(e.mFresnelDiffuseColor),this.mEnvMapScale.copy(e.mEnvMapScale),this.mNormalScale.copy(e.mNormalScale),this.mDiffuseMap=e.mDiffuseMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mBumpMap=e.mBumpMap,this.mNormalMap=e.mNormalMap,this.mDisplacementMap=e.mDisplacementMap,this.mLightMap=e.mLightMap,this.mEnvMap=e.mEnvMap,this.mEmissiveMap=e.mEmissiveMap,this.mRoughnessMap=e.mRoughnessMap,this.mMetalnessMap=e.mMetalnessMap,this.mSpecularMap=e.mSpecularMap,this.mGlossinessMap=e.mGlossinessMap,this.mFreeze=e.mFreeze,this.mDirty=e.mDirty,this.mInternalMaterial.copy(e.getInternalMaterial()),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(ys);function Iw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ew=function(e){(0,g.Z)(n,e);var t=Iw(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(r),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(r),"mFreeze",!1),(0,l.Z)((0,_.Z)(r),"mDirty",!1),(0,l.Z)((0,_.Z)(r),"mWireframe",!1),(0,l.Z)((0,_.Z)(r),"mWireframeLinewidth",1),r.mInternalMaterial=new THREE.LineBasicMaterial({name:e,linewidth:1,linecap:"round",linejoin:"round"}),r.mInternalMaterial.userData={},r}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.color.setRGB(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fog}},{key:"setFog",value:function(e){this.mInternalMaterial.fog=e}},{key:"getDepthTest",value:function(){return this.mInternalMaterial.depthTest}},{key:"setDepthTest",value:function(e){this.mInternalMaterial.depthTest=e}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.depthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.depthWrite=e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.opacity}},{key:"setOpacity",value:function(e){this.mInternalMaterial.opacity=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaTest}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaTest=e}},{key:"getTransparent",value:function(){return this.mInternalMaterial.transparent}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparent=e}},{key:"getAlphaMode",value:function(){return fw(this.mInternalMaterial.blending,this.mInternalMaterial.blendSrc,this.mInternalMaterial.blendDst,this.mInternalMaterial.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha)}},{key:"setAlphaMode",value:function(e){var t=pw(e);this.mInternalMaterial.blending=t.blending,this.mInternalMaterial.blendSrc=t.blendSrc,this.mInternalMaterial.blendDst=t.blendDst,this.mInternalMaterial.blendSrcAlpha=t.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha=t.blendDstAlpha}},{key:"getPremultipliedAlpha",value:function(){return this.mInternalMaterial.premultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mInternalMaterial.premultipliedAlpha=e}},{key:"getColorWrite",value:function(){return this.mInternalMaterial.colorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.colorWrite=e}},{key:"getWireframe",value:function(){return this.mWireframe}},{key:"setWireframe",value:function(e){this.mWireframe=e}},{key:"getWireframeLineWidth",value:function(){return this.mWireframeLinewidth}},{key:"setWireframeLineWidth",value:function(e){this.mWireframeLinewidth=e}},{key:"getFreeze",value:function(){return this.mFreeze}},{key:"setFreeze",value:function(e){this.mFreeze=e}},{key:"getSide",value:function(){return lw(this.mInternalMaterial.side)}},{key:"setSide",value:function(e){this.mInternalMaterial.side=hw(e)}},{key:"getFlatShading",value:function(){return this.mInternalMaterial.flatShading}},{key:"setFlatShading",value:function(e){this.mInternalMaterial.flatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.userData}},{key:"setMetaData",value:function(e){this.mInternalMaterial.userData=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,this.mInternalMaterial.needsUpdate=e}},{key:"dispose",value:function(){this.mInternalMaterial.dispose()}},{key:"cloneMaterial",value:function(){return new n(this.getName()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){return this.mDiffuseColor.copy(e.mDiffuseColor),this.mFreeze=e.mFreeze,this.mDirty=e.mDirty,this.mWireframe=e.mWireframe,this.mWireframeLinewidth=e.mWireframeLinewidth,this.mInternalMaterial.copy(e.getInternalMaterial()),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(Ds);function Aw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Ow=function(e){(0,g.Z)(n,e);var t=Aw(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(r),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(r),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(r),"mFreeze",!1),(0,l.Z)((0,_.Z)(r),"mDirty",!1),r.mInternalMaterial=new THREE.MeshBasicMaterial({name:e}),r.mInternalMaterial.userData={},r}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.color.setRGB(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.map=e?e.getInternalTexture():null}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fog}},{key:"setFog",value:function(e){this.mInternalMaterial.fog=e}},{key:"getDepthTest",value:function(){return this.mInternalMaterial.depthTest}},{key:"setDepthTest",value:function(e){this.mInternalMaterial.depthTest=e}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.depthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.depthWrite=e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.opacity}},{key:"setOpacity",value:function(e){this.mInternalMaterial.opacity=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaTest}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaTest=e}},{key:"getTransparent",value:function(){return this.mInternalMaterial.transparent}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparent=e}},{key:"getAlphaMode",value:function(){return fw(this.mInternalMaterial.blending,this.mInternalMaterial.blendSrc,this.mInternalMaterial.blendDst,this.mInternalMaterial.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha)}},{key:"setAlphaMode",value:function(e){var t=pw(e);this.mInternalMaterial.blending=t.blending,this.mInternalMaterial.blendSrc=t.blendSrc,this.mInternalMaterial.blendDst=t.blendDst,this.mInternalMaterial.blendSrcAlpha=t.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha=t.blendDstAlpha}},{key:"getPremultipliedAlpha",value:function(){return this.mInternalMaterial.premultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mInternalMaterial.premultipliedAlpha=e}},{key:"getColorWrite",value:function(){return this.mInternalMaterial.colorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.colorWrite=e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return this.mInternalMaterial.wireframeLinewidth}},{key:"setWireframeLineWidth",value:function(e){this.mInternalMaterial.wireframeLinewidth=e}},{key:"getFreeze",value:function(){return this.mFreeze}},{key:"setFreeze",value:function(e){this.mFreeze=e}},{key:"getSide",value:function(){return lw(this.mInternalMaterial.side)}},{key:"setSide",value:function(e){this.mInternalMaterial.side=hw(e)}},{key:"getFlatShading",value:function(){return this.mInternalMaterial.flatShading}},{key:"setFlatShading",value:function(e){this.mInternalMaterial.flatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.userData}},{key:"setMetaData",value:function(e){this.mInternalMaterial.userData=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,this.mInternalMaterial.needsUpdate=e}},{key:"dispose",value:function(){this.mInternalMaterial.dispose()}},{key:"cloneMaterial",value:function(){return new n(this.getName()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){return this.mDiffuseColor.copy(e.mDiffuseColor),this.mDiffuseMap=e.mDiffuseMap,this.mFreeze=e.mFreeze,this.mDirty=e.mDirty,this.mInternalMaterial.copy(e.getInternalMaterial()),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(Ms);function Dw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Pw=function(e){(0,g.Z)(n,e);var t=Dw(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this),(0,l.Z)((0,_.Z)(r),"mInternalMaterial",void 0),(0,l.Z)((0,_.Z)(r),"mDiffuseColor",so.White()),(0,l.Z)((0,_.Z)(r),"mAmbientColor",so.Black()),(0,l.Z)((0,_.Z)(r),"mEmissiveColor",so.Black()),(0,l.Z)((0,_.Z)(r),"mReflectionColor",so.White()),(0,l.Z)((0,_.Z)(r),"mSpecularColor",so.White()),(0,l.Z)((0,_.Z)(r),"mMetallicReflectanceColor",so.White()),(0,l.Z)((0,_.Z)(r),"mFresnelColor",so.Black()),(0,l.Z)((0,_.Z)(r),"mDiffuseMap",void 0),(0,l.Z)((0,_.Z)(r),"mNormalMap",void 0),(0,l.Z)((0,_.Z)(r),"mAlphaMap",void 0),(0,l.Z)((0,_.Z)(r),"mAoMap",void 0),(0,l.Z)((0,_.Z)(r),"mLightMap",void 0),(0,l.Z)((0,_.Z)(r),"mEnvMap",void 0),(0,l.Z)((0,_.Z)(r),"mEmissiveMap",void 0),(0,l.Z)((0,_.Z)(r),"mRoughnessMap",void 0),(0,l.Z)((0,_.Z)(r),"mMetalnessMap",void 0),(0,l.Z)((0,_.Z)(r),"mReflectanceTexture",void 0),(0,l.Z)((0,_.Z)(r),"mBrdfConfiguration",void 0),(0,l.Z)((0,_.Z)(r),"mDetailMapConfiguration",void 0),(0,l.Z)((0,_.Z)(r),"mClearCoatConfiguration",void 0),(0,l.Z)((0,_.Z)(r),"mSheenConfiguration",void 0),(0,l.Z)((0,_.Z)(r),"mAnisotropicConfiguration",void 0),(0,l.Z)((0,_.Z)(r),"mSubSurfaceConfiguration",void 0),(0,l.Z)((0,_.Z)(r),"mIridescenceConfiguration",void 0),(0,l.Z)((0,_.Z)(r),"mAoMapImpactOnAnalyticalLights",0),(0,l.Z)((0,_.Z)(r),"mDirectLightIntensity",1),(0,l.Z)((0,_.Z)(r),"mSpecularIntensity",1),(0,l.Z)((0,_.Z)(r),"mTwoSidedLighting",!0),(0,l.Z)((0,_.Z)(r),"mGlossiness",.5),(0,l.Z)((0,_.Z)(r),"mMetalnessF0Factor",.04),(0,l.Z)((0,_.Z)(r),"mMetallicReflectanceTexture",void 0),(0,l.Z)((0,_.Z)(r),"mNormalScale",D.One()),(0,l.Z)((0,_.Z)(r),"mEnvMapScale",D.One()),(0,l.Z)((0,_.Z)(r),"mUseSpecularGlossinessFlow",!1),(0,l.Z)((0,_.Z)(r),"mRealtimeTextureFilteringQuality",is.Low),(0,l.Z)((0,_.Z)(r),"mFreeze",!1),(0,l.Z)((0,_.Z)(r),"mDirty",!1),r.mInternalMaterial=new THREE.MeshPhysicalMaterialExt({name:e}),r.mInternalMaterial.userData={},r.mBrdfConfiguration={useEnergyConservation:!0,useSpecularGlossinessInputEnergyConservation:!0},r.mDetailMapConfiguration={isEnabled:!1,map:null,diffuseBlendLevel:1,roughnessBlendLevel:1,bumpLevel:1,normalBlendMethod:0},r.mClearCoatConfiguration={isEnabled:!1,intensity:1,roughness:0,indexOfRefraction:1.5,map:null,useRoughnessFromMainMap:!0,roughnessMap:null,remapF0OnInterfaceChange:!0,bumpMap:null,isTintEnabled:!1,tintColor:so.White(),tintColorAtDistance:1,tintThickness:1,tintMap:null},r.mSheenConfiguration={isEnabled:!1,linkSheenWithDiffuse:!1,intensity:1,color:so.White(),map:null,useRoughnessFromMainMap:!0,roughness:null,roughnessMap:null,diffuseScaling:!1},r.mAnisotropicConfiguration={isEnabled:!1,intensity:1,direction:new D(1,0),map:null},r.mSubSurfaceConfiguration={isRefractionEnabled:!1,isTranslucencyEnabled:!1,isScatteringEnabled:!1,scatteringDiffusionProfile:null,refractionIntensity:1,translucencyIntensity:1,useDiffuseToTintRefraction:!1,useDiffuseToTintTranslucency:!1,thicknessMap:null,indexOfRefraction:1.5,volumeIndexOfRefraction:-1,linkRefractionWithTransparency:!1,minimumThickness:0,maximumThickness:1,useThicknessAsDepth:!1,tintColor:so.White(),tintColorAtDistance:1,diffusionDistance:so.White(),useMaskFromThicknessMap:!1,translucencyIntensityMap:null},r.mIridescenceConfiguration={isEnabled:!1,intensity:1,minimumThickness:100,maximumThickness:400,indexOfRefraction:1.3,map:null,thicknessMap:null},r}return(0,c.Z)(n,[{key:"getDiffuseColor",value:function(){return this.mDiffuseColor}},{key:"setDiffuseColor",value:function(e){this.mDiffuseColor.copy(e),this.mInternalMaterial.color.setRGB(this.mDiffuseColor.r,this.mDiffuseColor.g,this.mDiffuseColor.b)}},{key:"getDiffuseMap",value:function(){return this.mDiffuseMap}},{key:"setDiffuseMap",value:function(e){this.mDiffuseMap=e,this.mInternalMaterial.map=e?e.getInternalTexture():null}},{key:"isUsingAlphaFromDiffuseMap",value:function(){return!0}},{key:"useAlphaFromDiffuseMap",value:function(e){}},{key:"getAlphaMap",value:function(){return this.mAlphaMap}},{key:"setAlphaMap",value:function(e){this.mAlphaMap=e,this.mInternalMaterial.alphaMap=e?e.getInternalTexture():null}},{key:"getNormalMap",value:function(){return this.mNormalMap}},{key:"setNormalMap",value:function(e){this.mNormalMap=e,this.mInternalMaterial.normalMap=e?e.getInternalTexture():null}},{key:"getNormalScale",value:function(){return this.mNormalScale}},{key:"setNormalScale",value:function(e){this.mNormalScale.copy(e),this.mInternalMaterial.normalScale=this.mNormalScale.x}},{key:"getAmbientColor",value:function(){return this.mAmbientColor}},{key:"setAmbientColor",value:function(e){this.mAmbientColor.copy(e)}},{key:"getAoMap",value:function(){return this.mAoMap}},{key:"setAoMap",value:function(e){this.mAoMap=e,this.mInternalMaterial.aoMap=e?e.getInternalTexture():null}},{key:"getAoIntensity",value:function(){return this.mInternalMaterial.aoMapIntensity}},{key:"setAoIntensity",value:function(e){this.mInternalMaterial.aoMapIntensity=e}},{key:"getAoMapImpactOnAnalyticalLights",value:function(){return this.mAoMapImpactOnAnalyticalLights}},{key:"setAoMapImpactOnAnalyticalLights",value:function(e){this.mAoMapImpactOnAnalyticalLights=e}},{key:"getDirectLightIntensity",value:function(){return this.mDirectLightIntensity}},{key:"setDirectLightIntensity",value:function(e){this.mDirectLightIntensity=e}},{key:"getEmissiveColor",value:function(){return this.mEmissiveColor}},{key:"setEmissiveColor",value:function(e){this.mEmissiveColor.copy(e),this.mInternalMaterial.emissive.setRGB(this.mEmissiveColor.r,this.mEmissiveColor.g,this.mEmissiveColor.b)}},{key:"getEmissiveIntensity",value:function(){return this.mInternalMaterial.emissiveIntensity}},{key:"setEmissiveIntensity",value:function(e){this.mInternalMaterial.emissiveIntensity=e}},{key:"getEmissiveMap",value:function(){return this.mEmissiveMap}},{key:"setEmissiveMap",value:function(e){this.mEmissiveMap=e,this.mInternalMaterial.emissiveMap=e?e.getInternalTexture():null}},{key:"getEnvironmentIntensity",value:function(){return this.mInternalMaterial.envMapIntensity}},{key:"setEnvironmentIntensity",value:function(e){this.mInternalMaterial.envMapIntensity=e}},{key:"getEnvironmentBrdfMap",value:function(){return this.mEnvMap}},{key:"setEnvironmentBrdfMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.envMap=e?e.getInternalTexture():null}},{key:"getEnvironmentBrdfMapScale",value:function(){return this.mEnvMapScale}},{key:"setEnvironmentBdrfMapScale",value:function(e){this.mEnvMapScale.copy(e),this.mInternalMaterial.envMapScale=this.mEnvMapScale.x}},{key:"getLightMap",value:function(){return this.mLightMap}},{key:"setLightMap",value:function(e){this.mLightMap=e,this.mInternalMaterial.lightMap=e?e.getInternalTexture():null}},{key:"getLightMapIntensity",value:function(){return this.mInternalMaterial.lightMapIntensity}},{key:"setLightMapIntensity",value:function(e){this.mInternalMaterial.lightMapIntensity=e}},{key:"getParallaxScaleBias",value:function(){return this.mInternalMaterial.displacementScale}},{key:"setParallaxScaleBias",value:function(e){this.mInternalMaterial.displacementScale=e}},{key:"getReflectionColor",value:function(){return this.mReflectionColor}},{key:"setReflectionColor",value:function(e){this.mReflectionColor.setRGB(e.r,e.g,e.b),this.mInternalMaterial.reflectivity=this.mReflectionColor.getAvg()}},{key:"getReflectionMap",value:function(){return this.mEnvMap}},{key:"setReflectionMap",value:function(e){this.mEnvMap=e,this.mInternalMaterial.envMap=e?e.getInternalTexture():null}},{key:"getSpecularColor",value:function(){return this.mSpecularColor}},{key:"setSpecularColor",value:function(e){this.mSpecularColor.copy(e)}},{key:"getSpecularMap",value:function(){return this.mInternalMaterial.specularMap}},{key:"setSpecularMap",value:function(e){this.mInternalMaterial.specularMap=e}},{key:"getSpecularIntensity",value:function(){return this.mSpecularIntensity}},{key:"setSpecularIntensity",value:function(e){this.mSpecularIntensity=e}},{key:"getTwoSidedLighting",value:function(){return this.mTwoSidedLighting}},{key:"setTwoSidedLighting",value:function(e){this.mTwoSidedLighting=e}},{key:"getUnlit",value:function(){return this.mInternalMaterial.lights}},{key:"setUnlit",value:function(e){this.mInternalMaterial.lights=e}},{key:"getReflectanceMap",value:function(){return this.mReflectanceTexture}},{key:"setReflectanceMap",value:function(e){this.mReflectanceTexture=e}},{key:"getMicroSurface",value:function(){return this.mGlossiness}},{key:"setMicroSurface",value:function(e){this.mGlossiness=e}},{key:"getMicroSurfaceMap",value:function(){return this.mRoughnessMap}},{key:"setMicroSurfaceMap",value:function(e){this.mRoughnessMap=e,this.mInternalMaterial.roughnessMap=e?e.getInternalTexture():null}},{key:"getRoughness",value:function(){return this.mInternalMaterial.roughness}},{key:"setRoughness",value:function(e){this.mInternalMaterial.roughness=e}},{key:"getMetalness",value:function(){return this.mInternalMaterial.metalness}},{key:"setMetalness",value:function(e){this.mInternalMaterial.metalness=e}},{key:"getMetalnessF0Factor",value:function(){return this.mMetalnessF0Factor}},{key:"setMetalnessF0Factor",value:function(e){this.mMetalnessF0Factor=e}},{key:"getMetalnessMap",value:function(){return this.mMetalnessMap}},{key:"setMetalnessMap",value:function(e){this.mMetalnessMap=e,this.mInternalMaterial.metalnessMap=e?e.getInternalTexture():null}},{key:"getMetallicReflectanceColor",value:function(){return this.mMetallicReflectanceColor}},{key:"setMetallicReflectanceColor",value:function(e){this.mMetallicReflectanceColor.copy(e)}},{key:"getMetallicReflectanceMap",value:function(){return this.mMetallicReflectanceTexture}},{key:"setMetallicReflectanceMap",value:function(e){this.mMetallicReflectanceTexture=e}},{key:"isSpecularGlossinessWorkflowEnabled",value:function(){return this.mUseSpecularGlossinessFlow}},{key:"useSpecularGlossinessWorkflow",value:function(e){this.mUseSpecularGlossinessFlow=e}},{key:"isUsingRealtimeTextureFiltering",value:function(){return!1}},{key:"useRealtimeTextureFiltering",value:function(e){}},{key:"getRealtimeTextureFilteringQuality",value:function(){return this.mRealtimeTextureFilteringQuality}},{key:"setRealtimeTextureFilteringQuality",value:function(e){this.mRealtimeTextureFilteringQuality=e}},{key:"getBrdfConfiguration",value:function(){return this.mBrdfConfiguration}},{key:"setBrdfConfiguration",value:function(e){}},{key:"getDetailMapConfiguration",value:function(){return this.mDetailMapConfiguration}},{key:"setDetailMapConfiguration",value:function(e){}},{key:"getClearCoatConfiguration",value:function(){return this.mClearCoatConfiguration}},{key:"setClearCoatConfiguration",value:function(e){e&&(void 0!==e.intensity&&(this.mClearCoatConfiguration.intensity=e.intensity,this.mInternalMaterial.clearCoat=e.intensity),void 0!==e.roughness&&(this.mClearCoatConfiguration.roughness=e.roughness,this.mInternalMaterial.clearCoatRoughness=e.roughness))}},{key:"getSheenConfiguration",value:function(){return this.mSheenConfiguration}},{key:"setSheenConfiguration",value:function(e){}},{key:"getAnisotropicConfiguration",value:function(){return this.mAnisotropicConfiguration}},{key:"setAnisotropicConfiguration",value:function(e){}},{key:"getSubSurfaceConfiguration",value:function(){return this.mSubSurfaceConfiguration}},{key:"setSubSurfaceConfiguration",value:function(e){e&&void 0!==e.indexOfRefraction&&(this.mSubSurfaceConfiguration.indexOfRefraction=e.indexOfRefraction,this.mInternalMaterial.refractionRatio=e.indexOfRefraction)}},{key:"getIridescenceConfiguration",value:function(){return this.mIridescenceConfiguration}},{key:"setIridescenceConfiguration",value:function(e){}},{key:"getFlags",value:function(){return{useAlphaFresnel:!1,useAlphaFromDiffuseMap:!1,useAmbientInGrayScale:!1,useAmbientOcclusionFromMetallicMapRed:!1,useAutoMicroSurfaceFromReflectivityMap:!1,useLightmapAsShadowmap:!1,useLinearAlphaFresnel:!1,useMetalnessFromMetallicMapBlue:!1,useMicroSurfaceFromReflectivityMapAlpha:!1,useParallax:!1,useParallaxOcclusion:!1,useHorizonOcclusion:!1,useRadianceOcclusion:!1,useRadianceOverAlpha:!1,useRoughnessFromMetallicMapAlpha:!1,useRoughnessFromMetallicMapGreen:!1,useSpecularAntiAliasing:!0,useSpecularOverAlpha:!1,useOnlyMetallicFromMetallicReflectanceMap:!1,usePhysicalLightFalloff:!1,useTransmission:!1}}},{key:"setFlags",value:function(e){}},{key:"getName",value:function(){return this.mInternalMaterial.name}},{key:"setName",value:function(e){this.mInternalMaterial.name=e}},{key:"getFog",value:function(){return this.mInternalMaterial.fog}},{key:"setFog",value:function(e){this.mInternalMaterial.fog=e}},{key:"getDepthTest",value:function(){return this.mInternalMaterial.depthTest}},{key:"setDepthTest",value:function(e){this.mInternalMaterial.depthTest=e}},{key:"getDepthWrite",value:function(){return this.mInternalMaterial.depthWrite}},{key:"setDepthWrite",value:function(e){this.mInternalMaterial.depthWrite=e}},{key:"getOpacity",value:function(){return this.mInternalMaterial.opacity}},{key:"setOpacity",value:function(e){this.mInternalMaterial.opacity=e}},{key:"getAlphaTest",value:function(){return this.mInternalMaterial.alphaTest}},{key:"setAlphaTest",value:function(e){this.mInternalMaterial.alphaTest=e}},{key:"getTransparent",value:function(){return this.mInternalMaterial.transparent}},{key:"setTransparent",value:function(e){this.mInternalMaterial.transparent=e}},{key:"getAlphaMode",value:function(){return fw(this.mInternalMaterial.blending,this.mInternalMaterial.blendSrc,this.mInternalMaterial.blendDst,this.mInternalMaterial.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha)}},{key:"setAlphaMode",value:function(e){var t=pw(e);this.mInternalMaterial.blending=t.blending,this.mInternalMaterial.blendSrc=t.blendSrc,this.mInternalMaterial.blendDst=t.blendDst,this.mInternalMaterial.blendSrcAlpha=t.blendSrcAlpha,this.mInternalMaterial.blendDstAlpha=t.blendDstAlpha}},{key:"getPremultipliedAlpha",value:function(){return this.mInternalMaterial.premultipliedAlpha}},{key:"setPremultipliedAlpha",value:function(e){this.mInternalMaterial.premultipliedAlpha=e}},{key:"getColorWrite",value:function(){return this.mInternalMaterial.colorWrite}},{key:"setColorWrite",value:function(e){this.mInternalMaterial.colorWrite=e}},{key:"getWireframe",value:function(){return this.mInternalMaterial.wireframe}},{key:"setWireframe",value:function(e){this.mInternalMaterial.wireframe=e}},{key:"getWireframeLineWidth",value:function(){return this.mInternalMaterial.wireframeLinewidth}},{key:"setWireframeLineWidth",value:function(e){this.mInternalMaterial.wireframeLinewidth=e}},{key:"getFreeze",value:function(){return this.mFreeze}},{key:"setFreeze",value:function(e){this.mFreeze=e}},{key:"getSide",value:function(){return lw(this.mInternalMaterial.side)}},{key:"setSide",value:function(e){this.mInternalMaterial.side=hw(e)}},{key:"getFlatShading",value:function(){return this.mInternalMaterial.flatShading}},{key:"setFlatShading",value:function(e){this.mInternalMaterial.flatShading=e}},{key:"getMetaData",value:function(){return this.mInternalMaterial.userData}},{key:"setMetaData",value:function(e){this.mInternalMaterial.userData=e}},{key:"isDirty",value:function(){return this.mDirty}},{key:"markDirty",value:function(){this.setDirty(!0)}},{key:"setDirty",value:function(e){this.mDirty=e,this.mInternalMaterial.needsUpdate=e}},{key:"dispose",value:function(){this.mInternalMaterial.dispose()}},{key:"cloneMaterial",value:function(){return new n(this.getName()).copyMaterial(this)}},{key:"copyMaterial",value:function(e){return this.mDiffuseColor.copy(e.mDiffuseColor),this.mAmbientColor.copy(e.mAmbientColor),this.mEmissiveColor.copy(e.mEmissiveColor),this.mReflectionColor.copy(e.mReflectionColor),this.mSpecularColor.copy(e.mSpecularColor),this.mMetallicReflectanceColor.copy(e.mMetallicReflectanceColor),this.mFresnelColor.copy(e.mFresnelColor),this.mDiffuseMap=e.mDiffuseMap,this.mNormalMap=e.mNormalMap,this.mAlphaMap=e.mAlphaMap,this.mAoMap=e.mAoMap,this.mLightMap=e.mLightMap,this.mEnvMap=e.mEnvMap,this.mEmissiveMap=e.mEmissiveMap,this.mRoughnessMap=e.mRoughnessMap,this.mMetalnessMap=e.mMetalnessMap,this.mReflectanceTexture=e.mReflectanceTexture,this.mBrdfConfiguration=e.mBrdfConfiguration,this.mDetailMapConfiguration=e.mDetailMapConfiguration,this.mClearCoatConfiguration=e.mClearCoatConfiguration,this.mSheenConfiguration=e.mSheenConfiguration,this.mAnisotropicConfiguration=e.mAnisotropicConfiguration,this.mSubSurfaceConfiguration=e.mSubSurfaceConfiguration,this.mIridescenceConfiguration=e.mIridescenceConfiguration,this.mAoMapImpactOnAnalyticalLights=e.mAoMapImpactOnAnalyticalLights,this.mDirectLightIntensity=e.mDirectLightIntensity,this.mSpecularIntensity=e.mSpecularIntensity,this.mTwoSidedLighting=e.mTwoSidedLighting,this.mGlossiness=e.mGlossiness,this.mMetalnessF0Factor=e.mMetalnessF0Factor,this.mMetallicReflectanceTexture=e.mMetallicReflectanceTexture,this.mNormalScale.copy(e.mNormalScale),this.mEnvMapScale.copy(e.mEnvMapScale),this.mUseSpecularGlossinessFlow=e.mUseSpecularGlossinessFlow,this.mFreeze=e.mFreeze,this.mDirty=e.mDirty,this.mInternalMaterial.copy(e.getInternalMaterial()),this}},{key:"getInternalMaterial",value:function(){return this.mInternalMaterial}}]),n}(ss);function Bw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var Fw=function(e){(0,g.Z)(n,e);var t=Bw(n);function n(){var e;return(0,u.Z)(this,n),e=t.call(this),(0,l.Z)((0,_.Z)(e),"mInternalGeometry",void 0),e.mInternalGeometry=new THREE.BufferGeometry,e}return(0,c.Z)(n,[{key:"setVertexData",value:function(e,t){var n=this.resolveAttributeKind(e);this.mInternalGeometry.addAttribute(n,new THREE.BufferAttribute(t.getData(),t.getItemSize(),t.isNormalized()))}},{key:"setIndexData",value:function(e){this.mInternalGeometry.setIndex(new THREE.BufferAttribute(e.getData(),e.getItemSize(),e.isNormalized()))}},{key:"hasPositions",value:function(){return!!this.mInternalGeometry.getAttribute(this.resolveAttributeKind(_u.POSITION))}},{key:"hasNormals",value:function(){return!!this.mInternalGeometry.getAttribute(this.resolveAttributeKind(_u.NORMAL))}},{key:"hasTangents",value:function(){return!!this.mInternalGeometry.getAttribute(this.resolveAttributeKind(_u.TANGENT))}},{key:"hasUV",value:function(){return!!this.mInternalGeometry.getAttribute(this.resolveAttributeKind(_u.UV))}},{key:"hasUV2",value:function(){return!!this.mInternalGeometry.getAttribute(this.resolveAttributeKind(_u.UV2))}},{key:"hasColors",value:function(){return!!this.mInternalGeometry.getAttribute(this.resolveAttributeKind(_u.COLOR))}},{key:"hasAlpha",value:function(){var e=this.mInternalGeometry.getAttribute(this.resolveAttributeKind(_u.UV));return e&&e.itemSize>3}},{key:"dispose",value:function(){this.mInternalGeometry.dispose()}},{key:"resolveAttributeKind",value:function(e){var t;switch(e){case _u.NORMAL:t="normal";break;case _u.TANGENT:t="tangent";break;case _u.UV:t="uv";break;case _u.UV2:t="uv2";break;case _u.COLOR:t="color";break;default:case _u.POSITION:t="position"}return t}},{key:"getInternalGeometry",value:function(){return this.mInternalGeometry}}]),n}(wu),Lw=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mMediaIds",void 0),(0,l.Z)(this,"mDisposed",!1),(0,l.Z)(this,"mTexture",void 0),this.mMediaIds=t}var n;return(0,c.Z)(e,[{key:"loadMediaModels",value:(n=t(r().mark((function e(){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.mMediaIds.map(function(){var e=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$s.getInstance().resolveModel(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",Promise.all(n));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"enable",value:function(e){var t=this;this.loadMediaModels().then((function(n){if(!t.mDisposed){var r=new THREE.CubeTextureLoader;t.mTexture=r.load(n.map((function(e){return e.lod0_url}))),t.mTexture.name="skybox",e.background=t.mTexture}}),(function(e){qe.qL.warn("failed to enable layer: ",e)}))}},{key:"disable",value:function(e){this.mDisposed=!0,e.background=null,this.mTexture&&(this.mTexture.dispose(),delete this.mTexture)}}]),e}(),Nw=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mMediaId",void 0),(0,l.Z)(this,"mDisposed",!1),(0,l.Z)(this,"mTexture",void 0),this.mMediaId=t}return(0,c.Z)(e,[{key:"enable",value:function(e){var t=this;$s.getInstance().resolveModel(this.mMediaId).then((function(n){t.mDisposed||(t.mTexture=(new THREE.TextureLoader).load(n.lod0_url),t.mTexture.mapping=THREE.EquirectangularReflectionMapping,t.mTexture.magFilter=THREE.LinearFilter,t.mTexture.minFilter=THREE.LinearMipMapLinearFilter,e.background=t.mTexture)}),(function(e){qe.qL.warn("failed to enable layer: ",e)}))}},{key:"disable",value:function(e){this.mDisposed=!0,e.background=null,this.mTexture&&(this.mTexture.dispose(),delete this.mTexture)}}]),e}();function jw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var zw,Uw=function(e){(0,g.Z)(a,e);var n,i=jw(a);function a(){var e;(0,u.Z)(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=i.call.apply(i,[this].concat(n)),(0,l.Z)((0,_.Z)(e),"mControls",void 0),(0,l.Z)((0,_.Z)(e),"mEnabled",void 0),(0,l.Z)((0,_.Z)(e),"mObject",void 0),(0,l.Z)((0,_.Z)(e),"mTransformParentObject",void 0),(0,l.Z)((0,_.Z)(e),"mTransformObject",void 0),(0,l.Z)((0,_.Z)(e),"mMode",void 0),(0,l.Z)((0,_.Z)(e),"mTargetMode",void 0),(0,l.Z)((0,_.Z)(e),"mSpace",void 0),(0,l.Z)((0,_.Z)(e),"mSize",1),(0,l.Z)((0,_.Z)(e),"mObjectProperty",""),(0,l.Z)((0,_.Z)(e),"mActiveCameraId",void 0),(0,l.Z)((0,_.Z)(e),"mPreviousPosition",Bi.Zero()),(0,l.Z)((0,_.Z)(e),"mPreviousQuaternion",Pi.identity()),(0,l.Z)((0,_.Z)(e),"mPreviousScale",Bi.One()),e}return(0,c.Z)(a,[{key:"loadResource",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updateProperties();case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateProperties",value:function(){var e=this.mSceneEntity;this.mEnabled=e.enabled,this.mMode=e.mode,this.mTargetMode=e.targetMode,this.mSpace=e.space,this.mSize=e.size,this.mObjectProperty=e.objectProperty;var t=e.object;t!==this.mObject&&(this.mObject=t)}},{key:"onUpdateDirty",value:function(){Ni((0,M.Z)(a.prototype),"onUpdateDirty",this).call(this),this.updateProperties(),this.createRenderObject(),this.mControls.showX=!0,this.mControls.showY=!0,this.mControls.showZ=!0}},{key:"createRenderObject",value:function(){var e=this.getRenderer().getActiveCamera(),t=e.id;if(this.mControls)t!==this.mActiveCameraId&&(this.mActiveCameraId=t,this.mControls.camera=e);else{var n=this.getRenderer().getRenderer().domElement;this.mControls=new THREE.TransformControls(e,n),this.mTransformParentObject=new THREE.Object3D,this.mTransformParentObject.parent=this.getRenderer().getScene(),this.mTransformObject=new THREE.Object3D,this.mTransformObject.parent=this.mTransformParentObject,this.mActiveCameraId=t}if(this.mControls.enabled=this.mEnabled,this.mControls.setMode(this.resolveMode(this.mMode)),this.mControls.setSpace(this.resolveSpace(this.mSpace)),this.mControls.setSize(this.mSize),this.mObject?(this.updateTransformNodeFromEntity(this.mObject),this.mControls.attach(this.mTransformObject)):this.mControls.detach(),this.mControls.updateMatrixWorld(!0),this.mObject)if(this.mTargetMode===fx.OBJECT)this.mPreviousPosition.copy(this.mObject.transform.position),this.mPreviousQuaternion.copy(this.mObject.transform.quaternion),this.mPreviousScale.copy(this.mObject.transform.scale);else if(this.mTargetMode===fx.TARGET){var r=this.mObject.getValue("target");this.mPreviousPosition.copy(r),this.mPreviousQuaternion.set(0,0,0,1),this.mPreviousScale.set(1,1,1)}else if(this.mTargetMode===fx.PROPERTY){var i=this.mObject.getValue(this.mObjectProperty);this.mPreviousPosition.copy(i),this.mPreviousQuaternion.set(0,0,0,1),this.mPreviousScale.set(1,1,1)}this.mRenderObject=this.mControls}},{key:"destroyRenderObject",value:function(){this.mRenderObject&&(this.mTransformObject.parent=void 0,this.mControls.dispose(),delete this.mControls),Ni((0,M.Z)(a.prototype),"destroyRenderObject",this).call(this)}},{key:"onAttached",value:function(){this.mControls&&(this.mControls.addEventListener("mouseDown",this.onMouseDown.bind(this)),this.mControls.addEventListener("mouseUp",this.onMouseUp.bind(this)))}},{key:"onDetached",value:function(){this.mControls&&(this.mControls.removeEventListener("mouseDown",this.onMouseDown.bind(this)),this.mControls.removeEventListener("mouseUp",this.onMouseUp.bind(this)))}},{key:"update",value:function(e){Ni((0,M.Z)(a.prototype),"update",this).call(this,e);var t=!1,n=!1,r=!1;if(this.mObject){if(this.mMode===px.TRANSLATE&&this.didPan(this.mTransformObject.position)){if(this.mTargetMode===fx.OBJECT)this.mObject.transform.position.set(this.mTransformObject.position.x,this.mTransformObject.position.y,this.mTransformObject.position.z),this.mPreviousPosition.copy(this.mObject.transform.position);else if(this.mTargetMode===fx.TARGET){var i=new Bi(this.mTransformObject.position.x,this.mTransformObject.position.y,this.mTransformObject.position.z);this.mObject.setValue("target",i),this.mPreviousPosition.copy(i)}else if(this.mTargetMode===fx.PROPERTY){var o=new Bi(this.mTransformObject.position.x,this.mTransformObject.position.y,this.mTransformObject.position.z);this.mObject.setValue(this.mObjectProperty,o),this.mPreviousPosition.copy(o)}t=!0}this.mMode===px.ROTATE&&this.didRotate(this.mTransformObject.quaternion)&&(this.mTargetMode===fx.OBJECT&&(this.mObject.transform.quaternion.set(this.mTransformObject.quaternion.x,this.mTransformObject.quaternion.y,this.mTransformObject.quaternion.z,this.mTransformObject.quaternion.w),this.mPreviousQuaternion.copy(this.mObject.transform.quaternion)),n=!0),this.mMode===px.SCALE&&this.didScale(this.mTransformObject.scale)&&(this.mTargetMode===fx.OBJECT&&(this.mObject.transform.scale.set(this.mTransformObject.scale.x,this.mTransformObject.scale.y,this.mTransformObject.scale.z),this.mPreviousScale.copy(this.mObject.transform.scale)),r=!0),(t||n||r)&&this.onObjectChange()}}},{key:"resolveMode",value:function(e){var t;switch(e){case px.ROTATE:t="rotate";break;case px.SCALE:t="scale";break;case px.TRANSLATE:default:t="translate"}return t}},{key:"resolveSpace",value:function(e){var t;switch(e){case mx.LOCAL:t="local";break;case mx.WORLD:default:t="world"}return t}},{key:"onObjectChange",value:function(){P.eventBus().dispatch(new Mx(bx.ObjectChange,this.mObject))}},{key:"onMouseDown",value:function(){P.eventBus().dispatch(new Mx(bx.MouseDown))}},{key:"onMouseUp",value:function(){P.eventBus().dispatch(new Mx(bx.MouseUp))}},{key:"didPan",value:function(e){var t=this.mPreviousPosition.x-e.x,n=this.mPreviousPosition.y-e.y,r=this.mPreviousPosition.z-e.z;return t*t+n*n+r*r>pl.EPS}},{key:"didRotate",value:function(e){var t=this.mPreviousQuaternion.x-e.x,n=this.mPreviousQuaternion.y-e.y,r=this.mPreviousQuaternion.z-e.z,i=this.mPreviousQuaternion.w-e.w;return t*t+n*n+r*r+i*i>pl.EPS}},{key:"didScale",value:function(e){var t=this.mPreviousScale.x-e.x,n=this.mPreviousScale.y-e.y,r=this.mPreviousScale.z-e.z;return t*t+n*n+r*r>pl.EPS}},{key:"updateTransformNodeFromEntity",value:function(e){var t=e instanceof Wi?e.getParent():void 0;if(t){var n=Bi.Zero();t.transform.getWorldPosition(n),this.mTransformParentObject.position.set(n.x,n.y,n.z);var r=Pi.identity();t.transform.getWorldQuaternion(r),this.mTransformParentObject.quaternion.set(r.x,r.y,r.z,r.w);var i=Bi.Zero();t.transform.getWorldScale(i),this.mTransformParentObject.scale.set(i.x,i.y,i.z)}else this.mTransformParentObject.position.set(0,0,0),this.mTransformParentObject.quaternion.set(0,0,0,1),this.mTransformParentObject.scale.set(1,1,1);if(this.mTransformParentObject.updateMatrix(),this.mTransformParentObject.updateMatrixWorld(!1),this.mTargetMode===fx.OBJECT)this.mTransformObject.position.set(e.transform.position.x,e.transform.position.y,e.transform.position.z),this.mTransformObject.quaternion.set(e.transform.quaternion.x,e.transform.quaternion.y,e.transform.quaternion.z,e.transform.quaternion.w),this.mTransformObject.scale.set(e.transform.scale.x,e.transform.scale.y,e.transform.scale.z);else if(this.mTargetMode===fx.TARGET){var a=this.mObject.getValue("target");this.mTransformObject.position.set(a.x,a.y,a.z),this.mTransformObject.quaternion.set(0,0,0,1),this.mTransformObject.scale.set(1,1,1)}else if(this.mTargetMode===fx.PROPERTY){var o=this.mObject.getValue(this.mObjectProperty);this.mTransformObject.position.set(o.x,o.y,o.z),this.mTransformObject.quaternion.set(0,0,0,1),this.mTransformObject.scale.set(1,1,1)}this.mTransformObject.updateMatrix()}}]),a}(Ax);function Vw(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}!function(e){e.none="none",e.transparent="transparent",e.color="color",e.environment="environment",e.image="image",e.cube="cube"}(zw||(zw={}));var Hw,Gw=function(e){(0,g.Z)(a,e);var n,i=Vw(a);function a(e,t,n){var r;return(0,u.Z)(this,a),r=i.call(this,t,n),(0,l.Z)((0,_.Z)(r),"mRenderer",void 0),(0,l.Z)((0,_.Z)(r),"mScene",void 0),(0,l.Z)((0,_.Z)(r),"mSceneDefaultBg",void 0),(0,l.Z)((0,_.Z)(r),"mDefaultCamera",void 0),(0,l.Z)((0,_.Z)(r),"mCamera",void 0),(0,l.Z)((0,_.Z)(r),"mSyncHashHelper",new xc),(0,l.Z)((0,_.Z)(r),"mRaycaster",void 0),(0,l.Z)((0,_.Z)(r),"mClippingCache",{}),(0,l.Z)((0,_.Z)(r),"mClippingEmpty",[]),(0,l.Z)((0,_.Z)(r),"mCanvas",void 0),(0,l.Z)((0,_.Z)(r),"mRightHandedSystem",!0),(0,l.Z)((0,_.Z)(r),"mSceneBackgroundStatePresent",!1),r.mCanvas=e,r.mCanvas.style.outline="none",r.mRaycaster=new THREE.Raycaster,r.mDefaultCamera=new THREE.PerspectiveCamera(60,1,.1,1e3),r.mDefaultCamera.name="Camera",r.mDefaultCamera.position.set(8,8,8),r.mDefaultCamera.lookAt(new THREE.Vector3(0,0,0)),r.init(),r}return(0,c.Z)(a,[{key:"init",value:function(){this.initScene(),this.initRenderer()}},{key:"getScene",value:function(){return this.mScene}},{key:"getRenderer",value:function(){return this.mRenderer}},{key:"getActiveCamera",value:function(){return this.mCamera?this.mCamera.getRenderObject():this.mDefaultCamera}},{key:"initScene",value:function(){var e=this;this.mScene=new THREE.Scene;var t=new THREE.CubeTextureLoader;t.setCrossOrigin("anonymous"),t.setPath("".concat(Jr.E.assetsUrl,"system/textures/"));var n="cube-grayblue";t.load([n+"-side.png",n+"-side.png",n+"-top.png",n+"-bottom.png",n+"-side.png",n+"-side.png"],(function(t){e.mSceneDefaultBg=t,e.mSceneBackgroundStatePresent||!0!==e.mScene.userData._viewHasBg&&(e.mScene.background=e.mSceneDefaultBg)}),(function(){}),(function(){}))}},{key:"initRenderer",value:function(){var e=this.getDeviceSceneSettings();this.createRenderer(e),this.initRendererProperties(e),this.initRendererShadowMap(e)}},{key:"createRenderer",value:function(e){var t={alpha:e.alpha,depth:!0,stencil:!0,antialias:e.anti_aliasing,premultipliedAlpha:!0,preserveDrawingBuffer:!0===window.xpvCanvasPreserveDrawingBuffer,powerPreference:"default"},n=this.mCanvas.getContext("webgl2",t)||this.mCanvas.getContext("experimental-webgl",t)||this.mCanvas.getContext("webgl",t);this.mRenderer=new THREE.WebGLRenderer({antialias:e.anti_aliasing,alpha:e.alpha,logarithmicDepthBuffer:!1,preserveDrawingBuffer:!1,canvas:this.mCanvas,context:n})}},{key:"initRendererProperties",value:function(e){this.mRenderer.autoClear=!1,this.mRenderer.physicallyCorrectLights=!1,this.mRenderer.setPixelRatio(window.devicePixelRatio),this.mRenderer.localClippingEnabled=!0,this.mRenderer.toneMapping=THREE.Uncharted2ToneMapping;var t=e.clear_color,n=t>>24,r=t>>16&255,i=t>>8&255,a=255&t;n=(n/=127)>1?1:n,this.mRenderer.setClearColor(new THREE.Color(r/255,i/255,a/255),n)}},{key:"initRendererShadowMap",value:function(e){switch(this.mRenderer.shadowMap.autoUpdate=!1,e.shadow){case"0":this.mRenderer.shadowMap.enabled=!1;break;case"1":this.mRenderer.shadowMap.enabled=!0,this.mRenderer.shadowMap.type=THREE.BasicShadowMap,this.mRenderer.shadowMap.needsUpdate=!0;break;case"2":this.mRenderer.shadowMap.enabled=!0,this.mRenderer.shadowMap.type=THREE.PCFShadowMap,this.mRenderer.shadowMap.needsUpdate=!0;break;case"3":this.mRenderer.shadowMap.enabled=!0,this.mRenderer.shadowMap.type=THREE.PCFSoftShadowMap,this.mRenderer.shadowMap.needsUpdate=!0}}},{key:"clear",value:function(e,t,n){this.mRenderer.clear(e,t,n)}},{key:"markShadowMapUpdate",value:function(){this.mRenderer.shadowMap.needsUpdate=!0}},{key:"beforeRender",value:function(e){this.mSyncHashHelper.newHash(),(e.lightsNeedRenderUpdate()||e.drawablesNeedRenderUpdate())&&this.markShadowMapUpdate()}},{key:"afterRender",value:function(e){this.renderCacheReady(!0)&&this.clearOutOfSync();var t=this.getActiveCamera();this.mRenderer.render(this.mScene,t)}},{key:"onBeforeMeshRender",value:function(e,t,n,r,i,a,o){o&&t.getObjectId()in this.mClippingCache&&(o.clippingPlanes=this.mClippingCache[t.getObjectId()])}},{key:"onAfterMeshRender",value:function(e,t,n,r,i,a,o){o&&(o.clippingPlanes=this.mClippingEmpty)}},{key:"raycast",value:function(e){var t=this,n=e.origin.clone(),r=e.direction.clone();return this.isRightHandedSystemActive()||(n.toggleCoordSystem(),r.toggleCoordSystem()),this.mRaycaster.ray=new THREE.Ray(new THREE.Vector3(n.x,n.y,n.z),new THREE.Vector3(r.x,r.y,r.z)),this.mRaycaster.near=0,this.mRaycaster.far=e.length,this.mRaycaster.intersectObjects(this.mScene.children,!0).map((function(e){var n=e.face?e.face.normal:void 0,r=e.uv,i=e.uv2,a=n?new Bi(n.x,n.y,n.z):Bi.Up(),o=a.clone();if(e.object){var s=new THREE.Quaternion;e.object.getWorldQuaternion(s),o.applyQuaternion(new Pi(s.x,s.y,s.z,s.w))}var u=r?new D(r.x,r.y):D.Zero(),c=i?new D(i.x,i.y):u.clone(),l=new Bi(e.point.x,e.point.y,e.point.z),h=t.getEntityFromObject(e.object);t.isRightHandedSystemActive()||(l.toggleCoordSystem(),n&&(a.toggleCoordSystem(),o.toggleCoordSystem()));var f=new x_;return f.distance=e.distance,f.point.copy(l),f.normal.copy(o),f.faceNormal.copy(a),f.uv.copy(u),f.uv2.copy(c),f.entity=h,f})).filter((function(e){return!(e.entity instanceof Wa)||!0===e.entity.pickable&&!e.entity.layers.isEnabled(4)}))}},{key:"raycastIntersects",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.origin.clone(),a=e.direction.clone();this.isRightHandedSystemActive()||(i.toggleCoordSystem(),a.toggleCoordSystem()),this.mRaycaster.ray=new THREE.Ray(new THREE.Vector3(i.x,i.y,i.z),new THREE.Vector3(a.x,a.y,a.z)),this.mRaycaster.near=0,this.mRaycaster.far=e.length;var o=t.map((function(e){return n.getObjectFromEntity(e)})).filter((function(e){return e}));return this.mRaycaster.intersectObjects(o,!r).map((function(e){var t=e.face?e.face.normal:void 0,r=e.uv,i=e.uv2,a=t?new Bi(t.x,t.y,t.z):Bi.Up(),o=a.clone();if(e.object){var s=new THREE.Quaternion;e.object.getWorldQuaternion(s),o.applyQuaternion(new Pi(s.x,s.y,s.z,s.w))}var u=r?new D(r.x,r.y):D.Zero(),c=i?new D(i.x,i.y):u.clone(),l=new Bi(e.point.x,e.point.y,e.point.z),h=n.getEntityFromObject(e.object);n.isRightHandedSystemActive()||(l.toggleCoordSystem(),t&&(a.toggleCoordSystem(),o.toggleCoordSystem()));var f=new x_;return f.distance=e.distance,f.point.copy(l),f.normal.copy(o),f.faceNormal.copy(a),f.uv.copy(u),f.uv2.copy(c),f.entity=h,f})).filter((function(e){return!(e.entity instanceof Wa)||!0===e.entity.pickable&&!e.entity.layers.isEnabled(4)}))}},{key:"getForwardRayFromCamera",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=new __;n.length=t;var r=this.getTechniqueFromEntity(e);if(!(r&&r instanceof YT))return n;var i=new THREE.Vector3,a=new THREE.Vector3;return r.getCamera().getWorldPosition(i),r.getCamera().getWorldDirection(a),n.origin.set(i.x,i.y,i.z),n.direction.set(a.x,a.y,a.z),n}},{key:"getForwardRayFromScreenCoords",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,i=new __;i.length=r;var a=this.getTechniqueFromEntity(e);if(!(a&&a instanceof YT))return i;var o=this.mRenderer.domElement.getBoundingClientRect(),s=t/o.width*2-1,u=-n/o.height*2+1,c=a.getCamera().matrixWorld,l=(new Fi).fromArray(c.toArray());this.isRightHandedSystemActive()||l.toggleCoordSystem();var h=a.getCamera().projectionMatrix,f=(new Fi).fromArray(h.toArray());this.isRightHandedSystemActive()||f.toggleCoordSystemAsProjection();var p=f.clone().invert();return i.origin.setFromMatrixPosition(l),i.direction.set(s,u,.5).unproject(l,p).sub(i.origin).normalize(),i}},{key:"createTexture2D",value:function(e,t,n,r,i,a,o,s,u,c,l,h,f,p){return new sw(e,t,n,r,i,a,o,s,u,c,l,h,f,p)}},{key:"createTextureCanvas",value:function(e,t,n,r,i,a,o,s,u,c,l,h,f,p){return new cw(e,t,n,r,i,a,o,s,u,c,l,h,f,p)}},{key:"createBuffer",value:function(){return new Fw}},{key:"createMaterialLambert",value:function(e){return new yw(e)}},{key:"createMaterialBasic",value:function(e){return new bw(e)}},{key:"createMaterialPhong",value:function(e){return new kw(e)}},{key:"createMaterialPhongExt",value:function(e){return new xw(e)}},{key:"createMaterialStandard",value:function(e){return new ww(e)}},{key:"createMaterialPhysical",value:function(e){return new Zw(e)}},{key:"createMaterialPhysicalExt",value:function(e){return new Cw(e)}},{key:"createMaterialLine",value:function(e){return new Ew(e)}},{key:"createMaterialSimple",value:function(e){return new Ow(e)}},{key:"createMaterialPBR",value:function(e){return new Pw(e)}},{key:"enablePerspectiveCamera",value:function(e,t){this.createOrUpdate(e,YT)}},{key:"enableAmbientLight",value:function(e,t){this.createOrUpdate(e,ZT)}},{key:"enableDirectionalLight",value:function(e,t){this.createOrUpdate(e,CT)}},{key:"enableHemisphericLight",value:function(e,t){this.createOrUpdate(e,ET)}},{key:"enablePointLight",value:function(e,t){this.createOrUpdate(e,OT)}},{key:"enableSpotLight",value:function(e,t){this.createOrUpdate(e,PT)}},{key:"enableRectAreaLight",value:function(e,t){this.createOrUpdate(e,FT)}},{key:"drawEffectAoPlane",value:function(e,t){this.createOrUpdate(e,Hx)}},{key:"drawEffectFire",value:function(e,t){this.createOrUpdate(e,qx)}},{key:"drawEffectFlare",value:function(e,t){this.createOrUpdate(e,Yx)}},{key:"drawEffectGlare",value:function(e,t){this.createOrUpdate(e,Xx)}},{key:"drawEffectReflector",value:function(e,t){this.createOrUpdate(e,Qx)}},{key:"drawEffectSkyCube",value:function(e,t){this.createOrUpdate(e,eT)}},{key:"drawEffectSkyEquirect",value:function(e,t){this.createOrUpdate(e,nT)}},{key:"drawEffectWater",value:function(e,t){this.createOrUpdate(e,iT)}},{key:"drawGridArea",value:function(e,t){this.createOrUpdate(e,Lx)}},{key:"drawPrimitiveLine",value:function(e,t){this.createOrUpdate(e,bT)}},{key:"drawPrimitiveBox",value:function(e,t){this.createOrUpdate(e,kT)}},{key:"drawPrimitivePlane",value:function(e,t){this.createOrUpdate(e,xT)}},{key:"drawPrimitiveSphere",value:function(e,t){this.createOrUpdate(e,wT)}},{key:"drawUI",value:function(e,t){switch(e.getType().getTypeName()){case"UiEntityAnnotation":this.createOrUpdate(e,a_);break;case"UiEntityButton":this.createOrUpdate(e,c_);break;case"UiEntityImage":this.createOrUpdate(e,p_);break;case"UiEntityTag":this.createOrUpdate(e,y_);break;case"UiEntityText":this.createOrUpdate(e,k_);break;default:qe.qL.warn("Unknown ui entity to renderer: ",e.getType().getTypeName())}}},{key:"drawMesh",value:function(e,t){this.createOrUpdate(e,Dx)}},{key:"drawMeshLine",value:function(e,t){this.createOrUpdate(e,Bx)}},{key:"pushGlobalStates",value:function(){}},{key:"popGlobalStates",value:function(){}},{key:"enableClippingPlane",value:function(e,t,n){var r=e,i=this.mClippingCache[t.getObjectId()]||[],a=r.getPlanes();a.forEach((function(e,t){var n=e.normal;if(t<i.length)return i[t].normal.set(n.x,n.y,n.z),void(i[t].constant=e.constant);i.push(new THREE.Plane(new THREE.Vector3(n.x,n.y,n.z),e.constant))})),a.length<i.length&&i.splice(a.length),this.mClippingCache[t.getObjectId()]=i}},{key:"drawTransformControlsGizmo",value:function(e,t){this.createOrUpdate(e,Uw)}},{key:"enableSceneBackground",value:function(e,t){switch(this.mSceneBackgroundStatePresent=!0,e.getBackgroundType()){case ap.transparent:return this.enableSceneBackgroundTransparent(e,t);case ap.color:return this.enableSceneBackgroundColor(e,t);case ap.image:return this.enableSceneBackgroundImage(e,t);case ap.equirect:return this.enableSceneBackgroundEquirect(e,t);case ap.skybox:return this.enableSceneBackgroundSkybox(e,t)}}},{key:"enableSceneBackgroundTransparent",value:function(e,t){var n=this,r=this.mScene.background;return this.mScene.background=null,{state:e,restore:function(){n.mScene.background=r}}}},{key:"enableSceneBackgroundColor",value:function(e,t){var n=this,r=this.mScene.background,i=e.getColor();return this.mScene.background=new THREE.Color(i.r,i.g,i.b),{state:e,restore:function(){n.mScene.background=r}}}},{key:"enableEnvironment",value:function(e,t){}},{key:"enableEnvironmentIntensity",value:function(e,t){}},{key:"enableSceneBackgroundImage",value:function(e,t){var n=this,r=this.mScene.background,i=e.getMediaId(),a=new Nw(i);return a.enable(this.mScene),{state:e,restore:function(){a.disable(n.mScene),n.mScene.background=r}}}},{key:"enableSceneBackgroundEquirect",value:function(e,t){var n=this,r=this.mScene.background,i=e.getMediaId(),a=new Nw(i);return a.enable(this.mScene),{state:e,restore:function(){a.disable(n.mScene),n.mScene.background=r}}}},{key:"enableSceneBackgroundSkybox",value:function(e,t){var n=this,r=this.mScene.background,i=e.getMediaIds(),a=new Lw(i);return a.enable(this.mScene),{state:e,restore:function(){a.disable(n.mScene),n.mScene.background=r}}}},{key:"disableDefaultBackground",value:function(){this.mScene.background=null,this.mSceneBackgroundStatePresent=!0}},{key:"dispose",value:function(){for(var e=0,t=Object.entries(this.mRenderCache);e<t.length;e++){var n=o(t[e],2)[1];n.detach(),n.dispose()}var r;(this.mSceneBackgroundStatePresent=!1,this.mSceneDefaultBg&&(this.mSceneDefaultBg.dispose(),delete this.mSceneDefaultBg),this.mRenderCache={},this.mScene)&&((r=this.mScene).remove.apply(r,s(this.mScene.children)),delete this.mScene);this.mRenderer.dispose(),this.mUiRenderer.dispose(),this.mSyncHashHelper.newHash()}},{key:"createOrUpdate",value:function(e,t){var n=this.mRenderCache[e.getObjectId()];n||(this.mRenderCache[e.getObjectId()]=n=new t(e,this),n.initialize()),n.disposed||(n.setSyncHash(this.mSyncHashHelper.getHash()),n.ready&&this.renderCacheReady()&&(n.attached||(n.attach(),this.markShadowMapUpdate()),n.update(this.mDeltaTime)))}},{key:"clearOutOfSync",value:function(){for(var e=0,t=Object.keys(this.mRenderCache);e<t.length;e++){var n=t[e],r=this.mRenderCache[n];r.getSyncHash()!==this.mSyncHashHelper.getHash()&&(r.detach(),r.dispose(),delete this.mRenderCache[n],delete this.mClippingCache[n],this.markShadowMapUpdate())}}},{key:"getObjectFromEntity",value:function(e){var t=this.getTechniqueFromEntity(e);return t instanceof Ax?t.getRenderObject():void 0}},{key:"getEntityFromObject",value:function(e){if(e&&e.userData)for(var t=e.userData.scene_entity_id,n=0,r=Object.entries(this.mRenderCache);n<r.length;n++){var i=o(r[n],2)[1];if(i.equalsId(t))return i.getSceneEntity()}}},{key:"getTechniqueFromEntity",value:function(e){for(var t=0,n=Object.entries(this.mRenderCache);t<n.length;t++){var r=o(n[t],2)[1];if(r.equals(e))return r}}},{key:"setSize",value:function(e,t){this.mRenderer.setSize(e,t),this.mUiRenderer.resize(e,t),this.mDefaultCamera.aspect=e/t,this.mDefaultCamera.updateProjectionMatrix(),this.mCamera&&this.mCamera.setSize(e,t)}},{key:"setPixelRatio",value:function(e){this.mRenderer.setPixelRatio(e)}},{key:"getCanvas",value:function(){return this.mCanvas}},{key:"getSceneBoundingBox",value:function(){for(var e=new THREE.Box3,t=0,n=Object.entries(this.mRenderCache);t<n.length;t++){var r=o(n[t],2)[1];if(r.getSceneEntity().visible&&(!(r.getSceneEntity().layers.isEnabled(1)||r.getSceneEntity().layers.isEnabled(2)||r.getSceneEntity().layers.isEnabled(3)||r.getSceneEntity().layers.isEnabled(5)||r.getSceneEntity().layers.isEnabled(7)||r.getSceneEntity().layers.isEnabled(8))&&r instanceof Ax)){var i=r.getRenderObject();if(i instanceof THREE.Object3D){var a=(new THREE.Box3).setFromObject(i);e.union(a)}}}return new ji(new Bi(e.min.x,e.min.y,e.min.z),new Bi(e.max.x,e.max.y,e.max.z))}},{key:"setCameraActive",value:function(e){this.mCamera=e,this.mCamera.setSize(this.mCanvas.width,this.mCanvas.height)}},{key:"isRightHandedSystemActive",value:function(){return this.mRightHandedSystem}},{key:"getInternalScene",value:function(){return this.mScene}},{key:"getInternalRenderer",value:function(){return this.mRenderer}},{key:"isBackgroundAllowed",value:function(e){return e!==zw.environment}}],[{key:"loadScripts",value:(n=t(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ta.getHost(),e.next=3,Ta.loadScript("https://assets.expivi.net/viewer/latest/vendor.threejs.lib.js".concat(t.params));case 3:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"installScripts",value:function(){void 0===window.particleFire||window.particleFire.getInstalled("THREE")||window.particleFire.install({THREE:window.THREE})}}]),a}(no),qw=__webpack_require__(1766),Ww=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mTopics",{})}return(0,c.Z)(e,[{key:"getTopic",value:function(e){return this.mTopics[e]=this.mTopics[e]||{enabled:!0,listeners:{}},this.mTopics[e]}},{key:"_setTopicEnabled",value:function(e,t){this.getTopic(e).enabled=t}},{key:"_isTopicEnabled",value:function(e){return this.getTopic(e).enabled}},{key:"_dispatch",value:function(e,t,n){var r=[this.getTopic(e),this.getTopic("*")];if(r.some((function(e){return e.enabled})))for(var i=0,a=r;i<a.length;i++)for(var s=a[i],u=0,c=Object.entries(s.listeners);u<c.length;u++){var l=o(c[u],2)[1];n&&l.address!==n||l.callback(t,e)}}},{key:"_subscribe",value:function(e,t,n){var r=this,i=this.getTopic(e),a=y.F.guid();return i.listeners[a]={address:n,callback:t},{unsubscribe:function(){r.unsubscribe(e,a)}}}},{key:"_subscribeAll",value:function(e,t){var n=this,r=this.getTopic("*"),i=y.F.guid();return r.listeners[i]={address:t,callback:e},{unsubscribe:function(){n.unsubscribe("*",i)}}}},{key:"unsubscribe",value:function(e,t){delete this.getTopic(e).listeners[t]}},{key:"_dispose",value:function(){var e=this;Object.keys(this.mTopics).forEach((function(t){delete e.mTopics[t]}))}}]),e}(),Yw="$$_xpv_default_bus_broker_$$",Kw=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mDefaultBrokerName",Yw),(0,l.Z)(this,"mBrokers",(0,l.Z)({},Yw,new Ww))}return(0,c.Z)(e,[{key:"addBroker",value:function(e,t){this.mBrokers[e]=t}},{key:"removeBroker",value:function(e){if(e===this.mDefaultBrokerName)throw new Error("Default broker can not be removed");delete this.mBrokers[e]}},{key:"changeDefaultBroker",value:function(e){return e in this.mBrokers&&(this.mDefaultBrokerName=e,!0)}},{key:"getBroker",value:function(e){return void 0!==e?this.mBrokers[e]:this.mBrokers[this.mDefaultBrokerName]}},{key:"enableTopic",value:function(e,t){this.getBroker(t)._setTopicEnabled(e,!0)}},{key:"disableTopic",value:function(e,t){this.getBroker(t)._setTopicEnabled(e,!1)}},{key:"isTopicEnabled",value:function(e,t){return this.getBroker(t)._isTopicEnabled(e)}},{key:"subscribe",value:function(e,t,n,r){return this.getBroker(r)._subscribe(e,t,n)}},{key:"subscribeAll",value:function(e,t,n){return this.getBroker(n)._subscribeAll(e,t)}},{key:"dispatch",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=this.getBroker(n);r>=0?window.setTimeout((function(){i._dispatch(e.getName(),e,t)}),r):i._dispatch(e.getName(),e,t)}},{key:"dispose",value:function(){var e=this;Object.keys(this.mBrokers).forEach((function(t){e.mBrokers[t]._dispose(),delete e.mBrokers[t]}))}}]),e}(),Xw=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mMessage",void 0),(0,l.Z)(this,"mReplys",new ni),this.mMessage=t}return(0,c.Z)(e,[{key:"onReply",value:function(e){return this.mReplys.subscribe(e)}},{key:"_reply",value:function(e){this.mReplys.next(e)}}]),e}(),$w=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mBroker",new Ww)}return(0,c.Z)(e,[{key:"send",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;r>=0?window.setTimeout((function(){n.mBroker._dispatch(e.getType().getTypeName(),e,t)}),r):this.mBroker._dispatch(e.getType().getTypeName(),e,t)}},{key:"request",value:function(e,t){var n=new Xw(e);return e._pushReplyListener(n),this.send(e,t),n}},{key:"enableMessageType",value:function(e){this.mBroker._setTopicEnabled(e.getTypeName(),!0)}},{key:"disableMessageType",value:function(e){this.mBroker._setTopicEnabled(e.getTypeName(),!1)}},{key:"isMessageTypeEnabled",value:function(e){return this.mBroker._isTopicEnabled(e.getTypeName())}},{key:"listen",value:function(e,t,n){return this.mBroker._subscribe(e.getTypeName(),t,n)}},{key:"dispose",value:function(){this.mBroker._dispose()}}]),e}(),Qw=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mData",void 0),this.mData={}}return(0,c.Z)(e,[{key:"dispatch",value:function(e,t){this.initData(e),this.mData[e].listeners&&this.mData[e].listeners.next(t),this.mData[e].data=t}},{key:"get",value:function(e){return this.initData(e),this.mData[e].data}},{key:"subscribe",value:function(e,t){return this.initData(e),this.mData[e].listeners.subscribe((function(){t()}))}},{key:"dispose",value:function(){Object.entries(this.mData).forEach((function(e){var t=o(e,2)[1];t.listeners.unsubscribe(),delete t.data}))}},{key:"initData",value:function(e){this.mData[e]||(this.mData[e]={listeners:new Ht})}}]),e}(),Jw=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mInterceptors",void 0),this.mInterceptors={}}var n;return(0,c.Z)(e,[{key:"intercept",value:(n=t(r().mark((function e(t,n){var i,a,o,s=this,u=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=u.length,a=new Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=u[o];return e.abrupt("return",new Promise((function(e,r){if(t in s.mInterceptors&&s.mInterceptors[t].length>0){var i=s.mInterceptors[t].reduce((function(e,t){return t.execute.apply(t,[e].concat(a))}),n);null!=i?e(i):r(i)}else e(n)})));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"registerInterceptor",value:function(e,t){return e in this.mInterceptors||(this.mInterceptors[e]=[]),this.mInterceptors[e].push(t),t.cid}},{key:"unregisterInterceptor",value:function(e,t){return this.unregisterInterceptorByCid(e,t.cid)}},{key:"unregisterInterceptorByCid",value:function(e,t){if(e in this.mInterceptors){var n=this.mInterceptors[e].findIndex((function(e){return e.cid===t}));if(n>=0)return this.mInterceptors[e].splice(n,1)[0]}}},{key:"dispose",value:function(){delete this.mInterceptors}}]),e}(),eR=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mIsInitialized",!1),(0,l.Z)(this,"mRenderer",void 0),(0,l.Z)(this,"mSceneManager",void 0),(0,l.Z)(this,"mEventBus",void 0),(0,l.Z)(this,"mMessenger",void 0),(0,l.Z)(this,"mCommandManager",void 0),(0,l.Z)(this,"mStateRegistery",void 0),(0,l.Z)(this,"mSettingsManager",void 0),(0,l.Z)(this,"mInterceptorManager",void 0),(0,l.Z)(this,"mPhysicsSystem",void 0)}return(0,c.Z)(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.renderer)this.mRenderer=e.renderer;else{var t=document.createElement("canvas");document.body.appendChild(t);var n=document.createElement("div");document.body.appendChild(n),this.mRenderer=new hn(new Ix(t,n,new si))}this.mSceneManager=e.sceneManager||new PM,this.mEventBus=e.eventBus||new Kw,this.mMessenger=e.messenger||new $w,this.mCommandManager=e.commandManager||new pn,this.mStateRegistery=e.stateRegistry||new Qw,this.mSettingsManager=e.settingsManager||new Ri,this.mInterceptorManager=e.interceptorManager||new Jw,this.mPhysicsSystem=e.physicsSystem,this.mIsInitialized=!0}},{key:"isInitialized",value:function(){return this.mIsInitialized}},{key:"renderer",value:function(){if(!this.mRenderer)throw new Error("Module used before initialisation.");return this.mRenderer}},{key:"sceneManager",value:function(){if(!this.mSceneManager)throw new Error("Module used before initialisation.");return this.mSceneManager}},{key:"eventBus",value:function(){if(!this.mEventBus)throw new Error("Module used before initialisation.");return this.mEventBus}},{key:"messenger",value:function(){if(!this.mMessenger)throw new Error("Module used before initialisation.");return this.mMessenger}},{key:"commandManager",value:function(){if(!this.mCommandManager)throw new Error("Module used before initialisation.");return this.mCommandManager}},{key:"stateRegistery",value:function(){if(!this.mStateRegistery)throw new Error("Module used before initialisation.");return this.mStateRegistery}},{key:"settingsManager",value:function(){if(!this.mSettingsManager)throw new Error("Module used before initialisation.");return this.mSettingsManager}},{key:"interceptorManager",value:function(){if(!this.mInterceptorManager)throw new Error("Modules used before initialisation.");return this.mInterceptorManager}},{key:"physicsSystem",value:function(){return this.mPhysicsSystem}},{key:"dispose",value:function(){var e,t,n,r,i,a,o,s,u;null===(e=this.mSceneManager)||void 0===e||e.destroyScene(),null===(t=this.mRenderer)||void 0===t||t.dispose(),null===(n=this.mEventBus)||void 0===n||n.dispose(),null===(r=this.mMessenger)||void 0===r||r.dispose(),null===(i=this.mCommandManager)||void 0===i||i.dispose(),null===(a=this.mStateRegistery)||void 0===a||a.dispose(),null===(o=this.mSettingsManager)||void 0===o||o.dispose(),null===(s=this.mInterceptorManager)||void 0===s||s.dispose(),null===(u=this.mPhysicsSystem)||void 0===u||u.dispose()}},{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.renderer){var n;if(t)null===(n=this.mRenderer)||void 0===n||n.dispose();this.mRenderer=e.renderer}if(e.sceneManager){var r;if(t)null===(r=this.mSceneManager)||void 0===r||r.destroyScene();this.mSceneManager=e.sceneManager}if(e.eventBus){var i;if(t)null===(i=this.mEventBus)||void 0===i||i.dispose();this.mEventBus=e.eventBus}if(e.messenger){var a;if(t)null===(a=this.mMessenger)||void 0===a||a.dispose();this.mMessenger=e.messenger}if(e.commandManager){var o;if(t)null===(o=this.mCommandManager)||void 0===o||o.dispose();this.mCommandManager=e.commandManager}if(e.stateRegistry){var s;if(t)null===(s=this.mStateRegistery)||void 0===s||s.dispose();this.mStateRegistery=e.stateRegistry}if(e.settingsManager){var u;if(t)null===(u=this.mSettingsManager)||void 0===u||u.dispose();this.mSettingsManager=e.settingsManager}if(e.interceptorManager){var c;if(t)null===(c=this.mInterceptorManager)||void 0===c||c.dispose();this.mInterceptorManager=e.interceptorManager}if(e.physicsSystem){var l;if(t)null===(l=this.mPhysicsSystem)||void 0===l||l.dispose();this.mPhysicsSystem=e.physicsSystem}}}]),e}();!function(e){e[e.Realtime2d=0]="Realtime2d",e[e.Realtime3d=1]="Realtime3d"}(Hw||(Hw={}));var tR=(0,c.Z)((function e(){(0,u.Z)(this,e),(0,l.Z)(this,"separation",0),(0,l.Z)(this,"normal",new Bi),(0,l.Z)(this,"body1",null),(0,l.Z)(this,"body2",null),(0,l.Z)(this,"contact1",new Bi),(0,l.Z)(this,"contact2",new Bi),(0,l.Z)(this,"contactCount",0)})),nR=(__webpack_require__(4363),function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,null,[{key:"findPolygonsContactPoints",value:function(e,t,n,r){for(var i=0,a=Number.MAX_SAFE_INTEGER,o=new D,s=0;s<e.length;s++)for(var u=e[s],c=0;c<t.length;c++){var l=t[c],h=t[(c+1)%t.length],f=this.pointSegmentDistance(u,l,h,o);Math.abs(f-a)<Number.EPSILON?o.distanceToSquared(n)<Number.EPSILON&&(r.copy(o),i=2):f<a&&(a=f,i=1,n.copy(o))}for(var p=0;p<t.length;p++)for(var m=t[p],d=0;d<e.length;d++){var v=e[d],y=e[(d+1)%e.length],g=this.pointSegmentDistance(m,v,y,o);Math.abs(g-a)<Number.EPSILON?o.distanceToSquared(n)<Number.EPSILON&&(r.copy(o),i=2):g<a&&(a=g,i=1,n.copy(o))}return i}},{key:"findCirclePolygonContactPoint",value:function(e,t,n,r,i){for(var a=Number.MAX_SAFE_INTEGER,o=new D,s=0;s<r.length;s++){var u=r[s],c=r[(s+1)%r.length],l=this.pointSegmentDistance(e,u,c,o);l<a&&(a=l,i.copy(o))}return 1}},{key:"findCirclesContactPoint",value:function(e,t,n,r,i){var a=n.clone().sub(e).normalize();return i.copy(e.clone().add(a.multiplyScalar(t))),1}},{key:"pointSegmentDistance",value:function(e,t,n,r){var i=n.clone().sub(t),a=e.clone().sub(t).dot(i)/i.lengthSq();return a<=0?r.copy(t):a>=1?r.copy(n):r.copy(t.clone().add(i.clone().multiplyScalar(a))),e.distanceToSquared(r)}},{key:"intersectCircles",value:function(e,t,n,r){var i=e.distanceTo(n),a=t+r;return i>=a?null:{normal:n.clone().sub(e).normalize(),depth:a-i}}},{key:"intersectCirclePolygon",value:function(e,t,n,r){for(var i=new D(0,0),a=Number.MAX_SAFE_INTEGER,o=new D(0,0),s=0,u=0;u<n.length;u++){var c=n[u],l=n[(u+1)%n.length].clone().sub(c);o.set(-l.y,l.x).normalize();var h=this.projectVertices(n,o),f=h.min,p=h.max,m=this.projectCircle(e,t,o),d=m.min,v=m.max;if(f>=v||d>=p)return null;(s=Math.min(v-f,p-d))<a&&(a=s,i.set(o.x,o.y))}var y=n[this.findClosestPointOnPolygon(e,n)];o.copy(y.clone().sub(e)).normalize();var g=this.projectVertices(n,o),b=g.min,M=g.max,k=this.projectCircle(e,t,o),_=k.min,x=k.max;return b>=x||_>=M?null:((s=Math.min(x-b,M-_))<a&&(a=s,i.set(o.x,o.y)),(r||this.findArithmeticMean(n)).clone().sub(e).dot(i)<0&&i.negate(),{normal:i,depth:a})}},{key:"intersectPolygons",value:function(e,t,n,r){for(var i=new D(0,0),a=Number.MAX_SAFE_INTEGER,o=new D(0,0),s=0;s<e.length;s++){var u=e[s],c=e[(s+1)%e.length].clone().sub(u);o.set(-c.y,c.x).normalize();var l=this.projectVertices(e,o),h=l.min,f=l.max,p=this.projectVertices(t,o),m=p.min,d=p.max;if(h>=d||m>=f)return null;var v=Math.min(d-h,f-m);v<a&&(a=v,i.set(o.x,o.y))}for(var y=0;y<t.length;y++){var g=t[y],b=t[(y+1)%t.length].clone().sub(g);o.set(-b.y,b.x).normalize();var M=this.projectVertices(e,o),k=M.min,_=M.max,x=this.projectVertices(t,o),T=x.min,w=x.max;if(k>=w||T>=_)return null;var R=Math.min(w-k,_-T);R<a&&(a=R,i.set(o.x,o.y))}var Z=n||this.findArithmeticMean(e);return(r||this.findArithmeticMean(t)).clone().sub(Z).dot(i)<0&&i.negate(),{normal:i,depth:a}}},{key:"findArithmeticMean",value:function(e){for(var t=0,n=0,r=0;r<e.length;r++){var i=e[r];t+=i.x,n+=i.y}return new D(t/e.length,n/e.length)}},{key:"projectCircle",value:function(e,t,n){var r=new D(n.x,n.y).multiplyScalar(t),i=new D(e.x,e.y).add(r),a=new D(e.x,e.y).sub(r),o=i.dot(n),s=a.dot(n);if(o>s){var u=o;o=s,s=u}return{min:o,max:s}}},{key:"projectVertices",value:function(e,t){for(var n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=0;i<e.length;i++){var a=e[i].dot(t);a<n&&(n=a),a>r&&(r=a)}return{min:n,max:r}}},{key:"isPointInPolygon",value:function(e,t){for(var n=!1,r=0,i=t.length-1;r<t.length;i=r++){var a=t[r].x,o=t[r].y,s=t[i].x,u=t[i].y;o>e.y!=u>e.y&&e.x<(s-a)*(e.y-o)/(u-o)+a&&(n=!n)}return n}},{key:"isPointInCircle",value:function(e,t,n){return e.distanceTo(t)<=n}},{key:"closestPointOnPolygon",value:function(e,t,n){for(var r=Number.MAX_SAFE_INTEGER,i=new D,a=0;a<t.length;a++){var o=t[a],s=t[(a+1)%t.length],u=this.pointSegmentDistance(e,o,s,i);u<r&&(r=u,n.copy(i))}return Math.sqrt(r)}},{key:"findClosestPointOnPolygon",value:function(e,t){for(var n=-1,r=Number.MAX_SAFE_INTEGER,i=0;i<t.length;i++){var a=t[i].distanceTo(e);a<r&&(r=a,n=i)}return n}},{key:"createBoxVertices",value:function(e,t,n){var r=-.5*e,i=.5*e,a=-.5*t,o=.5*t;n.push(new D(r,o),new D(i,o),new D(i,a),new D(r,a))}},{key:"createTransformVertices",value:function(e,t,n,r){for(var i=0;i<e.length;i++){var a=e[i],o=new Bi(a.x,0,a.y).applyQuaternion(n);r.push(new D(o.x,o.z).add(t))}}}]),e}()),rR=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,[{key:"collide",value:function(e,t,n){for(var r=new D,i=new D,a=0;a<e.length;a++){var o=e[a],s=t[a],u=this.findCollision(o,s);if(u){r.set(0,0),i.set(0,0);var c=this.findContactPoints(o,s,r,i),l=new tR;l.separation=u.depth,l.normal.set(u.normal.x,0,u.normal.y),l.body1=o,l.body2=s,l.contactCount=c,c>0&&l.contact1.set(r.x,0,r.y),c>1&&l.contact2.set(i.x,0,i.y),n.push(l)}}}},{key:"findCollision",value:function(e,t){if(e.getShape().getShapeType()===ic.Box&&t.getShape().getShapeType()===ic.Box)return nR.intersectPolygons(e.getTransformedVertices(),t.getTransformedVertices(),new D(e.getPosition().x,e.getPosition().z),new D(t.getPosition().x,t.getPosition().z));if(e.getShape().getShapeType()===ic.Box&&t.getShape().getShapeType()===ic.Sphere){var n=nR.intersectCirclePolygon(new D(t.getPosition().x,t.getPosition().z),t.getShape().getRadius(),e.getTransformedVertices(),new D(e.getPosition().x,e.getPosition().z));return n&&n.normal.negate(),n}if(e.getShape().getShapeType()===ic.Sphere&&t.getShape().getShapeType()===ic.Box)return nR.intersectCirclePolygon(new D(e.getPosition().x,e.getPosition().z),e.getShape().getRadius(),t.getTransformedVertices(),new D(t.getPosition().x,t.getPosition().z));if(e.getShape().getShapeType()===ic.Sphere&&t.getShape().getShapeType()===ic.Sphere)return nR.intersectCircles(new D(e.getPosition().x,e.getPosition().z),e.getShape().getRadius(),new D(t.getPosition().x,t.getPosition().z),t.getShape().getRadius());throw new Error("Shape not found")}},{key:"findContactPoints",value:function(e,t,n,r){if(e.getShape().getShapeType()===ic.Box&&t.getShape().getShapeType()===ic.Box)return nR.findPolygonsContactPoints(e.getTransformedVertices(),t.getTransformedVertices(),n,r);if(e.getShape().getShapeType()===ic.Box&&t.getShape().getShapeType()===ic.Sphere)return nR.findCirclePolygonContactPoint(new D(t.getPosition().x,t.getPosition().z),t.getShape().getRadius(),new D(e.getPosition().x,e.getPosition().z),e.getTransformedVertices(),n);if(e.getShape().getShapeType()===ic.Sphere&&t.getShape().getShapeType()===ic.Box)return nR.findCirclePolygonContactPoint(new D(e.getPosition().x,e.getPosition().z),e.getShape().getRadius(),new D(t.getPosition().x,t.getPosition().z),t.getTransformedVertices(),n);if(e.getShape().getShapeType()===ic.Sphere&&t.getShape().getShapeType()===ic.Sphere)return nR.findCirclesContactPoint(new D(e.getPosition().x,e.getPosition().z),e.getShape().getRadius(),new D(t.getPosition().x,t.getPosition().z),t.getShape().getRadius(),n);throw new Error("Shape not found")}}]),e}(),iR=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,[{key:"getCollisions",value:function(e,t,n){for(var r=e.getBodies(),i=0;i<r.length-1;i++)for(var a=r[i],o=i+1;o<r.length;o++){var s=r[o];this.canCollisionCheck(a,s)&&(this.intersectionCheck(a,s)&&(t.push(a),n.push(s)))}}},{key:"canCollisionCheck",value:function(e,t){return!(e.getBodyType()===hc.Static&&t.getBodyType()===hc.Static)}},{key:"intersectionCheck",value:function(e,t){return e.aabbNeedsUpdate&&e.updateAABB(),t.aabbNeedsUpdate&&t.updateAABB(),e.getAABB().intersectsBox(t.getAABB())}}]),e}(),aR=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,[{key:"solve",value:function(e,t,n,r){for(var i=0;i<r.length;i++){var a=r[i],o=a.body1,s=a.body2;if(o&&s){var u=a.normal.clone().multiplyScalar(a.separation);this.separateBodies(o,s,u)}}}},{key:"separateBodies",value:function(e,t,n){e.getBodyType()===hc.Static?t.move(n):t.getBodyType()===hc.Static?e.move(n.clone().negate()):(e.move(n.clone().multiplyScalar(-.5)),t.move(n.clone().multiplyScalar(.5)))}},{key:"resolveCollision",value:function(e){var t=e.body1,n=e.body2,r=e.normal,i=n.getLinearVelocity().clone().sub(t.getLinearVelocity());if(!(i.dot(r)>0)){var a=-1*i.dot(r);a/=2;var o=r.clone().multiplyScalar(a);t.setLinearVelocity(t.getLinearVelocity().clone().sub(o.clone().multiplyScalar(1))),n.setLinearVelocity(n.getLinearVelocity().clone().add(o.clone().multiplyScalar(1)))}}}]),e}();function oR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var sR=function(e){(0,g.Z)(n,e);var t=oR(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mType",hc.Dynamic),(0,l.Z)((0,_.Z)(i),"mShape",void 0),(0,l.Z)((0,_.Z)(i),"mAABB",new ji),(0,l.Z)((0,_.Z)(i),"mAABBNeedsUpdate",!0),(0,l.Z)((0,_.Z)(i),"mPosition",new Bi),(0,l.Z)((0,_.Z)(i),"mPrevPosition",new Bi),(0,l.Z)((0,_.Z)(i),"mQuaternion",new Pi),(0,l.Z)((0,_.Z)(i),"mPrevQuaternion",new Pi),(0,l.Z)((0,_.Z)(i),"mLinearVelocity",new Bi),(0,l.Z)((0,_.Z)(i),"mAngularVelocity",new Pi),(0,l.Z)((0,_.Z)(i),"mTransformedVertices",[]),(0,l.Z)((0,_.Z)(i),"mTransformedVerticesNeedsUpdate",!0),(0,l.Z)((0,_.Z)(i),"mOffset",new Bi),(0,l.Z)((0,_.Z)(i),"mOffsetRotation",Pi.identity()),(0,l.Z)((0,_.Z)(i),"mIgnoreSync",!1),i.mShape=e,i.setBodyType(r),i.updateAABB(),i.updateTransformedVertices(),i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"getBodyType",value:function(){return this.mType}},{key:"setBodyType",value:function(e){this.mType=e===hc.Kinematic?hc.Static:e}},{key:"getShape",value:function(){return this.mShape}},{key:"step",value:function(e,t){if(this.mType!==hc.Static){var n=e/t;this.mPosition.x+=this.mLinearVelocity.x*n,this.mPosition.y+=this.mLinearVelocity.y*n,this.mPosition.z+=this.mLinearVelocity.z*n,this.mAABBNeedsUpdate=!0,this.mTransformedVerticesNeedsUpdate=!0}}},{key:"move",value:function(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.mPrevPosition.copy(this.mPosition),this.mPosition.add(e),this.mAABBNeedsUpdate=!0,this.mTransformedVerticesNeedsUpdate=!0}},{key:"getPosition",value:function(){return this.mPosition}},{key:"setPosition",value:function(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.mPrevPosition.copy(this.mPosition),this.mPosition.copy(e),this.mAABBNeedsUpdate=!0,this.mTransformedVerticesNeedsUpdate=!0}},{key:"getQuaternion",value:function(){return this.mQuaternion}},{key:"setQuaternion",value:function(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.mPrevQuaternion.copy(this.mQuaternion),this.mQuaternion.copy(e),this.mAABBNeedsUpdate=!0,this.mTransformedVerticesNeedsUpdate=!0}},{key:"getOffset",value:function(){return this.mOffset}},{key:"setOffset",value:function(e){this.mOffset.copy(e)}},{key:"getOffsetRotation",value:function(){return this.mOffsetRotation}},{key:"setOffsetRotation",value:function(e){this.mOffsetRotation.copy(e)}},{key:"getLinearVelocity",value:function(){return this.mLinearVelocity}},{key:"setLinearVelocity",value:function(e){this.mLinearVelocity.copy(e)}},{key:"getAngularVelocity",value:function(){return this.mAngularVelocity}},{key:"setAngularVelocity",value:function(e){this.mAngularVelocity.copy(e)}},{key:"aabbNeedsUpdate",get:function(){return this.mAABBNeedsUpdate}},{key:"getAABB",value:function(){return this.mAABB}},{key:"updateAABB",value:function(){this.mShape.aabbNeedsUpdate&&this.mShape.updateAABB(),this.mAABB.copy(this.mShape.getAABB()),this.mAABB.applyMatrix4((new Fi).makeRotationFromQuaternion(this.mQuaternion)),this.mAABB.translate(this.mPosition),this.mAABBNeedsUpdate=!1}},{key:"getTransformedVertices",value:function(){return this.mTransformedVerticesNeedsUpdate&&this.updateTransformedVertices(),this.mTransformedVertices}},{key:"updateTransformedVertices",value:function(){this.mTransformedVertices.splice(0),nR.createTransformVertices(this.mShape.getVertices(),new D(this.mPosition.x,this.mPosition.z),this.mQuaternion,this.mTransformedVertices),this.mTransformedVerticesNeedsUpdate=!1}},{key:"getIgnoreSync",value:function(){return this.mIgnoreSync}},{key:"setIgnoreSync",value:function(e){this.mIgnoreSync=e}},{key:"dispose",value:function(){this.mShape.dispose()}},{key:"getAngularDamping",value:function(){return 0}},{key:"getLinearDamping",value:function(){return 0}},{key:"setLinearDamping",value:function(e){}},{key:"getMass",value:function(){return 0}},{key:"setMass",value:function(e){}},{key:"needsUpdate",get:function(){return!1}},{key:"setAngularDamping",value:function(e){}},{key:"updateProperties",value:function(){}}]),n}(x.e);(0,l.Z)(sR,"TypeRTTI",new k.r("Body",x.e.TypeRTTI));var uR=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mType",void 0),(0,l.Z)(this,"mAABB",new ji),(0,l.Z)(this,"mAABBNeedsUpdate",!0),(0,l.Z)(this,"mVertices",[]),(0,l.Z)(this,"mVerticesNeedsUpdate",!0),this.mType=t}return(0,c.Z)(e,[{key:"getShapeType",value:function(){return this.mType}},{key:"getAABB",value:function(){return this.mAABB}},{key:"aabbNeedsUpdate",get:function(){return this.mAABBNeedsUpdate}},{key:"verticesNeedsUpdate",get:function(){return this.mVerticesNeedsUpdate}},{key:"getVertices",value:function(){return this.verticesNeedsUpdate&&this.updateVertices(),this.mVertices}},{key:"dispose",value:function(){}}]),e}();function cR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var lR=function(e){(0,g.Z)(n,e);var t=cR(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,ic.Box),(0,l.Z)((0,_.Z)(r),"mSize",new Bi(1,1,1)),r.mSize.copy(e),r.updateAABB(),r.updateVertices(),r}return(0,c.Z)(n,[{key:"updateAABB",value:function(){this.mAABB.min.set(-.5*this.mSize.x,-.5*this.mSize.y,-.5*this.mSize.z),this.mAABB.max.set(.5*this.mSize.x,.5*this.mSize.y,.5*this.mSize.z),this.mAABBNeedsUpdate=!1}},{key:"getSize",value:function(){return this.mSize}},{key:"setSize",value:function(e){this.mSize.copy(e),this.mAABBNeedsUpdate=!0,this.mVerticesNeedsUpdate=!0}},{key:"getWidth",value:function(){return this.mSize.x}},{key:"setWidth",value:function(e){this.mSize.x=e,this.mAABBNeedsUpdate=!0,this.mVerticesNeedsUpdate=!0}},{key:"getHeight",value:function(){return this.mSize.y}},{key:"setHeight",value:function(e){this.mSize.y=e,this.mAABBNeedsUpdate=!0,this.mVerticesNeedsUpdate=!0}},{key:"getDepth",value:function(){return this.mSize.z}},{key:"setDepth",value:function(e){this.mSize.z=e,this.mAABBNeedsUpdate=!0,this.mVerticesNeedsUpdate=!0}},{key:"updateVertices",value:function(){this.mVertices.splice(0),nR.createBoxVertices(this.mSize.x,this.mSize.z,this.mVertices),this.mVerticesNeedsUpdate=!1}}]),n}(uR);function hR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var fR=function(e){(0,g.Z)(n,e);var t=hR(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,ic.Sphere),(0,l.Z)((0,_.Z)(r),"mRadius",.5),r.mRadius=e,r.updateAABB(),r.updateVertices(),r}return(0,c.Z)(n,[{key:"updateAABB",value:function(){var e=this.getRadius();this.mAABB.min.set(-e,-e,-e),this.mAABB.max.set(e,e,e),this.mAABBNeedsUpdate=!1}},{key:"getRadius",value:function(){return this.mRadius}},{key:"setRadius",value:function(e){this.mRadius=e,this.mAABBNeedsUpdate=!0,this.mVerticesNeedsUpdate=!0}},{key:"updateVertices",value:function(){this.mVerticesNeedsUpdate=!1}}]),n}(uR),pR=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"bodies",[]),(0,l.Z)(this,"broadPhase",new iR),(0,l.Z)(this,"narrowPhase",new rR),(0,l.Z)(this,"solver",new aR),(0,l.Z)(this,"maxSteps",240),(0,l.Z)(this,"pair1",[]),(0,l.Z)(this,"pair2",[]),(0,l.Z)(this,"contactPoints",[]),this.maxSteps=t}return(0,c.Z)(e,[{key:"addBody",value:function(e){this.bodies.push(e)}},{key:"removeBody",value:function(e){var t=this.bodies.findIndex((function(t){return t===e}));t>=0&&this.bodies.splice(t,1)}},{key:"createBody",value:function(e,t){return new sR(e,t)}},{key:"createBox",value:function(e){return new lR(e)}},{key:"createSphere",value:function(e){return new fR(e)}},{key:"getBodies",value:function(){return this.bodies}},{key:"step",value:function(e,t){for(var n=Math.max(1,Math.min(t,this.maxSteps)),r=0;r<n;r++){for(var i=0;i<this.bodies.length;i++)this.bodies[i].step(e,this.maxSteps);this.contactPoints.length=0,this.pair1.length=0,this.pair2.length=0,this.broadPhase.getCollisions(this,this.pair1,this.pair2),0!==this.pair1.length&&(this.narrowPhase.collide(this.pair1,this.pair2,this.contactPoints),0!==this.contactPoints.length&&this.solver.solve(this,e,this.maxSteps,this.contactPoints))}}},{key:"dispose",value:function(){for(var e=0;e<this.bodies.length;e++)this.bodies[e].dispose();this.bodies.splice(0),this.pair1.length=0,this.pair2.length=0,this.contactPoints.length=0}}]),e}();function mR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var dR=function(e){(0,g.Z)(n,e);var t=mR(n);function n(e,r){var i;return(0,u.Z)(this,n),i=t.call(this),(0,l.Z)((0,_.Z)(i),"mBody",void 0),(0,l.Z)((0,_.Z)(i),"mShape",void 0),(0,l.Z)((0,_.Z)(i),"mOffset",new Bi(0,0,0)),(0,l.Z)((0,_.Z)(i),"mOffsetRotation",Pi.identity()),(0,l.Z)((0,_.Z)(i),"mBodyType",hc.Kinematic),(0,l.Z)((0,_.Z)(i),"mNeedsUpdate",!1),(0,l.Z)((0,_.Z)(i),"mContactInfo",void 0),(0,l.Z)((0,_.Z)(i),"mIgnoreSync",!1),(0,l.Z)((0,_.Z)(i),"mAABB",new ji),(0,l.Z)((0,_.Z)(i),"mAABBNeedsUpdate",!0),i.mShape=e,i.mBodyType=r,i.mBody=new CANNON.Body({shape:i.mShape.getInternal(),position:new CANNON.Vec3(0,0,0),quaternion:new CANNON.Quaternion(0,0,0,1),type:i.resolveBodyType(i.mBodyType),mass:0,allowSleep:!1}),i.mBody.addEventListener("collide",i.onCollisionEvent.bind((0,_.Z)(i))),i.updateAABB(),i}return(0,c.Z)(n,[{key:"getType",value:function(){return n.TypeRTTI}},{key:"onCollisionEvent",value:function(e){if("collide"===e.type){var t=e.body,n=e.contact,r=e.target;if(t===this.mBody||r===this.mBody){var i=this.mBody===n.bi?n.bi:n.bj,a=this.mBody===n.bi?n.ri:n.rj,o=new Bi(i.position.x,i.position.y,i.position.z),s=new Bi(a.x,a.y,a.z),u=o.clone().add(s),c=new tR;c.body1=this,c.normal.set(n.ni.x,n.ni.y,n.ni.z),c.contact1.copy(u),c.separation=0,this.mContactInfo=c}}}},{key:"getPosition",value:function(){return new Bi(this.mBody.position.x,this.mBody.position.y,this.mBody.position.z)}},{key:"setPosition",value:function(e){this.mBody.position.set(e.x,e.y,e.z)}},{key:"getOffset",value:function(){return this.mOffset}},{key:"setOffset",value:function(e){this.mOffset.copy(e)}},{key:"getQuaternion",value:function(){return new Pi(this.mBody.quaternion.x,this.mBody.quaternion.y,this.mBody.quaternion.z,this.mBody.quaternion.w)}},{key:"setQuaternion",value:function(e){this.mBody.quaternion.set(e.x,e.y,e.z,e.w)}},{key:"getOffsetRotation",value:function(){return this.mOffsetRotation}},{key:"setOffsetRotation",value:function(e){this.mOffsetRotation.copy(e)}},{key:"updateProperties",value:function(){this.mShape.updateProperties(),this.mBody.updateMassProperties(),this.mBody.updateBoundingRadius(),this.mNeedsUpdate=!1}},{key:"resolveBodyType",value:function(e){switch(e){case hc.Dynamic:return CANNON.Body.DYNAMIC;case hc.Static:return CANNON.Body.STATIC;case hc.Kinematic:return CANNON.Body.KINEMATIC;default:throw new Error("Unknown body type!")}}},{key:"getMass",value:function(){return this.mBody.mass}},{key:"setMass",value:function(e){this.mBody.mass=e,this.mNeedsUpdate=!0}},{key:"isTrigger",value:function(){return this.mBody.isTrigger}},{key:"setIsTrigger",value:function(e){this.mBody.isTrigger=e}},{key:"getLinearVelocity",value:function(){return new Bi(this.mBody.velocity.x,this.mBody.velocity.y,this.mBody.velocity.z)}},{key:"setLinearVelocity",value:function(e){this.mBody.velocity.set(e.x,e.y,e.z)}},{key:"getAngularVelocity",value:function(){return(new Pi).setFromEuler(new Li(this.mBody.angularVelocity.x,this.mBody.angularVelocity.y,this.mBody.angularVelocity.z))}},{key:"setAngularVelocity",value:function(e){var t=(new Li).setFromQuaternion(e);this.mBody.angularVelocity.set(t.x,t.y,t.z)}},{key:"getLinearDamping",value:function(){return this.mBody.linearDamping}},{key:"setLinearDamping",value:function(e){this.mBody.linearDamping=e}},{key:"getAngularDamping",value:function(){return this.mBody.angularDamping}},{key:"setAngularDamping",value:function(e){this.mBody.angularDamping=e}},{key:"getBodyType",value:function(){return this.mBodyType}},{key:"setBodyType",value:function(e){this.mBodyType=e,this.mBody.type=this.resolveBodyType(this.mBodyType),this.mNeedsUpdate=!0}},{key:"getIgnoreSync",value:function(){return this.mIgnoreSync}},{key:"setIgnoreSync",value:function(e){this.mIgnoreSync=e}},{key:"getShape",value:function(){return this.mShape}},{key:"getContactInfo",value:function(){return this.mContactInfo}},{key:"removeContactInfo",value:function(){this.mContactInfo&&delete this.mContactInfo}},{key:"needsUpdate",get:function(){return this.mNeedsUpdate||this.mShape.needsUpdate}},{key:"dispose",value:function(){this.mBody.removeEventListener("collide",this.onCollisionEvent.bind(this)),this.mShape.dispose()}},{key:"getInternal",value:function(){return this.mBody}},{key:"getAABB",value:function(){return this.mAABB}},{key:"aabbNeedsUpdate",get:function(){return this.mAABBNeedsUpdate}},{key:"updateAABB",value:function(){this.mShape.aabbNeedsUpdate&&this.mShape.updateAABB();var e=this.getPosition(),t=this.getQuaternion();this.mAABB.copy(this.mShape.getAABB()),this.mAABB.applyMatrix4((new Fi).makeRotationFromQuaternion(t)),this.mAABB.translate(e),this.mAABBNeedsUpdate=!1}}]),n}(x.e);(0,l.Z)(dR,"TypeRTTI",new k.r("Body",x.e.TypeRTTI));var vR=function(){function e(t){(0,u.Z)(this,e),(0,l.Z)(this,"mType",void 0),(0,l.Z)(this,"mAABB",new ji),(0,l.Z)(this,"mAABBNeedsUpdate",!0),(0,l.Z)(this,"mNeedsUpdate",!1),this.mType=t}return(0,c.Z)(e,[{key:"getShapeType",value:function(){return this.mType}},{key:"updateProperties",value:function(){this.mNeedsUpdate=!1}},{key:"needsUpdate",get:function(){return this.mNeedsUpdate}},{key:"aabbNeedsUpdate",get:function(){return this.mAABBNeedsUpdate}},{key:"getAABB",value:function(){return this.mAABB}},{key:"dispose",value:function(){}}]),e}();function yR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var gR=function(e){(0,g.Z)(n,e);var t=yR(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return(0,u.Z)(this,n),e=t.call(this,ic.Sphere),(0,l.Z)((0,_.Z)(e),"mShape",void 0),e.mShape=new CANNON.Sphere(r),e}return(0,c.Z)(n,[{key:"getRadius",value:function(){return this.mShape.radius}},{key:"setRadius",value:function(e){this.mShape.radius=e,this.mNeedsUpdate=!0}},{key:"updateAABB",value:function(){var e=this.getRadius();this.mAABB.min.set(-e,-e,-e),this.mAABB.max.set(e,e,e),this.mAABBNeedsUpdate=!1}},{key:"getInternal",value:function(){return this.mShape}}]),n}(vR);function bR(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,M.Z)(e);if(t){var i=(0,M.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,b.Z)(this,n)}}var MR=function(e){(0,g.Z)(n,e);var t=bR(n);function n(e){var r;return(0,u.Z)(this,n),r=t.call(this,ic.Box),(0,l.Z)((0,_.Z)(r),"mShape",void 0),(0,l.Z)((0,_.Z)(r),"mSize",new Bi(1,1,1)),r.mSize.copy(e),r.mShape=new CANNON.Box(new CANNON.Vec3(.5*e.x,.5*e.y,.5*e.z)),r}return(0,c.Z)(n,[{key:"updateProperties",value:function(){Ni((0,M.Z)(n.prototype),"updateProperties",this).call(this),this.mShape.updateConvexPolyhedronRepresentation()}},{key:"getSize",value:function(){return this.mSize}},{key:"setSize",value:function(e){this.mSize.copy(e),this.mShape.halfExtents.set(.5*e.x,.5*e.y,.5*e.z),this.mNeedsUpdate=!0}},{key:"getWidth",value:function(){return this.mSize.x}},{key:"setWidth",value:function(e){this.mSize.x=e,this.mShape.halfExtents.x=.5*e,this.mNeedsUpdate=!0}},{key:"getHeight",value:function(){return this.mSize.y}},{key:"setHeight",value:function(e){this.mSize.y=e,this.mShape.halfExtents.y=.5*e,this.mNeedsUpdate=!0}},{key:"getDepth",value:function(){return this.mSize.z}},{key:"setDepth",value:function(e){this.mSize.z=e,this.mShape.halfExtents.z=.5*e,this.mNeedsUpdate=!0}},{key:"updateAABB",value:function(){this.mAABB.min.set(-.5*this.mSize.x,-.5*this.mSize.y,-.5*this.mSize.z),this.mAABB.max.set(.5*this.mSize.x,.5*this.mSize.y,.5*this.mSize.z),this.mAABBNeedsUpdate=!1}},{key:"getInternal",value:function(){return this.mShape}}]),n}(vR),kR=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mWorld",void 0),(0,l.Z)(this,"mGravity",void 0),(0,l.Z)(this,"mDebug",!1),(0,l.Z)(this,"onBeginContact$",new Ht),(0,l.Z)(this,"onEndContact$",new Ht),(0,l.Z)(this,"mBodies",[]),this.mGravity=new Bi(0,0,0),this.mWorld=new CANNON.World({allowSleep:!1,broadphase:new CANNON.NaiveBroadphase,solver:new CANNON.GSSolver,gravity:new CANNON.Vec3(this.mGravity.x,this.mGravity.y,this.mGravity.z)}),this.mWorld.solver.iterations=10,this.mWorld.defaultContactMaterial.contactEquationStiffness=1e9,this.mWorld.defaultContactMaterial.contactEquationRelaxation=10,this.mWorld.addEventListener("beginContact",this.onBeginContactEvent.bind(this)),this.mWorld.addEventListener("endContact",this.onEndContactEvent.bind(this))}return(0,c.Z)(e,[{key:"createBody",value:function(e,t){return new dR(e,t)}},{key:"createSphere",value:function(e){return new gR(e)}},{key:"createBox",value:function(e){return new MR(e)}},{key:"step",value:function(e,t){for(var n=0;n<this.mBodies.length;n++){var r=this.mBodies[n];r.needsUpdate&&r.updateProperties()}this.mWorld.fixedStep(e,t)}},{key:"getBodies",value:function(){return this.mBodies}},{key:"addBody",value:function(e){this.mBodies.push(e),this.mWorld.addBody(e.getInternal())}},{key:"removeBody",value:function(e){var t=this.mBodies.findIndex((function(t){return t===e}));t>=0&&this.mBodies.splice(t,1),this.mWorld.removeBody(e.getInternal())}},{key:"onBeginContactEvent",value:function(e){this.onBeginContact$.next(e)}},{key:"onEndContactEvent",value:function(e){this.onEndContact$.next(e)}},{key:"setDebugMode",value:function(e){this.mDebug=e}},{key:"dispose",value:function(){this.mWorld.removeEventListener("beginContact",this.onBeginContactEvent.bind(this)),this.mWorld.removeEventListener("endContact",this.onEndContactEvent.bind(this))}}]),e}(),_R=function(){function e(){(0,u.Z)(this,e),(0,l.Z)(this,"mWorld",void 0),(0,l.Z)(this,"mMeshMap",{}),(0,l.Z)(this,"mShowHelpers",!1),(0,l.Z)(this,"mSubscriptions",[])}var n;return(0,c.Z)(e,[{key:"createWorld",value:function(e,t){switch(e){case Hw.Realtime2d:this.mWorld=new pR(t);break;case Hw.Realtime3d:this.mWorld=new kR;break;default:throw new Error("Unable to create world using unknown physics system type.")}this.mMeshMap={}}},{key:"step",value:function(e,t){this.mWorld.step(e,t)}},{key:"registerMesh",value:function(e,t){var n=e.getSceneObjectId();this.mMeshMap[n]||(this.mMeshMap[n]={sceneObject:e,body:t},this.mWorld.addBody(this.mMeshMap[n].body),qe.qL.print("PhysicsSystem: Mesh registered:",e,t))}},{key:"unregisterMesh",value:function(e){this.mMeshMap[e]&&(this.mWorld.removeBody(this.mMeshMap[e].body),delete this.mMeshMap[e],qe.qL.print("PhysicsSystem: Mesh unregistered:",e))}},{key:"syncTransforms",value:function(){var t=this;Object.keys(this.mMeshMap).forEach((function(n){var r=Number(n),i=t.mMeshMap[r],a=i.body,o=i.sceneObject;o.updateMatrixLocal(),o.updateMatrixWorld();var s=e.WorldMatrix.compose(a.getOffset(),a.getOffsetRotation(),Bi.One());o.transform.matrixWorld.clone().multiply(s).decompose(e.WorldPosition,e.WorldQuaternion,e.WorldScale),a.setPosition(e.WorldPosition),a.setQuaternion(e.WorldQuaternion)}))}},{key:"syncMeshes",value:function(){var t=this;Object.keys(this.mMeshMap).forEach((function(n){var r=Number(n),i=t.mMeshMap[r],a=i.body,o=i.sceneObject;if(!a.getIgnoreSync()){var s=a.getPosition(),u=a.getQuaternion();o.transform.getWorldScale(e.WorldScale),e.WorldMatrix.compose(s,u,e.WorldScale);var c=(new Fi).compose(a.getOffset().clone().negate(),a.getOffsetRotation().clone().invert(),Bi.One());e.WorldMatrix.multiply(c);var l=o.getParent();if(l){var h=l.transform.matrixWorld;e.WorldMatrix.copy(h.clone().invert().multiply(e.WorldMatrix)),e.WorldMatrix.decompose(o.transform.position,o.transform.quaternion,e.WorldScale)}else o.transform.position.copy(s),o.transform.quaternion.copy(u)}}))}},{key:"dispose",value:function(){var e=this;this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mWorld&&(Object.keys(this.mMeshMap).forEach((function(t){var n=Number(t);e.mWorld.removeBody(e.mMeshMap[n].body)})),this.mMeshMap={},this.mWorld.dispose(),delete this.mWorld)}},{key:"getWorld",value:function(){return this.mWorld}},{key:"showHelpers",value:function(){return this.mShowHelpers}},{key:"setShowHelpers",value:function(e){this.mShowHelpers=e}}],[{key:"install",value:(n=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,__webpack_require__.e(866).then(__webpack_require__.bind(__webpack_require__,3687));case 2:window.CANNON=e.sent;case 3:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})}]),e}();(0,l.Z)(_R,"WorldMatrix",new Fi),(0,l.Z)(_R,"WorldPosition",new Bi),(0,l.Z)(_R,"WorldQuaternion",new Pi),(0,l.Z)(_R,"WorldScale",Bi.One());var xR,TR=function(){function e(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,u.Z)(this,e),(0,l.Z)(this,"mViewerComponent",void 0),(0,l.Z)(this,"mCommunicationLayer",void 0),(0,l.Z)(this,"mViewContainer",void 0),(0,l.Z)(this,"mViewerCanvas",void 0),(0,l.Z)(this,"mUiContainer",void 0),(0,l.Z)(this,"mViewLayout",void 0),(0,l.Z)(this,"mViewWrapper",void 0),(0,l.Z)(this,"mViewRenderWrapper",void 0),(0,l.Z)(this,"mProductId",void 0),(0,l.Z)(this,"mOptions",void 0),(0,l.Z)(this,"mInitialized",!1),(0,l.Z)(this,"mEditInitHash",0),(0,l.Z)(this,"mConfiguredProducts",[]),(0,l.Z)(this,"mConfiguredProductParam",void 0),(0,l.Z)(this,"mBundleUUID",void 0),(0,l.Z)(this,"mBlockOptionBuild",!1),(0,l.Z)(this,"mTemporaryProductId",void 0),(0,l.Z)(this,"mContainerWidth",0),(0,l.Z)(this,"mContainerHeight",0),(0,l.Z)(this,"mContainerObserver",void 0),(0,l.Z)(this,"mRotationActive",!1),(0,l.Z)(this,"mRotatingObjects",[]),(0,l.Z)(this,"mServices",new Map),(0,l.Z)(this,"mSelectedProduct",void 0),(0,l.Z)(this,"mSubscriptions",[]),(0,l.Z)(this,"mEventBrokerSubscriptions",[]),(0,l.Z)(this,"mProductOptionChangedSubject",new Ht),(0,l.Z)(this,"mWindowResizeContext",void 0),(0,l.Z)(this,"mPresetsLoaded",!1),ei.getInstance().setToken(window.expivi.apiToken),i.language&&ei.getInstance().setAcceptLanguage(i.language),i.country&&ei.getInstance().setCountry(i.country),this.mOptions=Object.assign({cameraDropdownVisible:!1,show360Indicator:!0,showProgress:!0,blockDefaultTouch:!0},i),this.mProductId=f.Ft.resolveInt(t)||-1,this.mTemporaryProductId=this.mOptions.temporaryProductId,this.mViewContainer=He.selectDom(n),this.mViewLayout=He.createElement("div"),this.mViewWrapper=He.createElement("div"),this.mContainerWidth=this.mViewContainer.offsetWidth,this.mContainerHeight=this.mViewContainer.offsetHeight,He.setStyle(this.mViewLayout,{overflow:"hidden",width:"100%",height:"auto","min-height":"100%",position:"relative"}),this.mViewContainer.appendChild(this.mViewLayout),He.setStyle(this.mViewWrapper,{width:"".concat(this.mContainerWidth,"px"),height:"".concat(this.mContainerHeight,"px"),position:"absolute",left:"0",top:"0"}),this.mViewLayout.appendChild(this.mViewWrapper),this.mViewRenderWrapper=He.createElement("div"),He.setStyle(this.mViewRenderWrapper,{width:"100%",height:"100%",margin:"0",padding:"0",position:"relative"}),this.mViewWrapper.appendChild(this.mViewRenderWrapper),this.mOptions.configuredProduct&&this.mOptions.configuredProduct.configured_products?this.mConfiguredProductParam=this.mOptions.configuredProduct:this.mConfiguredProductParam=void 0,!1===this.mOptions.blockDefaultTouch&&P.stateRegistery().dispatch(Ci.UNBLOCK_DEFAULT_TOUCH,!0),this.mViewerCanvas=document.createElement("canvas"),this.mUiContainer=document.createElement("div"),this.mViewerComponent=new Hm(this.mViewRenderWrapper,this.mViewerCanvas,this.mUiContainer,this.mOptions),this.mCommunicationLayer=new Dd(this),this.mProductOptionChangedSubject.pipe(Kt((function(e){r.propagateEvent("attribute",e.getData())})),Xt((function(){return!r.mBlockOptionBuild})),Kt((function(e){return e.getData().rebuild&&P.eventBus().disableTopic(Di.getTopicName(Ei.RequestFrame)),e})),an(100)).subscribe((function(e){r.updateOptions(e.getData())})),this.mWindowResizeContext=this.onWindowResized.bind(this,!0)}var n,i,a,p,m,d,g,b,M,k,_,x,T,w,R,Z,S,C;return(0,c.Z)(e,[{key:"init",value:(C=t(r().mark((function e(){var t,n,i,a,o,s,u,c,l,h,f,p,m=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.mInitialized=!1,this.mEditInitHash=1,void 0!==window.MutationObserver&&(this.mContainerObserver=new MutationObserver(this.mWindowResizeContext),this.mContainerObserver.observe(this.mViewContainer,{attributes:!0,childList:!1,characterData:!0,subtree:!1})),He.on(this.mViewerCanvas,"mousedown",(function(e){return m.handleViewMouseDown(e)})),He.on(this.mViewerCanvas,"touchstart",(function(e){return m.handleViewMouseDown(e)})),e.next=7,this.onBeforeInitializationPresetLoad();case 7:return t=new Ri,e.next=10,t.init(this.mProductId);case 10:this.mViewerComponent.createViewLayers(t),this.mViewerComponent.registerInputEvents(),n=t.getSettings().getSceneSettings().renderer_type||"threejs",e.t0=n,e.next="babylonjs"===e.t0?16:(e.t0,20);break;case 16:return e.next=18,Ix.loadScripts();case 18:return i=new Ix(this.mViewerCanvas,this.mUiContainer,t.getSettings()),e.abrupt("break",25);case 20:return e.next=22,Gw.loadScripts();case 22:return Gw.installScripts(),i=new Gw(this.mViewerCanvas,this.mUiContainer,t.getSettings()),e.abrupt("break",25);case 25:if(a=new hn(i),o=new PM,s=new pn,!(c=t.getSettings().getSceneSettings()).physics.enabled){e.next=41;break}return e.next=32,_R.install();case 32:e.t1=c.physics.type,e.next="realtime3d"===e.t1?35:(e.t1,37);break;case 35:return l=Hw.Realtime3d,e.abrupt("break",39);case 37:return l=Hw.Realtime2d,e.abrupt("break",39);case 39:(u=new _R).createWorld(l,120);case 41:return P.init(new eR,{settingsManager:t,renderer:a,sceneManager:o,commandManager:s,physicsSystem:u}),this.mEventBrokerSubscriptions.push(P.eventBus().subscribe(Di.getTopicName(Ei.ProductStartLoading),(function(e){m.propagateEvent("product_start_loading",e)})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductFinishedLoading),(function(e){m.propagateEvent("product_finished_loading",e)})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductErrorLoading),(function(e){m.propagateEvent("product_error_loading",e)})),P.eventBus().subscribe(Di.getTopicName(Ei.LoadConfigurationStarted),(function(e){m.propagateEvent("load_configuration_started")})),P.eventBus().subscribe(Di.getTopicName(Ei.LoadConfigurationFinished),(function(e){m.propagateEvent("load_configuration_finished")}))),o.createScene(),h=this.isBundledConfiguration(this.mConfiguredProductParam),f=o.createObject("product",-1,this.mProductId,h),this.mTemporaryProductId&&f.setValue("temporary_uid",this.mTemporaryProductId),o.addNode(f,void 0,!1),s.getExecStack().onHistoryChanged.subscribe((function(e){P.eventBus().dispatch(new Di(Ei.HistoryChanged,e))})),this.mCommunicationLayer.init(),e.next=52,this.onAfterInitializationPresetLoad();case 52:if(1===this.mEditInitHash){e.next=54;break}throw new Error("App was destroyed before being initialized");case 54:return this.mEventBrokerSubscriptions.push(P.eventBus().subscribe(Di.getTopicName(Ei.BuildFinished),(function(){return m.propagateEvent("buildready")})),P.eventBus().subscribe(Di.getTopicName(Ei.BuildUpdated),(function(){return m.propagateEvent("buildupdated")})),P.eventBus().subscribe(Di.getTopicName(Ei.RequestFrame),(function(){return m.propagateEvent("frame")})),P.eventBus().subscribe(Di.getTopicName(Ei.ObjectSelected),(function(e){var t=e.getData().selection;m.select(t,{},!1),m.propagateEvent("selected",e)})),P.eventBus().subscribe(Di.getTopicName(Ei.SceneObjectAttached),(function(e){return m.propagateEvent("attached",e)})),P.eventBus().subscribe(Di.getTopicName(Ei.SceneObjectDetached),(function(e){return m.propagateEvent("detached",e)})),P.eventBus().subscribe(Di.getTopicName(Ei.WindowResized),(function(){return m.propagateEvent("size")})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductOptionChanged),(function(e){return m.mProductOptionChangedSubject.next(e)})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductAttributeUpdated),(function(e){return m.propagateEvent("attribute_update",e.getData())})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductArticlesChanged),(function(e){return m.propagateEvent("article_change",e.getData())})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductAttributeModerated),(function(e){return m.propagateEvent("attribute_moderated",e.getData())})),P.eventBus().subscribe(Di.getTopicName(Ei.ProductMaterialChanged),(function(e){return m.propagateEvent("material",e.getData())})),P.eventBus().subscribe(Di.getTopicName(Ei.ZoomChanged),(function(){return m.propagateEvent("zoom")})),P.eventBus().subscribe(Di.getTopicName(Ei.Warning),(function(e){return m.propagateEvent("alert",e.getData())})),P.eventBus().subscribe(Di.getTopicName(Ei.Shared),(function(e){return m.propagateEvent("shared",e.getData())})),P.eventBus().subscribe(Di.getTopicName(Ei.PlaySound),(function(e){return m.playSound(e)})),P.eventBus().subscribe(Di.getTopicName(Ei.ActiveViewChanged),(function(){P.eventBus().dispatch(new Di(Ei.BuildFinished))})),P.eventBus().subscribe(Di.getTopicName(Ei.BuildFullyLoaded),(function(){return m.propagateEvent("fully_loaded")})),P.messenger().listen(J.TypeRTTI,(function(e){return m.propagateEvent("optionvisibility",e)})),P.messenger().listen(ae.TypeRTTI,(function(e){return m.setPriceVisibility(e)})),P.messenger().listen(N.TypeRTTI,(function(e){m.propagateEvent("dropzone",{dropped:e.isDroppedInDropZone,data:e.data})}))),this.mViewerComponent.init(),window.addEventListener("resize",this.mWindowResizeContext,!1),P.eventBus().dispatch(new Di(Ei.Initialized)),this.mInitialized=!0,P.eventBus().dispatch(new Di(Ei.BuildStarted)),e.next=62,this.resolveConfigurableNode();case 62:return p=e.sent,e.next=65,this.onConfigurableReady(p);case 65:this.onWindowResized(!0);case 66:case"end":return e.stop()}}),e,this)}))),function(){return C.apply(this,arguments)})},{key:"destroy",value:function(){this.mEditInitHash=0,this.mInitialized=!1,He.off(this.mViewerCanvas,"mousedown"),He.off(this.mViewerCanvas,"touchstart"),window.removeEventListener("resize",this.mWindowResizeContext,!1),delete this.mWindowResizeContext,this.mContainerObserver&&(this.mContainerObserver.disconnect(),delete this.mContainerObserver),this.mEventBrokerSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mSubscriptions.splice(0).forEach((function(e){return e.unsubscribe()})),this.mViewerComponent.destroy(),Ko.getInstance().resetCache(),Xo.getInstance().resetCache(),$s.getInstance().resetCache(),tc.destroy(),P.dispose(),this.mViewerCanvas.remove(),this.mViewWrapper.remove(),this.mViewLayout.remove()}},{key:"onBeforeInitializationPresetLoad",value:(S=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1===this.mProductId){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,this.mPresetsLoaded=!0,e.next=6,this.preloadData();case 6:e.next=10;break;case 8:e.prev=8,e.t0=e.catch(2);case 10:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(){return S.apply(this,arguments)})},{key:"onAfterInitializationPresetLoad",value:(Z=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mPresetsLoaded){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,this.mPresetsLoaded=!0,e.next=6,this.preloadData();case 6:e.next=10;break;case 8:e.prev=8,e.t0=e.catch(2);case 10:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(){return Z.apply(this,arguments)})},{key:"preloadData",value:(R=t(r().mark((function e(){var t,n,i=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mOptions.preset&&0!==String(this.mOptions.preset).length){e.next=2;break}throw new Error("Invalid preset");case 2:return e.next=4,this.resolvePreset(this.mOptions.preset);case 4:if(t=e.sent,this.mProductId=Number(t.catalogue_id),t.configuration){e.next=8;break}throw new Error("Invalid preset");case 8:return(n=t.configuration.configured_products.find((function(e){return e.catalogue_id===Number(i.mProductId)})))&&(n.configuration||(n.configuration={materials:{},attributes:[]}),n.configuration.attributes=n.configuration.attributes.filter((function(e){return!e.excluded_autoload}))),this.mConfiguredProductParam=this.mConfiguredProductParam||t.configuration,e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{key:"resolvePreset",value:(w=t(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){ei.getInstance().get(Jr.E.makeApiRoute("product_preset/find/"+t)).then((function(t){try{var r=v.getItem(t.data);e(r)}catch(e){n(e)}}),(function(e){return n(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return w.apply(this,arguments)})},{key:"handleViewMouseDown",value:function(e){var t=this,n=[];this.mRotatingObjects.forEach((function(e){e.stopOnInteraction&&n.push(e.id)}));for(var r=function(){var e=n.shift(),r=t.mRotatingObjects.findIndex((function(t){return t.id==e}));r>=0&&t.mRotatingObjects.splice(r,1)};n.length>0;)r()}},{key:"isBundledConfiguration",value:function(e){return!!e&&(Array.isArray(e.configured_products)&&e.configured_products.length>1)}},{key:"getClientViewer",value:function(){return this.mViewerComponent}},{key:"onClientReady",value:(T=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.mBlockOptionBuild=!0,P.stateRegistery().dispatch("reconfigure",!0),h.executeInOrder([t.loadConfiguredProduct.bind(t),t.reconfigureProduct.bind(t)],(function(n,r){t.mBlockOptionBuild=!1,P.stateRegistery().dispatch("reconfigure",!1),P.eventBus().dispatch(new Di(Ei.BuildUpdated)),P.eventBus().dispatch(new Di(Ei.BuildFinished)),e(0===r.length)}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return T.apply(this,arguments)})},{key:"loadConfiguration",value:(x=t(r().mark((function e(t){var n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.mConfiguredProductParam=t,P.stateRegistery().dispatch("reconfigure",!0),P.eventBus().dispatch(new Di(Ei.LoadConfigurationStarted)),e.prev=3,e.next=6,this.loadConfiguredProduct();case 6:if(n=e.sent){e.next=9;break}throw new Error("Failed to parse configuration.");case 9:return e.next=11,this.reconfigureProduct();case 11:if(n=e.sent){e.next=14;break}throw new Error("Failed to load configuration.");case 14:return P.stateRegistery().dispatch("reconfigure",!1),P.eventBus().dispatch(new Di(Ei.LoadConfigurationFinished)),e.abrupt("return",n);case 19:throw e.prev=19,e.t0=e.catch(3),P.stateRegistery().dispatch("reconfigure",!1),P.eventBus().dispatch(new Di(Ei.LoadConfigurationFinished)),e.t0;case 24:case"end":return e.stop()}}),e,this,[[3,19]])}))),function(e){return x.apply(this,arguments)})},{key:"loadConfiguredProduct",value:(_=t(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){return t.mConfiguredProductParam?Array.isArray(t.mConfiguredProductParam.configured_products)&&0!==t.mConfiguredProductParam.configured_products.length?(t.mConfiguredProductParam.configured_products.forEach((function(e){null!==e.uuid&&void 0!==e.uuid||(e.uuid=y.F.uuidV4())})),void(t.mConfiguredProductParam.configured_products[0].version?(t.mConfiguredProducts.splice(0),(r=t.mConfiguredProducts).push.apply(r,s(t.mConfiguredProductParam.configured_products.filter((function(e){return e.version})))),t.mConfiguredProductParam.bundle_uuid?t.mBundleUUID=t.mConfiguredProductParam.bundle_uuid:t.mConfiguredProducts.length>0&&t.mConfiguredProducts[0].bundle_uuid&&(t.mBundleUUID=t.mConfiguredProducts[0].bundle_uuid),e(!0)):n("Could not recognize configured product data type: "+JSON.stringify(t.mConfiguredProductParam)))):n("Empty configured list"):n("No reload request");var r})));case 1:case"end":return e.stop()}}),e)}))),function(){return _.apply(this,arguments)})},{key:"countItemsLoadHierarchy",value:function(e){return e.length+e.reduce((function(e,t){return e+(t.children?t.children.length:0)}),0)}},{key:"yieldOnActiveRootProductBuild",value:(k=t(r().mark((function e(){var t,n;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=P.sceneManager().getRootProductNode(),n=t&&t.getComponent("productSceneLoaderComponent")){e.next=4;break}return e.abrupt("return",!1);case 4:return e.next=6,St(n.loaderIdle().pipe(Xt((function(e){return e}))));case 6:return e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)}))),function(){return k.apply(this,arguments)})},{key:"pushYieldOnActiveRootProductBuild",value:function(e){var n=this;e.push(t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.yieldOnActiveRootProductBuild());case 1:case"end":return e.stop()}}),e)}))))}},{key:"updateRootProductScene",value:(M=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.sceneManager().update(1/60),e.abrupt("return",this.yieldOnActiveRootProductBuild());case 2:case"end":return e.stop()}}),e,this)}))),function(){return M.apply(this,arguments)})},{key:"anyReferenceProductsInLoadHierarchy",value:function(e){var t=this;return!(!e||0===e.length)&&!e.every((function(e){return!(e.type===Oi.REFERENCE_PRODUCT||t.anyReferenceProductsInLoadHierarchy(e.children))}))}},{key:"pushBuildSceneJobIfAnyReferenceProductsExists",value:function(e,n){var i=this;this.anyReferenceProductsInLoadHierarchy(n)&&e.push(t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.updateRootProductScene());case 1:case"end":return e.stop()}}),e)}))))}},{key:"getViewInProduct",value:function(e,t){if(!e)return P.sceneManager().getActiveView();var n=P.sceneManager().findNodesOfType(Ep.TypeRTTI,(function(e){return!t||e.getViewId()===t}),e);return null==n?void 0:n[0]}},{key:"getViewOfProductUUID",value:function(e,t){var n=this.findProductNode(e)||P.sceneManager().getRootProductNode(),r=this.getViewInProduct(n,t);if(!r)throw new Error("Parent view not found");return r}},{key:"pushAddSubProductJob",value:function(e,n,i,a){var o=this;e.push(t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){var r;i&&(r=o.getViewOfProductUUID(i,a)),P.sceneManager().addNode(n,r,!1),e(!0)})));case 1:case"end":return e.stop()}}),e)}))))}},{key:"pushSubProductReconfigurationJob",value:function(e,n,i,a){var s=this,u=function(){var u=t(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var r,u;if(n.type===Oi.REFERENCE_PRODUCT&&Number(n.scene_object_id)>0){var c,l=o(P.sceneManager().findNodesOfTypeName("ReferenceProductNode",(function(e){return e.getSceneObjectId()===Number(n.scene_object_id)})),1);r=o((null===(c=u=l[0])||void 0===c?void 0:c.getChildrenDerivedTypeOf(Pc.TypeRTTI))||[],1)[0]}else r=P.sceneManager().createObject("product",null,n.catalogue_id,!0,n),s.pushAddSubProductJob(e,r,a[n.parent_uuid],n.view_id);if(!r)return t(!0);r.setValue("name","Product id:".concat(n.catalogue_id)),n.uuid&&r.setValue("object_uuid",n.uuid),a[n.uuid]=r.getValue("object_uuid"),n.temporary_uid&&r.setValue("temporary_uid",n.temporary_uid),n.view_position&&3===n.view_position.length&&((u||r).setValue("position_x",n.view_position[0]),(u||r).setValue("position_y",n.view_position[1]),(u||r).setValue("position_z",n.view_position[2])),n.view_quaternion&&4===n.view_quaternion.length?((u||r).setValue("quaternion_x",n.view_quaternion[0]),(u||r).setValue("quaternion_y",n.view_quaternion[1]),(u||r).setValue("quaternion_z",n.view_quaternion[2]),(u||r).setValue("quaternion_w",n.view_quaternion[3])):n.view_rotation&&3===n.view_rotation.length&&((u||r).setValue("rotation_x",n.view_rotation[0]),(u||r).setValue("rotation_y",n.view_rotation[1]),(u||r).setValue("rotation_z",n.view_rotation[2])),n.clipping_plane&&r.setValue("clipping_plane",n.clipping_plane),n.place_holder&&r.setValue("place_holder",n.place_holder),s.pushReconfigurationJob(e,n,r,i),t(!0)})));case 1:case"end":return t.stop()}}),t)})));return function(){return u.apply(this,arguments)}}();e.push(u)}},{key:"pushReconfigurationJob",value:function(e,n,i,a){var o=this;e.push(t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){(new Et).load(i,n,(function(e){o.propagateEvent("progress_reconfigure",Math.floor(100*e)*(1/a))})).then((function(){return e(!0)}),(function(e){return t(e)}))})));case 1:case"end":return e.stop()}}),e)}))))}},{key:"buildReconfigurationJobs",value:function(e){var t={},n=new Array;if(0===e.length)throw new Error("Did not found the main product");var r=this.countItemsLoadHierarchy(e),i=new Array;i.push.apply(i,s(e.slice()));for(var a=0;i.length>0;){var o=i.shift();if(0===a){var u=P.sceneManager().getRootProductNode();o.uuid&&u.setValue("object_uuid",o.uuid),t[o.uuid]=u.getValue("object_uuid"),o.temporary_uid&&u.setValue("temporary_uid",o.temporary_uid),this.pushYieldOnActiveRootProductBuild(n),this.pushReconfigurationJob(n,o,u,r),this.pushBuildSceneJobIfAnyReferenceProductsExists(n,e)}else this.pushSubProductReconfigurationJob(n,o,r,t);o.children&&o.children.forEach((function(e){return i.push(e)})),a+=1}return n}},{key:"reconfigureProduct",value:(b=t(r().mark((function e(){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){if(0===n.mConfiguredProducts.length)return i("Configuration list is empty");n.convertReplicas(),n.propagateEvent("progress_reconfigure",1),qe.qL.print("load pre-configuration:",JSON.parse(JSON.stringify(n.mConfiguredProducts)));try{var a=n.buildHierarchyReconfigure(n.mConfiguredProducts);qe.qL.print("load hierarchy:",JSON.parse(JSON.stringify(a)));var o=n.buildReconfigurationJobs(a);h.executeInOrder(o,function(){var i=t(r().mark((function t(i,a){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.updateRootProductScene();case 2:e(0===a.length);case 3:case"end":return t.stop()}}),t)})));return function(e,t){return i.apply(this,arguments)}}())}catch(e){i(e.message)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return b.apply(this,arguments)})},{key:"convertReplicas",value:function(){var e,t=this.mConfiguredProducts.splice(0);(e=this.mConfiguredProducts).push.apply(e,s(t.filter((function(e){if(e.replication_type==Ai.REPLICA){var n=t.find((function(t){return t.replication_type==Ai.ORIGINAL&&t.catalogue_id==e.catalogue_id&&e.original_uuid==t.uuid}));if(!n)return!1;e.attributes=JSON.parse(JSON.stringify(n.attributes||[])),e.articles=JSON.parse(JSON.stringify(n.articles||[])),e.price=JSON.parse(JSON.stringify(n.price||{base:0})),e.configuration=JSON.parse(JSON.stringify(n.configuration||{attributes:[],materials:{}}))}return!0}))))}},{key:"buildHierarchyReconfigure",value:function(e,t){var n=this,r=e.filter((function(e){return e.parent_uuid===t||!t&&!e.parent_uuid}));return r.forEach((function(t){t.children=n.buildHierarchyReconfigure(e,t.uuid)})),r}},{key:"onWindowResized",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.mViewContainer.offsetWidth,n=this.mViewContainer.offsetHeight;if((!1!==e||t!==this.mContainerWidth||n!==this.mContainerHeight)&&(this.mContainerWidth=t,this.mContainerHeight=n,He.setStyle(this.mViewWrapper,{width:"".concat(this.mContainerWidth,"px"),height:"".concat(this.mContainerHeight,"px")}),this.mInitialized)){var r={width:this.mContainerWidth,height:this.mContainerHeight};P.eventBus().dispatch(new Di(Ei.WindowResized,r))}}},{key:"_requestPrice",value:(g=t(r().mark((function e(t){var n,i;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.findProductNode(t)){e.next=3;break}throw new Error("Could not find product node.");case 3:return i=n.getComponent("priceManager"),qe.qL.print("calculate price with manager: ",i),e.abrupt("return",i.requestPrice());case 6:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"_serializeConfigurations",value:(d=t(r().mark((function e(n){var i=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){var o=new Array,s=[];s.push({node:P.sceneManager().getScene(),parent_uuid:void 0,view_id:void 0}),i.mBundleUUID=i.mBundleUUID||y.F.guid();for(var u=function(){var e,a=s.shift(),u=a.parent_uuid,c=a.view_id;a.node.isDerivedTypeOf(Pc.TypeRTTI)?(o.push(t(r().mark((function e(){var t,o,s,u,c;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.node.getSceneObjectId(),o=a.node.getObjectUUID(),s=a.parent_uuid,u=a.node.getValue("temporary_uid"),c=a.view_id,e.abrupt("return",i._saveConfiguration(t,o,s,c,i.mBundleUUID,u,n));case 6:case"end":return e.stop()}}),e)})))),u=a.node.getObjectUUID()):a.node.isDerivedTypeOf(Ep.TypeRTTI)&&(c=a.node.getViewId());var l=a.node.isDerivedTypeOf(Ep.TypeRTTI)?a.node:null;a.node.isDerivedTypeOf(Ga.TypeRTTI)&&(null===(e=null==l?void 0:l.isViewVisible())||void 0===e||e)&&a.node.getChildren().forEach((function(e){return s.push({node:e,parent_uuid:u,view_id:c})}))};s.length>0;)u();h.executeInOrder(o,(function(t,n){n.length>0?a(n[0]):e(t)}),!0)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return d.apply(this,arguments)})},{key:"saveConfiguration",value:(m=t(r().mark((function e(){var t,n,i,a,o,s,u,c,l,h=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>0&&void 0!==h[0]?h[0]:512,n=h.length>1&&void 0!==h[1]?h[1]:512,i=h.length>2&&void 0!==h[2]?h[2]:Ii.ACTIVE_CAMERA,a=h.length>3&&void 0!==h[3]?h[3]:"image/jpeg",o=h.length>4?h[4]:void 0,e.next=7,this.requestScreenshot(t,n,i,a,o);case 7:return s=e.sent,e.next=10,this._serializeConfigurations(o);case 10:return u=e.sent,Array.isArray(u)&&u.length>0&&(u[0].thumbnail=s),c={},l=u.map((function(e){var t=y.F.Md5(JSON.stringify(e.configuration)+"".concat(e.catalogue_id));return t in c?(delete e.configuration,delete e.attributes,delete e.articles,delete e.price,e.replication_type=Ai.REPLICA,e.original_uuid=c[t]):(e.replication_type=Ai.ORIGINAL,c[t]=e.uuid?e.uuid:y.F.guid()),e})),e.abrupt("return",{bundle_uuid:this.mBundleUUID||y.F.guid(),configured_products:l});case 15:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"determineConfiguredProductType",value:function(e){return e.findParentOfTypeName("ReferenceProductNode")?Oi.REFERENCE_PRODUCT:e.findParentOfTypeName("ProductNode")?Oi.SUB_PRODUCT:Oi.ROOT_PRODUCT}},{key:"getControlledProductNodeSceneObjectId",value:function(e){var t=e.findParentOfTypeName("ReferenceProductNode");return t?t.getSceneObjectId():e.getSceneObjectId()}},{key:"_saveConfiguration",value:(p=t(r().mark((function e(t,n,i,a,o,s,u){var c,l,h,f,p,m,d,v;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=this.findProductNode(t),h=l.getComponent("productSceneLoaderComponent"),e.next=4,new Promise((function(e){window.setTimeout((function(){e()}),50)}));case 4:return e.next=6,St(h.loaderIdle().pipe(Xt((function(e){return e}))));case 6:return e.next=8,this._requestPrice(t);case 8:if(f=e.sent,l){e.next=11;break}throw new Error("Could not find product node.");case 11:return p=null!==(c=l.getParent())&&void 0!==c&&c.isTypeOf(Lf.TypeRTTI)?l.getParent():l,m=new Et(u),e.next=15,m.save(l,f.models);case 15:return d=e.sent,v=this.getControlledProductNodeSceneObjectId(l),d.type=this.determineConfiguredProductType(l),d.scene_object_id=v>0?v:null,d.uuid=n,d.parent_uuid=i,d.temporary_uid=s,d.bundle_uuid=o,d.view_id=a,d.view_position=p.transform.position.toArray(),d.view_rotation=p.transform.rotation.toArray(),d.view_quaternion=p.transform.quaternion.toArray(),d.view_scale=p.transform.scale.toArray(),d.price=f.totals,e.abrupt("return",d);case 30:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i,a,o){return p.apply(this,arguments)})},{key:"onConfigurableReady",value:(a=t(r().mark((function e(t){var n,i,a,o,s=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1===this.mEditInitHash){e.next=3;break}return this.propagateReady("Viewer ElementDOM is removed."),e.abrupt("return");case 3:if(n=t.findParentOfType(Pc.TypeRTTI)){e.next=6;break}throw new Error("Could not find product node.");case 6:return i=n.getComponent("materialGroupManager"),e.next=9,i.resolveMaterialGroups().toPromise();case 9:return a=e.sent,this.mSubscriptions.push(a.onMaterialVisibility.subscribe((function(e){return s.propagateEvent("materialvisibility",e)}))),e.prev=11,e.next=14,t.resolveSceneOffsetManager();case 14:if(o=e.sent,1===this.mEditInitHash){e.next=18;break}throw this.propagateReady("Viewer ElementDOM is removed."),new Error("Viewer ElementDOM is removed.");case 18:this.mSubscriptions.push(o.onOffsetChanged.subscribe((function(e){s.propagateEvent("offset",e)})),o.onOffsetVisibility.subscribe((function(e){s.propagateEvent("offsetvisibility",e)}))),this.propagateReady(),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(11),this.propagateReady(e.t0);case 25:case"end":return e.stop()}}),e,this,[[11,22]])}))),function(e){return a.apply(this,arguments)})},{key:"updateOptions",value:function(e){e.rebuild&&(this.propagateEvent("loading_configuration",!0),qe.qL.print("options request scene build"),P.eventBus().dispatch(new Di(Ei.BuildStarted)),P.eventBus().dispatch(new Di(Ei.BuildUpdated)),P.eventBus().enableTopic(Di.getTopicName(Ei.RequestFrame)),this.propagateEvent("loading_configuration",!1),P.eventBus().dispatch(new Di(Ei.RequestFrame)))}},{key:"findProductNode",value:function(e){var t,n=f.Ft.resolveInt(e),r=f.Ft.resolveUuid(e);return void 0===r&&void 0===n?P.sceneManager().getRootProductNode():(P.sceneManager().findNodesOfType(Pc.TypeRTTI).every((function(e){return r&&e.getObjectUUID()===r?(t=e,!1):!(!r&&e.getSceneObjectId()===n)||(t=e,!1)})),t)}},{key:"resolveConfigurableNode",value:(i=t(r().mark((function e(t){var n=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=n.findProductNode(t);if(!i)return r("Product not found");i.onConfigurableNodeReady.pipe(sn(1)).subscribe((function(t){e(t)}),(function(e){r(e)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"handleRotations",value:function(){var e=this;if(this.mInitialized){this.mRotationActive=!0;var t=[];this.mRotatingObjects.forEach((function(e){void 0===e.rotationY&&(e.rotationY=e.sceneNode.transform.rotation.y),e.degree+=200*e.speed,e.maxDegree>=0&&e.degree>e.maxDegree&&(e.degree=e.maxDegree,t.push(e.id)),e.sceneNode.transform.rotation.y=(Number(e.rotationY)||0)+Pt(e.degree)})),P.eventBus().dispatch(new Di(Ei.RequestFrame)),t.forEach((function(t){var n=e.mRotatingObjects.findIndex((function(e){return e.id===t}));n>=0&&e.mRotatingObjects.splice(n,1)})),this.mRotatingObjects.length>0?window.setTimeout((function(){window.requestAnimationFrame((function(){return e.handleRotations()}))}),16):this.mRotationActive=!1}}},{key:"addPlayRotation",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:360,i=this.mRotatingObjects.find((function(t){return t.id==e.getObjectId()}));i?(i.speed=.001*n,i.stopOnInteraction=t,i.maxDegree=r):this.mRotatingObjects.push({id:e.getObjectId(),sceneNode:e,speed:.001*n,stopOnInteraction:t,maxDegree:r,degree:0}),this.mRotationActive||this.handleRotations()}},{key:"requestScreenshot",value:(n=t(r().mark((function e(){var t,n,i,a,o,s,u,c,l,h,f,p=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=p.length>0&&void 0!==p[0]?p[0]:512,n=p.length>1&&void 0!==p[1]?p[1]:512,i=p.length>2&&void 0!==p[2]?p[2]:Ii.ACTIVE_CAMERA,a=p.length>3&&void 0!==p[3]?p[3]:"image/jpeg",o=p.length>4?p[4]:void 0,!(t*n<=0)){e.next=7;break}return e.abrupt("return",void 0);case 7:return this.mViewerComponent.renderView(1/60),s=P.renderer().getRenderEngine().getCanvas(),u=s.toDataURL("image/jpeg"),c=this.mContainerWidth,l=this.mContainerHeight,P.eventBus().dispatch(new Di(Ei.ScreenshotTransitionStart,{image_data:u,image_width:c,image_height:l})),s.width=t,s.height=n,He.setStyle(s,{width:"".concat(s.width,"px"),height:"".concat(s.height,"px")}),P.renderer().getRenderEngine().setPixelRatio(1),P.renderer().getRenderEngine().setSize(t,n),h="",e.prev=19,f=P.sceneManager().getRootProductNode(),e.next=23,this.mViewerComponent.renderCamera(i,f,a,o);case 23:h=e.sent,e.next=29;break;case 26:e.prev=26,e.t0=e.catch(19),qe.qL.error(e.t0);case 29:return s.width=c,s.height=l,He.setStyle(s,{width:"".concat(s.width,"px"),height:"".concat(s.height,"px")}),P.renderer().getRenderEngine().setPixelRatio(window.devicePixelRatio),P.renderer().getRenderEngine().setSize(c,l),this.mViewerComponent.renderView(1/60),P.eventBus().dispatch(new Di(Ei.ScreenshotTransitionEnd),void 0,void 0,0),e.abrupt("return",h);case 37:case"end":return e.stop()}}),e,this,[[19,26]])}))),function(){return n.apply(this,arguments)})},{key:"setPriceVisibility",value:function(e){var t=e.item_id,n=e.visible;this.propagateEvent("material_price",{id:t,material_price:n})}},{key:"playSound",value:function(e){var t=e.getData();t&&t.url&&new qw.Howl({src:[t.url],html5:!0}).play()}},{key:"getServices",value:function(){return this.mServices}},{key:"select",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&e instanceof Wi?t=e instanceof Pc?e:e.findParentOfType(Pc.TypeRTTI):t=void 0;return!(!t&&!this.mSelectedProduct||this.mSelectedProduct&&t&&this.mSelectedProduct.getSceneObjectId()===t.getSceneObjectId())&&(this.mSelectedProduct=t,r&&P.eventBus().dispatch(new Di(Ei.ObjectSelected,{selection:this.mSelectedProduct,options:n})),!0)}},{key:"deselect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.select(void 0,e,t)}},{key:"propagateEvent",value:function(e,t){window.expivi._events.onChange.next(Object.assign({name:e},null!=t?{payload:t}:{}))}},{key:"propagateReady",value:function(e){window.expivi._events.onReady.next({error:null!=e,err:e})}}]),e}();!function(e){e.V1_Ready="v1.ready"}(xR||(xR={}));var wR=function(){function e(){(0,u.Z)(this,e),this.handleQuerystringOptions(),window.addEventListener("message",e.handleIncomingMessage),this.sendMessage(xR.V1_Ready,void 0,!0)}var n,i;return(0,c.Z)(e,[{key:"handleQuerystringOptions",value:function(){new window.URL(window.location.href).searchParams.getAll("handleQuerystringOptions").forEach((function(e){}))}},{key:"sendMessage",value:(i=t(r().mark((function t(n){var i,a,o=arguments;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=o.length>1&&void 0!==o[1]?o[1]:void 0,a=o.length>2&&void 0!==o[2]&&o[2],t.abrupt("return",new Promise((function(t,r){var o=e.generateMessage(n,i,a);e.addEventListener(n,(function(e){return o.uuid===e.uuid&&("finished"!==e.state?(r(e),!0):(t(e.payload),!0))})),window.parent.postMessage(o,"*")})));case 3:case"end":return t.stop()}}),t)}))),function(e){return i.apply(this,arguments)})},{key:"sendMessageToHost",value:(n=t(r().mark((function e(t){var n,i=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:void 0,e.abrupt("return",this.sendMessage(t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"dispose",value:function(){if(window.removeEventListener("message",e.handleIncomingMessage),e.listeners){for(var t in e.listeners)e.listeners[t].splice(0);delete e.listeners}}}],[{key:"handleIncomingMessage",value:function(t){if(t.data.xpv&&void 0!==t.data.type){var n=t.data.type,r=e.listeners[n];if(void 0!==r&&r.length>0)for(var i=r.length-1;i>=0;i--){r[i](t.data)&&e.listeners[n].splice(i,1)}}}},{key:"addEventListener",value:function(t,n){void 0!==e.listeners[t]?e.listeners[t].push(n):e.listeners[t]=[n]}},{key:"generateMessage",value:function(e){return{xpv:!0,type:e,state:arguments.length>2&&void 0!==arguments[2]&&arguments[2]?"finished":"pending",payload:arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,uuid:y.F.uuidV4()}}}]),e}();function RR(){return ZR.apply(this,arguments)}function ZR(){return(ZR=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){t("Resolved called before initialization.")})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function SR(){return(SR=t(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){t("This function has been deprecated.")})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function CR(){return(CR=t(r().mark((function e(t,n,i,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.expivi=window.expivi||{},window.expivi.apiToken=t,/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(navigator.userAgent.substr(0,4))?(void 0===window.isMobile&&(window.isMobile=!0),window.expivi.isMobile=!0):(void 0===window.isMobile&&(window.isMobile=!1),window.expivi.isMobile=!1),!window.parent||window.parent===window||a&&!0===a.disableIframeService||(window.expivi._iFrameService=new wR),window.expivi._events.onReady||(window.expivi._events.onReady=new ni(1)),window.expivi._events.onChange||(window.expivi._events.onChange=new Ht),window.expivi.viewer=new TR(n,i,a),e.abrupt("return",window.expivi.viewer.init());case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(0,l.Z)(wR,"listeners",{}),window.expivi=window.expivi||{},window.expivi.currentScript=document.currentScript,Object.assign(window.expivi,{apiToken:"",viewer:void 0,isMobile:!1,_events:{onReady:new ni(1),onChange:new Ht},_create:function(e,t,n,r){return CR.apply(this,arguments)},_dispatch:RR,_destroy:function(){window.expivi&&(window.expivi.viewer&&(window.expivi.viewer.destroy(),delete window.expivi.viewer),window.expivi.apiToken="",window.expivi._events.onReady&&(window.expivi._events.onReady.unsubscribe(),delete window.expivi._events.onReady),window.expivi._events.onChange&&(window.expivi._events.onChange.unsubscribe(),delete window.expivi._events.onChange),window.expivi._iFrameService&&(window.expivi._iFrameService.dispose(),delete window.expivi._iFrameService))},_iFrameService:void 0,managers:{resolveMaterialGroups:RR,resolveMaterialGroupManager:RR,resolveOffsetGroups:RR,resolveMaterials:RR,resolveTextures:RR,resolveMaterialManager:RR},resolveSvgElementBoundaries:RR,getAttributeById:RR,getMatgroupOptions:RR,getColorOptions:RR,getQuestionOptions:RR,getProductAttributes:RR,setProductAttribute:RR,setProductAttributeNamed:RR,setProductAttributeByKey:RR,resetProductAttribute:RR,getActiveMaterial:RR,setActiveMaterial:RR,applyActiveMaterial:RR,getScreenshot:RR,registerPriceCalculator:RR,getPrice:RR,getAllPrices:RR,getSupportedLocales:RR,setNodeProperty:RR,getSceneObj:RR,getActiveCamera:function(){return SR.apply(this,arguments)},changeCameraZoom:RR,saveConfiguration:RR,loadConfiguration:RR,loadPreset:RR,resolveProductNodes:RR,selectProductNode:RR,autoRotateYAxis:RR,deselect:RR,deleteNode:RR,usesCatalogueBrowser:RR,getCatalogueProducts:RR,getCatalogueProductById:RR,getCameraTransform:RR,setCameraTransform:RR,addProduct:RR,moveProduct:RR,removeProduct:RR,getService:RR,getCategories:RR})}()})();